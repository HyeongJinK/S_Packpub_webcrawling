<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec121"></a>Writing a simple function</h2></div></div><hr /></div><p>Scripts are a great way to automate tasks. However, a <span>fundamental</span><a id="id326271789" class="indexterm"></a> limitation with a script is that only one kind of task can be handled by a simple script. For instance, if you wanted to achieve two goals, that is, count down from 21 and copy two files from one location to another, you would need to write two different scripts to perform the tasks. Wouldn't it be great if you could write a single script for the two tasks and run either of them by choice? This way, you have a smaller number of scripts to manage.</p><p>Secondly, writing a script to perform a very complex task would involve several sub-tasks. If a single script is written for all the sub-tasks, the script would become monolithic. This has its own drawbacks, the first one being the challenges in reusing the code.</p><p>Functions help with this. With functions, you can separate the sub-tasks, and make each function do only one thing, which is what any software design person would tell you to do. This makes the script more flexible, and code reuse easy. Not to mention that if you wanted to perform a certain task multiple times in a single session, you would just have to call the script once, and only the function every subsequent time, rather than specifying the path and calling the script every time.</p><p>Convert the script that you wrote for the <span class="emphasis"><em>Defining arguments for a script</em></span> recipe into a function.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec317"></a>How to do it…</h3></div></div></div><p>This is, again, a very simple task. Follow these steps to perform the conversion, and understand how to call the function in the final step:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a copy of the script you created for the <span class="emphasis"><em>Showing progress of execution</em></span> recipe.</li><li>At the first line, define the function with the following code:</li></ol></div><pre class="programlisting">function Start-Count {</pre><p> </p><p> </p><p> </p><p> </p><p>Go to the end of the script, and close the braces to complete the function. The complete script should look like this:</p><pre class="programlisting">function Start-Count {
    param ($TotalTime = 25)

    $CurrentTime = 0

    while ($CurrentTime -le $TotalTime) {
        Write-Progress -Activity "Counting to $TotalTime" -Status "Elapsed time: $CurrentTime seconds" -PercentComplete ($CurrentTime / $TotalTime * 100)
        Start-Sleep 1
        $CurrentTime++
    }
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Load the script using the dot calling operator at the terminal:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; . ./ch11/06-Start-Count.ps1</strong></span></pre><p>If you are using VS Code IDE, simply run the script with <span class="emphasis"><em>F5</em></span>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Call the function. Optionally, supply a value to the <code class="literal">TotalTime</code> parameter:</li></ol></div><pre class="programlisting">PS&gt; Start-Count -TotalTime 5</pre><p>Here is a screenshot of the function running. Note how similar it looks to a cmdlet:</p><div class="mediaobject"><img src="/graphics/9781789137231/graphics/fcf2ef0c-11a1-4335-ad42-5ff4129736b4.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec318"></a>How it works…</h3></div></div></div><p>When you convert a script into a function, the function retains all of the capabilities of a script. However, simply calling the script is not sufficient when you want to get tasks done. Now, you first load the script—and all of the functions and other parts of it—into the session, and then call the function of your choice. Functions may or may not contain parameters<span class="emphasis"><em>.</em></span> When present, parameters can be called along with the function, just like how you would a cmdlet. However, it would not be as follows:</p><pre class="programlisting">PS&gt; Start-Count.TotalTime(5)</pre><p>Instead, it would be like this:</p><pre class="programlisting">PS&gt; Start-Count -TotalTime 5</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip72"></a>Note</h3><p>We will look at how to make it <code class="literal">Start-Count 5</code> in <a class="link" href="#" linkend="ch12">Chapter 12</a>, <span class="emphasis"><em>Advanced Concepts of Functions</em></span>.</p></div><p>Remember to call the scripts that contain functions with the dot <span>calling</span><a id="id325892268" class="indexterm"></a> operator and not the ampersand. If you call a script with the ampersand calling operator, the script will simply run; the functions within will not be loaded into the session, and so you won't be able to call the functions.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec319"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The <span class="emphasis"><em>Dot-sourcing a PowerShell script</em></span> recipe in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Preparing for Administration using PowerShell</em></span></li></ul></div></div></div>