<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec45"></a>Finding the owner of a process</h2></div></div><hr /></div><p>In the recipe, <span class="emphasis"><em>Working with currently-running processes to measure resource consumption</em></span>, covered in this chapte<span class="emphasis"><em>r</em></span>, we listed out the processes running in the system. The table did not show us the <span>process</span><a id="id325906076" class="indexterm"></a> owner. In this recipe, we look at working with processes started by a certain owner.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec124"></a>How to do it…</h3></div></div></div><p>The <code class="literal">Get-Process</code> cmdlet can fetch us this information:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>At the prompt, type the following to get all of the parameters that the <code class="literal">Get-Process</code> cmdlet accepts:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Help Get-Process</strong></span></pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>We see a parameter, <code class="literal">IncludeUserName</code> (the name suggests it is a switch parameter). Get more information on it<span>:</span></li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Help Get-Process -Parameter IncludeUserName</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/d3dde1ec-1048-44a1-8138-a4283be6f1b9.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Run the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -IncludeUserName</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Filter out the processes started by you. We will use <code class="literal">grep</code> for this operation until we learn how to filter in PowerShell. You can replace <code class="literal">$env:USER</code> with your username, if you would like:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -IncludeUserName | grep $env:USER</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Count the number of processes running under your name:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; (Get-Process -IncludeUserName | grep $env:USER).Count</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>If you would like to use the <code class="literal">Measure-Object</code> cmdlet, <span>you can:</span></li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -IncludeUserName | grep $env:USER | Measure-Object</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>See what amount of working set all of the processes started by you <span>consume:</span></li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -IncludeUserName | grep $env:USER | Measure-Object -Property WS -Sum</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/b5bef6b0-ae17-48a3-ac34-acbbc9ad3ca5.png" /></div><p>There is an error. Try the following instead:</p><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -incl | Where-Object UserName -eq $env:USER | Measure-Object ws -sum</strong></span>
<span class="strong"><strong>PS&gt; # Verbose version: Get-Process -IncludeUserName | Where-Object UserName -eq $env:USER | Measure-Object -Property WS -Sum</strong></span></pre><p>You get the details this time:</p><div class="mediaobject"><img src="/graphics/9781789137231/graphics/db1506f3-0545-46a9-b3eb-174cdc597862.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec125"></a>How it works…</h3></div></div></div><p><code class="literal">Get-Process</code> does not show you the process owner information by default. In some situations, it may be necessary to have this information. In this simple recipe, we use the help documentation to get all of the parameters and use the <code class="literal">IncludeUserName</code> switch parameter to get the <span>process</span><a id="id325898665" class="indexterm"></a> owner information.</p><p> </p><p> </p><p>In the next step, we filter out the processes started by a certain user and then count the number of processes. We do the same using <code class="literal">Measure-Object</code> as well and notice that the output is the same. <code class="literal">Measure-Object</code> has object in its name, but worked on text that was output by <code class="literal">grep</code>. At the same time, it said at the next step that the value of <code class="literal">Property</code> is invalid.</p><p>The answer to why <code class="literal">Measure-Object</code> worked when counting is in the step that precedes it. We know that if an array is output, PowerShell can count the number of elements in the array. <code class="literal">Measure-Object</code> is also capable of the same: measuring what can be measured in string arrays—<code class="literal">Count</code> works on string arrays.</p><p>However, when we tried to fetch the total working set, <code class="literal">Measure-Object</code> could not get us that. The reason is that the output of <code class="literal">grep</code>, as we have seen before, is plain text:</p><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -IncludeUserName | grep $env:USER | Get-Member</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec126"></a>There's more…</h3></div></div></div><p>This is something that's perhaps a few steps ahead, but what if we wanted to get that working set information anyway, from the output of <code class="literal">grep</code>? Simple challenge, accepted<span>:</span></p><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Process -IncludeUserName | grep $env:USER | awk '{print $1}' | ForEach-Object {[Double]$_} | Measure-Object -Sum</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/c64195a7-d5e5-41b5-8e81-808a83c18a30.png" /></div><p> </p><p>Do not worry too much about how that works, for now. Once we read and understand looping through available elements, we will have a better understanding of how we got this to work. For now, understand that we converted each of the returned strings into <code class="literal">double</code> values using the <code class="literal">Double</code> cast operator. Then, we did <code class="literal">Measure-Object</code> and found the sum.</p><p>Of course, with only PowerShell, this <span>process</span><a id="id326098286" class="indexterm"></a> is much simpler since we would be dealing with the objects straight away. The alternative using <code class="literal">Where-Object</code> demonstrates that.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec127"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The <span class="emphasis"><em>Comparing the outputs of Bash and PowerShell</em></span><span class="emphasis"><em> </em></span>recipe in <a class="link" href="#" linkend="ch01">Chapter 1</a><span class="emphasis"><em>, Introducing PowerShell Core</em></span></li></ul></div></div></div>