<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec29"></a>Enabling automated execution of commands for each load</h2></div></div><hr /></div><p>As we saw in the previous recipes, these <span>changes</span><a id="id325901991" class="indexterm"></a> are ephemeral; they remain as long as the session is active. There might be situations where administrators might require running a few commands or loading modules to enable them to work faster. For instance, I tend to load a series of modules that help me manage Microsoft Exchange, Active Directory, VMware vSphere infrastructure, Citrix XenApp, Microsoft System Center, and other environments using PowerShell.</p><p>All of these products require different ways of loading the modules, snap-ins, and scripts, and many of them require a certain configuration every time you load the modules (such as connecting to VM servers with administrator credentials). These can be done using the PowerShell profile.</p><p> </p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec75"></a>Getting ready</h3></div></div></div><p>PowerShell, by default, does not create a profile during installation. It simply runs with its default configuration. Any override to this configuration would require creating and modifying the profile:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open a PowerShell console. (You could either run <code class="literal">pwsh</code> at the Terminal or use the Visual Studio Code console. This recipe uses the Terminal.)</li><li>Reveal the path of your profile. To do this, simply call the automatic variable:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; $PROFILE</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Check if your profile exists:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Test-Path $PROFILE</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>If you get <code class="literal">True</code> as the response, you can proceed with the recipe. If the response is <code class="literal">False</code>, which is most likely the case, run the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; New-Item $PROFILE -ItemType File</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>You may receive an error, saying a part of the path was not found. This is because your <code class="literal">~/.config/</code> directory does not, by default, contain a <code class="literal">powershell</code> directory. Adding <code class="literal">-Force</code> to the command creates this directory and creates your profile file at the location:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; New-Item $PROFILE -ItemType File -Force</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/30c994da-e327-41b1-8cd4-371db142b73b.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>We will now edit the profile in Visual Studio Code. At the Terminal, type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; code $PROFILE</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec76"></a>How to do it…</h3></div></div></div><p>You should have the profile open now. It would currently be empty. Let us now customize PowerShell's error action behavior. Remember that we said that setting <code class="literal">ErrorActionPreference</code> to <code class="literal">SilentlyContinue</code> at the Terminal was temporary. Let us now ensure that <code class="literal">ErrorActionPreference</code> is permanently set to <code class="literal">SilentlyContinue</code> every time we launch PowerShell:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Switch to the Terminal window. If you have the window open since the last recipe, restart PowerShell.</li><li>Let us see what the error action preference is at the moment:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Variable ErrorActionPreference</strong></span>
Continue</pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Switch to Visual Studio Code. The profile should already be open for edits.</li><li>At the very first line, type in the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Set-Variable ErrorActionPreference SilentlyContinue</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Save the profile and close the file.</li><li>At the Terminal, type <code class="literal">exit</code> to exit from PowerShell. Start <span>PowerShell</span><a id="id325669222" class="indexterm"></a> again.</li><li>Let us now check what the value is for <code class="literal">ErrorActionPreference</code>. At the prompt, type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; $ErrorActionPreference</strong></span>
SilentlyContinue</pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>To ensure the preference is indeed in place, type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-ChildItem /home/ram/random-directory</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/b46fb9bd-c0b7-4f00-ac57-14aad2e7b929.png" /></div><p>The cursor simply returned to the prompt at the next line without throwing an error.</p><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec77"></a>How it works…</h3></div></div></div><p>Long story short, the PowerShell profile executes every time a <span>PowerShell</span><a id="id325892259" class="indexterm"></a> session is loaded. This profile is a PowerShell script file that can contain a series of commands and functions, which would be executed just like any other script.</p><p>One important point to remember is that there is a different profile for each host. For instance, there is a separate profile for PowerShell loaded on the Terminal and a different one for the integrated terminal on Visual Studio Code. This is because each of the terminals has a different nature.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip29"></a>Note</h3><p>Execution policies have not been implemented in PowerShell on Linux. In case PowerShell on Linux gains the safety belt in the future, the execution policy should be set to allow execution of scripts in order for the profile to load.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec78"></a>There's more…</h3></div></div></div><p>It is bad practice to set a global action preference. Empty the profile to remove the error action preference. Since the profile has nothing else, you could even delete the profile using the following command:</p><pre class="programlisting"><span class="strong"><strong>PS&gt; Remove-Item $PROFILE</strong></span></pre><p>Read the best practices for more information.</p></div></div>