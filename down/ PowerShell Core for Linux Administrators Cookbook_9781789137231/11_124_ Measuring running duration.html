<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec123"></a>Measuring running duration</h2></div></div><hr /></div><p>Optimization is the key to efficient automation. While <span>shorter</span><a id="id325892269" class="indexterm"></a> duration does not always stand for optimization, it is an important part of optimization. Here is the scenario:</p><p>You have a friend who has just learned how to use PowerShell, and they are excited about <code class="literal">Select-Object *</code>, which they just found out shows information that is not usually visible with the vanilla <code class="literal">Get-ChildItem</code>. You ask them why they want to use <code class="literal">Select-Object *</code>, and they say it's because they would like to get the <code class="literal">CreationTime</code> of the files as well. Of course, you are trying to tell them that they are not efficiently querying the metadata. They ask for proof.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec322"></a>How to do it…</h3></div></div></div><p>Open a terminal window to show your friend the difference between the commands:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>At the prompt, enter the following (point <code class="literal">Get-ChildItem</code> to any valid directory with a noticeable number of files):</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; $AllAttributes = measure-command { gci $HOME/random/ -rec | select * }</strong></span>
<span class="strong"><strong>PS&gt; # Verbose version: Measure-Command -Expression { Get-ChildItem $HOME/random -Recurse | Select-Object * }</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>And then, to compare, type in the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; $SelectAttributes = measure-command { gci $HOME/random/ -rec | select name, fullname, creationtime }</strong></span>
<span class="strong"><strong>PS&gt; # Verbose version: Measure-Command -Expression { Get-ChildItem $HOME/random/ -Recurse | Select-Object Name, FullName, CreationTime }</strong></span>
<span class="strong"><strong>PS&gt; ($allattributes - $selectattributes).totalmilliseconds</strong></span></pre><p>Smile when your friend says you took longer than 200 ms to type out the three property names.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec323"></a>How it works…</h3></div></div></div><p>The cmdlet that helps find the total runtime of any command or a script block is <code class="literal">Measure-Command</code>. While this cmdlet can take <code class="literal">PSObject</code> as input, the convention here is to use the <code class="literal">Expression</code> parameter. This parameter accepts a script block as input, which is what we pass to it, in our case. The cmdlet evaluates for how long the script block ran, and shows us the output as a <code class="literal">System.TimeSpan</code> object.</p><p>Now, on to the point that your friend mentioned you taking longer than 200 ms to merely write the properties. I was once tasked with creating a script that performed some filtration on Active Directory objects based on a couple of properties. We observed that the script took about 25 minutes to run in that environment. After some minor changes to the script, we were able to reduce the runtime to about 23 minutes.</p><p>When we checked each statement in the script for its runtime, we found that a single <span>query</span><a id="id326033453" class="indexterm"></a> within a <code class="literal">foreach</code> loop was taking about 200 milliseconds to run. Multiplied by well over 65,000 entities, the total time went over 20 minutes. We changed the logic at this step, and achieved a reduction of about 60%. 60% of 200 milliseconds may be a mere 120 milliseconds, but when the number of objects where the operation is performed increases, the total time taken shoots up. Little things add up.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec324"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="emphasis"><em>Software disenchantment</em></span> (<a class="ulink" href="http://tonsky.me/blog/disenchantment/" target="_blank">http://tonsky.me/blog/disenchantment/</a>) by Nikita Prokopov, the author of the beautiful font Fira Sans</li></ul></div></div></div>