<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch17lvl1sec186"></a>Building an image from a Dockerfile using PowerShell</h2></div></div><hr /></div><p>In the previous recipe, we took a sample image through a mini life cycle, which <span>involved</span><a id="id325990628" class="indexterm"></a> working with <span>Docker</span><a id="id325990619" class="indexterm"></a> Hub. In this recipe, we will look at building an image using a Dockerfile.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec497"></a>Getting ready</h3></div></div></div><p>If you did not close the Terminal after the previous recipe, you can continue. If you did launch a Terminal session and, optionally, launch PowerShell.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec498"></a>How to do it…</h3></div></div></div><p>To build a Docker image automatically with the instructions from a Dockerfile, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Use a text or code editor to create a Dockerfile. The name of the file is case-sensitive:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; vim Dockerfile</strong></span></pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Add the following text to the Dockerfile. (You can use the base image of any distro; CentOS is not the only option.) Change the value for the <code class="literal">MAINTAINER</code> key to your email address:</li></ol></div><pre class="programlisting">FROM centos:latest
MAINTAINER powershellsql@gmail.com

RUN yum install wget -y
RUN wget --directory-prefix=/etc/yum.repos.d/ https://packages.microsoft.com/config/rhel/7/prod.repo
RUN yum install powershell -y

CMD /usr/bin/pwsh</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Build the new Docker image, <code class="literal">packtpubdemo</code>, using the <code class="literal">docker build</code> command:</li></ol></div><pre class="programlisting"><span class="strong"><strong># docker build --tag packtpubdemo .</strong></span>
.
.
.
Successfully tagged packtpubdemo:latest</pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/cdba4134-5cf1-4ee2-89d0-0051a82a3200.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Find the newly created images by using <code class="literal">docker images</code> with the <code class="literal">grep</code> command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; docker images -a | grep packtpubdemo</strong></span>
packtpubdemo latest 4b5e7f30245d 53 seconds ago 450MB</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Test and verify the Docker image using the <code class="literal">docker run</code> command. To make the result seem more pronounced, exit PowerShell and run the <code class="literal">docker run</code> command at the root prompt:</li></ol></div><pre class="programlisting"><span class="strong"><strong># docker run -it packtpubdemo</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/aabc2396-dc73-4c38-a2d8-2149aa311119.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec499"></a>How it works…</h3></div></div></div><p>A Dockerfile is a small configuration file, designed to describe how to build a <span>Docker</span><a id="id325611874" class="indexterm"></a> image. The file has several steps to create a new image. The first line indicates that the new image is created from the <code class="literal">centos:latest</code> image. If you see the output, the container ID is different for each step; these are intermediate containers. The output shows detailed information about what is being done.</p><p>You build the Docker image with the <code class="literal">docker build</code> command. You specify the tag for the Docker image. You also tell the command that you have the Dockerfile in the current directory, which you would like <code class="literal">docker build</code> to use. The <code class="literal">docker build</code> command looks in the current directory for the Dockerfile, and builds the image based on the information you provide in the Dockerfile:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">If the Dockerfile is created somewhere else, you <span>replace</span><a id="id325885486" class="indexterm"></a> that dot with the actual path to the directory containing the Dockerfile.</li><li style="list-style-type: disc">When <code class="literal">docker build</code> finishes running the Dockerfile, an image will be created locally and registered in the local Docker registry. It is now ready to be run with the <code class="literal">docker run</code> command.
</li><li style="list-style-type: disc">Each step produces a new image. The file has six steps, therefore, six images are created. However, each of these intermediate images is deleted as the operation progresses.</li><li style="list-style-type: disc">The steps are exactly the same as those for creating a new image manually, which we saw in the previous recipe. However, in this recipe, the same steps are done using a Dockerfile.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec500"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Refer to the instructions from a D<span>ocker</span><a id="id325892140" class="indexterm"></a>file to build a Docker image (<a class="ulink" href="https://docs.docker.com/engine/reference/builder/" target="_blank">https://docs.docker.com/engine/reference/builder/</a>).</li></ul></div></div></div>