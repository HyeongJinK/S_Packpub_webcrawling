<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch14lvl1sec155"></a>Testing PowerShell remoting with OpenSSH using keys between Linux and Windows machines</h2></div></div><hr /></div><p>In this recipe, you'll find out how to <span>configure <span>SSH</span><a id="id326261854" class="indexterm"></a> to allow logins to a remote system</span> by using <span><span>cryptographic</span><a id="id326261838" class="indexterm"></a> key files between two Linux and Windows machines.</span></p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec398"></a>Getting ready</h3></div></div></div><p><span>On the remote Windows machine (<strong class="userinput"><code>wintel01</code></strong>), you</span> <span>need to ensure that the OpenSSH server package is installed and configured.</span> You also need to copy the public key using any of the available tools. In this case, WinSCP has been installed so that it copies the <code class="literal">id_rsa.pub</code> file to the remote Windows machine.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec399"></a>How to do it…</h3></div></div></div><p>Let's get started and set up the authorized key from the Linux host (CentOS) and send it to the remote Windows machine:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>On the Linux host, to generate a key-pair, run the <code class="literal">ssh-keygen</code> command: </li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; ssh-keygen -t rsa</strong></span>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/packpub/.ssh/id_rsa): 
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/packpub/.ssh/id_rsa.
Your public key has been saved in /home/packpub/.ssh/id_rsa.pub.
The key fingerprint is:
4a:a9:ca:63:85:b1:b2:f9:39:61:05:ef:1a:b8:e2:fd packpub@localhost.localdomain
The key's randomart image is:
+--[ RSA 2048]----+
| |
| . |
| o |
| . o . |
| . * o S |
|o * oo . |
| * =. . |
|=.*o |
|o+=+.E |
+-----------------+</pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Copy the <code class="literal">id_rsa.pub</code> public key to the <code class="literal">/tmp</code> directory: </li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; cp ~/.ssh/id_rsa.pub /tmp</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>To verify file permissions, run the <code class="literal">ls</code> command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; ls /tmp/id_rsa.pub -lrt</strong></span>
-rw-------. 1 packpub packpub 411 Jul 26 11:45 /tmp/id_rsa.pub</pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>On a Windows machine, create a <code class="literal">.ssh</code> folder under the <code class="literal">home</code> directory of the user. In this case, it's a <code class="literal">ram</code> account:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; mkdir .ssh</strong></span>

    Directory: C:\Users\ram
Mode LastWriteTime Length Name 
---- ------------- ------ ---- 
d----- 7/26/2018 10:51 AM .ssh </pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Copy the <code class="literal">id_rsa.pub</code> file to a <code class="literal">.ssh</code> folder from Linux to Windows by using the WinSCP tool.</li><li>To view the content, run <code class="literal">cat  &lt;filename&gt;</code>:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; cat .\id_rsa.pub</strong></span>
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC//zAtkDZclx26rU0+fvsYAD4MooiDzcGO56YZOOCAtJrlF7L05vtoIXS8+UWj/FLGnn5hTLUnjMJPjfqfyT2rxjXqgb7QdpPEfTnOWBMVaodHN38QRzYwziITXkE9I5BSePRSNpiX4yA3vsPVGM1DdYpZVqEMULDlW/Gfl4h6TFWw9dHJZEi2NMeEIz2AEG27uvfCu0FsyQjho5gosKw99dDu0G6B7Zy26iZRz+xaQELn+yIcHm4IG1Xe2DKW2gwn3KHaHnqUY0RvZcLMyjx5hejTx3Op73O0Btfk8cFHo3/86MvfQN4Ny2H0yGk7fIdX5Q3oJECgDCSPJ6mSWJCt packpub@localhost.localdomain</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>To append the content of the <code class="literal">id_rsa.pub</code> file to the <code class="literal">authorized_keys</code> file, use the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; cat .\id_rsa.pub &gt;&gt;authorized_keys</strong></span>

</pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>To test the connection from the Linux machine to the Windows machine, run the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Enter-PSSession -HostName wintel01 -UserName ram</strong></span>
<span class="strong"><strong>[wintel01]: PS&gt;</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec400"></a>How it works…</h3></div></div></div><p>This works no differently to what we explained in the previous recipe. L<span>et's verify the <code class="literal">.ssh</code> hidden directory and make sure that the public key file has got <code class="literal">rw</code> permission. By default, the permission is set while generating the public key.</span> <span>Type in <code class="literal">ls -l</code></span><span><code class="literal">~/.ssh</code> and hit the <span class="emphasis"><em>Enter</em></span> key to verify the permission. </span><span>We can see that a file called <code class="literal">id_rsa (private key</code></span><span> and a file called</span><span><code class="literal">id_rsa.pub (public key)</code> are listed. </span><span>Let's view the public key's content with the <code class="literal">cat</code> command.</span><span>Type in <code class="literal">cat ~/.ssh /id_rsa.pub</code></span><span> and hit the <span class="emphasis"><em>Enter</em></span> key.</span></p><p>Now, create a <code class="literal">.ssh</code> folder at the user's home directory of the <span>Windows</span><a id="id326071499" class="indexterm"></a> machine and copy the public key to the <code class="literal">.ssh</code> folder using the WinSCP tool. After doing this, run the <code class="literal">cat</code> command to append it to the <code class="literal">authorized_key</code> file. Next, you will see that the Windows machine is ready to establish the connection with a key, that is, is without asking for a password.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec401"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Refer to the previous recipe's <span class="emphasis"><em>How it works...</em></span> section to get more details of the SSH internals. </li></ul></div></div></div>