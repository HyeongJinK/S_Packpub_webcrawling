<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch13lvl1sec142"></a>Tracing errors</h2></div></div><hr /></div><p>Sometimes, errors or <span>unexpected</span><a id="id326634398" class="indexterm"></a> outputs are evasive. This situation can get complicated when the script is long.</p><p>Identify and trace the issue in the following script:</p><pre class="programlisting">function Set-Name {
    $Name = @()
    $Name = Read-Host "Enter first name"
    $Name += Read-Host "Enter middle name (press Enter for blank)"
    $Name += Read-Host "Enter surname"

    $Count = $Name.Count
    $Converter = (Get-Culture).TextInfo

    switch ($Count) {
        2 { 
            "$($Converter.ToTitleCase($Name[1])), $($Converter.ToTitleCase($Name[0]))"
        }
        3 {
            "$($Converter.ToTitleCase($Name[2])), $($Converter.ToTitleCase($Name[0])) $($Converter.ToTitleCase($Name[1]))"
        }
        Default {
            Write-Host "Invalid input."
        }
    }
}
Set-Name</pre><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec362"></a>How to do it…</h3></div></div></div><p>First of all, we will check whether there was an issue in this script in the first place.</p><p>The intention of this function is to get the first name, the middle name, and the surname. Next, it looks at how many strings have been input. If there are two, the name is displayed as <code class="literal">Surname</code>, <code class="literal">FirstName</code>; if there are three, the name is displayed as <code class="literal">Surname</code>, <code class="literal">FirstName</code>, <code class="literal">MiddleName</code>. However, in the case of this script, no matter how many inputs you give, the output is <code class="literal">Invalid input</code>. Follow these steps to get started:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Enter Debug mode with trace by using the <code class="literal">Trace</code> parameter. Enter <code class="literal">1</code> or <code class="literal">2</code> as the value for Trace.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Run the script and call the function.</li><li>Enter the first name and the surname.</li><li>Observe the output. Note how the execution enters the <code class="literal">Default</code> block.</li><li>Exit Debug mode and set a breakpoint at line 10:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Set-PSBreakpoint -Script ./ch13/03-Set-Name.ps1 -Line 10</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Run the script and call the function.</li><li>Enter the values as before.</li><li>At the <code class="literal">DBG</code> prompt, call <code class="literal">$Count</code> to see what its value is.</li><li>Check the assignments and fix the issue (see line 3 of the script).</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec363"></a>How it works…</h3></div></div></div><p>The <code class="literal">Trace</code> parameter helps trace the error. By default, the trace level is <code class="literal">0</code>. Therefore, no trace output is shown. When the trace level is set to <code class="literal">1</code>, it only shows each of the lines that were run; when set to <code class="literal">2</code>, the debug information is more verbose: PowerShell tells you what it is doing at each step.</p><p>At step 4, we can see that the issue seems to be with what was within <code class="literal">$Name</code>. Therefore, we set a breakpoint at line 10. (In fact, setting the breakpoint at 8 also would have worked.) The execution pauses at the breakpoint, and, at this point, you can look at the value of <code class="literal">$Count</code> by simply calling it. Tracing back to what <span>could</span><a id="id325892145" class="indexterm"></a> have caused this wrong count, we arrive at line 3, where we can see that the type of <code class="literal">$Name</code> was changed from an array to a string because of a wrong assignment operator.</p><p>The <code class="literal">Set-PsDebug</code> cmdlet, along with the <code class="literal">Trace</code> parameter, lets you go line by line and shows you the flow of the script. Combined with the breakpoint feature, this helps you find issues with scripts more quickly.</p></div></div>