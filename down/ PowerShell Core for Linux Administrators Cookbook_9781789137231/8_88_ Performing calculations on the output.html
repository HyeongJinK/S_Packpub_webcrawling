<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec90"></a>Performing calculations on the output</h2></div></div><hr /></div><p>In the previous recipe, we <span>performed</span><a id="id325877550" class="indexterm"></a> some nifty calculations on the objects themselves, and listed out files that were 30 days old. In the process, we also output the total amount of space to be cleared. In this recipe, we will output this information as a PowerShell object, and also perform a small calculation during output.</p><p>Here is the scenario. Modify the script you created in the <span class="emphasis"><em>Performing arithmetic operations</em></span> recipe to output a structured <code class="literal">PSCustomObject</code>. The output should have the total number of files in the directory, files that are 30 days old, and the total amount of space cleared (without any calculations). Also, separately, show the amount of space cleared by the cleanup, in MB.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec238"></a>Getting ready</h3></div></div></div><p>Run the <code class="literal">Initialize-PacktPs6CoreLinuxLab.ps1</code> script from within the <code class="literal">ch04</code> directory of the book’s GitHub repository. This is just so we have some files to work on. Next, run the script, <code class="literal">01-Set-LastWriteTime.ps1</code>, from within the <code class="literal">ch08</code> directory of the repository.</p><p> </p><p> </p><p>If you would like to specify a path other than <code class="literal">~/random</code> for the content, add <code class="literal">-Path '//your/custom/path'</code> to the last line of <code class="literal">01-Set-LastWriteTime.ps1</code> as well as <code class="literal">Initialize-PacktPs6CoreLinuxLab.ps1</code>:</p><pre class="programlisting">PS&gt; # Last line of file: Initialize-PacktPs6CoreLinuxLab.ps1
PS&gt; Initialize-PacktPs6CoreLinuxLab -Path ./path/of/your/choice/</pre><pre class="programlisting">PS&gt; # Last line of file: 01-Set-LastWriteTime.ps1
PS&gt; Set-LastWriteTime -Path ./path/of/your/choice/</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec239"></a>How to do it</h3></div></div></div><p>We will simply build on the previous recipe to save ourselves some time and effort. The changes from the script in the previous recipe have been emboldened:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open your favorite code editor, enter the following in the file, and save the file as a <code class="literal">ps1</code> file:</li></ol></div><pre class="programlisting"># Change this to match ./path/of/your/choice/ from the aforementioned scripts
$LabPath = "$HOME/random"

$Today = Get-Date
$TotalFileSize = 0

<span class="strong"><strong>$AllFiles = Get-ChildItem $LabPath -Recurse -File</strong></span>
$FilesToDelete = $AllFiles | Where-Object {[math]::Floor(($Today - $_.LastWriteTime).TotalDays) -eq 30}


Write-Host "The following files will be deleted:"
Write-Host $FilesToDelete.FullName

foreach ($File in $FilesToDelete) {
    $TotalFileSize += $File.Length
    Remove-Item -Path $File -WhatIf
}

<span class="strong"><strong>New-Object -TypeName psobject -Property @{
    TotalFiles = $AllFiles.Count
    FilesToDelete = $FilesToDelete.Count
    SpaceCleared = $TotalFileSize
}</strong></span></pre><p> </p><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Call the PowerShell script:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; &amp; ./ch08/02-Clear-LogFiles.ps1</strong></span></pre><p>This produces the following output:</p><div class="mediaobject"><img src="/graphics/9781789137231/graphics/ecc80ce1-08ae-463d-8e5e-2a8d9f24846f.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Now, pick just the <code class="literal">SpaceCleared</code> parameter:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; (&amp; $HOME/Documents/code/github/powershell/ch08/02-Clear-LogFiles.ps1).SpaceCleared</strong></span></pre><p>Note the reference to the <code class="literal">SpaceCleared</code> property, and the output just before the prompt:</p><div class="mediaobject"><img src="/graphics/9781789137231/graphics/13e833de-300b-4c4e-9e48-7fa086bc4ce9.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Divide the output by 1,024<sup>2</sup> to get the value in MB:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; (&amp; $HOME/Documents/code/github/powershell/ch08/02-Clear-LogFiles.ps1).SpaceCleared/[math]::Pow(1024, 2)</strong></span></pre><p>Similar to the preceding output, the total space cleared in MB is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789137231/graphics/1bf91a62-3ca1-46ff-80df-6431ee6fba82.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec240"></a>How it works…</h3></div></div></div><p>Not only cmdlets and functions, but scripts also <span>output</span><a id="id325898665" class="indexterm"></a> objects. In the previous recipe, this was a string object; in this, it was a <code class="literal">PSCustomObject</code>. This way, even though the information gathered from both the recipes was the same, we were able to process the output further by running calculations on the fly.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec241"></a>There's more…</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Perform a <code class="literal">Round()</code> operation on <code class="literal">SpaceCleared</code> to get the output in MB, with two digits after the decimal point.</li><li>Show the number of files that were omitted from deletion.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip60"></a>Note</h3><p>Assign the output object of the script to a variable, <code class="literal">$FileCleanupInfo = (&amp; //path/to/02-Clear-LogFiles.ps1)</code>, in order to make things easier.</p></div></div></div>