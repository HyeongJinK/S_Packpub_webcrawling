<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch17lvl1sec191"></a>Working with a container using miscellaneous Docker PowerShell cmdlets</h2></div></div><hr /></div><p>In this recipe, we will walk through some of the <span>other</span><a id="id325885498" class="indexterm"></a> cmdlets that are in use or in the development stage at the time of writing this chapter.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec511"></a>How to do it…</h3></div></div></div><p>To understand the process of building a Docker image using the PowerShell cmdlets, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a container image from an existing repository or remote registry:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; New-Container microsoft/powershell -Name packtpub -Terminal pwsh</strong></span>

ID Image Command Created Status Names
-- ----- ------- ------- ------ -----
a4e5c8f1f30c201d9... microsoft/po... pwsh 6/5/18 6:44:08 PM Created packpu..</pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Start the newly created container, <code class="literal">packtpubdemo</code>:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Start-Container packtpubdemo</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Check the status of the newly started container:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS /home/PacktPub/Docker&gt; Get-Container packpubtdemo</strong></span>

ID Image Command Created Status Names
-- ----- ------- ------- ------ -----
a4e5c8f1f30c201d9... microsoft/po... pwsh 6/5/18 6:44:08 PM Up 8 seconds packpu...</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Get the metadata of the newly started container:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-ContainerDetail packtpubdemo</strong></span>

ID : a4e5c8f1f30c201d9ab3b16b319e9b161bc7f09d2f0423fa26235e6ec920041a
Created : 6/5/18 6:52:18 PM
Path : pwsh
Args : {}
State : Docker.DotNet.Models.ContainerState
Image : sha256:708fb186511e482523afd0f087a2ab656b7abf2512815eb8e4d765d642376a8a
ResolvConfPath : /var/lib/docker/containers/a4e5c8f1f30c201d9ab3b16b319e9b161bc7f09d2f0423fa26235e6ec920041a/resolv.conf
HostnamePath : /var/lib/docker/containers/a4e5c8f1f30c201d9ab3b16b319e9b161bc7f09d2f0423fa26235e6ec920041a/hostname
HostsPath : /var/lib/docker/containers/a4e5c8f1f30c201d9ab3b16b319e9b161bc7f09d2f0423fa26235e6ec920041a/hosts
LogPath : /var/lib/docker/containers/a4e5c8f1f30c201d9ab3b16b319e9b161bc7f09d2f0423fa26235e6ec920041a/a4e5c8f1f30c201d9ab3b16b319e9b161bc7f09d2f0423fa26235e6ec920041a-json.log
Node : 
Name : /packtpubdemo
RestartCount : 0
Driver : overlay2
MountLabel : 
ProcessLabel : 
AppArmorProfile : 
ExecIDs : {b3cc995121ba8a7ea8dd9f885a528c9ac656e2d6461bcc90fc54d1841c123524, 
                  5499dbf5ae28757361cfddc51f2646ec7b48a3f5ea3dd04b26453169b7b3cee2}
HostConfig : Docker.DotNet.Models.HostConfig
GraphDriver : Docker.DotNet.Models.GraphDriverData
SizeRw : 0
SizeRootFs : 0
Mounts : {}
Config : Docker.DotNet.Models.Config
NetworkSettings : Docker.DotNet.Models.NetworkSettings</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>To view the details of the network and driver connecting the host machine and containers, use the <code class="literal">Get-ContainerNet</code> cmdlet:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-ContainerNet</strong></span>

Id Name Driver
-- ---- ------
d4c71941fc31... bridge bridge
fdf8108f964d... none null
5619c84bc7b8... host host</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, commit the container's changes into a new container image:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Commit-Container a4e5</strong></span>

RepoTags ID Created
-------- -- ------- 
&lt;none&gt;:&lt;none&gt; sha256:f4ff9aaffd... 5/14/18 8:20:0...</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Tag or label the newly created Docker image:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Tag-ContainerImage f4ff9a packpubposh </strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Save the container image locally using <code class="literal">Save-ContainerImage</code>:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS /home/PacktPub/Docker&gt; Save-ContainerImage packtpubposh -DestinationFilePath /tmp/Docker/packtpubposh.tar </strong></span>
<span class="strong"><strong>PS /home/PacktPub/Docker&gt; ls -l /tmp/Docker/packtpubposh.tar</strong></span>
-rw-r--r--. 1 root root 324026368 Jun 5 15:26 /tmp/Docker/packtpubposh.tar</pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Use <code class="literal">Import-ContainerImage</code> to create an image on the filesystem:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Import-ContainerImage -FilePath /tmp/Docker/packtpubposh.tar</strong></span>
Loaded image: packtpubposh:latest

RepoTags ID Created Size(MB)
-------- -- ------- --------
packtpubposh:latest sha256:d3a81499d6... 6/5/18 7:23:30 PM 303.36</pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Now, copy the files/folder between the container and host machine by using the <code class="literal">Copy-ContainerFile</code> cmdlet:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Copy-ContainerFile -Path ./myfile.txt -Destination /tmp/ -ToContainer packpubdemo</strong></span>
<span class="strong"><strong>PS&gt; docker exec -it packpubdemo bash </strong></span>
<span class="strong"><strong>root@cdf58d38145f:/# ls /tmp/myfile.txt -l</strong></span>
-rw-r--r--. 1 root root 45 jun 05 17:59 /tmp/myfile.txt
root@cdf58d38145f:/#</pre><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Open a session with the running container by using the <code class="literal">Exec-Container</code> cmdlet:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Exec-Container -Id d5a -Terminal bash</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec512"></a>How it works…</h3></div></div></div><p>In this recipe, we performed a series of activities on a container to demonstrate the use of all of the miscellaneous Docker cmdlets. This recipe is pretty self-explanatory; each of the actions is specified in the steps. Here is a rundown of the cmdlets we used in this recipe.</p><p>The <code class="literal">Get-ContainerDetail</code> cmdlet provides detailed information about the metadata and constructs controlled by Docker. The <code class="literal">Commit-Container</code> cmdlet commits the container's changes or settings into a new container image. (In general, though, it is recommended that you use the Dockerfile to manage the docker images.) The <code class="literal">Tag-ContainerImage</code> cmdlet is used to create a label or a unique identifier for the Docker container image. The <code class="literal">Save-ContainerImage</code> cmdlet generates a tarred repository to the standard output stream which contains all of the parent layers, tags, and versions. The <code class="literal">Import-ContainerImage</code> cmdlet is used to import the contents from a tarball to create a filesystem image. If you specify an individual file, you must specify the full path within the host.</p><p>To get network details, use the <code class="literal">Get-ContainerNet</code> cmdlet. The <code class="literal">Exec-Container</code> cmdlet will run the command mentioned in the parameters on the container. In this case, the <code class="literal">bash</code><span>command</span><a id="id326185245" class="indexterm"></a> is invoked while running a <code class="literal">packtpubdemo</code> container. Copying of files between the containers and host machine can also be done. The <code class="literal">Copy-ContainerFile</code> cmdlet will <span>copy</span><a id="id326185260" class="indexterm"></a> files and directories between a container and the host machine filesystems.</p><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec513"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">A developmental build and <span>PowerShell</span><a id="id326185285" class="indexterm"></a> module for Docker engine reference (<a class="ulink" href="https://www.diycode.cc/projects/Microsoft/Docker-PowerShell" target="_blank">https://www.diycode.cc/projects/Microsoft/Docker-PowerShell</a>).</li><li style="list-style-type: disc">To create a file system image, refer to the tarball reference guide (<a class="ulink" href="https://docs.docker.com/engine/reference/commandline/import/" target="_blank">https://docs.docker.com/engine/reference/commandline/import/</a>).</li></ul></div></div></div>