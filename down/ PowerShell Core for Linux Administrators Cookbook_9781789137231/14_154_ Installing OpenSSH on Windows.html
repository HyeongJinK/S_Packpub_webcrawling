<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch14lvl1sec150"></a>Installing OpenSSH on Windows</h2></div></div><hr /></div><p>As we mentioned earlier, Windows doesn't bundle <span>with</span><a id="id326634912" class="indexterm"></a> an SSH software component, so you'll need to download the SSH software piece. One of the most popular among many SSH software providers is PuTTY, and it stands as first choice for many administrators. It's easy to download, and you can <span>find</span><a id="id325885497" class="indexterm"></a> a download link at <a class="ulink" href="http://www.putty.org" target="_blank">http://www.putty.org</a>. The installation is a simple copy of the executable from the <code class="literal">Downloads</code> folder. Paste it under the <code class="literal">C:\Program Files (x86)</code> folder. Now, SSH is available for both Linux and Windows platforms. It is that easy to set up SSH on Windows. In these recipes, we'll look at how to configure SSH on a Windows host.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec377"></a>Getting ready</h3></div></div></div><p>The SSH software component needs to be installed on all target machines. Let's install the SSH client (<code class="literal">ssh.exe</code>) and SSH server (<code class="literal">sshd.exe</code>) software pieces so that you can experiment with PowerShell remoting to and from the targeted machines.</p><p>The <code class="literal">New-PSSession</code>, <code class="literal">Enter-PSSession</code>, and <code class="literal">Invoke-Command</code> cmdlets now have the new parameter sets <code class="literal">HostName</code> and <code class="literal">UserName</code> to facilitate PowerShell remoting.</p><p> </p><p>The following prerequisite needs to be met before you proceed with the OpenSSH installation and configuration on Windows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">You must have PowerShell 6.1 installed on a Windows machine</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec378"></a>How to do it…</h3></div></div></div><p>For Windows, follow these steps to configure SSH for PowerShell remoting:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Based on the OS type, download the latest <span>OpenSSH</span><a id="id326634825" class="indexterm"></a> build (<a class="ulink" href="https://github.com/PowerShell/Win32-OpenSSH/releases" target="_blank">https://github.com/PowerShell/Win32-OpenSSH/releases</a>).</li><li>In this case, it is 64-bit, so the <code class="literal">OpenSSH-Win64.zip</code> file is downloaded.</li><li>Extract the files to <code class="literal">C:\Program Files\</code>.</li><li>Now, the files are saved under <code class="literal">C:\</code><code class="literal">Program Files\OpenSSH-Win64</code>. Rename the folder to OpenSSH.</li><li>Open the PowerShell console with an elevated permission and then run the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; powershell.exe -ExecutionPolicy Bypass -File "C:\Program Files\OpenSSH\install-sshd.ps1"</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Next, add the OpenSSH path to the environment variable:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; $ENV:Path+=";C:\Program Files\OpenSSH;"</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>To make the changes permanent, edit the registry entry, like so:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Set-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH -Value $env:Path</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Next, start the OpenSSH services:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Get-Service ssh*</strong></span>
<span class="strong"><strong>PS&gt; Start-Service ssh*</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Open the firewall to allow inbound SSH connections. If you're on Windows 10, or Windows 2008 R2 or below, run the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>c:\&gt; netshadvfirewall firewall add rule name=sshd dir=in action=allow protocol=TCP localport=22</strong></span></pre><p>To open SSH for Windows 2012 servers and above, run the following command:</p><pre class="programlisting"><span class="strong"><strong>PS&gt; New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Restart the <code class="literal">sshd</code> service:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Restart-Service ssh*</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Repeat the preceding steps for all Windows machines.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec379"></a>How it works…</h3></div></div></div><p><span>The SSH protocol is not native to the Windows operating system.</span><span>It doesn't bundle with Windows components.</span><span> RDP-, WinRM-, or PowerShell-native components are used to connect to </span><span>remote Windows servers. and that's always been the case.</span><span> </span>But if you really need an SSH server running <span>on a Windows machine, then PowerShell Open SSH is the option for you.</span></p><p>PowerShell <span>OpenSSH</span><a id="id326071468" class="indexterm"></a> remoting lets you do basic PowerShell session remoting from Windows to Windows, Windows to Linux, Linux to Windows, and Linux to Linux. This is done by creating a PowerShell hosting process on the target machine as an SSH subsystem. </p><p>As you will notice, the process differs significantly from enabling remoting for WinRM. One big difference is that you no longer need the <code class="literal">Enable-PSremoting</code> cmdlet.</p><p>If you configure a default shell, ensure that the OpenSSH installation path is in the system <code class="literal">PATH</code>. If not already present, amend the system <code class="literal">PATH</code> and restart the <code class="literal">sshd</code> service. SCP and SFTP have been tested to work with PowerShell. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec380"></a>There's more…</h3></div></div></div><p>To uninstall OpenSSH, start PowerShell as an administrator and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Browse to the OpenSSH directory:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; cd 'C:\Program Files\OpenSSH'</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Run the uninstall script:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; powershell.exe -ExecutionPolicy Bypass -File uninstall-sshd.ps1</strong></span></pre><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec381"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Refer to Comparison of <span>SSH</span><a id="id326185289" class="indexterm"></a> Servers article (<a class="ulink" href="https://en.wikipedia.org/wiki/Comparison_of_SSH_servers" target="_blank">https://en.wikipedia.org/wiki/Comparison_of_SSH_servers</a>) for more information</li><li style="list-style-type: disc">Refer to the installation and procedure document to install PowerShell Core on Windows (<a class="ulink" href="https://docs.microsoft.com/en-us/powershell/scripting/setup/installing-powershell-core-on-windows?view=powershell-6" target="_blank">https://docs.microsoft.com/en-us/powershell/scripting/setup/installing-powershell-core-on-windows?view=powershell-6</a>).</li></ul></div></div></div>