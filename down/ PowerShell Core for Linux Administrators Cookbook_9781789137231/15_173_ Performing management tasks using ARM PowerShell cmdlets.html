<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch15lvl1sec168"></a>Performing management tasks using ARM PowerShell cmdlets</h2></div></div><hr /></div><p>In this recipe, we will walk through the <span>management</span><a id="id325898628" class="indexterm"></a> tasks that will be <span>carried</span><a id="id326291139" class="indexterm"></a> out during the virtual machine's creation life cycle. We will look at tasks such as starting, stopping, and deleting a virtual machine using the Cloud Shell.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch15lvl2sec443"></a>Getting ready</h3></div></div></div><p>Read the <span class="emphasis"><em>Azure Cloud Shell</em></span><span class="emphasis"><em>in action</em></span> recipe and set up the Cloud Shell if you haven't already. Then, follow these steps to get started:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Connect to the Azure Portal (<a class="ulink" href="https://portal.azure.com" target="_blank">https://portal.azure.com</a>).</li><li>Click the PowerShell icon to launch the Cloud Shell.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch15lvl2sec444"></a>How to do it…</h3></div></div></div><p>Run the following commands, one after the other, to perform the required operations on the virtual machine:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To stop a virtual machine, type in the following commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS Azure:&gt; $ResourceGroup = 'packtpub-rg'</strong></span>
<span class="strong"><strong>PS Azure:&gt; $Vm = 'packtpub-ubuntu'</strong></span>
<span class="strong"><strong>PS Azure:&gt; Stop-AzureRmVM -ResourceGroupName $ResourceGroup -Name $Vm -Force</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>You can also navigate the Azure resources using commands such as <code class="literal">cd</code> and <code class="literal">dir</code>, and run the command to stop one or more virtual machines by using <code class="literal">where</code> with conditional logic:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS Azure:&gt;  Get-AzureRmVM | Where-Object {$_.Name -match "ubun"}</strong></span>

ResourceGroupName Name Location VmSize OsType NIC ProvisioningState Zone
----------------- ---- -------- ------ ------ --- ----------------- ----
PACKTPUB-RG packtpub-ubuntu eastus Basic_A1 Linux packtpub-vm-nic Succeeded


<span class="strong"><strong>PS Azure:&gt; Get-AzureRmVM | Where-Object {$_.Name -match "ubun"} | Stop-AzureRmVM</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/c3b9e563-5d81-422b-b872-fffbc4caf049.png" /></div><p></p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>To start the virtual machine with the <code class="literal">Start-AzureRmVM</code> cmdlet, run the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS Azure:&gt; Start-AzureRmVM -ResourceGroupName $ResourceGroup -Name $Vm</strong></span></pre><div class="mediaobject"><img src="/graphics/9781789137231/graphics/34bca12c-0ce3-48ac-ba23-f618c28047ef.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>To delete a resource group with the <code class="literal">Remove-AzureRmResourceGroup</code> cmdlet, run the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS Azure:&gt; $ResourceGroup = 'PACKTPUB-RG'</strong></span>
<span class="strong"><strong>PS Azure:&gt; Remove-AzureRmResourceGroup -Name $ResourceGroup -Force</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch15lvl2sec445"></a>How it works…</h3></div></div></div><p>This recipe is an <span>example</span><a id="id325892275" class="indexterm"></a> of using pipeline and variables. Going by the <span>PowerShell</span><a id="id325892283" class="indexterm"></a> philosophy of using objects throughout, starting, stopping, and removing virtual machines (or any of the Azure resources, for that matter) seems simple using the console.</p></div></div>