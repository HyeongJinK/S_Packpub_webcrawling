<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch14lvl1sec156"></a>Running cmdlets on remote computers</h2></div></div><hr /></div><p>In this recipe, you'll find out <span>how</span><a id="id325909564" class="indexterm"></a> to run the <code class="literal">Get-Process</code> cmdlet on remote machines. It is very important that you know how to learn and explore in PowerShell.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec402"></a>Getting ready</h3></div></div></div><p>Let's take a look at the following example. Let's pretend that you are working with a <code class="literal">Get-Process</code> cmdlet for the first time.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec403"></a>How to do it…</h3></div></div></div><p>Let's discuss how we can create a custom object. To start with, the script requires an input CSV file, and the file contains <strong class="userinput"><code>Server</code></strong> and <strong class="userinput"><code>User</code></strong> columns. Let's get started and create the content of the input CSV file:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To create an Input file, type in <code class="literal">nano</code>, followed by a filename:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; nano input.csv  </strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li> To view the contents of the <code class="literal">input.csv</code> file, type in <code class="literal">cat</code>, followed by a filename:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; cat ./input.csv</strong></span>
Server,user
hfd01,ssh-test
10.2.6.68,prashant </pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Use SSH to establish a session with the remote machine and run the <code class="literal">Invoke-command</code> cmdlet to execute a script block on the remote session:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; import-csv ./input.csv|%{ </strong></span>
<span class="strong"><strong> Invoke-Command -HostName $_.Server -UserName $_.user -ScriptBlock { Get-Process |`</strong></span>
<span class="strong"><strong> select-object Handles,CPU, `</strong></span>
<span class="strong"><strong> @{name="NPM";Expression={[int]($_.NPM/1024)}},`</strong></span>
<span class="strong"><strong> @{name="PM";Expression={[int]($_.PM/1024)}},`</strong></span>
<span class="strong"><strong> @{name="WS";Expression={[int]($_.WS/1024)}},`</strong></span>
<span class="strong"><strong> @{name="VM";Expression={[int]($_.VM/1MB)}},`</strong></span>
<span class="strong"><strong> Id, ProcessName</strong></span>
<span class="strong"><strong>} </strong></span>
<span class="strong"><strong>}</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec404"></a>How it works…</h3></div></div></div><p>The input CSV file consists of the Windows and Linux machine's server details. The target machine name and intended user details are fetched from the CSV file using the <code class="literal">Import-CSV</code> cmdlet. The <code class="literal">Invoke-Command</code> cmdlet allows you to run commands or script on multiple remote computers. The most interesting fact about PowerShell is the PowerShell remoting management of remote machines. You can see that the script block doesn't feature the computer name parameter, but we are able to run the <span>command</span><a id="id325892149" class="indexterm"></a> on multiple remote machines using the hostname feature.</p></div></div>