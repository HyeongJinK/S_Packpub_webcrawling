<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec89"></a>Performing arithmetic operations</h2></div></div><hr /></div><p>As administrators, we do not often use <span>arithmetic</span><a id="id326290258" class="indexterm"></a> operations, such as the <code class="literal">sin</code>, <code class="literal">cos</code>, <code class="literal">log</code>, and <code class="literal">exp</code> operations. However, it is possible to do all of them on PowerShell, since PowerShell can leverage .NET. In general, we may use these operations as administrators: <code class="literal">Abs</code> (as in absolute), <code class="literal">Ceiling</code>, <code class="literal">Floor</code>, <code class="literal">Round</code>, and <code class="literal">Truncate</code>. In this recipe, we will use three of these methods, based on the scenario we have. Use of the other methods is very similar.</p><p>Here is the scenario. You have an application that creates logs throughout the day. These logs consume a lot of space. You would like to clean up logs that are between 30 and 31 days old. You are not allowed to use a dual condition for comparison.</p><p>Create a function that looks for files that are 30 days old. Your script should also say how much of the log space was cleared, rounded off to the nearest megabyte.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec234"></a>Getting ready</h3></div></div></div><p>Run the <code class="literal">Initialize-PacktPs6CoreLinuxLab.ps1</code> script from within the <code class="literal">ch04</code> directory of the book’s GitHub repository. This is just so we have some files to work on. Next, run the <code class="literal">01-Set-LastWriteTime.ps1</code> script from within the <code class="literal">ch08</code> directory of the repository.</p><p>If you would like to specify a path other than <code class="literal">~/random</code> for the content, add <code class="literal">-Path '//your/custom/path'</code> to the last line of <code class="literal">01-Set-LastWriteTime.ps1</code> as well as <code class="literal">Initialize-PacktPs6CoreLinuxLab.ps1</code>:</p><pre class="programlisting"><span class="strong"><strong>PS&gt; # Last line of file: Initialize-PacktPs6CoreLinuxLab.ps1</strong></span>
<span class="strong"><strong>PS&gt; Initialize-PacktPs6CoreLinuxLab -Path ./path/of/your/choice/</strong></span></pre><pre class="programlisting"><span class="strong"><strong>PS&gt; # Last line of file: 01-Set-LastWriteTime.ps1</strong></span>
<span class="strong"><strong>PS&gt; Set-LastWriteTime -Path ./path/of/your/choice/</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec235"></a>How to do it…</h3></div></div></div><p>Navigate to the directory that contains your lab files, using the <code class="literal">Set-Location</code> cmdlet; here is where all the action happens. If you did not specify a custom <code class="literal">-Path</code> when running the scripts, it should be <code class="literal">~/random</code>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the terminal and, using a code editor (<code class="literal">vi</code>, <code class="literal">nano</code>, or VS Code), create a new file called <code class="literal">01-Clear-LogFiles.ps1</code>. Remember, CamelCase is just a convention.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Enter the following content. I suggest typing it by yourself rather than copying and pasting it:</li></ol></div><pre class="programlisting"># Change this to match ./path/of/your/choice/ from the aforementioned scripts
$LabPath = "$HOME/random"

$Today = Get-Date
$TotalFileSize = 0

$FilesToDelete = Get-ChildItem $LabPath -Recurse -File | Where-Object {[math]::Floor(($Today - $_.LastWriteTime).TotalDays) -eq 30}


Write-Host "The following files will be deleted:"
Write-Host $FilesToDelete.FullName

foreach ($File in $FilesToDelete) {
    $TotalFileSize += $File.Length
    Remove-Item -Path $File -WhatIf
}

Write-Host "Total space cleared: $([math]::Round($TotalFileSize/[math]::Pow(1024, 2))) MB"</pre><p>There is no need to actually delete the files. If you <span>would</span><a id="id325901961" class="indexterm"></a> like to anyway, remove the <code class="literal">-WhatIf</code> switch from line 12.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip59"></a>Note</h3><p>It is recommended to use Visual Studio Code to write this script since its IntelliSense autocompletion is very helpful. You could write this script at the terminal itself, in which case, use shorter versions of parameters and tab-completions as necessary.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec236"></a>How it works…</h3></div></div></div><p>The <code class="literal">[math]::</code> accelerator allows us to use the methods of the <code class="literal">System.Math</code> class. The <code class="literal">Round()</code> method accepts one or two arguments; in the case of a single argument, the rounding happens to the nearest integer. The optional second parameter specifies the number of digits after the decimal point.</p><p>The <code class="literal">Pow()</code> method is almost self-explanatory: 1024<sup>2</sup>, in our case. The <code class="literal">Floor()</code> method brought down numbers from 30.00 to less than 31.00, down to 30.</p><p> </p><p>This is what we did:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>We listed out the files to delete: we subtracted the <code class="literal">LastWriteTime</code> from today, and performed a <code class="literal">Floor()</code> operation on it since we were not allowed to use the <code class="literal">-and</code> operator</li><li>We displayed the files</li><li>We performed a <span>remove</span> operation on each of the files, while also adding the size of each of the files to <code class="literal">$TotalFileSize</code></li><li>Finally, we divided <code class="literal">$TotalFileSize</code> by 1024<sup>2</sup> and rounded it off to the nearest MB</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec237"></a>See also</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><code class="literal">System.Math</code><span>Methods</span><a id="id325906046" class="indexterm"></a> (Microsoft documentation: <a class="ulink" href="https://docs.microsoft.com/en-us/dotnet/api/system.math?redirectedfrom=MSDN&amp;view=netframework-4.7.2#methods" target="_blank">https://docs.microsoft.com/en-us/dotnet/api/system.math?redirectedfrom=MSDN&amp;view=netframework-4.7.2#methods</a>)</li></ol></div></div></div>