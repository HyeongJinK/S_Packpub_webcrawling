<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch16lvl1sec179"></a>Creating a repository for Get-Process in the SQL database</h2></div></div><hr /></div><p>In the real world, administrators store system <span>metrics</span><a id="id325892166" class="indexterm"></a> at regular intervals, since they are crucial for forensic reporting and troubleshooting. In this recipe, we'll discuss how to store the output of a cmdlet in a table.</p><p> </p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch16lvl2sec476"></a>Getting ready</h3></div></div></div><p>Let's complete the following configuration to load the data into the table via the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Install the <code class="literal">SqlServer</code> module</li><li>Prepare the script using Visual Studio Code or nano, or any other available editors</li><li>Save the script by changing the instance and credential details</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch16lvl2sec477"></a>How to do it…</h3></div></div></div><p>In this recipe, we will discuss the ways we can store the cmdlet data in the repository:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import the <code class="literal">SqlServer</code> module. This module provides a platform to run and operate system-related cmdlets and stores the output directly in the database objects.</li><li>Define the target instance to the repository.</li><li>Specify the credentials to connect to the SQL instance.</li><li>Convert the plain password text into a <code class="literal">SecureString</code> type.</li><li>Build the secured connecting string using the <code class="literal">System.Management.Automation.PSCredential</code> assembly.</li><li>Use the pipe to pass the <code class="literal">Get-Process</code> cmdlet output as an object to the <code class="literal">Write-SqlTableData</code> cmdlet. The following script takes care of the aforementioned tasks. </li><li>Now, save the following content in the <code class="literal">DataLoading.PS1</code> file:</li></ol></div><pre class="programlisting">#Import the SqlServer Module
Import-Module -Name Sqlserver
#The Linux SQL Instance IP Address
$SQLServer='10.2.6.50'                                                    
#Define credential details
$User='SA'
#Convert password text to a secure string
$Pass=ConvertTo-SecureString 'thanVitha@2015' -AsPlainText -Force
#Build the credetial using securing string
$cred=New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $User,$Pass
(Get-Process | Select-Object -Property `    Id,ProcessName,StartTime,UserProcessorTime,WorkingSet,Description) | `
Write-SqlTableData -Credential $cred -ServerInstance "localhost" -DatabaseName `
"PacktPub" -SchemaName "dbo" -TableName "TaskManagerDump" -Force


</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch16lvl2sec478"></a>How it works...</h3></div></div></div><p>This recipe gathers information about processes that run on a remote machine and writes it to a table. <code class="literal">Write-SqlTableData</code> writes the data into <code class="literal">PacktPub.dbo.TaskManagerDump</code> on a local instance of the Linux machine. In this case, <code class="literal">PacktPub</code> is the database name and <code class="literal">TaskManagerDump</code> is the name of the table.</p><p>On specifying the <code class="literal">force</code> parameter, it checks for the existence of the <code class="literal">TaskManagerDump</code> table on the <code class="literal">PacktPub</code> database. In the case of its absence, the table will be created.</p><p>The following script is executed to pull the data into the table:</p><pre class="programlisting"><span class="strong"><strong>$ /usr/bin/pwsh -c  'cd /tmp;./DataLoading.PS1'</strong></span></pre><p>The same script can also be run on any tool, such as <span>Azure</span><a id="id325892299" class="indexterm"></a> Data Studio. </p></div></div>