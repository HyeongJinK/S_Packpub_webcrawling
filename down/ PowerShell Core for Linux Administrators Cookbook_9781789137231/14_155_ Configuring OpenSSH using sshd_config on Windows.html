<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch14lvl1sec151"></a>Configuring OpenSSH using sshd_config on Windows</h2></div></div><hr /></div><p>In this recipe, we will discuss the <span>OpenSSH</span><a id="id325905993" class="indexterm"></a> system-wide configuration file <code class="literal">sshd_config</code> for Windows. It allows us to set options at the server so that <span>configuration</span><a id="id325905986" class="indexterm"></a> parameters control the operation of the client programs. Let's list the required OpenSSH parameters so that you can configure your OpenSSH. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note81"></a>Note</h3><p>On Windows, the <code class="literal">sshd_config</code> file is at the location where you installed OpenSSH. On Linux, it's at <code class="literal">/etc/ssh/sshd_config</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec382"></a>Getting ready</h3></div></div></div><p>To edit the <code class="literal">ssh_config</code> file, go to the <code class="literal">/ssh/sshd_config.</code> log. Locate the file with elevated permission so that you can edit the file.</p><p>On Windows, locate the <code class="literal">cmd.exe</code> executable, right-click it, and select <strong class="userinput"><code>Run as Administrator</code></strong> to edit the <code class="literal">ssh_config</code> file.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec383"></a>How to do it…</h3></div></div></div><p>Let's look at how we can change the required parameters in the <code class="literal">ssh_config</code> file by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, navigate to the location where you installed OpenSSH: <code class="literal">%PROGRAMDATA%\ssh</code>.</li><li>Open the <code class="literal">sshd_config</code> file in Notepad or TextPad or any other available editors.</li><li>Enable <code class="literal">PasswordAuthentication</code>:</li></ol></div><pre class="programlisting">PasswordAuthentication yes</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Enable the optional <code class="literal">PubKeyAuthentication</code>:</li></ol></div><pre class="programlisting">PubKeyAuthentication yes</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Add the following PowerShell Subsystem entry:</li></ol></div><pre class="programlisting">Subsystempowershellc:/program files/powershell/6.1.0-preview.1/pwsh.exe -sshs -NoLogo -NoProfile

</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note82"></a>Note</h3><p>For interoperability reasons, in the actual path, <code class="literal">C:\Program Files\powershell\6.1.0-preview.1\</code> is changed to <code class="literal">C:/Program Files/powershell/6.1.0-preview.1/</code>. The backslash <code class="literal">\</code> is changed to a forward slash <code class="literal">/</code>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Restart the sshd service:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; Restart-Service ssh*</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec384"></a>How it works…</h3></div></div></div><p>Let's take a look at a few of the configuration parameters in the SSH server configuration file. Of course, it's not possible to cover them all here, but I'll highlight a few common ones that are used and tested to configure OpenSSH. The SSH Server configuration is <code class="literal">/</code><code class="literal">etc</code><code class="literal">/ssh/sshd_config</code>. Let's open <code class="literal">vi /etc/ssh/sshd_config</code><span class="emphasis"><em>, </em></span>SSH daemon the configuration file, and scroll down a little bit. The first thing you'll see is Port 22. It's commented out, so if you uncomment this by removing the pound sign, you can change the port that the server listens on.</p><p> </p><p> </p><p>You notice that all of the lines that start <span>with</span><a id="id325892273" class="indexterm"></a> a hash are comments and defaults. A <span>configuration</span><a id="id325892281" class="indexterm"></a> item is a combination of key-value pairs. The commented lines with key-value pairs are usually the defaults. For instance, look at the Port 22—this line is commented because the default port it listens to is 22. If you want to change the SSH Server Port, uncomment it by removing the <code class="literal">#</code> and edit value. Also, note that you should leave the message as part of a good practice. Let's leave the default value now. Moving on to the authentication section, you can change the grace time for the login, and if you change <code class="literal">PermitRootLogin</code> to be uncommented and change the value to <code class="literal">no</code>, the root won't be able to log in. This is a good security practice to observe. Continue scrolling down; there's an option that says <code class="literal">PasswordAuthentication</code>. Uncomment this line and change the value to <code class="literal">Yes</code>. If it's set to <code class="literal">No</code>, the user won't be able to log in with a password—they'll need to use a key. Let's discuss this in the upcoming recipe.</p><p>I'll continue scrolling past some of the more advanced options. Down toward the bottom is an option called <code class="literal">Banner</code>. If you uncomment that and change the value of none to a path or a text file, you can display some text when a user logs in.</p><p>Next, add the <code class="literal">pwsh.exe</code> file to the <code class="literal">Subsystems</code> section. The subsystems are the layers of abstraction or a set of predefined instructions in the configuration file that are used for the successful invocation of remote commands from the client machines. A subsystem entry allows you to invoke the PowerShell console as a daemon process. </p><p>If you make any changes to this file, you will need to restart the SSH server in order for those changes to take effect. You can do this by writing <code class="literal">service sshd restart</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec385"></a>There's more…</h3></div></div></div><p>To get a complete listing of <code class="literal">sshd_config</code>, type <code class="literal">man sshd_config</code> and hit the <span class="emphasis"><em>Enter</em></span> key<span class="emphasis"><em>.</em></span></p></div></div>