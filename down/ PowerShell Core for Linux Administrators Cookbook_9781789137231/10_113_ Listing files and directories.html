<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec113"></a>Listing files and directories</h2></div></div><hr /></div><p>This chapter would be incomplete without a recipe on working with file lists. We have already seen some of the concepts in our previous recipes. However, for the <span>sake</span><a id="id325905982" class="indexterm"></a> of completeness, we will write a script that lists out <span>files</span><a id="id325905969" class="indexterm"></a> of type <code class="literal">.mp4</code> within our random directory that are more than seven days old and larger than 100 KB. Also, list out the five largest files in the lot.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec299"></a>How to do it…</h3></div></div></div><p>Let's pick the location as <code class="literal">$HOME/random</code>. We don't know under what directory these <code class="literal">.mp4</code> files would be. Therefore, do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Perform a recursive listing of files</li><li>Add a parameter, <code class="literal">Name</code>, that lists out only the <code class="literal">.mp4</code> files</li><li>Use the <code class="literal">CreationTime</code> property of the file to determine the age</li><li>Perform a filter based on the size (<code class="literal">Length</code>) of the file</li><li>Use the <code class="literal">Sort-Object</code> and the <code class="literal">Select-Object</code> cmdlets to pick the five largest files</li></ol></div><p> </p><p>Here is the script that would help us with this task:</p><pre class="programlisting">$ThresholdDate = (Get-Date).AddDays(-7)

Get-ChildItem $HOME/random -rec -na *.mp4  | Where-Object { $_.CreationTime -lt $ThresholdDate -and $_.Length -gt 100KB }
# Verbose version: Get-ChildItem $HOME/random -Recurse -Name *.mp4  | Where-Object -FilterScript { $PSItem.CreationTime -lt $ThresholdDate -and $PSItem.Length -gt 100KB }

Get-ChildItem $HOME/random -Recurse | Sort-Object Length -Descending | Select-Object -First 5
# Verbose version: Get-ChildItem -Path $HOME/random -Recurse | Sort-Object -Property Length -Descending | Select-Object -First 5</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip69"></a>Note</h3><p>The path parameter in <code class="literal">Get-ChildItem</code> accepts an array as input. Therefore, you could write <code class="literal">Get-ChildItem $HOME/random, $HOME/random/dir-01</code> to get the contents of the two paths.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec300"></a>How it works…</h3></div></div></div><p>This recipe primarily concentrates on <code class="literal">Get-ChildItem</code> and its parameters. The <code class="literal">Recurse</code> switch parameter recursively lists out all paths within the specified path. The <code class="literal">Name</code> parameter makes PowerShell list out those sub-paths that match the pattern specified.</p><p>The rest in this script is about passing the output object from <code class="literal">Get-ChildItem</code> into different other cmdlets for further processing. We use the <code class="literal">Where-Object</code> cmdlet and a filter script that compares the date of creation of the file and the current date, and then compares the size of the file. We also use the administrative constant (<code class="literal">100KB</code>).</p><p>When picking the five largest files, we first sort the files by size in descending order, and select the first five from the list.</p><p>Again, <code class="literal">Get-ChildItem</code> and <code class="literal">Get-Item</code> do not only work with files and folders; they also work with other objects within the <code class="literal">Env:</code>, <code class="literal">Alias:</code>, <code class="literal">Cert:</code>, <code class="literal">Variable:</code>, and other providers.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec301"></a>There's more…</h3></div></div></div><p>Find out the difference between <code class="literal">Get-Item</code> and <code class="literal">Get-ChildItem</code>.</p></div></div>