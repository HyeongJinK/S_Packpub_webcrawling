<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch17lvl1sec192"></a>Running a PowerShell script to set up Docker containers</h2></div></div><hr /></div><p>Over the last few chapters, we saw how <span>PowerShell</span><a id="id325906066" class="indexterm"></a> scripts are powerful automation solutions. In <span>this</span><a id="id325906057" class="indexterm"></a> recipe, we are going to use a PowerShell script to manage Docker containers.</p><p>In this recipe, three SQL Server docker containers are created and tested within a span of 10–15 minutes. The sample script shows how easy it is to integrate Docker CLI commands with a PowerShell script.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec514"></a>How to do it…</h3></div></div></div><p>To create a PowerShell script, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a PowerShell script file using a code editor:</li></ol></div><pre class="programlisting"><span class="strong"><strong>PS&gt; vim SQLInstance.ps1</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Define an array of elements <code class="literal">[1,2,3]</code> as input for the <code class="literal">Foreach-Object</code> loop cmdlet.</li><li>Prepare the SQL container names (such as PackPubDemo1, PackPubDemo2, and PackPubDemo3) using the concatenation operator <code class="literal">+</code>.</li><li>Assign the container name to a variable named <code class="literal">$Name</code>.</li><li>Integrate the variable with the Docker CLI command to create SQL Server 2017 Docker containers:</li></ol></div><pre class="programlisting">#Define the array of elements [1,2,3] 
1,2,3|foreach-object {
#Build the name of the servers. 
#Its going to be like PackPubDemo1,PackPubDemo2,PackPubDemo3
$name='PackPubDemo'+$_
#print the name of docker containers
write-host $name
try
  {
#integrate the powershell variable with the docker cli command  
docker run -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=PacktPubDemo$2018' --name $name -d microsoft/mssql-server-linux:2017-latest
  }
catch 
  {
#Handle exception
  write-host $_.Exception.Message
  }
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec515"></a>How it works…</h3></div></div></div><p>Run the PowerShell script <code class="literal">SQLInstance.PS1</code> on the <code class="literal">pwsh</code> console. Using the <code class="literal">Foreach-Object</code> looping construct, the name is prepared each time by appending the input value <code class="literal">[1, 2, 3]</code>.</p><p>First, the image is searched for locally. In the case of its absence, the image is pulled from the specified central repository. Subsequent executions refer to the locally downloaded image.</p><p>Using the input values, the <code class="literal">docker run</code> command creates new SQL Server 2017 containers:</p><pre class="programlisting"><span class="strong"><strong>PS&gt; pwsh ./SQLInstance.ps1</strong></span>
PackPubDemo1
Unable to find image 'microsoft/mssql-server-linux:2017-latest' locally
2017-latest: Pulling from microsoft/mssql-server-linux
f6fa9a861b90: Already exists 
da7318603015: Already exists 
6a8bd10c9278: Already exists 
d5a40291440f: Already exists 
bbdd8a83c0f1: Already exists 
3a52205d40a6: Already exists 
6192691706e8: Already exists 
1a658a9035fb: Already exists 
d057e89d8e94: Already exists 
1ed0a0d4098f: Already exists 
Digest: sha256:b5d494d104394b8c1f451406f4062ab711add3032af52241140b7e27a01d8851
Status: Downloaded newer image for microsoft/mssql-server-linux:2017-latest
cd0faef05d5f93c29d9122c0b1583f536058012a79c017fcc3a4a0b20151c323
PackPubDemo2
cdf58d38145f39688270a95b30fda3c601db9406b3c71bd369bd44dd47d177f6
PackPubDemo3
09e7e5beee0f3d08cc7ad20958f6969503ff516f5ee13aa544356100d39722ef
PS&gt; </pre><p>If we run <code class="literal">docker ps -a</code> with the formatting option, we are shown the list of the images; note the names and the time they have been up for:</p><pre class="programlisting"><span class="strong"><strong># docker ps -a --format</strong></span> 'table{{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}' 
NAMES IMAGE STATUS PORTS 
PackPubDemo3 microsoft/mssql-server-linux:2017-latest Up 6 minutes 1433/tcp
PackPubDemo2 microsoft/mssql-server-linux:2017-latest Up 6 minutes 1433/tcp
PackPubDemo1 microsoft/mssql-server-linux:2017-latest Up 6 minutes 1433/tcp</pre></div></div>