<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec29"></a>Request setup and teardown</h2></div></div><hr /></div><p>When your <span class="strong"><strong>WSGI</strong></span> (<span class="strong"><strong>Web Server Gateway Interface</strong></span>) handles a request, Flask creates a request context object that contains all the information about the request itself. This <span>object</span><a id="id325021288" class="indexterm"></a> is pushed into a stack that contains other important information, such as the Flask <code class="literal">app</code> , <code class="literal">g</code>, <code class="literal">session</code>, and flash messages. </p><p>The request object is <span>available</span><a id="id325021308" class="indexterm"></a> to any function, view, or template that is currently processing the request; this happens without the need to pass around the request object itself. <code class="literal">request</code> contains information such as HTTP headers, URI arguments, URL path, WSGI environment, and whatnot. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note20"></a>Note</h3><p>For more detailed information on the Flask request object, see: <a class="ulink" href="http://flask.pocoo.org/docs/api/#incoming-request-data" target="_blank">http://flask.pocoo.org/docs/api/#incoming-request-data</a>.</p></div><p> </p><p>We can easily add more information to the request <span>context</span><a id="id325021345" class="indexterm"></a> by implementing our <span>own</span><a id="id325371895" class="indexterm"></a> hooks on request creation. To achieve this, we can use Flask's decorator function, <code class="literal">@app.before_request</code>, and the <code class="literal">g</code> object. The<code class="literal">@app.before_request</code> function is executed every time, before a new request is made. For example, the following code keeps a global counter for the number of page loads:</p><p> </p><pre class="programlisting">import random
from flask import session, g

@app.before_request
def before_request():
    session['page_loads'] = session.get('page_loads', 0) + 1
    g.random_key = random.randrange(1, 10)</pre><p>Multiple functions can be decorated with <code class="literal">@app.before_request</code>, and they all will be executed before the requested view function is executed. There also exists a decorator, <code class="literal">@app.teardown_request</code>, which is called after the end of every request. </p><p>Initialize the example code provided for this chapter and watch how the data for <code class="literal">g</code>, <code class="literal">session</code>, and <code class="literal">request</code> changes. Also, note the <code class="literal">csrf_token</code> set by WTForm to secure our forms.</p></div>