<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec60"></a>Monitoring Celery</h2></div></div><hr /></div><p>When our code is pushed to the server, our <code class="literal">Celery</code> worker will not be run in the Terminal window—rather, it will be run as a background task. Because of this, Celery <span>provide</span><a id="id325371874" class="indexterm"></a>s many command-line arguments to monitor the status of your <code class="literal">Celery</code> worker and tasks. These commands take the following form:</p><pre class="programlisting"><span class="strong"><strong>$ celery -A celery_runner &lt;command&gt;</strong></span></pre><p>The main tasks to view the status of your workers are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">status</code>: This prints the running workers and if they are up.</li><li style="list-style-type: disc"><code class="literal">result</code>: When passed a task ID, this shows the return value and final status of the task.</li><li style="list-style-type: disc"><code class="literal">purge</code>: Using this, all messages in the broker will be deleted.</li><li style="list-style-type: disc"><code class="literal">inspect active</code>: This lists all active tasks.</li><li style="list-style-type: disc"><code class="literal">inspect scheduled</code>: This lists all tasks that have been scheduled with the <code class="literal">eta</code> argument.</li><li style="list-style-type: disc"><code class="literal">inspect registered</code>: This lists all of the tasks waiting to be processed.</li><li style="list-style-type: disc"><code class="literal">inspect stats</code>: This returns a dictionary full of statics on the currently running workers and the broker.</li></ul></div><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec63"></a>Web-based monitoring with Flower</h3></div></div></div><p><span class="strong"><strong>Flower</strong></span> is a web-based, real-time management tool for Celery. In Flower, all active, queued, and <span>completed</span><a id="id325375204" class="indexterm"></a> tasks can be monitored. Flower also provides graphs and statics on how long each <span>task</span><a id="id325375212" class="indexterm"></a> has been sitting in the queue versus how long its execution took, and the arguments to each of those tasks.</p><p>To install <code class="literal">flower</code>, use the <code class="literal">pip</code> command, as follows:</p><pre class="programlisting"><span class="strong"><strong>$ pip install flower</strong></span></pre><p>To run it, just treat <code class="literal">flower</code> as a Celery command, as follows:</p><pre class="programlisting"><span class="strong"><strong>$ celery flower -A celery_runner --loglevel=info</strong></span></pre><p>Now, open your browser to <code class="literal">http://localhost:5555</code>. It's best to familiarize yourself with the interface while tasks are running, so go to the command line and type the following:</p><pre class="programlisting"><span class="strong"><strong>&gt;&gt;&gt; export FLASK_APP=manage.py
&gt;&gt;&gt; flask shell
&gt;&gt;&gt; from webapp.blog.tasks import *
&gt;&gt;&gt; from celery import chord, group
&gt;&gt;&gt; </strong></span><span class="strong"><strong>sig = chord(</strong></span><span class="strong"><strong> group(multiply.s(i, i+5) for i in xrange(10000)),</strong></span><span class="strong"><strong> log.s()</strong></span><span class="strong"><strong>)</strong></span><span class="strong"><strong>&gt;&gt;&gt; sig.delay()</strong></span></pre><p>Your worker process will now start processing 10,000 tasks. Browse around the different pages while the tasks are running to see how <code class="literal">flower</code> interacts with your worker while it's really churning, as shown here:</p><div class="mediaobject"><img src="/graphics/9781788995405/graphics/f6c58a5e-59ab-4a1d-963d-56fa366a96be.png" /></div><p> </p></div></div>