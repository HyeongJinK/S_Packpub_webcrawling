<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec57"></a>Setting up Celery and RabbitMQ</h2></div></div><hr /></div><p>To install <span>Celery</span><a id="id324991598" class="indexterm"></a> on our <code class="literal">virtualenv</code>, we need to <span>add</span><a id="id324991610" class="indexterm"></a> it to our <code class="literal">requirements.txt</code> file:</p><pre class="programlisting">... 
Celery<span class="strong"><strong>
</strong></span>...</pre><p> </p><p>As always, use the provided <code class="literal">init.sh</code> script, or use the procedure explained here to create and install all dependencies on a Python virtual environment.</p><p>We will also need a Flask extension to help handle the initialization of Celery:</p><pre class="programlisting"><span class="strong"><strong>$ pip install Flask-Celery-Helper</strong></span></pre><p>The Flask documentation states that Flask extensions for Celery are unnecessary. However, getting the Celery server to work with Flask's application context, when your app is organized with an application factory, is <span>significant</span>. So, we will use <code class="literal">Flask-Celery-Helper</code> to do the heavy lifting.</p><p>Next, RabbitMQ needs to be up and running. To do this easily, we will use a Docker container. Make sure you have Docker installed and properly set up; if not, then check out<a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Getting Started</em></span>, for instructions. First, we will need a very simple Dockerfile:</p><pre class="programlisting">FROM rabbitmq:3-management

ENV RABBITMQ_ERLANG_COOKIE "SWQOKODSQALRPCLNMEQG"
ENV RABBITMQ_DEFAULT_USER "rabbitmq"
ENV RABBITMQ_DEFAULT_PASS "rabbitmq"
ENV RABBITMQ_DEFAULT_VHOST "/"</pre><p>This is all it takes to build and run a <span>RabbitMQ</span><a id="id325371637" class="indexterm"></a> Docker image with the management interface. We are using a Docker Hub image that is available for download at <a class="ulink" href="https://hub.docker.com/_/rabbitmq/" target="_blank">https://hub.docker.com/_/rabbitmq/</a>. Visit the Hub page for further configuration details.</p><p>Next, let's build our image issue the following command:</p><pre class="programlisting"><span class="strong"><strong>$ docker build -t blog-rmq .</strong></span></pre><p>The <code class="literal">-t</code> flag is used to tag our image with a friendly name; in this case, <code class="literal">blog-rmq</code>. Then run the newly created image in the background using the following command:</p><pre class="programlisting"><span class="strong"><strong>$ docker run -d -p 15672:15672 -p 5672:5672 blog-rmq</strong></span></pre><p>The <code class="literal">-d</code> flag is to run the container in the background (<span>daemon</span>). The <code class="literal">-p</code> flag is for port mapping between the container and our host/desktop.</p><p>Let's check if it's properly running:</p><pre class="programlisting"><span class="strong"><strong>$ </strong></span><span class="strong"><strong>docker ps</strong></span>
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
6eb2ab1da516 blog-rmq "docker-entrypoint.s…" 13 minutes ago Up 14 minutes 4369/tcp, 5671/tcp, 0.0.0.0:5672-&gt;5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:15672-&gt;15672/tcp xenodochial_kepler</pre><p> </p><p>Let's check out the RabbitMQ management interface. In your browser, navigate to <code class="literal">http://localhost:15672</code> and log in using the configured credentials set up on the Dockerfile. In this case, our username is <code class="literal">rabbitmq</code>, and our password is also <code class="literal">rabbitmq</code>.</p><p>If you need more information, RabbitMQ maintains a detailed list of installation and configuration instructions for each operating system at <a class="ulink" href="https://www.rabbitmq.com/download.html" target="_blank"><span>https://www.rabbitmq.com/download.html</span></a>.</p><p>After <span>RabbitMQ</span><a id="id325378797" class="indexterm"></a> is installed, go to a Terminal window and run the following command:</p><pre class="programlisting"><span class="strong"><strong>$ rabbitmq-server</strong></span></pre></div>