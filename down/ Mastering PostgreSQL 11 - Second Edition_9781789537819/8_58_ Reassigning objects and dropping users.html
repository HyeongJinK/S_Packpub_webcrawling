<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec59"></a>Reassigning objects and dropping users</h2></div></div><hr /></div><p>After assigning permissions and <span>restricting</span><a id="id325664402" class="indexterm"></a> access, it can happen that <span>users</span><a id="id325664393" class="indexterm"></a> will be dropped from the system. Unsurprisingly, the commands to do that are the <code class="literal">DROP ROLE</code> and <code class="literal">DROP USER</code> commands:</p><pre class="programlisting"><span class="strong"><strong>test=# \h DROP ROLE </strong></span><span class="strong"><strong>Command:  DROP ROLE 
Description: remove a database role 
Syntax: 
DROP ROLE  [ IF EXISTS ] name  [, ...]</strong></span></pre><p>Let's give it a try. The following listing shows how that works:</p><pre class="programlisting"><span class="strong"><strong>test=# DROP ROLE joe;</strong></span>
<span class="strong"><strong>ERROR:  role  "joe"  cannot be dropped because some  objects depend on it 
DETAIL:  target of policy joe_pol_3 on table t_person  
target of policy joe_pol_2 on table t_person 
target of policy joe_pol_1 on table t_person  
privileges for table t_person 
owner of table t_user 
owner of sequence t_user_id_seq 
owner of default privileges on new relations belonging to role joe in schema public 
owner of table t_useful</strong></span></pre><p>PostgreSQL will issue error messages because a user can only be removed if everything has been taken away from him. This makes sense for this reason: just suppose somebody owns a table. What should PostgreSQL do with that table? Somebody has to own them.</p><p>To reassign tables from one user to the next, consider taking a look at the <code class="literal">REASSIGN</code> clause:</p><pre class="programlisting"><span class="strong"><strong>test=# \h REASSIGN</strong></span><span class="strong"><strong>Command:  REASSIGN OWNED 
Description: change the ownership of database objects owned by a database role 
Syntax: 
REASSIGN OWNED  BY { old_role | CURRENT_USER | SESSION_USER } [, ...]  
  TO { new_role | CURRENT_USER | SESSION_USER }</strong></span></pre><p>The syntax is again quite simple and helps to simplify the process of handing over. Here is an example:</p><pre class="programlisting"><span class="strong"><strong>test=# REASSIGN OWNED  BY joe TO postgres; </strong></span><span class="strong"><strong>REASSIGN OWNED</strong></span></pre><p>So, let's try to drop the <code class="literal">joe</code> role again:</p><pre class="programlisting"><span class="strong"><strong>test=# DROP ROLE joe; 
ERROR:  role "joe" cannot be dropped because some objects depend on it 
DETAIL:  target of policy joe_pol_3 on table t_person target of policy joe_pol_2 on table t_person 
target of policy joe_pol_1 on table t_person privileges for table t_person 
owner of default privileges on new relations belonging to role joe in schema public </strong></span></pre><p>As we can see, the list of problems has been reduced significantly. What we can do now is resolve all of those problems one after the other and drop the role. There is no shortcut that I am aware of. The only way to make that more efficient is to make sure that as few permissions as possible are assigned to real people. Try to abstract as much as you can into roles, which in turn can be used by many people. If individual permissions are not assigned to real people, things tend to be easier in general.</p></div>