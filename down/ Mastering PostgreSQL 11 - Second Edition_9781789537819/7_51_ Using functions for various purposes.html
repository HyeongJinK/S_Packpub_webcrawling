<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec53"></a>Using functions for various purposes</h2></div></div><hr /></div><p>In PostgreSQL, stored <span>procedures</span><a id="id325664408" class="indexterm"></a> can be used for pretty much everything. In this chapter, you have already learned about the <code class="literal">CREATE DOMAIN</code> clause and so on, but it is also possible to create your own operators, type casts, and even collations.</p><p>In this section, you will see how a simple type cast can be created and how it can be used to your advantage. To define the type cast, consider taking a look at the <code class="literal">CREATE CAST</code> clause. The syntax of the command is shown in the next listing:</p><pre class="programlisting"><span class="strong"><strong>test=# \h CREATE CAST</strong></span>
<span class="strong"><strong>Command: CREATE CAST</strong></span>
<span class="strong"><strong>Description: define a new cast</strong></span>
<span class="strong"><strong>Syntax:</strong></span>
<span class="strong"><strong>CREATE CAST (source_type AS target_type)</strong></span>
<span class="strong"><strong> WITH FUNCTION function_name [ (argument_type [, ...]) ]</strong></span>
<span class="strong"><strong> [ AS ASSIGNMENT | AS IMPLICIT ]</strong></span>

<span class="strong"><strong>CREATE CAST (source_type AS target_type)</strong></span>
<span class="strong"><strong> WITHOUT FUNCTION</strong></span>
<span class="strong"><strong> [ AS ASSIGNMENT | AS IMPLICIT ]</strong></span>

<span class="strong"><strong>CREATE CAST (source_type AS target_type)</strong></span>
<span class="strong"><strong> WITH INOUT</strong></span>
<span class="strong"><strong> [ AS ASSIGNMENT | AS IMPLICIT ]</strong></span></pre><p>Using this stuff is very simple. You simply tell PostgreSQL which procedure it is supposed to call to cast whatever type to your desired data type.</p><p>In standard PostgreSQL, you cannot cast an IP address to a Boolean. Therefore, it makes a good example. First, the stored procedure has to be defined:</p><pre class="programlisting"><span class="strong"><strong>CREATE FUNCTION inet_to_boolean(inet) </strong></span>
<span class="strong"><strong>RETURNS boolean AS </strong></span>
<span class="strong"><strong>$$ </strong></span>
<span class="strong"><strong>        BEGIN </strong></span>
<span class="strong"><strong>                RETURN true; </strong></span>
<span class="strong"><strong>        END; </strong></span>
<span class="strong"><strong>$$ LANGUAGE 'plpgsql';</strong></span></pre><p>For simplicity reasons, it returns <code class="literal">true</code>. However, you can use any code in any language to do the actual transformation.</p><p>In the next step, it is already possible to define the type cast:</p><pre class="programlisting"><span class="strong"><strong>CREATE CAST (inet  AS boolean) 
WITH FUNCTION inet_to_boolean(inet) AS IMPLICIT;</strong></span></pre><p>The first thing is to tell PostgreSQL that we want to cast <code class="literal">inet</code> to <code class="literal">boolean</code>. Then, the function is listed and we tell PostgreSQL that we prefer an implicit cast.</p><p>It is simply a straightforward process and we can test the cast:</p><pre class="programlisting"><span class="strong"><strong>test=# SELECT '192.168.0.34'::inet::boolean; 
 bool 
------  
 t 
(1 row)</strong></span></pre><p> </p><p> </p><p> </p><p> </p><p>Basically, the same logic can also be <span>applied</span><a id="id326158974" class="indexterm"></a> to define collations. Again, a stored procedure can be used to perform whatever has to be done:</p><pre class="programlisting"><span class="strong"><strong>test=# \h CREATE COLLATION </strong></span>
<span class="strong"><strong>Command: CREATE COLLATION</strong></span>
<span class="strong"><strong>Description: define a new collation</strong></span>
<span class="strong"><strong>Syntax:</strong></span>
<span class="strong"><strong>CREATE COLLATION [ IF NOT EXISTS ] name (</strong></span>
<span class="strong"><strong>    [ LOCALE = locale, ]</strong></span>
<span class="strong"><strong>    [ LC_COLLATE = lc_collate, ]</strong></span>
<span class="strong"><strong>    [ LC_CTYPE = lc_ctype, ]</strong></span>
<span class="strong"><strong>    [ PROVIDER = provider, ]</strong></span>
<span class="strong"><strong>    [ VERSION = version ]</strong></span>
<span class="strong"><strong>)</strong></span>
<span class="strong"><strong>CREATE COLLATION [ IF NOT EXISTS ] name FROM existing_collation</strong></span></pre></div>