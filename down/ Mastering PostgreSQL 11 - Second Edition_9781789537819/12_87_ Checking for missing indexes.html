<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch12lvl1sec84"></a>Checking for missing indexes</h2></div></div><hr /></div><p>Once we are done with the first three steps, it is important to take a look at performance in general. As I keep stating throughout this book, missing indexes are super responsible for super bad performance. So, whenever we are facing a slow system, it is recommended that weÂ <span>check</span><a id="id326642072" class="indexterm"></a> for missing indexes and deploy whatever is needed.</p><p>Usually, customers ask us to optimize the <code class="literal">RAID</code> level, tune the kernel, or some other fancy stuff. In reality, these complicated requests often boil down to a handful of missing indexes. By my judgement, it always makes sense to spend some extra time on just checking whether all desired indexes are there. Checking for missing indexes is neither hard nor time-consuming, so it should be done all of the time, regardless of the kind of performance problem you are facing.</p><p>Here is my favorite query to get an impression of where an index might be missing:</p><pre class="programlisting"><span class="strong"><strong>SELECT schemaname, relname, seq_scan, seq_tup_read, </strong></span>
<span class="strong"><strong>           idx_scan, seq_tup_read / seq_scan AS avg </strong></span>
<span class="strong"><strong>FROM   pg_stat_user_tables </strong></span>
<span class="strong"><strong>WHERE  seq_scan &gt; 0 </strong></span>
<span class="strong"><strong>ORDER BY seq_tup_read DESC </strong></span>
<span class="strong"><strong>LIMIT 20;</strong></span></pre><p>Try and find large tables (high <code class="literal">avg</code>) that are scanned often. These tables will typically come on top.</p></div>