<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec69"></a>AsterixDB</h2></div></div><hr /></div><p>AsterixDB was originally <span>conceived</span><a id="id325806819" class="indexterm"></a> at the University of California, Irvine. It is a full-fledged NoSQL DBMS that provides ACID guarantees. It is a scalable, open source BDMS. </p><p>With various storage and indexing support options, including managed datasets, external datasets, and secondary indexes, AsterixDB is very flexible and has a fast data-consumption rate. </p><p>It extends object-oriented data and JSON for easy processing of data of the semi-structured form. For easy processing, it can construct clusters for distributed processing, and can be extended to more than 1,000 cores and 500 discs. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec81"></a>Data models</h3></div></div></div><p>AsterixDB has semi-structured NoSQL-style data <span>models</span><a id="id325806802" class="indexterm"></a> resulting from extending JSON with object database ideas. There are mainly three types of data:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Primitive types</strong></span>: Boolean, string, tinyint, smallint, Integer, bigint, float, double, binary, point, line, rectangle, circle, polygon, date, time, DateTime, duration, and UUID
</li><li style="list-style-type: disc"><span class="strong"><strong>Incomplete information types</strong></span>: null and missing</li><li style="list-style-type: disc"><span class="strong"><strong>Derived types</strong></span>: object, array, and multiset</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec82"></a>The Asterix query language</h3></div></div></div><p><span class="strong"><strong>Asterix Query Language</strong></span> (<span class="strong"><strong>AQL</strong></span>) is a standard <span>language</span><a id="id325806663" class="indexterm"></a> to communicate with AsterixDB. In this section, we are going to find out about two types of queries in AQL:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Data Manipulation Language</strong></span> (<span class="strong"><strong>DML</strong></span>): The <span>functional</span><a id="id326157133" class="indexterm"></a> capability of DML is organized into manipulation commands such as <code class="literal">SELECT</code>, <code class="literal">UPDATE</code>, <code class="literal">INSERT INTO</code>, and <code class="literal">DELETE FROM</code></li><li style="list-style-type: disc"><span class="strong"><strong>Data-Definition Language</strong></span> (<span class="strong"><strong>DDL</strong></span>): Commonly <span>used</span><a id="id326156400" class="indexterm"></a> DDLs in SQL querying include <code class="literal">CREATE</code>, <code class="literal">ALTER</code>, and <code class="literal">DROP</code></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec83"></a>Getting started with AsterixDB</h3></div></div></div><p>To run AsterixDB, you should have Unix-sh environments, such as <span>Linux</span><a id="id326020980" class="indexterm"></a> or macOS X. In order to build from the source, perform the commands given as follows:</p><pre class="programlisting"><span class="strong"><strong>$ git clone https://github.com/apache/asterixdb.git</strong></span></pre><p>To build the database from the master branch, you have to execute the following command:</p><pre class="programlisting"><span class="strong"><strong>$ cd asterixdb</strong></span>
<span class="strong"><strong>$ mvn clean package -DskipTests</strong></span></pre><p>To run the build on your machine, here are the steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Start a single-machine AsterixDB instance:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ cd asterixdb/asterix-server/target/asterix-server-*-binary-assembly/</strong></span>
<span class="strong"><strong>$ ./opt/local/bin/start-sample-cluster.sh</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Good to go and run queries in your browser at:</li></ol></div><pre class="programlisting"><span class="strong"><strong>http://localhost:19001</strong></span></pre><p> </p><p> </p><p> </p><p> </p><p>You should be able to see the <span>web</span><a id="id326198684" class="indexterm"></a> interface, as follows:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/694a41fc-d3d0-4db5-83a3-94b6023b8a2b.png" /></div><p>Figure 11.4: Web interface for AsterixDB</p><p></p><p>To stop the sample cluster, use the following command:</p><pre class="programlisting"><span class="strong"><strong>$ ./opt/local/bin/stop-sample-cluster.sh</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec84"></a>Unstructured data in AsterixDB</h3></div></div></div><p>Consider the <span>following</span><a id="id326198722" class="indexterm"></a> JSON snippet:</p><pre class="programlisting"><span>{</span>
<span>"id"</span><span>:</span><span>101</span><span>,</span>
<span>"name"</span><span>:</span><span>"John Doe"</span><span>,</span>
<span>"nickname"</span><span>:</span><span>"John"</span><span>,</span>
<span>"username"</span><span>:</span><span>"johndoe"</span><span>,
   "email" : "johndoe@gmail.com",</span>
<span>"createdAt"</span><span>:</span><span>"2018-08020T10:10:00"</span><span>,</span>
<span>"friendIds"</span><span>:</span><span>[</span>
<span>2</span><span>,</span>
<span>3</span><span>,</span>
<span>4</span><span>,</span>
<span>10</span>
<span>]</span><span>,</span>
<span>"employement"</span><span>:</span><span>[</span>
<span>{</span>
<span>"organizationName"</span><span>:</span><span>"SAS Web Tech"</span><span>,</span>
<span>"startDate"</span><span>:</span><span>"2017-08-06"</span>
<span>}</span><span>,</span>
<span>{</span>
<span>"organizationName"</span><span>:</span><span>"Kirlosker Service Center"</span><span>,</span>
<span>"startDate"</span><span>:</span><span>"2016-08-06"</span>
<span>}</span>
<span>]</span><span>,</span>
<span>"gender"</span><span>:</span><span>"Male"</span>
<span>}</span></pre><p>The JSON data holds information of an employee who has a <code class="literal">name</code>, <code class="literal">nickname</code>, and <code class="literal">username</code>, and the date when the record was inserted. An employee can be associated with one or more organizations. To create a schema in AsterixDB, our schema could appear as follows:</p><pre class="programlisting">create type EmploymentType as closed {
  organizationName: string,
  startDate: date,
  endDate: date?
};</pre><p> </p><p> </p><p> </p><p> </p><p>Notice that the <span>schema</span><a id="id325883017" class="indexterm"></a> is defined as <code class="literal">closed</code>. Now we can define <code class="literal">UserType</code> as follows:</p><pre class="programlisting">create type UserType as open {
  id: int,
  username: string,
  name: string,
  email: string,
  nickname: string,
  createdAt: datetime,
  friendIds: {{ int }},
  employment: [EmploymentType],
  gender: string
};</pre><p>The world of data in AsterixDB is organized into data <span>namespaces</span><a id="id325883040" class="indexterm"></a> called <span class="strong"><strong>dataverses</strong></span>. To set default dataverses for a series of statements, the <code class="literal">use dataverse</code> statement is provided. For example, to <code class="literal">use dataverse</code> to be <code class="literal">TinySocial</code>, we need to execute the following statement:</p><pre class="programlisting"><span class="strong"><strong>$ use dataverse TinySocial;</strong></span></pre><p>Now <code class="literal">create dataset</code> is used to create a new dataset. To create a dataset for this example, we need to run the following statements:</p><pre class="programlisting"><span class="strong"><strong>$ create dataset Employee(UserType) primary key id;</strong></span></pre><p>After that, we can create the example <code class="literal">UserType</code> and <code class="literal">EmploymentType</code>. When you run these statements, the output screen should look something like this:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/f972422f-bbb8-4b1c-bf96-d8844678e142.png" /></div><p>Figure 11.5: Output screen of the query execution
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec85"></a>Inserting into datasets</h3></div></div></div><p>Let's assume we want to insert the dataset as shown in the <span>preceding</span><a id="id325883142" class="indexterm"></a> snippet. Our insert query could look like the following:</p><pre class="programlisting">insert into dataset Employee
(
{
  "id": 101,
  "username":"John",
  "name":"John Doe",
  "nickname":"John",
  "email":"jonhdoe@gmail.com",
  "createdAt":datetime("2017-08-15T08:10:00"),
  "friendIds":{{ 2,3, 4, 10 }},
  "employment":
   [
    {
      "organizationName":"SAS WEB Tech",
      "startDate": date("2017-08-15")
    },
   {
     "organizationName":"Kirlokser Service Center",
     "startDate": date("2016-08-15")
   }
  ],
  "gender": "Male"
}
);</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec86"></a>Querying in AsterixDB</h3></div></div></div><p>By default, AsterixDB <span>supports</span><a id="id325883161" class="indexterm"></a> two languages:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">AQL </li><li style="list-style-type: disc">SQL++: SQL for JSON</li></ul></div><p>For example, to return the subtree under the root node of a dataset tree, your query statement would be something such as the following:</p><pre class="programlisting">SELECT VALUE user
FROM UserType user;</pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>To return subtree under a node that satisfied a different predicate:</p><pre class="programlisting">SELECT VALUE user
FROM UserType user
WHERE array_count(user.friendIds) = 1</pre><p>There is a lot to process and a lot of built-in functions available with AsterixDB that are beyond the scope of this book. We suggest you follow the documentation and create your own schema. Attached below after <span class="emphasis"><em>Further reading</em></span> in this PDF.</p></div></div>