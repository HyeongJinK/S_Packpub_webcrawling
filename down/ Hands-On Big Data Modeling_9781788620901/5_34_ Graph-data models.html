<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec38"></a>Graph-data models</h2></div></div><hr /></div><p>A graph is a just a <span>collection</span><a id="id326544640" class="indexterm"></a> of vertices and edges. The most convincing example of a graph-data model is a social network. Each piece of information in this world is connected. To store and process information correctly, a database must embrace and store the entity and its connectivity with another entity. This is where the graph-data model kicks in. Storing and accessing nodes and relationships in a graph database is an easy, efficient, and constant-time operation that permits a user to quickly traverse and get correct information.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note7"></a>Note</h3><p>Mathematically, a graph is a pair <span class="emphasis"><em>G = (V, E)</em></span> of sets that satisfy <span class="emphasis"><em>E <div class="mediaobject"><img src="/graphics/9781788620901/graphics/68cdc8b6-447d-406b-b1ab-0e1c11b36360.png" /></div> ( V X V)</em></span>. The elements of <span class="emphasis"><em>V</em></span> are the vertices or nodes of the graph, <span class="emphasis"><em>G</em></span>, and the elements of <span class="emphasis"><em>E</em></span> are its edges or relationships. </p></div><p>Let's see a graph model of movies and actors. </p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/950937f7-5b53-4249-8e3e-54f935d268a0.png" /></div><p>Figure 5.6: Labeled graph model of movies and actors</p><p></p><p>From the movie data model given in the preceding diagram, it's clear that we have the following <span>vertex</span><a id="id326543214" class="indexterm"></a> table:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>ID</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Property (V)</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Person, <span class="strong"><strong>Jackie Chan</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Person, <span class="strong"><strong>Dwayne Johnson</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Movie, <span class="strong"><strong>Kung Fu Panda</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Movie, <span class="strong"><strong>Moana</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Movie, <span class="strong"><strong>Skyscraper</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Person, <span class="strong"><strong>John Stevenson</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>7</p></td><td style="border-bottom: 0.5pt solid ; "><p>(Person, <span class="strong"><strong>Ron Clements</strong></span>)</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>8</p></td><td style=""><p>(Person, <span class="strong"><strong>Rawson Marshall Thurber</strong></span>)</p></td></tr></tbody></table></div><p> </p><p>The corresponding edge table of the graph would be:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Source</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Destination</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Property(E)</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>ACTED_IN</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>ACTED_IN</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>5</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>ACTED_IN</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>6</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>3</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>DIRECTED</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>7</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>DIRECTED</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>8</p></td><td style="border-right: 0.5pt solid ; "><p>5</p></td><td style=""><p><span class="strong"><strong>DIRECTED</strong></span></p></td></tr></tbody></table></div><p> </p><p>From the preceding diagram, the following observations can be made:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The data model is a graph model that shows nodes (person, movies) and relationships (<span class="strong"><strong>ACTED_IN</strong></span> and <span class="strong"><strong>DIRECTED</strong></span>)</li><li style="list-style-type: disc">Nodes can be labeled with one or more labels, which is good for identification</li><li style="list-style-type: disc">Nodes can contain properties where properties are stored as a key-value pair</li><li style="list-style-type: disc">Relationships can be named and directed</li><li style="list-style-type: disc">Relationships have a start and end node
</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec47"></a>Graph-data models with Gephi</h3></div></div></div><p>Gephi should be run on your native hardware, not in the Cloudera VM. Instructions for downloading, installing, and running <span>Gephi</span><a id="id326351702" class="indexterm"></a> can be found at <a class="ulink" href="https://gephi.org/users/install" target="_blank">https://gephi.org/users/install</a>. Let's have a look at the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Download and import the CSV file.<span class="strong"><strong> </strong></span>The <span>data</span><a id="id326351730" class="indexterm"></a> used in this example is in<code class="literal">CH05/graph/diseaseGraph.csv</code>.</li><li>Click on <strong class="userinput"><code>File</code></strong>, and choose <strong class="userinput"><code>Save as</code></strong> to download the file.</li></ol></div><p>In Gephi, click on <strong class="userinput"><code>File</code></strong>, and choose <strong class="userinput"><code>Import spreadsheet...</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/84c8316a-1165-42ec-a1dd-91ac8e82fa6e.png" /></div><p>Figure 5.7: Go to File and then choose Import spreadsheet</p><p>In the <strong class="userinput"><code>Import spreadsheet...</code></strong> dialog, click on <strong class="userinput"><code>...</code></strong> to choose the CSV file:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/3c573758-7943-4060-b389-a5eaec85c071.png" /></div><p>In the <strong class="userinput"><code>File</code></strong> dialog, <span>choose</span><a id="id326540374" class="indexterm"></a> the <code class="literal">diseaseGraph.csv</code> file you downloaded:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/f19b0b97-219a-4fe3-be77-f454c399cc01.png" /></div><p>In the dialog, make sure <span class="emphasis"><em><strong class="userinput"><code>As the table</code></strong></em></span> is set to<span class="emphasis"><em> </em></span><strong class="userinput"><code>Edges table</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/968415d7-918c-499d-bc30-16778a6735b2.png" /></div><p>Click <strong class="userinput"><code>Next</code></strong>, and then click <strong class="userinput"><code>Finish</code></strong> to import the CSV data into Gephi.</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Examine the graph properties. In the middle pane, Gephi displays the graph. The black <span>circles</span><a id="id325838889" class="indexterm"></a> are the nodes, and the lines between them are the edges:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788620901/graphics/6d7cb60c-1857-4533-89c4-44a33e05a682.png" /></div><p>If you place the mouse on a node, Gephi will <span>highlight</span><a id="id325838910" class="indexterm"></a> the nodes that are connected to it, as follows:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/edc4c569-7ce0-4307-8206-5f7c24dc4670.png" /></div><p>In the top-right corner is the <strong class="userinput"><code>Context</code></strong> pane, which says that the graph has <strong class="userinput"><code>777</code></strong> nodes and <strong class="userinput"><code>998</code></strong> edges:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/da8141d7-e6eb-49d3-b444-78622f624b86.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li><span class="strong"><strong> </strong></span>Perform statistical operations. </li></ol></div><p>Under the <strong class="userinput"><code>Context</code></strong> pane is the <strong class="userinput"><code>Statistics</code></strong> pane, where you can perform various statistical calculations. We can calculate the average degree by <span>clicking</span><a id="id325841874" class="indexterm"></a> on <strong class="userinput"><code>Run</code></strong> next to <strong class="userinput"><code>Average Degree</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/769d5e8d-d76b-441e-a056-280fd9eb0a53.png" /></div><p>The dialog that pops up says that the average degree is 2.569. Click on <strong class="userinput"><code>Close</code></strong> to close the dialog.</p><p>We can calculate the connected components by clicking on <strong class="userinput"><code>Run</code></strong> next to <strong class="userinput"><code>Connected Components</code></strong>: This will present a dialog box with a title of <strong class="userinput"><code>Connected Components settings</code></strong> and ask for either Directed or Undirected calculations.</p><p>The resulting dialog says there are five weakly-connected components and 761 strongly-connected components. Click <strong class="userinput"><code>Close</code></strong> to close the dialog.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Run layout algorithms. 
</li></ol></div><p>Gephi can perform different layout algorithms on the graph. In the <strong class="userinput"><code>Layout</code></strong> pane on the bottom-left, click on the <strong class="userinput"><code>---Choose a layout</code></strong> combo box, select <strong class="userinput"><code>Force Atlas</code></strong>, and click on the <strong class="userinput"><code>Run</code></strong> button:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/e006aeb7-83f7-460d-8935-1c0cdfa5c43a.png" /></div><p>Gephi will change the layout of the graph, and then after some time, click on the <strong class="userinput"><code>Stop</code></strong> button:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/f09a6530-405a-439c-9d98-56b9321fd44f.png" /></div><p>In this layout, strongly-connected <span>nodes</span><a id="id325881467" class="indexterm"></a> are clustered together, and we can also see several clusters that are disconnected from the rest of the graph.</p><p> </p><p>In the <strong class="userinput"><code>Layout</code></strong> combo box, select <strong class="userinput"><code>Fruchterman Reingold</code></strong> and click on the <strong class="userinput"><code>Run</code></strong> button:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/42180de0-2f32-4ce3-9fb0-549f66af6297.png" /></div><p>The graph layout will change to make the <span>nodes</span><a id="id325890004" class="indexterm"></a> evenly spaced. After the graph stops moving, click on the <strong class="userinput"><code>Stop</code></strong> button, and then on the magnifying glass icon in the middle-left bottom to center the graph:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/12b1382a-188d-431c-a671-4a7d01a95d7a.png" /></div><p> </p><p>In this layout, we can better see which nodes have a lot of edges:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/f868397f-cf57-4fe2-ac14-e965cfc40a11.png" /></div></div></div>