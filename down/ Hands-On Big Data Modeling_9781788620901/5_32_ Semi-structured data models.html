<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec36"></a>Semi-structured data models</h2></div></div><hr /></div><p>In <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Defining Data Models</em></span>, we learned <span>about</span><a id="id326489235" class="indexterm"></a> different types of data, including structured, semi-structured, and unstructured. In this section, we are going to discuss more semi-structured data. The <span class="strong"><strong>World Wide Web</strong></span> (<span class="strong"><strong>WWW</strong></span>) is the largest information source today. If we have to classify the <span>data</span><a id="id326489241" class="indexterm"></a> model behind the web, we can say it belongs to the semi-structured data model. Most of the semi-structured data refer to tree-structure data. </p><p>Let's take the <span>example</span><a id="id326195194" class="indexterm"></a> of a web page:</p><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset="UTF-8"&gt;
&lt;title&gt;Page Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;This is a Heading&lt;/h1&gt;
&lt;p&gt;This is a paragraph.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;List Item 1&lt;/li&gt;
&lt;li&gt;List Item 2&lt;/li&gt;
&lt;li&gt;List Item 3&lt;/li&gt;
&lt;/ul&gt;
&lt;footer&gt;&lt;center&gt;Copyright: Hands-on exercise&lt;/center&gt;&lt;/footer&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p>Here, an <span>HTML</span><a id="id326284811" class="indexterm"></a> document must be wrapped inside the <code class="literal">&lt;html&gt;</code> tag, and all the content goes inside the <code class="literal">&lt;body&gt;</code> tag. The code in the preceding snippet can render the HTML page. All the data comes from the HTML and slash HTML blocks. Similarly, we have a body and end, a header begins and end, list begin and end. The second thing to notice is, unlike a relational structure, there are multiple list items and multiple paragraphs. Any single document would have a different number of them. This means that while the data object has some structure, it is more flexible. This is the hallmark of an office semi-structure data model. </p><p><span class="strong"><strong>eXtensible Markup Language</strong></span> (<span class="strong"><strong>XML</strong></span>) is <span>another</span><a id="id326284834" class="indexterm"></a> well-known standard for <span>representing</span><a id="id326284840" class="indexterm"></a> data. XML can be perceived as the generalization of HTML, where the elements, or the beginning and end markers within the angular brackets, can be any string. Let's take an example of an <span>XML</span><a id="id326284849" class="indexterm"></a> document: </p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;depression_patients&gt;
  &lt;patient&gt;
    &lt;name&gt;John Doe&lt;/name&gt;
    &lt;bill&gt;$1115.95&lt;/bill&gt;
    &lt;session&gt;2&lt;/session&gt;
    &lt;level&gt;6&lt;/level&gt;
    &lt;telecom&gt;
      &lt;system value="phone"/&gt;
      &lt;value value="(03) 5555 6473"/&gt;
      &lt;use value="work"/&gt;
      &lt;rank value="1"/&gt;
    &lt;/telecom&gt;
  &lt;/patient&gt;
  &lt;patient&gt;
    &lt;name&gt;Ola Nordmann&lt;/name&gt;
    &lt;bill&gt;$7000.95&lt;/bill&gt;
    &lt;session&gt;3&lt;/session&gt;
    &lt;level&gt;9&lt;/level&gt;
    &lt;telecom&gt;
      &lt;system value="phone"/&gt;
      &lt;value value="(03) 5555 6473"/&gt;
      &lt;use value="work"/&gt;
      &lt;rank value="1"/&gt;
    &lt;/telecom&gt;
  &lt;/patient&gt;
  &lt;patient&gt;
    &lt;name&gt;Gummy Bear&lt;/name&gt;
    &lt;bill&gt;$43.95&lt;/bill&gt;
    &lt;session&gt;4&lt;/session&gt;
    &lt;level&gt;90&lt;/level&gt;
    &lt;telecom&gt;
      &lt;system value="phone"/&gt;
      &lt;value value="(03) 5555 6473"/&gt;
      &lt;use value="work"/&gt;
      &lt;rank value="1"/&gt;
    &lt;/telecom&gt;
  &lt;/patient&gt;
  &lt;patient&gt;
    &lt;name&gt;Reshika Adhikari&lt;/name&gt;
    &lt;bill&gt;$4343.50&lt;/bill&gt;
    &lt;session&gt;6&lt;/session&gt;
    &lt;level&gt;3&lt;/level&gt;
    &lt;telecom&gt;
      &lt;system value="phone"/&gt;
      &lt;value value="(03) 5555 6473"/&gt;
      &lt;use value="work"/&gt;
      &lt;rank value="1"/&gt;
    &lt;/telecom&gt;
  &lt;/patient&gt;
  &lt;patient&gt;
    &lt;name&gt;Yoshmi Mukhiya&lt;/name&gt;
    &lt;bill&gt;$634.95&lt;/bill&gt;
    &lt;session&gt;7&lt;/session&gt;
    &lt;level&gt;0&lt;/level&gt;
    &lt;telecom&gt;
      &lt;system value="phone"/&gt;
      &lt;value value="(03) 5555 6473"/&gt;
      &lt;use value="work"/&gt;
      &lt;rank value="1"/&gt;
    &lt;/telecom&gt;
  &lt;/patient&gt;
&lt;/depression_patients&gt;</pre><p>You can read more about XML files and their purposes at <a class="ulink" href="https://www.w3schools.com/XML/xml_whatis.asp" target="_blank">https://www.w3schools.com/XML/xml_whatis.asp</a>. </p><p>Another most popular format used for <span>different</span><a id="id326288867" class="indexterm"></a> data, such as Facebook and Twitter, is <span class="strong"><strong>JavaScript Object Notation</strong></span> (<span class="strong"><strong>JSON</strong></span>). Let's consider the following example, which is exactly the same snippet represented as XML previously: </p><pre class="programlisting">{
  "depression_patients": {
    "patient": [
      {
        "name": "John Doe",
        "bill": "$1115.95",
        "session": "2",
        "level": "6",
        "telecom": {
          "system": {
            "_value": "phone"
          },
          "value": {
            "_value": "(03) 5555 6473"
          },
          "use": {
            "_value": "work"
          },
          "rank": {
            "_value": "1"
          }
        }
      },
      {
        "name": "Ola Nordmann",
        "bill": "$7000.95",
        "session": "3",
        "level": "9",
        "telecom": {
          "system": {
            "_value": "phone"
          },
          "value": {
            "_value": "(03) 5555 6473"
          },
          "use": {
            "_value": "work"
          },
          "rank": {
            "_value": "1"
          }
        }
      },
      {
        "name": "Gummy Bear",
        "bill": "$43.95",
        "session": "4",
        "level": "90",
        "telecom": {
          "system": {
            "_value": "phone"
          },
          "value": {
            "_value": "(03) 5555 6473"
          },
          "use": {
            "_value": "work"
          },
          "rank": {
            "_value": "1"
          }
        }
      },
      {
        "name": "Reshika Adhikari",
        "bill": "$4343.50",
        "session": "6",
        "level": "3",
        "telecom": {
          "system": {
            "_value": "phone"
          },
          "value": {
            "_value": "(03) 5555 6473"
          },
          "use": {
            "_value": "work"
          },
          "rank": {
            "_value": "1"
          }
        }
      },
      {
        "name": "Yoshmi Mukhiya",
        "bill": "$634.95",
        "session": "7",
        "level": "0",
        "telecom": {
          "system": {
            "_value": "phone"
          },
          "value": {
            "_value": "(03) 5555 6473"
          },
          "use": {
            "_value": "work"
          },
          "rank": {
            "_value": "1"
          }
        }
      }
    ]
  }
}</pre><p>JSON uses text only, which is easier for <span>sending</span><a id="id326288888" class="indexterm"></a> and receiving over any server. Hence, it is used as a data format by many programming languages. In the preceding snippet, we have a similar nested structure; that is, lists containing other lists which will contain tuples that consist of key-value pairs. So, the key-value pairs at atomic property names and their values. One way to generalize about all these different forms of semi-structured data is to model them as trees:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/c872c133-0a9c-4195-881a-f93f05ab93f0.png" /></div><p>Figure 5.1: Tree data structure of a simple web page showing semi-structured data
</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec45"></a>Exploring the semi-structured data model of JSON data</h3></div></div></div><p>Let's consume the <span>Twitter</span><a id="id326288914" class="indexterm"></a> API (<a class="ulink" href="https://apps.twitter.com/" target="_blank">https://apps.twitter.com/</a>) to download some <span>tweets</span><a id="id326288928" class="indexterm"></a> and construct a semi-structured data model. We are going to use the <span>Tweepy</span><a id="id326290712" class="indexterm"></a> library (<a class="ulink" href="https://www.tweepy.org/" target="_blank">https://www.tweepy.org/</a>) to download the tweets. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec24"></a>Installing Python and the Tweepy library</h4></div></div></div><p>Start up your virtual <span>machine</span><a id="id326290732" class="indexterm"></a> and run the Terminal. Please follow <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Introduction to Big Data and Data Management,</em></span> and <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Data Modeling and Management Platforms</em></span>, on how to <span>get</span><a id="id326290758" class="indexterm"></a> started with a virtual machine. Also, you should have <code class="literal">pip</code> installed by now. If you do not have <code class="literal">pip</code> installed, please follow the tutorials at <a class="ulink" href="https://pip.pypa.io/en/latest/installing/" target="_blank">https://pip.pypa.io/en/latest/installing/</a>. </p><p>Just run <code class="literal">pip</code> to install <code class="literal">tweepy</code> by running the following command:</p><pre class="programlisting"><span class="strong"><strong>$ pip install tweepy</strong></span></pre><p>Once you have that installed, the next step is getting set up with the Twitter API. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec25"></a>Getting authorization credentials to access the Twitter API</h4></div></div></div><p>Authorization credentials can be obtained by creating a new app in the <span>Twitter</span><a id="id326291009" class="indexterm"></a> developer platform (<a class="ulink" href="https://apps.twitter.com/" target="_blank">https://apps.twitter.com/</a>). Twitter permits downloading 3,200 tweets (<a class="ulink" href="https://developer.twitter.com/en/docs/api-reference-index" target="_blank">https://developer.twitter.com/en/docs/api-reference-index</a>) in the JSON format. The script to download the tweets can be found in <code class="literal">CH05</code> from the book code base. Run the Python script simply by <code class="literal">python tweet.py</code>. More instructions on getting access to <span>Twitter</span><a id="id326291034" class="indexterm"></a> credentials can be found on the Twitter developer website: <a class="ulink" href="https://developer.twitter.com/en/apply-for-access" target="_blank">https://developer.twitter.com/en/apply-for-access</a>.</p><p>After creating an app on the site, you should be able to get access to keys and tokens similar to the following screenshots: </p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/b08d23f0-8392-46b4-88b4-b3376a0a6d87.png" /></div><p>Figure 5.2: Twitter app credentials page</p><p>The Python scripts use the REST API provided by <span>Twitter</span><a id="id326291066" class="indexterm"></a> to download the data and save it into our destination. You just need to populate the script with <span>your</span><a id="id326291075" class="indexterm"></a> own keys and run the script: </p><pre class="programlisting">#!/usr/bin/env python
# encoding: utf-8

import tweepy 
import json

#Twitter API credentials
consumer_key = "CONSUMER_KEY_GOES_HERE"
consumer_secret = "CONSUMER_SECRET_GOES_HERE"
access_key = "ACCESS_KEY_GOES_HERE"
access_secret = "ACCESS_SECRET_GOES_HERE"

def get_all_tweets_by_handle(screen_name):

    #Twitter only allows access to a users most recent 3240 tweets with this method

    #authorize twitter, initialize tweepy
    auth = tweepy.OAuthHandler(consumer_key, consumer_secret)
    auth.set_access_token(access_key, access_secret)
    api = tweepy.API(auth)

    #initialize a list to hold all the tweepy Tweets
    alltweets = [] 

    #make initial request for most recent tweets (200 is the maximum allowed count)
    new_tweets = api.user_timeline(screen_name = screen_name,count=200)

    #save most recent tweets
    alltweets.extend(new_tweets)

    #save the id of the oldest tweet less one
    oldest = alltweets[-1].id - 1

    #keep grabbing tweets until there are no tweets left to grab
    while len(new_tweets) &gt; 0:

        #all subsequent requests use the max_id param to prevent duplicates
        new_tweets = api.user_timeline(screen_name = screen_name,count=200,max_id=oldest)

        #save most recent tweets
        alltweets.extend(new_tweets)

        #update the id of the oldest tweet less one
        oldest = alltweets[-1].id - 1

        print "...%s tweets downloaded so far" % (len(alltweets))

    #write tweet objects to JSON
    file = open('tweet.json', 'wb') 
    print "Writing tweet objects to JSON please wait..."
    for status in alltweets:
        json.dump(status._json,file,sort_keys = True,indent = 4)

    #close the file
    print "Done"
    file.close()

if __name__ == '__main__':
    #pass in the username of the account you want to download
    get_all_tweets_by_handle("@IBM")</pre><p> </p><p>Make sure to replace the value of the key with <span>your</span><a id="id326291094" class="indexterm"></a> application key's value. Also, write the username you want to download tweets from. In this case, I am <span>going</span><a id="id326291102" class="indexterm"></a> to download 3,200 tweets from IBM: </p><pre class="programlisting">if __name__ == '__main__':
#pass in the username of the account you want to download
get_all_tweets("@IBM") </pre><p>You can run the script using the following command:</p><pre class="programlisting"><span class="strong"><strong>python tweets.py</strong></span></pre><p>Once you run the command, you will be able to see the following output:</p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/287d3398-68d7-4fb3-8a0c-6bd74bc9f4b2.png" /></div><p>Figure 5.3: Running the python script to download the tweets</p><p>Here is an example response obtained by the script:</p><pre class="programlisting"><span>{</span>
<span>"contributors"</span><span>:</span><span>null</span><span>,</span>
<span>"coordinates"</span><span>:</span><span>null</span><span>,</span>
<span>"created_at"</span><span>:</span><span>"Fri May 11 03:47:28 +0000 2018"</span><span>,</span>
<span>"entities"</span><span>:</span><span>{</span>
<span>"hashtags"</span><span>:</span><span>[</span>
<span>{</span>
<span>"indices"</span><span>:</span><span>[</span>
<span>41</span><span>,</span>
<span>46</span>
<span>]</span><span>,</span>
<span>"text"</span><span>:</span><span>"IBMQ"</span>
<span>}</span><span>,</span>
<span>{</span>
<span>"indices"</span><span>:</span><span>[</span>
<span>93</span><span>,</span>
<span>101</span>
<span>]</span><span>,</span>
<span>"text"</span><span>:</span><span>"quantum"</span>
<span>}</span>
<span>]</span><span>,</span>
<span>"symbols"</span><span>:</span><span>[</span>

<span>]</span><span>,</span>
<span>"urls"</span><span>:</span><span>[</span>
<span>{</span>
<span>"display_url"</span><span>:</span><span>"bitly.com/2G5pSDD"</span><span>,</span>
<span>"expanded_url"</span><span>:</span><span>"http://bitly.com/2G5pSDD"</span><span>,</span>
<span>"indices"</span><span>:</span><span>[</span>
<span>69</span><span>,</span>
<span>92</span>
<span>]</span><span>,</span>
<span>"url"</span><span>:</span><span>"https://t.co/JBSmlMqj5C"</span>
<span>}</span>
<span>]</span><span>,</span>
<span>"user_mentions"</span><span>:</span><span>[</span>
<span>{</span>
<span>"id"</span><span>:</span><span>487624974</span><span>,</span>
<span>"id_str"</span><span>:</span><span>"487624974"</span><span>,</span>
<span>"indices"</span><span>:</span><span>[</span>
<span>1</span><span>,</span>
<span>9</span>
<span>]</span><span>,</span>
<span>"name"</span><span>:</span><span>"NC State University"</span><span>,</span>
<span>"screen_name"</span><span>:</span><span>"NCState"</span>
<span>}</span>
<span>]</span>
<span>}</span><span>,</span>
<span>"favorite_count"</span><span>:</span><span>86</span><span>,</span>
<span>"favorited"</span><span>:</span><span>false</span><span>,</span>
<span>"geo"</span><span>:</span><span>null</span><span>,</span>
<span>"id"</span><span>:</span><span>994786038236286976</span><span>,</span>
<span>"id_str"</span><span>:</span><span>"994786038236286976"</span><span>,</span>
<span>"in_reply_to_screen_name"</span><span>:</span><span>null</span><span>,</span>
<span>"in_reply_to_status_id"</span><span>:</span><span>null</span><span>,</span>
<span>"in_reply_to_status_id_str"</span><span>:</span><span>null</span><span>,</span>
<span>"in_reply_to_user_id"</span><span>:</span><span>null</span><span>,</span>
<span>"in_reply_to_user_id_str"</span><span>:</span><span>null</span><span>,</span>
<span>"is_quote_status"</span><span>:</span><span>false</span><span>,</span>
<span>"lang"</span><span>:</span><span>"en"</span><span>,</span>
<span>"place"</span><span>:</span><span>null</span><span>,</span>
<span>"possibly_sensitive"</span><span>:</span><span>false</span><span>,</span>
<span>"retweet_count"</span><span>:</span><span>37</span><span>,</span>
<span>"retweeted"</span><span>:</span><span>false</span><span>,</span>
<span>"source"</span><span>:</span><span>"&lt;a href=\"https://www.sprinklr.com\" rel=\"nofollow\"&gt;Sprinklr&lt;/a&gt;"</span><span>,</span>
<span>"text"</span><span>:</span><span>".@NCState to become 1st university-based #IBMQ hub in North America: https://t.co/JBSmlMqj5C #quantum"</span><span>,</span>
<span>"truncated"</span><span>:</span><span>false</span><span>,</span>
<span>"user"</span><span>:</span><span>{</span>
<span>"contributors_enabled"</span><span>:</span><span>false</span><span>,</span>
<span>"created_at"</span><span>:</span><span>"Wed Jan 14 20:41:57 +0000 2009"</span><span>,</span>
<span>"default_profile"</span><span>:</span><span>false</span><span>,</span>
<span>"default_profile_image"</span><span>:</span><span>false</span><span>,</span>
<span>"description"</span><span>:</span><span>"Official IBM Twitter account. Follows the IBM Social Computing Guidelines."</span><span>,</span>
<span>"entities"</span><span>:</span><span>{</span>
<span>"description"</span><span>:</span><span>{</span>
<span>"urls"</span><span>:</span><span>[</span>

<span>]</span>
<span>}</span><span>,</span>
<span>"url"</span><span>:</span><span>{</span>
<span>"urls"</span><span>:</span><span>[</span>
<span>{</span>
<span>"display_url"</span><span>:</span><span>"ibm.com"</span><span>,</span>
<span>"expanded_url"</span><span>:</span><span>"https://www.ibm.com"</span><span>,</span>
<span>"indices"</span><span>:</span><span>[</span>
<span>0</span><span>,</span>
<span>23</span>
<span>]</span><span>,</span>
<span>"url"</span><span>:</span><span>"https://t.co/4ZyG9FgkYe"</span>
<span>}</span>
<span>]</span>
<span>}</span>
<span>}</span><span>,</span>
<span>"favourites_count"</span><span>:</span><span>3496</span><span>,</span>
<span>"follow_request_sent"</span><span>:</span><span>false</span><span>,</span>
<span>"followers_count"</span><span>:</span><span>443681</span><span>,</span>
<span>"following"</span><span>:</span><span>false</span><span>,</span>
<span>"friends_count"</span><span>:</span><span>6364</span><span>,</span>
<span>"geo_enabled"</span><span>:</span><span>false</span><span>,</span>
<span>"has_extended_profile"</span><span>:</span><span>false</span><span>,</span>
<span>"id"</span><span>:</span><span>18994444</span><span>,</span>
<span>"id_str"</span><span>:</span><span>"18994444"</span><span>,</span>
<span>"is_translation_enabled"</span><span>:</span><span>false</span><span>,</span>
<span>"is_translator"</span><span>:</span><span>false</span><span>,</span>
<span>"lang"</span><span>:</span><span>"en"</span><span>,</span>
<span>"listed_count"</span><span>:</span><span>5432</span><span>,</span>
<span>"location"</span><span>:</span><span>"Armonk, New York"</span><span>,</span>
<span>"name"</span><span>:</span><span>"IBM"</span><span>,</span>
<span>"notifications"</span><span>:</span><span>false</span><span>,</span>
<span>"profile_background_color"</span><span>:</span><span>"FFFFFF"</span><span>,</span>
<span>"profile_background_image_url"</span><span>:</span><span>"http://pbs.twimg.com/profile_background_images/378800000152426467/Viwc1IvP.jpeg"</span><span>,</span>
<span>"profile_background_image_url_https"</span><span>:</span><span>"https://pbs.twimg.com/profile_background_images/378800000152426467/Viwc1IvP.jpeg"</span><span>,</span>
<span>"profile_background_tile"</span><span>:</span><span>false</span><span>,</span>
<span>"profile_banner_url"</span><span>:</span><span>"https://pbs.twimg.com/profile_banners/18994444/1516234232"</span><span>,</span>
<span>"profile_image_url"</span><span>:</span><span>"http://pbs.twimg.com/profile_images/925460050994270208/2IXQLOut_normal.jpg"</span><span>,</span>
<span>"profile_image_url_https"</span><span>:</span><span>"https://pbs.twimg.com/profile_images/925460050994270208/2IXQLOut_normal.jpg"</span><span>,</span>
<span>"profile_link_color"</span><span>:</span><span>"2FC2EF"</span><span>,</span>
<span>"profile_sidebar_border_color"</span><span>:</span><span>"000000"</span><span>,</span>
<span>"profile_sidebar_fill_color"</span><span>:</span><span>"252429"</span><span>,</span>
<span>"profile_text_color"</span><span>:</span><span>"666666"</span><span>,</span>
<span>"profile_use_background_image"</span><span>:</span><span>false</span><span>,</span>
<span>"protected"</span><span>:</span><span>false</span><span>,</span>
<span>"screen_name"</span><span>:</span><span>"IBM"</span><span>,</span>
<span>"statuses_count"</span><span>:</span><span>10821</span><span>,</span>
<span>"time_zone"</span><span>:</span><span>"Eastern Time (US &amp; Canada)"</span><span>,</span>
<span>"translator_type"</span><span>:</span><span>"none"</span><span>,</span>
<span>"url"</span><span>:</span><span>"https://t.co/4ZyG9FgkYe"</span><span>,</span>
<span>"utc_offset"</span><span>:</span><span>-14400</span><span>,</span>
<span>"verified"</span><span>:</span><span>true</span>
<span>}</span>
<span>}</span></pre><p> </p><p>Let's examine the semi-structured data from the <span>code</span><a id="id326596211" class="indexterm"></a> base. From the GitHub link, open <code class="literal">Ch05/JSON/twitter.json</code>. Follow these steps: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open a Terminal shell by clicking on the square black box on the top-left of the screen.</li><li>Change into the directory where the Twitter data was downloaded—assuming you ran the preceding scripts and you have the <code class="literal">twitter.json</code> file in <code class="literal">Downloads</code> inside the <code class="literal">data</code> folder:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd Downloads/data</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>To look at the JSON file, you can use the <code class="literal">more</code> command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>more twitter.json</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li><p>The JSON file is quite long and only a part of the file is shown. To read more.<span>  </span>section of the file press spacebar to scroll down. Press Q to quit reading the file.</p></li></ol></div><p>The contents of the file are difficult to understand since it is packed together. In this section, we are going to write Python scripts to see the schema of the JSON file: </p><pre class="programlisting">#!/usr/bin/python

#prints the schema of a json file
# usage: json_schema.py jsonfilename

import sys
import json

filename = sys.argv[1]
data = []
i = 0
try:
    with open(filename) as fname:
        for line in fname:
            i=i+1
            if i%2 == 1: #skip every other line since it is empty
                data.append(json.loads(line))
except Exception:
    print "Error while reading file: ", filename
    print "Check if the file complies with JSON format"
    print "\nUsage: json_schema.py jsonfilename"
    sys.exit()

#inner dfs
def dfs_inner(x, indent):
    try:
        for key, value in x.iteritems():
            print indent + key
            try:
                dfs_inner(value, indent+"....")
            except Exception:
                pass
    except Exception:
        pass

#outer dfs
indent = " "
for key, value in data[0].iteritems():
    print key
    dfs_inner(value, indent+"....")</pre><p>Save the snippet into a <code class="literal">schema.py</code> file. We can get the schema from the JSON file using the following command:</p><pre class="programlisting"><span class="strong"><strong>./json_schema.py tweet.json | more</strong></span></pre><p>You should get the following result: </p><div class="mediaobject"><img src="/graphics/9781788620901/graphics/75c2ae94-ffdb-48e6-bc25-cb27fbc680fc.png" /></div><p>Figure 5.4: Schema of the JSON file</p><p></p></div></div></div>