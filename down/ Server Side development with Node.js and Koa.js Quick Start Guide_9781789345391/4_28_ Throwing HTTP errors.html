<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec33"></a>Throwing HTTP errors</h2></div></div><hr /></div><p>Koa provides a helper method for easily <span>throwing</span><a id="id325859234" class="indexterm"></a> errors with appropriate HTTP status codes. It uses <code class="literal">http-errors</code> for error creation. The <code class="literal">ctx.throw()</code> method throws an error with a <code class="literal">.status</code> property, which is <code class="literal">500</code> (<code class="literal">Internal Server Error</code>) by default. This error with the status property enables Koa to respond properly when different errors occur. The method has the signature, <code class="literal">ctx.throw([status], [error], [properties])</code>. The following different usages are permitted:</p><pre class="programlisting">ctx.throw(401);
ctx.throw(401, 'Access denied to the resource');
ctx.throw(401, 'Access denied to the resource', { user });</pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Throwing <code class="literal">ctx.throw(401, 'Access denied to the resource')</code>, for example, is shorthand for the following:</p><pre class="programlisting">const err = new Error('Access denied to the resource');
err.status = 401;
err.expose = true;
throw err;</pre><p>It is important to note that these errors are OK for sending to the user, meaning <code class="literal">err.expose</code> is set to <code class="literal">true</code>. This is usually not the case, especially for 50x errors, where we would not want sensitive details about our app failures to be shown to users, who could possibly be malicious.</p><p>The <code class="literal">.throw()</code> method also optionally take a properties object that is merged into the error as is. This can be used for passing extra information, which is reported to the requested upstream and can also be used for creating better error messages:</p><pre class="programlisting">app.use(async ctx =&gt; {
  ctx.throw(401, 'Access denied to the resource', { user });
});</pre><p>The error thrown in the preceding code block can be <span>used</span><a id="id325756278" class="indexterm"></a> for creating better error messages, as seen in the following example:</p><pre class="programlisting">app.use(async (ctx, next) =&gt; {
  try {
    await next();
  } catch(err) {
    ctx.body = err.message;
    if (err.status === 401) {
        const { email } = err.user;
        ctx.body = `user with email ${email} does not have access to 
        resource`;
    }
  }
});</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>Note that you can only throw error status codes. These include 4xx and 5xx status code. </p></div><p>Here is a list of the supported status codes:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">400: Bad Request</li><li style="list-style-type: disc">401: Unauthorized</li><li style="list-style-type: disc">402: Payment Required</li><li style="list-style-type: disc">403: Forbidden</li><li style="list-style-type: disc">404: Not Found</li><li style="list-style-type: disc">405: Method Not Allowed</li><li style="list-style-type: disc">406: Not Acceptable</li><li style="list-style-type: disc">407: Proxy Authentication Required</li><li style="list-style-type: disc">408: Request Timeout</li><li style="list-style-type: disc">409: Conflict</li><li style="list-style-type: disc">410: Gone</li><li style="list-style-type: disc">411: Length Required</li><li style="list-style-type: disc">412: Precondition Failed</li><li style="list-style-type: disc">413: Payload Too Large</li><li style="list-style-type: disc">414: URI Too Long</li><li style="list-style-type: disc">415: Unsupported Media Type</li><li style="list-style-type: disc">416: Range Not Satisfiable</li><li style="list-style-type: disc">417: Expectation Failed</li><li style="list-style-type: disc">418: I'm A Teapot</li><li style="list-style-type: disc">421: Misdirected Request</li><li style="list-style-type: disc">422: UnprocessableEntity</li><li style="list-style-type: disc">423: Locked</li><li style="list-style-type: disc">424: FailedDependency</li><li style="list-style-type: disc">425: Unordered Collection</li><li style="list-style-type: disc">426: Upgrade Required</li><li style="list-style-type: disc">428: Precondition Required</li><li style="list-style-type: disc">429: Too Many Requests
</li><li style="list-style-type: disc">431: Request Header Fields Too Large</li><li style="list-style-type: disc">451: Unavailable For Legal Reasons</li><li style="list-style-type: disc">500: Internal Server Error</li><li style="list-style-type: disc">501: Not Implemented</li><li style="list-style-type: disc">502: Bad Gateway</li><li style="list-style-type: disc">503: Service Unavailable</li><li style="list-style-type: disc">504: Gateway Timeout</li><li style="list-style-type: disc">505: HTTP Version Not Supported</li><li style="list-style-type: disc">506: Variant Also Negotiates</li><li style="list-style-type: disc">507: Insufficient Storage</li><li style="list-style-type: disc">508: Loop Detected</li><li style="list-style-type: disc">509: Bandwidth Limit Exceeded</li><li style="list-style-type: disc">510: Not Extended</li><li style="list-style-type: disc">511: Network <span>Authentication</span><a id="id325755155" class="indexterm"></a> Required</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>
Note that 5xx status code errors do not expose the error message to the response body in Koa.</p></div></div>