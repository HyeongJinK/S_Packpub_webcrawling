<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec75"></a>Reconstructing sample images</h2></div></div><hr /></div><p>We will also reconstruct some sample images to see how the <span>model</span><a id="id325642572" class="indexterm"></a> is performing. We will use the following images as the input:</p><div class="mediaobject"><img src="/graphics/9781789132212/graphics/4607aa5f-3343-47de-8f0c-4083999bb9b6.png" /></div><p>The code for reconstructing the preceding images is as follows:</p><pre class="programlisting">def <span>reconstruct_sample(mode</span>l, n_samples=5):
x_test, y_test = load_data(load_type='test')
    sample_images, sample_labels = x_test[:BATCH_SIZE], y_test[:BATCH_SIZE]
    saver = tf.train.Saver()
    ckpt = tf.train.get_checkpoint_state(CHECKPOINT_PATH_DIR)
with tf.Session() as sess:
saver.restore(sess, ckpt.model_checkpoint_path)
        feed_dict_samples = {model.X: sample_images, model.Y: sample_labels}
        decoder_out, y_predicted = sess.run([model.decoder_output, model.y_predicted],
feed_dict=feed_dict_samples)
reconstruction(sample_images, sample_labels, decoder_out, y_predicted, n_samples)</pre><p>The reconstruction function for plotting the images and saving them is given as follows:</p><pre class="programlisting">def reconstruction(x, y, decoder_output, y_pred, n_samples):
'''
    This function is used to reconstruct sample images for analysis
    :param x: Images
    :param y: Labels
    :param decoder_output: output from decoder
    :param y_pred: predictions from the model
    :param n_samples: num images
    :return: saves the reconstructed images
    '''

sample_images = x.reshape(-1, IMG_WIDTH, IMG_HEIGHT)
    decoded_image = decoder_output.reshape([-1, IMG_WIDTH, IMG_WIDTH])

    fig = plt.figure(figsize=(n_samples * 2, 3))
for i in range(n_samples):
plt.subplot(1, n_samples, i+ 1)
        plt.imshow(sample_images[i], cmap="binary")
        plt.title("Label:" + IMAGE_LABELS[np.argmax(y[i])])
        plt.axis("off")
    fig.savefig(RESULTS_DIR + '/' + 'input_images.png')
    plt.show()

    fig = plt.figure(figsize=(n_samples * 2, 3))
for i in range(n_samples):
plt.subplot(1, n_samples, i + 1)
        plt.imshow(decoded_image[i], cmap="binary")
        plt.title("Prediction:" + IMAGE_LABELS[y_pred[i]])
        plt.axis("off")
    fig.savefig(RESULTS_DIR + '/' + 'decoder_images.png')
    plt.show()</pre><p>The reconstructed images now look like this:</p><div class="mediaobject"><img src="/graphics/9781789132212/graphics/207a68b2-2719-484b-9a42-b84398dabce3.png" /></div><p>As we can see, the labels are perfect, while the reconstructed <span>images</span><a id="id325611689" class="indexterm"></a> aren't as perfect but very similar. With more hyper parameter tuning, we can generate much better reconstructed images.</p></div>