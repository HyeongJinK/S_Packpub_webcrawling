<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec44"></a>Training the model</h2></div></div><hr /></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Move to the folder where you <span>cloned</span><a id="id326557202" class="indexterm"></a> the code from the repository, and train the model with the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>python tensorflow/examples/speech_commands/train.py</strong></span></pre><p>You will start seeing the output of the training as follows:</p><pre class="programlisting"><span class="strong"><strong>I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA</strong></span>
<span class="strong"><strong>I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:897] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero</strong></span>
<span class="strong"><strong>I tensorflow/core/common_runtime/gpu/gpu_device.cc:1405] Found device 0 with properties:</strong></span>
<span class="strong"><strong>name: Quadro P5000 major: 6 minor: 1 memoryClockRate(GHz): 1.506</strong></span>
<span class="strong"><strong>pciBusID: 0000:01:00.0</strong></span>
<span class="strong"><strong>totalMemory: 15.90GiB freeMemory: 14.63GiB</strong></span>
<span class="strong"><strong>I tensorflow/core/common_runtime/gpu/gpu_device.cc:1484] Adding visible gpu devices: 0</strong></span>
<span class="strong"><strong>I tensorflow/core/common_runtime/gpu/gpu_device.cc:965] Device interconnect StreamExecutor with strength 1 edge matrix:</strong></span>
<span class="strong"><strong>I tensorflow/core/common_runtime/gpu/gpu_device.cc:971] 0</strong></span>
<span class="strong"><strong>I tensorflow/core/common_runtime/gpu/gpu_device.cc:984] 0: N</strong></span>
<span class="strong"><strong>I tensorflow/core/common_runtime/gpu/gpu_device.cc:1097] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14168 MB memory) -&gt; physical GPU (device: 0, name: Quadro P5000, pci bus id: 0000:01:00.0, compute capability: 6.1)</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Once the training iterations start, the code prints out the learning rate, along with accuracy and the cross entropy loss on the training set, as follows: </li></ol></div><pre class="programlisting"><span class="strong"><strong>INFO:tensorflow:Training from step: 1</strong></span>
<span class="strong"><strong>INFO:tensorflow:Step #1: rate 0.001000, accuracy 12.0%, cross entropy 2.662751</strong></span>
<span class="strong"><strong>INFO:tensorflow:Step #2: rate 0.001000, accuracy 6.0%, cross entropy 2.572391</strong></span>
<span class="strong"><strong>INFO:tensorflow:Step #3: rate 0.001000, accuracy 11.0%, cross entropy 2.547692</strong></span>
<span class="strong"><strong>INFO:tensorflow:Step #4: rate 0.001000, accuracy 8.0%, cross entropy 2.615582</strong></span>
<span class="strong"><strong>INFO:tensorflow:Step #5: rate 0.001000, accuracy 5.0%, cross entropy 2.592372</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>The code also keeps saving the model every 100 steps, so that if training is interrupted, then it can be restarted from the latest checkpoint saved:</li></ol></div><pre class="programlisting"><span class="strong"><strong>INFO:tensorflow:Saving to "/tmp/speech_commands_train/conv.ckpt-100"</strong></span></pre><p> </p><p>The training runs for several hours for 18,000 steps and at the end prints the final training learning rate, accuracy, loss, and confusion matrix as follows:</p><pre class="programlisting"><span class="strong"><strong>INFO:tensorflow:Step #18000: rate 0.000100, accuracy 90.0%, cross entropy 0.420554</strong></span>
<span class="strong"><strong>INFO:tensorflow:Confusion Matrix:</strong></span>
<span class="strong"><strong> [[368 2 0 0 1 0 0 0 0 0 0 0]</strong></span>
<span class="strong"><strong> [ 3 252 9 6 13 15 13 18 17 1 13 11]</strong></span>
<span class="strong"><strong> [ 0 1 370 12 2 2 7 2 0 0 0 1]</strong></span>
<span class="strong"><strong> [ 3 8 4 351 8 7 6 0 0 0 3 16]</strong></span>
<span class="strong"><strong> [ 3 4 0 0 324 1 3 0 1 5 7 2]</strong></span>
<span class="strong"><strong> [ 4 3 4 19 1 330 3 0 0 1 3 9]</strong></span>
<span class="strong"><strong> [ 2 2 12 2 4 0 321 7 0 0 2 0]</strong></span>
<span class="strong"><strong> [ 3 7 1 1 2 0 4 344 1 0 0 0]</strong></span>
<span class="strong"><strong> [ 5 10 0 0 9 1 1 0 334 3 0 0]</strong></span>
<span class="strong"><strong> [ 4 2 1 0 33 0 2 2 7 317 4 1]</strong></span>
<span class="strong"><strong> [ 5 2 0 0 15 0 1 1 0 2 323 1]</strong></span>
<span class="strong"><strong> [ 4 17 0 33 2 8 0 1 0 2 3 302]]</strong></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip37"></a>Note</h3><p>One observation from this output is that, although the code starts with a learning rate of 0.001, it reduces the learning rate to 0.001 towards the end. Since there are 12 command words, it also prints out a 12 x 12 confusion matrix.</p></div><p>The code also prints the accuracy and confusion matrix on the validation set as follows:</p><pre class="programlisting"><span class="strong"><strong>INFO:tensorflow:Step 18000: Validation accuracy = 88.5% (N=4445)</strong></span>
<span class="strong"><strong>INFO:tensorflow:Saving to "/tmp/speech_commands_train/conv.ckpt-18000"</strong></span>
<span class="strong"><strong>INFO:tensorflow:set_size=4890</strong></span>
<span class="strong"><strong>INFO:tensorflow:Confusion Matrix:</strong></span>
<span class="strong"><strong> [[404 2 0 0 0 0 0 0 0 0 2 0]</strong></span>
<span class="strong"><strong> [ 1 283 10 3 14 15 15 22 12 4 10 19]</strong></span>
<span class="strong"><strong> [ 0 7 394 4 1 3 9 0 0 0 1 0]</strong></span>
<span class="strong"><strong> [ 0 8 7 353 0 7 9 1 0 0 0 20]</strong></span>
<span class="strong"><strong> [ 2 4 1 0 397 6 2 0 1 6 5 1]</strong></span>
<span class="strong"><strong> [ 1 8 1 36 2 342 6 1 0 0 0 9]</strong></span>
<span class="strong"><strong> [ 1 2 14 1 4 0 386 4 0 0 0 0]</strong></span>
<span class="strong"><strong> [ 1 9 0 2 1 0 10 368 3 0 1 1]</strong></span>
<span class="strong"><strong> [ 2 13 0 0 7 10 1 0 345 15 3 0]</strong></span>
<span class="strong"><strong> [ 1 8 0 0 34 0 3 1 14 329 7 5]</strong></span>
<span class="strong"><strong> [ 0 1 1 0 11 3 0 0 1 2 387 5]</strong></span>
<span class="strong"><strong> [ 3 16 2 58 6 9 3 2 0 1 1 301]]</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Finally, the code prints the test set accuracy as follows:</li></ol></div><pre class="programlisting"><span class="strong"><strong>INFO:tensorflow:Final test accuracy = 87.7% (N=4890)</strong></span></pre><p>That's it. The model has been trained and can be exported for serving through TensorFlow, or embedding in another desktop, web, or mobile app.</p></div>