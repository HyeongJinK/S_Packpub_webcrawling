<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec22"></a>How I approach the discussion</h2></div></div><hr /></div><p>When I begin a discussion on <span>migration</span><a id="id324953586" class="indexterm"></a> to Azure with an organization, it is a bit different than a greenfield discussion because we have something in our hands. We know the size, shape, and history of the application we are moving. Let’s look at things we should do in this scenario.</p><p>We want to start by assessing the applications <span>and</span><a id="id324953597" class="indexterm"></a> infrastructure, and we do this in the following way:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Discovery, which allows us to peek under the hood of the applications and infrastructure needed to support them. This is not only the code but such things as DNS and services needed to support the application. This is helpful, as not every application is a good candidate to migrate or you may need to secure VPN connect to the internal resources that can’t be moved to Azure.</li><li style="list-style-type: disc">This will lead to mapping your applications to discover all dependencies, which to me is the best exercise as every single organization I have consult with discovered something new with this process.</li><li style="list-style-type: disc">Once you have all this together, you can evaluate which applications make good candidates to move to Azure and which ones need to be modernized.</li></ul></div><p>Once you have gathered this information, you will have some choices to make and it is good to get into those uncomfortable conversations within the organization so as to fit your applications into one of the following buckets:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Rehost</li><li style="list-style-type: disc">Refactor</li><li style="list-style-type: disc">Re-architect</li><li style="list-style-type: disc">Rewrite</li></ul></div><p>Let’s take a deeper look into what these mean and how each has its own merits depending on the state of your application and discovery.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec5"></a>Rehost</h3></div></div></div><p><span class="strong"><strong>Rehosting</strong></span> is the basic approach to the <span class="strong"><strong>lift and shift</strong></span> model. There are no <span>code</span><a id="id325441696" class="indexterm"></a> changes and it is basically the fastest way to migrate. I just want to remind everyone that this can be the costliest approach to moving to Azure, but is arguably the simplest.</p><p>We use this approach in the following situations:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">There is a need to move applications into Azure quickly</li><li style="list-style-type: disc">Applications require being run on a VM</li><li style="list-style-type: disc">You do not want to change code or can’t (no source code)</li></ul></div><p>Once migrated, I will look for opportunities to optimize, but usually in this scenario there aren't many opportunities other than rapid scaling.. Let’s look at what this would look like:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/e9c66ecf-a18f-4a30-a30f-d8f6e4432d59.png" /></div><p>Some good tools to assist in this type of migration are the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Azure <span>Site</span><a id="id326028149" class="indexterm"></a> Recovery: <a class="ulink" href="https://azure.microsoft.com/en-us/services/site-recovery/" target="_blank">https://azure.microsoft.com/en-us/services/site-recovery/</a></li><li style="list-style-type: disc">Data Migration Tool: <a class="ulink" href="https://azure.microsoft.com/en-us/services/database-migration/" target="_blank">https://azure.microsoft.com/en-us/services/database-migration/</a></li></ul></div><p>Now, it is at this point that we <span>need</span><a id="id325588533" class="indexterm"></a> to remember that this type of environment will need boundaries like an on-premise environment does, so don’t forget about your firewalls, load balancer, and routing. Quite a few organizations forget about these and then get burned on their budget because of the cost of these resources. With the complexity of on-premise networks, you should list all the resources you will need. Also, keep in mind, that you can use your licenses to help lower the cost of the VM in Azure.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec6"></a>Refactor</h3></div></div></div><p>Another Azure migration is to <span class="strong"><strong>refactor</strong></span>, which involves <span>making</span><a id="id325588552" class="indexterm"></a> some changes to the application but not wholesale changes that completely change the code base. For instance, instead of moving the VM, only move the web application. This would require some configuration or code changes to make this happen, which we will discuss in depth in this chapter.</p><p>When I have done this, I do the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Assess how to quickly modernize the app to leverage Azure better while keeping costs down</li><li style="list-style-type: disc">Provide more code portability and code reuse</li><li style="list-style-type: disc">Assess when I want a better DevOps and continuous innovation journey</li></ul></div><p>I approach refactoring for Azure in the following way:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">I review the code to ensure that dependencies are able to run in the cloud</li><li style="list-style-type: disc">I review data structures that might need to be moved into Azure</li><li style="list-style-type: disc">I look for VPN/Express Route opportunities to leverage on-premise resources over wholesale moves.</li></ul></div><p>An example of this was when I had a client that wanted to move their web frontends to Azure without moving the data repositories into Azure. I started the POC with a site-to-site VPN and then transitioned to ExpressRoute. This begins the process of moving in line with your Azure governance/plan process if you choose this process based on the plan. Let’s look at this process in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/26b5985f-1e42-4f7c-9741-f0b22abc6812.png" /></div><p>As you can see in the preceding diagram, we did not move the VM but moved the IIS applications to App Services and the data repositories to data instances. This will require us to make changes to the configuration and code updates to interact with these new instance-based services. This allows us to scale differently and control cost a bit better.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec7"></a>Re-architect</h3></div></div></div><p><span class="strong"><strong>Re-architecting</strong></span> is the start of a more <span>intrusive</span><a id="id325588608" class="indexterm"></a> approach to migrating to Azure, as it will require you to modify or extend your code base to align more with modern approaches to scale and optimization. This is a more costly effort in the context of the overall investment if your code base and will require more business sign-off and testing.</p><p>I use this approach in the following situations:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">When I need to evolve an application to be Azure compatible.</li><li style="list-style-type: disc">When I need an application to scale better and the code not written to scale</li></ul></div><p>Let’s take a quick look at how this might look in the following diagram: </p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/5a053dc2-d64b-41be-a162-538242d005ed.png" /></div><p>As you can see, re-architecting may <span>change</span><a id="id325588638" class="indexterm"></a> the shape of your application and require some business buy-off to cover resource costs, but, at the end of the day, will help the overall application and its success moving to Azure.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec8"></a>Rewrite</h3></div></div></div><p><span class="strong"><strong>Rewriting</strong></span> is the most intrusive process, as you will be <span>starting</span><a id="id325588690" class="indexterm"></a> from scratch with your application and this by far includes the most business commitment. You will be gathering new requirements and possibly changing the flow of the application because the application is no longer supportable in its current condition.</p><p>I use this approach in the following situations:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">When an application is past its lifespan and functionality or relies on outdated third-party resources</li><li style="list-style-type: disc">When I need to use more cloud-native technologies</li></ul></div><p>As you can see in the following diagram, the application is completely written to take advantage of new modern resources in Azure:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/ee5a91a1-a3ef-4b5b-b26a-12a3fee61aa2.png" /></div><p>As you can see, the application is leveraging all the new Azure components, but let’s look at some simple migrating to Azure.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec9"></a>Creating resources in the Azure Portal</h3></div></div></div><p>Before we look at using ARM templates, let’s review <span>how</span><a id="id325588728" class="indexterm"></a> we create our resources within the portal and we will also see how we can get the automation scripts to help with our ARM templates and PowerShell script. We will walk through creating a VM in Azure with the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Log into the Azure portal (<a class="ulink" href="https://portal.azure.com/" target="_blank">https://portal.azure.com/</a>)</li><li>Once logged in, you can click <span class="strong"><strong>+ Create a resource</strong></span>, select the resource you would like to create, and then fill in the required information.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Once it has been created, head over to the resource and scroll down to <span class="strong"><strong>Automation script</strong></span>. There you will find your PowerShell and JSON template files that you can download and include in a Visual Studio project. You will need to modify the parameters and such, but it’s really a great starting place: </li></ol></div><div class="mediaobject"><img src="/graphics/9781786468659/graphics/2493ecf6-3137-4177-8673-65b7223f18c2.png" /></div><p>This was helpful to me, as I was able to visualize the code to better understand it. Now let’s move on to the JSON and PowerShell ARM templates.</p></div></div>