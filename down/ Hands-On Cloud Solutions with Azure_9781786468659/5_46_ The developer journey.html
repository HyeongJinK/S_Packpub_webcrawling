<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec50"></a>The developer journey</h2></div></div><hr /></div><p>As I began my journey in software delivery, I had to learn to keep things simple, and this went against all my principles as an engineer. We engineers like to take complicated things and further complicate them. I believed the more complicated the solution, the more intelligent one looks. I came to find the error in my thought process and learned that the simplicity of things was far more important. There is an elegance to keeping development simple in software so you can provide a solution while keeping the development of that solution small in nature<span>. </span> This is a hard principle to convey to folks that haven’t experienced the long nights and hours of pulling your hair out with complex solutions.  So I now look for things with synergies to keep things simple, for instance using ASP.NET MVC and Angular; with both being MVC (Model-View-Controller) based, they play nicely together.  Learning the direct connection to <span>resources</span><a id="id324953585" class="indexterm"></a> instead of keeping them decoupled gave me the ability to recover from a failure because of durable messaging queues.  The moral of this babbling is the <span class="strong"><strong>Keep It Simple, Stupid</strong></span> (<span class="strong"><strong>K.I.S.S.</strong></span>) principle, which will make your life easier in Azure.</p><p>Now keep in mind that the term Workload, as we discussed in the prior chapter, is the package that is used to install resources in Visual Studio.  A workload can also mean the resources in Azure that do work, such as SQL workloads or file processing workloads.  It is good to learn these terms and understand how they apply to communication and understanding.  It took me a while to learn that the terms you use have an effect on what people understand or take away from a conversation, and I have learned to use this terminology to keep folks on the same page.</p><p>Let’s look at some choices to <span class="emphasis"><em>lift and shift</em></span> your applications to Azure that minimize code changes. This isn’t the be all and end all, but is a good starting point:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/5ab136f5-e877-4a61-8b44-1f073bcefc28.png" /></div><p>Let’s look at some lift and shift to data stores in Azure; this again isn’t the be all and end all, but a good starting point:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/807585ac-a656-4c6c-bba7-40738526ca00.png" /></div><p>As a reminder, most <span>Azure</span><a id="id325783421" class="indexterm"></a> storage has <span class="strong"><strong>Transparent Data Encryption</strong></span> (<span class="strong"><strong>TDE</strong></span>) by default, but you want to ensure it is on.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>TDE, once turned on, encrypts data only after that point, <span>make sure you have it turned on before you load/migrate data.</span></p></div><p> Now, as you start to work on your application, you should plan the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Perform FMA (failure mode analysis):
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Identify the types of failures</li><li style="list-style-type: disc">Plan on the effect and impact of failure</li><li style="list-style-type: disc">Identify recovery paths</li></ul></div></li><li style="list-style-type: disc">Plan on multiple instances</li><li style="list-style-type: disc">Leverage auto-scaling</li><li style="list-style-type: disc">Use load balancing to distribute the load</li><li style="list-style-type: disc">Monitor third-party services</li><li style="list-style-type: disc">Use the asynchronous development pattern as much as possible</li><li style="list-style-type: disc">Leverage Dependency Injection as much as possible</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec24"></a>Let's talk about security</h3></div></div></div><p>While this book isn’t about security, one of the main things you want to take into account when you develop solutions in the cloud is security.  With that in mind, I would like to highlight <span>some</span><a id="id325793077" class="indexterm"></a> useful resources in Azure that can make your operation engineer a bit happier. You want to ensure that you create a unified approach to this, not only from a management perspective but from a threat protection perspective as well.  You want to ensure that you can cover the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Monitor both cloud and on-premise workloads</li><li style="list-style-type: disc">Ensure standards and compliance through policies</li><li style="list-style-type: disc">Find and fix vulnerabilities quickly</li><li style="list-style-type: disc">Leverage access and control to limit malicious activities</li><li style="list-style-type: disc">Simplify investigation with analytics and threat intelligence to detect and respond to attacks</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec11"></a>Honorable mention – security center</h4></div></div></div><p>To help me with this, I like <span>using</span><a id="id325793105" class="indexterm"></a> Azure Security Center. It offers a significant amount of insight into my Azure Resources and comes in two pricing tiers at the moment.  I recommend the Standard tier for most organizations, as it is well worth the monthly fee, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/261e72f4-8541-43f0-b4bc-f26b432ca35d.png" /></div><p>Security Center Pricing</p><p><span class="strong"><strong>Security Center</strong></span> is a useful tool, even in <span>the</span><a id="id325793130" class="indexterm"></a> free tier, to help with securing your Azure resources, or if nothing else, giving you extra eyes for security, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/575ea225-b6bc-450f-a392-cdbce4b1454c.png" /></div><p>Security Center Dashboard</p><p>I would recommend you spend some time reviewing the Security Center documentation at <a class="ulink" href="https://docs.microsoft.com/en-us/azure/security-center/" target="_blank">https://docs.microsoft.com/en-us/azure/security-center/</a> for a better understanding of how to use it within your organization development and operations processes. Now, let’s look at application authentication. Now, for developers, there are two flavors you can choose from AAD, which is good for <span class="strong"><strong>internal</strong></span> applications that only members of the organization need to access, and Business to Consumer, or B2C, which you can leverage for external people to access without complicating your AAD.  <span>To understand B2C it is the old Organization Unit or OU in the internal AD that isolates the members and creates an easier identity management model.</span>  Let’s look at AAD first.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec12"></a>Application authentication</h4></div></div></div><p><span class="strong"><strong>Azure Active Directory</strong></span> is a Microsoft identity manager and is used to create intelligence-driven <span>access</span><a id="id325822604" class="indexterm"></a> policies that <span>are</span><a id="id325822611" class="indexterm"></a> used to secure Azure resources.  Every Tenant created in Azure is backed by an Azure Active Directory, which assists in the Role-Based Access Control, or RBAC, which is the identity <span>model that Azure resource leverage for security</span>.  It is shared between both SaaS based solutions such as Office 365 and IaaS/PaaS based solutions such as App Services/VMs in Azure.  Here, you can see the basic flow of a user authenticating:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/7862fbfc-0f9f-4530-979c-f4c9ef420985.png" /></div><p>Basic Login Flow</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>You need to remember all applications need to be registered with AAD.  AAD supports OAuth 2.0 and OpenID Connection standards.</p></div><p>If you would like to dive a bit deeper into AAD and learn more about it, I would suggest you use the 2.0 endpoint documentation at <a class="ulink" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-appmodel-v2-overview" target="_blank">https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-appmodel-v2-overview</a>.  Now, let’s see how we add it to your application.</p><p>First, add your <strong class="userinput"><code>Application Registration</code></strong> to AAD within the Azure portal, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/5d839640-8863-4596-bc2e-69bbf67f1829.png" /></div><p>Add Application Registration</p><p>Make sure to note the <span class="strong"><strong>Application ID</strong></span>, as you can see here. You will need this for your configuration within your application:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/bb1ada6a-b409-43ac-a559-cf9986e774f9.png" /></div><p>Application Registration Screen</p><p></p><p><span>To add security to your application,</span> let's take a quick look at adding it to an ASP.NET MVC (Model-View-Controller) application. For the ASP.NET web application, make sure to add the following package with the package manager:</p><pre class="programlisting"><span class="strong"><strong>Install-Package Microsoft.Owin.Security.OpenIdConnect</strong></span>
<span class="strong"><strong>Install-Package Microsoft.Owin.Security.Cookies</strong></span>
<span class="strong"><strong>Install-Package Microsoft.Owin.Host.SystemWeb</strong></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip24"></a>Note</h3><p>Sometimes, your application may not include a Startup.cs, so you just need to right-click on the project folder and say Add &gt; New Item &gt; OWIN Startup class, then name it Startup.cs.</p></div><p>The examples are in C# and you will need to add the following in the Startup.cs.</p><p>Update the references to include the OWIN Authentication; we will be using <code class="literal">OpenConnectID</code> in this example:</p><pre class="programlisting"><span class="strong"><strong>using Microsoft.Owin;</strong></span>
<span class="strong"><strong>using Owin;</strong></span>
<span class="strong"><strong>using Microsoft.IdentityModel.Protocols.OpenIdConnect;</strong></span>
<span class="strong"><strong>using Microsoft.IdentityModel.Tokens;</strong></span>
<span class="strong"><strong>using Microsoft.Owin.Security;</strong></span>
<span class="strong"><strong>using Microsoft.Owin.Security.Cookies;</strong></span>
<span class="strong"><strong>using Microsoft.Owin.Security.OpenIdConnect;</strong></span>
<span class="strong"><strong>using Microsoft.Owin.Security.Notifications;</strong></span></pre><p>Then, in the <code class="literal">Startup</code> class, add these variables:</p><pre class="programlisting">// This is the ApplicationID to Azure AD.
string clientId = System.Configuration.ConfigurationManager.AppSettings["ClientId"];
// RedirectUri where the user will be redirected to after they sign in.
string redirectUri = System.Configuration.ConfigurationManager.AppSettings["RedirectUri"];
// Your Tenant ID
static string tenant = System.Configuration.ConfigurationManager.AppSettings["Tenant"];
// Authority is the URL for authority, https://login.microsoftonline.com/&lt;Tenant&gt;/v2.0
string authority = String.Format(System.Globalization.CultureInfo.InvariantCulture, System.Configuration.ConfigurationManager.AppSettings["Authority"], tenant);</pre><p> </p><p> </p><p>Add this to the <code class="literal">Configuration</code> method:</p><pre class="programlisting">app.SetDefaultSignInAsAuthenticationType(CookieAuthenticationDefaults.AuthenticationType);
        app.UseCookieAuthentication(new CookieAuthenticationOptions());
        app.UseOpenIdConnectAuthentication(
            new OpenIdConnectAuthenticationOptions
            {
                ClientId = clientId,
                Authority = authority,
                RedirectUri = redirectUri,
                PostLogoutRedirectUri = redirectUri,
                Scope = OpenIdConnectScope.OpenIdProfile,
                ResponseType = OpenIdConnectResponseType.IdToken,
                TokenValidationParameters = new TokenValidationParameters()
                {
                    ValidateIssuer = false
                },
                Notifications = new OpenIdConnectAuthenticationNotifications
                {
                    AuthenticationFailed = OnAuthenticationFailed
                }
            }
        );</pre><p>Then, add the following method for <span>what</span><a id="id325937524" class="indexterm"></a> to do on authentication failure:</p><pre class="programlisting">private Task OnAuthenticationFailed(AuthenticationFailedNotification&lt;OpenIdConnectMessage, OpenIdConnectAuthenticationOptions&gt; context)
    {
        context.HandleResponse();
        context.Response.Redirect("/?errormessage=" + context.Exception.Message);
        return Task.FromResult(0);
    }</pre><p>Then, in the Home Controller, all you have to do is add the following.</p><p>Add resources for OWIN:</p><pre class="programlisting">using Microsoft.Owin.Security;
using Microsoft.Owin.Security.Cookies;
using Microsoft.Owin.Security.OpenIdConnect;</pre><p>Then, add two actions. Sign in as follows:</p><pre class="programlisting">public void SignIn()
{
    if (!Request.IsAuthenticated)
    {
        HttpContext.GetOwinContext().Authentication.Challenge(
            new AuthenticationProperties{ RedirectUri = "/" },
            OpenIdConnectAuthenticationDefaults.AuthenticationType);
    }
}</pre><p>Sign out as follows:</p><pre class="programlisting">public void SignOut()
{
    HttpContext.GetOwinContext().Authentication.SignOut(
            OpenIdConnectAuthenticationDefaults.AuthenticationType,
            CookieAuthenticationDefaults.AuthenticationType);
}</pre><p>Add the following HTML to the Home View:</p><pre class="programlisting">@if (!Request.IsAuthenticated)
{
    &lt;a href="@Url.Action("SignIn", "Home")" style="text-decoration: none;"&gt;
        &lt;svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="300px" height="50px" viewBox="0 0 3278 522" class="SignInButton"&gt;
        &lt;style type="text/css"&gt;.fil0:hover {fill: #4B4B4B;} .fnt0 {font-size: 260px;font-family: 'Segoe UI Semibold', 'Segoe UI'; text-decoration: none;}&lt;/style&gt;
        &lt;rect class="fil0" x="2" y="2" width="3174" height="517" fill="black" /&gt;
        &lt;rect x="150" y="129" width="122" height="122" fill="#F35325" /&gt;
        &lt;rect x="284" y="129" width="122" height="122" fill="#81BC06" /&gt;
        &lt;rect x="150" y="263" width="122" height="122" fill="#05A6F0" /&gt;
        &lt;rect x="284" y="263" width="122" height="122" fill="#FFBA08" /&gt;
        &lt;text x="470" y="357" fill="white" class="fnt0"&gt;Sign in with Microsoft&lt;/text&gt;
        &lt;/svg&gt;
    &lt;/a&gt;
}
else
{
    &lt;span&gt;&lt;br/&gt;Hello @System.Security.Claims.ClaimsPrincipal.Current.FindFirst("name").Value;&lt;/span&gt;
    &lt;br /&gt;&lt;br /&gt;
    @Html.ActionLink("See Your Claims", "Index", "Claims")
    &lt;br /&gt;&lt;br /&gt;
    @Html.ActionLink("Sign out", "SignOut", "Home")
}
@if (!string.IsNullOrWhiteSpace(Request.QueryString["errormessage"]))
{
    &lt;div style="background-color:red;color:white;font-weight: bold;"&gt;Error: @Request.QueryString["errormessage"]&lt;/div&gt;
}</pre><p>And bingo, you now are using AAD to authenticate your user, but wait, people can still get to things without logging in.  Well, now that you have created a way for people to log in, you have not yet secured your site. To do this, we want to lock it down, which can be done globally by a Controller or Action.  I always recommend globally, because it is easier to loosen up security than remember to tighten it down, <span>but let’s look at how to do each way first.</span></p><p>To add authentication globally, add the following to <code class="literal">global.asa</code>. In the <code class="literal">app_start</code> section, add the following:</p><pre class="programlisting">GlobalFilters.Filters.Add(new AuthorizeAttribute());</pre><p><span>Now you will be challenging any route/action you choose from a security/logged perspective.</span>  Now, if you want to allow access to an Action, you will need to add the <code class="literal">[AllowAnonymous]</code> attribute to the Action.  In this case, go to your Home Controller and the Index action, then add the <code class="literal">[AllowAnonymous]</code> attribute.  You will now be able to browse to the default homepage without logging in.</p><p>This is basically how you <span>will</span><a id="id326077390" class="indexterm"></a> integrate any application into AAD. Now, B2C functions in the same way, as you will need to register the application; however, you will need to also generate a key, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/fa97a19a-b59b-4d9e-94f0-c558d41723d2.png" /></div><p>Generating a key for an Application Registration</p><p>But before we can do this, we will need to create the B2C Tenant. Remember I said that an instance of Azure Active Directory was connected to a Tenant?  Well, we will need to create a new Tenant that we will use to secure our applications. To create a new B2C Tenant, click <strong class="userinput"><code>+ Create a resource</code></strong> then type <strong class="userinput"><code>Azure Active Directory B2C</code></strong> and hit <span class="emphasis"><em>Enter</em></span>, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/719a1acf-6bd3-4718-961f-6de96bb783bb.png" /></div><p>Search for Azure B2C Tenant to create</p><p>Then click <strong class="userinput"><code>Create</code></strong>, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/e9aafc46-e95a-4432-842d-b776215c1721.png" /></div><p>Create a B2C Tenant</p><p>At this point, you can create a new B2C Tenant or link to an existing one, as you can see here. For the purposes of this discussion, we will create a new one, so click on <strong class="userinput"><code>Create a new Azure AD B2C Tenant</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/33ac09d9-7c6b-4eae-9f71-5330a0cf98ac.png" /></div><p>Create or Link to a B2C Tenant</p><p>Then, enter you <strong class="userinput"><code>Organization name</code></strong>, <strong class="userinput"><code>Initial <span>domain</span><a id="id326077962" class="indexterm"></a> name</code></strong>, and <strong class="userinput"><code>Country or region</code></strong>, as you can see here:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/9563a0a5-35eb-4c3a-a7ac-082275f763e9.png" /></div><p>Enter new B2C Tenant information</p><p> </p><p> </p><p>To navigate to your new Tenant, you will need to switch over to it, as you can see here. This will function like AAD, with a few exceptions. You will need to create policies to leverage in your development, along with assigning permissions to your <span>app service principle</span>:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/dd2a219b-048c-42f5-9548-1cd14aaf75ca.png" /></div><p>Switch to new B2C Tenant</p><p>Now, the configuration of B2C is subjective, according to the policies you want to leverage, which I wasn’t looking to fully cover in this book.  You can do a deeper dive into B2C at <a class="ulink" href="https://docs.microsoft.com/en-us/azure/active-directory-b2c/" target="_blank">https://docs.microsoft.com/en-us/azure/active-directory-b2c/</a>. I would, however, like to share some things I learned that aren’t documented <span>very</span><a id="id326078090" class="indexterm"></a> well, and I would also recommend you fully research the resource you want to use in Azure to gain more knowledge about the pros and cons.  <span>We ran into an issue where the graph had issues with password changing and resetting, that drove me crazy but here is how I fixed it.</span>  Here are the PowerShell commands I ran on the B2C Tenant:</p><pre class="programlisting"><span class="strong"><strong>Connect-MsolService</strong></span>
<span class="strong"><strong>$applicationId = "App ID from app you are needing to elevate permission"</strong></span>
<span class="strong"><strong>$sp = Get-MsolServicePrincipal -AppPrincipalId $applicationId</strong></span>
<span class="strong"><strong># Directory Read</strong></span>
<span class="strong"><strong>Add-MsolRoleMember -RoleObjectId 88d8e3e3-8f55-4a1e-953a-9b9898b8876b -RoleMemberObjectId $sp.ObjectId -RoleMemberType servicePrincipal</strong></span>
<span class="strong"><strong># Directory Write</strong></span>
<span class="strong"><strong>Add-MsolRoleMember -RoleObjectId 9360feb5-f418-4baa-8175-e2a00bac4301 -RoleMemberObjectId $sp.ObjectId -RoleMemberType servicePrincipal</strong></span>
<span class="strong"><strong># User Account Admin – for deletes</strong></span>
<span class="strong"><strong>Add-MsolRoleMember -RoleObjectId fe930be7-5e62-47db-91af-98c3a49a38b1 -RoleMemberObjectId $sp.ObjectId -RoleMemberType servicePrincipal</strong></span></pre><p>But as you can see, security gets a bit easier in Azure and there is less to worry about once <span>you</span><a id="id326078147" class="indexterm"></a> get things set up. Now, one <span>thing</span><a id="id326078153" class="indexterm"></a> I added to my development work is <span class="strong"><strong>Inversion of Control</strong></span> (<span class="strong"><strong>IoC</strong></span>), commonly called <span class="strong"><strong>Dependency Injection</strong></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec25"></a>Let's talk Dependency Injection</h3></div></div></div><p>The purpose of <span class="strong"><strong>Dependency Injection</strong></span> (<span class="strong"><strong>DI</strong></span>), is that the <span>flow</span><a id="id326078361" class="indexterm"></a> of control within the application is not controlled by the application but by the underlying framework.  Here are s<span>ome common DI frameworks and while this book isn't about telling you how to develop, I thought pointing this out will help with your overall development process:</span></p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Castle Windsor</li><li style="list-style-type: disc">Spring.NET</li><li style="list-style-type: disc">Unity </li><li style="list-style-type: disc">MEF</li><li style="list-style-type: disc">.Net Core</li></ul></div><p> </p><p>I like using DI because it allows me to loosely couple code and update smaller pieces of code in the long run. It pairs itself great with the DevOps process I will discuss in the next chapter.  It help with unit testing as you can use mocks to generate the implementation of the injected object.</p><p>There are three types of DI:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><span class="strong"><strong>Constructor Injection</strong></span>: This requires <span>specific</span><a id="id326078510" class="indexterm"></a> values at the time of creation I order to instantiate the object. These values are provided through parameters. This is most commonly encountered when a class requires one or more dependencies. This helps by providing a strong dependency contract, and can be immutable, but also supports better testing.
<p>Services are resolved using two mechanisms:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The interface IServiceProvider</li><li style="list-style-type: disc">User-facing abstractions, such as MVC controllers or model binders, called ActivatorUtilities, which allow object creation with service registrations</li></ul></div></li><li><span class="strong"><strong>Setter Injection</strong></span>: This allows <span>costly</span><a id="id326078534" class="indexterm"></a> resources to be created as required and as late as possible. I would like to note that dependencies can be difficult to identify, because the up-front wiring of a dependency graph is not required. You will need to NULL check before using it.</li><li><span class="strong"><strong>Method Injection</strong></span>: This is the <span>least</span><a id="id326078548" class="indexterm"></a> used DI, because it injects dependencies into a single method.</li></ol></div><p>With DI, the main benefits are that your code is more testable, maintainable, reusable, and readable. So, I would recommend using DI as much as possible. One good example is injecting logging into class, which <span>allows you to change the "where" your logs go at a whim</span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec26"></a>Let's talk logging</h3></div></div></div><p><span class="strong"><strong>Logging</strong></span> was one of the biggest <span>things</span><a id="id326078574" class="indexterm"></a> I had to adjust to in Azure. I was so used to being able to dig things out of a server that it was like second nature.  The first time I had to dig things out of Azure due to poor logging, I went cross-eyed staring at the log stream.  So, I adopted NLog because I liked how configurable it was and that it followed my DI pattern.  <span>I also learned how to use it for informational purposes, because in Azure you want to ensure your application can self-heal and/or fails gracefully, allowing developers code swallowing errors and moving on, is a bad practice. </span> You can read the documentation on NLog at <a class="ulink" href="https://nlog-project.org/" target="_blank">https://nlog-project.org/</a> and install the NuGet package with this:</p><pre class="programlisting"><span class="strong"><strong>install-package Microsoft.ApplicationInsights.NLogTarget</strong></span></pre><p>Whether or not your use NLog, you need to make sure you are logging as much as you can to help you support your application and organization. Remember the mantra: life in Azure is always easier with logging!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec27"></a>Let's talk about data storage</h3></div></div></div><p>I am one of those older developers <span>who</span><a id="id326078605" class="indexterm"></a> remember the database-first approach.  I also used LINQ back in the day to load my POCO objects.  Then, in stepped Entity Framework, to <span>which I was like "hey this is awesome".</span>  Then, in steps the concept of code-first, which left me going "why?"  But, I decided to give it a go and it was a great learning experience, as I found my code to be more testable as I could mock the data object, but quickly learned that updating the data model in future releases was troublesome. I then learned that migrations were one of the most important things to understand in order to be truly successful with code-first.  But, one of the biggest gains was I did not need to couple to a repository and had the freedom to develop solutions with little to no concern about what my repository was. <span>Some hard lessons that I had to learn were things like using data annotations to control my string length so my string fields wouldn't be NVARCHAR (Max). </span> To read move on this topic, head over to <a class="ulink" href="https://docs.microsoft.com/en-us/ef/ef6/modeling/code-first/data-annotations" target="_blank">https://docs.microsoft.com/en-us/ef/ef6/modeling/code-first/data-annotations</a>.  You can also read more on how to use code-first in a team environment at <a class="ulink" href="https://docs.microsoft.com/en-us/ef/ef6/modeling/code-first/migrations/teams" target="_blank">https://docs.microsoft.com/en-us/ef/ef6/modeling/code-first/migrations/teams</a>. </p></div></div>