<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec70"></a>Monitoring</h2></div></div><hr /></div><p>An effective monitoring strategy is an essential part of the journey in Azure. <span class="strong"><strong>Monitoring</strong></span> in Azure comprises of a group of individual services that come together to deliver comprehensive <span>telemetry</span><a id="id324953598" class="indexterm"></a> about your applications and resources in Azure. These services can also span to on-premise to provide a single source of truth for your monitoring. Monitoring fits into a few categories.</p><p>Let's take a look at them.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Core capabilities, which include Azure Monitor, Advisor, Service Health, and Activity Log</li><li style="list-style-type: disc">Shared capabilities, which include Dashboards, Alerts, and Metric Explorer</li><li style="list-style-type: disc">Infrastructure capabilities, which include network monitoring, Service Map, Management Solutions, and Log Analytics.</li><li style="list-style-type: disc">Application capabilities, which include Application Insights</li></ul></div><p>Let take a moment to look into each of them, so we can better understand how we can use them.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec37"></a>Core capabilities</h3></div></div></div><p>Core monitoring provides fundamental core <span>telemetry</span><a id="id325433757" class="indexterm"></a> monitoring across Azure resources and <span>requires</span><a id="id325433861" class="indexterm"></a> minimal configuration to use. Azure Monitor provides metrics, activity logs, and diagnostic logs for all Azure services. These are great little starting points for issues. Let's look at the <span class="strong"><strong>Activity Log</strong></span>, shown in the following screenshot, as we have already covered the Azure Advisor:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/1976e7b1-36d9-4fb2-a7ef-095486bc4574.png" /></div><p>Activity Log</p><p>The <span class="strong"><strong>Activity Log</strong></span> is where you usually will start when things don't go 100% right. You can also find the other useful monitoring and support resources in your Azure resources at the bottom of the resource menu, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/97a31a5e-22d6-493a-a089-8bc2fbb8ea55.png" /></div><p>Monitoring and support in resources</p><p>There are very useful tools for supporting your Azure resources. I have leveraged Log Stream to help diagnose issues in Azure but this is a tough way to find things as it displays the active event loggings as they happen. This is why it is important to include logging in your application to make it easier to troubleshoot.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec38"></a>Shared capabilities</h3></div></div></div><p>We have already discussed dashboards <span>and</span><a id="id325435338" class="indexterm"></a> how important I feel they are, but I believe another underutilized part of monitoring is alerting. I put alerts around everything I can, include third-party integration endpoints <span>which I learn the hardware when went go sideways</span>. Alerting is based on action groups, which contain a unique set of recipients and actions in response to an alert. Alerts can be created under various scenarios and rules. I like to find out things before my clients do. You can read more about alerting at <a class="ulink" href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts" target="_blank">https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts</a>. Let's take a quick look at how easy it is to set up an alert.</p><p>Head to the <span class="strong"><strong>Alerts</strong></span> blade under the <span class="strong"><strong>Monitor</strong></span> link, and then select the <span class="strong"><strong>Alert</strong></span> menu option, as you can see in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/3cab4799-aa93-44db-b543-96d78b06ec98.png" /></div><p>Monitoring Alert blade</p><p>You then select <span class="strong"><strong>+ New alert rule</strong></span>,<span class="strong"><strong> </strong></span>then <span class="strong"><strong>+ Select source</strong></span>, and choose options to display the source. In this case, it is an <strong class="userinput"><code>App Service</code></strong>, as you can see in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/682a514b-ea44-4df9-b905-bff0d02b3368.png" /></div><p>Creating an alert and selecting the source</p><p>Then select <span class="strong"><strong>+ Add criteria</strong></span>, and <span>then</span><a id="id325438663" class="indexterm"></a> select <span class="strong"><strong>All Http Error</strong></span>, as you can see in the following screenshot, and then click <span class="strong"><strong>Done</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/7f9c3b94-5f1a-4898-8c20-ce15ee462a64.png" /></div><p>Adding criteria for an alert</p><p>Click on <span class="strong"><strong>2. Define alert details</strong></span> and add your alert details, as you see in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/f1250da8-5c08-42a8-ad86-c2e48c639d4c.png" /></div><p>Alert details</p><p></p><p>We then click on <span class="strong"><strong>Define action group</strong></span>, where you can select an existing one or create a new one, as you can see in the following screenshot.</p><p>You can create action types of the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Email/SMS/Push/Voice</li><li style="list-style-type: disc">Azure Function</li><li style="list-style-type: disc">Logic App</li><li style="list-style-type: disc">Webhook</li><li style="list-style-type: disc">ITSM</li><li style="list-style-type: disc">Automation Runbook</li></ul></div><div class="mediaobject"><img src="/graphics/9781786468659/graphics/dc15e93b-de6a-4e7c-a323-258948af0e3d.png" /></div><p>Defining your action group</p><p>As you can see, alerts are <span>highly</span><a id="id325441690" class="indexterm"></a> configurable and extremely useful, so I recommend using them as much as possible and even integrating them into your support system to create tickets.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec39"></a>Infrastructure capabilities</h3></div></div></div><p><span class="strong"><strong>Log Analytics</strong></span> is a great tool <span>for</span><a id="id325441732" class="indexterm"></a> providing a <span>single</span><a id="id325593819" class="indexterm"></a> repository of the collected data by Azure monitoring. Even Application Insights and Security Center can store their data within Log Analytics, which can be its analytics engine on the data. Management solutions are a set of logic that are packaged to support a particular resource in Azure, such as a container or SQL monitoring. Management solutions rely on Log Analytics to store and analyze the data. There are other monitors that work with various aspects of your network resources. Let's take a quick look at them:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Network Watcher, which is scenario-based monitoring and uses Azure metrics to store data</li><li style="list-style-type: disc">Network Performance Monitor, which monitors your connectivity to other environments</li><li style="list-style-type: disc">Express Route <span>Monitor, which is used to monitor you Express Route circuits.</span></li><li style="list-style-type: disc">DNS <span>Analytics, used for stats on your Azure DNS traffic.</span></li><li style="list-style-type: disc">Service Endpoint Monitor, which tests the endpoints and detects service issues</li><li style="list-style-type: disc">Service Map is a pretty cool, as it visualizes your resources and their dependencies.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec40"></a>Application capabilities</h3></div></div></div><p><span class="strong"><strong>Application Insights</strong></span> is the main <span>tool</span><a id="id325593860" class="indexterm"></a> for applications. It can also be configured to trap telemetry by default. As I explained before, leveraging this with NLog <span>provides</span><a id="id325593869" class="indexterm"></a> great logging <span>support</span><a id="id326028132" class="indexterm"></a> with minimal effort. You can also leverage it in your alerting strategy and you can use the Analytic tools to visualize the queries in graphs. The default blade is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/04735d2a-7095-4d56-9314-9c7a122eb409.png" /></div><p>App Insights blade</p><p>I generally use the Analytics portion to run queries against my data store for both informational and support purposes. You can also look at overall application performance and alert on performance issues as well. Let's look at the Analytics dashboard, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/fcb5fca5-5f09-4429-91dc-fe205bc4f4b1.png" /></div><p>Analytics dashboard</p><p>Ask you can see, there are <span>quite</span><a id="id325695369" class="indexterm"></a> a few <span>Insights</span><a id="id325695376" class="indexterm"></a> available. I general mostly use exceptions, traces, <span class="strong"><strong>customEvents</strong></span>, <span class="strong"><strong>performanceCounters</strong></span>, and <span class="strong"><strong>customMetrics</strong></span>. One of the coolest features is the integration with Visual Studio, but I could spend an <span>entire</span><a id="id325695395" class="indexterm"></a> book on Application Insight and its uses. For further reading on this, head to <a class="ulink" href="https://docs.microsoft.com/en-us/azure/application-insights/" target="_blank">https://docs.microsoft.com/en-us/azure/application-insights/.</a></p></div></div>