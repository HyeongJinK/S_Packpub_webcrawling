<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec34"></a>Designing applications in Azure</h2></div></div><hr /></div><p>I like to design applications for more scale, resilience, and manageability. Here are <span>some</span><a id="id324953579" class="indexterm"></a> things to keep in mind:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Make your applications self-healing as much as possible:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Design for failures and handle them</li><li style="list-style-type: disc">Log and monitor</li></ul></div></li><li style="list-style-type: disc">Build for scaling out:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Offload resource intensive tasks</li><li style="list-style-type: disc">Design for scale in</li><li style="list-style-type: disc">Identify bottlenecks
</li></ul></div></li><li style="list-style-type: disc">Partition around resource limits:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Understand limits and use partitioning to get around them; you can find more information at the following link: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits" target="_blank">https://docs.microsoft.com/en-us/azure/azure-subscription-service-limits</a></li></ul></div></li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Design with DevOps in mind:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Monitoring</li><li style="list-style-type: disc">Deploying</li><li style="list-style-type: disc">Escalation</li><li style="list-style-type: disc">Security/auditing</li><li style="list-style-type: disc">Make all thing observable</li><li style="list-style-type: disc">Treat configuration as code</li></ul></div></li><li style="list-style-type: disc">Design for evolution:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Use loose coupling</li><li style="list-style-type: disc">Use asynchronous development patterns whenever possible</li><li style="list-style-type: disc">Use interfaces</li><li style="list-style-type: disc">Design for testing</li><li style="list-style-type: disc">Deploy services independently</li></ul></div></li></ul></div><p>There are a magnitude of design patterns to choose from. If you're finding it hard to decide which one to use, you can review them at <a class="ulink" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/" target="_blank">https://docs.microsoft.com/en-us/azure/architecture/patterns/</a>.</p><p>As we move forward, having discussed some common design approaches, Azure also enhances the five pillars of software development. Let's see what are they:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Scalability
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Horizontal scale: This is elastic and can be triggered automatically. It is also more cost-effective than vertically scaling.</li><li style="list-style-type: disc">Vertical scale: Can increase the resources assigned to a resource.</li><li style="list-style-type: disc">Scalability Checklist Document: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/architecture/checklist/scalability" target="_blank">https://docs.microsoft.com/en-us/azure/architecture/checklist/scalability</a>.</li><li style="list-style-type: disc">Scalability Design Patterns for Performance: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability" target="_blank">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/performance-scalability</a>.
</li></ul></div></li><li style="list-style-type: disc">Availability 
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Defined by resources</li><li style="list-style-type: disc">Availability Design Patterns: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/availability" target="_blank">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/availability</a></li></ul></div></li><li style="list-style-type: disc">Resiliency
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Closely related to Availability</li><li style="list-style-type: disc">Resiliency Design Patterns: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/architecture/resiliency/index" target="_blank">https://docs.microsoft.com/en-us/azure/architecture/resiliency/index</a></li></ul></div></li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Management
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Leverage DevOps in your software development</li><li style="list-style-type: disc">Use instrumentation</li><li style="list-style-type: disc">Visualize and alert</li><li style="list-style-type: disc">Analysis and diagnose</li><li style="list-style-type: disc">Monitoring Design Patterns: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/category/management-monitoring" target="_blank">https://docs.microsoft.com/en-us/azure/architecture/patterns/category/management-monitoring</a></li></ul></div></li><li style="list-style-type: disc">Security
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Identity management using Azure AD as much as possible</li><li style="list-style-type: disc">Use RBAC as much as possible to protect the infrastructure</li><li style="list-style-type: disc">Secure your applications</li><li style="list-style-type: disc">Use data encryption whenever possible</li><li style="list-style-type: disc">Security Center: <a class="ulink" href="https://azure.microsoft.com/en-us/services/security-center/" target="_blank">https://azure.microsoft.com/en-us/services/security-center/</a></li><li style="list-style-type: disc">Security Documents: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/security/" target="_blank">https://docs.microsoft.com/en-us/azure/security/</a></li><li style="list-style-type: disc">Microsoft Trust Center: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/security/" target="_blank">https://docs.microsoft.com/en-us/azure/security/</a></li></ul></div></li></ul></div><p>One of the most crucial choices you have to <span>make</span><a id="id325438612" class="indexterm"></a> when building solutions on Azure is whether or not you are working with sensitive information. If the information is sensitive in nature or falls under <span class="strong"><strong>P</strong></span><span class="strong"><strong>ersonally Identifiable Information</strong></span> (<span class="strong"><strong>PII</strong></span>), <span class="strong"><strong>Health Insurance Privacy and Portability Act</strong></span>  (<span class="strong"><strong>HIPPA</strong></span>), or GDFR, you will need to look at isolated networks environments in Azure. These choices <span>come</span><a id="id325438670" class="indexterm"></a> with consequences, even in closed ecosystems, as you will need to manage things like access (firewalls) and load balancing. However, you do gain extended isolation and can extend your internal network into this more secure piece of Azure.</p><p>Several environments <span>fit</span><a id="id325438679" class="indexterm"></a> into this, such as <span class="strong"><strong>App Service Environment</strong></span> (<span class="strong"><strong>ASE</strong></span>), Service Fabric, Custom VNets, and so on. It is crucial to understand this as this can drive cost. Isolated environments cost a significant amount more, not only from an Azure perspective but from an organization perspective (as there are more components in Azure to manage).</p><p>As fast as Azure changes, I typically look for opportunities to leverage the best of breed to solve issues. Typically, you will look up things based on what you are used to using internally, and Azure offers a bit more. So, when I typically want to do something in Azure, I look for what I am looking to accomplish, not what I am looking to do. For example, I may not look up how to store large amounts of data in SQL and look more at how to store telemetry data in Azure for IoT devices. This opened my eyes to the IoT hub as a transport and CosmosDB, which had the added benefit of speed.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec23"></a>Some of my thoughts on selecting resources in Azure</h3></div></div></div><p>Basically, there is not really a silver bullet as to <span>how</span><a id="id325763267" class="indexterm"></a> to solve problems using Azure, and I believe you should approach things in a way that makes sense for you. I wanted to run through a few of the resources that I leverage a lot in Azure. With that being said, here is how I work at approaching things. Most of the time, the direction I choose in Azure is based on the organization/team I am working with and their overall core competency. This means that if I am working with a .NET or JavaScript shop, I will pick solutions that align with these, like using Node.js over C# for the JavaScript shop. I sometimes look at the need to leverage multiple cloud models, like deploying to Azure and AWS.</p><p>First and foremost, I always start with DevOps in mind, which leads to developing solutions with deploy-ability and support-ability in mind. I would at least leverage Application Insights for logging and configure it for all my resources by default. Application Insights is like the Event Log in Azure. If you don't take these to heart, supporting your applications in Azure can be very difficult to diagnose.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip17"></a>Note</h3><p>Use Application Insights for all your resources to make your life easier when supporting your application. For more information, go to <a class="ulink" href="https://docs.microsoft.com/en-us/azure/application-insights/app-insights-overview" target="_blank">https://docs.microsoft.com/en-us/azure/application-insights/app-insights-overview</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec5"></a>App Services</h4></div></div></div><p>For web solutions, I generally use App Services or Container Instances, depending on whether I am deploying as a .NET package or a Docker container. As a <span>quick</span><a id="id325763294" class="indexterm"></a> side note, App Service now encapsulates Container, Logic, and Function App services.  The use of Docker containers allows for the deployment model to not be cloud-specific or require application updating because all the code and its dependencies are usually self-contained within the Docker container. When I need to create a web service (web API) or better yet, an endpoint, I would traditionally choose to redeploy it to an App Service or convert it to a function or a Logic App. A function is an App Service that can be run serverless or VM backed, and are basically <span>small</span><a id="id325763303" class="indexterm"></a> microservices. Functions were designed to run stateless, quick, small pieces of code that are trigger by an event like a timer or endpoint call execution. When the need arises to run long-running transactions, you can leverage either Web-Jobs or Logic Apps, which were designed for this purpose. So, as you can see, App Services can leverage a variety of languages and offer multiple ways to solve issues. You can also leverage isolated App Services for App Services that use PII or GDFR. </p><p>When building or hosting web applications within App Services, the infrastructure supports both Windows and Linux with auto-scaling and high availability; let’s look at how the resources pan out. App Services are controlled by App Service Plans, these plans can be shared with multiple App Services; however, I recommend in most scenarios you to do one App Service per App Service Plan to maintain better application isolation for scaling. The reason for this is that the App Service is the scalable part of App Service, so any applications can use the App Service Plan scale with the App Service Plan, which may or may not be intended. Each App Service defines the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Instances of application code</li><li style="list-style-type: disc">Instance size</li><li style="list-style-type: disc">Region hosted in</li><li style="list-style-type: disc">Resource pricing tier and features</li></ul></div><p>Now, instance scale is based on the pricing tier you choose, so let’s look at the pricing tiers first, which will be focused on Windows-based App Services as the Linux model is still maturing in Azure and only has free for 30 days on the lowest B1 tier at the moment:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Shared compute resources fall within the Free (F1) or the Shared (D1) tiers under the Dev/Test workload tab, as we can see in the following figure. These resources are shared and don’t scale, so with this fact I would only use them for Dev/QA App Services. If you need to leverage a custom domain, I would use D1; however, you can leverage an SSL Cert, so if that is a requirement I stay in the F1 tier and the underlying Azure Website cert, or move out of the Shared Compute tier.  As you can see, for the ability to add a custom domain, there is a price increase:</li></ul></div><div class="mediaobject"><img src="/graphics/9781786468659/graphics/0d08c089-a211-4c17-85f4-6384e59d20df.png" /></div><p>Shared compute pricing tier</p><p>Shared compute hosting plans are run on a shared VM with other customers and are not intended to run production workloads.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Dedicated compute resources include Basic (B1-3), Standard (S1-3), Premium (P1-3), and Premium V2 (P1V2 – 3V3). These resources run on Azure VMs, which we refer to as VM backed.  App Plans can share their resources with other App Services<span>, which is different from the F1 and D1 tiers.</span>  Dedicated compute introduces the ability to use custom SSL (B1 or above), instances (scale out), deployment slots, traffic manager, and daily backups. Let’s look at the Production Workload tab in the following figure:</li></ul></div><div class="mediaobject"><img src="/graphics/9781786468659/graphics/993721fc-4af9-4ad7-b6f9-88f15b203080.png" /></div><p>Production Workload tab</p><p></p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Isolated compute is provided by Isolated (I1-3) tiers that exist within ASE, which are privately dedicated resources that are used to isolate sensitive data applications such as PII OR GDFR. Single-tenant system, Isolated network, Private app access, and max scale (up to 100 instances) are introduced in this pricing tier.  Let’s look at the pricing tier in the following figure for isolated resources:</li></ul></div><div class="mediaobject"><img src="/graphics/9781786468659/graphics/151042a9-4f27-4c77-ac30-7ba99461bbe7.png" /></div><p>Isolated workload tier</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The Consumption tier was introduced in App Services when they moved Function Apps under App Services. The scaling is dynamic depending on the workload and is truly utility based, that is, you pay for what you use.  It does, however, suffer from cold starting.</li></ul></div><p>The dedicated tiers are in three sizes:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Small</strong></span>: 1x core with 3.5 GB memory</li><li style="list-style-type: disc"><span class="strong"><strong>Medium</strong></span>: 2x cores with 7 GB memory</li><li style="list-style-type: disc"><span class="strong"><strong>Larger</strong></span>: 4x cores with 14 GB memory</li></ul></div><p> </p><p>Remember, as you scale out the pricing is per instance increases <span>so the pricing tier x time number of instances will be your monthly cost as you can see in the following screenshot, which is good to understand before turning on Auto-Scale</span>. The charges are compiled hourly and the isolated compute includes a worker in addition to a base hourly fee for the isolated resources:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/3f5d77aa-8ed3-461d-93f4-ddae1d11e90f.png" /></div><p>App Service scaling</p><p>The features included, such as App Service Domains and App Service Certs, are at an additional cost. App Service Certs are issued by GoDaddy and are rotated for you each year without the need for you to remember to order the cert.</p><p>Using App Service Certs, while rotated for you, still requires a refresh with the App Service to get the new version in the Key Vault.</p><p>As you can see, App Services have a variety of option to choose from, including the types of App Services you can choose from, such as <span>WebJobs</span>, functions, Logic Apps, Containers, and so on.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec6"></a>Database services</h4></div></div></div><p>For database solutions, I generally look at SQL/MySQL (transactional) or CosmosDB (schemaless). I use CosmosDB mostly for telemetry data from devices and SQL/MySQL for transactional data that usually originates from web forms or file loads. When I <span>need</span><a id="id325867118" class="indexterm"></a> to load data, I will <span>usually</span><a id="id325867127" class="indexterm"></a> use Azure Batch or HPC (Hi Performance Compute). With SQL managed instances, I can move an existing database to the cloud for legacy databases or I can migrate more modern databases to the cloud. For more on migration planning, go to <a class="ulink" href="https://docs.microsoft.com/en-us/azure/dms/tutorial-sql-server-to-azure-sql" target="_blank">https://docs.microsoft.com/en-us/azure/dms/tutorial-sql-server-to-azure-sql</a>.</p><p>When you work with SQL in Azure, you will create a <span>main</span><a id="id325867142" class="indexterm"></a> central administration point or server, which is a container for single or elastic databases.  This container controls the firewall rules, auditing rules, threat detection policies, and failover groups.  Data is stored with <span class="strong"><strong>Transparent Data Encryption</strong></span> (<span class="strong"><strong>TDE</strong></span>), by default, which encrypts your data at rest.</p><p>These are the data repository types:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Single database</strong></span>: Own set of <span>resources</span><a id="id325875907" class="indexterm"></a> managed via an administration server</li><li style="list-style-type: disc"><span class="strong"><strong>Elastic database</strong></span>: With a shared set of resources <span>managed</span><a id="id325875921" class="indexterm"></a> via an administration server</li><li style="list-style-type: disc"><span class="strong"><strong>Manage instances</strong></span>: Contains <span>system</span><a id="id325875934" class="indexterm"></a> and user databases and shares a set of resources</li></ul></div><p>Pricing for single or elastic SQL <span>databases</span><a id="id325875945" class="indexterm"></a> is based on <span class="strong"><strong>Data Transfer Units</strong></span> (<span class="strong"><strong>DTUs</strong></span>), and they represent the resource power assigned to the database.  They are a blended measurement of memory, CPU, and read-write.  Elastic instances use an elastic version, which provides a range of shared resources that cannot be consumed by a single database but ensure that the pool always has a minimum available.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>The Azure DTU calculator is a great tool for calculating the DTU needed and can be found at <a class="ulink" href="http://dtucalculator.azurewebsites.net/" target="_blank">http://dtucalculator.azurewebsites.net/</a>.  Also, remember Single database have limits by tier: <span class="strong"><strong>Basic</strong></span> (2 GB size, 5 DTUs), <span class="strong"><strong>Standard</strong></span> (1 TB size, 3000 DTUs), and <span class="strong"><strong>Premium</strong></span> (4 TB size, 4000 DTUs).  For eDTUs, the limits are <span class="strong"><strong>Basic</strong></span> (2 GB size, 156 GB pool size, 5 eDTU/DB, 1600 eDTUs/pool, 500 DB/pool), <span class="strong"><strong>Standard</strong></span> (1 TB size, 4 TB pool size, 3000 eDTU/DB, 3000 eDTUs/pool, 500 DB/pool), and <span class="strong"><strong>Premium</strong></span> (1 TB size, 4 TB pool size, 4000 eDTU/DB, 4000 eDTUs/pool, 100 DB/pool).</p></div><p>Managed SQL instances are based on vCores, were created for the lift and shift database model, <span>and were put in place to “as is” data migration to Azure</span> with no database or application updating needed, except for configuration changes.  This model is based on VM instance resources, cores, and memory, to support the pricing tiers shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/3407ce7f-816f-4de9-b092-778b210caa7a.png" /></div><p>Manage Instance pricing</p><p>There are two service tiers:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>General Purpose</strong></span>: Typical availability <span>and</span><a id="id325903709" class="indexterm"></a> common IO latency requirements</li><li style="list-style-type: disc"><span class="strong"><strong>Business Critical</strong></span>: High availability and low IO <span>latency</span><a id="id325903723" class="indexterm"></a> requirements</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec7"></a>Storage accounts</h4></div></div></div><p>Storage accounts were put into place to help provide a filesystem style structure for data/blob object repositories in the cloud.  Their pricing tiers cover <span>physical</span><a id="id325903738" class="indexterm"></a> storage and ingress/egress.  These data <span>objects</span><a id="id325903747" class="indexterm"></a> are usually stored in the following fashion:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Azure blobs are used for text and binary data</li><li style="list-style-type: disc">Azure files are for file shares in the cloud</li><li style="list-style-type: disc">Azure Queues are used for reliable messaging</li><li style="list-style-type: disc">Azure tables are for the schema-less storage of structured data</li></ul></div><p>There are currently two <span>types storage media</span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Standard</strong></span>: Storage on <span>magnetic</span><a id="id325969218" class="indexterm"></a> storage devices</li><li style="list-style-type: disc"><span class="strong"><strong>Premium</strong></span>: <span>Storage</span><a id="id325969232" class="indexterm"></a> on SSD</li></ul></div><p>All data is written to the stores with <span class="strong"><strong>Storage Service Encryption</strong></span> (<span class="strong"><strong>SSE</strong></span>) and can <span>leverage</span><a id="id325969251" class="indexterm"></a> RBAC from AAD to manage access. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip19"></a>Note</h3><p>You will need to manage CORS rules for your resource that access resources from other domains. CORS, or Cross-Origin Resource Sharing, is not an authentication mechanism but an access one from other domains.</p></div><p>They have three storage account options:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>General Purpose v2 (GPv2): Support all the latest features, and you can choose better hot and cold storage tiers</li><li>General Purpose v2 (GPv1): For high churn or read rates</li><li>Blob Storage: Supports all blob features</li></ol></div><p>Let's take a look at pricing for storage and data transfers into Azure.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Azure Storage Pricing: <a class="ulink" href="https://azure.microsoft.com/en-us/pricing/details/storage/" target="_blank">https://azure.microsoft.com/en-us/pricing/details/storage/</a></li><li style="list-style-type: disc">Data Transfer Pricing: <a class="ulink" href="https://azure.microsoft.com/en-us/pricing/details/bandwidth/" target="_blank">https://azure.microsoft.com/en-us/pricing/details/bandwidth/</a></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec8"></a>CosmosDB</h4></div></div></div><p>The pricing of this flexible <span>globally</span><a id="id325971008" class="indexterm"></a> distributed multi-model <span>data</span><a id="id325971016" class="indexterm"></a> store is based on <span class="strong"><strong>Request Units</strong></span> (<span class="strong"><strong>RU/s</strong></span>). This is a throughput charge for read, write, and query operations and has a minimum of 400 RUs. There is a secondary charge for SSD storage of data.  With <span>CosmosDB</span><a id="id325971031" class="indexterm"></a> being a premium service in Azure, it can get more costly. You can also replicate globally, as you can see in the following figure:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/96ad3b6a-9d4f-4f9f-9b56-130c3cc2974c.png" /></div><p>CosmosDB global view</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip20"></a>Note</h3><p>I have learned that missteps in using CosmosDB can be costly.  One main thing I had to learn to help with this is to read the x-ms-retry-after-ms header when my RU quota was exceeded.</p></div><p>Like SQL, CosmosDB data collections scale by the collection/repository, as you can see in the following figure. You can adjust your RUs assigned to your collection from this view. It's good to keep an eye on the daily spend to get an estimate of monthly burn:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/a32f5642-8c0b-4b35-9ab4-da0724044cd0.png" /></div><p>CosmosDB RUs</p><p>CosmosDB leverages Azure Functions for a trigger on database inserts or updates. Azure functions are small serverless pieces of code.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec9"></a>Microservices/containers</h4></div></div></div><p>Most of the microservices in <span>Azure</span><a id="id325971116" class="indexterm"></a> will leverage App Services; however, you may <span>need</span><a id="id325971125" class="indexterm"></a> a better management service, such as Kubernetes or Service Fabric. <span class="strong"><strong>Service Fabric</strong></span> is basically Microsoft's version of a microservice and container manager that helps with the management of <span>multiple</span><a id="id325971136" class="indexterm"></a> microservices. Service Fabric can automatically heal and manage you microservices in a single location. Kubernetes runs the same as <span>Service</span><a id="id325971142" class="indexterm"></a> Fabric but is mainly for container support. Both of these environments are expensive to run as they require the VM scale set, a  load balancer, and routing under the hood to run.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec10"></a>Real-world examples</h4></div></div></div><p>I had an organization that wanted to move their web applications to Azure but left their database and internal services within their infrastructure. Let’s see how I solved this in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786468659/graphics/5d431b8b-837b-46af-a257-30fd47512ba3.png" /></div><p>Real-world example</p><p>We moved all the websites and middle tier web services to Azure. We then re-exposed the web services using API management so that we could consume them in different formats. <span>Azure API management is resources in Azure that allow you to proxy incoming calls of different formats to a specific format that the endpoint is expecting without rewriting the code.</span>  <span>It is like having an XML endpoint and using API Management to accept JSON that would be transformed to XML and passed to the endpoint as XML.</span>  Express Route was used to securely connect the internal network to an Azure VNet. We then used Application Insights to store all events and exceptions.</p></div></div></div>