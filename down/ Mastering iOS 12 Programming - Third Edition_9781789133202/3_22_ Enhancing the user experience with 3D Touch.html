<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec28"></a>Enhancing the user experience with 3D Touch</h2></div></div><hr /></div><p>One of iOS's lesser-used features is 3D Touch. 3D Touch <span>allows</span><a id="id325333345" class="indexterm"></a> users to perform special interactions with apps by pressing a little bit more firmly on the screen than usual. The iPhone 6s and newer devices support this functionality and it allows for some pretty neat interactions. One of these interactions is called peek and pop.</p><p>With peek and pop, a user can 3D Touch an element on the screen and they'll see a preview of the detail page they would see if they had performed a regular tap on the UI element. The following screenshot shows an example of such a preview:</p><p>Â </p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/3e64432d-a28a-4abe-abdb-5495072e07b2.png" /></div><p>If the user sees a preview like this and they press on their screen a little bit harder, the user commits to seeing this view and they will be taken to the detail page as if they had normally tapped on the contact. Implementing this feature requires only a small amount of effort.</p><p>To implement peek and pop, the source view controller must register its intent to display previews. The source view controller must also conform to <code class="literal">UIViewControllerPreviewingDelegate</code> so it can provide and commit to the preview view controller.</p><p>Before you get to writing the code, <span>there</span><a id="id325333378" class="indexterm"></a> is one change you'll need to make to the storyboard. You currently don't have access to the detail page view controller from code. However, to provide it as a preview view controller, you must be able to provide an instance of <code class="literal">ContactDetailViewController</code>.</p><p>Open the storyboard file and select the detail view controller. Use the <strong class="userinput"><code>Identity Inspector</code></strong> to set a <strong class="userinput"><code>Storyboard ID</code></strong> on the detail view controller. Use <code class="literal">ContactDetailViewController</code> as the value for the <strong class="userinput"><code>Storyboard ID</code></strong> as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/6edc121d-56b0-49b3-b5f7-063264c41bb4.png" /></div><p>You can use the <strong class="userinput"><code>Storyboard ID</code></strong> to <span>create</span><a id="id325337175" class="indexterm"></a> instances of the detail view controller from code. You'll see how in just a second. First, you'll register <code class="literal">ViewController</code> for previewing content. Add the following code to <code class="literal">viewDidLoad()</code> on the <code class="literal">ViewController</code>:</p><pre class="programlisting">if traitCollection.forceTouchCapability == .available {
  registerForPreviewing(with: self, sourceView: collectionView)
}</pre><p>When the current trait collection supports 3D Touch, the view controller is registered for previewing using itself as a delegate. The collection view is used as a source for this interaction since it's the component for which you want to provide previews. The next step is to make <code class="literal">ViewController</code> conform to the <code class="literal">UIViewControllerPreviewingDelegate</code> protocol. Add the following extension to <code class="literal">ViewController.swift</code> to add this conformance:</p><pre class="programlisting">extension ViewController: UIViewControllerPreviewingDelegate {
  func previewingContext(_ previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint) -&gt; UIViewController? {
    guard let tappedIndexPath = collectionView.indexPathForItem(at: location)
      else { return nil }

    let contact = contacts[tappedIndexPath.row]

    guard let viewController = storyboard?.instantiateViewController(withIdentifier:"ContactDetailViewController") as? ContactDetailViewController
      else { return nil }

    viewController.contact = contact
    return viewController
  }

  func previewingContext(_ previewingContext: UIViewControllerPreviewing,
                         commit viewControllerToCommit: UIViewController) {

    navigationController?.show(viewControllerToCommit, sender: self)
  }
}</pre><p>This extension implements <span>two</span><a id="id325578353" class="indexterm"></a> methods: <code class="literal">previewingContext(_:viewControllerForLocation)</code> and <code class="literal">previewingContext(_:commit)</code>. The first method is responsible for providing the previewed view controller. To provide the correct view controller with the correct contact, this code checks whether the 3D Touch occurred on a collection view cell. Next, a view controller is obtained through the storyboard by using the identifier you configured earlier. Finally, the view controller is assigned a contact and returned for previewing.</p><p>The second method is used to commit to seeing the details page. This implementation simply tells the navigation controller to present the view controller that was previewed. When you implement different preview view controllers than the ones you actually want to use when the user commits to navigating to the detail page, you can use the commit method to configure a real detail view controller instead of the preview.</p><p>If you run the project on a device that supports 3D Touch, you should be able to apply some force while tapping on a contact to see their previews appear.</p></div>