<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch22lvl1sec148"></a>Creating an iMessage sticker pack</h2></div></div><hr /></div><p><span class="strong"><strong>Stickers</strong></span> in iMessage are a fun way to share <span>images</span><a id="id325333120" class="indexterm"></a> with your friends. Stickers can be <span>slapped</span><a id="id325333128" class="indexterm"></a> onto a message as a response to a message you've received or just for fun with no particular reason.</p><p>To create a sticker pack, open Xcode and create a new project. One of the available project templates is the <strong class="userinput"><code>Sticker Pack App</code></strong>. Select this template and click <strong class="userinput"><code>Next</code></strong>. Give your sticker pack a name and click <strong class="userinput"><code>Next</code></strong> again to create your project:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/5167e239-bae4-4df5-bd8c-c672414c8e75.png" /></div><p>In the generated project, you'll find two folders. One is named <code class="literal">Stickers.xcstickers</code> and the other is named <code class="literal">Products</code>. When you create a sticker app, you're only interested in the <code class="literal">stickers</code> folder. If you open it, you'll find an app icon template and a folder named <code class="literal">Sticker Pack</code>.</p><p>All you need to do to create your sticker pack is to <span>drag</span><a id="id325333900" class="indexterm"></a> images into this <code class="literal">Sticker Pack</code> folder. After doing this, you can build and run your extension and try it out in the simulator. You'll find that the simulator comes with two active conversations in the Messages app. These are dummy conversations and you'll use them to test your iMessage app.</p><p>The simulator cannot send messages outside the simulator so you must use these predefined conversations while testing. Tapping a sticker or dragging it onto an existing speech bubble will send it from one conversation to the other. Go ahead and give that a shot. You can also send text messages and any other type of message you would normally send in the dummy conversation.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch22lvl2sec115"></a>Optimizing assets for your stickers</h3></div></div></div><p>Creating a sticker <span>pack</span><a id="id325607241" class="indexterm"></a> is really easy, and to make the best sticker packs, you should make sure that you properly optimize your image assets. Stickers can be displayed to the user in three sizes: small, medium, and large. To change the size of stickers in your sticker pack, simply click the <code class="literal">Sticker Pack</code> folder and open the attributes inspector. You can pick the sticker size there.</p><p>You should optimize the size of the stickers you provide according to the display size you choose. The following is a list of sticker sizes and their recommended asset sizes:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Small</strong></span>: 100x100 @3x</li><li style="list-style-type: disc"><span class="strong"><strong>Medium</strong></span>: 136x136 @3x</li><li style="list-style-type: disc"><span class="strong"><strong>Large</strong></span>: 206x206 @3x</li></ul></div><p>Note that all sizes have an @3x annotation. This means that the exported dimension of your images should be three times larger than the size listed to accommodate screens with a 3x resolution, such as the plus-sized iPhones. So, a small sticker should be exported at 300x300 pixels. Unlike other image assets on iOS, you only supply a single image for each sticker, the 3x image. Normally you supply a 1x, 2x, and 3x version of each asset you include in your app.</p><p>Sticker packs can contain PNG images, animated PNG images, GIFs, and JPEGs. All images you use must be smaller than 500 kb. It's recommended that you provide all of your assets as either PNG or animated PNG because this image format has superior image quality and supports transparency. Transparent stickers are recommended because they look a lot better when placed on top of other stickers or messages.</p><p>Now that you're familiar with sticker packs and testing them in the simulator, let's see how we make our sticker <span>pack</span><a id="id325609980" class="indexterm"></a> a bit more special by customizing the sticker-picking interface a bit.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch22lvl2sec116"></a>Creating a custom sticker app</h3></div></div></div><p>The standard sticker app that you created earlier using the sticker <span>pack</span><a id="id325611537" class="indexterm"></a> template is very plain. The generated iMessage app shows stickers on a white background and that's about it. Sticker apps shouldn't be more complex than this, but wouldn't it be great if you could at least change the background color for a sticker app? This isn't possible if you're using the simple sticker pack template. You can, however, create your own sticker pack app and customize the background. Doing this will allow you to familiarize yourself with the code that's involved in creating an iMessage app, so let's create a custom sticker pack.</p><p>In the source code repository for this book, you'll find a project named <code class="literal">CustomStickers</code>. This project already contains the stickers that will be used in the sample app. The images for these stickers are made available through <a class="ulink" href="https://openclipart.org/" target="_blank">openclipart.org</a> by a user named bocian. Note that the images have not been added to the <code class="literal">Assets.xcassets</code> folder, but to the <code class="literal">Stickers</code> folder in <code class="literal">MessagesExtension</code>. The project was set up like this since the <code class="literal">Assets.xcassets</code> folder belongs to the containing app, which will be ignored.</p><p>In the <code class="literal">MessagesExtension</code> folder, you'll find a view controller file and a storyboard file. Open the storyboard and remove the default <code class="literal">UILabel</code> that was placed in the interface. You won't be adding any interface elements through Interface Builder because the interface elements to create a sticker app aren't directly available in Interface Builder.</p><p>You will find several boilerplate methods in the <code class="literal">MessagesViewController</code> class. We'll get into them soon; you can ignore them for now. The <code class="literal">viewDidLoad</code> method will be used to set up <code class="literal">MSStickerBrowserViewController</code> to display stickers in.</p><p>The <code class="literal">MSStickerBrowserView</code> instance that is contained inside <code class="literal">MSStickerBrowserViewController</code> behaves somewhat like <code class="literal">UICollectionView</code> because it requires a data source to determine how many, and which, stickers to display.</p><p>The first step in implementing your own <span>sticker</span><a id="id325617708" class="indexterm"></a> app is to add a property for an instance of <code class="literal">MSStickerBrowserViewController</code> to <code class="literal">MessagesViewController</code>:</p><pre class="programlisting">var stickerBrowser = MSStickerBrowserViewController(stickerSize: .regular)</pre><p>Next, add the following implementation for <code class="literal">viewDidLoad</code>:</p><pre class="programlisting">override func viewDidLoad() {
  super.viewDidLoad()
  stickerBrowser.willMove(toParent: self)
  addChild(stickerBrowser)
  stickerBrowser.didMove(toParent: self)

  view.addSubview(stickerBrowser.view)
  stickerBrowser.stickerBrowserView.dataSource = self
  stickerBrowser.stickerBrowserView.reloadData()
  stickerBrowser.stickerBrowserView.backgroundColor = UIColor.red
}</pre><p>The preceding snippet should not contain any surprises for you. First, <code class="literal">stickerBrowser</code> is added as a child view controller of the messages view controller. Then the <code class="literal">stickerBrowser</code> view is added as a subview of the messages view controller's view. Next, the <code class="literal">dataSource</code> is set on <code class="literal">stickerBrowserView</code> and it is told to reload its data. Lastly, the background color for <code class="literal">stickerBrowserView</code> is set.</p><p>If you build your app now, Xcode will complain about <code class="literal">MessagesViewController</code> not conforming to <code class="literal">MSStickerBrowserViewDataSource</code>. Add the following extension to <code class="literal">MessagesViewController.swift</code> to make <code class="literal">MessagesViewController</code> conform to <code class="literal">MSStickerBrowserViewDataSource</code>:</p><pre class="programlisting">extension MessagesViewController: MSStickerBrowserViewDataSource {
  func stickerBrowserView(_ stickerBrowserView: MSStickerBrowserView, stickerAt index: Int) →; MSSticker {
    return OwlStickerFactory.sticker(forIndex: index)
  }

  func numberOfStickers(in stickerBrowserView: MSStickerBrowserView) → Int {
    return OwlStickerFactory.numberOfStickers
  }
}</pre><p>The first method is expected to return a <span>sticker</span><a id="id325333483" class="indexterm"></a> for a certain index and the second returns the number of stickers in the app. The logic for this is abstracted into a sticker factory. This is done to keep the code in the view controller nice, compact, and to the point. Add a new Swift file to the project and name it <code class="literal">OwlStickerFactory</code>.</p><p>Add the following implementation to this file:</p><pre class="programlisting">import Foundation
import Messages

struct OwlStickerFactory {
  static private let stickerNames = [
    "bike", "books", "bowler", "drunk", "ebook",
    "family", "grill", "normal", "notebook", "party",
    "punk", "rose", "santa", "spring"
  ]

  static var numberOfStickers: Int { return stickerNames.count }

  static func sticker(forIndex index: Int) → MSSticker {
    let stickerName = stickerNames[index]

    guard let stickerPath = Bundle.main.path(forResource: stickerName, ofType: "png")
      else { fatalError("Missing sicker with name: \(stickerName)") }
    let stickerUrl = URL(fileURLWithPath: stickerPath)

    guard let sticker = try? MSSticker(contentsOfFileURL: stickerUrl, localizedDescription: "\(stickerName) owl")
      else { fatalError("Failed to retrieve sticker: \(stickerName)") }

    return sticker
  }
}</pre><p>Most of the preceding code should speak for itself. There is an array of sticker names and a computed variable that returns the number of stickers for the app. The interesting part of this code is the <code class="literal">sticker(forIndex:)</code> method. This method retrieves a <span>sticker</span><a id="id325333507" class="indexterm"></a> name from our array of names. Then it retrieves the file path that can be used to retrieve the image file from the application bundle. Finally, it creates a URL with this path to create a sticker.</p><p>Note that the <code class="literal">MSSticker</code> initializer can throw errors so the initialization call is prefixed with <code class="literal">try?</code>. Also, note that the sticker initializer takes <code class="literal">localizedDescription</code>. This description is used by screen readers to read out a description of the sticker to users that have certain accessibility features enabled.</p><p>When you run your extension now, you should see an interface that looks very similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/7511fe73-b227-4ba3-b2cb-60145d7f0b44.png" /></div><p>You can drag stickers from the sticker browser to the messages view. Notice that the stickers are picked and placed with a nice peel animation. Whenever you add an <code class="literal">MSSticker</code> to the messages view, regardless of whether you use a sticker browser, the Messages framework takes care of the <span>sticker</span><a id="id325333548" class="indexterm"></a> peel, drag, and drop animations for you. This means that you can create a custom interface for your stickers if you'd like.</p><p>Keep in mind that most sticker apps will make use of the standard layout and your users might not be too pleased if your app presents them with an unexpected sticker sheet layout. However, apps that aren't about stickers do require a special layer of design and interaction. This is the next topic covered in this chapter.</p></div></div>