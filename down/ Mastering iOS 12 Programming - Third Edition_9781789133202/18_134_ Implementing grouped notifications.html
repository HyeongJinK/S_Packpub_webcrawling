<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch18lvl1sec125"></a>Implementing grouped notifications</h2></div></div><hr /></div><p>A new feature for <span>notifications</span><a id="id325333116" class="indexterm"></a> in iOS 12 is the <span>possibility</span><a id="id325333172" class="indexterm"></a> to group notifications. iOS will group notifications from an application together by default, showing the user a stack of notifications with the most recent one on top, instead of a long list of mixed notifications from all applications, which is hard to scan through.</p><p>In this section, you will learn exactly how you can implement grouped notifications in your own apps.</p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch18lvl2sec100"></a>Grouping notifications based on thread identifiers</h3></div></div></div><p>Grouped notifications are a huge improvement for the notification system on iOS, which many users have eagerly been waiting for. However, if all <span>notifications</span><a id="id325333192" class="indexterm"></a> for a single app are grouped together, important information might get lost. If a messaging app stacks all notifications in a single group, it's easy to miss an important message if it's hidden somewhere in the group.</p><p>For this reason, Apple allows developers to create custom notification groups based on special thread identifiers. The most obvious use case is to group all notifications from a certain conversation in a messaging app together. However, there are other useful implementations of grouped notifications that you can come up with.</p><p>You could use thread identifiers to separate certain important, actionable notifications from a group of informative notifications. Doing this will make the important notifications stand out to the user, without cluttering the user's Notification Center with several less important informative messages.</p><p>To begin using grouped notifications, all you have to do is assign a thread identifier to a notification content object. For the Notifications app, it would be interesting to group <span>notifications</span><a id="id325333207" class="indexterm"></a> for bedtime and lunchtime notifications together. You can do this by assigning a thread identifier to the notification content object that is created by the notifications helper object. Update the implementation for <code class="literal">addLunchTimeNotification()</code> as follows to assign a thread identifier to a lunchtime notification:</p><pre class="programlisting">@IBAction func addLunchTimeNotification() {
  persistentContainer.viewContext.perform { [unowned self] in
    // existing implementation ...

    let content = self.notificationsHelper.createNotificationContentForReminder(reminder)

    content.threadIdentifier  = "lunchtime-thread"
    self.notificationsHelper.scheduleTimedNotificationWithContent(content)
  }
}</pre><p>Only a single line of code was added to implement a thread identifier. Try adding a thread identifier to the bedtime notification as well, and then run the app. Try scheduling a couple of bedtime and lunchtime notifications to see how iOS groups the notifications based on the thread identifier.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch18lvl2sec101"></a>Providing a custom summary message for your notification group</h3></div></div></div><p>When iOS displays a grouped notification, a summary message is shown at the bottom of the notification bubble. By default, this message simply informs the user about the number of <span>notifications</span><a id="id325333782" class="indexterm"></a> that are available. You can customize this message by providing a summary format yourself.</p><p>Summary formats are tied to <span>notifications</span><a id="id325333793" class="indexterm"></a> through categories. This means that you can add different messages for different notification categories. A custom summary format is supplied in the form of a format string. Update the <code class="literal">UNNotificationCategoryIdentifier</code> initialization code in <code class="literal">AppDelegate.swift</code> to add a custom summary format for the reminder category as follows:</p><pre class="programlisting">let summaryFormat = "%u more reminders for this topic."

let reminderCategory = UNNotificationCategory(identifier: "reminder", actions: [completeAction], intentIdentifiers: [], hiddenPreviewsBodyPlaceholder: nil, categorySummaryFormat: summaryFormat, options: [])</pre><p> </p><p>The summary format passed to the <code class="literal">UNNotificationCategory</code> initializer uses the <code class="literal">%u</code> format specifier to specify where the number of reminders should be displayed. When you run the app and schedule a couple of notifications, the custom summary format should be displayed, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/b29953c5-b015-454a-b0a4-f011395b80fe.png" /></div><p>Note that one of the notification groups shows a <span>slightly strange</span> summary message. It says <strong class="userinput"><code>2 more reminders for this topic</code></strong>. Note the plural for reminders being used in this summary message. It would be much nicer if the summary format could account for this and use <span class="emphasis"><em>"1 more reminder for this topic"</em></span> instead, if there is only a single extra item in the notification group.</p><p> </p><p>You can achieve this by implementing a localized string for the summary format. To do this, start by defining the summary format string in <code class="literal">AppDelegate</code> as follows:</p><pre class="programlisting">let summaryFormat = NSString.localizedUserNotificationString(forKey: "REMINDER_SUMMARY", arguments: nil)</pre><p>The preceding code defines the summary format as a localized string that is specific for notifications. When you define a string like this, iOS will look for the display string in a dedicated file containing all of the strings that you wish to localize for notifications, using the key you have specified.</p><p>Localizations for <span>notifications</span><a id="id325602541" class="indexterm"></a> use a special <code class="literal">.stringsdict</code> localization file that <span>contains</span><a id="id325604090" class="indexterm"></a> information that describes how to localize a string for several quantities. To add a <code class="literal">.stringsdict</code> file, go to <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>New</code></strong> and select the <code class="literal">Stringsdict</code> file from the list of file types. Name your file <code class="literal">Localizable.stringsdict</code> and make sure it's added to your app target. Next, open the <code class="literal">Localizable.stringsdict</code> file and make sure its contents resemble the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/014e5f26-19e9-4364-81c7-8e62c475d006.png" /></div><p>The strings dictionary contains the key that was used in <code class="literal">AppDelegate</code> to identify the string that should be used for the summary label. The <code class="literal">NSStringLocalizedFormatKey</code> string contains a variable that is represented as <code class="literal">%#@reminders@</code>. This variable is the part of the string that you want to localize. In this case, the variable represents the entire message.</p><p>The variable name is then added as a key to the <code class="literal">REMINDER_SUMMARY</code> dictionary to specify the localization rules. In this case, a rule is added for a single item and for multiple items.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip47"></a>Note</h3><p>If you want to know more about the <code class="literal">stringsdict</code> file, make sure to read Apple's documentation on app localization.</p></div><p>Now that you know how to implement grouped notifications, let's see how you can add Notification Extensions to your app.</p></div></div>