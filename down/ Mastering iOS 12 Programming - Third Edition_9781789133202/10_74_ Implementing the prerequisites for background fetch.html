<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec73"></a>Implementing the prerequisites for background fetch</h2></div></div><hr /></div><p>There are three steps involved in supporting <span>background</span><a id="id325333116" class="indexterm"></a> fetch in your app:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Add the background fetch capability to your app.</li><li>Ask iOS to wake your app up.</li><li>Implement <code class="literal">application(_:performFetchWithCompletionHandler:)</code> in <code class="literal">AppDelegate</code>.</li></ol></div><p>You can implement step 1 and 2 right now; step 3 will be implemented separately because this step will involve writing the code to fetch and update the movies using a helper struct.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec52"></a>Adding the background fetch capability</h3></div></div></div><p>Every application has a list of capabilities they can opt in to. Some <span>examples</span><a id="id325333152" class="indexterm"></a> of these capabilities are using Maps, HomeKit, and Background Modes. You can find the <span class="strong"><strong>Capabilities</strong></span> tab in your project settings. If you select your project in the file navigator, you can see the <span class="strong"><strong>Capabilities</strong></span> tab right next to your app's General settings.</p><p>If you select this tab, you will see a list of all the capabilities your app can implement. If you expand a capability, you'll find some information about what the capability does and what happens automatically if you enable it. If you expand the <span class="strong"><strong>Background Modes</strong></span> capability, you'll see the following information:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/890ecdde-04a2-460a-804f-524754194230.png" /></div><p>There are several options that you can enable, but there's just one that you need to focus on for now. The capability you need to enable is <span class="strong"><strong>Background Fetch</strong></span>. Click the on/off checkbox to enable the capability and then check the <span class="strong"><strong>Background Fetch</strong></span> option.</p><p>Enabling <span class="strong"><strong>Background Fetch</strong></span> isn't something that magically changes some invisible settings for your application. You can enable background fetch manually if you'd like to.</p><p>Open the <code class="literal">Info.plist</code> file and search for the <span class="strong"><strong>Required background modes</strong></span> key. You can see that it contains a single item with a value of <span class="strong"><strong>App downloads content from the network</strong></span>. This entry in the <code class="literal">Info.plist</code> file enables your app to ask iOS to wake it up periodically:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/1c5dcede-9ca5-4adb-b6a8-e56a681815e5.png" /></div><p>However, just because you can do this manually does not <span>mean</span><a id="id325606077" class="indexterm"></a> you should. The capabilities tab is a very convenient place to manage capabilities from and manually adding the right key to the <code class="literal">Info.plist</code> file is tedious and error-prone. It's interesting to know that there's no magic involved in this process, and it makes the entire feature feel more transparent.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec53"></a>Asking iOS to wake your app</h3></div></div></div><p>You're halfway there in the process of enabling <span>background</span><a id="id325607086" class="indexterm"></a> fetching for <span class="strong"><strong>MustC</strong></span>. All that's left is inform iOS that it should wake the app up every once in a while. This behavior should be implemented in the <code class="literal">application(_:didFinishLaunchingWithOptions:)</code> method in <code class="literal">AppDelegate</code>. You must ask iOS to wake your app up in this method because you should ask iOS to wake your app up every time your app launches. When your app transitions from the foreground to the background normally, iOS will know that your app should wake up at certain times. However, if the app is killed entirely, iOS won't be able to wake the app up again, so you must ask iOS to wake your app up again as soon as the app launches again.</p><p>There isn't much code involved in enabling background fetching for your app. Add the following line to <code class="literal">application(_:didFinishLaunchingWithOptions:)</code>:</p><pre class="programlisting">application.setMinimumBackgroundFetchInterval(UIApplication.backgroundFetchIntervalMinimum)</pre><p>This line will ask iOS to wake the app up at a minimum interval. This means that the app is woken up as often as iOS will allow it to be woken up. It's impossible to predict how often this will be since iOS throttles this interval as it sees fit. If your app often has new data available or is used many times throughout the day, the odds are that your app will be woken up more often than it would be if you rarely have new data available or if the user opens your app once every couple of days.</p><p>Alternatively, you could set the fetch interval to <code class="literal">UIApplication.backgroundFetchIntervalNever</code> if you want to prevent your app from being woken up at all, or you can use a custom value. If you provide a custom value, iOS will attempt to honor your custom interval, but again, there are no guarantees with background fetch because the system remains in charge concerning the intervals that are used.</p><p>The only thing iOS does guarantee is that your app is not woken up more often than the value you specified. So, let's say you define a custom interval for your app to be woken up once every three hours, iOS won't wake your app more often than that, but it's possible that your app is woken up only once every eight hours. This depends on several factors that are not transparent to you as a developer.</p><p>Your app is now ready to fetch data in the background. Let's go ahead and implement the fetching of data.</p></div></div>