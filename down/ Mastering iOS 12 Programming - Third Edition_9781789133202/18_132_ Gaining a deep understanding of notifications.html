<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch18lvl1sec123"></a>Gaining a deep understanding of notifications</h2></div></div><hr /></div><p>If you use iOS devices on a daily basis, you are probably very familiar with notifications. Sometimes you may have been using your device when you received such a notification; other times, the device might have been in your pocket, on your desk, or somewhere else.</p><p>Notifications are a <span>perfect</span><a id="id325333118" class="indexterm"></a> way for apps to inform users about information in an app that might be of interest to them. New messages in a messaging app, breaking news events, or friend requests in social apps are just a few examples of great use cases for notifications. From the get-go, it's important that you're aware of the fact that a lot of apps are fighting for the user's attention at all times. Notifications are a great way to gain the user's attention, but if you send too many notifications, or only use notifications as a marketing tool, instead of as a way to provide meaningful information, it's very likely that the user is going to disable push notifications for your app at some point.</p><p>This is especially true since iOS 12. When a user swipes to ignore a notification, the user will be asked if they would like to adjust the notification settings for the app that sent the notification, or even turn off notifications for the app entirely. This new behavior makes it more important than ever to only send meaningful notifications to users.</p><p>The following six forms of <span>notifications</span><a id="id325333787" class="indexterm"></a> can be sent to users:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Sounds</li><li style="list-style-type: disc">Vibrations</li><li style="list-style-type: disc">Visual notifications (such as banners and alerts)</li><li style="list-style-type: disc">Badges</li><li style="list-style-type: disc">Critical notifications</li><li style="list-style-type: disc">Provisional</li></ul></div><p>Most apps use a combination of these, and you will learn more about them in a real-world scenario soon. A unique type of notification is the <span>critical</span><a id="id325602494" class="indexterm"></a> notification. A <span class="emphasis"><em>critical notification</em></span> is sent to the user regardless of whether or not the device is in <span class="emphasis"><em>Do Not Disturb</em></span> mode, and plays sound even if the device is muted. Critical notifications can't be implemented by all applications, as they are reserved for apps that have very good use cases for sending potentially disruptive notifications.</p><p>Examples of good use cases are health-related notifications or alarm systems. If you plan to send critical notifications to your users, you must ask Apple for permission, so they can grant your app the appropriate entitlements if they decide that your use case is valid.</p><p>Sending <span>provisional</span><a id="id325602512" class="indexterm"></a> notifications is a new feature in iOS 12 that allows your app to send notifications silently to your users, without explicit permission beforehand. Asking your user for permission to send them provisional notifications will automatically grant your app permission to send notifications without ever prompting the user. Instead, the user will silently receive notifications from your app, and they will be able to choose whether they want to continue receiving notifications from your app, or deny the notifications permission altogether.</p><p>There are two ways for apps to send notifications to their users: local <span>notifications</span><a id="id325602540" class="indexterm"></a> and push notifications. <span class="strong"><strong>Local notifications</strong></span> are scheduled by an app and kept on the device. To trigger these notifications, you use either a location, calendar, or time-based trigger.</p><p><span class="strong"><strong>Push notifications</strong></span> are pushed to a <span>device</span><a id="id325604096" class="indexterm"></a> through a <span>server</span><a id="id325604102" class="indexterm"></a> and the <span class="strong"><strong>Apple Push Notification Service</strong></span> (<span class="strong"><strong>APNS</strong></span>). Push notifications are always delivered by APNS using best-effort delivery. This means that a notification will be sent to the user, and if this fails, APNS <span>may or may not try again</span>. There are no guarantees made about this, so you should never assume that your notification did or did not end up on the user's device.</p><p>Push notifications can send either a user-facing notification, or a silent notification. A user-facing notification will actively notify the user about what happened, often in the shape of a banner or badge icon. A silent notification signals the app that it should be woken up to perform a background fetch. You have seen this mechanism in action in <a class="link" href="#" linkend="ch11">Chapter 11</a>, <span class="emphasis"><em>Syncing Data with CloudKit</em></span>.</p><p>When a single app has multiple notifications to show to the user, iOS will group them automatically to avoid spamming the user's notification screen with a huge list of notifications from a single app.</p><p> </p><p>The following screenshot shows a sample of <span>grouped</span><a id="id325606037" class="indexterm"></a> notifications:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/da79054f-3788-49e7-85c0-06fc68857a93.png" /></div><p>While this type of grouping might be exactly what your <span>app</span><a id="id325606057" class="indexterm"></a> needs, there are cases where you might want to group notifications in a slightly different way. For instance, if you are building a chat application, you might want to group all messages for a single conversation, but show multiple notifications if a user has notifications for several ongoing conversations, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789133202/graphics/100937a5-733a-451e-8974-c33e9a40bcd5.png" /></div><p>When you schedule or send a notification, you can specify a thread identifier for that notification. If the thread identifier is set for a notification, iOS will group your notifications based on this identifier, rather than grouping all notifications for a single application together.</p><p>In order to complement the notifications you send to your user, you can implement <strong class="userinput"><code>notification extensions</code></strong>. These extensions add a whole new dimension to notifications, especially for devices that support 3D-Touch. There are two types of extensions you can add to a notification—service extensions and content extensions.</p><p><strong class="userinput"><code>Service extensions</code></strong> allow you to modify or augment the contents of a notification before it is shown to the user. <strong class="userinput"><code>Content extensions</code></strong> allow you to display a custom notification interface when the user 3D-Touches a notification.</p><p>You will learn more about notification grouping and extensions later. Before that, you will learn how to ask the user for permission to send them notifications, and how to schedule and handle notifications.</p></div>