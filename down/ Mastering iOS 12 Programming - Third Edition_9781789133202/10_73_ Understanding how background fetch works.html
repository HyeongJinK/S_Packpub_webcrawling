<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec72"></a>Understanding how background fetch works</h2></div></div><hr /></div><p>Any application that provides users with some form of <span>data</span><a id="id325333110" class="indexterm"></a> that updates over time can implement background fetch. An application that implements background fetch is woken up by iOS periodically, and it's given a small window of time to fetch and process new data that has become available. The OS expects applications to call a callback when they're done with fetching and processing the data. The application uses this callback to inform the OS about whether or not it retrieved new data. First, you will learn about background fetch at a high level. Then, you'll learn about some of the details involved with background fetch, and lastly, you will implement background fetch in the <span class="strong"><strong>MustC</strong></span> app.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec50"></a>Looking at background fetch from a distance</h3></div></div></div><p><span class="strong"><strong>Background fetch</strong></span><span>allows</span> apps to download new <span>content</span><a id="id325580589" class="indexterm"></a> in the background without draining the battery because iOS manages the wake-up intervals as efficiently as possible. Since iOS will not allow your application to stay active for a very long time, you must keep in mind that your app might not be able to perform all the tasks you would like it to perform. If this is the case, you're probably implementing background fetch for the wrong reasons. Sometimes, it's a better idea to split work between your background fetch and application launch.</p><p>One example of this would be to download a large amount of data and perform some expensive processing with the downloaded data. If your app takes too long to process the data, it won't be able to finish. It may be a good idea to continue processing once the app launches. An even better approach would be to download only the data and perform all of the expensive processing only when the app launches. Background fetch is intended to pull in quick, small updates and not to process large amounts of data.</p><p>The time intervals that iOS uses to wake your app up aren't entirely transparent. You can tell iOS how often you would like your app to be woken up to do some background work, but ultimately the OS itself decides whether or not your app is woken up and how much time it has to perform its tasks.</p><p>A neat feature of background fetch is that iOS learns how often your app has updated data because you have to report this to the completion callback. In addition to understanding the moments where your app is most likely to retrieve updates, iOS also learns when your users are most likely to use your app. If a user tends to open your app every morning around 10:00 A.M., chances are that your app will be woken up in the background sometime before 10:00 A.M. This feature makes sure that your users will see recent content for your application. Similarly, if iOS notices that your app rarely has new content within a specified time interval, it's likely that your app isn't woken up as often as you'd like.</p><p>Leaving this interval in the hands of the OS might seem a bit scary at first; you often want as much control over these things as possible. What if you know that once a month, at a particular time, you will publish a bunch of new content and you want your app to fetch this in the background? How will you know that all users will receive this new content in time? The answer to this is simple: you don't know. Background fetch is a service that attempts to help your users to receive <span>content</span><a id="id325602488" class="indexterm"></a> in the background. There are no guarantees.</p><p>You should always be aware that your app might have to update content in the foreground since users can turn off background fetching entirely. One more important aspect of background fetch is that it will only work if your app isn't completely closed. If a user opens the multitasking window and swipes your app upward to close it, it won't be woken up for a background refresh, and your app will have to refresh when the user launches it the next time.</p><p>An excellent way to facilitate this in your code is to implement your background fetch logic in a separate method or a helper that you can call. You could invoke a method that's responsible for fetching new content any time your application is launched, or when it's awakened to perform a background fetch. This strategy ensures that your users always receive the latest content when they open your app.</p><p>This is all you need to know about background fetching on the surface. It's a feature that periodically wakes up your application so it can perform a task for a short time. You don't have tight control over when and how your app is awakened, which is okay because iOS learns how often your app should be woken up, and more importantly, iOS learns the best time to wake your app up. All you have to do is make sure that iOS knows that your app wants to be woken up.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec51"></a>Looking at background fetch in more depth</h3></div></div></div><p>Now that you have a broad understanding of <span>background</span><a id="id325602509" class="indexterm"></a> fetch; let's investigate what your app needs to do to be compatible with background fetch. First of all, you should let iOS know that your app wants to be woken up periodically. To do this, you will need to turn on the <span class="strong"><strong>Background Modes</strong></span> capability for your app. Within this capability, you can opt in to background fetch. Enabling this mode will automatically add a key for this service to your app's <code class="literal">Info.plist</code>.</p><p>When this capability is enabled, iOS will allow your app to be woken up periodically. However, it won't magically work right away. In theÂ <code class="literal">application(_:didFinishLaunchingWithOptions:)</code> method of <code class="literal">AppDelegate</code>, you must inform the system that you want the app to become active every once in a while and also specify the minimum time between fetches.</p><p>Once you've done this, iOS will periodically wake your app up. When it does, the <code class="literal">application(_:performFetchWithCompletionHandler:)</code> method is called. This method should be implemented in <code class="literal">AppDelegate</code>, and it's expected to call the provided completion handler once the work is completed. If you fail to call this method in time, iOS will make a note of this, and missing the window to call this completion-handler could result in your app not being woken up as often as you'd like, so make sure to always call it when the background work completes.</p><p>After calling the completion-handler, your app will be put back to sleep until the user opens the app or until the next time your app is allowed to perform a <span>background</span><a id="id325604102" class="indexterm"></a> fetch. Calling the completion-handler shouldn't be done until all of the work that you intended to do is done because once the completion-handler is called, there are no guarantees about how and when your app will make a transition to the background. The only thing you know for sure is that it will happen soon.</p></div></div>