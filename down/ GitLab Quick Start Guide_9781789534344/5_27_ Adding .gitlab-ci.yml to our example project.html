<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec31"></a>Adding .gitlab-ci.yml to our example project</h2></div></div><hr /></div><p>We've added tests to our <code class="literal">ROT13Formatter</code> project, but now we <span>need</span><a id="id325214128" class="indexterm"></a> to get those tests to be automatically executed in GitLab (either <a class="ulink" href="http://GitLab.com" target="_blank">GitLab.com</a> or our own hosted instance). To do this, let's create a file called <code class="literal">.gitlab-ci.yml</code> in our project and add the following to it:</p><pre class="programlisting">before_script:
<span></span>- apt-get update -qq &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -y -qq ca-certificates git php php-xml
<span></span>- php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
<span></span>- php composer-setup.php
<span></span>- php composer.phar install

phpunit:
<span></span>script:
<span></span>- vendor/bin/phpunit tests/ROT13FormatterTest</pre><p> </p><p>This exact file was discussed in the previous section, so we know that it simply executes a series of commands to configure the Runner and then runs one task that executes our tests. Now save, commit, and push this file to GitLab, and then we'll almost be ready to have our pipeline running. If you've set up a shared Runner in GitLab (as discussed earlier in this chapter), you'll need to go to <strong class="userinput"><code>Admin Area</code></strong> | <strong class="userinput"><code>Overview</code></strong> | <strong class="userinput"><code>Runners</code></strong>. From here, edit your Runner and tick <strong class="userinput"><code>Run untagged jobs</code></strong>; this will allow your Runner to pick up jobs that don't have tags (which our new <code class="literal">.gitlab-ci.yml</code> file lacks):</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/711c5df5-eebd-4d58-a96f-7c569692f17e.png" /></div><p>Now, when you go to <strong class="userinput"><code>Project |</code></strong><strong class="userinput"><code>CI/CD</code></strong> | <strong class="userinput"><code>Pipelines</code></strong>, you should see your new pipeline there, ready to go:</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/c920a6f1-9a59-4b30-b005-501d0dd9a0d7.png" /></div><p>The status may also be <strong class="userinput"><code>running</code></strong> if the pipeline is still processing, <strong class="userinput"><code>pending</code></strong> if you have no free Runners, or <strong class="userinput"><code>failed</code></strong> if the pipeline failed somewhere along the pipeline.</p><p>You can click the status (<strong class="userinput"><code>passed</code></strong>, in the preceding screenshot) to receive a breakdown of the pipeline. Yours should look similar to this:</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/447a23c0-bb8a-4d63-840b-5e1a0459a729.png" /></div><p>The commit name and branch might be different, but the main area under the <strong class="userinput"><code>Pipeline</code></strong> heading should look the same. It's pretty bare, but that's only because we have a single stage in our CI/CD pipeline, and within that stage we have a single task, <code class="literal">phpunit</code>. In more complex pipelines, you'll have multiple different stages shown, and each stage might have many different jobs within it.</p><p>You can click the <strong class="userinput"><code>Jobs</code></strong> heading to view the status of the individual jobs within the pipeline. This view will be pretty bare because we have such a simple pipeline, but you should still see the status, job ID, and name. By clicking on the status, you'll be taken to that individual job, which will show the current progress of it. The following is an example from an in-progress job execution:</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/945de31e-7a35-45ea-806d-d3a81d544a04.png" /></div><p>As you can see, we have the job status and <span>some</span><a id="id325169347" class="indexterm"></a> information, followed by a large block of text indicating the output from any scripts being executed in the course of the job.</p><p> </p></div>