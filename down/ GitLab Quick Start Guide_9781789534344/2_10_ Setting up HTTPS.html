<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec17"></a>Setting up HTTPS</h2></div></div><hr /></div><p>Security-conscious readers may have <span>picked</span><a id="id326409314" class="indexterm"></a> up that we're only using insecure HTTP, which might be fine for local installs or air-gapped networks, but if you're running on a cloud server, want to protect your server from man-in-the-middle attacks, or just want to follow best practices, I've outlined two ways that you can implement HTTPS. The first involves the free Let's Encrypt SSL provider and the second one is an option if you have your own certificates ready to go.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec15"></a>Let's Encrypt</h3></div></div></div><p>GitLab comes with the ability to <span>automatically</span><a id="id326409306" class="indexterm"></a> fetch and renew certificates from Let's Encrypt for the primary domain and the container registry for you. To get this running, you just need to specify <code class="literal">https://</code> for your external URL while setting up GitLab. Make sure that you don't have any custom SSL certificates loaded (this is discussed in the next section).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note5"></a>Note</h3><p>Let's Encrypt is a free, automated, and open Certificate Authority. </p></div><p>If you want to receive notification emails about the certificate expiring soon, you can also add the following line to your <code class="literal">/etc/gitlab/gitlab.rb</code> file:</p><pre class="programlisting">letsencrypt['contact_emails'] = ['foo@example.com']</pre><p>Make sure to replace <code class="literal">foo@example.com</code> with your actual email address and then run the following command to reconfigure GitLab with the updated information:</p><pre class="programlisting"><span class="strong"><strong>sudo gitlab-ctl reconfigure</strong></span></pre><p>If you want to automatically redirect any HTTP traffic to HTTPS, you can add the following line to your GitLab config file (<code class="literal">/etc/gitlab/gitlab.rb</code>) and then run <code class="literal">sudo gitlab-ctl reconfigure</code>:</p><pre class="programlisting">nginx['redirect_http_to_https'] = true</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec16"></a>HTTPS certificates</h3></div></div></div><p>So far, we've discussed using HTTP with a new GitLab installation and <span>automatically</span><a id="id325676811" class="indexterm"></a> configuring GitLab with HTTPS using Let's Encrypt, but if you have manual certificates you want to use – potentially if your installation won't support Let's Encrypt, is behind a firewall, or on a private network – you can still configure GitLab to use SSL/TLS security to secure HTTP browsing.</p><p>First, we need to update the <code class="literal">external_url</code> value in our <code class="literal">/etc/gitlab/gitlab.rb</code> file to reference HTTPS:</p><pre class="programlisting">external_url "https://example.com"</pre><p>This lets GitLab know how to use key and certificate files. First, it tries to look for them in <code class="literal">/etc/gitlab/ssl/</code>. Then, it tries to look for <code class="literal">.key</code> and <code class="literal">.crt</code> files that match the <code class="literal">external_url</code> value; in our case, we should call our files <code class="literal">example.com.key</code> and <code class="literal">example.com.crt</code> and put them in the aforementioned directory. You may need to create the directory if it doesn't already exist. Now, run the following command to reconfigure your GitLab installation so that you can use HTTPS with your provided certificate:</p><pre class="programlisting"><span class="strong"><strong>sudo gitlab-ctl reconfigure</strong></span></pre><p>If you ever replace the certificates without changing the GitLab configuration, you'll need to run the following command to force a reload of nginx so that it picks up the new certificate and key. You can do this like so:</p><pre class="programlisting"><span class="strong"><strong>sudo gitlab-ctl hup nginx</strong></span></pre><p>If you want to automatically redirect any HTTP traffic to HTTPS, you can add the following line to your GitLab config file (<code class="literal">/etc/gitlab/gitlab.rb</code>) and then run <code class="literal">sudo gitlab-ctl reconfigure</code>:</p><pre class="programlisting">nginx['redirect_http_to_https'] = true</pre></div></div>