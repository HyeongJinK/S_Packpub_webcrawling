<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec36"></a>Moving from another version control system</h2></div></div><hr /></div><p>You may also be in a situation where you aren't using Git for code version control. For historical reasons, or due to familiarity with other version control systems, your organization or project may have been stored in a SVN, Mercurial, or other v<span class="strong"><strong>ersion control system</strong></span> (<span class="strong"><strong>VCS</strong></span>) repository. While different VCSes can have <span>vastly</span><a id="id325426636" class="indexterm"></a> different methods of operation, and even completely alien underlying storage models, there are some methods for extracting data from one system and loading it into another.</p><p>In this section, we'll run through a couple of the most common VCSes used today and how to convert to Git (and GitLab) from them.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec48"></a>Subversion</h3></div></div></div><p>One of the most common <span>alternative</span><a id="id325426642" class="indexterm"></a> version control systems is SVN, which works in a client-server model that differs from the distributed model that Git provides. This doesn't mean the end times though, as there are tools <span>you</span><a id="id325426634" class="indexterm"></a> can use to convert an SVN  repository into a Git one. The following steps run through the use of one such tool:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Ensure that Ruby is installed on your machine.</li><li>Install <code class="literal">svn2git</code> by running the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>      sudo gem install svn2git</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Run the following command to download the repository and convert it to a Git repository with all the correct branches and tags:</li></ol></div><pre class="programlisting"><span class="strong"><strong>      svn2git https://example.com/path/to/svn/repo</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Create a new GitLab project.</li><li>Run the following commands to push the Git repository to the GitLab project:</li></ol></div><pre class="programlisting"><span class="strong"><strong>  git remote rename origin old-origin</strong></span>
<span class="strong"><strong>      git remote add origin [PROJECT GIT URL]</strong></span>
<span class="strong"><strong>      git push -u origin --all</strong></span>
<span class="strong"><strong>      git push -u origin --tags</strong></span></pre><p>There are a number of different options that can be used in the <code class="literal">svn2git</code> command, which are applicable in various situations.</p><p>If your SVN repository is password protected, you can specify a username and password on the command line to allow it to authenticate, as follows:</p><pre class="programlisting"><span class="strong"><strong>svn2git https://example.com/path/to/svn/repo --username=[USERNAME] --
password==      [PASSWORD]</strong></span></pre><p><span>If your SVN repository contains multiple different projects, you can specify which one you want to convert with the following command:</span></p><pre class="programlisting"><span class="strong"><strong>svn2git https://example.com/path/to/svn/repo/nested_project ----no-
minimize-url</strong></span></pre><p>One other issue with this migration pathway is that it doesn't match up author information. <span>If you want to keep author details, you'll need to extract the unique usernames from the remote repository with a command such as the following:</span></p><pre class="programlisting"><span class="strong"><strong>svn log --quiet https://example.com/path/to/svn/repo | grep -E 
"r[0-9]+ \| .+ \|"       | cut -d'|' -f2 | sed 's/ //g' | sort | uniq</strong></span></pre><p>Save the output of that command, and then you need to match up every username in the list to a corresponding email address. Make sure this is in a plain text file; the contents should look something like this:</p><pre class="programlisting">adam.ogrady = Adam O'Grady &lt;adam.ogrady@example.com&gt;
snowy = Snowy &lt;snowy@example.com&gt;</pre><p>Now, you can run <code class="literal">svn2git</code> with an extra flag that <span>points</span><a id="id325169430" class="indexterm"></a> to your file with the list of authors, and it will do the conversion and map all the SVN users to git users. An example of that command is shown here:</p><pre class="programlisting"><span class="strong"><strong>svn2git https://example.com/path/to/svn/repo —authors ~/authors.txt</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec49"></a>Mercurial</h3></div></div></div><p>Another common VCS in <span>use</span><a id="id325169452" class="indexterm"></a> today is Mercurial, which has a similar focus on distributed capabilities to Git, but with some differences. Thanks to a lot of similarities with Git, it's not too hard to convert an existing <span>Mercurial</span><a id="id325171408" class="indexterm"></a> repository to a Git repository and then upload it to GitLab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><span>First, you'll need to clone the <code class="literal">hg-fast-export</code> tool:</span></li></ol></div><pre class="programlisting"><span class="strong"><strong>      git clone https://github.com/frej/fast-export.git</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Then, clone the repository you want to upload to GitLab:</li></ol></div><pre class="programlisting"><span class="strong"><strong>      hg clone [REPO URL] mercurial-repo</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Because Mercurial is more lax with the content it allows in the author field, you need to clean up the authors and create an author mapping file. First, run the following commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd mercurial-repo</strong></span>
<span class="strong"><strong>      hg log | grep user: | sort | uniq | sed 's/user: *//' &gt; ../authors</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>If all the usernames in the <code class="literal">authors</code> file are in the form <span class="emphasis"><em>Full Name</em></span><code class="literal">&lt;email@example.com&gt;</code><span class="emphasis"><em>,</em></span> then you don't need to do anything. Otherwise, you need to map them all to the Git format in the code file like so:</li></ol></div><pre class="programlisting">      "adam"="Adam O'Grady &lt;adam.ogrady@example.com&gt;"
      "snowy@localhost"="Snowy O'Grady &lt;snowy@example.com&gt;"
      "shmouf &lt;shmouf@example.com&gt;"="Shmouf Shmouflon &lt;shmouf@example.com&gt;"
      "adam o'grady &lt;adam &lt;AT&gt; example &lt;DOT&gt; com&gt;"="Adam O'Grady
      &lt;adam.ogrady@example.com&gt;"</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Now, we can create our Git repository in a blank folder:</li></ol></div><pre class="programlisting"><span class="strong"><strong> cd ..</strong></span>
<span class="strong"><strong>      mkdir git-repo</strong></span>
<span class="strong"><strong>      cd git-repo</strong></span>
<span class="strong"><strong>      git init</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, run the fast import tool:</li></ol></div><pre class="programlisting">      ../fast-export/hg-fast-export.sh -r ../mercurial-repo -A ../authors</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>This will take a while, but at the end you should have a Git repository with all the Mercurial tags and branches/bookmarks converted to Git tags and branches.
</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Now, you need to create a new GitLab repository and push everything to it. <span>From the main screen, click the <strong class="userinput"><code>+</code></strong> icon up the top and then select <strong class="userinput"><code>New Project</code></strong>.</span></li><li>Select a user/group for the project.</li><li><span>Provide</span> a project name.</li><li>Fill out the project description.</li><li>Set the project visibility level.</li><li>Do not initialize the project with a <code class="literal">README</code>. Click the <strong class="userinput"><code>Create project</code></strong> button and you'll see your new repository.</li><li>Now, you need to go to the existing repository that you want to <span>import</span><a id="id325277157" class="indexterm"></a> and run the <span>following</span><a id="id325277232" class="indexterm"></a> commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>      git remote rename origin old-origin</strong></span>
<span class="strong"><strong>      git remote add origin [PROJECT GIT URL]</strong></span>
<span class="strong"><strong>      git push -u origin --all</strong></span>
<span class="strong"><strong>      git push -u origin --tags</strong></span></pre></div></div>