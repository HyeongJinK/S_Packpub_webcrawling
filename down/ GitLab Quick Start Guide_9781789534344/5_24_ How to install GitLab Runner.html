<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec28"></a>How to install GitLab Runner</h2></div></div><hr /></div><p>GitLab's implementation of a continuous integration and <span>continuous</span><a id="id325949814" class="indexterm"></a> deployment platform works off the idea of <span class="strong"><strong>Runners</strong></span>, which are programs that are installed on other servers and can connect to the GitLab instance to receive jobs to run. These jobs can involve building, testing, and deploying code. In this section, we'll explore how to install GitLab Runner on Ubuntu, CentOS, and manually via binaries.</p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec39"></a>Ubuntu</h3></div></div></div><p>To easily install GitLab Runner on Ubuntu, make sure that <span>you</span><a id="id325277230" class="indexterm"></a> have a recent version installed, as GitLab only provides packages for the currently supported versions. Next, open a Terminal session on your <span>Ubuntu</span><a id="id325277239" class="indexterm"></a> box and run the following command:</p><pre class="programlisting"><span class="strong"><strong>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash</strong></span>
<span class="strong"><strong>cat &gt; /etc/apt/preferences.d/pin-gitlab-runner.pref &lt;&lt;EOF</strong></span>
<span class="strong"><strong>Explanation: Prefer GitLab provided packages over the Debian native ones</strong></span>
<span class="strong"><strong>Package: gitlab-runner</strong></span>
<span class="strong"><strong>Pin: origin packages.gitlab.com</strong></span>
<span class="strong"><strong>Pin-Priority: 1001</strong></span>
<span class="strong"><strong>EOF</strong></span>
<span class="strong"><strong>sudo apt-get install gitlab-runner</strong></span></pre><p>Let's break this down a bit.</p><p>The first command downloads and executes a script from GitLab that checks if your operating system is compatible, sets up your local package manager (<code class="literal">apt</code>) with the right URLs to get packages and lists from, and then updates those lists. This is a security anti-pattern, though, as the user isn't sure what they're executing and it could contain malicious code. I'd recommend downloading the script to your machine and then executing it yourself after having a read of the code so that you know what it will do.</p><p>The next section pins the package to the GitLab origin. This is necessary because Ubuntu introduced a GitLab Runner package as well. However, it can be a lot more out of date than the GitLab version and so it's recommended to pin it to the GitLab download origin.</p><p>Lastly, we install the package so that it's ready to go.</p><p>Now, we need to register the Runner. To do that, go to the <span class="emphasis"><em>How to register Runners</em></span> section in this chapter.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec40"></a>CentOS</h3></div></div></div><p>To easily install GitLab Runner on Ubuntu, make sure that <span>you</span><a id="id325315446" class="indexterm"></a> have a recent version installed, as GitLab only provides packages for the currently supported versions. Next, open a <span>terminal</span><a id="id325315456" class="indexterm"></a> session on your <span>Ubuntu</span><a id="id325315464" class="indexterm"></a> box and run the following command:</p><pre class="programlisting"><span class="strong"><strong>curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.rpm.sh | sudo bash</strong></span>
<span class="strong"><strong>sudo yum install gitlab-runner</strong></span></pre><p>Let's break this down a bit.</p><p>The first command downloads and executes a script from GitLab that checks if your operating system is compatible, sets up your local package manager (<code class="literal">yum</code>) with the right URLs to get packages and lists from, and then updates those lists. This is a security anti-pattern, though, as the user isn't sure what they're executing and it could contain malicious code. I'd recommend downloading the script to your machine and then executing it yourself after having a read of the code so that you know what it will do.</p><p>Lastly, we install the package so that it's ready to go.</p><p>Now, we need to register the Runner. To do that, go to the <span class="emphasis"><em>How to register Runners</em></span> section in this chapter.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec41"></a>Binaries</h3></div></div></div><p>If <span>you</span><a id="id325418571" class="indexterm"></a> don't want to use the DEB or RPM packages to install GitLab Runner, or are using an operating system without those package managers available, you can still install GitLab Runner manually using the binary downloads.</p><p>Run the following commands to download the Runner, give it permissions to execute, create a user for it, and then install and run it:</p><pre class="programlisting"><span class="strong"><strong>sudo wget -O /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64</strong></span>
<span class="strong"><strong>sudo chmod +x /usr/local/bin/gitlab-runner</strong></span>
<span class="strong"><strong>sudo useradd --comment 'GitLab Runner' --create-home gitlab-runner --shell /bin/bash</strong></span>
<span class="strong"><strong>sudo gitlab-runner install --user=gitlab-runner --working-directory=/home/gitlab-runner</strong></span>
<span class="strong"><strong>sudo gitlab-runner start</strong></span></pre><p>If you're using an ARM platform such as a Raspberry Pi or other lightweight device, you can change the <code class="literal">amd64</code> to <code class="literal">arm</code> in the download link.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec42"></a>How to register Runners</h3></div></div></div><p>Once <span>you</span><a id="id325419832" class="indexterm"></a> have your Runner client installed, you can go through the process of registering it. There are two ways of doing this: in the administrator panel (only in self-hosted GitLab) or in project settings. The former creates a global <strong class="userinput"><code>shared</code></strong> Runner that can be assigned to multiple different projects or even made available to any project on the instance that needs a Runner. The latter method creates Runners that are tied specifically to a particular project/repository. There are also <strong class="userinput"><code>group</code></strong> runners, which can be assigned to a group of projects, but they are beyond the scope of this book.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec3"></a>Admin panel</h4></div></div></div><p>To do this, you first need to log in to your <span>GitLab</span><a id="id325419856" class="indexterm"></a> instance as an account with administrator permissions. Once you're logged in, you need to click the spanner/wrench icon up the top at the end of the left-hand side menu. From here, go to <strong class="userinput"><code>Overview </code></strong>| <strong class="userinput"><code>Runners</code></strong> to be greeted by a scene like the following:</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/18bbda62-d5b1-4c6d-819b-33980c6c60d4.png" /></div><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Finally, copy the value listed as the registration token, and move on to the next step.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec4"></a>Project settings</h4></div></div></div><p>From your <span>project</span><a id="id325637776" class="indexterm"></a> home page, go to <strong class="userinput"><code>Settings</code></strong> | <strong class="userinput"><code>CI/CD</code></strong>. On this page, expand the section titled <strong class="userinput"><code>Runners</code></strong>. After the explanatory text, you'll be faced with an information box that looks like this:</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/eed05e0f-8269-453e-b72e-829f8078de83.png" /></div><p>You'll need to copy the value for the registration token and then move on to the next step.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec5"></a>Registering the CLI</h4></div></div></div><p>Jump into a terminal session on <span>your</span><a id="id325637913" class="indexterm"></a> GitLab Runner machine.</p><p>Run the following command:</p><pre class="programlisting"><span class="strong"><strong>sudo gitlab-runner register</strong></span></pre><p>This should lead you to an interactive prompt. First, you'll need to input the URL of your GitLab instance (make sure that it's reachable from the Runner). Next up, it will ask for the shared token that you copied earlier. Then, enter a name for the Runner and lastly a series of comma-separated tags. You can use these tags to describe or group the Runner, maybe by OS, capability, pre-installed frameworks, and so on. Lastly, you have to pick the GitLab Runner executor; this is how GitLab Runner will execute any tests. In most circumstances, you should select <code class="literal">docker</code>, but there are some occasions where you might want to select other options, such as <code class="literal">kubernetes</code> or <code class="literal">shell</code>. The latter is really helpful for building OS-specific projects, such as iOS apps that can't be easily built in a Docker container. If you do choose <code class="literal">docker</code> as your executor, you'll also be asked to provide a default Docker image for projects that do not specify one in their <code class="literal">.gitlab-ci.yml</code> file. You'll also need to make sure that Docker is installed on the Runner; it is not bundled with the Runner package.</p><p>Now, your runner should be ready to go. You can verify this in GitLab in the <strong class="userinput"><code>Administration</code></strong> | <strong class="userinput"><code>Overview</code></strong> | <strong class="userinput"><code>Runners</code></strong> or project home page by going to | <strong class="userinput"><code>Settings</code></strong> | <strong class="userinput"><code>CI/CD</code></strong> | <strong class="userinput"><code>Runners</code></strong>. For example, here's what it should look like if you set up a global runner in the administration panel:</p><div class="mediaobject"><img src="/graphics/9781789534344/graphics/d2d9cbd1-4b63-4f9f-aa01-462cd497e66d.png" /></div></div></div></div>