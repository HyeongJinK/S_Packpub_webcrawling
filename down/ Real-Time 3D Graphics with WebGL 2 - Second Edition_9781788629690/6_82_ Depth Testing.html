<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec88"></a>Depth Testing</h2></div></div><hr /></div><p>Each fragment that has been <span>processed</span><a id="id325357458" class="indexterm"></a> by the fragment shader carries an associated depth value. Though fragments are two-dimensional since they’re rendered on the screen, the depth value keeps the information of how far the fragment is from the camera (screen). Depth values are stored in a special WebGL buffer named <span class="strong"><strong>depth buffer</strong></span> or <span class="strong"><strong>z-buffer</strong></span>. The <code class="literal">z</code> comes from the fact that <code class="literal">x</code> and <code class="literal">y</code> values correspond to the screen <span>coordinates</span><a id="id325358953" class="indexterm"></a> of the fragment, while the <code class="literal">z</code> value <span>measures</span><a id="id325358963" class="indexterm"></a> distance perpendicular to the screen.</p><p>After the fragment has been calculated by the fragment shader, it becomes available for depth testing. This only occurs if the depth test is enabled. Assuming that <code class="literal">gl</code> is the JavaScript variable that contains our WebGL context, we can enable depth testing by writing the following:</p><pre class="programlisting">gl.enable(gl.DEPTH_TEST);</pre><p>The depth test takes the depth value of a fragment into consideration and compares it to the depth value for the same fragment coordinates already stored in the depth buffer. The depth test determines whether that fragment is accepted for further processing in the rendering pipeline.</p><p>Only the fragments that pass the depth test will be processed. Any fragment that does not pass the depth test will be discarded.</p><p>In normal circumstances, when the depth test is enabled, only those fragments with a lower depth value than the corresponding fragments present in the depth buffer will be accepted.</p><p>Depth testing is a commutative operation with respect to the rendering order. This means that no matter which object gets rendered first, as long as depth testing is enabled, we will always have a consistent scene.</p><p>Let's illustrate this with an example. The following diagram contains a cone and a sphere. The depth test is disabled using the following code:</p><pre class="programlisting">gl.disable(gl.DEPTH_TEST);</pre><p>The sphere is rendered first. As expected, the cone fragments that overlap the cone are not discarded when the cone is rendered. This occurs because there is no depth test between the overlapping fragments:</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/f663d94c-92ae-44d3-9248-17c41659708f.png" /></div><p>Now, let's enable the depth test and render the same scene. The sphere is rendered first. Since all the cone fragments that overlap the sphere have a higher depth value (they are farther from the camera), these fragments fail the depth test and are discarded, creating a consistent scene.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec114"></a>Depth Function</h3></div></div></div><p>In some applications, we may be <span>interested</span><a id="id325643424" class="indexterm"></a> in changing the default behavior of depth testing, which discards fragments with a higher depth value than those fragments in the depth buffer. For that purpose, WebGL provides the <code class="literal">gl.depthFunc(function)</code> method.</p><p>This method has only one parameter, the <code class="literal">function</code> to use:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Parameter</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Description</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.NEVER</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>The depth test always fails.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.LESS</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Only fragments with a depth lower than current fragments on the depth buffer will pass the test.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.LEQUAL</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fragments with a depth less than or equal to corresponding current fragments in the depth buffer will pass the test.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.EQUAL</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Only fragments with the same depth as current fragments on the depth buffer will pass the test.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.NOTEQUAL</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Only fragments that do not have the same depth value as fragments on the depth buffer will pass the test.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.GEQUAL</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fragments with greater or equal depth value will pass the test.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">gl.GREATER</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Only fragments with a greater depth value will pass the test.</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p><code class="literal">gl.ALWAYS</code></p></td><td style=""><p>The depth test always passes.</p></td></tr></tbody></table></div><p> </p><p>The depth test is disabled by default in WebGL. When enabled, if no depth function is set, the <code class="literal">gl.LESS</code> function is selected by default.</p></div></div>