<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec61"></a>Time for Action: Exploring the Showroom</h2></div></div><hr /></div><p>Let's cover an example <span>covering</span><a id="id325358908" class="indexterm"></a> various camera types:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the <code class="literal">ch04_04_camera-types.html</code> file in your browser. You will see something like the following:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/474746ab-09fc-457d-b81d-310c97b5888d.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Go around the world using the sliders in <strong class="userinput"><code>Tracking</code></strong><span class="strong"><strong> </strong></span>mode. Cool, huh?</li><li>Change the camera type to <strong class="userinput"><code>Orbiting</code></strong><span class="strong"><strong> </strong></span>mode and do the same.</li><li>Check that besides the slider controls, both in <strong class="userinput"><code>Tracking</code></strong><span class="strong"><strong> </strong></span>and <strong class="userinput"><code>Orbiting</code></strong> mode, you can use your mouse and keyboard to move around the world.</li><li>In this exercise, we have implemented a camera using two new classes:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">Camera</code>: To manipulate the camera.</li><li style="list-style-type: disc"><code class="literal">Controls</code>: To connect the camera to the <code class="literal">canvas</code>. The <code class="literal">canvas</code> will now receive mouse and keyboard events and pass them along to the camera.</li></ul></div></li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>If you are curious, you can see the source code of these two classes in the <code class="literal">common/js</code> directory. We have applied the concepts explained in this chapter to build these two classes.</li><li>So far, we have seen a cone in the center of the world. As we explore, let's change it to something more interesting. Open the file <code class="literal">ch04_04_camera-types.html</code> file in your source code editor.</li><li>Go to the <code class="literal">load</code> function. Let's add the car to the scene. Rewrite the contents of this function to the following:</li></ol></div><pre class="programlisting">function load() {
  scene.add(new Floor(2000, 100));
scene.add(new Axis(2000));
scene.loadByParts('/common/models/nissan-gtr/part', 178);
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>You will see that we've increased the size of the axis and the floor so that we can see them. We need to do this because the car model is a much larger object than the original cone.</li><li>There are a few steps we need to take in order to see the car correctly. We need to make sure that we have a large enough view volume. Go to the <code class="literal">updateTransforms</code> function and update this line:</li></ol></div><pre class="programlisting">mat4.perspective(projectionMatrix, 45, canvas.width / canvas.height, 0.1, 1000);</pre><p>Replace it with this:</p><pre class="programlisting">mat4.perspective(projectionMatrix, 45, canvas.width / canvas.height, 0.1, 5000);</pre><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Change the type of <span>camera</span><a id="id325617291" class="indexterm"></a> so that when we load the page, we have an orbiting camera by default. In the <code class="literal">configure</code> function, change this line:</li></ol></div><pre class="programlisting">camera = new Camera(Camera.TRACKING_TYPE);</pre><p>Replace it with this:</p><pre class="programlisting">camera = new Camera(Camera.ORBITING_TYPE);</pre><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>Another thing we must consider is the location of the camera. For a large object such as this car, we need to be farther away from the center of the world. For that purpose, we need to change the home location of <code class="literal">camera.goHome</code> from <code class="literal">[0, 2, 50]</code> to <code class="literal">[0, 25, 300]</code>.</li><li>Let's modify our scene's lighting so that it better fits into the model we are displaying. In the <code class="literal">configure</code> function, update the following:</li></ol></div><pre class="programlisting">gl.uniform3fv(program.uLightPosition, [0, 120, 120]);
gl.uniform4fv(program.uLightAmbient, [0.2, 0.2, 0.2, 1]);
gl.uniform4fv(program.uLightDiffuse, [1, 1, 1, 1]);</pre><p>Replace it with this:</p><pre class="programlisting">gl.uniform4fv(program.uLightAmbient, [0.1, 0.1, 0.1, 1]);
gl.uniform3fv(program.uLightPosition, [0, 0, 2120]);
gl.uniform4fv(program.uLightDiffuse, [0.7, 0.7, 0.7, 1]);</pre><div class="orderedlist"><ol class="orderedlist arabic" start="14" type="1"><li>Save the file with a different name and then load this new file in your browser. You should see something like the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/9b606719-204e-4be8-a1c8-dec60c9d6f1e.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="15" type="1"><li>Using the mouse, keyboard, and/or the sliders, explore the new scene.</li><li>Use orbiting mode to explore the car from different angles.</li><li>See how the Camera matrix is updated when you move around the scene.</li><li>You can see what the final exercise looks like by opening the <code class="literal">ch04_05_car.html</code> file.</li></ol></div><p><span class="emphasis"><em><span class="strong"><strong>What just happened?</strong></span></em></span></p><p>We added mouse and keyboard interaction to our scene. We also experimented with the two basic camera types: <span class="emphasis"><em>tracking</em></span> and <span class="emphasis"><em>orbiting</em></span> cameras. Finally, we <span>modified</span><a id="id325659804" class="indexterm"></a> the settings of our scene to visualize a complex model.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec79"></a>Have a Go: Updating Light Positions</h3></div></div></div><p>As we've seen, by moving the camera, we're applying the inverse transformation to the world. If we do not update the light position, the light <span>source</span><a id="id325659819" class="indexterm"></a> will be located at the same static point, regardless of the final transformation applied to the world.</p><p>This is very convenient when we're moving around or exploring an object in the scene. We can always see whether the light is located on the same axis of the camera. This is the case for the exercises in this chapter. Nevertheless, we can also simulate the case when the camera movement is independent from the light source. To do so, we need to calculate the new light position whenever we move the camera.</p><p>First, we calculate the light direction. We can do this by simply calculating the difference vector between our target and our origin. Say the light source is located at <code class="literal">[0, 2, 50]</code>. If we want to direct our light source toward the origin, we calculate the <code class="literal">[0, 0, 0] - [0, 2, 50]</code> vector <span class="emphasis"><em>(target - origin)</em></span>. This vector has the correct orientation of the light when we target the origin. We repeat the same procedure if we have a different target that needs to be lit. In that case, we just use the coordinates of the target and from them, we subtract the location of the light.</p><p>As we are directing our light source toward the origin, we can find the direction of the light just by inverting the light position. As you may have noticed, we do this in ESSL in the vertex shader:</p><pre class="programlisting">vec3 L = normalize(-uLightPosition);</pre><p>As <code class="literal">light</code> is a vector, if we want to update the direction of the light, we need to use the Normal matrix, discussed earlier in this chapter, to update this vector under any world transformation. This step is optional in the vertex shader:</p><pre class="programlisting">if (uFixedLight) {
  L = vec3(uNormalMatrix * vec4(L, 0.0));
}</pre><p>In the previous fragment of code, light is augmented to four components, so we can use the direct multiplication provided by ESSL. (Remember that <code class="literal">uNormalMatrix</code> is a 4x4 matrix and, as such, the vectors it transforms need to be four-dimensional.) Please bear in mind that, as explained at the beginning of this chapter, the Homogeneous coordinates of vectors are always set to <code class="literal">0</code>, while the Homogeneous coordinates of vertices are set to <code class="literal">1</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>After the multiplication, we reduce the result to three components before assigning the result back to light.</li><li>You can test the effects of updating the light position by using the <code class="literal">Static Light Position</code> button, provided in the <code class="literal">ch04_05_car.html</code> file.</li><li>We connect a global variable that keeps track of the state of this button with the <code class="literal">uUpdateLight</code> uniform.</li><li>Edit <code class="literal">ch04_05_car.html</code> and set the light position to a different location. To do this, edit the configure function. Go to the following position:</li></ol></div><pre class="programlisting">gl.uniform3fv(program.uLightPosition, [0, 0, 2120]);
</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Try different light positions:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">[2120, 0, 0]</code></li><li style="list-style-type: disc"><code class="literal">[0, 2120, 0]</code></li><li style="list-style-type: disc"><code class="literal"><code class="literal">[100, 100, 100]</code></code></li></ul></div></li><li>For each option, save the file <span>and</span><a id="id325662148" class="indexterm"></a> try it with and without updating the light position (use the <code class="literal">Static Light Position</code> button):</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/20328575-7a9c-4731-9fb1-8b7a65b2605d.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>For a better visualization, use an <span class="strong"><strong>Orbiting </strong></span>camera.</li></ol></div></div></div>