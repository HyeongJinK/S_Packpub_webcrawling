<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec134"></a>Normal Mapping</h2></div></div><hr /></div><p>A very powerful and popular technique among real-time 3D applications is <span class="strong"><strong>normal mapping</strong></span>. Normal mapping creates the illusion of highly detailed geometry on a low-poly model by <span>storing</span><a id="id325358834" class="indexterm"></a> surface normals in a texture map that can then be used to calculate the lighting of the objects. This method is especially popular in modern games, since this allows developers to strike a balance between high performance and scene detail.</p><p>Typically, lighting is calculated by using the surface normals of the <span>triangles</span><a id="id325358866" class="indexterm"></a> being rendered, meaning that the entire polygon will be lit as a continuous, smooth surface:</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/2734d26d-f764-455f-a88e-ebed3c54a36b.png" /></div><p>With normal mapping, the surface normals are replaced by normals that are encoded in a texture that give the appearance of a rough or bumpy surface. Note that the actual geometry is not changed when using a normal map – only how it's lit changes. If you look at a normal mapped polygon from the side, it will still appear to be perfectly flat:</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/c229d07e-e69b-4106-ae0b-cb1e658d6db4.png" /></div><p>The texture used to store the normals is <span>called</span><a id="id325614925" class="indexterm"></a> a <span class="strong"><strong>normal map</strong></span>, and it's typically paired with a specific diffuse texture that complements the surface that the normal map is trying to simulate. For example, here is a diffuse texture of some flagstones and the corresponding normal map:</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/fb098107-154b-47f6-82d3-1d16c0c71d31.png" /></div><p>You can see that the normal map contains a similar pattern to the diffuse texture. Together, the two textures give the appearance that the stones are raised with a rough finish, while the grout is sunken in.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note92"></a>Note</h3><p><span class="strong"><strong><strong class="userinput"><code>Mapping Techniques</code></strong></strong></span>Although normal mapping is a powerful technique for efficiently adding more detail to assets, there are many other mapping techniques that follow the same line of reasoning. You can read about some of the other techniques that are available for use here: <a class="ulink" href="https://en.wikipedia.org/wiki/Category:Texture_mapping" target="_blank">https://en.wikipedia.org/wiki/Category:Texture_mapping</a>.</p></div><p>The normal map contains custom-formatted color information that can be interpreted by the shader at runtime as a fragment normal. A fragment normal is essentially the same as a vertex normal: it is a three-component vector that points away from the surface. The normal texture encodes the three components of the normal vector into the three channels of the texture's texel color. Red represents the <code class="literal">x-axis</code>, green represents the <code class="literal">y-axis</code>, and blue represents the <code class="literal">z-axis</code>.</p><p>The normals that have been encoded are <span>typically</span><a id="id325617299" class="indexterm"></a> stored in <span class="strong"><strong>tangent space</strong></span>, as opposed to world or object space. Tangent space is the coordinate system for the texture coordinates of a face. Normal maps are commonly blue, since the normals they represent generally point away from the surface and thus have larger <code class="literal">z</code> components.</p></div>