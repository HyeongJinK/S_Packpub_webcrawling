<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec113"></a>Looking for Hits</h2></div></div><hr /></div><p>Now, we will check <span>whether</span><a id="id325358908" class="indexterm"></a> the color obtained from the offscreen framebuffer matches any of the objects in our scene. Remember here that we are using colors as object labels. If the color matches one of the objects, then we <span>call</span><a id="id325358921" class="indexterm"></a> it a <span class="strong"><strong>hit</strong></span>. If it does not, we <span>call</span><a id="id325358954" class="indexterm"></a> it a <span class="strong"><strong>miss</strong></span>.</p><p>When looking for hits, we compare each object's diffuse color with the label obtained from the offscreen framebuffer. There is, however, an additional step to consider: each color channel comes back in a <code class="literal">[0, 255]</code> range while the object diffuse colors are in a <code class="literal">[0, 1]</code> range. We need to update this before we check for any possible hits. We can do so with a compare function:</p><pre class="programlisting">function compare(readout, color) {
  return (
    Math.abs(Math.round(color[0] * 255) - readout[0]) &lt;= 1 &amp;&amp;
    Math.abs(Math.round(color[1] * 255) - readout[1]) &lt;= 1 &amp;&amp;
    Math.abs(Math.round(color[2] * 255) - readout[2]) &lt;= 1
  );
}</pre><p>In the preceding code, we scale the diffuse property to a <code class="literal">[0, 255]</code> range and then compare each channel individually. We do not need to compare the alpha channel. If we had two objects with the same color but a different alpha channel, we could use the alpha channel in the comparison, but this is not the case in our example.</p><p>Also, it’s important to note that the comparison is not precise, as we are dealing with decimal values in the <code class="literal">[0, 1]</code> range. Because of that, we introduce a fudge factor by assuming that we have a hit after rescaling the colors and subtract the readout (object label) – the difference is less than one. </p><p>Then, we just iterate through the object list in our <code class="literal">scene</code> and check whether we have a hit or miss with the following code:</p><pre class="programlisting">let pickedObject;

scene.traverse(object =&gt; {
if (compare(readout, object.diffuse)) {
    // Returning any value from the 'scene.traverse' method breaks the loop
return pickedObject = object;
}
});</pre><p>This code iterates through every object in our <code class="literal">scene</code> and assigns <code class="literal">pickedObject</code> to the matching object if we have a hit.</p></div>