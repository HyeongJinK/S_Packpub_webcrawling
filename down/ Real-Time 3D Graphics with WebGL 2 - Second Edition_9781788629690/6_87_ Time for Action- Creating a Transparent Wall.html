<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec93"></a>Time for Action: Creating a Transparent Wall</h2></div></div><hr /></div><p>Let's cover an example of how we'd make an <span>object</span><a id="id325358908" class="indexterm"></a> transparent:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open <code class="literal">ch06_11_transparency-initial.html</code> in your browser. We have two completely opaque objects: a cone behind a wall. Click and drag the <code class="literal">canvas</code> to move the camera behind the wall and see the cone, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/824df9cc-026b-40e3-8420-5d30f991ca8a.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Change the wall alpha value by using the provided slider.</li><li>As you can see, modifying the alpha value does not produce any transparency. The reason for this is that alpha blending is not enabled. Let's edit the source code to include alpha blending. Open the <code class="literal">ch06_11_transparency-initial.html</code> file in your source code editor. Scroll to the <code class="literal">configure</code> function and find these lines:</li></ol></div><pre class="programlisting">gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LESS);</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Below them, append the following lines:</li></ol></div><pre class="programlisting">gl.enable(gl.BLEND);
gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Save your changes as <code class="literal">ch06_12_transparency-final.html</code> and load this page on your web browser.</li><li>As expected, the wall changes its <span>transparency</span><a id="id325628736" class="indexterm"></a> as you modify its alpha value using the respective slider.</li><li>Remember that in order for transparency to be effective, the objects need to be rendered back to front. Let's take a look at the source code. Open <code class="literal">ch06_12_transparency-final.html</code> in your source code editor.</li><li>The cone is the farthest object in the scene. Hence, it is loaded first. You can check that by looking at the <code class="literal">load</code> function:</li></ol></div><pre class="programlisting">function load() {
  scene.add(new Floor(80, 20));
scene.load('/common/models/ch6/cone.json', 'cone');
scene.load('/common/models/ch6/wall.json', 'wall', {
diffuse: [0.5, 0.5, 0.2, 1.0],
ambient: [0.2, 0.2, 0.2, 1.0]
  });
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>It occupies a lower index in the <code class="literal">scene.objects</code> list. In the <code class="literal">render</code> function, the objects are rendered in the order in which they appear in the <code class="literal">scene.objects</code> list:</li></ol></div><pre class="programlisting">scene.traverse(object =&gt; {
  // ...
});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>What happens if we rotate the scene so that the cone is closer to the camera and the wall is farther away?</li><li>Open <code class="literal">ch06_12_transparency-final.html</code> in your browser and rotate the scene such that the cone appears in front of the wall. Decrease the alpha value of the cone while the alpha value of the wall remains at <code class="literal">1.0</code>.</li><li>As you can see, the blending is inconsistent. This does not have to do with alpha blending because in <code class="literal">ch06_12_transparency-final.html</code>, the blending is enabled. It has to do with the <span class="strong"><strong>rendering order</strong></span>. Click on the <strong class="userinput"><code>Wall First</code></strong> button. The scene should appear consistent now:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/f39fe9a0-f3d7-41e0-a990-417101cca073.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>The <strong class="userinput"><code>Cone First</code></strong>and<strong class="userinput"><code>Wall First</code></strong>buttons use a couple of new functions that we have included in the <code class="literal">Scene</code> class to change the rendering order. These functions are <code class="literal">renderSooner</code> and <code class="literal">renderFirst</code>.</li><li>In total, we have added these functions to the <code class="literal">Scene</code>object to deal with rendering order:<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">renderSooner(objectName)</code>: Moves the <code class="literal">objectName</code> object one position higher in the <code class="literal">Scene.objects</code> list.</li><li style="list-style-type: disc"><code class="literal">renderLater(objectName)</code>: Moves the <code class="literal">objectName</code> object one position lower in the <code class="literal">Scene.objects</code> list.</li><li style="list-style-type: disc"><code class="literal">renderFirst(objectName)</code>: Moves the <code class="literal">objectName</code> object to the first position of the list (index 0).</li><li style="list-style-type: disc"><code class="literal">renderLast(objectName)</code>: Moves the <code class="literal">objectName</code> object to the last position of the list.
</li><li style="list-style-type: disc"><code class="literal">renderOrder()</code>: Lists the objects in the <code class="literal">Scene.objects</code> list in the order in which they are rendered. This is the same order in which they are stored in the list. For any two given objects, the object with the lower index will be rendered first.</li></ul></div></li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="15" type="1"><li>You can use these functions from the JavaScript <span>conso</span><a id="id325652482" class="indexterm"></a><span>le</span><a id="id325652489" class="indexterm"></a> in your browser and see what effect these have on the scene.</li></ol></div><p><span class="emphasis"><em><span class="strong"><strong>What just happened?</strong></span></em></span></p><p>We took a simple scene where we implemented alpha blending. After that, we analyzed the importance of the rendering order in creating consistent transparencies. Finally, we presented the new methods of the <code class="literal">Scene</code> object that control the rendering order.</p></div>