<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec104"></a>Cube Maps</h2></div></div><hr /></div><p>Earlier in this chapter, we <span>mentioned</span><a id="id325357458" class="indexterm"></a> 2D textures and cube maps for creating complex effects using images. We covered textures, but exactly what are cube maps and how do we use them?</p><p>A <span class="strong"><strong>cube map</strong></span> is, very much like it sounds, a cube of textures. Six individual textures are created, each assigned to a different face of the cube. The graphics hardware can sample them as a single entity, by using a 3D texture coordinate.</p><p>The faces of the cube are identified by the axis they face and whether they are on the positive or negative side of that axis:</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/cfbe7615-ff59-4991-b68f-c91bc4254003.png" /></div><p>So far, we have manipulated a texture by specifying a texture target of <code class="literal">TEXTURE_2D</code>. Cube mapping introduces a few new texture targets that indicate we are working with cube maps. These targets also indicate which face of the cube map we're manipulating:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP</code></li><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP_POSITIVE_X</code></li><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP_NEGATIVE_X</code></li><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP_POSITIVE_Y</code></li><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP_NEGATIVE_Y</code></li><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP_POSITIVE_Z</code></li><li style="list-style-type: disc"><code class="literal">TEXTURE_CUBE_MAP_NEGATIVE_Z</code></li></ul></div><p>These targets are collectively known as the <code class="literal">gl.TEXTURE_CUBE_MAP_*</code> targets. Which one you need to use depends on the function you're calling.</p><p>Cube maps are created like a normal texture, but binding and <span>property</span><a id="id325617268" class="indexterm"></a> manipulation happen with the <code class="literal">TEXTURE_CUBE_MAP</code> target, as shown here:</p><pre class="programlisting">const cubeTexture = gl.createTexture();
gl.bindTexture(gl.TEXTURE_CUBE_MAP, cubeTexture);
gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);</pre><p>When uploading the image data for the texture, you need to specify the side that you are manipulating, as shown here:</p><pre class="programlisting">gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, positiveXImage);
gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_X, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, negativeXImage);
gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Y, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, positiveYImage);
// ...</pre><p>Exposing the cube map texture to the shader is done in the same way as a normal texture, just with the cube map target:</p><pre class="programlisting">gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_CUBE_MAP, cubeTexture);
gl.uniform1i(program.uCubeSampler, 0);</pre><p>However, the uniform type within the shader is specific to cube maps:</p><pre class="programlisting">uniform samplerCube uCubeSampler;</pre><p>When sampling from the cube map, you also use a cube map-specific function:</p><pre class="programlisting">texture(uCubeSampler, vCubeTextureCoords);</pre><p>The 3D coordinates you provide are normalized by the graphics hardware into a unit vector, which specifies a direction from the center of the "cube." A ray is traced along that vector, and where it intersects the cube face is where the texture is sampled:</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/aa224f83-af46-45d9-b441-c82f51e5cefe.png" /></div></div>