<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch12lvl1sec143"></a>Testing WebGL 2 Applications</h2></div></div><hr /></div><p>If you happened to <span>open</span><a id="id325358845" class="indexterm"></a> your browser's debugger tools throughout this book, you may have noticed that the <code class="literal">canvas</code> you saw was a complete "black box". That is, you cannot inspect any of its elements as you could with the DOM elements on a web page. If you come from a traditional web-development background, this may seem like a big problem, since we're used to leveraging the DOM to help us query elements to test our application. So, how can we ensure the quality and stability of our WebGL applications?</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl2sec202"></a>Visual Regression Testing</h3></div></div></div><p>Image comparisons of <span>various</span><a id="id325358870" class="indexterm"></a> application states throughout the development cycle is a common approach for testing WebGL applications. This technique, often <span>referred</span><a id="id325358878" class="indexterm"></a> to as <span class="strong"><strong>visual regression testing</strong></span>, performs front-end or user-interface regression testing by capturing the screenshots of web pages/UI and comparing them with the original images (either historical baseline screenshots or reference images from a live website):</p><div class="mediaobject"><img src="/graphics/9781788629690/graphics/491a575b-58df-4eaf-a4c7-fa1cdb43eb89.png" /></div><p>In the previous screenshot, you can see how the <strong class="userinput"><code>Baseline </code></strong>and <strong class="userinput"><code>Change </code></strong>are different via the final <strong class="userinput"><code>Diff</code></strong> output. This technique can be an effective approach for ensuring that your WebGL application continues to behave as expected.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note102"></a>Note</h3><p><strong class="userinput"><code>Visual Regression Testing Tools</code></strong><span class="strong"><strong></strong></span>Given your language of choice, you can find many open source visual regression testing tools that fit your technology stack on GitHub (<a class="ulink" href="https://github.com/search?q=visual+regression" target="_blank">https://github.com/search?q=visual+regression</a>).</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl2sec203"></a>Application Introspection Testing</h3></div></div></div><p>Another approach is to <span>mimic</span><a id="id325401203" class="indexterm"></a> the DOM API by <span>exposing</span><a id="id325401211" class="indexterm"></a> your WebGL elements via a custom API. For example, if we want to query a DOM element by its ID, we would do so via <code class="literal">document.getElementById('element-id')</code>. We could do the same with jQuery's simpler API via <code class="literal">$('#element-id')</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note103"></a>Note</h3><p><strong class="userinput"><code>jQuery</code></strong><span class="strong"><strong></strong></span>jQuery is a JavaScript library designed to simplify many of the common client-side scripting operations that are available. It is a free, open source software that uses the permissive MIT License. For more information, please visit <a class="ulink" href="https://jquery.com" target="_blank">https://jquery.com</a>.</p></div><p>To see an implementation of this approach, please <span>refer</span><a id="id325617264" class="indexterm"></a> to <span class="strong"><strong>Three Musketeers</strong></span> (<a class="ulink" href="https://github.com/webgl/three-musketeer" target="_blank">https://github.com/webgl/three-musketeer</a>), an open source library, which can be included in <span class="emphasis"><em>any</em></span> Three.js application with a single line of code. By including <code class="literal">three-musketeers</code>, we can run a variety of queries on elements in our scene, similar to DOM elements in a web page. Here are some sample queries for further illustration:</p><pre class="programlisting">$$$.<span>debug</span>();</pre><p><span><code class="literal">$$$</code> is an alias for a <code class="literal">three-musketeers</code> instance. The <code class="literal">debug</code> method enables visual debugging mode:</span></p><pre class="programlisting">$$$
.<span>find</span>(<span><span>'</span>Cube_1<span>'</span></span>)<span>
</span>.exists();
<span>// returns true
</span></pre><p><span>The <code class="literal">find</code> method searches the scene for an item with the ID of <code class="literal">Cube_1</code>. By calling <code class="literal">exists</code>, it returns a Boolean on whether it exists:</span></p><pre class="programlisting">$$$
.<span>findAll</span>((<span>node</span>) <span>=&gt;</span><span>node</span>.<span>geometry</span>.<span>type</span><span>===</span><span><span>'</span>BoxGeometry<span>'</span></span>);
</pre><p><span>Similar to <code class="literal">find</code>, <code class="literal">findAll</code> returns an array of items. In this case, instead of searching for a unique ID, we're looking for all of the geometries that match the <code class="literal">BoxGeometry</code> type:</span></p><pre class="programlisting">$$$
.<span>find</span>(<span><span>'</span>Cube_1<span>'</span></span>)
.<span>click</span>();
</pre><p>We find the geometry with the unique ID, <code class="literal">Cube_1</code>, and trigger a mouse click event on the <span class="emphasis"><em>appropriate</em></span> coordinates:</p><pre class="programlisting">window.<span>addEventListener</span>(<span><span>'</span>click<span>'</span></span>, (<span>event</span>) <span>=&gt;</span> {
 const<span>intersectedItems</span><span>=</span><span>$$$</span>.<span>pickFromEvent</span>(<span>event</span>);
 console.<span>log</span>(intersectedItems);
});</pre><p>This is a simple technique that's very helpful for debugging. Every time we click in our web page, we log all intersected geometries, given the mouse click's 2D coordinates mapped onto our 3D scene.</p><p>For more information, be sure to check out <code class="literal">three-musketeers</code> on GitHub (<a class="ulink" href="https://github.com/webgl/three-musketeers" target="_blank">https://github.com/webgl/three-musketeers</a>) or its documentation (<a class="ulink" href="https://webgl.github.io/three-musketeers" target="_blank">https://webgl.github.io/three-musketeers</a>).</p></div></div>