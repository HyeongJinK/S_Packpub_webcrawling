<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec31"></a>Time for Action: Querying the State of Buffers</h2></div></div><hr /></div><p>Follow the <span>given</span><a id="id325359415" class="indexterm"></a> steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the <code class="literal">ch02_05_state-machine.html</code> file in your browser. You should see the following:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/f23329a6-e9c5-4b0d-99bf-3a71634c62f5.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Open <code class="literal">ch02_05_state-machine.html</code> in your editor and scroll down to the <code class="literal">initBuffers</code> method:</li></ol></div><pre class="programlisting">function initBuffers() {
const vertices = [
1.5, 0, 0,
-1.5, 1, 0,
-1.5, 0.809017, 0.587785,
-1.5, 0.309017, 0.951057,
-1.5, -0.309017, 0.951057,
-1.5, -0.809017, 0.587785,
-1.5, -1, 0,
-1.5, -0.809017, -0.587785,
-1.5, -0.309017, -0.951057,
-1.5, 0.309017, -0.951057,
-1.5, 0.809017, -0.587785
];

indices = [
0, 1, 2,
0, 2, 3,
0, 3, 4,
0, 4, 5,
0, 5, 6,
0, 6, 7,
0, 7, 8,
0, 8, 9,
0, 9, 10,
0, 10, 1
];

// Create VAO
coneVAO = gl.createVertexArray();

// Bind VAO
gl.bindVertexArray(coneVAO);

const coneVertexBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, coneVertexBuffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), 
   gl.STATIC_DRAW);

// Configure instructions
gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, 
   false, 0, 0);
gl.enableVertexAttribArray(program.aVertexPosition);

coneIndexBuffer = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, coneIndexBuffer);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), 
   gl.STATIC_DRAW);

// Set the global variables based on the parameter type
if (coneVertexBuffer === 
    gl.getParameter(gl.ARRAY_BUFFER_BINDING)) {
    vboName = 'coneVertexBuffer';
}
if (coneIndexBuffer === 
    gl.getParameter(gl.ELEMENT_ARRAY_BUFFER_BINDING)) {
    iboName = 'coneIndexBuffer';
}

  vboSize = gl.getBufferParameter(gl.ARRAY_BUFFER, gl.BUFFER_SIZE);
vboUsage = gl.getBufferParameter(gl.ARRAY_BUFFER, 
   gl.BUFFER_USAGE);

iboSize = gl.getBufferParameter(gl.ELEMENT_ARRAY_BUFFER, 
   gl.BUFFER_SIZE);
iboUsage = gl.getBufferParameter(gl.ELEMENT_ARRAY_BUFFER, 
   gl.BUFFER_USAGE);

try {
    isVerticesVbo = gl.isBuffer(vertices);
}
catch (e) {
    isVerticesVbo = false;
}

  isConeVertexBufferVbo = gl.isBuffer(coneVertexBuffer);

// Clean
gl.bindVertexArray(null);
gl.bindBuffer(gl.ARRAY_BUFFER, null);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Pay attention to how we <span>use</span><a id="id325617273" class="indexterm"></a> the methods discussed in this section to retrieve and display information about the current state of the buffers.</li><li>The information queried by the <code class="literal">initBuffers</code> function is shown in the settings section of the web page when we use <code class="literal">updateInfo</code>.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>In the settings section of the web page, you will see the following result:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/d5fa71f3-cc2f-43e2-80e4-611b9de07695.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Copy the following line, <code class="literal">gl.bindBuffer(gl.ARRAY_BUFFER, null);</code>, and paste it right before the following line inside of the <code class="literal">initBuffers</code>function: <code class="literal">coneIndexBuffer = gl.createBuffer();</code>.</li><li>What happens when you launch the page in your browser again?</li><li>Why do you think this behavior occurs?</li></ol></div><p><span class="emphasis"><em><span class="strong"><strong>What just happened?</strong></span></em></span></p><p>You have learned that the currently-bound buffer is a state variable in WebGL. The buffer is bound until you unbind it by calling <code class="literal">bindBuffer</code> again with the corresponding type (<code class="literal">ARRAY_BUFFER</code> or <code class="literal">ELEMENT_ARRAY_BUFFER</code>) as the first parameter and with <code class="literal">null</code> as the second argument (that is, no buffer to bind). You have also learned that you can only query the state of the currently-bound buffer. Therefore, if you <span>want</span><a id="id325643465" class="indexterm"></a> to query a different buffer, you need to bind it first.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec31"></a>Have a Go: Add One Validation</h3></div></div></div><p>Modify the file so that <span>you</span><a id="id325643480" class="indexterm"></a> can validate and show on screen whether the indices array and the <code class="literal">coneIndexBuffer</code> are WebGL buffers.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip28"></a>Note</h3><p><span class="strong"><strong><strong class="userinput"><code>Hint</code></strong></strong></span>
In order to display the values, you will have to modify the table in the HTML body and modify the <code class="literal">updateInfo</code> function accordingly.</p></div></div></div>