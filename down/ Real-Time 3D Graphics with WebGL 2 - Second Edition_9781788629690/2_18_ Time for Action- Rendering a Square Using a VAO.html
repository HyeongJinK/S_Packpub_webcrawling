<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec28"></a>Time for Action: Rendering a Square Using a VAO</h2></div></div><hr /></div><p>Let's <span>refactor</span><a id="id325357458" class="indexterm"></a> a <span>previous</span><a id="id325359384" class="indexterm"></a> example using VAOs:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up <code class="literal">ch02_01_square.html</code> in your editor.</li><li>First, we update our global variables:</li></ol></div><pre class="programlisting">// Global variables that are set and used
// across the application
let gl,
program,
<span class="strong"><strong>squareVAO</strong></span><span class="strong"><strong>,</strong></span>
squareIndexBuffer,
indices;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>We've replaced <code class="literal">squareVertexBuffer</code> with <code class="literal">squareVAO</code>, as we no longer need to reference the vertex buffer directly.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Next, we update the <code class="literal">initBuffers</code> functions as follows:</li></ol></div><pre class="programlisting">// Set up the buffers for the square
function initBuffers() {
/*
    V0                    V3
    (-0.5, 0.5, 0)        (0.5, 0.5, 0)
    X---------------------X
    |                     |
    |                     |
    |       (0, 0)        |
    |                     |
    |                     |
    X---------------------X
    V1                    V2
    (-0.5, -0.5, 0)       (0.5, -0.5, 0)
  */
const vertices = [
    -0.5, 0.5, 0,
-0.5, -0.5, 0,
0.5, -0.5, 0,
0.5, 0.5, 0
];

// Indices defined in counter-clockwise order
indices = [0, 1, 2, 0, 2, 3];

<span class="strong"><strong>// Create VAO instance
squareVAO = gl.createVertexArray();

// Bind it so we can work on it
gl.bindVertexArray(squareVAO)</strong></span><span class="strong"><strong>;</strong></span>

const squareVertexBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, squareVertexBuffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), 
   gl.STATIC_DRAW);

<span class="strong"><strong>// Provide instructions for VAO to use data later in draw
gl.enableVertexAttribArray(program.aVertexPosition);
gl.vertexAttribPointer(program.aVertexPosition, 3, gl.FLOAT, 
   false, 0, 0);
</strong></span>
// Setting up the IBO
squareIndexBuffer = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, squareIndexBuffer);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), 
   gl.STATIC_DRAW);

// Clean
<span class="strong"><strong>gl.bindVertexArray(null)</strong></span><span class="strong"><strong>;</strong></span>
gl.bindBuffer(gl.ARRAY_BUFFER, null);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>We create a new VAO instance using <code class="literal">gl.createVertexArray();</code> and assign it to <code class="literal">squareVAO</code>.</li><li>Then, we bind <code class="literal">squareVAO</code> with <code class="literal">gl.bindVertexArray(squareVAO);</code> so that all of our attribute settings will apply to that set of attribute state.</li><li>After the <code class="literal">squareVertexBuffer</code> has been configured, we instruct the currently bound VAO (i.e. <code class="literal">squareVAO</code>) on how to extract data given the instructions for <code class="literal">aVertexPosition</code>. These instructions are the same ones that previously sat inside of the <code class="literal">draw</code> function; but now, they happen <span class="emphasis"><em>once </em></span>during initialization.</li><li>Lastly, we need to use this VAO in our <code class="literal">draw</code> function:</li></ol></div><pre class="programlisting">// We call draw to render to our canvas
function draw() {
// Clear the scene
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);

<span class="strong"><strong>// Bind the VAO
gl.bindVertexArray(squareVAO)</strong></span><span class="strong"><strong>;</strong></span>

gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, squareIndexBuffer);

// Draw to the scene using triangle primitives
gl.drawElements(gl.TRIANGLES, indices.length, gl.UNSIGNED_SHORT, 
   0);

// Clean
<span class="strong"><strong>gl.bindVertexArray(null);
</strong></span>gl.bindBuffer(gl.ARRAY_BUFFER, null);
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>The updated <code class="literal">draw</code> function is <span>far</span><a id="id325647134" class="indexterm"></a> simpler! We simply bind the VAO (i.e. <code class="literal">squareVAO</code>) and allow for it to handle the <span>instructions</span><a id="id325647146" class="indexterm"></a> we provided it inside of <code class="literal">initBuffers</code>.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Lastly, it's good practice to unbind buffers and VAOs after usage by providing <code class="literal">null</code> values.</li><li>Save the file and open it in your browser. You should see the same square being rendered using a VAO:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788629690/graphics/55375ee8-fdb2-412b-a006-a0c33c958a12.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>The source code for this exercise can be found in <code class="literal">ch02_03_square-vao.html</code>.</li></ol></div><p>Given that we're currently rendering a single geometry, using a VAO may seem unnecessarily complex. That is a reasonable assessment! However, as the complexity of our application grows, using VAOs becomes a foundational feature.</p></div>