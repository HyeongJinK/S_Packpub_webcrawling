<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec19"></a>Instance profiles</h2></div></div><hr /></div><p>In order for Kubernetes to make <span>use</span><a id="id325162570" class="indexterm"></a> of its integrations with the AWS cloud APIs, we need to set up IAM instance profiles. An instance profile is a way for the Kubernetes software to authenticate with the AWS API, and for us to assign fine-grained permissions on the actions that Kubernetes can take.</p><p>It can be confusing to learn all of the permissions that Kubernetes requires to function correctly. You could just set up instance profiles that allow full access to AWS, but this would be at the expense of security best practice.</p><p>Whenever we assign security permissions, we should be aiming to grant just enough permissions for our software to function correctly. To this end, I have collated a set of minimal IAM policies that will allow our cluster to function correctly, without giving excess permissions away.</p><p>You can view these policies at <a class="ulink" href="https://github.com/errm/k8s-iam-policies" target="_blank">https://github.com/errm/k8s-iam-policies</a>, where I have documented each policy with a brief description of its purpose.</p><p>The repository includes a simple shell script that we can use to create an IAM instance profile for the master and worker nodes in our cluster, as follows:</p><pre class="programlisting"><span class="strong"><strong>$ curl https://raw.githubusercontent.com/errm/k8s-iam-policies/master/setup.sh -o setup.sh</strong></span><span class="strong"><strong>$ sh -e setup.sh</strong></span><span class="strong"><strong>{</strong></span><span class="strong"><strong>  "InstanceProfile": {</strong></span><span class="strong"><strong>      "Path": "/",</strong></span><span class="strong"><strong>      "InstanceProfileName": "K8sMaster",</strong></span><span class="strong"><strong>      "InstanceProfileId": "AIPAJ7YTS67QLILBZUQYE",</strong></span><span class="strong"><strong>      "Arn": "arn:aws:iam::642896941660:instance-profile/K8sMaster",</strong></span><span class="strong"><strong>      "CreateDate": "2018-02-26T19:06:19.831Z",</strong></span><span class="strong"><strong>      "Roles": []</strong></span><span class="strong"><strong>  }</strong></span><span class="strong"><strong>}</strong></span><span class="strong"><strong>{</strong></span><span class="strong"><strong>  "InstanceProfile": {</strong></span><span class="strong"><strong>      "Path": "/",</strong></span><span class="strong"><strong>      "InstanceProfileName": "K8sNode",</strong></span><span class="strong"><strong>      "InstanceProfileId": "AIPAJ27KNVOKTLZV7DDA4",</strong></span><span class="strong"><strong>      "Arn": "arn:aws:iam::642896941660:instance-profile/K8sNode",</strong></span><span class="strong"><strong>      "CreateDate": "2018-02-26T19:06:25.282Z",</strong></span><span class="strong"><strong>      "Roles": []</strong></span><span class="strong"><strong>  }</strong></span><span class="strong"><strong>}</strong></span></pre></div>