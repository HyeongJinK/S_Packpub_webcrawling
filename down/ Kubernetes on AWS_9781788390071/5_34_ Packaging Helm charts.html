<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec38"></a>Packaging Helm charts</h2></div></div><hr /></div><p>While we are developing our chart, it is simple to use the Helm CLI to deploy our chart straight from the local filesystem. However, Helm also allows you to create your <span>own</span><a id="id325268218" class="indexterm"></a> repository in order to share your charts.</p><p>A Helm repository is a collection of packaged Helm charts, plus an index stored in a particular directory structure on a standard HTTP web server.</p><p>Once you are happy with your chart, you will want to package it so it is ready to distribute in a Helm repository. This is simple to do with the <code class="literal">helm package</code> command. When you start to distribute your charts with a repository, versioning becomes important. The version number of a chart in a Helm repository needs to follow the SemVer 2 guidelines.</p><p>In order to build a packaged chart, start by checking that you have set an appropriate version number in <code class="literal">Chart.yaml</code>. If this is the first time you have packaged your chart, the default will be OK:</p><pre class="programlisting"><span class="strong"><strong>$ helm package version-app</strong></span><span class="strong"><strong>Successfully packaged chart and saved it to: ~/helm-charts/version-app-0.1.0.tgz</strong></span></pre><p>You can test a packaged chart without uploading it to a repository by using the <code class="literal">helm serve</code> command. This command will serve all of the packaged charts found in the current directory and generate an index on the fly:</p><pre class="programlisting"><span class="strong"><strong>$ helm serve</strong></span><span class="strong"><strong>Regenerating index. This may take a moment.</strong></span><span class="strong"><strong>Now serving you on 127.0.0.1:8879</strong></span></pre><p>You can now try installing your chart by using the local repository:</p><pre class="programlisting"><span class="strong"><strong>$ helm install local/version-app</strong></span></pre><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec52"></a>You can test building an index</h3></div></div></div><p>An Helm repository is just a <span>collection</span><a id="id325751218" class="indexterm"></a> of packaged charts stored in a directory. In order to discover and search the charts and versions available in a particular repository, the Helm client downloads a special <code class="literal">index.yaml</code> that includes metadata about each packaged chart and the location it can be downloaded from.</p><p>In order to generate this index file, we need to copy all the packaged charts that we want in our index to the same directory:</p><pre class="programlisting"><span class="strong"><strong>cp ~/helm-charts/version-app-0.1.0.tgz ~/helm-repo/</strong></span></pre><p>Then, in order to generate the <code class="literal">index.yaml</code> file, we use the <code class="literal">helm repo index</code> command. You will need to pass the root URL where the packaged charts will be served from. This could be the address of a web server, or on AWS, you might use a S3 bucket:</p><pre class="programlisting"><span class="strong"><strong>helm repo index ~/helm-repo --url https://helm-repo.example.org</strong></span></pre><p>The chart index is quite a simple format, listing the name of each chart available, and then providing a list of each version available for each named chart. The index also includes a checksum in order to validate the download of charts from the repository:</p><pre class="programlisting">apiVersion: v1 
entries: 
  version-app: 
  - apiVersion: v1 
    created: 2018-01-10T19:28:27.802896842Z 
    description: A Helm chart for Kubernetes 
    digest: 79aee8b48cab65f0d3693b98ae8234fe889b22815db87861e590276a657912c1 
    name: version-app 
    urls: 
    - https://helm-repo.example.org/version-app-0.1.0.tgz 
    version: 0.1.0 
generated: 2018-01-10T19:28:27.802428278Z </pre><p>The generated <code class="literal">index.yaml</code> file for our new chart repository.</p><p>Once we have created the <code class="literal">index.yaml</code> file, it is simply a question of copying your packaged charts and the index file to the host you have chosen to use. If you are using S3, this might look like this:</p><pre class="programlisting"><span class="strong"><strong>aws s3 sync ~/helm-repo s3://my-helm-repo-bucket</strong></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note43"></a>Note</h3><p>In order for Helm to be able to use your repository, your web server (or S3) needs to be correctly configured.
The web server needs to serve the <code class="literal">index.yaml</code> file with the correct content type header (<code class="literal">text/yaml</code> or <code class="literal">text/x-yaml</code>).
The charts need to be available at the URLs listed in the index.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec53"></a>Using your repository</h3></div></div></div><p>Once you have set up the repository, you <span>can</span><a id="id325753366" class="indexterm"></a> configure Helm to use it:</p><pre class="programlisting"><span class="strong"><strong>helm repo add my-repo https://helm-repo.example.org 
my-repo has been added to your repositories</strong></span></pre><p>When you add a repository, Helm validates that it can indeed connect to the URL given and download the index file.</p><p>You can check this by searching for your chart by using <code class="literal">helm search</code>:</p><pre class="programlisting"><span class="strong"><strong>$ helm search version-app 
NAME                  VERSION     DESCRIPTION 
my-repo/version-app   0.1.1       A Helm chart for Kubernetes</strong></span></pre></div></div>