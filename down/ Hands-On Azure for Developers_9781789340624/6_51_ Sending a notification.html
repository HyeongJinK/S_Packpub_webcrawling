<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec54"></a>Sending a notification</h2></div></div><hr /></div><p>The main functionality of Notification Hub is to <span>send</span><a id="id325143086" class="indexterm"></a> a notification to a set of registered devices. You will see that, using its SDK and portal, you can easily start using that feature without knowing the internal logic of different PNSes. After this section, you should be able to use Notification Hub without problems and incorporate it into your applications.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec50"></a>Sending a test notification</h3></div></div></div><p>While developing your application, you always need a way to test it. When using Notification Hub, you <span>have</span><a id="id325128385" class="indexterm"></a> two options when it comes to sending a test notification—either use the portal or its SDK. Both possibilities allow for similar results; however, using the SDK is a bit more flexible as it is easier to find all of the devices to which you would like to send a notification or add any kind of logic.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec41"></a>Test notification in Azure Portal</h4></div></div></div><p>When you go to the hub you created, you <span>will</span><a id="id325128379" class="indexterm"></a> see that, at the top of the page, there is a <strong class="userinput"><code>Test Send </code></strong>button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/95193558-cec6-4069-84a2-b3fda811f11b.png" /></div><p>When you click on it, you will see a screen for the <strong class="userinput"><code>Test Send</code></strong> functionality. There are a few fields available and they all depend on the platform selected. In the following, you can find a sample request for the Windows platform:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/fdb989e7-1183-443f-ad28-2c566a9d9eb4.png" /></div><p>Now, if you click the <strong class="userinput"><code>Send</code></strong> button, Notification Hub will select ten different registered devices, which will receive a notification. If you want, you can change both the type and the payload sent. What is more, you can send a message to a specific set of devices by specifying the <strong class="userinput"><code>Send to Tag Expression</code></strong> option.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec42"></a>Test notification in the SDK</h4></div></div></div><p>It is also possible to send a <span>test</span><a id="id325128296" class="indexterm"></a> notification using the Notification Hub SDK. To use it, you will need to install the following package: <code class="literal">Microsoft.Azure.NotificationHubs</code>. Consider the following example:</p><pre class="programlisting">var hub = NotificationHubClient.CreateClientFromConnectionString(
                "&lt;connection string&gt;",
                "&lt;hub&gt;", true);</pre><p>The last parameter enables sending a test notification. That means that, each time you send a notification using the SDK, it will be sent to a maximum of ten registered devices. Additionally, you will get the outcome of each operation (whether it succeeded or failed).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip87"></a>Note</h3><p>Remember that, when test mode is enabled, each request to Notification Hub is throttled. That means that you will not be able to overload your communication channel as send operations will be queued and executed in a controlled manner.</p></div><p>You can check whether test send is enabled by checking a property on the <code class="literal">NotificationHubClient</code> object:</p><pre class="programlisting">var hub = NotificationHubClient.CreateClientFromConnectionString(
                "&lt;connection string&gt;",
                "&lt;hub&gt;", true);
if (hub.EnableTestSend)
{
    // Do something....
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec51"></a>Using the SDK to send a notification</h3></div></div></div><p>The Notification Hub SDK brings <span>many</span><a id="id325128261" class="indexterm"></a> different methods for sending notifications, depending on the configuration and expected output. Here you can find all the methods available in the SDK:</p><pre class="programlisting">hub.SendAdmNativeNotificationAsync();
hub.SendAppleNativeNotificationAsync();
hub.SendBaiduNativeNotificationAsync();
hub.SendDirectNotificationAsync();
hub.SendNotificationAsync();
hub.SendTemplateNotificationAsync();
hub.SendGcmNativeNotificationAsync();
hub.SendWindowsNativeNotificationAsync();</pre><p>As you can see, we have two different categories:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Native notifications</strong></span>: Methods for <span>sending</span><a id="id324830075" class="indexterm"></a> a notification to a specific platform only</li><li style="list-style-type: disc"><span class="strong"><strong>Generic notifications</strong></span>: A set of <span>methods</span><a id="id324830089" class="indexterm"></a> for sending a notification to a specific tag</li></ul></div><p>I strongly encourage you to experiment and test different possibilities as each method is a bit different. Here you can find the result of calling <code class="literal">SendAppleNativeNotificationAsync()</code> and serializing the output:</p><pre class="programlisting">var hub = NotificationHubClient.CreateClientFromConnectionString(
                "&lt;connection string&gt;",
                "&lt;hub&gt;", true);
hub.SendAppleNativeNotificationAsync("{\"aps\":{\"alert\":\"Notification Hub test notification\"}}");</pre><p>The result will be as follows in my case:</p><pre class="programlisting">{
  "Result": {
    "Success": 8,
    "Failure": 0,
    "Results": [{
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "1013412858828458675-3388525925469165319-3",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "4629243313258036270-2338090353657828558-2",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "5538320565569680693-6905916546981709583-3",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "5711668963446635284-8967913844749790004-1",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "5728263539515349341-3583197654290557965-2",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "6986970356553456728-8953287549645821249-1",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "7231787013272625417-8398074035919763615-3",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }, {
      "ApplicationPlatform": "apple",
      "PnsHandle": "&lt;pns handle&gt;",
      "RegistrationId": "8026985566358875763-8860727728212773916-1",
      "Outcome": "The Notification was successfully sent to the Push Notification System"
    }]
  },
  "Id": 9,
  "Exception": null,
  "Status": 5,
  "IsCanceled": false,
  "IsCompleted": true,
  "CreationOptions": 0,
  "AsyncState": null,
  "IsFaulted": false
}</pre><p>As you can see, we get the complete result of sending a notification to a set of registered devices. You can leverage that output to work with your application and, for instance, display the appropriate status or report.</p></div></div>