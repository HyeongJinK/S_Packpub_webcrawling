<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec11"></a>Creating and deploying Azure App Service</h2></div></div><hr /></div><p>To get started with <span>Azure</span><a id="id326452337" class="indexterm"></a> App Service, you have to learn how to <span>create</span><a id="id326452331" class="indexterm"></a> that service and deploy your code. You will see how Azure provides many different ways for doing so, and each path can be easier or harder, depending on your current needs and the specification of your application. However, the <span>strength</span><a id="id325760924" class="indexterm"></a> of a cloud and <span class="strong"><strong>Platform as a Service</strong></span> (<span class="strong"><strong>PaaS</strong></span>) offering lies in the straightforward and intuitive process of provisioning new components of your system. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec4"></a>Creating Azure App Service using the Azure Portal</h3></div></div></div><p>To begin with App Service, I will show you how you can <span>create</span><a id="id325760946" class="indexterm"></a> your very first web app using the Azure Portal. In fact, all you need is your mouse and keyboard (because each application has to have a name)—neither external hardware nor detailed configuration information is required here, because Azure will do everything for you.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec0"></a>Selecting Azure Web App from available services</h4></div></div></div><p>To create Azure App <span>Service</span><a id="id325764785" class="indexterm"></a> in the Azure Portal, you first have to <span>find</span><a id="id325764793" class="indexterm"></a> it in the list of available services. The easiest way to do so is to click on <strong class="userinput"><code>+ Create a resource </code></strong>button and search for <code class="literal">Web App</code>:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/2032b60a-302e-44ac-9b28-ce1d4dfd65dc.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip3"></a>Note</h3><p>Instead of using the <strong class="userinput"><code>+ Create a resource</code></strong><span class="strong"><strong> </strong></span>button, you can click on <strong class="userinput"><code>App Services</code></strong>—it will forward you to a different view, where you can create an App Service by clicking on the <strong class="userinput"><code>+ Add</code></strong><span class="strong"><strong> </strong></span>button. This is true for all of the most popular Azure services, such as SQL databases, virtual machines, and storage accounts.</p></div><p>As you can see, the Azure Portal tries to help you find the service most relevant to the search string. When you click on the <strong class="userinput"><code>Web App</code></strong><span class="emphasis"><em> </em></span>item, you will see another screen containing multiple similar items, all related in some way to the one you are searching for:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/3c67db70-f81f-4f2f-a89c-f73be3a72101.png" /></div><p>For the purpose of this exercise, select <strong class="userinput"><code>Web App</code></strong><span class="emphasis"><em>, </em></span>and then click on the <strong class="userinput"><code>Create</code></strong> button at the right bottom of the screen.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip4"></a>Note</h3><p>In the beginning, it is always easier to select the most generic option when it comes to choosing a service. When you gain more experience and become more familiar with available services, you will see that Azure offers many useful preconfigured setups (such as an integrated Web App and SQL database), which can be used to shorten development and configure all services in one place.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec1"></a>Configuring an Azure web app</h4></div></div></div><p>When you click on the <strong class="userinput"><code>Create </code></strong>button, you will see a screen where you <span>can</span><a id="id325767105" class="indexterm"></a> enter all the information needed to create a web app. All required fields are marked using an <strong class="userinput"><code>*</code></strong> (asterisk) symbol:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/ef2d4764-a4e4-4be2-93f4-31acc712ef99.png" /></div><p>As you can see, when creating a web app, we have to fill almost all fields (with a little exception regarding the <strong class="userinput"><code>Application Insights</code></strong><span class="emphasis"><em> </em></span>radio button, which we will cover in the next chapters). Let's focus on each field separately, so we have a better understanding of how they work:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>App name</code></strong>: This field represents the domain name of your application. It is important to select both a unique and valid name, as it cannot be changed later on. Please note that you can easily attach your own custom domain if needed.
</li><li style="list-style-type: disc"><strong class="userinput"><code>Subscription</code></strong>: If you have access to more than one subscription, you will be given an opportunity to select the right one for this particular resource. Thanks to that, you will be able to differentiate the cost between, for example, different projects.</li><li style="list-style-type: disc"><strong class="userinput"><code>Resource Group</code></strong>: In Azure, each resource has to be a part of a logic container, called a resource group. This does not imply any additional cost by itself, so you do not have to worry about creating multiple resource groups.</li><li style="list-style-type: disc"><strong class="userinput"><code>OS</code></strong>: Currently in Azure, you can create a web app using the different operating systems of <strong class="userinput"><code>Windows</code></strong>, <strong class="userinput"><code>Linux</code></strong>, or <strong class="userinput"><code>Docker</code></strong> containers. This choice can impact both cost and performance, so make sure you have chosen the right operating system for your needs.</li><li style="list-style-type: disc"><strong class="userinput"><code>App Service plan/Location</code></strong>: App Services in Azure are directly linked to App Service Plans, which provide different features and performance depending on the option you choose. </li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip5"></a>Note</h3><p>It is always a good practice to leverage resource groups and separate your resources using a specific filter, such as the lifetime of resources, or the given environment (that is, production, staging, or testing). Resource groups gives you better control over deployed services and allows for more granular control over who can access a resource.</p></div><p>Since you are just starting with Azure, you probably do not have any App Service Plans<span class="emphasis"><em> </em></span>created. As we cannot create an App Service without an App Service Plan, we will sort this now.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch01lvl4sec0"></a>Creating an App Service Plan</h5></div></div></div><p>When you click on <strong class="userinput"><code>App Service plan/Location</code></strong>,<span class="emphasis"><em> </em></span>you will <span>see</span><a id="id325767532" class="indexterm"></a> a screen with the <strong class="userinput"><code>+ Create new</code></strong><span class="strong"><strong> </strong></span>button, allowing for the creation of a new App Service Plan. It should look like this:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/803c18f2-17e3-45b1-a4c7-4ea9db393401.png" /></div><p>As you can see, we have to enter three fields:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>App Service plan</code></strong>: This is the name of your App Service Plan, which has to be unique within a resource group.</li><li style="list-style-type: disc"><strong class="userinput"><code>Location</code></strong>: Thanks to this setting, we can locate our App Service Plan<span class="emphasis"><em> </em></span>in a specific region. This sometimes implies different features are available.</li><li style="list-style-type: disc"><strong class="userinput"><code>Pricing tier</code></strong>: When you click on this item, you will see another screen presenting available features for different available tiers. This choice is really important feature-wise, and will depend in most cases on the environmental characteristics you are planning (such as <strong class="userinput"><code>Dev / Test</code></strong> environments, <strong class="userinput"><code>Production</code></strong> applications, whether you need deployment slots or not, and so on):</li></ul></div><div class="mediaobject"><img src="/graphics/9781789340624/graphics/3cc1453d-7bc2-4e43-bb3b-79d5529ed2eb.png" /></div><p>As you can see in the preceding screenshot, we have three categories of App Service Plans:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Dev / Test</code></strong>: This one contains F, D, and B tiers (which stand for free, shared, and basic). They are designed for simple dev/test scenarios and lightweight web applications that do not need features such as autoscaling or backups.</li><li style="list-style-type: disc"><strong class="userinput"><code>Production</code></strong>: This offers powerful machines and advanced features that are useful in many realistic scenarios, such as APIs, e-commerce, and popular portals.</li><li style="list-style-type: disc"><strong class="userinput"><code>Isolated</code></strong>: This uses the same hardware as the <strong class="userinput"><code>Production </code></strong>tier, but with even more features and possibilities to isolate your web apps from external access. This is the most expensive category, but can be helpful when creating systems that cannot be made available publicly. </li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip6"></a>Note</h3><p>It is important to remember that tiers F and D have a limited amount of computing time per day. That means that once you exceed the limit (60 minutes for the F tier, and 240 minutes for the D tier) of your processing time, your application will become unavailable and be suspended until the next day. </p></div><p>For the purpose of this exercise, I would recommend selecting any tier from the <strong class="userinput"><code>Dev / Test</code></strong><span class="strong"><strong> </strong></span>category. Once you are satisfied with the option you've selected, you can click the <strong class="userinput"><code>Apply </code></strong>button. My configuration, for example, looks like this:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/b0e0d118-cab3-455b-973c-ac4f264550e0.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip7"></a>Note</h3><p>Remember that you can always upgrade (or scale up) the instance of your App Service Plan, for example, when you need a specific feature or the popularity of your application has grown. This is one of the biggest advantages of cloud over on-premises, where you would have to buy and set up new machines on your own.</p></div><p>Now, you can click <strong class="userinput"><code>OK</code></strong>, and you will return to the <strong class="userinput"><code>Web App</code></strong><span class="emphasis"><em> </em></span>blade, where you can enter missing fields. Here, you can <span>see</span><a id="id325768339" class="indexterm"></a> the whole configuration of my web app:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/3dc5294d-634f-411f-947d-fc71fc68cd30.png" /></div><p>Now the only thing left is to click on the <strong class="userinput"><code>Create </code></strong>button and wait several seconds for the creation of a new resource. During this time, Azure will validate the template and parameters, and orchestrate multiple underlying controllers to create a service. Once a new resource is created, you should see a notification and be able to see in your resources. To quickly validate this, click on the <strong class="userinput"><code>All resources</code></strong><span class="strong"><strong> </strong></span>button on the left and filter all of them using, for example, the name of the App Service<span class="emphasis"><em> </em></span>you have created:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/cab363a4-1c01-4611-9e0e-af8773100b9b.png" /></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec5"></a>Creating an Azure App Service using Visual Studio</h3></div></div></div><p>If you do not want to create your web apps using the <span>Azure</span><a id="id325775587" class="indexterm"></a> Portal, you can use Microsoft Visual Studio, which has built-in integration for many <span>different</span><a id="id325775595" class="indexterm"></a> Azure services.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note8"></a>Note</h3><p>This exercise was created using Microsoft Visual Studio 2017 (15.6.4) with Azure workloads installed. If you want to configure your instance and ensure everything is set up correctly, please follow the short tutorial available at <a class="ulink" href="https://docs.microsoft.com/en-us/dotnet/azure/dotnet-tools?view=azure-dotnet&amp;tabs=windows" target="_blank">https://docs.microsoft.com/en-us/dotnet/azure/dotnet-tools?view=azure-dotnet&amp;tabs=windows</a>.</p></div><p> </p><p> </p><p>In Visual Studio, click on <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>New</code></strong> <strong class="userinput"><code>Project</code></strong>. This will <span>display</span><a id="id325775632" class="indexterm"></a> a <strong class="userinput"><code>New Project</code></strong><span class="emphasis"><em> </em></span>window, where you <span>can</span><a id="id325994134" class="indexterm"></a> find plenty of different templates for starting with a new application. Because we are interested in cloud projects, let's start with the <strong class="userinput"><code>Cloud </code></strong>category:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/d2281349-b88d-4b6a-8fc0-22d3b145a3be.png" /></div><p>Since we are working with App Services in this chapter, the template we are interested in is <strong class="userinput"><code>ASP.NET Web Application (.NET Framework)</code></strong>. The other valid option here is also <strong class="userinput"><code>ASP.NET Core Web Application</code></strong>—feel free to use it if you feel confident enough to work with the latest .NET releases, as we will cover both scenarios. When you are satisfied with your choice, click <strong class="userinput"><code>OK</code></strong>.</p><p> </p><p>The next step is the selection of the proper template. Here, you have multiple options, such as the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Empty</code></strong>: The most simple option, which lets you have full control over installed packages and overall structure</li><li style="list-style-type: disc"><strong class="userinput"><code>Web Forms</code></strong>: The oldest available framework for building web applications, using many built-in controls with data access</li><li style="list-style-type: disc"><strong class="userinput"><code>MVC</code></strong>: A well-known <span class="strong"><strong>model-view-controller</strong></span> (<span class="strong"><strong>MVC</strong></span>) architecture, which took the <span>place</span><a id="id326152609" class="indexterm"></a> of <strong class="userinput"><code>Web Forms</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>Web API</code></strong>: A template for creating RESTful HTTP services using the .NET programming stack</li><li style="list-style-type: disc"><strong class="userinput"><code>Single Page Application</code></strong>:<span class="strong"><strong> </strong></span>This template comes with plenty of additional tools for building client-side interactions</li></ul></div><p>All the preceding options should be more or less familiar to you. However, thanks to installing the Azure toolset, you should have access to two additional templates:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Azure API App</code></strong>: This offers additional integrations with different Azure services such as Azure AD, API Management, and Logic apps</li><li style="list-style-type: disc"><strong class="userinput"><code>Azure Mobile App</code></strong>: A template for building mobile backends</li></ul></div><p>However, we will cover those two in the next sections of this chapter. For now, to proceed, let's select <strong class="userinput"><code>MVC</code></strong>,<strong class="userinput"><code> </code></strong>as this is the most common and simplest of all templates listed here. Use the default options for this template and click<strong class="userinput"><code> </code></strong><strong class="userinput"><code>OK</code></strong>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip9"></a>Note</h3><p>You have probably noticed an additional button, which I have not described, <strong class="userinput"><code>Change Authentication</code></strong>. It allows for selecting the method used for authenticating access to your web application. We will cover that feature in the section describing the security of web apps in Azure.</p></div><p>After several seconds, Visual Studio should generate a project based on the selected template. I believe it should look familiar to you, as it is not that different to a traditional web application created from an MVC template. I am sure you cannot wait to see whether it works—do not wait any longer, and press <span class="emphasis"><em>F5</em></span> to start the application.</p><p> </p><p> </p><p>You should see a screen similar to mine:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/41ef123a-7ce5-49b5-a57b-53ad3a23095f.png" /></div><p>As you can see, it is the same generic template that you would see when starting with a traditional project. The question is, how can we deploy it to <span>Azure</span><a id="id326389476" class="indexterm"></a> to have our website working in the cloud? </p><p>Let's stop our website running locally and go back to Visual Studio for a moment. When you right-click on a project icon, you will see a context menu. There, between multiple different options, you can click on <strong class="userinput"><code>Publish...</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/7a24dcfe-a618-48a0-b8e8-b6e668c5a09e.png" /></div><p>Since this is a cloud project, you will see additional options besides <strong class="userinput"><code>IIS</code></strong>, <strong class="userinput"><code>FTP</code></strong>, and <strong class="userinput"><code>Folder</code></strong>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>App Service</code></strong>: This is for deploying your application to a PaaS service</li><li style="list-style-type: disc"><strong class="userinput"><code>Azure Virtual Machines</code></strong>: This is for deploying your application to a virtual machine that you have configured</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>Because the topic of this book is PaaS services, we will not cover deploying a web app to a virtual machine. However, if you are interested in doing so, proper instructions are available at <a class="ulink" href="https://github.com/aspnet/Tooling/blob/AspNetVMs/docs/create-asp-net-vm-with-webdeploy.md" target="_blank">https://github.com/aspnet/Tooling/blob/AspNetVMs/docs/create-asp-net-vm-with-webdeploy.md</a>.</p></div><p>For now, let's select <strong class="userinput"><code>App Service</code></strong>. You should see two different options:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Create new</code></strong>: For deploying an application to a freshly created App Service</li><li style="list-style-type: disc"><strong class="userinput"><code>Select existing</code></strong>: This option is only useful if you have already deployed your site</li></ul></div><p> </p><p>Because we are just starting, the option we are interested in is <strong class="userinput"><code>Create new</code></strong>. After clicking on <strong class="userinput"><code>Publish...</code></strong>, you will see another screen, where you <span>can</span><a id="id326452263" class="indexterm"></a> enter all the required parameters. If you read the previous section about creating an App Service using the Azure Portal, some fields should look familiar—in fact, you are doing the very same thing as you would do in the portal. If you skipped this section, I strongly recommend that you go back and read the descriptions. After configuring my web app, my screen looks like this:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/b613bce8-7c93-4641-a05b-3657fa7ace39.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip11"></a>Note</h3><p>Remember that you can create both resource groups and App Service Plans directly from the preceding screen. If you do not like the options listed there, you can click on the <strong class="userinput"><code>New...</code></strong><span class="strong"><strong> </strong></span>button, which will guide you through the process of creating a new resource. This is another advantage of tools such as Visual Studio, as you do not have to leave your programming environment to work with Azure.</p></div><p>If you are satisfied with the current configuration, the last thing left is to click on the <strong class="userinput"><code>Create </code></strong>button and wait a moment for the application deployment to complete. Additionally, Visual Studio will prepare a publish profile that you can reuse whenever you want to. We will have a look at it, as it will help us in the next section of this chapter. Once deployment is completed, you should see your web application open automatically in your default browser:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/57638c16-600a-42bd-aafc-deda6f8019e0.png" /></div><p>Congratulations! You have just created and deployed your very first App Service. If you take a look at the URL, you'll see that it contains the name you set in the Visual Studio wizard. All web apps in Azure <span>can</span><a id="id325775858" class="indexterm"></a> be accessed using the following URL format: </p><p><code class="literal">http(s)://{appservicename}.azurewebsites.net</code></p><p>This also explains why a name has to be unique: since, by default, all web applications hosted as Azure Web Apps are available publicly, you have to select a name that is not already in use in another URL. In the next section, we will try to use FTP to deploy our application, as an alternative to using Visual Studio.</p><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec6"></a>Deploying Azure App Service using FTP</h3></div></div></div><p>Using Visual Studio for deployments is a good idea for testing things and development, but for sure, it cannot be used for deploying production environments. The easiest option to upload files to App Service is FTP, which is already integrated with this particular <span>Azure</span><a id="id325775885" class="indexterm"></a> resource.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec2"></a>Deploying Azure App Service with user-level credentials</h4></div></div></div><p>When you go to the Azure Portal and <span>select</span><a id="id325775900" class="indexterm"></a> the Web App you created previously, take a look at the <strong class="userinput"><code>Overview </code></strong>screen—you will see plenty of information regarding this service, such as current <strong class="userinput"><code>Status</code></strong>, <strong class="userinput"><code>Location</code></strong>, and <strong class="userinput"><code>URL</code></strong>. Among all that information, there is an FTP section containing three different parameters:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>FTP/deployment username</code></strong>: A name that you will use when connecting to your Web App using FTP client</li><li style="list-style-type: disc"><strong class="userinput"><code>FTP hostname</code></strong>: A host that should be used when creating an FTP connection</li><li style="list-style-type: disc"><strong class="userinput"><code>FTPS hostname</code></strong>: The same host as the previous one, but allowing for secure connection</li></ul></div><p>My App Service currently looks like this:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/a4edf237-cc4a-4671-a38c-cc1e9d0d8026.png" /></div><p>All FTP information can be found in the bottom-right corner of the whole section. What we need now is the FTP client that we will use to connect to the server. I do not have any particular recommendation when it comes to selecting such an application. Personally, I prefer using <strong class="userinput"><code>FileZilla </code></strong>for managing my FTP connections and file transfers. You can, however, use whichever client you like, as all are quite similar regarding functionality. Before we start uploading files to the server, we need one more thing, a password for the user. To generate a new password, go to the <strong class="userinput"><code>Deployment credentials</code></strong><span class="strong"><strong> </strong></span>blade, which can be found on the left in the <strong class="userinput"><code>DEPLOYMENT </code></strong>section of App Service<span class="emphasis"><em> </em></span>features:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/af76fcbf-8b12-44c5-ac32-ccce048fed61.png" /></div><p>Here, you can set two fields:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Username for FTP user</li><li style="list-style-type: disc">Password for this particular user</li></ul></div><p> </p><p> </p><p>You may wonder how this is connected to the previous username, which can be found on the <strong class="userinput"><code>Overview </code></strong>screen. The difference is quite simple: using <strong class="userinput"><code>Deployment credentials</code></strong>,<span class="strong"><strong> </strong></span>you are creating a new user that will be used for all applications in all subscriptions associated with your Microsoft Azure account. This has the implication that you will be able to use the very same credentials for each App Service you deploy. This is not ideal for every scenario you will face, but for the purpose of this exercise, let's set a user and use it for deployment. In the next part of this section, I will show you how to retrieve credentials from a <strong class="userinput"><code>Publish Profile</code></strong> generated by Visual Studio. Once you enter a username and a password, press <strong class="userinput"><code>Save</code></strong>. Now, we can go to the FTP client and use these credentials for setting a connection. Here, you can see my configuration (note that your username has to be in the following format: <code class="literal">&lt;appservicename&gt;\&lt;ftpusername&gt;</code>):</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/01139301-f38f-417e-937a-075c20d89ce0.png" /></div><p>Once you connect to a server, you will see a list of available directories. The very first level contains the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">LogFiles</code>: Files containing diagnostic information regarding running App Service</li><li style="list-style-type: disc"><code class="literal">site</code><span class="strong"><strong>:</strong></span> Your Web App working files are stored here</li></ul></div><p>We will cover <code class="literal">LogFiles</code> in the next sections of this chapter, describing monitoring and diagnosing an application. For now, we are interested in the <code class="literal">site</code> folder. When you enter it, you will see other directories: <code class="literal">deployments</code>, <code class="literal">locks</code>, and <code class="literal">wwwroot</code>. The last one should be familiar for those of you who have worked with IIS, as this is the most common name of the folder containing a web application. In fact, this is the working directory of your App Service, where all necessary files should be uploaded. Here, you have the full structure of an empty web app:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/07244494-e6a3-446e-ac50-6bc80bf086cb.png" /></div><p>Now that you know how App Service is structured, you can deploy your files and see whether or not it works. If you want, you can reuse a project from the previous exercise, or upload a brand new website. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Note</h3><p>If you want to reuse files, you can publish a project once again, but this time, instead of publishing it directly to Azure, create a new <strong class="userinput"><code>Publish Profile</code></strong> and use a folder as the target. Once Visual Studio finishes creating the package, simply copy files from the output directory to the FTP location using your FTP client.</p></div><p>Here are the files from a previous project of mine uploaded to my FTP server:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/220c7f7d-1cf1-42a8-b0dd-c7f62f051548.png" /></div><p>Now, when I go to the URL of my website, I will see a working application:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/c7f3e703-5421-4334-a5ef-df573feea7f1.png" /></div><p>Great—you have just learned how to leverage the FTP feature of <span>App</span><a id="id325317113" class="indexterm"></a> Services to deploy an application from any location and environment. However, as I mentioned earlier, we are using user-level credentials, which will be the same for all web apps that you deploy within your subscription. How do we achieve the same result using an app-level username and password?</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec3"></a>Deploying Azure App Service using app-level credentials</h4></div></div></div><p>There are two ways to deploy an application <span>using</span><a id="id325335766" class="indexterm"></a> app-level credentials:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Download them from the <span>Azure</span><a id="id325335780" class="indexterm"></a> Portal</li><li style="list-style-type: disc">Configure WebDeploy in Visual Studio</li></ul></div><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch01lvl4sec1"></a>Downloading app-level credentials from the Azure Portal</h5></div></div></div><p>When you go to your App Service and click on the <strong class="userinput"><code><span>Overview</span><a id="id325335801" class="indexterm"></a> </code></strong>blade, you will see the <strong class="userinput"><code>Get publish profile</code></strong><span class="strong"><strong> </strong></span>button at the top, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/dbb3e472-4d45-43a2-8cf3-0ec4e13f01a1.png" /></div><p>Now, when you click on it, your browser will download a <code class="literal">.PublishProfile</code><span class="strong"><strong> </strong></span>file. Please open it to check its content. Here is an example file from my web app:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;publishData&gt;
 &lt;publishProfile profileName="cloudcomrade01 - Web Deploy" publishMethod="MSDeploy" publishUrl="cloudcomrade01.scm.azurewebsites.net:443" msdeploySite="cloudcomrade01" userName="$cloudcomrade01" userPWD="LEebknaDdg0KS6SgScLuXlwtzxvwYway7ssoKxCSkCLi6Gw0HRyt2iEGMLbP" destinationAppUrl="http://cloudcomrade01.azurewebsites.net" SQLServerDBConnectionString="" mySQLDBConnectionString="" hostingProviderForumLink="" controlPanelLink="http://windows.azure.com" webSystem="WebSites"&gt;
 &lt;databases /&gt;
 &lt;/publishProfile&gt;
 &lt;publishProfile profileName="cloudcomrade01 - FTP" publishMethod="FTP" publishUrl="ftp://waws-prod-am2-197.ftp.azurewebsites.windows.net/site/wwwroot" ftpPassiveMode="True" userName="cloudcomrade01\$cloudcomrade01" userPWD="LEebknaDdg0KS6SgScLuXlwtzxvwYway7ssoKxCSkCLi6Gw0HRyt2iEGMLbP" destinationAppUrl="http://cloudcomrade01.azurewebsites.net" SQLServerDBConnectionString="" mySQLDBConnectionString="" hostingProviderForumLink="" controlPanelLink="http://windows.azure.com" webSystem="WebSites"&gt;
 &lt;databases /&gt;
 &lt;/publishProfile&gt;
 &lt;/publishData&gt;</pre><p>As you can see, it is a simple XML file containing plenty of useful information. What we are interested in currently is both the <code class="literal">userName</code> and <code class="literal">userPWD</code> properties. Those are what we have been searching for—app-level credentials automatically created on App Service<span class="emphasis"><em> </em></span>creation. You can use these instead of the user-level ones that we created previously.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch01lvl4sec2"></a>Configuring WebDeploy in Visual Studio</h5></div></div></div><p>To check how to configure <span class="strong"><strong>WebDeploy </strong></span>in Visual Studio, please go <span>through</span><a id="id325681159" class="indexterm"></a> all steps from the beginning of <span class="emphasis"><em>Creating an Azure App Service using Visual Studio</em></span> section about publishing an application from this IDE. If you have done that, go once <span>more</span><a id="id325681171" class="indexterm"></a> to the <strong class="userinput"><code>Publish </code></strong>screen.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip13"></a>Note</h3><p>If you want to import a publish profile from the previous section, then on the <strong class="userinput"><code>Publish </code></strong>screen, you can click on the <strong class="userinput"><code>New Profile...</code></strong><span class="strong"><strong> </strong></span>button and then select the <strong class="userinput"><code>Import Profile...</code></strong><span class="strong"><strong> </strong></span>option, which allows you to select a profile file generated previously.</p></div><p>When you click on the <strong class="userinput"><code>Configure </code></strong>button, you will see another window containing the whole configuration of your deployment:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/c1e94914-c26d-4a13-b1da-20eb910f16de.png" /></div><p>As you can see, it contains a completely different set of information, which does not reflect the user-level settings you have configured. </p><p> </p><p> </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>Please do remember the difference between user-level and app-level credentials. Note that multiple users with access to a given app can use their own user-level credentials individually. What is more, to be able to use app-level credentials, you have to have at least a <strong class="userinput"><code>Contributor </code></strong>role on a specific App Service. If you are only a <strong class="userinput"><code>Reader</code></strong>, you will not able to access those credentials. </p></div><p>The choice between app-level and user-level credentials depends solely on the process of delivering your application. In most cases, you don't need to check by checking and setting them, as tools such as Visual Studio or Azure DevOps (formerly Visual Studio Team Services) obtain and use them implicitly. App-level credentials are often only used when we are in need of manual deployment.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip15"></a>Note</h3><p>You can always reset app-level credentials (for instance, if current ones should be revoked, because of some kind of security issue) from the <strong class="userinput"><code>Overview </code></strong>blade. Next to the <strong class="userinput"><code>Get publish profile</code></strong><span class="strong"><strong> </strong></span>button, you can find the <strong class="userinput"><code>Reset publish profile </code></strong>option, which will set a new username and password.</p></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec7"></a>Creating Azure App Services using Visual Studio Code</h3></div></div></div><p>Microsoft Visual Studio is not the only available IDE that allows you to <span>work</span><a id="id325681677" class="indexterm"></a> with Azure App Services. Because this <span>Azure</span><a id="id325681686" class="indexterm"></a> service supports different technology stacks, including .NET, JS, PHP, Java, and so on, you can easily leverage its capabilities to host different websites using different runtimes. For instance, let's assume that we have the following PHP code that displays a <code class="literal">Hello World</code> message:</p><pre class="programlisting">&lt;?php
echo('Hello world from Azure App Service - PHP here!');
?&gt;</pre><p>Such a simple PHP application can be easily created in any available IDE that supports the PHP language. For the purpose of this exercise, I chose Visual Studio Code, an open source editor, as it can easily be extended using many different plugins. To make things easier, you can install the following extensions:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/0a53a630-693a-458c-ad54-f6d4c4c7fb43.png" /></div><p>With this plugin installed, you will be able to easily deploy your applications from within the IDE, without the need to go to the portal or use other methods. To push the application to the cloud, you have to go to the <strong class="userinput"><code>AZURE </code></strong>tab and find the <strong class="userinput"><code>APP SERVICE</code></strong><span class="strong"><strong> </strong></span>section. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"></a>Note</h3><p>Before the first use of these extensions, you may need to authenticate them. Follow the displayed instructions and Visual Studio Code will connect to your subscriptions.</p></div><p>Before we deploy our simple PHP application, we have to create an Azure App Service. To do so, you will have to click on the <strong class="userinput"><code>Create New Web App...</code></strong><span class="strong"><strong> </strong></span>button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/136e2f29-71f8-435e-9236-a55d131775c3.png" /></div><p>The wizard is a little bit different than in Microsoft Visual Studio, as it acts similarly to a command line, where you provide all fields and information one after another. In Visual Studio Code, you will have to enter the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The Azure App Service name</li><li style="list-style-type: disc">The operating system of your choice</li><li style="list-style-type: disc">The runtime version</li></ul></div><p>In this particular example, I specified the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">handsonazure-euw-appservice</code></li><li style="list-style-type: disc">Linux</li><li style="list-style-type: disc">PHP 7.2</li></ul></div><p>Once the provisioning is complete, Visual Studio Code will ask you whether to deploy the application. Select <strong class="userinput"><code>OK</code></strong>,<span class="strong"><strong> </strong></span>and then choose the folder to deploy to:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/d162346c-5278-4e17-a5fd-360d74551ec6.png" /></div><p>Once everything is set and ready, you will see a notification informing you that you are now able to browse the website:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/f2f22de2-07f4-4e74-a9e0-d895bb11ab63.png" /></div><p>When you click on the <strong class="userinput"><code>Browse Website</code></strong><span class="strong"><strong> </strong></span>button, you will be forwarded to the freshly deployed web application. Note that this extension allows you to directly manage the service from within the IDE, and gives you access to different features, including application settings, deployment slots, and Azure WebJobs (the latter of which is described in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Azure WebJobs</em></span>). Here, you can see the working example hosted within Azure:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/5885c026-5e76-4b3b-bb2e-bcd674848db2.png" /></div><p>The important thing here is that by using the same path, you <span>will</span><a id="id325775258" class="indexterm"></a> be able to host a variety of <span>different</span><a id="id325775267" class="indexterm"></a> runtimes inside different Azure App Services. It doesn't matter whether it is a Java application, a Python script, or a Node.js backend—they are all supported and can be easily developed using IDEs such as Visual Studio Code.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip17"></a>Note</h3><p>When using Visual Studio Code with the presented extension, you might want to have more control over the creation of a resource. To enable <strong class="userinput"><code>Advanced Creation</code></strong>, go to the <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>Preferences</code></strong> | <strong class="userinput"><code>Settings</code></strong> window, find the <strong class="userinput"><code>Extensions</code></strong><span class="strong"><strong> </strong></span>section, and then click on the <strong class="userinput"><code>App Service: Advanced Creation </code></strong>checkbox.</p></div></div></div>