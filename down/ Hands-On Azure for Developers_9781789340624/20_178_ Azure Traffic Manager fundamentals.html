<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch20lvl1sec167"></a>Azure Traffic Manager fundamentals</h2></div></div><hr /></div><p>Imagine the following situation—you have an <span>application</span><a id="id326436724" class="indexterm"></a> that has to be served globally. To guarantee the best performance for all your customers worldwide, you provision different instances of your service in different regions (one for North America, one for Europe, and one for Africa). There is one problem, however. You have to explicitly tell your customer to access a specific instance of the application—the one that is closest to its location.</p><p>While this is, of course, possible (just give it the right URL), the solution is not ideal. For example, what if your client goes for a holiday and spends the following two weeks in Europe instead of in Africa? To overcome such problems, in Azure you can leverage a service named <span class="strong"><strong>Azure Traffic Manager</strong></span>, which takes care of the proper routing of incoming requests and allows you to implement high availability in your application.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch20lvl2sec196"></a>Functions of Azure Traffic Manager</h3></div></div></div><p>You can think of Azure Traffic Manager<span class="emphasis"><em> </em></span>as a <span>load</span><a id="id325213809" class="indexterm"></a> balancer that works on the DNS level. To understand the concept, please take a look at the following example. By default, if there is no service such as Azure Traffic Manager, your <span class="strong"><strong>customer</strong></span> uses an endpoint URL to send requests from a <span class="strong"><strong>client application</strong></span> to a <span class="strong"><strong>server application</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/662e0fb7-dc7d-43df-8e6f-4387c2aaf105.png" /></div><p>If you want to load-balance incoming requests, you have to introduce another element of an architecture that will take care of routing them to the proper backend (and possibly ensure that they are healthy):</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/7d39cb20-d12f-4342-847e-e0a1f4495f56.png" /></div><p>The downside of such a setup is that latency can be introduced. What is more, in that scenario your client connects via a <span class="strong"><strong>load balancer</strong></span> directly, which does not <span>resolve</span><a id="id325213861" class="indexterm"></a> the problem of globally distributing the entry point.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note221"></a>Note</h3><p>The preceding example is a common solution when using a reverse proxy, which acts as a gateway to your system. </p></div><p>The described scenario defines a solution, where load balancing is based on distributing traffic based on TCP/UDP, so it is a significantly lower level than DNS. When using Azure Traffic Manager<span class="emphasis"><em>, </em></span>the flow of a request is completely different:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/efdcda16-f186-4ab5-8ef0-624f41765900.png" /></div><p>The flow can be described as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Send a <span class="strong"><strong>DNS query</strong></span> to a <span class="strong"><strong>DNS service</strong></span> to obtain the address of a server</li><li>The <span class="strong"><strong>DNS service</strong></span> is configured in such a way that it points to <span class="strong"><strong>Azure Traffic Manager</strong></span><span class="emphasis"><em><span class="emphasis"><em>,</em></span> </em></span>instead of pointing to a service directly</li><li><span class="strong"><strong>Azure Traffic Manager</strong></span><span class="emphasis"><em> </em></span>chooses the right endpoint based on the query characteristics and returns a <span class="strong"><strong>DNS response</strong></span> containing the address of the proper server</li><li>A client receives a <span class="strong"><strong>DNS response</strong></span> and <span>uses</span><a id="id325303645" class="indexterm"></a> it to connect to the right server</li></ol></div><p>In fact, a client has to perform two requests:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Obtain the URL of a server</li><li style="list-style-type: disc">Send the actual request</li></ul></div><p>While it may seem like a bit of an overhead, in reality, the impact is imperceptible.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note222"></a>Note</h3><p>Note that the advantage of such a solution is the ability to send requests directly to a server. There is no intermediary service that participates in the communication. </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch20lvl2sec197"></a>Creating Azure Traffic Manager in the Azure portal</h3></div></div></div><p>To get started with Azure Traffic <span>Manager</span><a id="id325303677" class="indexterm"></a><span class="emphasis"><em> </em></span>in the portal, you have to click on the <strong class="userinput"><code>+ Create a resource</code></strong><span class="strong"><strong> </strong></span>button and search for <code class="literal">traffic manager</code><span class="emphasis"><em>.</em></span> Then from the search results, select <strong class="userinput"><code>Traffic Manager profile</code></strong>. You will see a form, where you have to enter all required fields to be able to create a service:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/10f5b03b-472d-47ac-b892-c07a5341873c.png" /></div><p>While most of them should be self-explanatory, there is one drop-down that will require our focus, <strong class="userinput"><code>Routing method</code></strong>. Here you have six different methods available:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Performance</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>Weighted</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>Priority</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>Geographic</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>MultiValue</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>Subnet</code></strong></li></ul></div><p>Before we describe each and every one, you have to understand what <span class="strong"><strong><strong class="userinput"><code>Routing method</code></strong> </strong></span>is exactly. Previously I mentioned that Azure Traffic Manager<span class="emphasis"><em> </em></span>decides to which endpoint a <span>user</span><a id="id325320753" class="indexterm"></a> should be routed. This routing operation may give a different result depending on the selected method. Let's consider the following scenarios:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Instances of your application are distributed globally, and you want to route a user to the closest one</li><li style="list-style-type: disc">Instances of your application offer different performances, and you want to route a user to the one that offers the best user experience</li><li style="list-style-type: disc">You have a primary region that handles all the traffic, and you want to route a user to secondary ones in case of an outage or temporary issues</li><li style="list-style-type: disc">You want to distribute traffic evenly, or according to set weights</li><li style="list-style-type: disc">You want to map user IP addresses to a specific instance</li></ul></div><p>Depending on the chosen scenario, a different <span class="strong"><strong><strong class="userinput"><code>Routing method </code></strong></strong></span>should be chosen. Now I will describe them in detail.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec77"></a>Routing method – performance</h4></div></div></div><p>When using the performance routing method, a <span>user</span><a id="id325320790" class="indexterm"></a> will be routed to the endpoint that is the "closest" one. It is important to remember here, that the "closest" endpoint may not be the one that is the closest geographically, as this method takes into consideration performance, not distance. Let's assume that internally Azure Traffic Manager<span class="emphasis"><em> </em></span>stores the following information regarding configured endpoints:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Endpoint</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Region</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Latency</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server A</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>West Europe</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>12 ms</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Server B</p></td><td style="border-right: 0.5pt solid ; "><p>East US 2</p></td><td style=""><p>67 ms</p></td></tr></tbody></table></div><p>In the preceding scenario, the endpoint that performs better is <span class="strong"><strong>Server A</strong></span>. When the performance routing method is selected the user will be routed to that server.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note223"></a>Note</h3><p>It is important to remember that with the performance method, Azure Traffic Manager checks the latency of a response, taking into consideration the IP address of the DNS server that sent the request. It is not an IP address of a client.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec78"></a>Routing method – weighted</h4></div></div></div><p>When you want to distribute traffic <span>evenly</span><a id="id325327431" class="indexterm"></a> or based on predefined weights, the weighted routing method is something you are looking for. Using that method, you define weights, which are then taken into consideration when deciding where a request should be routed. Let's take into consideration the following table:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Endpoint</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Weight</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Status</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server A</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>100</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Online</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server B</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>100</p></td><td style="border-bottom: 0.5pt solid ; "><p>Degraded</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Server A - staging</p></td><td style="border-right: 0.5pt solid ; "><p>5</p></td><td style=""><p><span class="strong"><strong>Online</strong></span></p></td></tr></tbody></table></div><p> </p><p>In the preceding example, we have three endpoints, one of which is reporting issues. Although both <span class="strong"><strong>Server A</strong></span> and <span class="strong"><strong>Server B</strong></span> have the same weights, as Server B's status is reported as degraded, it will not be considered as a healthy endpoint, and as a result, a user will not be routed to it. There are two servers left that have different weights. In that situation, Azure Traffic Manager<span class="emphasis"><em> </em></span>will randomly assign a user to an endpoint with the probability determined by the endpoint's weight. If we imagine that there are 105 requests, 100 of them will be routed to <span class="strong"><strong>Server A</strong></span>, and the rest to the <span class="strong"><strong>Server A – staging</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip224"></a>Note</h3><p>A Weighted routing method is a great option for A/B testing, where you randomly route users to the new instance of your application containing new features. If they like them, you can change the weight and route the rest of the traffic to that instance.</p></div><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec79"></a>Routing method – priority</h4></div></div></div><p>The priority routing method is the <span>most</span><a id="id325331886" class="indexterm"></a> straightforward as it covers a simple scenario where you have a primary region that hosts your application, and you want to ensure that you can easily fail over to the secondary ones in case something is wrong. Let's consider the following scenario:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Server</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Priority</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Status</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server A</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Online</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Server A - secondary</p></td><td style="border-right: 0.5pt solid ; "><p>2</p></td><td style=""><p>Online</p></td></tr></tbody></table></div><p> </p><p>In the preceding example, all traffic will be routed to Server A for the following reasons:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Its priority is set to <code class="literal">1</code></li><li style="list-style-type: disc">Its status is considered online</li></ul></div><p>Now something has happened and the primary replica went down:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Server</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Priority</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Status</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server A</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>1</p></td><td style="border-bottom: 0.5pt solid ; "><p>Degraded</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Server A - Secondary</p></td><td style="border-right: 0.5pt solid ; "><p>2</p></td><td style=""><p><span class="strong"><strong>Online</strong></span></p></td></tr></tbody></table></div><p> </p><p>Because Server A is considered unhealthy, all traffic will be routed to the secondary instance until the primary one works again.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note225"></a>Note</h3><p>Remember that clients may cache DNS responses, which will extend the period that your endpoint appears unavailable to them.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec80"></a>Routing method – geographic</h4></div></div></div><p>Sometimes you need to route a <span>user</span><a id="id325350198" class="indexterm"></a> to a specific region, taking into consideration its location. There are multiple reasons to do so, for example:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Legal requirements</li><li style="list-style-type: disc">Content localization</li><li style="list-style-type: disc">Serving an application from a server that is the closest one taking distance into consideration
</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip226"></a>Note</h3><p>Do remember that a region that is closest to a user may not be the best one regarding network latency. Do not overuse this routing method to achieve the best user experience.</p></div><p>When using the <strong class="userinput"><code>Geographic </code></strong>routing method, you assign regions to configured endpoints:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Server</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Regions</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server A</p></td><td style="border-bottom: 0.5pt solid ; "><p>France</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Server B</p></td><td style="border-bottom: 0.5pt solid ; "><p>Asia</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Server C</p></td><td style=""><p>World</p></td></tr></tbody></table></div><p> </p><p>Now to route a user to the proper server, Azure Traffic Manager<span class="emphasis"><em> </em></span>tries to determine its location by reading the IP address of the source DNS server. It starts from state/province (or country/region if the former is not supported), and ends on the World value.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note227"></a>Note</h3><p>When using the <strong class="userinput"><code>Geographic </code></strong>routing method, Azure Traffic Manager<span class="emphasis"><em> </em></span>will return an endpoint whether it is healthy or not. It is important to leverage nested profiles, to extend routing methods further, and achieve high availability.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec81"></a>Routing method – MultiValue</h4></div></div></div><p>The <strong class="userinput"><code>MultiValue </code></strong>routing method works a little bit differently from other routing methods, as it allows the return of multiple healthy endpoints, and lets the client choose which one should be used. This scenario covers a situation when on the service side you do not know where to route a user, and simultaneously you want to ensure that a <span>user</span><a id="id325350307" class="indexterm"></a> will be routed to a healthy endpoint.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note228"></a>Note</h3><p>To make sure that an endpoint can be returned to a user for this routing method, it has to be set as <strong class="userinput"><code>External </code></strong>and has an IPv4 or IPv6 address assigned.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec82"></a>Routing method – subnet</h4></div></div></div><p>The last routing method is the most sophisticated, as it allows you to map specific IP addresses (or a range of IP addresses) to a specific endpoint.</p><p> </p><p> </p><p>The use cases for that method may vary if, for example:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">You want to block users using a specific ISP</li><li style="list-style-type: disc">You want to route users from a corporate network to an <span>internal</span><a id="id325350346" class="indexterm"></a> instance of an application</li><li style="list-style-type: disc">You have branded your application and want to route users from different corporate networks to a particular branded instance</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note229"></a>Note</h3><p>Using the <strong class="userinput"><code>Subnet </code></strong>routing method, make sure you have covered all possible IP addresses, as failing to do so will result in a <code class="literal">NODATA</code> response being returned, resulting in an error being returned to a client.</p></div><p>Once you are satisfied with your choice of a routing method, you can click on the <strong class="userinput"><code>Create</code></strong><span class="strong"><strong> </strong></span>button to provision a resource in Azure.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch20lvl2sec198"></a>Working with Azure Traffic Manager in the Azure Portal</h3></div></div></div><p>When you access your instance of <span>Azure</span><a id="id325381993" class="indexterm"></a> Traffic Manager, you will see a default screen containing the overview of the service:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/17d10887-2c97-45ee-85e9-18fd80224fa4.png" /></div><p>As there is currently no endpoint attached to this particular profile, the list of endpoints displayed is empty. Before we add a new one, let's focus a little bit on other service features.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec83"></a>Configuration</h4></div></div></div><p>When you access the <strong class="userinput"><code>Configuration </code></strong>blade, you will <span>see</span><a id="id325382022" class="indexterm"></a> the full configuration of your instance of Azure Traffic Manager:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/55810c59-09d8-4362-bcac-01276ef955fb.png" /></div><p>It contains things such as the <strong class="userinput"><code>Routing method</code></strong> (by default it displays the one you chose during service creation), <strong class="userinput"><code>Endpoint monitoring settings</code></strong>, and <strong class="userinput"><code>Fast endpoint failover settings</code></strong>. From this screen, you basically control how Azure Traffic Manager<span class="emphasis"><em> </em></span>will behave. For instance, let's assume that each of your endpoints has a custom <code class="literal">/status</code> endpoint that is designed to work with the service. By default, Azure Traffic Manager checks the default endpoint URL (set here as <code class="literal">/</code>), so you will have to change the Path field as follows:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/0fd1df35-1212-4d3d-9948-77392a07aa8a.png" /></div><p>The same goes for expected status codes. If your endpoints can return a range of HTTP status codes, and each of them should be considered as a success, you are able to enter the range in the<strong class="userinput"><code> Expected Status Code Ranges</code></strong><span class="strong"><strong> </strong></span>field:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/d9444afe-18f7-4fd0-a1db-56a1299dbada.png" /></div><p>You can experiment here with different settings, so they reflect the real scenario you have to cover.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec84"></a>Real user measurements</h4></div></div></div><p>When using the performance <span>routing</span><a id="id325382098" class="indexterm"></a> method, Azure Traffic Manager<span class="emphasis"><em> </em></span>checks where DNS requests originate from, and translates the result to an internal table that reflects different network latencies for different end user networks. While this option is perfectly fine for most use cases, sometimes you want to be able to tell Azure Traffic Manager<span class="emphasis"><em> </em></span>about real latency. With <strong class="userinput"><code>Real user measurements</code></strong><span class="strong"><strong> </strong></span>features, you are able to inject JavaScript code in to your client endpoints, to send delays to your endpoints directly to this Azure service.</p><p> </p><p> </p><p>To do so, go to the <strong class="userinput"><code>Real user measurements</code></strong><span class="strong"><strong> </strong></span>blade and click on the <span class="strong"><strong><strong class="userinput"><code>Generate key</code></strong> </strong></span>button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/2dc414e3-eacb-4886-98aa-01e1dfd1d393.png" /></div><p>You will see two fields:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Key</code></strong>: Stores the generated key</li><li style="list-style-type: disc"><strong class="userinput"><code>Measurement JavaScript</code></strong>: Holds the script that should be injected into the client application</li></ul></div><p>Once you use the generated script, it will start sending additional information to your instance of Azure Traffic Manager<span class="emphasis"><em> </em></span>regarding latencies and client network, which will improve the accuracy of decisions made by the service.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note230"></a>Note</h3><p>The accuracy improvement is not instant—Azure Traffic Manager has to gather lots of data from different networks to improve the performance.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch20lvl3sec85"></a>Endpoints</h4></div></div></div><p>The main functionality of Azure Traffic <span>Manager</span><a id="id325400752" class="indexterm"></a><span class="emphasis"><em> </em></span>is the ability to configure the endpoints it handles. You can access it through the <strong class="userinput"><code>Endpoints</code></strong><span class="strong"><strong> </strong></span>blade:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/8e5b023c-683a-4503-a99f-74d044bae054.png" /></div><p>To add an endpoint, you have to enter the following values:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Type</strong></span>: You can choose between an <strong class="userinput"><code>Azure endpoint</code></strong>, <strong class="userinput"><code>External endpoint</code></strong>, and <strong class="userinput"><code>Nested endpoint</code></strong>.<span class="strong"><strong> </strong></span>The difference impacts the whole form—with <strong class="userinput"><code>Azure endpoint</code></strong><span class="strong"><strong> </strong></span>you can choose an Azure service, <strong class="userinput"><code>External endpoint</code></strong><span class="strong"><strong> </strong></span>requires providing a fully qualified domain name or IP, and when you select <strong class="userinput"><code>Nested endpoint </code></strong>you can point to another Traffic Manager profile.</li><li style="list-style-type: disc"><span class="strong"><strong>Name</strong></span>: Unique name of an endpoint.</li><li style="list-style-type: disc"><span class="strong"><strong>Target resource type/FQDN or IP/Target resource</strong></span>: Depending on the <strong class="userinput"><code>Type</code></strong><span class="strong"><strong> </strong></span>value, you will have to select different values to configure an endpoint.</li><li style="list-style-type: disc"><span class="strong"><strong>Priority</strong></span>: Because my routing method is <strong class="userinput"><code>Priority</code></strong>, I have to enter the correct value for this particular endpoint. If you select another method, you may find other fields here.</li></ul></div><p> </p><p>In the following example, I selected an <strong class="userinput"><code>Azure endpoint</code></strong><span class="strong"><strong> </strong></span>and pointed the configuration to one of my Azure App Services. I performed the operation twice and added two different endpoints to two instances of my application:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/a0d6c2d1-e134-4bd4-9116-3146ba7ad7e8.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note231"></a>Note</h3><p>Remember that you cannot add to a single Azure Traffic Manager<span class="emphasis"><em> </em></span>profile service domains that point to the same region.</p></div><p>As you can see, right after adding endpoints, their status is displayed as <strong class="userinput"><code>Checking endpoint</code></strong>. This means that Azure Traffic Manager<span class="emphasis"><em> </em></span>tries to gather information regarding their health. If something is wrong, you will see the <strong class="userinput"><code>Degraded</code></strong><span class="strong"><strong> </strong></span>status:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/ed3ede00-33a6-474b-be66-0cc93c582d80.png" /></div><p>In my case, the problem was an invalid configuration as I set the <span class="strong"><strong><strong class="userinput"><code>Path</code></strong> </strong></span>field in the <strong class="userinput"><code>Configuration</code></strong><span class="strong"><strong> </strong></span>blade to<code class="literal">/status</code>, which turned out to be an invalid value (in my application, as I <span>implemented</span><a id="id325448978" class="indexterm"></a> that endpoint as<code class="literal"> /api/status</code>). After correcting the configuration in the primary service, its status was displayed as <strong class="userinput"><code>Online</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/9086a1b4-dffb-441d-85c1-7bf0ffcbb2a7.png" /></div><p> </p><p>The last thing to configure is the DNS record on your <span>DNS</span><a id="id325449008" class="indexterm"></a> server to point to your instance of Azure Traffic Manager (by using DNS name,<span class="strong"><strong> </strong></span>which can be found on the <strong class="userinput"><code>Overview </code></strong>blade).</p></div></div></div>