<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch15lvl1sec128"></a>Monitoring different platforms</h2></div></div><hr /></div><p>The strength of Azure <span>Application</span><a id="id325122051" class="indexterm"></a> Insights is its ability to monitor simultaneously from different platforms. You can choose from ASP.NET pages, Java, Node.JS, or even Python or Ruby (however, there are some languages and frameworks officially supported by Application Insights teams and some are supported by the community). The point is, it is platform-agnostic. When you, in fact, need the implementation of the communication channel, with an instrumentation key you can easily send data to an instance of a service without additional keys and an extended configuration. In this section, we will focus on sending information from different platforms, so you will be able to start integration in your projects easily on your own.</p><p> </p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch15lvl2sec153"></a>.NET</h3></div></div></div><p>In .NET applications, the <span>only</span><a id="id325120024" class="indexterm"></a> thing you have to do to get <span>started</span><a id="id325120023" class="indexterm"></a> is to install the latest <code class="literal">Microsoft.ApplicationInsights </code>package. The easiest way is to use the following code snippet:</p><pre class="programlisting">TelemetryConfiguration.Active.InstrumentationKey = "&lt;instrumentation-key&gt;";
var telemetryClient = new TelemetryClient();</pre><p>This code does two things:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Sets the current configuration by providing an instrumentation key. It is all that is needed to connect to a service.</li><li style="list-style-type: disc">Initializes an instance of <code class="literal">TelemetryClient</code>—this class is a proxy to a service, which enables you to communicate with it.</li></ul></div><p>Then you can use different methods to log some data:</p><pre class="programlisting">telemetryClient.TrackTrace(<span>"Hello World!"</span>);
telemetryClient.TrackException(new Exception());
telemetryClient.TrackDependency(new DependencyTelemetry());</pre><p>Of course, there are more methods available—you can find them in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section. In the first snippet, we used the <code class="literal">TelemetryConfiguration </code>type—in fact, the data stored in the configuration it provides is initially fetched from the <code class="literal">ApplicationInsights.config</code><span class="strong"><strong> </strong></span>file—it can look like this:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ApplicationInsights xmlns="http://schemas.microsoft.com/ApplicationInsights/2013/Settings"&gt;
  &lt;InstrumentationKey&gt;8sad7asd-asd876asf-jr323jsd-3hshjahj&lt;/InstrumentationKey&gt;
  &lt;TelemetryInitializers&gt;
    &lt;Add Type="Microsoft.ApplicationInsights.DependencyCollector.HttpDependenciesParsingTelemetryInitializer, Microsoft.AI.DependencyCollector"/&gt;
  &lt;/TelemetryInitializers&gt;
  &lt;TelemetryModules&gt;
    &lt;Add Type="Microsoft.ApplicationInsights.DependencyCollector.DependencyTrackingTelemetryModule, Microsoft.AI.DependencyCollector"&gt;
      &lt;ExcludeComponentCorrelationHttpHeadersOnDomains&gt;
      &lt;/ExcludeComponentCorrelationHttpHeadersOnDomains&gt;
      &lt;IncludeDiagnosticSourceActivities&gt;
        &lt;Add&gt;Microsoft.Azure.ServiceBus&lt;/Add&gt;
        &lt;Add&gt;Microsoft.Azure.EventHubs&lt;/Add&gt;
      &lt;/IncludeDiagnosticSourceActivities&gt;
    &lt;/Add&gt;
  &lt;/TelemetryModules&gt;
  &lt;TelemetryChannel Type="Microsoft.ApplicationInsights.WindowsServer.TelemetryChannel.ServerTelemetryChannel, Microsoft.AI.ServerTelemetryChannel"/&gt;
&lt;/ApplicationInsights&gt;</pre><p>If the file is not present (or it does not contain all values), the configuration will not be correct; in such a scenario, you have to provide it manually. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note179"></a>Note</h3><p>Please note, those above instructions are applicable only if you are using .NET framework.</p></div><p>It is worth mentioning here that the setup differs between platforms. We have discussed the most basic (console app) one, but we can use other application types, like Windows desktop applications:</p><pre class="programlisting">public partial class Form1 : Form
{
  private TelemetryClient _telemetryClient = new TelemetryClient();

  private void Form1_Load(object sender, EventArgs e)
  {
    _telemetryClient.InstrumentationKey = "&lt;instrumenation-key&gt;";

    _telemetryClient.Context.User.Id = Environment.UserName;
    _telemetryClient.Context.Session.Id = Guid.NewGuid().ToString();
    _telemetryClient.Context.Device.OperatingSystem = Environment.OSVersion.ToString();

    _telemetryClient.TrackPageView("Form1");
  }
}</pre><p>Or we can use web apps that have a seamless integration with Azure Application Insights.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch15lvl2sec154"></a>Node.js</h3></div></div></div><p>To start <span>working</span><a id="id324830086" class="indexterm"></a> with Azure Application <span>Insights</span><a id="id325115398" class="indexterm"></a> in Node.js, you will need the following command:</p><pre class="programlisting"><span class="strong"><strong>npm install applicationinsights</strong></span></pre><p> </p><p>It will install an NPM package of Application Insights, which allows working with this service. Here is a full example of the interface of this package:</p><pre class="programlisting">let http = require("http");
let appInsights = require("applicationinsights");

appInsights.setup("&lt;instrumentation-key&gt;");
appInsights.start();
let client = appInsights.defaultClient;

client.trackEvent({name: "my custom event", properties: {customProperty: "custom property value"}});
client.trackException({exception: new Error("handled exceptions can be logged with this method")});
client.trackMetric({name: "custom metric", value: 3});
client.trackTrace({message: "trace message"});
client.trackDependency({target:"http://dbname", name:"select customers proc", data:"SELECT * FROM Customers", duration:231, resultCode:0, success: true, dependencyTypeName: "ZSQL"});
client.trackRequest({name:"GET /customers", url:"http://myserver/customers", duration:309, resultCode:200, success:true});


http.createServer( (req, res) =&gt; {
  client.trackNodeHttpRequest({request: req, response: res});
}).listen(1337, "127.0.0.1");

console.log('Server running at http://127.0.0.1:1337/');</pre><p>Try to run the example and check the insights—you will see that first requests are logged:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/fbe547fb-695c-4c04-ab3d-11d54be45367.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch15lvl2sec155"></a>Azure Functions</h3></div></div></div><p>Azure Application <span>Insights</span><a id="id325115440" class="indexterm"></a> also offers seamless <span>integration</span><a id="id325115448" class="indexterm"></a> with another Azure service, Azure Functions. There are two ways of enabling integration: either turn it on while creating a service, or manually by providing an instrumentation key in the settings.</p><p>The following is a form where this feature can be enabled:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/b6d9c05d-0d4b-479e-97a6-2a0178301e69.png" /></div><p>There is, however, one caveat to such a setup: you cannot select an instance of a service if you already have one. To do so, you have to enable integration manually by providing <code class="literal">APPINSIGHTS_INSTRUMENTATIONKEY</code><span class="strong"><strong> </strong></span>in the settings of the <strong class="userinput"><code>Function App</code></strong>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip180"></a>Note</h3><p>There is one more option. Instead of providing a key manually, you can click on the <strong class="userinput"><code>Monitor </code></strong>tab of any function and then <strong class="userinput"><code>Configure</code></strong>. This option will be available if the classic view is not yet enabled.</p></div><p>With integration enabled, you will be able to analyze the executions of all your queries:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/a612e1fa-46e6-4a2c-a7af-76143fc37f13.png" /></div></div></div>