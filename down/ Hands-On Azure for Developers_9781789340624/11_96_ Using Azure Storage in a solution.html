<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec94"></a>Using Azure Storage in a solution</h2></div></div><hr /></div><p>Most applications cannot work without a storage solution. This can be any kind of database—relational, document, file, or graph. Most of them require some skills to be able to configure and start working with them. For now, we have covered one storage solution available in Azure, namely Azure <span>Cosmos</span><a id="id326393954" class="indexterm"></a> DB, which is a serverless database, where the only thing needed was to set a correct throughput value. Of course, Azure offers much more in the way of storage services, of which the most common is Azure Storage. It is a PaaS cloud component (though some define it as serverless, mostly because of a lack of servers) which can be used in four different ways. In this chapter, we will cover all of them, so you will be familiar with their capabilities and features.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec104"></a>Different Azure Storage services</h3></div></div></div><p>Azure Storage is consists of <span>four</span><a id="id326393891" class="indexterm"></a> different services:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Table Storage</li><li style="list-style-type: disc">Queue Storage</li><li style="list-style-type: disc">Blob Storage</li><li style="list-style-type: disc">Azure Files</li></ul></div><p>They all serve different purposes and offer different capabilities and limits. While their names are self-explanatory, you will see that each is a completely different service, and though they can be used in connection with each other, they require a different set of skills to be able to do this efficiently, and you need to use best practices. Additionally, Azure Storage offers an additional service called disk storage, which is a feature used by virtual machines. Because of that, it will not be covered in this book. Nonetheless, you can find a link to documentation in the <span class="emphasis"><em>Further reading </em></span>section. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec105"></a>Different types of storage account</h3></div></div></div><p>Azure Storage offers three different <span>types</span><a id="id325128338" class="indexterm"></a> of storage account:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>General-purpose Standard</strong></span>: Supporting tables, blobs, files, and queues, and three <span>different</span><a id="id325128355" class="indexterm"></a> types of blob: block blobs, page blobs, and <span>append</span><a id="id325128363" class="indexterm"></a> blobs</li><li style="list-style-type: disc"><span class="strong"><strong>General-purpose Premium</strong></span>: Limited to blobs only, and supporting <span>page</span><a id="id325128377" class="indexterm"></a> blobs</li><li style="list-style-type: disc"><span class="strong"><strong>Blob storage with hot/cool access tiers</strong></span>: Limited to blobs only and supporting block blobs and append blobs</li></ul></div><p>You will learn more about different kinds of blob in the next sections. The question, for now, is: what is the difference between the standard and premium accounts—besides pricing of course? You can define them as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Standard</code></strong>: The most common choice with reasonable performance and support for all types of data. These accounts use magnetic disks for storage.</li><li style="list-style-type: disc"><strong class="userinput"><code>Premium</code></strong>: Accounts with better performance, thanks to the use of SSD disks—recommended for VMs and when you require quick access to data stored on them.</li></ul></div><p>If you would like to compare performance for both types of accounts, here is a comparison for 128 GB disks:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Standard</code></strong>: 500 I/O operations / sec, throughput 50 MB / sec, €3,78 per month</li><li style="list-style-type: disc"><strong class="userinput"><code>Premium</code></strong>: 500 I/O operations / sec, throughput 100 MB / sec, €15,12 per month</li></ul></div><p>So, as you can see, the <strong class="userinput"><code>Premium </code></strong>option offers roughly twice the throughput over <strong class="userinput"><code>Standard</code></strong>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec106"></a>Securing Azure Storage</h3></div></div></div><p>In general, there are two ways of <span>securing</span><a id="id325143117" class="indexterm"></a> access to your Storage Accounts:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Azure AD with RBAC</li><li style="list-style-type: disc">SAS tokens</li></ul></div><p>Additionally, blobs can be accessed publicly (of course, only if you decide to do so). Depending on your needs, one option or another may cover your requirements—this, of course, depends on the characteristics of your application. The following is the difference between those two methods of securing <span>Azure</span><a id="id325143136" class="indexterm"></a> Storage:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>RBAC</strong></span>: This method is used to secure management operations on your accounts. You can restrict access to specific features of a service to only a specific group defined in Azure AD. However, you are unable to use this method to secure a blob or a table (although you can do it indirectly by securing access to an SAS token).</li><li style="list-style-type: disc"><span class="strong"><strong>SAS tokens</strong></span>:<span class="strong"><strong> </strong></span>These are long strings, which <span>store</span><a id="id325310668" class="indexterm"></a> different parameters describing access to a resource. They specify a service type, permissions, and the lifetime of a token, or restrict access to an IP address.</li></ul></div><p>Here is an example of an SAS token:</p><pre class="programlisting">https://myaccount.blob.core.windows.net/securecontainer/blob.txt?<span class="strong"><strong>sv=2015-04-05&amp;st=2015-04-29T22%3A18%3A26Z&amp;se=2015-04-30T02%3A23%3A26Z&amp;sr=b&amp;sp=rw&amp;sip=168.1.5.60-168.1.5.70&amp;spr=https&amp;sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D</strong></span></pre><p>As you can see, it restricts access to a <code class="literal">blob.txt</code><span class="strong"><strong> </strong></span>file stored as a blob in the<span class="strong"><strong> </strong></span><code class="literal">securecontainer</code> container. It defines parameters, such as service version (<code class="literal">sv</code>), expiry time (<code class="literal">se</code>), or the actual signature of a token (<code class="literal">sig</code>).<span class="strong"><strong> </strong></span>In general, with SAS tokens, you are able to restrict access to either an account or a service (and thanks to that also, for example, to a range of entities in Table Storage).</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec107"></a>Replication</h3></div></div></div><p>When using a cloud, you <span>have</span><a id="id325310868" class="indexterm"></a> to expect that any service can be down at anytime. Although Azure Storage is considered one of the most durable services (because many services in Azure rely on it), it is possible that it will face an outage. To mitigate problems related to such failures, it offers four <span>different</span><a id="id325310885" class="indexterm"></a> kinds of replication:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Locally-redundant storage (LRS)</strong></span>: Three copies of your data within the same data center</li><li style="list-style-type: disc"><span class="strong"><strong>Zone-redundant storage (ZRS)</strong></span>: Three copies of your <span>data</span><a id="id325317176" class="indexterm"></a> within the same region</li><li style="list-style-type: disc"><span class="strong"><strong>Geo-redundant storage (GRS)</strong></span>: Three copies of your data within the same <span>data</span><a id="id325336510" class="indexterm"></a> center plus three copies in another region</li><li style="list-style-type: disc"><span class="strong"><strong>Read-access geo-redundant storage (RA-GRS)</strong></span>: Three copies of your <span>data</span><a id="id325336524" class="indexterm"></a> within the same data center plus three copies in another region with the ability to read from that region</li></ul></div><p>When architecting an application using Azure Storage, you have to carefully design its availability requirements. Depending on your expectations, a different model may suit you better.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip138"></a>Note</h3><p>When using a model that replicates data to another data center (basically GRS and RA-GRS), take into account the cost of transferring data between different regions.</p></div><p>You may wonder how durable LRS is compared to other replication models. To define that, you have to understand how data is stored within a single data center. In fact, disks for Azure Storage are installed within racks, which build a bigger concept known as a stamp. Stamps are configured in such a way that they use different power <span>lines</span><a id="id325336542" class="indexterm"></a> and networks, and thanks to such a setup, it is possible to store copies of your data in different fault domains, ensuring that if one fails, the other two will still work. Microsoft states that LRS is designed to provide at least 99.999999999% durability. If that is not enough, you may consider other models.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip139"></a>Note</h3><p>When using RA-GRS, do not take for granted the ability to easily write to the secondary region if an outage occurs. It is Microsoft's responsibility to initiate a failover (as opposed to, for instance, Azure Cosmos DB, where it was your decision), so <span class="strong"><strong>r</strong></span><span class="strong"><strong>ecovery time objective</strong></span> (<span class="strong"><strong>RTO</strong></span>) consists of both time for Microsoft to make a decision, and time to change DNS entries to point to another region.</p></div></div></div>