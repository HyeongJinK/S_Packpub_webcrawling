<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec14"></a>Securing App Services using different security providers</h2></div></div><hr /></div><p>Most web applications have to be secured in some way, either by <span>using</span><a id="id325124997" class="indexterm"></a> your own security system or third-party identity providers, such as Facebook, Google, or Twitter. While working with the traditional application hosted on-premises, you often have to configure everything on your own. PaaS solutions, such as Azure App Services, already possess this functionality and make it easily accessible, thanks to the <strong class="userinput"><code>Authentication / Authorization</code></strong><span class="strong"><strong> </strong></span>feature. In this section, you will learn how to set it up so users will be prompted to log in. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec13"></a>Configuring authentication/authorization in the Azure Portal</h3></div></div></div><p>As with most PaaS services, you can configure the features of App Services <span>directly</span><a id="id325122053" class="indexterm"></a> from the portal. Thanks to such an approach, you have all options in one place and can easily switch between them.</p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec5"></a>Using Azure Active Directory to secure App Services</h4></div></div></div><p>Go to your App Service and the find <strong class="userinput"><code>Authentication / Authorization</code></strong><span class="strong"><strong> </strong></span><span>blade</span><a id="id325120033" class="indexterm"></a> on the left, next to <strong class="userinput"><code>Application settings</code></strong> as mentioned previously. When you click on it, you will see a screen for configuration:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/8dee5b0a-2eb4-47b8-b677-22253b0bffac.png" /></div><p>As you can see, it is currently disabled. When you toggle the <strong class="userinput"><code>App Service Authentication</code></strong><span class="strong"><strong> </strong></span>feature to <strong class="userinput"><code>On</code></strong>, you will see new options available, with which you can configure authentication for your web app:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/66f7ab1f-d960-40ea-856d-e72f7006dc3d.png" /></div><p>Change the <strong class="userinput"><code>Action to take when request is not authenticated</code></strong> field to any value available. The portal will display the following information:</p><p><code class="literal">To enable Authentication / Authorization please ensure all your custom domains have corresponding SSL bindings .net version is configured to "4.5" and manage pipeline mode is set to "Integrated".</code></p><p>Since we do not have a custom domain now, no action needs to be taken. The same applies to the .NET version and pipeline mode—if you have not changed the default parameters of your application, everything should be set correctly already. Let's now select one authentication provider and configure it—we will start with Azure Active Directory.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"></a>Note</h3><p>You do not have to be an expert with Azure Active Directory to use it with App Service, especially now there is the possibility to let the Azure Portal configure it for you. However, if you would like to learn more about this service, the best place to start is its documentation: <a class="ulink" href="https://docs.microsoft.com/en-us/azure/active-directory/active-directory-whatis" target="_blank">https://docs.microsoft.com/en-us/azure/active-directory/active-directory-whatis</a>. </p></div><p>When you click on the <strong class="userinput"><code>Azure Active Directory</code></strong><span class="emphasis"><em> </em></span>option, you will see a <span>new</span><a id="id325115408" class="indexterm"></a> screen where you can configure integration. Firstly, you have to select the <strong class="userinput"><code>Management Mode</code></strong>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Off</code></strong>: Azure Active Directory authentication is disabled.</li><li style="list-style-type: disc"><strong class="userinput"><code>Express</code></strong>: A quick way to configure authentication for your App Service using Azure AD. You will have to either select an already existing Azure Active Directory application or let the Azure Portal create a new one for you. </li><li style="list-style-type: disc"><strong class="userinput"><code>Advanced</code></strong>: If <strong class="userinput"><code>Express </code></strong>is not enough for you, you can always enter all necessary parameters on your own. With this option, you will be able to configure integration by providing information about <strong class="userinput"><code>Client ID</code></strong>, <strong class="userinput"><code>Issuer URL</code></strong>, and optionally, <strong class="userinput"><code>Client Secret</code></strong>. All of these parameters can be found when browsing your Azure Active Directory application.</li></ul></div><p>To start, I recommend using the <strong class="userinput"><code>Express </code></strong>option, as configuring applications in Azure Active Directory is beyond scope of this book. For now, you only need to provide a name for the application and click <strong class="userinput"><code>OK</code></strong>. You will go back to the previous screen, where you should be able to see that one authentication provider is already configured:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/3e5a311b-a351-4ae6-9d46-a2750fadf31e.png" /></div><p>Now, let's click the <strong class="userinput"><code>Save </code></strong>button. After a moment, everything should be set and you can now access your application to see whether securing it works. Go to the <strong class="userinput"><code>Overview </code></strong><span>blade</span><a id="id325117147" class="indexterm"></a> and click on the URL link, or enter it directly in your browser. When a default page is loaded, you will not see it, but rather will be redirected to the login page.</p><p> </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"></a>Note</h3><p>For this particular exercise, I have assumed that you have your application already deployed. If you have not, please go back to the previous sections and deploy your code with either Visual Studio or FTP.</p></div><p>Since we configured Azure Active Directory as our authentication provider, a user will be asked to give this particular application consent to access their information. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec6"></a>Using other authentication providers</h4></div></div></div><p>As you can see, Azure Active Directory is not the <span>only</span><a id="id325117198" class="indexterm"></a> security provider available for App Services. We can select Facebook, Google, or even Twitter to handle authentication and authorization for us. This is especially helpful when you have a public application for people using different social media websites, as they can use their accounts from other applications and quickly sign in when entering your website. To use other authentication providers than Azure Active Directory, you have to create an application in one of the mentioned portals. In fact, there is no difference whether you select Facebook, Google, or Twitter—you will have to provide two fields:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">An <strong class="userinput"><code>App ID</code></strong> and <strong class="userinput"><code>App Secret</code></strong><span class="strong"><strong> </strong></span>for Facebook</li><li style="list-style-type: disc">A <strong class="userinput"><code>Client Id</code></strong> and <strong class="userinput"><code>Client Secret</code></strong><span class="strong"><strong> </strong></span>for Google</li><li style="list-style-type: disc">An <strong class="userinput"><code>API Key</code></strong> and <strong class="userinput"><code>API Secret</code></strong><span class="strong"><strong> </strong></span>for Twitter</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"></a>Note</h3><p>We will not cover in this book how to create an application in other authentication providers. However, proper instructions can be found at <a class="ulink" href="https://developers.facebook.com/docs/apps/register/" target="_blank">https://developers.facebook.com/docs/apps/register/</a>, <a class="ulink" href="https://developers.google.com/identity/sign-in/web/sign-in" target="_blank">https://developers.google.com/identity/sign-in/web/sign-in</a>, <a class="ulink" href="https://developer.twitter.com/en/docs/basics/authentication/guides/access-tokens.html" target="_blank">https://developer.twitter.com/en/docs/basics/authentication/guides/access-tokens.html</a>.</p></div></div></div></div>