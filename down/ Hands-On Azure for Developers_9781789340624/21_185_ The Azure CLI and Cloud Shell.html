<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch21lvl1sec173"></a>The Azure CLI and Cloud Shell</h2></div></div><hr /></div><p>Using the Azure portal to <span>perform</span><a id="id325773066" class="indexterm"></a> all actions, such as <span>provisioning</span><a id="id325773269" class="indexterm"></a> a resource, changing its configuration, or finding a particular value, is indeed one of the easiest ways of managing both your subscription and deployed services. However, it may become cumbersome when you have tens or hundreds of different subscriptions, resource groups, and instances. In such scenarios, it is always better to have access to scripts and commands that speed things up and allow for automation, if needed. In this section, we will cover two basic tools available in Azure: the Azure CLI and Cloud Shell, which you can use when just the portal is not enough.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch21lvl2sec201"></a>The Azure CLI</h3></div></div></div><p>The Azure <span>CLI</span><a id="id325773053" class="indexterm"></a> is a cross-platform command-line tool, which you can install locally to manage Azure resources. In general, a command looks like this:</p><pre class="programlisting"><span class="strong"><strong>$ az [resource] [command] -param1 "Foo" -param2 123</strong></span></pre><p>For example, you can use the Azure CLI to create a function app like this:</p><pre class="programlisting"><span class="strong"><strong>$ az functionapp create --name "handsonazureapp" --storage-account "handsonazurestorage" --consumption-plan-location "westeurope" --resource-group "myResourceGroup"</strong></span></pre><p>The instruction for installing the Azure CLI can be found in the <span class="emphasis"><em>Technical requirements</em></span><span class="strong"><strong> </strong></span>section. It points to an article that describes the process for multiple different platforms, such as Windows, macOS, and Linux. Once the Azure CLI is installed, open your command line terminal and enter the following command:</p><pre class="programlisting"><span class="strong"><strong>$ az login</strong></span></pre><p>After a moment, you should see a result similar to mine, where you are asked to authenticate the Azure CLI locally:</p><pre class="programlisting"><span class="strong"><strong>$ az login</strong></span>
<span class="strong"><strong>To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code DRXXXXXXX to authenticate.</strong></span></pre><p> </p><p> </p><p>To authenticate the tool, go to the displayed web page and enter the displayed code. If everything is correct, the command will end successfully, and as a result, it will display information about all subscriptions attached to the account. When using the Azure CLI, you do not have to <span>remember</span><a id="id325128389" class="indexterm"></a> all the commands—to find the one you are looking for, you can use the following, which will find all related commands:</p><pre class="programlisting"><span class="strong"><strong>$ az find -q "query"</strong></span></pre><p>Let's assume that you want to work with Azure Functions<span class="emphasis"><em> </em></span>now. To interrogate all the commands related to that service, I can use the following query:</p><pre class="programlisting"><span class="strong"><strong>$ az find -q function</strong></span>
<span class="strong"><strong>`az functionapp create`</strong></span>
<span class="strong"><strong>    Create a function app.</strong></span>
<span class="strong"><strong>    The function app's name must be able to produce a unique FQDN as</strong></span>
<span class="strong"><strong>    AppName.azurewebsites.net.</strong></span>

<span class="strong"><strong>`az functionapp list`</strong></span>
<span class="strong"><strong>    List function apps.</strong></span>

<span class="strong"><strong>`az functionapp delete`</strong></span>
<span class="strong"><strong>    Delete a function app.</strong></span>

<span class="strong"><strong>`az functionapp stop`</strong></span>
<span class="strong"><strong>    Stop a function app.</strong></span>

<span class="strong"><strong>`az functionapp start`</strong></span>
<span class="strong"><strong>    Start a function app.</strong></span>

<span class="strong"><strong>`az functionapp restart`</strong></span>
<span class="strong"><strong>    Restart a function app.</strong></span>

<span class="strong"><strong>`az functionapp update`</strong></span>
<span class="strong"><strong>    Update a function app.</strong></span>

<span class="strong"><strong>`az functionapp`</strong></span>
<span class="strong"><strong>    Manage function apps.</strong></span>

<span class="strong"><strong>`az functionapp config`</strong></span>
<span class="strong"><strong>    Configure a function app.</strong></span>

<span class="strong"><strong>`az functionapp show`</strong></span>
<span class="strong"><strong>    Get the details of a function app.</strong></span></pre><p> </p><p>As you can see, it is super easy—you can quickly <span>provision</span><a id="id325309646" class="indexterm"></a> new resources without even touching the Azure portal. Here you can find a full example of instruction for creating a function app:</p><pre class="programlisting"><span class="strong"><strong>$ az storage account create --sku Standard_LRS --kind Storage --resource-group handsonazure-euw-rg --name handsonazurestorage</strong></span>
<span class="strong"><strong>$ az functionapp create --name handsonazure-euw-functionapp --storage-account handsonazurestorage --resource-group handsonazure-euw-rg --consumption-plan-location westeurope</strong></span></pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note234"></a>Note</h3><p>In the above example, I skipped the process of creating a resource group. If you want to create a new one, just use the <code class="literal">az group create</code> command.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch21lvl2sec202"></a>Cloud Shell</h3></div></div></div><p>An alternative to using the Azure CLI is a tool named Cloud Shell. You can access it directly <span>within</span><a id="id325309691" class="indexterm"></a> the Azure portal by clicking on the Cloud Shell button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/9c09efb6-0bcd-4721-90af-5a9e1c506426.png" /></div><p>When you open Cloud Shell, a welcome screen will be displayed at the bottom of the portal, asking you to select a shell you are interested in:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/84793358-3804-4548-9d20-c818c4522dc1.png" /></div><p> </p><p> </p><p>The choice does not really matter as you can change the selected option anytime. As I personally prefer PowerShell over Bash, the default option in my case is the former.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note235"></a>Note</h3><p>Both Bash and PowerShell scripts are aligned with each other when it comes to functionalities. You should select a shell that you prefer to work with.</p></div><p>If this is your first time with Cloud Shell, you will also be asked to mount a storage account that can be used with the feature. Cloud Shell uses it to persist files between your sessions. You have two options here; either you let it create a storage account for you, or you can select particular options by clicking on the <strong class="userinput"><code>Show advanced settings</code></strong><span class="strong"><strong> </strong></span>button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/e86bc559-ece8-49aa-abcd-af39e9a09ba9.png" /></div><p>Once everything is configured correctly, Azure will attempt to initialize your Cloud Shell account:</p><pre class="programlisting">Your cloud drive has been created in:

Subscription Id: &lt;subscription-id&gt;
Resource group: cloudshell-euw-rg
Storage account: cloudshelleuwstorage
File share: cloudshelleuwfileshare

Initializing your account for Cloud Shell...\
Requesting a Cloud Shell.Succeeded.
Connecting terminal...

Welcome to Azure Cloud Shell

Type "dir" to see your Azure resources
Type "help" to learn about Cloud Shell

MOTD: Switch to PowerShell from Bash: pwsh

VERBOSE: Authenticating to Azure ...
VERBOSE: Building your Azure drive ...
Azure:/
PS Azure:\&gt;</pre><p>Using Cloud Shell is similar to browsing a file system. Your Azure resources are presented as directories, which can be accessed by common command-line commands such as<code class="literal">dir </code>or <code class="literal">cd</code>. You can select a subscription you would like to work with by entering the following command:</p><pre class="programlisting"><span class="strong"><strong>PS Azure:\&gt; cd &lt;subscription-name&gt;</strong></span></pre><p>Then it is easy to browse all resources <span>within</span><a id="id325310857" class="indexterm"></a> it by using the following command:</p><pre class="programlisting"><span class="strong"><strong>PS Azure:\&gt; cd AllResources</strong></span>
<span class="strong"><strong>PS Azure:\&gt; dir</strong></span></pre><p>Note that there is a limit on resources you can access via Cloud Shell—currently you can use it to operate on the following services:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Resources groups</li><li style="list-style-type: disc">Web Apps</li><li style="list-style-type: disc">Storage accounts</li><li style="list-style-type: disc">Virtual machines</li></ul></div><p>For example, to obtain a connection string for Azure Files, you can use something like this:</p><pre class="programlisting"><span class="strong"><strong>PS Azure:\&gt; cd StorageAccounts\&lt;storage-account-name&gt;\files</strong></span>
<span class="strong"><strong>PS Azure:\&gt; dir</strong></span></pre><p>Of course, inside Cloud Shell, you can use both Azure Powershell commands and the Azure CLI. If you enter the <code class="literal">az</code><span class="strong"><strong> </strong></span>command in the command line, you will see the following result:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/f36e4b3e-f817-44c5-8e0f-eb163a80684c.png" /></div><p>Basically, all you have learned in the previous <span>section</span><a id="id325471074" class="indexterm"></a> can be applied here. This is a great tool that will enhance your productivity once you get used to using commands instead of browsing the Azure portal.</p></div></div>