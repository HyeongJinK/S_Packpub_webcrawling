<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch19lvl1sec160"></a>Azure CDN fundamentals</h2></div></div><hr /></div><p>If you are hosting a popular website that <span>contains</span><a id="id326398789" class="indexterm"></a> many static files, you may wonder what is the best way to optimize serving them to your users. When searching for a solution, you have to take into consideration many different factors; HTTP protocol specification, browser capabilities, your server performance, network latencies, and so on. The whole problem is far from being trivial and requires significant resources to be implemented in the right way. To overcome the listed difficulties, the idea of CDNs was developed. CDN stands for content delivery network, and encapsulates the concept of a complex service that takes care of delivering the content to everyone who browses your website. In this chapter, you will learn about Azure CDN, which is an Azure component that is designed to be a fast and reliable solution for all the listed problems.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch19lvl2sec192"></a>Working with CDNs</h3></div></div></div><p>When a user accesses your website, it has to fetch all the <span>static</span><a id="id325128277" class="indexterm"></a> content that is provided for a specific page. This implies the following actions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">A browser has to request all images, files, and scripts that are required by a web page</li><li style="list-style-type: disc">The requests have to be queued, as there is a limit on how many requests to a single domain a browser can perform</li><li style="list-style-type: disc">In most cases, a page has to be rendered gradually, as the content is fetched from the server</li><li style="list-style-type: disc">A server can throttle requests if it is currently overloaded</li><li style="list-style-type: disc">A browser has to respect all implemented caching mechanisms,of course, if your website tells it how to do it</li></ul></div><p>We can describe the whole process as follows:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/29610422-0281-4c5d-b116-7cccd3ea6758.png" /></div><p>In the preceding scenario, each request from a <span class="strong"><strong>user</strong></span> is routed directly to the <span class="strong"><strong>website</strong></span>. It then connects with the <span class="strong"><strong>server</strong></span> to fetch the data. Of course, we can imagine the situation where files are hosted by separate servers, as demonstrated in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/76e0b2f2-a2af-4f00-9708-2ec03bcc73f2.png" /></div><p>Such an alternative can improve performance a little bit (as servers will be identified using different domain names), but it complicates maintenance and configuration. What is more, such a setup is not the right solution if you struggle with network latencies (as an additional server will not make a difference). While we are discussing different architectures, you are probably starting to imagine one more setup that may make a difference.</p><p>A proxy between a <span class="strong"><strong>website</strong></span> and the <span class="strong"><strong>servers</strong></span> that is responsible for proper caching can be easily scaled up and is highly available, as can be seen in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/653d6b1c-1b3f-4a6f-8b44-82a6c7624e6e.png" /></div><p>CDNs are exactly the proxy that we are talking about. They provide the following functionalities:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">They can be easily scaled up/out if the load <span>exceeds</span><a id="id325143086" class="indexterm"></a> our expectations</li><li style="list-style-type: disc">They can cache requests, so the end servers are not utilized too much</li><li style="list-style-type: disc">They respect the cache-control header, so it is easy to provide the <span class="strong"><strong>Time-To-Live</strong></span> (<span class="strong"><strong>TTL</strong></span>) of a resource</li><li style="list-style-type: disc">They improve the responsiveness of your website by serving content to multiple users simultaneously</li></ul></div><p>Later in this chapter, you will learn how to leverage such services by using Azure CDN.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch19lvl2sec193"></a>Creating an Azure CDN in the portal</h3></div></div></div><p>The process of creating an Azure CDN<span class="emphasis"><em> </em></span>is similar to all the other <span>services</span><a id="id325143122" class="indexterm"></a> that you are working with when reading this book. To get started, you have to click on the <strong class="userinput"><code>+ Create a resource</code></strong><span class="strong"><strong> </strong></span>button and search for <code class="literal">Azure CDN</code>. From the search results, you have to choose <strong class="userinput"><code>CDN</code></strong>. This will lead you to a form, where you can enter all required information regarding a new service:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/3860374c-4689-47eb-895d-bf655bf0fc9d.png" /></div><p>There are two things worth mentioning here:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Pricing tier</code></strong>: Pricing tiers look a little bit different compared with other Azure services, as you no longer have the <strong class="userinput"><code>Basic</code></strong>, <strong class="userinput"><code>Standard</code></strong>, and <strong class="userinput"><code>Premium </code></strong>options to choose from. Here you have to decide which product you will be using—you can select one from the list containing providers such as <strong class="userinput"><code>Verizon</code></strong>, <strong class="userinput"><code>Akamai</code></strong>, and <strong class="userinput"><code>Microsoft</code></strong>. They offer different features, such as dynamic site acceleration, video streaming optimization, and asset pre-loading. The full list can be found in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section for this chapter.</li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Create a new CDN endpoint now</code></strong>: If you know what your origin (an endpoint that will cache the resources) will be, you can create it right now for the whole service.</li></ul></div><p>To quickly check what is available in the particular pricing tier, you can click on the<strong class="userinput"><code> View full pricing details</code></strong><span class="strong"><strong> </strong></span>link:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/6267c1bc-2915-420c-bd10-dd943dd0bd2c.png" /></div><p>As you can see, you are paying for each GB of <span>outbound</span><a id="id325310868" class="indexterm"></a> data transfer, and depending on the selected provider, the price can differ almost five-fold. When you click on the <strong class="userinput"><code>Create</code></strong><span class="strong"><strong> </strong></span>button, the service creation process will start. Once it finishes, you can access your very own instance of Azure CDN:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/c74f64d7-6a68-4e0c-918d-310cf9aca33a.png" /></div><p> </p><p> </p><p>If you decided not to create an endpoint along with the service, you will see a similar screen to mine, with the <strong class="userinput"><code>Endpoints</code></strong><span class="strong"><strong> </strong></span>section empty. Let us click on the <span class="strong"><strong><strong class="userinput"><code>+ Endpoint</code></strong> </strong></span>button to actually create one. As mentioned before, an endpoint is the element of a CDN that caches the data and serves it for a particular purpose. In the following, you can find an example setup for my first endpoint:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/98e11576-838e-4c74-a719-7b79dc849049.png" /></div><p>As you can see, I selected <strong class="userinput"><code>Storage</code></strong><span class="strong"><strong> </strong></span>as the <strong class="userinput"><code>Origin type</code></strong>. To be able to do so, you have to actually have an instance of Azure Storage<span class="emphasis"><em> </em></span>in the same resource group as your CDN. You can also <span>select</span><a id="id325353265" class="indexterm"></a> other available types, such as Cloud Service, Web App, or a custom origin. Once you add an endpoint, you will be able to manage it by clicking on it on the <strong class="userinput"><code>Overview</code></strong><span class="strong"><strong> </strong></span>tab.</p><p> </p><p> </p></div></div>