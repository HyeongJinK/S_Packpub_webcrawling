<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch16lvl1sec136"></a>Creating and configuring Azure SQL</h2></div></div><hr /></div><p>After reading the beginning of this chapter, you <span>should</span><a id="id325128366" class="indexterm"></a> be able to sense how Azure <span>SQL</span><a id="id325128357" class="indexterm"></a><span class="emphasis"><em> </em></span>works and what it offers for you. While some theory is always a good thing, it is practice which creates the full picture and allows you to fully understand the topic. In this section, we will focus on creating and configuring Azure SQL<span class="emphasis"><em> </em></span>in the portal and trying to identify all the afore mentioned features. You will also see how managing this PaaS service is different from the on-premise version, especially when it comes to using its features.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch16lvl2sec161"></a>Creating an Azure SQL instance</h3></div></div></div><p>In the Azure portal, when you search for <code class="literal">Azure SQL</code>, you will see <span>plenty</span><a id="id325128331" class="indexterm"></a> of different options such as <strong class="userinput"><code>SQL Database</code></strong>, <strong class="userinput"><code>SQL server (logical server),</code></strong> or <strong class="userinput"><code>SQL Elastic database pool.</code></strong> While they all allow you to create a database, the easiest way to get started with the service is to use<span class="strong"><strong><strong class="userinput"><code> SQL Database</code></strong></strong></span>—this will require creating a server nonetheless. In the following screenshot, you can find a configuration for my server:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/58663b9d-a085-41aa-81b2-2b43a0c6ed9a.png" /></div><p>The following shows the configuration for my database:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/e430cea6-f4ae-4415-a895-678f9e267085.png" /></div><p>The important thing here is to select the source—you have three options here:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Blank database</code></strong>: In most cases this will be the first option you are interested in</li><li style="list-style-type: disc"><strong class="userinput"><code>Sample</code></strong>: I used it so I already have data inside my database</li><li style="list-style-type: disc"><strong class="userinput"><code>Backup</code></strong>: A great option if you want to provision a database from an available backup</li></ul></div><p> </p><p> </p><p>For the <strong class="userinput"><code>Blank database</code></strong><span class="strong"><strong> </strong></span>option, you will also have the possibility to select a collation; in that dropdown, select the option that is correct for your data. We will also focus a little bit on the pricing configuration:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/604d70c5-2442-4623-881e-f808a8e0ee3d.png" /></div><p>As you can see, when using the DTU model, you have available three different tiers:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Basic</code></strong>: For smaller workloads</li><li style="list-style-type: disc"><strong class="userinput"><code>Standard</code></strong>: This offers the best balance <span>between</span><a id="id325115413" class="indexterm"></a> cost and performance</li><li style="list-style-type: disc"><strong class="userinput"><code>Premium</code></strong>: For all workloads which require massive performance capabilities</li></ul></div><p> </p><p>Depending on the tier, you will be offered either a fixed DTU amount (for <strong class="userinput"><code>Basic</code></strong>) or you will have to select the amount you are interested in:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/3a480054-02df-475a-b43b-2ad3a1eb0633.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip189"></a>Note</h3><p>The important thing here is the fact that most of your database costs are resources-allocated—remember to select the biggest database size you can (for example, in the Standard<span class="strong"><strong> </strong></span>tier and with 400 DTU selected, there is no difference in the pricing between 100 MB and 250 GB).</p></div><p> </p><p>Of course, you can also switch <span>between</span><a id="id325115458" class="indexterm"></a> a DTU-based model and vCores selection:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/faa5243b-7b12-4e7d-b10f-70201b7b2211.png" /></div><p>When using vCores, selecting the <strong class="userinput"><code>Max data size</code></strong><span class="strong"><strong> </strong></span>does affect the pricing. What is more, here you have two different tiers available:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>General Purpose</code></strong>: The best choice for most common scenarios without specific needs when it comes to resiliency and traffic</li><li style="list-style-type: disc"><strong class="userinput"><code>Business Critical</code></strong>: This tier offers better performance and lower latency (and is significantly more expensive)</li></ul></div><p> </p><p>When you are satisfied with your configuration, you can click on the <strong class="userinput"><code>Create</code></strong><span class="strong"><strong> </strong></span>button, so the provisioning process will start. When it is finished, you can access your resource by going to the <strong class="userinput"><code>Overview</code></strong><span class="strong"><strong> </strong></span>blade where basic info is available:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/d7f3405d-f8e4-4714-99e5-82cd7efec60f.png" /></div><p>Now we will try to go through most of the features, so you will have a better understanding of how to work with this service.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch16lvl2sec162"></a>Azure SQL features in the portal</h3></div></div></div><p>We will start with the <strong class="userinput"><code><span>Configure</span><a id="id325120034" class="indexterm"></a></code></strong><span class="strong"><strong> </strong></span>blade—when you click on it, you will see that it allows you to set both the tier and the pricing model of your database. This option is especially helpful when you want to improve the performance of your database; you can easily change the amount of DTU or vCores allocated for it, so it can work with queries much quicker.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note190"></a>Note</h3><p>As I mentioned before, configuring a single database will work for simpler scenarios, where you can easily monitor it and the performance requirements do not rapidly change. In all other cases, the better option is to use elastic pools.</p></div><p>When you go to the <strong class="userinput"><code>Geo-Replication</code></strong><span class="strong"><strong> </strong></span>blade, you will see a similar map to the one you saw when testing Azure Cosmos DB:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/4c9e5241-fd92-46b8-ad11-0fbd9924604c.png" /></div><p>From this screen, you can quickly create a secondary region, which allows you to perform a failover when you need it. To do so, click on the region you are interested in and that will display the <strong class="userinput"><code>Create secondary</code></strong><span class="strong"><strong> </strong></span>screen:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/9366d005-09ca-4dc3-86ff-bddb66347b02.png" /></div><p>You will have to once more create a server (if there are none already available inside a region) and the pricing tier (which of course can be different for a secondary). Additionally, from this blade, you can enable a failover group for your database—to do so, click on the following panel:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/6d525b47-e256-4ba6-a68f-245c17724177.png" /></div><p>By implementing a failover group, you can introduce an automatic failover for your database:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/47246678-01da-4c26-821b-51d05ab61c7f.png" /></div><p>However, if you want to <span>perform</span><a id="id325216010" class="indexterm"></a> a forced failover, you can click on the secondary database, which will display a screen that allows that operation to be performed:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/18ce45d1-4de4-4685-9926-b12aa695b103.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note191"></a>Note</h3><p>Remember that performing a failover can take some time to fully propagate—make sure you are ready for that.</p></div><p>When you proceed to the <strong class="userinput"><code>Connection strings</code></strong><span class="strong"><strong> </strong></span>blade, you will see a template for a connection string for different environments:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/9b15118e-6218-43dd-8042-c2cf8dbe14eb.png" /></div><p>You will also be able to download different drivers for <strong class="userinput"><code>ADO.NET</code></strong>, <strong class="userinput"><code>JDBC</code></strong>, <strong class="userinput"><code>ODBC</code></strong>, or <strong class="userinput"><code>PHP</code></strong>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note192"></a>Note</h3><p>Remember that the service presents only a template for your connection string—you will have to set your username and password to make it work.</p></div><p>Currently, we are exploring SQL Database in Azure—let's check exactly what SQL Server looks like currently. You can find it by clicking on the server name<span class="strong"><strong> </strong></span>on the <strong class="userinput"><code>Overview</code></strong><span class="strong"><strong> </strong></span>blade. Initially, the screen will look the same, but you will quickly realize that it offers many different features:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/00f83dcf-e72e-47c9-abe8-dc68bd919679.png" /></div><p>Unfortunately, we will not able to go through all of the features, but I will try to describe most of them for you. When we look at the <strong class="userinput"><code>Settings</code></strong><span class="strong"><strong> </strong></span>section, we can see the following blades:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Failover groups</code></strong>: As discussed previously, to introduce automatic failover you have to create a failover group. A group consists of a primary and secondary server, which have a defined failover policy and grace period—a setting which defines the time between outage detection and the actual failover.
</li><li style="list-style-type: disc"><strong class="userinput"><code>Manage Backups</code></strong>: To configure backups for your server (for example – enable LTR) you can access this blade. It also displays all available backups.</li><li style="list-style-type: disc"><strong class="userinput"><code>Active Directory admin</code></strong>: It is possible to set an admin for your server using a user which is defined within your Active Directory users. Of course, you can set more than a single user for that—the trick is to use a group instead of an individual account.</li><li style="list-style-type: disc"><strong class="userinput"><code>SQL databases</code></strong>: To quickly <span>access</span><a id="id326399187" class="indexterm"></a> a database that is served by this particular server, use this blade.</li><li style="list-style-type: disc"><strong class="userinput"><code>SQL elastic pools</code></strong>: Similarly to SQL Databases, this blade displays available elastic pools. To create a new pool, go to the <strong class="userinput"><code>Overview</code></strong><span class="strong"><strong> </strong></span>blade and click on the <strong class="userinput"><code>+ New pool</code></strong><span class="strong"><strong> </strong></span>button.</li><li style="list-style-type: disc"><strong class="userinput"><code>Deleted databases</code></strong>: Even if a database is removed from a service, you will still have a chance to restore it. In such a scenario, consult that blade for all databases available to be restored.</li><li style="list-style-type: disc"><strong class="userinput"><code>Import/Export history</code></strong>: All import and export operations on your databases will be displayed here. This is a great auditing tool, so you will not miss a situation when somebody exported your data without notice.</li><li style="list-style-type: disc"><strong class="userinput"><code>DTU quota</code></strong>: If you are interested in seeing the quota for DTU/vCores for your server, you can access this blade.</li></ul></div></div></div>