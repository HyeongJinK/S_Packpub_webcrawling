<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch17lvl1sec145"></a>Storing data in Azure Data Lake Store</h2></div></div><hr /></div><p>Because Azure Data Lake Store is all about storing data, in this section of the chapter you will see how you can store different files, use permissions to restrict access to them, and organize your instance. The important thing to remember here is the fact that you are not limited to using big data tools to store or access data stored within a service—if you manage to communicate with the Azure Data Lake <span>Store</span><a id="id325128263" class="indexterm"></a> protocol, you can easily operate on files using C#, JavaScript, or any other kind of programming language.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec175"></a>Using the Azure portal to navigate</h3></div></div></div><p>To get started with <span>working</span><a id="id325125010" class="indexterm"></a> with files in the <span>Azure</span><a id="id325124997" class="indexterm"></a> portal, you will have to click on the <strong class="userinput"><code>Data explorer</code></strong><span class="strong"><strong> </strong></span>button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/30114883-09a9-4b8a-93a4-e72d7f0227a7.png" /></div><p>Once you click on it, you will see a new screen, where you are given many different options for creating a folder, uploading files, or changing access properties. While this tool is not the best way to manage thousands of files, it gives you some insight into what is stored and how:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/6f984647-3fd9-4bb2-88f3-e18ddfbc42d2.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note202"></a>Note</h3><p>The downside of the UI available in the portal is the fact that it has a tendency to hang, especially if you have hundreds of files. Some options (such as deleting a folder) also tend to fail if you have stored gigabytes of data. In that scenario, it is better to either use PowerShell or custom procedures to perform an operation.</p></div><p>Now we will discuss options available on the UI.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch17lvl3sec67"></a>Filter</h4></div></div></div><p>When you click on the <strong class="userinput"><code><span>Filter</span><a id="id324830070" class="indexterm"></a> </code></strong>button, you will see a screen that tells you what files you are interested in:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/ca1dfde1-1383-4bf6-a051-920ccbba2123.png" /></div><p>It is the easiest way to quickly limit files displayed within a folder, but of course it has some caveats—for example, you cannot use a wildcard to filter only a specific file extension.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip203"></a>Note</h3><p>To remove a filter, click on the <strong class="userinput"><code>Reset </code></strong>button on the <strong class="userinput"><code>Filter </code></strong>screen.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch17lvl3sec68"></a>New folder</h4></div></div></div><p>This simple option gives <span>you</span><a id="id325115416" class="indexterm"></a> the possibility to create a new folder:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/7bee98ff-7655-40b0-8222-5cd8efdf945e.png" /></div><p>Note that by default a new folder can be accessed only by you—to make it visible to others (and to allow them to read it), you will have to assign a particular group of users explicitly to it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch17lvl3sec69"></a>Upload</h4></div></div></div><p>With the <strong class="userinput"><code>Upload </code></strong>function, you can <span>upload</span><a id="id325115447" class="indexterm"></a> files directly from your local machine to the cloud:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/e3bf33c3-644d-4674-9767-be3348040ec7.png" /></div><p>The files you choose will be uploaded to the folder you are currently browsing. There is also the possibility of allowing overwriting existing files; if you decide not to do so and upload a duplicate, you will see the following error:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/be9f3226-a85f-41da-a0e2-09ec44d54f89.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch17lvl3sec70"></a>Access</h4></div></div></div><p>One of the most important <span>features</span><a id="id325117157" class="indexterm"></a> of Azure Data Lake Store is the ability to fully declare access to a specific resource stored inside it:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/919aedcb-00b0-435b-bfed-c06c1395a927.png" /></div><p>By default, only you can access a file or a folder. To add a new user or a group, you can click on the <strong class="userinput"><code>+ Add</code></strong><span class="strong"><strong> </strong></span>button:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/de5e1f6e-69cd-43e4-ae43-3d14f213a595.png" /></div><p>There are important things I would like to cover here:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Permissions</code></strong>: Remember that to grant somebody access to list files inside a folder, you will have to assign two permissions: <strong class="userinput"><code>Read </code></strong>and <strong class="userinput"><code>Execute</code></strong>. The same applies to creating children inside a folder.</li><li style="list-style-type: disc"><strong class="userinput"><code>Add to</code></strong>: It is possible to propagate a particular set of permissions, not only to a single folder but also to all folders inside it. This is especially helpful when you can quickly allow somebody to list files and folders inside some parent directory.</li><li style="list-style-type: disc"><strong class="userinput"><code>Add as</code></strong>: You can add a set of permissions, either as a default permission entry (which will be assigned by default to all other users of a folder) or as an access entry (which specifies how somebody can access it). You can also combine both to speed things up.</li></ul></div><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch17lvl3sec71"></a>Files and folders</h4></div></div></div><p>Next to each file and <span>folder</span><a id="id325304715" class="indexterm"></a> visible, you can see an icon, which displays a menu with additional options:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/481b5f58-3a94-4106-882b-7e3d780df250.png" /></div><p>In fact, these are the same options we have just covered—they just apply to a specific folder and file.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec176"></a>Microsoft Azure Storage Explorer</h3></div></div></div><p>Most of the preceding options can be performed using Microsoft <span>Azure</span><a id="id325310846" class="indexterm"></a> Storage Explorer:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/44a96e1f-3450-498a-b984-a2ab90f6fa65.png" /></div><p>Unfortunately, it does not give you the possibility to assign permissions to files and folders. It is, however, a much better option for browsing stored data—what is more it automatically displays a set of required permissions assigned to an item.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec177"></a>Using SDKs</h3></div></div></div><p>The most flexible (and the most advanced) option to manage files and your <span>Azure</span><a id="id325310883" class="indexterm"></a> Data Lake Store instance is using an SDK for a language you are using. Currently, there are three different languages officially supported:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">.NET platform</li><li style="list-style-type: disc">Java</li><li style="list-style-type: disc">Python</li></ul></div><p>There is also the possibility of using a REST API, so basically you can connect with it using any language you want. Here, The following code snippet allows you to connect to the service:</p><pre class="programlisting">var client = AdlsClient.CreateClient("&lt;account-name"&gt;, &lt;credentials&gt;);</pre><p>There are two options available when it comes to authenticating to connect to your service:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">End-user authentication</li><li style="list-style-type: disc">Service-to-service authentication</li></ul></div><p>Both scenarios are described in detail in the documentation available in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section. Whichever option you choose, you will end up with using a generated OAuth 2.0 token. Here, you can find a simple provider to a service that leverages the described methods and allows you to easily create a new folder and append data to a file:</p><pre class="programlisting">public class DataLakeProvider : IDisposable
{
   private readonly DataLakeStoreFileSystemManagementClient _client;

    public DataLakeProvider(string clientId, string clientSecret)
    {
        var clientCredential = new ClientCredential(clientId, clientSecret);
        var creds = ApplicationTokenProvider.LoginSilentAsync("domainId", clientCredential).Result;
        _client = new DataLakeStoreFileSystemManagementClient(creds);
    }

    public Task CreateDirectory(string path)
    {
        return _client.FileSystem.MkdirsAsync("datalakeaccount", path);
    }

    public async Task AppendToFile(string destinationPath, string content)
    {
        using (var stream = new MemoryStream(Encoding.UTF8.GetBytes(content)))
        {
            await _client.FileSystem.ConcurrentAppendAsync("datalakeaccount", destinationPath, stream, appendMode: AppendModeType.Autocreate);
        }
    }

    public void Dispose()
    {
        _client.Dispose();
    }
}</pre><p>You can read more about writing such a provider in the blog post mentioned in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip204"></a>Note</h3><p>The important thing about using SDKs is the ability to abstract many operations and automate them—you can easily delete files recursively or dynamically create them. Such operations are unavailable when using UIs and most serious project developers would rather code stuff than rely on manual file management.</p></div></div></div>