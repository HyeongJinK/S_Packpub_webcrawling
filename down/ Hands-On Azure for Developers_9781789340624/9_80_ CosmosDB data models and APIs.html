<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec80"></a>CosmosDB data models and APIs</h2></div></div><hr /></div><p>As mentioned earlier, Azure <span>Cosmos</span><a id="id325469483" class="indexterm"></a> DB offers five different database models, all sharing the <span>same</span><a id="id325469474" class="indexterm"></a> infrastructure and concepts. This is a great feature, that makes this service really flexible and able to serve multiple different purposes. In this section, I will briefly describe each database model, so you will be able to select one that best serves your purposes.</p><p> </p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec84"></a>SQL</h3></div></div></div><p>If you think about SQL, you probably see a <span>relational</span><a id="id325317179" class="indexterm"></a> database with tables, relations, and <span>stored</span><a id="id325317175" class="indexterm"></a> procedures. When working with <span class="strong"><strong>SQL API </strong></span>in Cosmos DB, in fact you will work with documents that can be queried using the SQL syntax. Let us assume you want to query documents using the following call:</p><pre class="programlisting">SELECT * FROM dbo.Order O WHERE O.AccountNumber = "0000-12-223-12"</pre><p> Here you can find an example of a query written in C#:</p><pre class="programlisting">var order = 
  client.CreateDocumentQuery&lt;Order&gt;(collectionLink)
    .Where(so =&gt; so.AccountNumber == "0000-12-223-12")
    .AsEnumerable()
    .FirstOrDefault();</pre><p>As you can see, it is all about a simple LINQ query, which allows you to use a specific property to filter data. Because all records in Cosmos DB are stored as JSON documents, you can easily transform them from table to document representations (and possibly denormalize them).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip125"></a>Note</h3><p>Using document databases is completely different from storing data in relational databases. Always remember to model your data appropriately in line with database capabilities.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec85"></a>MongoDB</h3></div></div></div><p>As Cosmos DB implements the <span>MongoDB</span><a id="id325310860" class="indexterm"></a> wire protocol, you can easily <span>use</span><a id="id325310852" class="indexterm"></a> all your applications that currently use that document database with new instances of Azure Cosmos DB, without changing anything (besides the connection string, of course). While it cannot mimic MongoDB completely yet (the full list of supported operations can be found in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section), in most cases you will be able to use it seamlessly. As Cosmos DB has a strict requirement regarding security, you will have to use SSL when communicating with it:</p><pre class="programlisting">mongodb://username:password@host:port/[database]?ssl=true</pre><p>Here you can see a template for a connection string, where <code class="literal">ssl=true</code><span class="strong"><strong> </strong></span>is present—it is required when communicating with this Azure service. What is more, you will not be able to set a communication without authenticating a request.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec86"></a>Graph</h3></div></div></div><p>Azure Cosmos DB supports Gremlin as a <span>graph</span><a id="id325117140" class="indexterm"></a> database model. If you are not familiar with graph databases, you may think about them as a structure composed of vertices and edges. They can very easily show you relations between different elements of a graph as you can quickly traverse the connections and see that element A knows something about element B indirectly, thanks to element C. To be more specific, Cosmos DB supports a more specific model of a graph database known as a <span class="strong"><strong>property graph</strong></span>. The following is an <span>example</span><a id="id325117153" class="indexterm"></a> query for Gremlin:</p><pre class="programlisting">:&gt; g.V('thomas.1').out('knows').out('uses').out('runsos').group().by('name').by(count())</pre><p>The preceding example is taken from the documentation and literally answers the question: What operating systems do relations of the user of the <code class="literal">thomas.1</code> ID use?. Graph databases are great for applications such as social media portals or IoT hubs.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec87"></a>Table</h3></div></div></div><p>While you can use Azure Storage <span>Table</span><a id="id325120001" class="indexterm"></a> for your applications (which will be covered in upcoming chapters), it is possible to also take advantage of Cosmos DB's Table API and consider more advanced scenarios with that service. There are some differences between both services:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">While the current maximum limit for operations in Azure Storage Tables is 20,000 operations/sec, with Cosmos DB you can achieve millions of them</li><li style="list-style-type: disc">You cannot initiate failover for Storage Table</li><li style="list-style-type: disc">In Cosmos DB, data is indexed on all properties, not only on the partition key and row key</li><li style="list-style-type: disc">Different pricing (storage versus throughput)</li><li style="list-style-type: disc">Different consistency levels</li></ul></div><p> </p><p>Developing against Cosmos DB Table API is the same as working with Azure Table Storage. The following is an example of code in C# retrieving entities from a table:</p><pre class="programlisting">CloudStorageAccount storageAccount = CloudStorageAccount.Parse(
    CloudConfigurationManager.GetSetting("StorageConnectionString"));
CloudTableClient tableClient = storageAccount.CreateCloudTableClient();
CloudTable table = tableClient.GetTableReference("people");
TableQuery&lt;CustomerEntity&gt; query = new TableQuery&lt;CustomerEntity&gt;().Where(TableQuery.GenerateFilterCondition("PartitionKey", QueryComparisons.Equal, "Smith"));

foreach (CustomerEntity entity in table.ExecuteQuery(query))
{
    Console.WriteLine("{0}, {1}\t{2}\t{3}", entity.PartitionKey, entity.RowKey,
        entity.Email, entity.PhoneNumber);
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec88"></a>Cassandra</h3></div></div></div><p>The last available model in Azure <span>Cosmos</span><a id="id325120039" class="indexterm"></a> DB is Cassandra. Cassandra is a scalable, durable, and decentralized database for storing massive amounts of data. Now, if you use it with Cosmos DB, you can focus on development rather than on operations or performance management, and choice of consistency. While currently this model is in preview, you can test it and check what advantages it gives to you. Under the hood, it uses the Cassandra API, so it is possible to use Cassandra Query Language to communicate and interact with data. This model has the same feel as MongoDB—you can use the same tools you used for your current Cassandra instances and should not notice any difference. </p></div></div>