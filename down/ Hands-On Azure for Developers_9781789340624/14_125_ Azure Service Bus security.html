<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch14lvl1sec120"></a>Azure Service Bus security</h2></div></div><hr /></div><p>As Azure Service Bus<span class="emphasis"><em> </em></span>is described as an enterprise-level cloud <span>service</span><a id="id325317130" class="indexterm"></a> designed for integrating different services, there are serious expectations regarding the security features it offers. Besides shared access tokens, there are new features in the preview, which allow much more flexible access management. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec143"></a>Managed Service Identity</h3></div></div></div><p><span class="strong"><strong>Managed Service Identity</strong></span> (<span class="strong"><strong>MSI</strong></span>) is a feature in <span>Azure</span><a id="id325310854" class="indexterm"></a> Cloud, which eases <span>authentication</span><a id="id325310843" class="indexterm"></a> between services, without storing credentials in your code. The whole description can be found in the link in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section. When it comes to using it with Azure Service Bus, there is no additional blade available—what you need is just to find an identity in the access control (IAM) blade:</p><div class="mediaobject"><img src="/graphics/9781789340624/graphics/c353cfd2-94a0-467c-a763-e9760f007327.png" /></div><p> </p><p> </p><p>Now, instead of using an SAS token or access policy, you can use the following code:</p><pre class="programlisting"><span>var</span><span>tokenProvider</span><span>=</span><span>TokenProvider</span>.<span>CreateManagedServiceIdentityTokenProvider</span>();
<span>var sendClient</span><span>=</span><span>new</span><span>QueueClient</span>(<span><span>$"</span>sb://{namespace}.servicebus.windows.net/<span>"</span></span>, {queue-name}, <span>tokenProvider</span>);
<span>await</span><span>sendClient</span>.<span>SendAsync</span>(<span>new</span><span>Message</span>(<span>Encoding</span>.<span>UTF8</span>.<span>GetBytes</span>(<span>messageInfo</span>.<span>MessageToSend</span>)));
<span>await</span><span>sendClient</span>.<span>CloseAsync</span>();</pre><p>As you can see, the flow becomes much simpler as you do not have to store credentials or keys, and instead let the provider handle the authentication.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch14lvl2sec144"></a>RBAC </h3></div></div></div><p>In Azure Service Bus,<span class="emphasis"><em> </em></span>there is also a possibility to leverage roles defined in <span>Azure</span><a id="id325115400" class="indexterm"></a> AD to grant access to a service. The whole feature relies on the assumption that a user will be able to take responsibility for granting access to a Service Bus instance. The first step is exactly the same as with MSI authentication: you have to add a user to a service, so it gains access and can start pushing and receiving messages. The full instructions can be found in the <span class="emphasis"><em>Further reading</em></span><span class="strong"><strong> </strong></span>section.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip170"></a>Note</h3><p>Note that with the ability to tell explicitly how a user or an application can access Azure Service Bus, you are given much better control over how messages are published and received. This a great improvement over Azure Storage Queues<span class="emphasis"><em>, </em></span>where such features are not available.</p></div><p>There is also a possibility to use RBAC authentication to grant access to a service to another service (if MSI is not available). In that scenario, there will be no interactive login required as it is all handled by Azure AD. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note171"></a>Note</h3><p>Even if interactive login is required, it is not handled by an application so you can be sure that it will not handle any credentials directly.</p></div><p> </p><p> </p></div></div>