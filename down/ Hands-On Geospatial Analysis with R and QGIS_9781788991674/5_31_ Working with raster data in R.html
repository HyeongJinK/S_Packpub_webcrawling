<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec35"></a>Working with raster data in R</h2></div></div><hr /></div><p>R has some dedicated <span>packages</span><a id="id325302946" class="indexterm"></a> for working with raster data. We can use <code class="literal">raster</code>, <code class="literal">RStoolbox</code>, and more to analyze raster data in R. We can use the <code class="literal">readMeta()</code> function of <code class="literal">RStoolbox</code> in R to read the metadata of raster data. Let's read the metadata of some Landsat data now:</p><pre class="programlisting">library(RStoolbox)
# Set the working directory
setwd("F:/Hands-on-Geospatial-Analysis-Using-R-and-QGIS/Chapter05/Data")
# Read metadata
meta_data = readMeta("Mosaic/LC08_L1TP_137043_20180410_20180417_01_T1/LC08_L1TP_137043_20180410_20180417_01_T1_MTL.txt")
summary(meta_data)</pre><p>This will give us the metadata of this Landsat image, where we can see that it has 11 bands, UTM projection, and <code class="literal">WGS84</code> as <code class="literal">datum</code>:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/b263ce16-1016-4c70-b0d2-93e9302f8463.png" /></div><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec41"></a>Reading raster data</h3></div></div></div><p>Using the <code class="literal">raster()</code> function from the <code class="literal">raster</code> package, we can read raster data. Now, let's read band 4 of <span>the</span><a id="id325744732" class="indexterm"></a> Landsat image in the <code class="literal">data</code> folder:</p><pre class="programlisting">library(raster)
band4 = raster("D:/Spatial_Analysis_1/LC08_L1TP_137044_20170610_20170616_01_T1.tar/LC08_L1TP_137044_20170610_20170616_01_T1_B1.tif")
band1
plot(band4)</pre><p>The output will look as follows:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/f772a408-6637-4427-ab98-1ee7b34a175a.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec42"></a>Stacking raster data</h3></div></div></div><p>We can stack multiple <span>rasters</span><a id="id325748891" class="indexterm"></a> using the <code class="literal">stack()</code> function. This allows us to read and store multiple bands in R simultaneously. We'll now read and stack bands numbered 1 to 5 using the <code class="literal">stack()</code> function: </p><pre class="programlisting">band1 = raster("Mosaic/LC08_L1TP_137043_20180410_20180417_01_T1/LC08_L1TP_137043_20180410_20180417_01_T1_B1.TIF")
band2 = raster("Mosaic/LC08_L1TP_137043_20180410_20180417_01_T1/LC08_L1TP_137043_20180410_20180417_01_T1_B2.TIF")
band3 = raster("Mosaic/LC08_L1TP_137043_20180410_20180417_01_T1/LC08_L1TP_137043_20180410_20180417_01_T1_B3.TIF")
band5 = raster("Mosaic/LC08_L1TP_137043_20180410_20180417_01_T1/LC08_L1TP_137043_20180410_20180417_01_T1_B5.TIF")
stacked = stack(band1, band2, band3, band4, band5)</pre><p>Now we can see plots of all of these bands by just plotting the <code class="literal">stacked</code> variable:</p><pre class="programlisting">plot(stacked)</pre><p>This gives us the following plots of all of the raster data in the <code class="literal">stacked</code> variable:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/998022aa-3b7c-4bfa-b5a9-365ee0c71262.png" /></div><p>We can also look at the names of all rasters stacked in <code class="literal">stacked</code> by using the <code class="literal">names()</code> function:</p><pre class="programlisting">names(stacked)</pre><p>We now can see the names of all bands in <code class="literal">stacked</code>:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/4c593304-a5da-4376-aa0b-7d6ba46096e7.png" /></div><p>We can also use<code class="literal">brick()</code>for working with multiple rasters at the same time.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec43"></a>Changing the projection system of a raster file</h3></div></div></div><p>We can change the projection <span>system</span><a id="id325756093" class="indexterm"></a> of a raster file using <code class="literal">projectRaster()</code> as follows:</p><pre class="programlisting"># Change projection of band4 image from UTM to long lat
band4_ll = projectRaster(band4, crs = '+proj=longlat')</pre><p>We can reproject from longitude and latitude to UTM by using the <code class="literal">projectRaster()</code> function in the following way:</p><pre class="programlisting">x = " +proj=utm +zone=48 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"
band4_utm = projectRaster(band4_ll, crs=x)</pre><p>Now, we'll get the raster back in UTM projection.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec44"></a>False color composite</h3></div></div></div><p>Images with multispectral layers, such as <span>Landsat</span><a id="id326041554" class="indexterm"></a> images, when opened in any GIS/RS environment, will be rendered as black and white. By assigning different bands of Landsat to either red, green, or blue, we can visualize multispectral layers in different ways. We can assign different bands to red, green, and blue using the <code class="literal">plotRGB()</code> function:</p><pre class="programlisting"> plotRGB(stacked, r = 3, g = 2, b = 1, stretch = "hist")</pre><p>This will now give output that could be useful for vegetation study:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/1764db51-3791-4f43-970b-08c0b992d601.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec45"></a>Slope, aspect, and hillshade</h3></div></div></div><p>We'll now <span>calculate</span><a id="id326041589" class="indexterm"></a> slope <span>and</span><a id="id326041597" class="indexterm"></a> aspect from a <span class="strong"><strong>Digital Elevation Model</strong></span> (<span class="strong"><strong>DEM</strong></span>). We'll be using DEM raster <span>data</span><a id="id326074486" class="indexterm"></a> provided by<span class="strong"><strong>SRTM</strong></span>. We now read and plot a <span>DEM</span><a id="id326074499" class="indexterm"></a> using the<code class="literal">raster()</code>and<code class="literal">plot()</code> functions: </p><pre class="programlisting">dem = raster("DEM/dem_chittagong.tif")
plot(dem)</pre><p>This DEM <span>looks</span><a id="id326074520" class="indexterm"></a> like this:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/db8b21d0-145d-43eb-bdbf-c98334467dbb.png" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec18"></a>Slope</h4></div></div></div><p>The slope of a DEM can <span>be</span><a id="id326087788" class="indexterm"></a> calculated in R using <code class="literal">terrain()</code>, where we need to mention whether we need slope in degrees or percentages by providing values to the <code class="literal">unit</code> argument:</p><pre class="programlisting">slope = terrain(dem, opt = "slope", unit = "degrees")
plot(slope)</pre><p>This gives us the following output of a slope between 0 and 60:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/48228375-1126-4ca0-8876-ff5c4fd4618f.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec19"></a>Aspect</h4></div></div></div><p>The aspect of a DEM can also <span>be</span><a id="id326087828" class="indexterm"></a> calculated in R using <code class="literal">terrain()</code> and specifying <code class="literal">opt = "aspect"</code> as follows:</p><pre class="programlisting">aspect = terrain(dem, opt = "aspect")
plot(aspect)</pre><p>This will calculate the aspect or the direction of a slope and gives the following output:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/13cde225-e223-4083-a3a2-2cc8a9547ea8.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec20"></a>Hillshade</h4></div></div></div><p>Hillshade illuminates a <span>surface</span><a id="id326088961" class="indexterm"></a> by considering a hypothetical light source and its angle. In R, we need to calculate the slope and aspect before calculating the hillshade. We also have to provide the angle and direction of the sun inside the <code class="literal">hillshade()</code> function, as follows:</p><pre class="programlisting">hill_dem = hillShade(slope, aspect, 40, 270)
plot(hill_dem)</pre><p> </p><p>Now, we'll get the following hillshade output:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/c3d94bed-a98f-456c-b2c4-59817de05b79.png" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec46"></a>Normalized Difference Vegetation Index (NDVI)</h3></div></div></div><p>The NDVI is calculated <span>using</span><a id="id326088999" class="indexterm"></a> the near-infrared and visible light reflected by vegetation. The value of the NDVI ranges between -1 and 1. The formula for the NDVI is <span class="emphasis"><em>(near-infrared - visible)/(near-infrared + visible)</em></span>. As for Landsat, band 4 corresponds to near-infrared and band 5 corresponds to visible; this formula, for Landsat, is <span class="emphasis"><em>(band 4 - band 5)/(band 4 + band 5)</em></span>. In R, we can write this as follows and get a plot of the NDVI:</p><pre class="programlisting">NDVI = (band4 - band5) / (band4 + band5)
plot(NDVI)</pre><p>The NDVI will look like the following:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/2ec3ba6a-a3a5-4746-bb5a-1791c8e5459f.png" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec21"></a>Classifying the NDVI</h4></div></div></div><p>If we want to reclassify the NDVI into <span>several</span><a id="id326105321" class="indexterm"></a> categories, we can save the classification rule as a matrix and then provide it as the first argument to the <code class="literal">reclassify()</code> class. Suppose we want to classify all values between <code class="literal">-1</code> and <code class="literal">-0.5</code> as class 1, values between <code class="literal">-0.5</code> and <code class="literal">0</code> as class 2, values between <code class="literal">0</code> and <code class="literal">0.2</code> as class 3, values between <code class="literal">0.2</code> and <code class="literal">0.5</code> as class 4 and values between <code class="literal">0.5</code> and <code class="literal">1</code> as class 5.</p><p>First, we define a matrix with these rules:</p><pre class="programlisting">rules = c(-1, -0.5, 1, -0.5, 0, 2, 0, 0.2, 3, 0.2, 0.5, 4, 0.5, 1, 5)
 class = matrix(rules, ncol = 3, byrow = TRUE)</pre><p>Now, we use the <code class="literal">reclassify()</code> function to reclassify the NDVI image according to the rules we just defined in <code class="literal">class</code>:</p><pre class="programlisting">classified_ndvi = reclassify(NDVI, class)
plot(classified_ndvi)            </pre><p>The output is as follows:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/673b2873-2f0b-4aff-a53b-4f01da31c09b.png" /></div><p> </p></div></div></div>