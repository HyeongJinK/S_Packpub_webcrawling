<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec39"></a>Introduction to point pattern analysis</h2></div></div><hr /></div><p>Point pattern data is similar to <span>point</span><a id="id325302946" class="indexterm"></a> data under vector data, which we have already covered. A point pattern dataset gives the location of objects or events of concern in a defined study region. Let's learn some of the terminologies used in point pattern analysis first:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Points</strong></span>: Points are <span>locations</span><a id="id325302963" class="indexterm"></a> in a coordinate system. </li><li style="list-style-type: disc"><span class="strong"><strong>Events</strong></span>: If we have data or an observation in a point, we call this an event. These events <span>could</span><a id="id326017909" class="indexterm"></a> represent any spatial objects, such as the location of a crime, a case of disease, a landslide location, or a cell inside the human body. These points are normally in a 2D plane, but they could also be in a 3D plane.</li><li style="list-style-type: disc"><span class="strong"><strong>Marks</strong></span>: Marks are another important concept; a mark is simply the attribute information <span>associated</span><a id="id326017923" class="indexterm"></a> with a point; for example, a mark could be a type of crime, a disease type, the intensity of a landslide, or whether a cell is benign or malignant. These marks could be multivariate; so, in the case of a point representing a landslide, the marks could be the land type and settlement status along with the intensity of the landslide.</li><li style="list-style-type: disc"><span class="strong"><strong>Window</strong></span>: The finite study <span>area</span><a id="id326017937" class="indexterm"></a> within which the study is defined is called the window.</li><li style="list-style-type: disc"><span class="strong"><strong>Spatial point pattern</strong></span>: A set of observed <span>events</span><a id="id326037169" class="indexterm"></a> within the window is called a spatial point pattern.</li><li style="list-style-type: disc"><span class="strong"><strong>Spatial point process</strong></span>: This is the <span>stochastic</span><a id="id326037182" class="indexterm"></a> process that generates the events we observe in a window.</li></ul></div><p>Now we are ready to <span>learn</span><a id="id326037193" class="indexterm"></a> about the <span class="strong"><strong>planar point pattern</strong></span> (<span class="strong"><strong>ppp</strong></span>) object in R, which is used for point pattern analysis.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec55"></a>The ppp object</h3></div></div></div><p>In the <code class="literal">spatstat</code> package, for dealing <span>with</span><a id="id326037218" class="indexterm"></a> point pattern process, there is a new data type called the <code class="literal">ppp</code> object. This <code class="literal">ppp</code> object <span>consists</span><a id="id326041432" class="indexterm"></a> of event coordinates, window, and marks (if there are any). </p><p>We need to first install the <code class="literal">spatstat</code> package in R and then load it to do point pattern analysis:</p><pre class="programlisting">install.packages("spatstat")
library(spatstat)</pre><p>To create a <code class="literal">ppp</code> object, we use the <code class="literal">ppp()</code> command. In <code class="literal">ppp(x, y, x_dimension_of_window, y_dimension_of_window)</code>, we first need to provide the <span class="emphasis"><em>x</em></span> coordinates of the points in the <code class="literal">x</code> vector, and the <span class="emphasis"><em>y</em></span> coordinates of the point in the <code class="literal">y</code> vector. Then, there's <code class="literal">x_dimension_of_window</code>, which is a vector that consists of the coordinates of the left and right corners of the <span class="emphasis"><em>x</em></span> coordinates of the window, and <code class="literal">y_dimension_of_window</code>, which consists of the coordinates of the bottom and top corners of the <span class="emphasis"><em>y </em></span>coordinates of the window. </p><p>Suppose all of our data points are between 87.71 and 92.79 longitude and between 20.6 and 26.7 latitude. We can now generate 500 different longitude and latitude points ranging in this <span>area</span><a id="id326041490" class="indexterm"></a> using <code class="literal">runif()</code>. We'll also need to provide the coordinates for the <span class="emphasis"><em>x</em></span> dimension of the window, which, for convenience, is a little wider than the longitude range: 87.7 and 92.8. Similarly, a range that's a little wider for the <span class="emphasis"><em>y</em></span> dimension of the window is taken. Now let's create a <code class="literal">ppp</code> object and plot:</p><pre class="programlisting">bd_ppp = ppp(x = runif(500, 87.71, 92.79), y = runif(500, 20.6, 26.7), c(87.7, 92.8), c(20.59, 26.71))
bd_ppp</pre><p>We can see that it is a <span>planar</span><a id="id326041962" class="indexterm"></a> object, as shown in the output:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/27c52e9e-901e-48db-aa38-23d884c285b5.png" /></div><p> </p><p>Now, we plot this ppp object using <code class="literal">plot()</code>.</p><pre class="programlisting">plot(bd_ppp)</pre><p>The preceding command gives the following output, with 500 points in the window we specified:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/00f43123-1363-47a9-97f5-79cdbec774dc.png" /></div><p>We can also see the basic summary using <code class="literal">summary()</code> with <code class="literal">ppp</code>:</p><pre class="programlisting">summary(bd_ppp)</pre><p>This gives summary information <span>about</span><a id="id326050793" class="indexterm"></a> ppp object <span>including</span><a id="id326050802" class="indexterm"></a> the information on number of points, average intensity, spatial extent of the window and the window area:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/cbfb3b70-7983-454e-a5bb-0736346276c5.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec56"></a>Creating a ppp object from a CSV file</h3></div></div></div><p>Suppose we have a CSV file <span>with</span><a id="id326050827" class="indexterm"></a> a location (in longitude and latitude values) and we want to import it into R and make a <code class="literal">ppp</code> object. Doing so is relatively straightforward—we need to <span>point</span><a id="id326050839" class="indexterm"></a> toward the longitude (<span class="emphasis"><em>x</em></span> coordinates) and latitude (<span class="emphasis"><em>y</em></span> coordinates) values column of the CSV and then use them in <code class="literal">ppt()</code> as we have done previously. We need to be mindful about the window, so that we don't drop any points.</p><p>We have a CSV file, <code class="literal">ppp1</code>, with the <code class="literal">lon</code> column containing longitude values and the <code class="literal">lat</code> column containing latitude values. We'll use <code class="literal">min()</code> and <code class="literal">max()</code> to get the minimum and maximum values of longitude and latitude for defining the window containing these values in the following way:</p><pre class="programlisting"># Please update the path to the file ppp1.csv according to where you have saved # it in your desktop or laptop
location = read.csv("F:/Hands-on-Geospatial-Analysis-Using-R-and-QGIS/Chapter06/Data/ppp1.csv")
ppp_object = ppp(location$lon, location$lat, c(min(location$lon), max(location$lon)), c(min(location$lat), max(location$lat)))
plot(ppp_object)</pre><p>Now we get a <code class="literal">ppp</code> object:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/aa221966-ed95-4ef2-a56a-5fb82357228b.png" /></div><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec57"></a>Marked point patterns</h3></div></div></div><p>In a spatial point pattern, points could <span>carry</span><a id="id326069609" class="indexterm"></a> additional information called marks. These marks could be either continuous or categorical. In the case of a tree, a mark could be the <span>diameter</span><a id="id326069618" class="indexterm"></a> of a tree; in the case of a landslide, a mark could be the time of the landslide. We have to be careful to remember that points are random and so, if the locations are fixed, we don't have valid points.</p><p>We'll now import a CSV file where the points are diseases and the marks are the locations of the disease and the disease status (yes or no). In <code class="literal">ppp()</code>, to create marks, we have to convert mark data into factors and provide it as a value of the <code class="literal">marks</code> argument to the <code class="literal">ppp()</code> function. In the following code, we import the data into R as a marked point pattern process and then plot it:</p><pre class="programlisting"># Please update the path to the file ppp2.csv according to where you have saved # it
marked = read.csv("F:/Hands-on-Geospatial-Analysis-Using-R-and-QGIS/Chapter06/Data/ppp2.csv")
marked_ppp = ppp(marked$lon, marked$lat, c(min(marked$lon), max(marked$lon)), c(min(marked$lat), max(marked$lat)), marks = factor(marked$value))
<span>plot(marked_ppp, cols = c("green", "red"), pch = c(19, 20), main = "Disease point pattern")</span></pre><p>This gives the following marked point pattern process:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/0573db12-eb99-45cd-9739-d977710677d9.png" /></div><p>Using <code class="literal">split()</code>, we can plot points of each type separately. We do this in the following way:</p><pre class="programlisting">plot(split(marked_ppp))</pre><p>This gives us plots for different types:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/4dafb4f5-e5a3-4353-ba13-a5044d5954c2.png" /></div><p>Now let's <span>have</span><a id="id326074529" class="indexterm"></a> a look at <span>this</span><a id="id326074537" class="indexterm"></a> data using <code class="literal">summary()</code>:</p><pre class="programlisting">summary(marked_ppp)</pre><div class="mediaobject"><img src="/graphics/9781788991674/graphics/e693531f-d446-4e85-9ec7-fd083ecd49e9.png" /></div><p> </p><p>We see a summary of the data in the previous screenshot. Now we can plot separate densities for disease status using <code class="literal">density()</code> in the following way:</p><pre class="programlisting">plot(density(split(marked_ppp)), main = "Densities for yes and no", ribbon = FALSE)</pre><p>This gives the following plot of density: </p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/636b1fd2-85f3-44b5-a52a-88ad78574954.png" /></div><p>We can also <span>compute</span><a id="id326088994" class="indexterm"></a> relative <span>proportions</span><a id="id326089002" class="indexterm"></a> of intensity using <code class="literal">relrisk()</code> in the following way:</p><pre class="programlisting">plot(relrisk(marked_ppp), main = "Relative proportions of intensity")</pre><p>This gives the following plot:</p><div class="mediaobject"><img src="/graphics/9781788991674/graphics/a8fb15a5-086f-47b7-be01-108e8f4468d7.png" /></div></div></div>