<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec66"></a>Incorporating Selenium Grid</h2></div></div><hr /></div><p>Well, we have a solution to this. Here is where Selenium Grid comes to our rescue. We already set up a Selenium Grid <span>Hub</span> in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>The Actions Class and JavascriptExecutor</em></span>. Now, it's time to add a node. We will create batch files for creating the <code class="literal">hub</code> and <code class="literal">node</code>. The <span>contents</span><a id="id325162084" class="indexterm"></a> of the first batch file for the Hub is shown as follows. Name this file <code class="literal">seleniumgridhub.bat</code>:</p><pre class="programlisting">java -jar selenium-server-standalone-3.14.0.jar -role hub</pre><p>Double-click the <code class="literal">batch</code> file. T<span>he message,</span><code class="literal">Selenium Grid hub is up and running</code> is displayed</p><p>The contents of the second batch file for the node is shown in the following. Name this file <code class="literal">seleniumgridnode.bat</code>:</p><pre class="programlisting">java -Dwebdriver.chrome.driver=C:\Users\Bhagyashree\workspace\SeleniumFramework\src\main\resources\chromedriver.exe -Dwebdriver.ie.driver=C:\Users\Bhagyashree\workspace\SeleniumFramework\src\main\resources\IEDriverServer.exe -Dwebdriver.firefox.driver=C:\Users\Bhagyashree\workspace\SeleniumFramework\src\main\resources\geckodriver.exe  -jar selenium-server-standalone-3.14.0.jar -role node -hub http://localhost:4444/grid/register -port 5555 -browser browserName=chrome,maxInstances=2,platform=WINDOWS -browser browserName="internet explorer",maxInstances=2,platform=WINDOWS -browser browserName=firefox,maxInstances=2,platform=WINDOWS </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Note</h3><p>Note that the path shown in the following code has to be changed for the individual machine.</p></div><p>Double-click this file. A console window will appears, as follows:</p><div class="mediaobject"><img src="/graphics/9781789612486/graphics/c2a1079f-74ae-41d8-b89c-aa2f7911fa64.png" /></div><p>Once the <code class="literal">Selenium Grid node is up and ready to register to the hub</code> message is displayed, navigate to <code class="literal">http://localhost:4444/grid/console</code>.</p><p>The screen that's <span>shown</span><a id="id325442148" class="indexterm"></a> is as follows:</p><div class="mediaobject"><img src="/graphics/9781789612486/graphics/d2a770b3-b18e-4fa1-9b48-43596363e039.png" /></div><p>Let's understand why we got two Firefox, two Internet Explorer, and three Chrome instances. For this, we need to understand the script in the node batch file.</p><p>The content here is an excerpt from the <code class="literal">seleniumgridnode.bat</code> file:</p><pre class="programlisting">Dwebdriver.chrome.driver=C:\Users\Bhagyashree\workspace\SeleniumFramework\src\main\resources\chromedriver.exe</pre><p>This line tells us that we should use the <code class="literal">webdriver.chrome.driver</code> argument to the actual <code class="literal">chromedriver.exe</code> file placed in the project resources folder:</p><pre class="programlisting">-jar selenium-server-standalone-3.14.0.jar -role node -hub http://localhost:4444/grid/register -port 5555</pre><p>This registers the node to the hub on port <code class="literal">5555</code>:</p><pre class="programlisting">-browser browserName=chrome,maxInstances=2,platform=WINDOWS</pre><p>This creates two Chrome instances on the <span>windows</span><a id="id325447012" class="indexterm"></a> platform. This is the reason why we can see three Chrome instances in the node console. A similar concept applies to Firefox and IE.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec59"></a>Running tests in parallel</h3></div></div></div><p>Now, we will turn our <span>attention</span><a id="id325447027" class="indexterm"></a> to the changes in the code. Let's start with <code class="literal">testng.xml</code>.</p><p>The suite tag needs to be changed, as shown here:</p><pre class="programlisting">&lt;suite name="Suite" parallel="tests"&gt;</pre><p>This indicates that the test tags have to be executed in parallel. We are executing the same program, <code class="literal">Driver_Script</code>, three times, with different parameters for the browser name.</p><p>The next change has to be done at the place where we instantiate the various drivers. First of all, we create a <code class="literal">DesiredCapabilities</code><span>reference,</span> <code class="literal">static DesiredCapabilities capabilities;</code></p><p>The <code class="literal">openBrowser(List&lt;String&gt; browserName)</code> method should be changed; the code snippet of one <code class="literal">if</code> condition is shown as follows:</p><pre class="programlisting">  public WebDriver openBrowser(List&lt;String&gt; browserName)
      throws MalformedURLException {
    if (browserName.get(0).equalsIgnoreCase("chrome")) {
      log.info("Executing openBrowser");
      System.setProperty("webdriver.chrome.driver",
          System.getProperty("user.dir")
              + "\\src\\main\\resources\\chromedriver.exe");
      try {
        driver = new RemoteWebDriver(new URL(
            "http://localhost:4444/wd/hub"),
            DesiredCapabilities.chrome());
      } catch (MalformedURLException e) {
        e.printStackTrace();
      }
    } else if (browserName.get(0).equalsIgnoreCase("ie")) {
      System.setProperty("webdriver.ie.driver",
          System.getProperty("user.dir")
              + "\\src\\main\\resources\\IEDriverServer.exe");

      capabilities.setBrowserName("IE");
      try {
        driver = new RemoteWebDriver(new URL(
            "http://localhost:4444/wd/hub"),
            DesiredCapabilities.internetExplorer());
      } catch (MalformedURLException e) {
        e.printStackTrace();
      }
    } else if (browserName.get(0).equalsIgnoreCase("firefox")) {
      System.setProperty("webdriver.gecko.driver",
          System.getProperty("user.dir")
              + "\\src\\main\\resources\\geckodriver.exe");
      driver = new RemoteWebDriver(
          new URL("http://localhost:4444/wd/hub"),
          DesiredCapabilities.firefox());
    }
    return driver;
  }
}
</pre><p>The <code class="literal">capabilities</code> object is instantiated to a Chrome capability. Next, we change the <code class="literal">ChromeDriver</code> constructor to <code class="literal">RemoteWebDriver</code>. The first <span>argument</span><a id="id325486957" class="indexterm"></a> to this is a URL object which accepts the HUB URL as the first argument and the <code class="literal">capabilities</code> object as the second argument.</p><p>Then, we execute the <code class="literal">testng.xml</code> by right clicking on <strong class="userinput"><code>Run As TestNG suite</code></strong>. Once the browser instances start opening, notice the changes that happen in the node console:</p><div class="mediaobject"><img src="/graphics/9781789612486/graphics/d596d87c-8f95-4973-a625-918411d4e1db.png" /></div><p>Notice how the Internet Explorer instances have become disabled. This indicates that we currently have one Chrome <span>and</span><a id="id325486993" class="indexterm"></a> one Internet Explorer session open.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec60"></a>Emailable report</h3></div></div></div><p>After completion of the run, the TestNG framework generates a <span>report</span><a id="id325487008" class="indexterm"></a> called Emailable report, which is in HTML format <span>and</span><a id="id325487016" class="indexterm"></a> is available in the <code class="literal">test-output</code> folder in Eclipse. </p><p>The report shown here shows that there were two parameters, that is, Chrome and Internet Explorer:</p><div class="mediaobject"><img src="/graphics/9781789612486/graphics/ba440e36-8a17-49bf-b631-ca37004adc48.png" /></div><p>With this, we have completed this chapter on the command design pattern and the changes involved for incorporating Selenium Grid. In the next <span>and</span><a id="id325492981" class="indexterm"></a> final chapter, we will <span>integrate</span><a id="id325492989" class="indexterm"></a> the framework with logging, reporting, and Jenkins.</p></div></div>