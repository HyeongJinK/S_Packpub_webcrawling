<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec60"></a>The IdentityStore mechanism</h2></div></div><hr /></div><p><code class="literal">IdentityStore</code> is where we can store user details such as user ID, secrets, and other <span>information</span><a id="id326368596" class="indexterm"></a> associated with that particular identity. The <code class="literal">IdentityStore</code> API in Java EE 8 is an <span>interface</span><a id="id326368576" class="indexterm"></a> that is used to interact with the identity stores in order to validate the user credentials against the identity store. The API takes in the credentials, validates the data in the identity store, and returns the validation result. The idea of this abstraction is to ease the use of identity stores for user authentication and authorization mechanisms. The <code class="literal">IdentityStore</code> mechanism operates as follows:</p><div class="mediaobject"><img src="/graphics/9781788997270/graphics/b21811a6-d111-4f83-9b65-f4c49929c526.png" /></div><p>The user's credentials can consist of a <span class="strong"><strong>userID</strong></span> and <span class="strong"><strong>Password</strong></span>, or an OAuth token, depending on the data store implementation in the application. The <code class="literal">IdentityStore</code> API validates this information by locating this data in the data store, and returns a status to indicate whether or not the authentication is successful. The API can be implemented to return other membership details, such as the group or role association of the identity.</p><p>There are multiple <code class="literal">IdentityStore</code> implementations available, including embedded identity store implementations, and database and LDAP implementations. These built-in  <code class="literal">IdentityStore</code> implementations can easily be configured through annotations, and can also be made available for use in the application for authenticating identities.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec55"></a>EmbeddedIdentityStoreDefinition</h3></div></div></div><p><code class="literal">@EmbeddedIdentityStoreDefinition</code> is an in-memory data store <span>implementation</span><a id="id326430650" class="indexterm"></a>. This is used for any proof of concept or testing, as the user credentials are directly specified upon annotation. It's easy to configure <code class="literal">EmbeddedIdentityStore</code> in an application; we just have to specify the annotation on the configuration class and provide the identity information in the annotation itself. For example, consider the following code:</p><pre class="programlisting">@EmbeddedIdentityStoreDefinition(
        Credentials(callerName = "user1", password = "secret1", groups = arrayOf("user")),
        Credentials(callerName = "user2", password = "secret2", groups = arrayOf("admin")))
@DeclareRoles("user", "admin")
@ApplicationPath("home")
@ApplicationScoped
class ApplicationConfig : Application() {
    override fun getClasses(): Set&lt;Class&lt;*&gt;&gt; {
        val classes = HashSet&lt;Class&lt;*&gt;&gt;()
        classes.add(Controller::class.java)
        return classes
    }
}</pre><p>Here, we specified <code class="literal">user1</code> as a normal user, and <code class="literal">user2</code> as an admin user, with their credentials and group membership.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec56"></a>DatabaseIdentityStoreDefinition</h3></div></div></div><p><code class="literal">@DatabaseIdentityStoreDefinition</code> <span>annotation</span><a id="id325812958" class="indexterm"></a> is used for a database that stores the user identity information. Applications can be configured to use a database to store the identity, and queries will be specified, one for retrieving user information, and the other for group identity information.</p><p>For example, if we add this <span>annotation</span><a id="id325813041" class="indexterm"></a> and specify the lookup name and queries, it will then be used for validating the request:</p><pre class="programlisting">@DatabaseIdentityStoreDefinition(
        dataSourceLookup = "java:comp/env/jdbc/identityDS",
        callerQuery = "select password from user where user_id = ?",
        groupsQuery = "select group_name from groups where user_id = ?")
@ApplicationPath("home")
@ApplicationScoped
class ApplicationConfig : Application() {
    override fun getClasses(): Set&lt;Class&lt;*&gt;&gt; {
        val classes = HashSet&lt;Class&lt;*&gt;&gt;()
        classes.add(Controller::class.java)
        return classes
    }
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec57"></a>LdapIdentityStoreDefinition</h3></div></div></div><p><code class="literal">@LdapIdentityStoreDefinition</code> is used with any <span>active</span><a id="id325813062" class="indexterm"></a> directory servers that store the identity information.</p><p>Here, we provide the LDAP queries to retrieve the user information:</p><pre class="programlisting">@LdapIdentityStoreDefinition(
        url = "ldap://localhost:8090",
        callerBaseDn = "ou=org,dc=testdata,dc=org",
        groupSearchBase = "ou=group,dc=test,dc=org",
        groupSearchFilter = "((member=%s)(objectClass=groupOfNames))")

@ApplicationScoped
class ApplicationConfig : Application() {
    override fun getClasses(): Set&lt;Class&lt;*&gt;&gt; {
        val classes = HashSet&lt;Class&lt;*&gt;&gt;()
        classes.add(Controller::class.java)
        return classes
    }
}</pre><p>We've discussed how to configure <code class="literal">@EmbeddedIdentityStoreDefinition</code>, <code class="literal">@DataBaseIdentityStoreDefinition</code>, and <code class="literal">@LdapIdentityStoreDefinition</code>. With these identity stores, we can write code for application security by configuring these identity store implementations in the code.</p></div></div>