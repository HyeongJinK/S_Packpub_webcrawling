<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec12"></a>Installing Keras on Ubuntu 16.04</h2></div></div><hr /></div><p>Before installing Keras, we have to install the Theano and TensorFlow packages and their dependencies. Since it is a fresh OS, make sure <span>Python</span><a id="id325917624" class="indexterm"></a> is installed. Let's <span>look</span><a id="id325917630" class="indexterm"></a> at the <span>following</span> section <span>for</span><a id="id325917644" class="indexterm"></a> Python installation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note3"></a>Note</h3><p><span>Conda is an open source</span> package management system and environment management system that runs on multiple OSes: Windows, macOS, and Linux. Conda installs, runs, and updates packages and their dependencies. Conda creates, saves, loads, and switches between environments on a local computer. It has been created for Python environments.</p></div><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec9"></a>Getting ready</h3></div></div></div><p>First you need to make sure you have a blank Ubuntu 16.04 OS locally or remotely available in the cloud and with root access. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec10"></a>How to do it...</h3></div></div></div><p><span>In the following sections, we take a at the installation of each component that needs to be done before we can go ahead with the installation of Keras.</span></p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec0"></a>Installing miniconda</h4></div></div></div><p>Before we proceed further, let's install <code class="literal">miniconda</code> to install the rest of the packages. Miniconda is a smaller version of the <code class="literal">conda</code> package manager. Python is <span>bundled</span><a id="id325918072" class="indexterm"></a> along with<code class="literal">miniconda</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip4"></a>Note</h3><p><span>It is recommended that users choose either Python 2.7 or Python 3.4. </span>Python = 2.7* or ( &gt;= 3.4 and &lt; 3.6 ). The Python development package (<code class="literal">python-dev</code> or <code class="literal">python-devel</code> on most Linux distributions) is recommended. We will focus on Python 2.7.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To install <code class="literal">miniconda</code>, let's first download the <code class="literal">sh</code> installer from the <code class="literal">continuum</code> repository:</li></ol></div><pre class="programlisting"><span class="strong"><strong>wget https://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh</strong></span>
<span class="strong"><strong>chmod 755 Miniconda2-latest-Linux-x86_64.sh </strong></span>
<span class="strong"><strong>./Miniconda2-latest-Linux-x86_64.sh</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Once <code class="literal">conda</code> has been installed, we can use it to install the dependencies of Theano, TensorFlow, and Keras.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec1"></a>Installing numpy and scipy</h4></div></div></div><p>The <code class="literal">numpy</code> and <code class="literal">scipy</code> packages <span>are</span><a id="id325918363" class="indexterm"></a> prerequisites <span>for</span><a id="id325918372" class="indexterm"></a> Theano installation. The <span>following</span><a id="id325918381" class="indexterm"></a> versions <span>are</span><a id="id325918390" class="indexterm"></a> recommended:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">NumPy &gt;= 1.9.1 &lt;= 1.12</li><li style="list-style-type: disc">SciPy &gt;= 0.14 &lt; 0.17.1: Highly recommended for sparse matrix and support for special functions in Theano, SciPy &gt;=0.8 would do the work
</li><li style="list-style-type: disc">BLAS installation (with Level 3 functionality) the recommended: MKL, this <span>is</span><a id="id325918408" class="indexterm"></a> free through <code class="literal">conda</code> with the <code class="literal">mkl-service</code> package</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note5"></a>Note</h3><p><span class="strong"><strong>Basic Linear Algebra Subprograms</strong></span> (<span class="strong"><strong>BLAS</strong></span>) is a specification that defines a set of low-level routines for performing common linear algebra operations such as vector addition, scalar multiplication, dot products, linear combinations, and matrix multiplication. These are the de facto standard low-level routines for linear algebra libraries; the routines have bindings for both C and Fortran. Level 3 is referred to as matrix -to-matrix multiplications.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Execute the following command to install <code class="literal">numpy</code> and <code class="literal">scipy</code>. (Make sure <code class="literal">conda</code> is in your <code class="literal">PATH</code>):</li></ol></div><pre class="programlisting"><span class="strong"><strong>conda install numpy</strong></span>
<span class="strong"><strong>conda install scipy</strong></span></pre><p>The output of the <code class="literal">scipy</code> installation is shown as follows. Notice that it installs <code class="literal">libgfortran</code> as part of the <code class="literal">scipy</code> installation:</p><pre class="programlisting"><span class="strong"><strong>Fetching package metadata ...........</strong></span>
<span class="strong"><strong>Solving package specifications: .</strong></span>
<span class="strong"><strong>Package plan for installation in environment /home/ubuntu/miniconda2:</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The following new packages will also be installed:</li></ol></div><pre class="programlisting"><span class="strong"><strong>libgfortran-ng: 7.2.0-h9f7466a_2 </strong></span>
<span class="strong"><strong>scipy: 1.0.0-py27hf5f0f52_0</strong></span>
<span class="strong"><strong>Proceed ([y]/n)?</strong></span>
<span class="strong"><strong>libgfortran-ng 100% |#############################################################| Time: 0:00:00 36.60 MB/s</strong></span>
<span class="strong"><strong>scipy-1.0.0-py 100% |#############################################################| Time: 0:00:00 66.62 MB/s</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec2"></a>Installing mkl</h4></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><code class="literal">mkl</code> is a math library <span>for</span><a id="id325943123" class="indexterm"></a> Intel and compatible processors. It is a part of <code class="literal">numpy</code>, but we want to make sure it is installed before <span>we</span><a id="id325943134" class="indexterm"></a> install Theano and TensorFlow:</li></ol></div><pre class="programlisting"><span class="strong"><strong>conda install mkl</strong></span></pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>The output of the installation is given as follows. In our case, <code class="literal">miniconda2</code> has already installed the latest version of <code class="literal">mkl</code>:</p><pre class="programlisting"><span class="strong"><strong>Fetching package metadata ...........</strong></span>
<span class="strong"><strong>Solving package specifications: .</strong></span>
<span class="strong"><strong># All requested packages already installed.</strong></span>
<span class="strong"><strong># packages in environment at /home/ubuntu/miniconda2:</strong></span>
<span class="strong"><strong>#</strong></span>
<span class="strong"><strong>mkl 2018.0.1 h19d6760_4</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Once all the prerequisites are installed, let's install TensorFlow.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec3"></a>Installing TensorFlow</h4></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Execute <span>the</span><a id="id326008266" class="indexterm"></a> following <span>command</span><a id="id326008275" class="indexterm"></a> to install <code class="literal">tensorflow</code> using <code class="literal">conda</code>:</li></ol></div><pre class="programlisting"><span class="strong"><strong>conda install -c conda-forge tensorflow</strong></span></pre><p>The output of this command will fetch metadata and install a list of packages, as follows:</p><pre class="programlisting"><span class="strong"><strong>Fetching package metadata .............</strong></span>
<span class="strong"><strong>Solving package specifications: .</strong></span>
<span class="strong"><strong>Package plan for installation in environment /home/ubuntu/miniconda2:</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The following new packages will also be installed:</li></ol></div><pre class="programlisting"><span class="strong"><strong>bleach: 1.5.0-py27_0 conda-forge</strong></span>
<span class="strong"><strong>funcsigs: 1.0.2-py_2 conda-forge</strong></span>
<span class="strong"><strong>futures: 3.2.0-py27_0 conda-forge</strong></span>
<span class="strong"><strong>html5lib: 0.9999999-py27_0 conda-forge</strong></span>
<span class="strong"><strong>markdown: 2.6.9-py27_0 conda-forge</strong></span>
<span class="strong"><strong>mock: 2.0.0-py27_0 conda-forge</strong></span>
<span class="strong"><strong>pbr: 3.1.1-py27_0 conda-forge</strong></span>
<span class="strong"><strong>protobuf: 3.5.0-py27_0 conda-forge</strong></span>
<span class="strong"><strong>tensorboard: 0.4.0rc3-py27_0 conda-forge</strong></span>
<span class="strong"><strong>tensorflow: 1.4.0-py27_0 conda-forge</strong></span>
<span class="strong"><strong>webencodings: 0.5-py27_0 conda-forge</strong></span>
<span class="strong"><strong>werkzeug: 0.12.2-py_1 conda-forge</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>A higher-priority channel will supersede the following packages, as follows:</li></ol></div><pre class="programlisting"><span class="strong"><strong>conda: 4.3.30-py27h6ae6dc7_0 --&gt; 4.3.29-py27_0 conda-forge</strong></span>
<span class="strong"><strong>conda-env: 2.6.0-h36134e3_1 --&gt; 2.6.0-0 conda-forge</strong></span>
<span class="strong"><strong>Proceed ([y]/n)? y</strong></span>
<span class="strong"><strong>conda-env-2.6. 100% |#############################################################| Time: 0:00:00 1.67 MB/s</strong></span>
<span class="strong"><strong>...</strong></span>
<span class="strong"><strong>mock-2.0.0-py2 100% |#############################################################| Time: 0:00:00 26.00 MB/s</strong></span>
<span class="strong"><strong>conda-4.3.29-p 100% |#############################################################| Time: 0:00:00 27.46 MB/s</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Once TensorFlow has been installed, let's test it with a simple program. Create a new file called <code class="literal">hello_tf.py</code> with the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>vi hello_tf.py</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Add the following code to this file and save the file:</li></ol></div><pre class="programlisting"><span class="strong"><strong>import tensorflow as tf</strong></span>
<span class="strong"><strong>hello = tf.constant('Greetings, TensorFlow!')</strong></span>
<span class="strong"><strong>sess = tf.Session()</strong></span>
<span class="strong"><strong>print(sess.run(hello))</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Execute the file created from the command line:</li></ol></div><pre class="programlisting"><span class="strong"><strong>python hello_tf.py</strong></span></pre><p>The output will make sure the library has been successfully installed:</p><pre class="programlisting"><span class="strong"><strong>Greetings, TensorFlow!</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec4"></a>Installing Keras</h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note6"></a>Note</h3><p><code class="literal">conda-forge</code> is a GitHub entity with a repository of <code class="literal">conda</code> recipes.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Next, we will install <span>Keras</span><a id="id326142294" class="indexterm"></a> using <code class="literal">conda</code> from <code class="literal">conda-forge</code></li><li>Execute the following command on the Terminal:</li></ol></div><pre class="programlisting"><span class="strong"><strong>conda install -c conda-forge keras</strong></span></pre><p>The following listed output will confirm that Keras is installed:</p><pre class="programlisting"><span class="strong"><strong>Fetching package metadata .............</strong></span>
<span class="strong"><strong>Solving package specifications: .</strong></span>
<span class="strong"><strong>Package plan for installation in environment /home/ubuntu/miniconda2:</strong></span></pre><p>The following new packages will also be installed:</p><pre class="programlisting"><span class="strong"><strong>h5py: 2.7.1-py27_2 conda-forge</strong></span>
<span class="strong"><strong>hdf5: 1.10.1-1 conda-forge</strong></span>
<span class="strong"><strong>keras: 2.0.9-py27_0 conda-forge</strong></span>
<span class="strong"><strong>libgfortran: 3.0.0-1 </strong></span>
<span class="strong"><strong>pyyaml: 3.12-py27_1 conda-forge</strong></span>
<span class="strong"><strong>Proceed ([y]/n)? y</strong></span>
<span class="strong"><strong>libgfortran-3. 100% |#############################################################| Time: 0:00:00 35.16 MB/s</strong></span>
<span class="strong"><strong>hdf5-1.10.1-1. 100% |#############################################################| Time: 0:00:00 34.26 MB/s</strong></span>
<span class="strong"><strong>pyyaml-3.12-py 100% |#############################################################| Time: 0:00:00 60.08 MB/s</strong></span>
<span class="strong"><strong>h5py-2.7.1-py2 100% |#############################################################| Time: 0:00:00 58.54 MB/s</strong></span>
<span class="strong"><strong>keras-2.0.9-py 100% |#############################################################| Time: 0:00:00 45.92 MB/s</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Let's verify the Keras installation with the following code:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ python</strong></span>
<span class="strong"><strong>Python 2.7.14 |Anaconda, Inc.| (default, Oct 16 2017, 17:29:19)</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Execute the following command to verify that Keras has been installed:</li></ol></div><pre class="programlisting"><span class="strong"><strong>&gt; from keras.models import Sequential</strong></span>
<span class="strong"><strong>Using TensorFlow backend.</strong></span>
<span class="strong"><strong>&gt;&gt;&gt;</strong></span></pre><p>Notice that Keras is using the TensorFlow backend.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec5"></a>Using the Theano backend with Keras</h4></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Let's modify the <span>default</span><a id="id325441320" class="indexterm"></a> configuration and change TensorFlow to Theano as the backend of Keras. Modify the <code class="literal">keras.json</code> file:</li></ol></div><pre class="programlisting"><span class="strong"><strong>vi .keras/keras.json</strong></span></pre><p>The default file has the following content:</p><pre class="programlisting">{ "<span>image_data_format</span>": <span><span>"channels_last"</span></span>, 
  "<span>epsilon</span>": <span><span>1e-07</span></span>, 
  "<span>floatx</span>": <span><span>"float32"</span></span>, 
  "<span>backend</span>": <span><span>"tensorflow"</span>
</span>}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The modified file will look like the following file. The <code class="literal">"backend"</code> value has been changed to <code class="literal">"theano"</code>:</li></ol></div><pre class="programlisting">{ "<span>image_data_format</span>": <span><span>"channels_last"</span></span>, 
  "<span>epsilon</span>": <span><span>1e-07</span></span>, 
  "<span>floatx</span>": <span><span>"float32"</span></span>, 
  "<span>backend</span>": <span><span>"theano"</span>
</span>}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Run the Python console and import <code class="literal">Sequential</code> from <code class="literal">keras.model</code> using the Theano backend:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ python</strong></span>
<span class="strong"><strong>Python 2.7.14 |Anaconda, Inc.| (default, Oct 16 2017, 17:29:19) </strong></span>
<span class="strong"><strong>[GCC 7.2.0] on linux2</strong></span>
<span class="strong"><strong>Type "help", "copyright", "credits" or "license" for more information.</strong></span>
<span class="strong"><strong>&gt;&gt;&gt; from keras.models import Sequential</strong></span></pre><p>Notice how the backend has changed to Theano.</p><p><span>We</span> have installed <code class="literal">miniconda</code>, all the dependencies of TensorFlow, and Theano. This was followed by installing TensorFlow and Theano itself. Finally, we installed Keras. We also learned how to change the backend of Keras from TensorFlow to Theano.</p></div></div></div>