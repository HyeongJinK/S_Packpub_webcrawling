<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec26"></a>Feature standardization of image data</h2></div></div><hr /></div><p>In this recipe, we will look at how <span>Keras</span><a id="id324879982" class="indexterm"></a> can be used for feature <span>standardization</span><a id="id325338085" class="indexterm"></a> of image data. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec28"></a>Getting ready</h3></div></div></div><p>Make sure the Keras installation and Jupyter Notebook installation have been completed.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec29"></a>How to do it...</h3></div></div></div><p>We will be <span>using</span><a id="id325338106" class="indexterm"></a> the <code class="literal">mnist</code> dataset. First, let's plot the <code class="literal">mnist</code> images without standardization:</p><pre class="programlisting">from keras.datasets import mnist
from matplotlib import pyplot

(X_train, y_train), (X_test, y_test) = mnist.load_data()
# create a grid of 3x3 images
for i in range(0, 9):
    ax = pyplot.subplot(330 + 1 + i)
    pyplot.tight_layout()
    ax.tick_params(axis='x', colors='white')
    ax.tick_params(axis='y', colors='white')
 pyplot.imshow(X_train[i], cmap=pyplot.get_cmap('gray'))
# show the plot
pyplot.show()</pre><p>The output plot will be similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788621755/graphics/bea24c1f-bcf5-44fd-93bf-038471a3acf7.png" /></div><p>For feature standardization, we are planning to use <code class="literal">ImageDataGenerator</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec27"></a>Initializing ImageDataGenerator</h4></div></div></div><p>Use <code class="literal">keras.preprocessing.image.ImageDataGenerator(featurewise_center=<span>False</span>, samplewise_center=<span>False</span>, featurewise_std_normalization=<span>False</span>, samplewise_std_normalization=<span>False)</span></code> to initialize <code class="literal">ImageDataGenerator</code>.</p><p>The parameters are explained as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">featurewise_center</code>: Boolean. Set input mean to 0 <span>over</span><a id="id325348304" class="indexterm"></a> the dataset, feature-wise.</li><li style="list-style-type: disc"><code class="literal">samplewise_center</code>: Boolean. Set each sample mean to 0.</li><li style="list-style-type: disc"><code class="literal">featurewise_std_normalization</code>: Boolean. Divide inputs by <code class="literal">std</code> of the dataset, feature-wise.</li><li style="list-style-type: disc"><code class="literal">samplewise_std_normalization</code>: Boolean. Divide each input by its <code class="literal">std</code>.</li></ul></div><p>Let's apply this to our <code class="literal">mnist</code> dataset:</p><pre class="programlisting">from keras.preprocessing.image import ImageDataGenerator
from keras import backend as K
K.set_image_dim_ordering('th')</pre><pre class="programlisting">X_train = X_train.reshape<span>(X_train.shape[0], 1, 28, 28)</span>
X_test = X_test.reshape(X_test.shape[0], 1, 28, 28)
# convert from int to float
X_train = X_train.astype('float32')
X_test = X_test.astype('float32')
# define data preparation
datagen = <span>ImageDataGenerator</span>(featurewise_center=True, featurewise_std_normalization=True,
 samplewise_center=True, samplewise_std_normalization=True)
# fit parameters from data
datagen.fit(X_train)
# configure batch size and retrieve one batch of images
for X_batch, y_batch in datagen.flow(X_train, y_train, batch_size=9):
    # create a grid of 3x3 images
    for i in range(0, 9):
        ax =pyplot.subplot(330 + 1 + i)
        pyplot.tight_layout()
        ax.tick_params(axis='x', colors='white')
        ax.tick_params(axis='y', colors='white')
        pyplot.imshow(X_batch[i].reshape(28, 28), cmap=pyplot.get_cmap('gray'))
     # show the plot
     pyplot.show()
     break</pre><p>The output of the preceding listing will be a 3 x 3 grid with images standardized and normalized feature-wise, and sample-wise, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788621755/graphics/f9636294-5e23-4464-aeb2-6989792292b9.png" /></div></div></div></div>