<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec42"></a>tmux, screen, and Vim terminal mode</h2></div></div><hr /></div><p>Software development often involves <span>more</span><a id="id325983625" class="indexterm"></a> than just writing code: executing your binaries, running tests, and using command-line tools to accomplish certain tasks. That's where session and window <span>managers</span><a id="id325983537" class="indexterm"></a> come in.</p><p>Modern desktop environments allow you to have multiple windows, but we'll focus on how you can manage the tasks you need to accomplish in a single Terminal session.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec44"></a>tmux</h3></div></div></div><p>tmux is a Terminal multiplexer: it allows you to manage multiple Terminal <span>windows</span><a id="id325983534" class="indexterm"></a> in a single screen.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note100"></a>Note</h3><p>If you're on a Debian-based distribution, you can install tmux using <code class="literal">sudo apt-get install tmux</code>. You can also build tmux from source, which is available from GitHub: <a class="ulink" href="https://github.com/tmux/tmux" target="_blank">https://github.com/tmux/tmux</a>.</p></div><p>You can <span>start</span><a id="id325983512" class="indexterm"></a> it by invoking <code class="literal">tmux</code> in the Terminal:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/f9bf227e-3037-4e70-906b-f2a336af7d5b.png" /></div><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec26"></a>Panes are just like splits</h4></div></div></div><p>tmux allows you to <span>have</span><a id="id325898535" class="indexterm"></a> multiple panes (the equivalent of windows in Vim) and windows (the equivalent of tabs). To access tmux functionality, you first need to hit a prefix key, followed by a command. The default prefix key is <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip101"></a>Note</h3><p>You can rebind the default prefix key to something else by creating or editing your <code class="literal">~/.tmux.conf</code> file. For example, if you wanted to use <span class="emphasis"><em>Ctrl </em></span>+ \ as a prefix instead of <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span>, you would add the following:<code class="literal"># Use Ctrl-\ as a prefix.</code><code class="literal">unbind-key C-b</code><code class="literal">set -g prefix 'C-\'</code><code class="literal">bind-key 'C-\' send-prefix</code>
Restart tmux (or execute <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span> followed by <code class="literal">:source-file ~/.tmux.conf</code>) to apply the configuration.</p></div><p>To split the screen vertically, use <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span> followed by <code class="literal">%</code>:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip102"></a>Note</h3><p>For some reason, I could never get used to the default bindings. I remember hyphen <code class="literal">-</code> is a lot easier for creating vertical splits. My <code class="literal">~/.tmux.conf</code> file contains the following:<code class="literal"># Use - to create vertical splits.</code><code class="literal">bind - split-window -v</code><code class="literal">unbind '%'</code></p></div><div class="mediaobject"><img src="/graphics/9781789341096/graphics/f03e8efc-ba41-4952-92c1-e972b238f539.png" /></div><p> </p><p>To create a horizontal split, hit <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span>, followed by <code class="literal">"</code>:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip103"></a>Note</h3><p>The same as with vertical splits, I find the pipe character <code class="literal">|</code> to be a lot easier to remember for creating horizontal split windows. My <code class="literal">~/.tmux.conf</code> file contains the following:<code class="literal"># Use | to create horizontal splits.</code><code class="literal">bind | split-window -h</code><code class="literal">unbind '"'</code></p></div><div class="mediaobject"><img src="/graphics/9781789341096/graphics/d072441f-7a45-408b-a616-6c6ee7dd0a29.png" /></div><p>You can navigate the panes by using <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span> followed by an arrow key. Every pane operates independently, and you can change directories, execute commands, and (most importantly) use Vim in each one of the panes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip104"></a>Note</h3><p>If you're already used to <code class="literal">hjkl</code>, arrow key navigation might feel unwieldy. Add the following to your <code class="literal">~/.tmux.conf</code> file to add <code class="literal">hjkl</code> movement support:<code class="literal">bind h select-pane -L</code><code class="literal">bind j select-pane -D</code><code class="literal">bind k select-pane -U</code><code class="literal">bind l select-pane -R</code></p></div><p> </p><p>In the following example, I have a file with some code loaded into the left-hand pane; I'm editing <code class="literal">.vimrc</code> in the upper-right pane and listing files with <code class="literal">ls</code> in the lower-right pane:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/36ebe7ce-f88d-4f5e-89fc-1cd4d5ba306d.png" /></div><p>Exit the session by executing <code class="literal">exit</code> or hitting <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>d</em></span> to close the pane.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec27"></a>Windows are just like tabs</h4></div></div></div><p>You can create a new window by keying in <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span> followed by <code class="literal">c</code>. You can now see that we have two <span>panes</span><a id="id326441528" class="indexterm"></a> at the bottom of the screen:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/1f33df17-5cc8-4f25-baf0-1263b6f865ef.png" /></div><p>Windows are automatically named based on what process is running in an active window within a pane. You can rename the current window by running <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span> followed by <code class="literal">,</code>:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/141e3239-55d0-44dd-a709-fa11513233ba.png" /></div><p>You can navigate the windows by pressing <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>b</em></span> followed by <code class="literal">n</code> to go forward and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>b</em></span> followed by <code class="literal">p</code> to go backward.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec28"></a>Sessions are invaluable</h4></div></div></div><p>If you SSH into a machine to work, tmux is an essential tool you can use. tmux <span>allows</span><a id="id326441712" class="indexterm"></a> you to create long-lasting sessions, which outlive a single SSH connection.</p><p>If you're in a tmux session, you can detach from it by pressing <span class="emphasis"><em>Ctrl + b</em></span> followed by <code class="literal">d</code>. You will be sent back in your shell with the following message:</p><pre class="programlisting">[detached (from session 0)]</pre><p>The session will be alive until your machine is powered off. To list tmux sessions, execute the following:</p><pre class="programlisting"><span class="strong"><strong>$ tmux list-sessions</strong></span>
0: 2 windows (created Sat Aug 18 19:17:59 2018) [80x23]</pre><p>As you can see, we currently have one session available. Let's open the session, or—in tmux terms—attach to it:</p><pre class="programlisting"><span class="strong"><strong>$ tmux attach -t 0</strong></span></pre><p>Running <code class="literal">tmux</code> without any arguments always creates a new session.</p><p>You can have as many sessions as you want, if you prefer to separate work on different projects using different sessions! It's often helpful to divide projects or different tasks by sessions. You can navigate sessions from within tmux using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>b</em></span> followed by <code class="literal">(</code> or <code class="literal">)</code>.</p><p>You can also name your sessions, either when invoking tmux (<code class="literal">tmux new -s name</code>) or from within tmux (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>b</em></span> and <code class="literal">$</code>).</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec29"></a>tmux and Vim splits</h4></div></div></div><p>Developers often use tmux panes and Vim <span>window</span><a id="id326450251" class="indexterm"></a>s to complement each other. You can have Vim open in different tmux panes as a way to isolate Vim instances from each other (and therefore group buffers). Normally, I have a few tmux panes open with Vim in one of them (with its own splits as needed), and shell running in the rest. Everyone treats their panes and windows differently, and you may want to experiment.</p><p> </p><p>tmux and Vim use different key bindings to navigate through windows (or, in tmux terminology, panes). This is rather confusing, and there are solutions in place to fix it! The easiest is to use the vim-tmux-navigator plugin, which is available from <a class="ulink" href="https://github.com/christoomey/vim-tmux-navigator" target="_blank">https://github.com/christoomey/vim-tmux-navigator</a>. vim-tmux-navigator adds <span>support</span><a id="id326450269" class="indexterm"></a> for consistent navigation between Vim windows and tmux panes using the <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>h</em></span>, <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>j</em></span>, <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>k</em></span>, and <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>l</em></span> keys.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note105"></a>Note</h3><p>In order to use vim-tmux-navigator, your tmux needs to be version 1.8 or higher. You can check your tmux version by running the following:<code class="literal">$ tmux -V</code>
See the previous <span class="emphasis"><em>tmux </em></span>section for tips on how to install a newer version of tmux.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note106"></a>Note</h3><p>If you're using vim-plug, you can install vim-tmux-navigator by adding the following line to your <code class="literal">.vimrc</code> file:<code class="literal">Plug 'christoomey/vim-tmux-navigator'</code>
Don't forget to run <code class="literal">:w | source $MYVIMRC | PlugInstall</code> to install the plugin.</p></div><p>Once you have the plugin installed, you'll have to add the following bindings to your <code class="literal">~/.tmux.conf</code> file (this snippet is available from <a class="ulink" href="https://github.com/christoomey/vim-tmux-navigator" target="_blank">https://github.com/christoomey/vim-tmux-navigator</a>):</p><pre class="programlisting"># Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
 | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind-key -T copy-mode-vi C-h select-pane -L
bind-key -T copy-mode-vi C-j select-pane -D
bind-key -T copy-mode-vi C-k select-pane -U
bind-key -T copy-mode-vi C-l select-pane -R</pre><p> </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip107"></a>Note</h3><p>If you're an advanced tmux user, or don't mind digging around, you may want to use TPM (Tmux Plugin Manager) instead of pasting the snippet into your <code class="literal">.tmux.conf</code> file. Add the following lines to <code class="literal">.tmux.conf</code> for TPM to configure the plugin for you:<code class="literal">set -g @plugin 'christoomey/vim-tmux-navigator'</code><code class="literal">run '~/.tmux/plugins/tpm/tpm'</code>
You can learn more about TPM (and how to install it) from <a class="ulink" href="https://github.com/tmux-plugins/tpm" target="_blank">https://github.com/tmux-plugins/tpm</a>.</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec45"></a>Screen</h3></div></div></div><p>Screen is tmux's <span>spiritual</span><a id="id326572744" class="indexterm"></a> predecessor, but it's still used by many today. Screen is not as extensible as tmux, and in fact Vim doesn't play that nicely with Screen out of the box. However, if you're used to Screen and don't want to change your existing workflow, there are a few tweaks you can make to your setup to make the two get along a little nicer.</p><p>The <span class="emphasis"><em>Esc</em></span> key doesn't register correctly in Vim when running through Screen. You might want to add the following to your <code class="literal">~/.screenrc</code> file to fix the <span class="emphasis"><em>Esc</em></span> key behavior:</p><pre class="programlisting"># Wait no more than 5 milliseconds when detecting an input
# sequence, fixes <span class="emphasis"><em>Esc</em></span> behavior in Vim.
maptimeout 5</pre><p>Screen also sets the <code class="literal">$TERM</code> variable to <code class="literal">screen</code>, which Vim does not recognize. Update <code class="literal">.screenrc</code> to include the following:</p><pre class="programlisting"># Set $TERM to a value Vim recognizes.
term screen-256color</pre><p>There are more minor inconveniences when using Vim and Screen together, such as the <span class="emphasis"><em>Home</em></span> and <span class="emphasis"><em>End</em></span> keys not registering, for example. Vim Wikia has a great in-depth entry on getting Vim and Screen to play along nicely at <a class="ulink" href="http://vim.wikia.com/wiki/GNU_Screen_integration" target="_blank">http://vim.wikia.com/wiki/GNU_Screen_integration</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec46"></a>Terminal mode</h3></div></div></div><p>Historically, you can run shell commands from Vim by using <code class="literal">:!</code> followed by a shell command. For example, we could <span>execute</span><a id="id326574724" class="indexterm"></a> our Python program as follows:</p><pre class="programlisting"><span class="strong"><strong>:!python3 animal_farm.py cat dog sheep</strong></span></pre><p> </p><p> </p><p>Vim will pause, and you'll see the output in the Terminal:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/0b31a1a8-b6f6-49e3-9cb9-f4e4410bc35f.png" /></div><p>Things have got better since then.</p><p>In version 8.1, Vim introduced the terminal mode. The terminal mode is effectively a Terminal emulator running within your Vim session. Unlike with tmux, terminal mode plays with Vim out of the box. It's great for running long running commands while you continue to work in Vim.</p><p>Terminal mode can be invoked by executing the following:</p><pre class="programlisting"><span class="strong"><strong>:term</strong></span></pre><p>This opens a horizontal split with your default shell running:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/ad0244d7-cb71-4313-bdc7-d46daf0da29d.png" /></div><p>The Terminal window is treated like any other window, and can be resized and moved as usual (see the <span class="emphasis"><em>Windows</em></span> section in <a class="link" href="#" linkend="ch09">Chapter 10</a>, <span class="emphasis"><em>Neovim</em></span>). The window is running in a terminal-job mode, something akin to an insert mode. But there are a few specific key bindings:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="emphasis"><em>Ctrl + </em></span><span class="emphasis"><em>w</em></span>, <span class="emphasis"><em>N </em></span>enters a terminal-normal mode, which behaves just like a normal mode. Operations that take you back to insert mode (such as <code class="literal">i</code> or <code class="literal">a</code>) will take you back to a terminal-job mode.</li><li style="list-style-type: disc"><span class="emphasis"><em>Ctrl + </em></span><span class="emphasis"><em>w</em></span>, <code class="literal"><span class="emphasis"><em>"</em></span></code> followed by a register will paste the contents of a register into a terminal. For example, to paste something you yanked with <code class="literal">yw</code>, you can <span>execute</span><a id="id325881108" class="indexterm"></a> <span class="emphasis"><em>Ctrl</em></span> <span class="emphasis"><em>+ w</em></span>, <code class="literal">"</code> to paste from the default register.</li><li style="list-style-type: disc"><span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>w,</em></span> <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>c</em></span> sends <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>c</em></span> to the running command in a Terminal.</li></ul></div><p>The best feature of a terminal mode is that you can invoke terminal mode with a specific command, and get full access to the output. Try running the following from within Vim:</p><pre class="programlisting"><span class="strong"><strong>:term python3 animal_farm.py cat dog sheep</strong></span></pre><p>This will execute a command and, once it is done running, open a buffer with the resultant output:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/f56b8d0a-9575-4663-9a5f-bc03ef4c5498.png" /></div><p>If you so desire, you can open a Terminal in a vertical split by running <code class="literal">:vert term</code>. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip108"></a>Note</h3><p>If you use the <span class="emphasis"><em>Ctrl </em></span>+ <span class="emphasis"><em>hjkl</em></span> shortcuts from <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Advanced Editing and Navigation,</em></span>to navigate your Vim windows, you may want to add an additional set of bindings to your <code class="literal">.vimrc</code> file to work with the terminal mode:<code class="literal">tnoremap &lt;c-j&gt; &lt;c-w&gt;&lt;c-j&gt;</code><code class="literal">tnoremap &lt;c-k&gt; &lt;c-w&gt;&lt;c-k&gt;</code><code class="literal">tnoremap &lt;c-l&gt; &lt;c-w&gt;&lt;c-l&gt;</code><code class="literal">tnoremap &lt;c-h&gt; &lt;c-w&gt;&lt;c-h&gt;</code></p></div><p>For best results, you can combine Vim terminal mode with tmux: tmux can <span>manage</span><a id="id325881478" class="indexterm"></a> your sessions for you (for when you need to switch focus between tasks), while terminal mode can manage windows. For instance, you could use Vim terminal windows to organize work on your project and tmux windows (or tabs in Vim terminology) to switch focus and work on different tasks.</p></div></div>