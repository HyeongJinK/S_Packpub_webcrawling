<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec58"></a>Learning the syntax</h2></div></div><hr /></div><p>Let's take a lightning-fast <span>deep</span><a id="id325844914" class="indexterm"></a> dive into Vimscript's syntax.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note129"></a>Note</h3><p>This section assumes you're comfortable with at least one programming language, conditional statements and loops in particular. If that's not the case, you will most certainly be better off finding a more extensive tutorial. Vimscript deserves its own book, and Steve Losh wrote just that: <span class="emphasis"><em>Learn Vimscript the Hard Way</em></span> is easily the best Vimscript tutorial available (and it's free on the web!).</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec65"></a>Setting variables</h3></div></div></div><p>You've already discovered some basics of Vimscript syntax. To set <span>internal</span><a id="id325844896" class="indexterm"></a> Vim options, you use the<code class="literal">set</code>keyword:</p><pre class="programlisting">set background=dark</pre><p>To assign a value to a non-internal variable, use the <code class="literal">let</code> keyword:</p><pre class="programlisting">let animal_name = 'Miss Cattington'</pre><p>Vimscript doesn't have explicit booleans, so <code class="literal">1</code> is treated as true and <code class="literal">0</code> as false:</p><pre class="programlisting">let is_cat = 1</pre><p> </p><p> </p><p> </p><p> </p><p>Since we're assigning variables, let's talk about scopes. Vim handles variable and function scopes with prefixes, like so:</p><pre class="programlisting">let g:animal_name = 'Miss Cattington'
let w:is_cat=1</pre><p>Each letter has a unique meaning, in particular the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">g</code>: global scope (default if scope is not specified)</li><li style="list-style-type: disc"><code class="literal">v</code>: global defined by Vim</li><li style="list-style-type: disc"><code class="literal">l</code>: local scope (default within a function if scope is not specified)</li><li style="list-style-type: disc"><code class="literal">b</code>: current buffer</li><li style="list-style-type: disc"><code class="literal">w</code>: current window</li><li style="list-style-type: disc"><code class="literal">t</code>: current tab</li><li style="list-style-type: disc"><code class="literal">s</code>: local to a <code class="literal">:source'd</code> Vim script</li><li style="list-style-type: disc"><code class="literal">a</code>: function argument</li></ul></div><p>In this example, <code class="literal">g:animal_name</code>is a global variable (it could also be written as<code class="literal">let animal_name='Miss Cattington'</code>, but explicit scope declarations are always better), and<code class="literal">w:is_cat</code>is a window scope variable.</p><p>As you might remember, you can also set registers with <code class="literal">let</code>. For example, if you wanted to set register <code class="literal">a</code> to hold <code class="literal">cats are weird</code>, you could do this:</p><pre class="programlisting">let @a = 'cats are weird'</pre><p>You can also access Vim options (the ones you can change with <code class="literal">set</code>) by prefixing the variable with <code class="literal">&amp;</code>, for example:</p><pre class="programlisting">let &amp;ignorecase = 0</pre><p>You can use the usual mathematical operations on integers (<code class="literal">+</code>, <code class="literal">-</code>, <code class="literal">*</code>, <code class="literal">/</code>). String concatenation is performed using the <code class="literal">.</code> operator:</p><pre class="programlisting">let g:cat_statement = g:animal_name . ' is a cat'</pre><p>If you wanted to use a single quote within a single-quoted string, you can do so by typing it twice (<code class="literal">''</code>).</p><p> </p><p> </p><p>Oh, and like in many languages, single quotes identify literal strings, while double quotes identify non-literal strings. This becomes slightly confusing because comments also start with a double quote. Due to this behavior, certain commands in Vimscript can't be followed by a comment.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec66"></a>Surfacing output</h3></div></div></div><p>You can print the content of a variable (or the results of any operation) into a <span>status</span><a id="id326575954" class="indexterm"></a> line using <code class="literal">echo</code>:</p><pre class="programlisting"><span class="strong"><strong>echo g:animal_name</strong></span></pre><p>One thing about echo, though, is that the output does not get logged anywhere and there's no way to view the message once it's dismissed.</p><p>For that, there's <code class="literal">:echomsg</code> (or <code class="literal">:echom</code> for short):</p><pre class="programlisting"><span class="strong"><strong>echom g:animal_name . ' is an animal'</strong></span>
<span class="strong"><strong>echom 'here is an another message'</strong></span></pre><p>To see the log of messages from this sessions, execute the following command:</p><pre class="programlisting"><span class="strong"><strong>:messages</strong></span></pre><p>Now, you can see every message we printed:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/8e2c840f-6843-428b-8f44-ef13d80774e2.png" /></div><p> </p><p>In fact, many operations log messages via <code class="literal">echom</code>. For instance, file write using <code class="literal">:w</code> does so:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/312a6c72-33de-4011-a718-caeee8f9fd1f.png" /></div><p>Messages can be a powerful tool for debugging and trying to figure out what went wrong with your script. Learn more about messages via <code class="literal">:help message-history</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec67"></a>Conditional statements</h3></div></div></div><p>Conditional statements are <span>performed</span><a id="id326335890" class="indexterm"></a> using <code class="literal">if</code> statements:</p><pre class="programlisting">if g:animal_kind == 'cat'
  echo g:animal_name . ' is a cat'
elseif g:animal_kind == 'dog'
  echo g:animal_name . ' is a dog'
else
  echo g:animal_name . ' is something else'
endif</pre><p>You can also make this operation inline:</p><pre class="programlisting">echo g:animal_name . (g:is_cat ? 'in'is a cat' : 'in'is something else')
</pre><p>Vim supports all of the logical operators you're used to from other languages:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">&amp;&amp;</code> - and</li><li style="list-style-type: disc"><code class="literal">||</code> - or</li><li style="list-style-type: disc"><code class="literal">!</code> - not
<p> </p></li></ul></div><p>For example, you can do this:</p><pre class="programlisting">if !(g:is_cat || g:is_dog)
  echo g:animal_name . ' is something else'
endif</pre><p>In the previous example, you'll get to <code class="literal">g:animal_name . ' is something else'</code> only if neither <code class="literal">g:is_cat</code> or <code class="literal">g:is_dog</code> are true.</p><p>This can also be written with the <code class="literal">&amp;&amp;</code> operator:</p><pre class="programlisting">if !g:is_cat &amp;&amp; !g:is_dog
  echo g:animal_name . ' is something else'
endif</pre><p>Since text editing implies operating on strings, Vim has additional text-specific comparison operators:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">==</code> compares two string; case sensitivity depends on user's settings (see later)</li><li style="list-style-type: disc"><code class="literal">==?</code> explicitly case insensitive comparison</li><li style="list-style-type: disc"><code class="literal">==#</code> explicitly case sensitive comparison</li><li style="list-style-type: disc"><code class="literal">=~</code> checks a match against an expression on the right (<code class="literal">=~?</code> or <code class="literal">=~#</code> to make those explicitly case insensitive or sensitive)</li><li style="list-style-type: disc"><code class="literal">!~</code> checks that a string does not match an expression on the right (<code class="literal">=~#</code>or <code class="literal">!~#</code> to make those explicitly case insensitive or sensitive)</li></ul></div><p>The default behavior of <code class="literal">==</code>, as well as <code class="literal">=~</code> and <code class="literal">!~</code> (case sensitive or case insensitive) depends on the <code class="literal">ignorecase</code> setting.</p><p>Here are some examples:</p><pre class="programlisting">'cat' ==? 'CAT'                     " true
'cat' ==# 'CAT'                     " false
set ignorecase | 'cat' == 'CAT'     " true
'cat' =~ 'c.\+'                     " true
'cat' =~# 'C.\+'                    " false
'cat' !~ '.at'                      " false
'cat' !~? 'C.\+'                    " false</pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec68"></a>Lists</h3></div></div></div><p>Vim also supports more complex <span>data</span><a id="id326400547" class="indexterm"></a> structures, such as lists and dictionaries. Here's an example of a list:</p><pre class="programlisting">let animals = ['cat', 'dog', 'parrot']</pre><p>Operations to modify lists are similar to the ones in Python. Let's take a look at some common operations.</p><p>You can get elements by index using the <code class="literal">[n]</code> syntax. Here are some examples:</p><pre class="programlisting">let cat = animals[0]      " get first element
let dog = animals[1]      " get second element
let parrot = animals[-1]  " get last element</pre><p>Slices work in a similar way to Python, for instance:</p><pre class="programlisting">let slice = animals[1:]</pre><p>The value of <code class="literal">slice</code> would be <code class="literal">['dog, 'parrot']</code>. The main difference from Python is that the end of the range is inclusive:</p><pre class="programlisting">
let slice = animals[0:1]</pre><p>The value of <code class="literal">slice</code> would be <code class="literal">['cat', 'dog']</code>.</p><p>To append to the list, use<code class="literal">add</code>:</p><pre class="programlisting">call add(animals, 'octopus')</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note130"></a>Note</h3><p>Something to pay attention to is this: in Vimscript, we explicitly call functions with <code class="literal">call</code> unless they're a part of an expression. Don't worry too much about it yet, we'll get into more detail in a bit.</p></div><p>This will turn our list into <code class="literal">['cat', 'dog', 'parrot', 'octopus']</code>. While it's an in-place operation, it also returns the modified list, so you can assign to it as well:</p><pre class="programlisting">let animals = add(animals, 'octopus')</pre><p>You can also prepend to the list using <code class="literal">insert</code>:</p><pre class="programlisting">call insert(animals, 'bobcat')</pre><p> </p><p> </p><p> </p><p> </p><p>This will modify the list to be <code class="literal">['bobcat', 'cat', 'dog', 'parrot', 'octopus']</code>.</p><p>You can also provide an optional index argument. For instance, if you wanted to insert <code class="literal">'raven'</code> at index 2 (where the <code class="literal">'dog'</code> currently is) in the previous list, you would do the following:</p><pre class="programlisting">call insert(animals, 'raven', 2)</pre><p>The list will become <code class="literal">['bobcat', 'cat', 'raven', 'dog', 'parrot', 'octopus']</code>.</p><p>There are a few ways to remove the elements. For example, you can use unlet to remove an element at index 2 (<code class="literal">'raven'</code>):</p><pre class="programlisting">unlet animals[2]</pre><p>The list will be back to <code class="literal">['bobcat', 'cat', 'dog', 'parrot', 'octopus']</code>.</p><p>You can also use <code class="literal">remove</code>:</p><pre class="programlisting">call remove(animals, -1)</pre><p>This will leave us with <code class="literal">['bobcat', 'cat', 'dog', 'parrot']</code>.</p><p>Additionally, <code class="literal">remove</code> also returns the item itself:</p><pre class="programlisting">let bobcat = remove(animals, 0)</pre><p>You can also use ranges with both <code class="literal">unlet</code> and <code class="literal">remove</code>. Here's an example of deleting everything up to and including the second element:</p><pre class="programlisting">unlet animals[:1]</pre><p>If you were to do this with <code class="literal">remove</code>, you'll have to specify boundaries explicitly:</p><pre class="programlisting">call remove(animals, 0, 1)</pre><p>You can concatenate the lists using <code class="literal">+</code> or <code class="literal">extend</code>. For example, given the lists <code class="literal">mammals</code> and <code class="literal">birds</code>:</p><pre class="programlisting">let mammals = ['dog', 'cat']
let birds = ['raven', 'parrot']</pre><p>We could create a new list:</p><pre class="programlisting">let animals = mammals + birds</pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>Here, <code class="literal">animals</code> will contain <code class="literal">['dog', 'cat', 'raven', 'parrot']</code>. We could also extend the existing list:</p><pre class="programlisting">call extend(mammals, birds)</pre><p>This will extend <code class="literal">mammals</code> to contain <code class="literal">['dog', 'cat', 'raven', 'parrot']</code>.</p><p>You can sort the list in place using <code class="literal">sort</code>. If we to use sort on a previous example, we would write:</p><pre class="programlisting">call sort(animals)</pre><p>The result would be <code class="literal">['cat', 'dog', 'parrot', 'raven']</code> (sorted alphabetically).</p><p>You can get an index of an element using index. For instance, if you wanted to get an index of <code class="literal">parrot</code> from the previous list, you would run this:</p><pre class="programlisting">let i = index(animals, 'parrot')</pre><p>In this case, <code class="literal">i</code> would be equal to 2.</p><p>You can check whether a list is empty using (an aptly named) <code class="literal">empty</code>:</p><pre class="programlisting">if empty(animals)
  echo 'There aren''t any animals!'
endif</pre><p>The length of a list is retrieved using <code class="literal">len</code>:</p><pre class="programlisting">echo 'There are ' . len(animals) . ' animals.'</pre><p>Finally, Vim lets you count the number of <span>elements</span><a id="id326482009" class="indexterm"></a> in a list:</p><pre class="programlisting">echo 'There are ' . count(animals, 'cat') . ' cats here.'</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note131"></a>Note</h3><p>You can get a full list of operations by checking out the help page: <code class="literal">:help list</code>.</p></div><p></p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec69"></a>Dictionaries</h3></div></div></div><p>Dictionaries are also <span>supported</span><a id="id326482584" class="indexterm"></a> in Vim:</p><pre class="programlisting">let animal_names = {
  \ 'cat': 'Miss Cattington',
  \ 'dog': 'Mr Dogson',
  \ 'parrot': 'Polly'
  \ }</pre><p>As you may have noticed, you need to explicitly outline the line breaks with a backslash <code class="literal">\</code> if you're defining a dictionary on multiple lines.</p><p>Dictionary modification operations are similar to the ones familiar to you from Python. Elements can be accessed in two ways:</p><pre class="programlisting">let cat_name = animal_names['cat']  " get an element
let cat_name = animal_names.cat     " another way to access an element</pre><p>Accessing an element via <code class="literal">.</code> only works if the key contains numbers, letters, and underscores.</p><p>You can set or override a dictionary entry as follows:</p><pre class="programlisting">let animal_names['raven'] = 'Raven R. Raventon'</pre><p>Entries are removed using <code class="literal">unlet</code> or <code class="literal">remove</code>:</p><pre class="programlisting">unlet animal_names['raven']
let raven = remove(animal_names, 'raven')</pre><p>Dictionaries can be merged using extend (in place):</p><pre class="programlisting">call extend(animal_names, {'bobcat': 'Sir Meowtington'})</pre><p>This will make <code class="literal">animal_names</code> look as follows:</p><pre class="programlisting">let animal_names = {
  \ 'cat': 'Miss Cattington',
  \ 'dog': 'Mr Dogson',
  \ 'parrot': 'Polly',
  \ 'bobcat': 'Sir Meowtington'
  \ }</pre><p> </p><p> </p><p> </p><p> </p><p>In case the second argument to <code class="literal">extend</code> contains duplicate keys, the original entries will be overwritten.</p><p>Similarly to lists, you can measure dictionary length and check whether the dictionaries are empty:</p><pre class="programlisting">if !empty(animal_names)
  echo 'We have names for ' . len(animal_names) . ' animals'
endif</pre><p>Lastly, you can check whether a key is present in a dictionary using <code class="literal">has_key</code>:</p><pre class="programlisting">if has_key(animal_names, 'cat')
  echo 'Cat''s name is ' . animal_names['cat']
endif</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note132"></a>Note</h3><p>You can get a full list of operations by checking out the help page: <code class="literal">:help dict</code>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec70"></a>Loops</h3></div></div></div><p>You can loop through lists and dictionaries <span>using</span><a id="id326528448" class="indexterm"></a> the <code class="literal">for</code> keyword. For example, do this to go through a list:</p><pre class="programlisting">for animal in animals
  echo animal
endfor</pre><p>And here's you iterating through a dictionary:</p><pre class="programlisting">for animal in keys(animal_names)
  echo 'This ' . animal . '''s name is ' . animal_names[animal]
endfor</pre><p>You can also access both the key and the value of the dictionary simultaneously using <code class="literal">items</code>:</p><pre class="programlisting">for [animal, name] in items(animal_names)
  echo 'This ' . animal . '''s name is ' . name
endfor</pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>You can control the iteration flow with <code class="literal">continue</code> and <code class="literal">break</code>. Here's an example of using <code class="literal">break</code>:</p><pre class="programlisting">let animals = ['dog', 'cat', 'parrot']
for animal in animals
  if animal == 'cat'
    echo 'It''s a cat! Breaking!'
    break
  endif
  echo 'Looking at a ' . animal . ', it''s not a cat yet...'
endfor</pre><p>The output from this would be the following:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/d935e342-5cf3-4bf5-94a7-3626f8a2fb61.png" /></div><p>And this is how you would use continue:</p><pre class="programlisting">let animals = ['dog', 'cat', 'parrot']
for animal in animals
  if animal == 'cat'
    echo 'Ignoring the cat...'
    continue
  endif
  echo 'Looking at a ' . animal
endfor</pre><p>And the output from this would be the following:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/646b115d-e85f-4dd3-a62c-902f6be4c008.png" /></div><p>while loops are also supported:</p><pre class="programlisting">let animals = ['dog', 'cat', 'parrot']
while !empty(animals)
  echo remove(animals, 0)
endwhile</pre><p>This will print the following:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/de49de79-f529-4e61-b89c-c747158421ea.png" /></div><p>You can use <code class="literal">break</code> and <code class="literal">continue</code> the same way with <code class="literal">while</code> loops:</p><pre class="programlisting">let animals = ['cat', 'dog', 'parrot']
while len(animals) &gt; 0
  let animal = remove(animals, 0)
  if animal == 'dog'
    echo 'Encountered a dog, breaking!'
    break
  endif
  echo 'Looking at a ' . animal
 endwhile</pre><p> </p><p> </p><p> </p><p> </p><p>This will <span>output</span><a id="id326529798" class="indexterm"></a> the following:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/616578bc-c2fb-4409-b745-87ef00b62dd7.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec71"></a>Functions</h3></div></div></div><p>Just like most other <span>programming</span><a id="id326529819" class="indexterm"></a> languages, Vim supports functions:</p><pre class="programlisting">function AnimalGreeting(animal)
  echo a:animal . ' says hello!'
endfunction
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note133"></a>Note</h3><p>In Vim, user-defined function names must start with a capital letter (unless they're within a script scope or behind a namespace). You'll get an error if you try to define a function starting with a lowercase letter.</p></div><p>You can try calling the function and you'll get the following output:</p><pre class="programlisting"><span class="strong"><strong>:call AnimalGreeting('cat')
cat says hello!
</strong></span></pre><p>You can see that function arguments are accessed via the <code class="literal">a:</code> scope.</p><p>Functions, of course, can return values:</p><pre class="programlisting">function! AnimalGreeting(animal)
  return a:animal . ' says hello!'
endfunction</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note134"></a>Note</h3><p>Something to keep in mind is that in Vim a single script can get loaded multiple times (for example, when the user runs <code class="literal">:source</code> on a file). Redefining a function would throw an error, and a way to get around this is to use <code class="literal">function!</code> to define your functions, as shown before.</p></div><p></p><p>Now, <code class="literal">echo</code> the return value of the function so we can see it:</p><pre class="programlisting"><span class="strong"><strong>:echo AnimalGreeting('dog')
dog says hello!
</strong></span></pre><p>Vim also supports a variable number of arguments via the <code class="literal">...</code> notation (an equivalent to Python's <code class="literal">*args</code>):</p><pre class="programlisting">function! AnimalGreeting(...)
  echo a:1 . ' says hi to ' . a:2
endfunction
</pre><p>Invoking this with the arguments <code class="literal">'cat'</code> and <code class="literal">'dog'</code> will produce the following result:</p><pre class="programlisting"><span class="strong"><strong>:call AnimalGreeting('cat', 'dog')</strong></span>
<span class="strong"><strong>cat says hi to dog
</strong></span></pre><p>You can access a list of all of the arguments with <code class="literal">a:000</code>:</p><pre class="programlisting">function ListArgs(...)
  echo a:000
endfunction
</pre><p>Try invoking it with a few arguments:</p><pre class="programlisting"><span class="strong"><strong>:call ListArgs('cat', 'dog', 'parrot')
['cat', 'dog', 'parrot']
</strong></span></pre><p>You can also combine variable arguments with explicitly specified arguments, just like you would in Python:</p><pre class="programlisting">function! AnimalGreeting(animal, ...)
  echo a:animal . ' says hi to ' . a:1
endfunction
</pre><p>And here's the output:</p><pre class="programlisting"><span class="strong"><strong>:call AnimalGreeting('cat', 'dog')
cat says hi to dog
</strong></span></pre><p>You can (and should) use local scope for your functions to keep them inaccessible from outside the file they are defined in:</p><pre class="programlisting">function! s:AnimalGreeting(animal)
  echo a:animal . 'says hi!'
endfunction</pre><p> </p><p> </p><p> </p><p> </p><p> </p><pre class="programlisting">function! s:AnimalGreeting(animal)
  return a:animal . ' says hello!'
endfunction
</pre><p>This will make sure that <code class="literal">s:AnimalGreeting</code> overwrites itself when sourcing the file again. But be careful not to overwrite somebody else's function.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec72"></a>Classes</h3></div></div></div><p>While <span>Vim</span><a id="id326530309" class="indexterm"></a> doesn't explicitly contain classes, dictionaries support having methods on them, supporting the object-oriented programming paradigm. There are two ways to define a method on a dictionary.</p><p>Given an existing dictionary, <code class="literal">animal_names</code>:</p><pre class="programlisting">
let animal_names = {
  \ 'cat': 'Miss Cattington',
  \ 'dog': 'Mr Dogson',
  \ 'parrot': 'Polly'
  \ }
</pre><p>You could do the following to add a method to it:</p><pre class="programlisting">
function animal_names.GetGreeting(animal)
  return self[a:animal] . ' says hello'
endfunction
</pre><p>You can now execute the function:</p><pre class="programlisting"><span class="strong"><strong>
:echo animal_names.GetGreeting('cat')
Miss Cattington says hello
</strong></span></pre><p>You can use <code class="literal">self</code> (just like in Python!) to refer to dictionary keys.</p><p> </p><p> </p><p>In the previous example, <code class="literal">GetGreeting</code> becomes a callable dictionary key. Effectively, <code class="literal">animal_names</code> becomes this:</p><pre class="programlisting">{
  \ 'cat': 'Miss Cattington',
  \ 'dog': 'Mr Dogson',
  \ 'parrot': 'Polly',
  \ 'GetGreeting': function &lt;...&gt;
  \ }
</pre><p>For the next example, let's wrap our <code class="literal">animal_names</code> dictionary in a slightly more generic <code class="literal">animals</code>. This will make our next example behave slightly more like classes we're used to in other languages (and would help us avoid name collisions):</p><pre class="programlisting">let animals = {
  \ 'animal_names' : {
    \ 'cat': 'Miss Cattington',
    \ 'dog': 'Mr Dogson',
    \ 'parrot': 'Polly'
    \ }
  \ }
</pre><p>You can also define a function before having a dictionary ready, by using <code class="literal">dict</code> keyword after the function name:</p><pre class="programlisting">
function GetGreeting(animal) dict
  return self.animal_names[a:animal] . ' says hello'
endfunction
</pre><p>Now, we'll need to assign the function as another dictionary key:</p><pre class="programlisting">let animals['GetGreeting'] = function('GetGreeting')
</pre><p>Now, you can call <code class="literal">GetGreeting</code> in the same manner:</p><pre class="programlisting"><span class="strong"><strong>:echo animals.GetGreeting('dog')
 Mr Dogson says hello
</strong></span></pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec73"></a>Lambda expressions</h3></div></div></div><p>Lambdas are anonymous functions that can be really <span>useful</span><a id="id326070066" class="indexterm"></a> when working with somewhat straightforward logic.</p><p> </p><p>Here's how we would define <code class="literal">AnimalGreeting</code> from the previous example using lambda expressions:</p><pre class="programlisting">let AnimalGreeting = {animal -&gt; animal . ' says hello'}</pre><p>Let's test it:</p><pre class="programlisting"><span class="strong"><strong>:echo AnimalGreeting('cat')
cat says hello
</strong></span></pre><p>Lambdas provide short and sweet syntax for writing compact functions.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec74"></a>Map and filter</h3></div></div></div><p>Vimscript supports <code class="literal">map</code> and <code class="literal">filter</code>—higher-order <span>functions</span><a id="id326400761" class="indexterm"></a> (aka functions that operate on functions). Both of these functions take either a list or a dictionary as a first argument, and a function as a second.</p><p>For instance, if we wanted to filter out every animal name that is not proper, we would write a <span>filter</span><a id="id326400770" class="indexterm"></a> function:</p><pre class="programlisting">
function IsProperName(name)
  if a:name =~? '\(Mr\|Miss\) .\+'
    return 1
  endif
  return 0
endfunction
</pre><p><code class="literal">IsProperName</code> will return 1 (true) if the name starts with <code class="literal">Mr</code> or <code class="literal">Miss</code> (which is, as we know, a proper form to address an animal), and 0 (false) otherwise.</p><p>Now, given the following dictionary:</p><pre class="programlisting">let animal_names = {
  \ 'cat': 'Miss Cattington',
  \ 'dog': 'Mr Dogson',
  \ 'parrot': 'Polly'
  \ }
</pre><p>We will write a filter function that will only leave key or value pairs with proper names:</p><pre class="programlisting">call filter(animal_names, 'IsProperName(v:val)')</pre><p> </p><p>And we'll do this to see that it worked:</p><pre class="programlisting"><span class="strong"><strong>:echo animal_names
{'cat': 'Miss Cattington', 'dog': 'Mr Dogson'}
</strong></span></pre><p>If you're coming from other programming languages, this syntax probably feels somewhat awkward. The second argument to the filter function is a string, which gets evaluated for every key value pair of the dictionary. Here, <code class="literal">v:val</code> will get expanded to the dictionary value (while <code class="literal">v:key</code> could be used to access the key).</p><p>The second argument to filter can also be a function reference. Vim lets you reference a function like this:</p><pre class="programlisting">let IsProperName2 = function('IsProperName')
</pre><p>Now, you can call <code class="literal">IsProperName2</code> just like you would <code class="literal">IsProperName</code>:</p><pre class="programlisting"><span class="strong"><strong>:echo IsProperName2('Mr Dogson')
1
</strong></span></pre><p>This can be used to pass functions around as arguments to any function:</p><pre class="programlisting">function FunctionCaller(func, arg)
  return a:func(a:arg)
endfunction
</pre><p>Try running it:</p><pre class="programlisting"><span class="strong"><strong>:echo FunctionCaller(IsProperName2, 'Miss Catington')</strong></span>
<span class="strong"><strong>1</strong></span></pre><p>Armed with this knowledge, we can also pass a function reference as a second argument to the filter function. However, if we decide to pass a function reference, we have to change our original function to take two arguments: the key and the value for the dictionary (in that order):</p><pre class="programlisting">function IsProperNameKeyValue(key, value)
  if a:value =~? '\(Mr\|Miss\) .\+'
    return 1
  endif
  return 0
endfunction</pre><p>Now, we can execute the <code class="literal">filter</code> function as follows:</p><pre class="programlisting">call filter(animal_names, function('IsProperNameKeyValue'))</pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><p>And to validate that it works, let's <code class="literal">echo</code> the <code class="literal">animal_names</code> dictionary:</p><pre class="programlisting"><span class="strong"><strong>:echo animal_names</strong></span>
<span class="strong"><strong>{'cat': 'Miss Cattington', 'dog': 'Mr Dogson'}</strong></span></pre><p>When operating on lists, <code class="literal">v:key</code> refers to a item index, and <code class="literal">v:val</code> refers to the item value.</p><p>The <code class="literal">map</code> function behaves in a similar manner. It lets you modify each list item or dictionary value.</p><p>For example, let's make every name <span class="emphasis"><em>proper</em></span> in the following list:</p><pre class="programlisting">let animal_names = ['Miss Cattington', 'Mr Dogson', 'Polly', 'Meowtington']</pre><p>In this exercise, we'll reuse the <code class="literal">IsProperName</code> function from the earlier example.</p><p>Lambdas come in especially useful with this type of function. Here's how we prefix 'Miss ' to a name if it's not proper:</p><pre class="programlisting">call map(animal_names,
\ {key, val -&gt; IsProperName(val) ? val : 'Miss ' . val})</pre><p>Verify the results are as expected:</p><pre class="programlisting"><span class="strong"><strong>:echo animal_names</strong></span>
<span class="strong"><strong>['Miss Cattington', 'Mr Dogson', 'Miss Polly, 'Miss Meowtington']</strong></span></pre><p>This Lambda is the equivalent of the following:</p><pre class="programlisting">function MakeProperName(name)
  if IsProperName(a:name)
    return a:name
  endif
  return 'Miss ' . a:name
endfunction
call map(animal_names, 'MakeProperName(v:val)')</pre><p>The map function can be called with a <span>function</span><a id="id326481888" class="indexterm"></a> reference the same way a <span>filter</span><a id="id326481894" class="indexterm"></a> is. The mapping function will still take two values (key and value for dictionaries, and index and value for lists).</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec75"></a>Interacting with Vim</h3></div></div></div><p>The <code class="literal">execute</code> command lets you parse <span>and</span><a id="id326481914" class="indexterm"></a> execute a string as a Vim command. For example, the two following statements will produce equivalent results:</p><pre class="programlisting">echo animal . ' says hello'
execute 'echo ' . animal . ' says hello'</pre><p>You can use <code class="literal">normal</code> to execute keys just like the user would in normal mode. For instance, if you wanted to search for a word <code class="literal">cat</code> and delete it, you could do this:</p><pre class="programlisting">normal /cat&lt;cr&gt;dw</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note135"></a>Note</h3><p><code class="literal">&lt;cr&gt;</code> here needs to be typed with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>v</em></span>, followed by the <span class="emphasis"><em>Enter</em></span> key. However, <code class="literal">execute "normal /cat&lt;cr&gt;dw"</code> would use the literal string <code class="literal">&lt;cr&gt;</code> to represent <span class="emphasis"><em>Enter</em></span> key press. Just a quirk to be aware of.</p></div><p>Running normal like this will respect the user's mappings, so if you want to ignore custom mappings, you could use <code class="literal">normal!</code>:</p><pre class="programlisting">normal! /cat&lt;cr&gt;dw</pre><p>Another command can suppress output from other commands (such as <code class="literal">execute</code>): <code class="literal">silent</code>. Neither of these will produce any output:</p><pre class="programlisting">silent echo animal . ' says hello'
silent execute 'echo ' . animal . ' says hello'</pre><p>Furthermore, <code class="literal">silent</code> can suppress the output from external commands and ignore prompts:</p><pre class="programlisting">silent !echo 'this is running in a shell'</pre><p>You can also check if the Vim you're running in has a particular feature enabled:</p><pre class="programlisting">if has('python3')
  echom 'Your Vim was compiled with Python 3 support!'
endif</pre><p>You can view the full list of features via <code class="literal">:help feature-list</code>, but something worth noting is OS indicators: <code class="literal">win32</code>/<code class="literal">win64</code>, <code class="literal">darwin</code> (macOS), or <code class="literal">unix</code>. These are extremely helpful if you're planning to build a cross-platform script.</p><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec76"></a>File-related commands</h3></div></div></div><p>Since Vim is a text editor, much of <span>what</span><a id="id326482278" class="indexterm"></a> you do operates on files. Vim provides a number of file-related functions.</p><p>You can manipulate file path information using expand:</p><pre class="programlisting">echom 'Current file extension is ' . expand('%:e')</pre><p>When passed a filename (through <code class="literal">%</code>, <code class="literal">#</code>, or shortcuts such as <code class="literal">&lt;cfile&gt;</code>), expand lets you parse the path using these modifiers:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">:p</code> expand to full path</li><li style="list-style-type: disc"><code class="literal">:h</code> head (last path component removed)</li><li style="list-style-type: disc"><code class="literal">:t</code> tail (last path component only)</li><li style="list-style-type: disc"><code class="literal">:r</code> root (one extension removed)</li><li style="list-style-type: disc"><code class="literal">:e</code> extension only</li></ul></div><p>See <code class="literal">:help expand()</code> for more information about these.</p><p>You can check the file exists (aka can be read) by using <code class="literal">filereadable</code>:</p><pre class="programlisting">if filereadable(expand('%'))
  echom 'Current file (' . expand('%:t') . ') is readable!'
endif</pre><p>When executed from <code class="literal">files.vim</code>, the output would be:</p><pre class="programlisting">Current file (files.vim) is readable!</pre><p>Similarly, you can check you have write permissions to the file using <code class="literal">filewritable</code>.</p><p>You can perform the rest of the file operations using the <code class="literal">execute</code> command. For example, you'd write the following to open the <code class="literal">animals.py</code> file:</p><pre class="programlisting">execute 'edit animals.py'</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec77"></a>Prompts</h3></div></div></div><p>There are two primary ways to <span>prompt</span><a id="id326482445" class="indexterm"></a> the user for input. You can either use <code class="literal">confirm</code> to display a multiple choice dialog (such as <strong class="userinput"><code>yes/no/cancel</code></strong>), or <code class="literal">input</code> to process a more complex input.</p><p> </p><p>The <code class="literal">confirm</code> function prompts the user with a dialog and a multiple answers a user can select from. Let's try a simple example:</p><pre class="programlisting">let answer = confirm('Is cat your favorite animal?', "&amp;yes\n&amp;no")
echo answer</pre><p>If you execute the script, you'll get the following prompt:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/382d7202-39cc-4249-afb1-8b00b5e87552.png" /></div><p> </p><p>Hitting <code class="literal">y</code> or <code class="literal">n</code> will select an option. Let's hit <code class="literal">y</code>:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/feee6307-8877-4fa3-9024-0c5763331b6e.png" /></div><p>The result of this is <span class="strong"><strong>1</strong></span>. Now, what if we replay it and choose <code class="literal">no</code>?</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/deeb9076-0ff4-40d7-ae49-c64d1785dce6.png" /></div><p>We get a <span class="strong"><strong>2</strong></span>. As you can see, <code class="literal">confirm</code> returns an integer with the number of the selected choice.</p><p> </p><p>Oh, and if you're running from a GUI, you'll get a dialog window pop up:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/04337237-db23-4073-a60b-5538df30e343.png" /></div><p>Now, let's get back to our original example:</p><pre class="programlisting">let answer = confirm('Is cat your favorite animal?', "&amp;yes\n&amp;no")
echo answer</pre><p>Here, you can see that confirm takes two arguments: a <span>prompt</span><a id="id326529674" class="indexterm"></a> to be displayed, and a newline-separated (<code class="literal">\n</code>) list of options to select from. In the previous example, an option string is non-literal, since we want the newlines to be processed.</p><p>A set of ampersand <code class="literal">&amp;</code> symbols are used to denote the letters representing each option (in the previous example, <code class="literal">y</code> and <code class="literal">n</code> become the available options). Here's another example:</p><pre class="programlisting">let answer = confirm(
  \ 'Is cat your favorite animal?', "absolutely &amp;yes\nhell &amp;no")</pre><p>This would display the following prompt:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/9d51ae54-1bcf-4f00-b093-a94679e7344c.png" /></div><p>Note that <code class="literal">y</code> and <code class="literal">n</code> are still the letters a user can press to reply to the prompt.</p><p>Lastly, input lets you work with free-form text input. Its use is fairly straightforward:</p><pre class="programlisting">let animal = input('What is your favorite animal? ')
echo "\n"
echo 'What a coincidence! My favorite animal is a ' . animal . ' too!'</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note136"></a>Note</h3><p><code class="literal">echo "\n"</code> prints a newline, as otherwise <code class="literal">cat</code> and <code class="literal">What a coincidence!</code> will not be separated by a newline.</p></div><p>And this is how the prompt looks when executed:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/7016901c-fba0-4d59-82fe-b7b0cf8368ea.png" /></div><p> </p><p>And this is what it looks like after we enter our string:</p><div class="mediaobject"><img src="/graphics/9781789341096/graphics/3d374488-ec9e-4605-96c8-29387f5bcb94.png" /></div><p>However, a word of warning. If you're using input from <span>inside</span><a id="id326530081" class="indexterm"></a> a mapping, you must prefix it with <code class="literal">inputsave()</code> and follow it with <code class="literal">inputrestore()</code>. Otherwise, the rest of the characters in a mapping will be consumed into input. In fact, you should always use <code class="literal">inputsave()</code> and <code class="literal">inputrestore()</code> in case your function is ever used in a mapping. Here's an example of how to use them:</p><pre class="programlisting">function AskAnimalName()
  call inputsave()
  let name = input('What is the animal"'s name? ')
  call inputrestore()
  return name
endfunction

nnoremap &lt;leader&gt;a = :let name = AskAnimalName()&lt;cr&gt;:echo name&lt;cr&gt;</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec78"></a>Using :help</h3></div></div></div><p>Most of the information about <span>Vimscript</span><a id="id326530113" class="indexterm"></a> is in Vim's <code class="literal">eval.txt</code>, which you can access by searching <code class="literal">:help eval</code>. Give it a read if you're ever feeling stuck.</p></div></div>