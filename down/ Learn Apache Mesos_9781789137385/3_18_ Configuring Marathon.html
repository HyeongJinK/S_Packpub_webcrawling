<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec23"></a>Configuring Marathon</h2></div></div><hr /></div><p>To configure Marathon, first, we need to stop the <span>Marathon</span><a id="id325245074" class="indexterm"></a> service running on marathon1. Once this is done, we can then proceed with the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to <code class="literal">systemd</code> directory with the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd /etc/systemd/system/multi-user.target.wants/</strong></span></pre><p> </p><p> </p><p> </p><p>Here, you will see the Marathon service. Type <code class="literal">sudo vi marathon.service</code> and you will see that we have added one server for our development environment, but here we need to add two more servers so that Marathon can connect with the mesos-master and deploy the applications. By adding a master configuration, our Marathon will get registered in the <code class="literal">mesos-master</code> cluster. So, let's go ahead and add two more servers in this configuration in the following steps.</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Make the following changes in the file that we opened in the previous step:</li></ol></div><pre class="programlisting">ExecStart=/usr/share/marathon/bin/marathon --master zk://10.0.1.42:2181,10.0.1.203:2181,10.0.2.68:2181/mesos --zk://10.0.1.42:2181,10.0.1.203:2181,10.0.2.68:2181/marathon --hostname=10.0.1.191</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Run the system <code class="literal">daemon-reload</code> command and start the Marathon service, as follows:</li></ol></div><pre class="programlisting"><span class="strong"><strong>sudo systemct1 daemon-reload</strong></span>
<span class="strong"><strong>sudo service marathon start</strong></span>
<span class="strong"><strong>sudo service marathon status</strong></span></pre><p>Wait until it gets started. You will see the following once its starts:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/f33dd79f-e471-41fc-86a6-667b84ce63dc.png" /></div><p>Then, repeat the same for marathon2.</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Check the Marathon web console: in any browser, open two tabs and type <code class="literal">marathon1:8080</code> and <code class="literal">marathon2:8080</code> into the address bar of the respective tabs, then press <span class="emphasis"><em>Enter</em></span>.</li></ol></div><p>This indicates that the Marathon service is up and running:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/82d41a83-024b-40e9-90f8-f55b02cc359d.png" /></div><p>Look back to the Mesos console, and in the framework, you should see <span>marathon</span><a id="id325490090" class="indexterm"></a>1 listed:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/ca516426-51b1-4808-80a4-c70d2db9530d.png" /></div><p>But why are we not seeing marathon2 here? You are never going to see two marathons running together. To make this clearer, let's look at what high availability and resilience are.</p><p> </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec13"></a>High availability and resilience</h3></div></div></div><p>This is a desirable <span>Marathon</span><a id="id325490121" class="indexterm"></a> feature: when one of the Marathon servers stop, another <span>Marathon</span><a id="id325490195" class="indexterm"></a> server takes over and makes up for the loss to keep the processes running. </p><p>To see the magic happen, you will first need to stop the marathon1 service—we have covered how to stop a service previously in this chapter while configuring the mesos-master. Once this is done, go to the Mesos console, and check the difference.</p><p>Hence, we have now seen how components support each other in an architecture.</p></div></div>