<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec22"></a>Configuring the mesos-master servers</h2></div></div><hr /></div><p>After installation, configuration is a particularly <span>important</span><a id="id325245083" class="indexterm"></a> step, as it forms the basis of the whole Mesos environment.</p><p>Following are the steps to follow to configure the mesos-master:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, let's set up connection information for ZooKeeper with these commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd /etc/mesos</strong></span>
<span class="strong"><strong>ls -rlt</strong></span>
<span class="strong"><strong>cat zk</strong></span></pre><p>In the development environment, we had only added one mesos-master. We now need more master services, so let's add them. First, open the following file:</p><pre class="programlisting"><span class="strong"><strong>sudo vi zk</strong></span></pre><p>Now, edit the file by deleting the current entry, and inserting <code class="literal">zk://10.0.1.42:2181,10.0..1.203,10.0.2.68:2181/mesos</code>. So, basically, we have added the IP addresses of all three servers, followed by their active ports.</p><p>Save your changes and exit the file using <code class="literal">:wq!</code>. Repeat this step for all other master servers.</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Next, let's perform our ZooKeeper configuration for the master servers. In the following steps, we will first map the unique ID on all the master servers for ZooKeeper. Then, we will define those unique IDs into <code class="literal">.cfg</code>, which is going to map unique IDs to actual hosts.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Define a unique ID for master1:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd var/lib/zookeeper/</strong></span>
<span class="strong"><strong>cat myid</strong></span>
<span class="strong"><strong>//define it as 1, followed by 2 and 3 for all masters.</strong></span></pre><p>Repeat this for all master servers.</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Map the unique IDs as follows:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd /etc/zookeeper/conf</strong></span>
<span class="strong"><strong>sudo vi zoo.cfg</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Insert the following addresses:</li></ol></div><pre class="programlisting"><span class="strong"><strong>Server.1 10.0.1.42:2888:3888</strong></span>
<span class="strong"><strong>Server.2 10.0.1.203:2888:3888</strong></span>
<span class="strong"><strong>Server.3 10.0.2.68:2888:3888</strong></span></pre><p>As evident, we have the unique IDs of the servers, followed by their IP addresses, and the two ports. The first port will be used for communicating with the leader, and the second one will be used to elect the leader.</p><p>Make these additions on all the master servers.</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Set up <code class="literal">quorum</code>, which decides how many servers need to run at a time:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cd /etc/mesos-master/</strong></span>
<span class="strong"><strong>cat quorum</strong></span>
<span class="strong"><strong>//You will see a default value as 1, we will change this to 2</strong></span>
<span class="strong"><strong>sudo vi quorum</strong></span>
<span class="strong"><strong>//edit the value as 2, save and exit using :wq!</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Now, check the IP, hostname, and cluster file as follows:</li></ol></div><pre class="programlisting"><span class="strong"><strong>cat ip</strong></span>
<span class="strong"><strong>//you will see an ip address</strong></span>
<span class="strong"><strong>cat hostname</strong></span>
<span class="strong"><strong>// and the defined hostnames</strong></span>
<span class="strong"><strong>sudo touch cluster</strong></span>
<span class="strong"><strong>sudo vi cluster</strong></span>
<span class="strong"><strong>//Insert the name as tetra</strong></span>
<span class="strong"><strong>cat cluster</strong></span>
<span class="strong"><strong>//you will see the cluster name as tetra</strong></span></pre><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>All three files must be present on all the master servers. Validate this using the following command:</li></ol></div><pre class="programlisting"><span class="strong"><strong>sudo vi /etc/hosts</strong></span>
<span class="strong"><strong>//you will see all the hosts listed that will be communicating with each other internally</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Now, restart all the services:</li></ol></div><pre class="programlisting"><span class="strong"><strong>sudo service zookeeper stop</strong></span>
<span class="strong"><strong>sudo service mesos-master stop</strong></span>
<span class="strong"><strong>ps -ef |grep mesos //No mesos service will be running</strong></span>
<span class="strong"><strong>sudo service zookeeper start</strong></span>
<span class="strong"><strong>sudo service zookeeper status</strong></span>
<span class="strong"><strong>sudo service mesos-master start</strong></span>
<span class="strong"><strong>sudo service mesos-master status // to view the status in more detail,append -l</strong></span>
<span class="strong"><strong>//Repeat the same for all the servers</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Now, let's start the <code class="literal">mesos-master</code> services using the following commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>sudo service mesos-master start</strong></span>
<span class="strong"><strong>sudo service mesos-master status</strong></span></pre><p>You can see that a new master has become a candidate for leadership:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/bf6e0034-a4b9-4f8a-9be1-4c09df7643e2.png" /></div><p> </p><p> </p><p>When any of the servers go down, the ZooKeeper elects a new master for leadership.</p><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li> Now, let's access our configuration through the Mesos web page:</li></ol></div><p>Hopefully, you have defined your DNS <span>name</span><a id="id325245444" class="indexterm"></a> in hostentries. Let's check if it is running—in the address bar, type <code class="literal">mesos:5050</code>:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/c73538ba-174b-4a60-9cdf-2132d17072e4.png" /></div><p>As evident, the elected server is master1 and cluster name is tetra. Carry out checks in the same manner for master2 and master3.</p><p>Now, let's experiment a little! Let's stop the master1 server and observe the result in the following steps.</p><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>We have covered how to stop the <code class="literal">mesos-master</code> service previously in this section. Perform the necessary steps on master1 and you will get the <code class="literal">mesos-master2:5050</code> as <strong class="userinput"><code>Leader.</code></strong></li></ol></div><p>You can now see that in the absence of the earlier elected leader, the ZooKeeper <span>elected</span><a id="id325245524" class="indexterm"></a> another running server as leader.</p><p>We have now extended our development environment to our host environment. Next, let's move on to configuring Marathon.</p></div>