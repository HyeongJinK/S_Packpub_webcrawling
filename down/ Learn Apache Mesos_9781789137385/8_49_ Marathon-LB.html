<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec49"></a>Marathon-LB</h2></div></div><hr /></div><p>Marathon-LB is a tool for managing HAProxy that <span>works</span><a id="id325475175" class="indexterm"></a> by consuming Marathon's app state. HAProxy is a fast, efficient, battle-tested, highly available load balancer with many advanced <span>features</span><a id="id325482947" class="indexterm"></a> that power a number of high-profile websites. Marathon-LB provides a Python script that performs zero-downtime applications deployments. It helps you to safely deploy applications serving live traffic by creating two versions of an application: blue and green.</p><p>Â </p><p>Let's see how it is done:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To perform an application update, the green version is deployed, while all customer requests are sent to the blue version.</li><li>Once the green version is deployed and healthy, the load balancer can start draining connections from the blue version and instead sends customer requests to the green version.</li><li>The blue version of the application can be deleted once all customer requests are being directed to the green version.</li></ol></div><p>So, let's understand the overall procedure as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>The Marathon-LB script <code class="literal">marathon_lb.py</code> connects to the Marathon API to retrieve all running apps, then generates a HAProxy config file, and finally, reloads HAProxy.</li><li>Here, if you add one or more hosts in your application, you don't have to restart your load balancer. HAProxy will automatically generate the config and reload HAProxy, which will make your new host available to serve the traffic.</li><li>By default, Marathon-LB binds to the <span>service</span><a id="id325485790" class="indexterm"></a> port of every application and sends incoming requests to the application instances.</li><li>Services are exposed on the service port, as defined in their Marathon definition. Apps are only exposed on LBs that have the same LB tag (or group) as defined in the Marathon app's labels (using <code class="literal">HAPROXY_GROUP</code>).</li></ol></div></div>