<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec46"></a>Configuring Marathon</h2></div></div><hr /></div><p>Marathon is a control <span>system</span><a id="id325092054" class="indexterm"></a> that can be used in Docker or in cgroups containers, and is cluster wide. It is a framework for Apache Mesos that helps you <span>manage</span><a id="id325092064" class="indexterm"></a> tasks through RESTful APIs.</p><p>Let's go back to the Marathon tab and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Add a secret to the <code class="literal">marathon</code> file:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ cd /etc/marathon</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Go inside <code class="literal">/etc/default</code> and:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo touch mesos_authentication_secret 
$ sudo vi mesos </strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Insert <code class="literal">marathon1_secret</code>, save the file, and exit using <code class="literal">:wq!</code></li><li>Inform Marathon about the location of the credential file in the <strong class="userinput"><code>marathon1</code></strong> tab:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo mkdir conf 
$ sudo cd conf 
$ sudo touch mesos_authentication_secret_file 
$ ll /etc/default/mesos 
$ ll /etc/default/mesos_authentication_secret </strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>You will get a path, <code class="literal">/etc/default/mesos_authentication_secret</code>. Copy this path.</li><li>Go to the <code class="literal">conf</code> directory:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ cd conf/  
$ sudo vi authentication_secret_file</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Paste the path that you copied. Save and exit using <code class="literal">:wq!</code>.</li><li>Restart Marathon and check whether you are able to view the configuration in process:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo service marathon stop</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Check the status:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo service marathon status 
$ sudo service marathon status -l</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>You <span>should</span><a id="id325092514" class="indexterm"></a> see the following:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/e06c37f4-e592-4641-a935-ec9ab27a3748.png" /></div><p>As you can see, we are not able to view the Marathon service that we configured, so we will have to explicitly specify it. To do this, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Visit <code class="literal">marathon.service</code> and specify what we need:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ ps -ef |grep marathon</strong></span></pre><p>You <span>should</span><a id="id325092552" class="indexterm"></a> see the following:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/98c00cc5-d69c-4c4a-ac09-4d44d97fe451.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Remember how we configured this? We will repeat the same thing here:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ history |grep marathon.service</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>The following is what you should see on your screen:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/b0bc5cad-e7a6-4e72-97fb-14d5efca0e60.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Go into the <span>system</span><a id="id325092610" class="indexterm"></a> and edit the <code class="literal">marathon.service</code> file:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo vi /etc/systemd/system/multi-0user.target.wants/marathon.service</strong></span></pre><p> </p><p> </p><p> </p><p> </p><p>You will see a file that we will edit:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/00b40890-2538-4c7a-9c9c-240602a6dbe8.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Beside <code class="literal">e=marathon</code>, type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>--mesos_authentication_secret_file=/etc/default/mesos_authentication_secret  </strong></span></pre><p>Save and exit using <code class="literal">:wq!</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Type <code class="literal">$ sudo service marathon stop</code>, and you should see the following:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/b8baf80a-17ec-4a92-b25b-115961e7824c.png" /></div><p> </p><p>As you can see, we first need to run the <code class="literal">systemct1</code> daemon reload once we change the service file. Hence, <code class="literal">$ systemct1 daemon-reload</code>, <code class="literal">$ sudo service marathon stop</code>, and <code class="literal">$ sudo service marathon start</code>. Now check the status:</p><pre class="programlisting"><span class="strong"><strong>$ sudo service marathon status -l</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Hence, we can see that we have <span>successfully</span><a id="id325092763" class="indexterm"></a> enabled our secret file:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/4299fba3-c241-40be-8b05-a8ee757dff60.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Also, you can see all services running:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/061cc68e-c6c7-4f7f-a726-8e477805f9f6.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Go to the <strong class="userinput"><code>slave1</code></strong> tab and <span>restart</span><a id="id325092840" class="indexterm"></a> the agent:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo vi credential</strong></span>
<span class="strong"><strong>$ sudo service mesos-slave restart</strong></span>
<span class="strong"><strong>$ sudo service mesos-slave status</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Check the status of the slave that we restarted:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo service mesos-slave status</strong></span></pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>If it shows failure, check the log:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ cd /var/log/mesos</strong></span></pre><p>You will see something such as follows:</p><div class="mediaobject"><img src="/graphics/9781789137385/graphics/dc94cd6d-a5f4-4bf1-80f8-d6223eac7ac1.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>Copy the latest log and open that file <span>using</span><a id="id325092919" class="indexterm"></a> the <code class="literal">vi</code> command. You may get the following listing on the file:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/e1060249-b367-4851-8610-9aa5d089f55b.png" /></div><p>You can see in the preceding screenshot that we have an authentication error. Hence, let's first stop all the slaves by typing <code class="literal">$ sudo service mesos-slave stop</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>Restart the master by going on the <strong class="userinput"><code>mesos</code></strong> tab:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo service mesos-master restart</strong></span></pre><p>Do this for all the masters. Check the status of the masters:</p><pre class="programlisting"><span class="strong"><strong>$ sudo service mesos-master status -l</strong></span></pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="14" type="1"><li>You should see the <span>master</span><a id="id325093019" class="indexterm"></a> in an active running state:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/afd695bd-7609-4b22-8e49-f9accba9b9a8.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="15" type="1"><li>Similarly, check all the masters. Even if we have two masters running, it will be enough for us to perform ahead. Go on the <strong class="userinput"><code>slave</code></strong> tab, restart, and <span>check</span><a id="id325093049" class="indexterm"></a> the status of the service:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo service mesos-slave restart</strong></span>
<span class="strong"><strong>$ sudo service mesos-slave status</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="16" type="1"><li>Repeat this for all the agents.</li></ol></div><p>So, we have now seen that the authentication-refused error was resolved by simply restarting all the masters. This means that if you have not provided any authentication, <code class="literal">mesos-master</code> will refuse all the unknown agents. Now let's set the principal without this, as we won't be able to start the Marathon service.</p><p> </p><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="17" type="1"><li>Go on the <strong class="userinput"><code>Marathon</code></strong> tab and type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ history |grep marathon.service</strong></span>
<span class="strong"><strong>$ sudo vi /etc/systemd/system/multi-user.target.wants/marathon.service</strong></span></pre><p>Beside <code class="literal">e=marathon --mesos_authentication_secret_file=/etc/default/mesos_authentication_secret</code>, insert the following:</p><pre class="programlisting">--mesos_authentication_principal=marathon1 </pre><div class="orderedlist"><ol class="orderedlist arabic" start="18" type="1"><li>Save and exit the file. Restart the server.</li></ol></div><p>We have now seen how to <span>enable</span><a id="id325093166" class="indexterm"></a> authentication using secrets for the agents and the masters. In the next few sections, we will be learning how to enable <span class="strong"><strong>secured socket layer</strong></span> (<span class="strong"><strong>SSL</strong></span>) and <span>secure</span><a id="id325245079" class="indexterm"></a> our Mesos framework.</p></div>