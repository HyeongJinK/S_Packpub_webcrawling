<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec44"></a>Enabling and configuring authentication</h2></div></div><hr /></div><p>Before anything else, we need to <span>enable</span><a id="id325489795" class="indexterm"></a> authentication, and for <span>doing</span><a id="id325489804" class="indexterm"></a> this, we need to define which authentication mechanism we want to use. Here, we will be using CRAM-MD5 because it is built into Mesos and is a popular authentication algorithm <span>used</span><a id="id325489813" class="indexterm"></a> in <span class="strong"><strong>Simple Mail Transfer Protocol</strong></span> (<span class="strong"><strong>SMTP</strong></span>) and <span class="strong"><strong>Lightweight Directory Access Protocol</strong></span> (<span class="strong"><strong>LDAP</strong></span>).</p><p>We will <span>work</span><a id="id325489838" class="indexterm"></a> on the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Master</strong></span>: This will enable the <span>authentication</span><a id="id325489853" class="indexterm"></a> of frameworks and agents.</li><li style="list-style-type: disc"><span class="strong"><strong>Agent</strong></span>: We will create a file with the agent's <span>secrets</span><a id="id325489867" class="indexterm"></a> and this file will be used to authenticate the master.</li><li style="list-style-type: disc"><span class="strong"><strong>Marathon</strong></span>: This accepts credentials in a different manner to Mesos. Instead of storing everything in one file, only <span>secrets</span><a id="id325489882" class="indexterm"></a> are stored in the file. We can pass this principal using the command-line flag.</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec30"></a>Enabling authentication</h3></div></div></div><p>We will enable authentication and <span>frameworks</span><a id="id325489897" class="indexterm"></a> by setting <code class="literal">authenticate_frameworks=true</code> and <code class="literal">authenticate_agents=true</code>. To do this, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Authenticate the agents and framework:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$  cd /etc/mesos-master 
$ sudo touch authenticate_frameworks 
$ sudo touch authenticate_agents</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Create the files:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ Sudo vi authenticate_frameworks</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>You should see the following on your screen:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789137385/graphics/246f3c01-0925-4a3c-8063-01a2e2160944.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Insert <code class="literal">true</code>, and exit the file with <code class="literal">:wq!</code></li></ol></div><p>Repeat these steps for all master servers. We have now <span>enabled</span><a id="id325092083" class="indexterm"></a> the authentication by setting frameworks and agents as true in all the master servers.</p><p> </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec31"></a>Choosing authenticators</h3></div></div></div><p>We have chosen our <span>authenticator</span><a id="id325092104" class="indexterm"></a> as CRAM-MD5; it is a widely-used algorithm in authentication, and is also a built-in algorithm in Mesos. The following steps show how can this be chosen using the command-line:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Choose the authenticator as CRAM-MD5 by running the following commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo touch authenticators 
$ sudo vi authenticators</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Insert <code class="literal">crammd5</code> and exit with <code class="literal">:wq!</code></li></ol></div><p>Repeat the preceding steps for all the Moses master servers.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec32"></a>Creating a file with a principal secret</h3></div></div></div><p>The secrets provided will be <span>used</span><a id="id325092150" class="indexterm"></a> in authentication. The current information will be checked against this principal secret file to give authentication.</p><p>For creating a secret, let's follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a configuration directory:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo mkdir conf</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>In <code class="literal">conf</code> directory, create a file, <code class="literal">credentials.json</code>:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo vi credentials.json</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Add the following code to <code class="literal">credentials.json</code> file:</li></ol></div><pre class="programlisting">{ 
         "credentials": 
         [ 
               { 
                     "principal": "marathon", 
                     "secret": "marathon1_secret" 
               }, 
               { 
                     "principal":"agent", 
                     "secret":"agents_secret" 
               } 
         ] 
} </pre><p>Save the file using <code class="literal">:wq!</code>, and then exit. Repeat these steps on all three master servers.</p><p>Credential files, as their name suggests, should be <span>given</span><a id="id325092291" class="indexterm"></a> minimum access, so let's change the permission of our credential file:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>mesos</code></strong> tab, key in the following commands:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo chmod 600 /etc/mesos-master/conf/credentials.json</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Go to the master's tabs, insert the same command, and type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ ls -rlt</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Try appending the following into the <code class="literal">credentials.json</code> file:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo cat credentials.json</strong></span></pre><p>You should see the contents of the file, but you won't be able to add anything. Hence our <code class="literal">credential.json</code> file is now secured with the <code class="literal">600</code> permission.</p><p>We will need to let the master know about the location of the credential file. We will do this by running some commands in the <strong class="userinput"><code>mesos</code></strong> tab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Return to the <code class="literal">mesos-master</code> directory and type the following:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo touch credentials 
$ sudo vi credentials </strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Insert <code class="literal">/etc/mesos-master/conf/credentials.json</code>, save, and exit.</li><li>Repeat the preceding steps for all the master servers.</li><li>Let's not keep the credential file in <code class="literal">conf</code> directory. Instead, let's place it in the <code class="literal">/etc/mesos/master</code> directory. Key in the following for all the master servers:</li></ol></div><pre class="programlisting"><span class="strong"><strong>$ sudo mv credentials /etc/mesos-master/ 
</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Copy the <code class="literal">/etc/mesos master/conf/credentials.json</code> path and place it in the file of the credential for each master.</li></ol></div><p>We have now <span>informed</span><a id="id325092530" class="indexterm"></a> the master about the location of the credential file.</p><p> </p><p> </p></div></div>