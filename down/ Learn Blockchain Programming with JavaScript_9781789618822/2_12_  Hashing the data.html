<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec18"></a> Hashing the data</h2></div></div><hr /></div><p>The next method that we are <span>going</span><a id="id325268059" class="indexterm"></a> to look at and add into our blockchain data structure is called <code class="literal">hashBlock</code>. What this <code class="literal">hashBlock</code> method will do is take in a block from our blockchain and hash its data into a fixed length string. This hashed data will appear randomly.</p><p>In essence, what we're going to do is pass some blocks of data into this hash method, and in return we'll get a fixed-length string, which will simply be a hash data that is generated from the data that we passed in or from the block that we passed.  </p><p>To add the <code class="literal">hashBlock</code> method to our blockchain data structure, type the following line of code after our <code class="literal">createNewTransaction</code> method: </p><pre class="programlisting">Blockchain.prototype.hashBlock = function(blockdata) {

}</pre><p>In our <code class="literal">hashBlock</code> method, <code class="literal">blockdata</code> will be the input data of our block from which we want to generate the hash.  </p><p>So, how can we take a block or blocks of data and get a hashed string in return? For generating hash data, we're going to use a hashing function called<span class="strong"><strong>SHA256</strong></span>. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec8"></a>Understanding the SHA256 hashing function</h3></div></div></div><p>The <span class="strong"><strong>SHA256</strong></span> hashing function <span>takes</span><a id="id325683641" class="indexterm"></a> in any string of text, hashes that text, and returns a fixed-length hashed string.</p><p>To get a better understanding of what hash data looks like, visit <a class="ulink" href="https://passwordsgenerator.net/sha256-hash-generator/" target="_blank">https://passwordsgenerator.net/sha256-hash-generator/</a>. This is a hash generator. If you input any text into the text box, you will get hash data as the output.</p><p>For example, if we put <code class="literal">CodingJavaScript</code> into the textbox, the hash that is returned to us will look like the one highlighted in the following screenshot: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/e5ac2402-abb7-40b0-b466-b9ea45286f21.png" /></div><p>The output hash that we can observe in the preceding screenshot seems arbitrary, and thus helps in keeping the data safe. This is one of the reasons why SHA256 hashing is so secure. </p><p>Now, if we add another character to our input string or if we change our input string in any way, the entire output hash will change completely. For example, if we add an exclamation mark at the end of our input string, the output hash will entirely change. You can observe that in the following screenshot: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/18347e2e-807d-459e-9d81-741bd81f1701.png" /></div><p>You can try experimenting by adding new characters at the end of the input string. You'll observe that as we add more or remove the characters, the entire output hash will change drastically every time, thus generating the new random patterns. </p><p>One other thing that you may want to observe related to SHA256 hashing is that with any given input, the output will always be the same. For example, for our input string, <code class="literal">codingJavaScript!</code>, you will always get the same hash output that was shown in the previous screenshot. This is another very important feature of SHA256 hashing. With any given input, the output or the hash that is returned from that input will always be the same.</p><p>So, this is how SHA256 hashing works. In the <span>next</span><a id="id325690803" class="indexterm"></a> section, we'll implement the SHA256 hashing function inside of our <code class="literal">hashBlock</code> method.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec9"></a>The hashBlock method</h3></div></div></div><p>Let's build up our <code class="literal">hashBlock</code> method. Inside of <span>this</span><a id="id325693383" class="indexterm"></a> method, we want to use SHA256 hashing to hash our block data. Follow the below mentioned steps: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To use an SHA256 hashing function, import it as an npm library. To do that, go to Google and type SHA256 into the search bar, or visit <a class="ulink" href="https://www.npmjs.com/package/sha256" target="_blank">https://www.npmjs.com/package/sha256</a>. On this website, you will get to see the command that we need to type into our terminal to install SHA256. We'll have to type in the following command in our terminal: </li></ol></div><pre class="programlisting"><span class="strong"><strong>npm i sha 256--save</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>After doing this, press <span class="emphasis"><em>Enter</em></span>. The <code class="literal">--save</code>  in the following command will save this library as a dependency for us. Now, inside of our blockchain file structure, you may see that the <code class="literal">node_modules</code> folder has appeared. Inside of this folder is where our SHA256 library and all other dependencies have been downloaded.</li><li>To use this SHA256 library, we will have to import the library to our code so that we can use it. At the very start of our code, type the following line: </li></ol></div><pre class="programlisting">const sha256 = require('sha256');  </pre><p>The preceding line of code specifies that we have an SHA256 hashing function stored as the variable SHA256 in the <code class="literal">blockchain.js</code> file. By importing it, we can use that inside of our <code class="literal">hashBlock</code> method.</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now, the first thing that we want to do in our <code class="literal">hashBlock</code> method is to change the parameters that it takes. We're going replace the <code class="literal">blockData</code> parameter with  <code class="literal">previousBlockHash</code>, <code class="literal">currentBlockData</code>, and <code class="literal">nonce</code>:</li></ol></div><pre class="programlisting">Blockchain.prototype.hashBlock = function(previousBlockHash, currentBlockData, nonce) {

}</pre><p>These three parameters will be the data that we are going to be hashing inside of our <code class="literal">hashBlock</code> method. All of this data will come from a single block in our chain and we're going to hash this data, which is essentially hashing a block. We are then going to get a hashed string in return.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>The first thing that we want to do is change all of these pieces of data into a single string, so add the following line of code to our <code class="literal">hashBlock</code> method: </li></ol></div><pre class="programlisting">const dataAsString = previousBlockHash + nonce.tostring()+ JSON.stringify( currentBlockData);</pre><p>In the preceding code, <code class="literal">previousBlockHash</code> is already a string. Our nonce is a number, so we're going to change that to a string with <code class="literal">toString</code>. Furthermore, our <code class="literal">currentBlockData</code> is going to be an object, an array of our transactions, or some kind of JSON data. It will either be an array or an object, and <code class="literal">JSON.stringify</code> will simply turn that data (as well as any object or array) into a string. Once this whole line is run, we will simply have all of the data that we passed to be concatenated into a single string.</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, the next thing that we want to do is create our hash, as follows:</li></ol></div><pre class="programlisting">const hash = sha256(dataAsString);</pre><p>This is how we create a hash from our block or all of the block data that we have passed into our function.</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>The last thing that we want to do is <span>simply</span><a id="id325702200" class="indexterm"></a> return the hash, so before we complete this method, add the following:</li></ol></div><pre class="programlisting">return hash;</pre><p>This is how our <code class="literal">hashBlock</code> method will work. In the following section, we will test this method to see if it works perfectly.  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec10"></a>Testing the hashBlock method</h3></div></div></div><p>Let's test our <code class="literal">hashBlock</code> method in the <code class="literal">test.js</code> file. Similar to what we did in the previous sections, in our <code class="literal">test.js</code> file, we should be importing our <span>blockchain</span><a id="id325704626" class="indexterm"></a> data structure, creating a new instance of our blockchain, and naming it <code class="literal">bitcoin</code>. Now, let's test our <code class="literal">hashBlock</code> method:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>For that, type in the following highlighted line of code into our <code class="literal">test.js</code> file:</li></ol></div><pre class="programlisting">const Blockchain = require ('./blockchain'); 
const bitcoin = new Blockchain (); 

<span class="strong"><strong>bitcoin.hashBlock();</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Our <code class="literal">hashBlock</code> method requires three parameters:  a <code class="literal">previousBlockHash</code>, <code class="literal">currentBlockData</code>, and the <code class="literal">nonce</code>. Let's define these variables above the part where we're calling our <code class="literal">hashBlock</code> method. We'll begin by defining the <code class="literal">previousBlockHash</code>:  </li></ol></div><pre class="programlisting">const previousBlockHash = '87765DA6CCF0668238C1D27C35692E11';</pre><p>For now, this random string/hash data will act as input for our <code class="literal">previousBlockHash</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Next, we create the <code class="literal">currentBlockData</code> variable. This <code class="literal">currentBlockData</code> will simply be an array of all of the transactions that will be present in this block. We're simply going to use the transactions in this block as our <code class="literal">currentBlockData</code>, so in this array, we will have to make a couple of transaction objects, as follows: </li></ol></div><pre class="programlisting">const currentBlockData = [
    {
        amount: 10,
        sender: 'B4CEE9C0E5CD571',
        recipient: '3A3F6E462D48E9',  
    }  
]</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Next, duplicate this transaction object at least three times to make a couple more transaction objects in the array and then make modifications to the data as you wish, aiming to change the amount and the sender's and recipient's addresses. This will make our <code class="literal">currentBlockData</code> an array that holds three transactions.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Finally, we have to assign the <code class="literal">nonce</code> value in our <code class="literal">hashBlock</code> method:</li></ol></div><pre class="programlisting">const nonce = 100;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>After defining these variables, we call the <code class="literal">hashBlock</code> method and pass the <code class="literal">previousBlockHash</code> and <code class="literal">currentBlockData</code> parameters, as well as the <code class="literal">nonce</code>:</li></ol></div><pre class="programlisting">bitcoin.hashBlock(previousBlockHash, currentBlockData, nonce );</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Furthermore, let's try to push the results onto the terminal window so that we can observe it. To do this, we'll have to make a tiny modification to our preceding code: </li></ol></div><pre class="programlisting">console.log(bitcoin.hashBlock(previousBlockHash, currentBlockData, nonce));</pre><p>In this test case, we are calling our <code class="literal">hashBlock</code> method with all of the correct parameters. When we run this file, we should get to observe the hash on the terminal window.</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Now save this <code class="literal">test.js</code> file and run it to check whether or not we get the output that we expect it to be. </li><li>Go to your terminal window and type in the <code class="literal">node dev/test.js</code> command, and let's observe what results we get. You will get to observe the <span>similar</span><a id="id326188746" class="indexterm"></a> resulting hash as output of our <code class="literal">hashBlock</code> method as follows: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/2505bc3b-7090-4a1b-8238-78cbae281e4a.png" /></div><p>It looks like our <code class="literal">hashBlock</code> method is working pretty well.</p><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Try to explore this <code class="literal">hashBlock</code> method a little more. As explained in the previous section, if we change some of the data that we are passing into the <code class="literal">hashBlock</code> method, it will result in completely changing the hash that we returned as output.</li><li>Now try to test this feature of hashing data by changing a letter in any of the sender's or recipient's address. Then save the file and run it by using <code class="literal">node dev/test.js</code>again. You will get to observe a totally different hash data as output, as follows: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/6c3ecbd9-5a71-4ff1-8813-b6a0cca593ab.png" /></div><p>In the preceding screenshot, you can observe both the hash data and the differences between them. </p><p>Now, if we revert the change that we made to the sender's or recipient's address and run our hash method again, we'll get to observe the same hash that we originally got. This is because we're passing in the same data that we did the first time around. You can try experimenting with the <span>data</span><a id="id325824174" class="indexterm"></a> and try observing the output to explore the <code class="literal">hashBlock</code> method further. </p><p>After this test, we can thus conclude that our <code class="literal">hashBlock</code> method works perfectly. </p></div></div>