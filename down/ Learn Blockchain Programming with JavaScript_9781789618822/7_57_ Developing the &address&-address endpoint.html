<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec58"></a>Developing the /address/:address endpoint</h2></div></div><hr /></div><p>Now, let's build the <code class="literal">/address/:address</code> endpoint <span>and</span><a id="id325442665" class="indexterm"></a> we'll use the <code class="literal">getAddressData</code> method inside of this endpoint. The <code class="literal">/address/:address</code> endpoint will be very similar to the <code class="literal">/block/:blockHash</code> and <code class="literal">/transaction/:transactionId</code> endpoints, so you shouldn't find it too challenging:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>The first thing that we want to do inside of the endpoint is to store the address in a variable:</li></ol></div><pre class="programlisting">app.get('/address/:address', function(req, res) {
<span class="strong"><strong>const address = req.params.address;</strong></span>
<span class="strong"><strong>});</strong></span></pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The next thing that we want to do is use the <code class="literal">getAddressData</code> method to get all of the data for the given address. In order to do that, we will add the following highlighted code to the endpoint:</li></ol></div><pre class="programlisting">app.get('/address/:address', function(req, res) {
       const address = req.params.address;
<span class="strong"><strong>bitcoin.getAddressData(address);</strong></span>
});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>From this method, we get an object returned to us that has the <code class="literal">addressTransactions</code>and the<code class="literal">addressBalance</code> in it. We want to store this data in a variable as follows:</li></ol></div><pre class="programlisting">app.get('/address/:address', function(req, res) {
       const address = req.params.address;
<span class="strong"><strong>const addressData</strong></span> = bitcoin.getAddressData(address);
});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Then, finally, we want to <span>return</span><a id="id325683634" class="indexterm"></a> the response that contains this data as follows:</li></ol></div><pre class="programlisting">app.get('/address/:address', function(req, res) {
       const address = req.params.address;
       const addressData = bitcoin.getAddressData(address);
<span class="strong"><strong>res.json({</strong></span>
<span class="strong"><strong>                addressData: addressData</strong></span>
<span class="strong"><strong>       });</strong></span>

});</pre><p>This is how we build the <code class="literal">/address/:address</code> endpoint. Now, let's test this endpoint to check that it's working well. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec45"></a>Testing the /address/:address endpoint</h3></div></div></div><p>In order to test the endpoint, we <span>need</span><a id="id325693473" class="indexterm"></a> to add some transaction data to the blockchain, let's follow these steps to do that: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to the browser and explore the blockchain that's present on <code class="literal">localhost:3001</code>. You'll observe that there's only one block present here. So, let's add more transaction data and blocks to it.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>To do this, go to Postman and send the transaction data to <code class="literal">localhost:3001/transaction/broadcast</code>. While creating these transactions, we want to make sure that we keep track of a specific address so that we can check for it when we test the<code class="literal">/address/:address</code>endpoint. In order to keep track of this specific address, let's change the first three letters of one of the addresses to JEN.</li><li>Let's create the first transaction. Set the <code class="literal">"amount":</code>value to<code class="literal">100</code>, and add<code class="literal">JEN</code>to the sender's address for this transaction: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/5a8e93b2-99e6-47db-b570-f5f3ba6a5d18.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Then, click on <strong class="userinput"><code>Send</code></strong> to send the transaction to node <code class="literal">3001</code>. Then, on similar lines, make another transaction for <code class="literal">amount: 200</code> and this time, add <code class="literal">JEN</code> to the recipient's address, and keep the sender's address as a random hash: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/c2d9e630-c68d-44e9-968d-0cb949f6018a.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Now, mine a block to add these <span>transactions</span><a id="id325698449" class="indexterm"></a> to the blockchain. Go to <code class="literal">localhost:3001/mine</code> and mine a new block in the chain as follows:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/0cb1ea9e-0e09-4d73-a984-3f86e4c024d0.png" /></div><p>Similarly, you can make a couple more transactions by changing the amount value and interchanging the sender's and recipient's addresses, with <code class="literal">JEN</code> present in the address. Once a few transactions are created, mine a block to add these new transactions to the blockchain. Then, create new transactions again, and give them different amounts by interchanging the sender's and recipient's addresses. Again, mine a new block to add the transactions to the blockchain. </p><p>You can then explore the whole blockchain, with the new transactions and blocks that we added to it, by going to <code class="literal">localhost:3001/blockchain</code>. You'll be <span>presented</span><a id="id325820496" class="indexterm"></a> with a bunch of blocks and transactions inside the blockchain. </p><p>Now, in order to test the <code class="literal">/address/:address</code> endpoint, let's follow these steps: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Head over to the browser, and hit the <code class="literal">localhost:3001/address/</code>endpoint in a new tab.</li><li>Then, copy one of the addresses from the transactions that we just added to the blockchain and paste it in the endpoint. Take a look at the following screenshot for reference: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/49cb3154-a185-4a8a-8fd9-f46dbb2c8630.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Now, when we run this endpoint, we should see all the transactions associated with that particular address, along with the Bitcoin balance of that particular address. Take a look at the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/10bbb3da-fe36-4295-a881-e8bfb6088a75.png" /></div><p>In the preceding screenshot, we get the <code class="literal">addressData</code> property returned, which consists of the<code class="literal">addressTransactions</code>array and the<code class="literal">addressBalance</code> property. The <code class="literal">addressTransactions</code>array consists of all the transactions associated with the address that we mentioned in the endpoint. In addition, the <code class="literal">addressBalance</code>property <span>consists</span><a id="id326009299" class="indexterm"></a> of the balance of Bitcoins of the address that we mentioned in the endpoint: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/febd708d-b32c-49ec-83cd-8f1b69278469.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Next, you can try to check the balance of the node address by copying the recipient's address of the mining reward transactions and pasting it in the <code class="literal">/address/:address</code> endpoint, as we did for the previous example.</li><li>After running this endpoint, you'll see the balance of mining reward transactions. Try implementing many other similar examples to get a clear understanding of how the <code class="literal">/address/:address</code> endpoint works.</li><li>Another example you can try to implement is to pass an address that doesn't exist in the blockchain. You will get the following response returned: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/ff0b84cb-7308-46b5-881c-80d1f248215e.png" /></div><p> </p><p>From the preceding screenshot, we can observe that the <code class="literal">addressTransactions</code> array is empty, as there are no transactions associated with the nonexistent address that we had as input. Furthermore, the <code class="literal">addressBalance</code> value for the nonexistent address is <code class="literal">0</code>. Consequently, we can <span>conclude</span><a id="id326051349" class="indexterm"></a> from the test that the <code class="literal">/address/:address</code>endpoint is working just as it should. </p></div></div>