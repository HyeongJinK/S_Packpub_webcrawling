<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec45"></a>Testing the new and updated /mine endpoints</h2></div></div><hr /></div><p>Let's test the updated <code class="literal">/mine</code> endpoint and the <code class="literal">/receive-new-block</code> endpoint that we just created. Basically, the <code class="literal">/mine</code> endpoint will mine the new <span>block</span><a id="id325458925" class="indexterm"></a> for us. It will also take that <span>block</span><a id="id325458934" class="indexterm"></a> and broadcast it across the entire blockchain network so that every node is synchronized and all the nodes have the same blocks and the same data. This is the result we expect to observe when we test the <code class="literal">/mine</code> endpoint:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To get started, you should have all five of the nodes running. You should also have connected them together to create a blockchain network. </li><li>Next, go to the browser. The first thing to do here is to choose a node to mine the new block. We have got five nodes to choose from but in our case, we will just stick with the first node. Therefore, type <code class="literal">localhost:3001/mine</code> in the address bar and then hit <span class="emphasis"><em>Enter</em></span>. You will get an output like the following:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/21c8b8fb-775e-4fb1-b1a3-07e41cf21613.png" /></div><p>It looks like the mine endpoint has worked perfectly. The response indicates that the new block has been mined and broadcast successfully. You can also see the new block in the preceding screenshot with its index. </p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Let's verify if the new block has been added to the network. First, verify it on the first node. In the browser, open another tab, type <code class="literal">localhost:3001/blockchain</code> in the address bar, and then press <span class="emphasis"><em>Enter</em></span>. You can see that the new block has been added to the network as follows:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/5eaf8c5f-8882-4410-9274-b7ddb07cf890.png" /></div><p>In the preceding screenshot, you might also notice that there are some transactions present in the <code class="literal">pendingTransactions</code> array.  This pending transaction is actually the mining reward for the block that we just mined. The updated <code class="literal">/mine</code> endpoint defines that the mining reward transaction should be broadcast after a new block is created.</p><p>From now on, whenever a new block is created, the mining reward for that block will go into the <code class="literal">pendingTransactions</code> array and will be added to the next block. This is how mining rewards work in the Bitcoin blockchain. When we first created our blockchain in the first two chapters, we put the mining reward right into the block that we mined. Now that the blockchain is more <span>advanced</span><a id="id325690266" class="indexterm"></a> and we've got a decentralized network, it's <span>important</span><a id="id325690275" class="indexterm"></a> for us to follow best practices and put the mining reward into the next block.</p><p>Let's get back to the <code class="literal">/mine</code> endpoint and continue with the testing. Let's check the other nodes inside the network and verify whether the new block that was mined is added to those nodes or not. Also, let's check that the mining reward that was generated is also broadcast to the other nodes in the network.</p><p>Open another tab, type <code class="literal">localhost:3002/blockchain</code> in the address bar, and then press <span class="emphasis"><em>Enter</em></span>. You will see the following output:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/fb4a1a15-041b-4e1e-97fa-cba5d5077e85.png" /></div><p> </p><p>In the preceding screenshot, you can see that the node on port <code class="literal">3002</code> received the newly mined block, along with the mining reward transaction. You can verify this for the remaining nodes in the network. </p><p>Let's now mine another block from a different node. Instead of going to <code class="literal">localhost:3001</code>, type <code class="literal">localhost:3004/mine</code> in the browser's address bar, and then press <span class="emphasis"><em>Enter</em></span>. The new block will be mined; the output will look as follows:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/e7dadad9-edd8-4a81-8170-353f2f6598bb.png" /></div><p>From the preceding screenshot, you can observe that this is the third block. This is correct because we have mined two blocks already. Inside the block's <code class="literal">transactions</code> array, you can see that we've got the mining reward from the previous block. This transaction was the mining reward that was generated when the node on port <code class="literal">3001</code> mined the previous block.</p><p>Let's go to <code class="literal">localhost:3001/blockchain</code> and verify if this new block that we just mined has <span>been</span><a id="id325704609" class="indexterm"></a> added to the network. You will <span>see</span><a id="id325704617" class="indexterm"></a> the following response:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/da8bb88e-bb87-4f39-8fa1-26f5fac649c7.png" /></div><p>In this screenshot, you can observe that the new block that was mined has been added to the node hosted on <code class="literal">3001</code>. The transaction array of this block consists of the mining reward from the previous block. We now also have a new mining reward in the <code class="literal">pendingTransactions</code> array, which was generated when the third block was mined. Following a similar process of verification, as we used before, you can check if the third block that we mined has been added to all the remaining nodes.  </p><p>From these tests, it looks like the <code class="literal">/mine</code> endpoint is working just as it should. It's creating new blocks and broadcasting them to the entire network. This means the entire network is synchronized and has the exact same blockchain data, which is really important for a blockchain to work properly.</p><p>Let's test the endpoint a little further. Head over to Postman, create a couple of transactions, and then broadcast them. After that, let's mine a new block to see if the new transactions have been added to the blockchain correctly:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to your Postman now and create the following transaction: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/28216eda-96e7-466c-83b3-30426d2755c4.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Next, in order to broadcast the transaction, hit the <code class="literal">/transaction/broadcast</code> endpoint. You can send this transaction data to any node and it should be broadcast to the entire network. In our example, let's send this transaction to the node on port <code class="literal">3002</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/fd4cdaa5-c8e8-4f25-a020-fc9b447f2a16.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Now, click on <span>the</span><a id="id325882070" class="indexterm"></a><strong class="userinput"><code>Send</code></strong> button. You'll then receive a <span>response</span><a id="id325882081" class="indexterm"></a> as the transaction was created and broadcast successfully.</li></ol></div><p>You can also try making other transactions just as we did previously, by changing the amount value and the sender's and recipient's addresses. Another test would be sending the transaction data to different nodes.    </p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Let's now head back to the browser and check the nodes to verify that they've all received the transactions that we just created. As we loaded the node <code class="literal">3001</code> previously in our browser, let's refresh it. You should get the following output:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/8e5b4894-ef76-42e2-909c-60fe7c80686e.png" /></div><p>From the preceding screenshot, you can observe that the node has all three of the transactions that we created, plus it has the mining reward from the previous block inside the <code class="literal">pendingTransactions</code> array. Similarly, you can verify the <code class="literal">pendingTransaction</code> array for the remaining nodes. Thus, we can conclude that all of the transactions that we created are being broadcast to the entire network perfectly. </p><p>Now, let's mine a new block to verify whether all the pending transactions have been added to the new block. For this example, let's mine a new block on node <code class="literal">3003</code> by typing <code class="literal">localhost:3003/mine</code> in the address bar of the new tab. The response will indicate that the block was mined and broadcast successfully:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/fbf0eb23-c2f4-44be-845e-f4309834827e.png" /></div><p> </p><p>From the <span>preceding</span><a id="id325946323" class="indexterm"></a> screenshot, in the <code class="literal">transactions</code> array, it looks like all the transactions that we have created are present in the newly mined block. Let's go to all the nodes and verify whether the <span>transactions</span><a id="id325946336" class="indexterm"></a> that we created are added to the new block. On <code class="literal">localhost:3001</code>, you can observe the following output: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/7a132593-cc2e-440c-a56a-049d02356d7c.png" /></div><p>From this screenshot, we can observe that we've now got a fourth block that contains all the transactions that we sent. Then, if you check the <code class="literal">pendingTransactions</code> array, you can see that the transaction data has been cleared out and the new mining reward is present in it:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/f0bf2e5a-2b17-4227-889a-8a91d4216b8e.png" /></div><p>In this section, we <span>created</span><a id="id325946378" class="indexterm"></a> a couple of new transactions on different nodes. These were <span>then</span><a id="id325946387" class="indexterm"></a> broadcast to the whole network successfully. Then, we mined a new block and all the transactions we created were added to that new block successfully. On top of that, our newly mined block was broadcast to all the nodes inside our blockchain network. All of the nodes across our entire network are now synchronized and all contain the same blockchain data.</p></div>