<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec54"></a>Building the /block/:blockHash endpoint</h2></div></div><hr /></div><p>Let's use the <code class="literal">getBlock</code> method inside of <code class="literal">/block/:blockHash</code> endpoint to <span>retrieve</span><a id="id325458929" class="indexterm"></a> a specific block by its <code class="literal">blockHash</code>. Let's follow these next steps to build the endpoint: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>The first thing that we want to do in this endpoint is to use the <code class="literal">blockHash</code> value that is sent with the <code class="literal">/block/:blockHash</code> request. We can access this <code class="literal">blockHash</code> on the <code class="literal">req.params</code> object. Go to the <code class="literal">dev/networkNode.js</code> file and in the <code class="literal">/block/:blockHash</code> endpoint that we defined previously, add the following highlighted code: </li></ol></div><pre class="programlisting">app.get('/block/:blockHash', function(req, res) { 
<span class="strong"><strong>const blockHash = req.params.blockHash;</strong></span>
});</pre><p>Essentially, when we hit the <code class="literal">/block/:blockHash</code> endpoint, we're accessing the hash value of a block present on a particular node in the network. We're also accessing the hash value using the <code class="literal">req.params</code> object, which will give us access to any value in the <code class="literal">/block/:blockHash</code> URL that has a colon in front of it. Consequently, when a user makes a request to this endpoint, they're going to send in a <code class="literal">blockHash</code> in the URL, and then we can grab that <code class="literal">blockHash</code> with the help of <code class="literal">req.params.blockHash</code>. We're then going to save that value inside the <code class="literal">blockHash</code> variable.</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Next, inside the endpoint, we want to use the <code class="literal">getBlock</code> method that we created in the previous section. We'll add that method to the endpoint, as highlighted in the following code: </li></ol></div><pre class="programlisting">app.get('/block/:blockHash', function(req, res) { 
        const blockHash = req.params.blockHash;<span class="strong"><strong>
        const correctBlock = bitcoin.getBlock(blockHash);</strong></span>
});</pre><p> </p><p>By this point in the code, the block that we're looking for should be present in the <code class="literal">correctBlock</code> variable.</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Finally, send back the <code class="literal">correctBlock</code> variable as a response, so let's add the following highlighted code to the endpoint:</li></ol></div><pre class="programlisting">app.get('/block/:blockHash', function(req, res) { 
        const blockHash = req.params.blockHash;<span class="strong"><strong>
</strong></span>const correctBlock = bitcoin.getBlock(blockHash);
<span class="strong"><strong>res.json({</strong></span>
<span class="strong"><strong>                 block: correctBlock</strong></span>
<span class="strong"><strong>        });</strong></span>
});</pre><p>This is how we build the <code class="literal">/block/:blockHash</code> endpoint <span>using</span><a id="id325698342" class="indexterm"></a> the <code class="literal">getBlock</code> method. Now, let's test this endpoint and verify whether or not it's working properly. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec42"></a>Testing the /block/:blockHash endpoint </h3></div></div></div><p>In order to test the <code class="literal">/block/:blockHash</code> endpoint, follow these steps: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Let's first check how many <span>blocks</span><a id="id325698436" class="indexterm"></a> are present in the blockchain. Go to the browser and type <code class="literal">localhost:3001/blockchain</code> in the address bar and then press <span class="emphasis"><em>Enter</em></span>. You'll see the single genesis block present inside of the blockchain, as follows: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/c9ad629a-ad6b-45c2-a387-4a94f92011dc.png" /></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>You need to add a couple more blocks to this chain. To do this, go over to another tab in the browser, type <code class="literal">localhost:3001/mine</code>, and then press <span class="emphasis"><em>Enter</em></span>. Using the same process, let's generate one more block. We should now have three blocks inside the chain: one genesis block and the two blocks we just added. </li><li>In order to test the <code class="literal">/block/:blockHash</code> endpoint, let's simply take the hash value of one of these blocks and use it to test the endpoint. Let's copy the hash value of the third block in the chain, as in the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/b3d217b0-24b3-4cbf-af32-3bd785173ecc.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Next, go to <span>another</span><a id="id325842979" class="indexterm"></a> tab in the browser. Type <code class="literal">localhost:3001/block</code> in the address bar and then paste the hash value that we copied directly after this URL. Take a look at the following screenshot for a better understanding: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/efd97e6c-1d4c-4d77-ae36-3dc19fee6227.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Now, we know that the hash that we've used is present in the third block in the chain. So, we should expect to get the third block returned to us as a result of running the <code class="literal">/block/:blockHash</code> endpoint. Now press <span class="emphasis"><em>Enter</em></span> and the correct block should be returned to us as output: 
</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/ea4e8458-56c7-44d9-b869-b44d95b4d335.png" /></div><p>From the preceding screenshot, we can observe that the correct block is returned to us. The returned block consists of the hash value that we used in the <code class="literal">/block/:blockHash</code> endpoint to search for the block. </p><p>In a similar manner, you can now try searching for another block from the chain using the endpoint and the hash value of that particular block. </p><p>Now, if we were to send in the wrong hash or a <span>hash</span><a id="id325843036" class="indexterm"></a> that doesn't exist with the endpoint, then we should expect to get <strong class="userinput"><code>null</code></strong> returned to us as output, instead of the block being returned. Let's try this by sending the wrong hash value to the <code class="literal">/block/:blockHash</code> endpoint. In the address bar of the browser, type <code class="literal">localhost:3001/block</code>, then add a fake hash value to it and press <span class="emphasis"><em>Enter</em></span>. The following output should be returned:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/7ce8eb33-202a-49a7-91fc-f54577d6fcdc.png" /></div><p>From the preceding screenshot, you can observe that <code class="literal">block</code> is equal to <code class="literal">null</code>. This means that the hash value used to search the block doesn't exist in the chain. Consequently, from the test, we can conclude that the <code class="literal">/block/:blockHash</code> endpoint works perfectly and as expected. </p><p> </p><p> </p></div></div>