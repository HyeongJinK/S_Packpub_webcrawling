<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec26"></a>Building the /transaction endpoint</h2></div></div><hr /></div><p>In this section, we are going to <span>build</span><a id="id325268059" class="indexterm"></a> our transaction endpoint. Let's follow the below mentioned steps: </p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Before we start, please make sure that whenever you are working on our blockchain you have your server running. We can do that by running the <code class="literal">npm start</code> command in our terminal.</li><li>Let's head over to our <code class="literal">api.js</code>file and build our transaction endpoint. First of all, take out the example code that we added earlier in the<code class="literal">/transaction</code>endpoint and create a new transaction in our blockchain. To do that, we are going to use our<code class="literal">createNewTransaction</code>method in the <code class="literal">blockchain.js</code>file that we built in<a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Building a Blockchain</em></span>.</li><li>As you know, our <code class="literal">createNewTransaction</code>method takes in three parameters: <code class="literal">amount</code>, <code class="literal">sender</code>, and <code class="literal">recipient</code>:</li></ol></div><pre class="programlisting">Blockchain.prototype.createNewTransaction = function(amount, sender, recipient) {
  const newTransaction = {
    amount: amount,
    sender: sender,
    recipient: recipient
  };

  this.pendingTransactions.push(newTransaction);

  return this.getLastBlock()['index'] + 1;
};</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>This method returns the block number or the index that our new transaction will be added to. This is all that we need in order to create a transaction, so in our <code class="literal">/transaction</code> endpoint, we are going to add the following line:</li></ol></div><pre class="programlisting">app.post('/transaction', function(req, res) {
  const blockIndex = bitcoin.createNewTransaction(req.body.amount,
   req.body.sender, req.body.recipient) 
});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>In our endpoint, we're <span>going</span><a id="id325704602" class="indexterm"></a> to assume that all of this data is being sent in with the <code class="literal">req.body</code> from whoever is calling this endpoint. The result will be saved in <code class="literal">blockIndex</code>, and that is what we are going to send back to whoever calls this endpoint. We will be sending it back as a <code class="literal">note</code>:</li></ol></div><pre class="programlisting">app.post('/transaction', function(req, res) {
  const blockIndex = bitcoin.createNewTransaction(req.body.amount,
  req.body.sender, req.body.recipient) 
<span class="strong"><strong>    res.json({ note:`Transaction will be added in block
    ${blockIndex}.`});</strong></span>
});</pre><p>As you can see, the note will tell us which block the transaction will be added to. We have used string interpolation to pass the <code class="literal">blockIndex</code> value. Let's save this file and test this endpoint using Postman.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec18"></a>Testing the /transaction endpoint</h3></div></div></div><p> Now let's head over to <span>Postman</span><a id="id325704644" class="indexterm"></a> and apply settings similar to the ones that we set earlier:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/138e8554-918f-41f2-92a4-ca7d0bff31a8.png" /></div><p>We have selected the <strong class="userinput"><code>POST</code></strong> request, and we are targeting the <code class="literal">/transaction</code> endpoint. In the <strong class="userinput"><code>Body</code></strong> tab, we have checked <strong class="userinput"><code>raw</code></strong>, and the text has been selected to JSON format. We have passed in the values for <code class="literal">amount</code>, <code class="literal">sender</code>, and <code class="literal">recipient</code> in the JSON object, which will be our <code class="literal">req.body</code>, and on this object we will send all of our transaction data. With the help of <code class="literal">req.body</code>, which was mentioned in our <code class="literal">/transaction</code> endpoint, we can access the amount, the address of the sender, and the recipient.</p><p>Now let's test this endpoint:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/02f42d80-4661-4fbe-b79d-972af995ecbc.png" /></div><p>As you can see, when we clicked on the <strong class="userinput"><code>Send</code></strong><span>button</span><a id="id325691017" class="indexterm"></a> on Postman, we got the output as <strong class="userinput"><code>Transaction will be added in block 2</code></strong>. The reason we got block 2 here is that one block had already been created when we initiated our blockchain, which created the genesis block. Consequently, this transaction got added to block 2.</p><p> </p><p>One other way that we can test to make sure that this endpoint worked correctly is by hitting our <code class="literal">/blockchain</code> endpoint. When we hit this endpoint, we <span>should</span><a id="id325691038" class="indexterm"></a> expect to get our entire blockchain returned to us. In that blockchain, there should be a single block – our genesis block – and there should be one pending transaction, which is the transaction that we just created. Let's head over to the browser and go to <code class="literal">localhost:3000/blockchain</code>:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/7c92bc2d-6b70-4238-a533-ce5c61bdc7a1.png" /></div><p>As you can see, the entire object is our whole blockchain – the first part is our chain that has the genesis block, and the second part is our pending transaction, which we just created. Our <code class="literal">/transaction</code> endpoint works perfectly.</p></div></div>