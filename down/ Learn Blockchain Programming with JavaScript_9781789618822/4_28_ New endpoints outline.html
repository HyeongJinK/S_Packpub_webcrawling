<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec32"></a>New endpoints outline</h2></div></div><hr /></div><p>In our blockchain, we would <span>now</span><a id="id325268059" class="indexterm"></a> like to create a network and have a way to register all of the different nodes that we have with it. Therefore, let's make a couple more endpoints that will make it possible to register nodes with our network.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec24"></a>Defining the /register-and-broadcast-node endpoint</h3></div></div></div><p>The first <span>endpoint</span><a id="id325704660" class="indexterm"></a> that we create will be <code class="literal">/register-and-broadcast-node</code>, and this is defined as follows: </p><pre class="programlisting">app.post('/register-and-broadcast-node', function (req, res) {

});</pre><p>The preceding endpoint will register a node and broadcast that node to the whole network. It will do this by passing the URL of the node we want to register on the <code class="literal">req</code> body. Therefore, type the following inside the preceding endpoint:</p><pre class="programlisting">const newNodeUrl = req.body.newNodeUrl;</pre><p>We're not going to build this endpoint now, but when we use it in later sections, we'll be sending in the URL of a new node that we want to add to our network. Then we're going to make some calculations and broadcast the node to the entire network so that all the other nodes can add it as well.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec25"></a>Creating the /register-node endpoint </h3></div></div></div><p>The <code class="literal">/register-node</code> will be the <span>next</span><a id="id325762136" class="indexterm"></a> endpoint that we'll add to our network. This is defined as follows: </p><pre class="programlisting">app.post('/register-node', function (req, res) {

});</pre><p>This endpoint will register a node with the network.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec3"></a>The difference between register-and-broadcast-node and register-node endpoint</h4></div></div></div><p>Now let's try to <span>understand</span><a id="id325762160" class="indexterm"></a> how the <code class="literal">/register-and-broadcast-node</code> and <code class="literal">/register-node</code> endpoints are different. Basically, what's going to happen here is that whenever we want to register a new <span>node</span><a id="id325762174" class="indexterm"></a> with our network, we are going to hit the <code class="literal">/register-and-broadcast-node</code> endpoint. This endpoint is going to register the new node on its own server, and then it's going to broadcast this new node to all of the other network nodes.</p><p>Those network nodes will simply accept the new network node inside of the <code class="literal">/register-node</code> endpoint, <span>because</span> all these nodes<span> have to do is simply register the broadcast nodes.</span> We just want them to register the new node; we do not want them to broadcast the new node because this has already occurred.</p><p>If all of the other nodes in the network were to broadcast the new node as well, that would severely degrade the performance of our blockchain network and would lead to an infinite loop that would crash our blockchain. Therefore, when all of the other network nodes receive the new node's URL, we just want them to register it and not broadcast it.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec26"></a>Defining the /register-nodes-bulk endpoint </h3></div></div></div><p>The final endpoint that we're <span>going</span><a id="id325836866" class="indexterm"></a> to build in this section will be the <code class="literal">/register-nodes-bulk</code> endpoint:</p><pre class="programlisting">app.post('/register-nodes-bulk', function (req, res) {

});</pre><p>This endpoint will register multiple nodes at once.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec27"></a>Understanding how all of the endpoints work together </h3></div></div></div><p>Learning about all of these <span>endpoints</span><a id="id325836892" class="indexterm"></a> might seem little bit confusing at this stage, so let's try to understand this with the help of a diagram. In the following diagram, we have our blockchain network: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/98a807c0-b711-45ca-b6e3-b131db5255d5.png" /></div><p>Now let's assume that these five network nodes are already connected to each other, thus forming our decentralized network. Also, let's assume that we want to add a node that is hosted on <code class="literal">localhost:3009</code> to our network.</p><p>The first thing that we'll do to add that <span>node</span><a id="id325893174" class="indexterm"></a> to our network is hit the <code class="literal">register-and-broadcast-node</code> endpoint on one of our network nodes: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/a71620be-570c-4171-ba17-7c3a2c5c4c62.png" /></div><p>When we hit the <code class="literal">register-and-broadcast-node</code> endpoint, we need to send the URL of the new node that we want to add to our network. For our example, the URL is <code class="literal">localhost:3009</code>. This is the first step for adding a new node to our network. We <span>have</span> to hit our <code class="literal">register-and-broadcast-node</code> endpoint with the new nodes URL as data.</p><p>In the preceding diagram, the network node that we hit is going to register this new URL on its own node, and then it's going to broadcast this new node's URL to the rest of the network. All the other nodes in our network will receive this data at the <code class="literal">register-node</code> endpoint:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/38e0a699-3396-46f7-8b31-8334a701d8a6.png" /></div><p>We're going to hit the <code class="literal">register-node</code> endpoint on all the <span>other</span><a id="id325897643" class="indexterm"></a> network nodes because we don't need to broadcast the data any more — we just need to register it.</p><p>Now, after the new URL is registered with all the other network nodes, our original node is going to make a request to the new node, and it's going to hit the <code class="literal">register-node-bulk</code> endpoint:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/2a0d77d2-f6b2-4d41-b858-26c63974924d.png" /></div><p>Furthermore, the original node is going to pass along the URLs of all the other nodes with it. So, this call will register all the other nodes that are already present inside of our network with the new node. </p><p>At this point, the node is now part of the network, and all of the nodes inside of the network will be aware of all the other nodes present in the network as well.</p><p>Now let's just go over <span> the whole process</span> one more time. The first thing that we're going to do to add a new node to our network is hit the <code class="literal">/register-and-broadcast-node</code> endpoint on one of the nodes inside of our network. This endpoint will register the new node's URL, and then it will broadcast that new URL to all the other nodes in the network. After the broadcast is complete, the original network node that we hit will send a request to the new network node and it will hit the <code class="literal">register-nodes-bulk</code> endpoint. In doing this, it will register all the other nodes in the network with our new node.</p><p>Consequently, when this whole <span>process</span><a id="id325957155" class="indexterm"></a> is complete, all of these nodes will be part of our decentralized blockchain network, and they will all be registered with each other.</p><p>This is how these three endpoints are going to work together. In the following section, we're going to build the <code class="literal">register-and-broadcast-node</code> endpoint. </p></div></div>