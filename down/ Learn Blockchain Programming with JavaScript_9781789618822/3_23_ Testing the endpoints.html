<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec28"></a>Testing the endpoints</h2></div></div><hr /></div><p><span>In this section, we're <span>going</span><a id="id325268065" class="indexterm"></a> to be testing our <code class="literal">/mine</code> endpoint, along with our <code class="literal">/transaction</code> and <code class="literal">/blockchain</code> </span>endpoints, to make sure that everything works well together. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip8"></a>Note</h3><p><span>Before we test, it would be a good idea to take out the <code class="literal">console.log</code> statement </span>in the <code class="literal">proofOfWork</code> method. This is because <span>having it will just make your program </span>work harder, and it will therefore take more time to calculate things.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec19"></a>/mine endpoint testing </h3></div></div></div><p><span>First, let's test the <code class="literal">/mine</code> endpoint that we just <span>built</span><a id="id325698454" class="indexterm"></a> in our last section. Let's </span><span>head over to our browser and</span>hit <code class="literal">localhost:3000/blockchain</code>:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/89cb9744-3671-4c3b-a63d-c68646397ecd.png" /></div><p><span>Right now, we have our entire blockchain, in which the chain has one block in it – </span>our genesis block – and we also have<span>no pending transactions.</span></p><p>Now let's open another tab and hit our<code class="literal">/mine</code>endpoint. This should mine and create a new block for us:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/a2ae1f0f-49b5-4843-9740-77752ca4f5f1.png" /></div><p><span>We got our note that says <strong class="userinput"><code>New block <span>mined</span><a id="id325704624" class="indexterm"></a> successfully</code></strong>. </span>We also got our new block back, and <span>we can see all of the data that's on our block. It has a hash in it, and it also has the hash of the </span>previous block, which is the genesis block, and one transaction in it. You might be thinking, we didn't create a transaction, so where did this transaction come from? <span>This transaction is actually the mining reward that we put </span>into our endpoint, which has the <code class="literal">12.5</code> bitcoin mining reward transaction. It looks like our mining endpoint worked well.</p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec20"></a>Testing the / blockchain endpoint</h3></div></div></div><p><span>To test and ensure that we did <span>create</span><a id="id325704656" class="indexterm"></a> this new block, we can head back over to our</span><code class="literal">/blockchain</code>endpoint and refresh the page:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/dc38dc91-9ad9-4e58-a4f0-c278b750f1ee.png" /></div><p>It worked. We now have two blocks in our chain: one is the genesis block and the other is the one we just created. The second block also has the transaction in it, which has the reward.</p><p><span>Let's mine another block to test that again. H</span>ead over to our <code class="literal">/mine</code> endpoint and refresh it:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/dc2fc3be-d869-48e6-baeb-4593b77667d9.png" /></div><p><span>We just mined another block, which is our <span>third</span><a id="id325923906" class="indexterm"></a> block. </span><span>We can see that we get the <code class="literal">timestamp</code>, and another transaction, which is the mining reward, and also </span>we have the rest of our data. Now let's head back to our <code class="literal">/blockchain</code> endpoint and refresh it:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/326bb1e8-34fa-40fa-950e-74489d647403.png" /></div><p>As you can see, we have all three blocks. Block 3 is the one that we just created, and it has our mining reward transaction in it. <span>One more thing to notice is that our <code class="literal">previousBlockHash</code> actually aligns </span>with our block 2's <code class="literal">hash</code>. This is helping to secure our blockchain, which is good.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec21"></a>Testing the /transaction endpoint</h3></div></div></div><p><span>Now let's create some <span>transactions</span><a id="id325853833" class="indexterm"></a> with our <code class="literal">/transaction</code> endpoint. </span>For this, head over to Postman, make sure that the settings are the same as before, and make the following changes:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/b84fc720-2ef9-4c25-90e2-15e1bb988ae8.png" /></div><p>We have set the <code class="literal">amount</code> to <code class="literal">1000</code> bitcoins. We'll leave the sender and the recipient address as they are, but you can change it to whatever you want. Once we <span>post to the <code class="literal">/transaction</code> endpoint, in return we should get the text transaction that </span>will be added in block 4, which we did. This transaction got added to block 4 because we already have three blocks in our chain.</p><p><span>Let's make another example transaction. Here we will </span>change the <code class="literal">amount</code> to <code class="literal">50</code> bitcoins, and we will make some changes to the address of the sender and the recipient. So when we send this request, we should get the same response: <strong class="userinput"><code>Transaction will be <span>added</span><a id="id325853890" class="indexterm"></a> in block 4. </code></strong>This occurs because we haven't mined a new block yet. Let's try this out:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/ce7594e6-974d-445b-8ec1-5cb6c06748d0.png" /></div><p>That worked. Now let's head over and get our entire blockchain again. This time, we should expect to get the same blockchain and the two pending transactions that we just created. Let's refresh the page and see the output:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/42f2cc6e-90d5-4019-87e0-85f4c08fe56b.png" /></div><p>You will notice that this has three blocks and two pending transactions. <span>Now, if we head over to our <code class="literal">/mine</code> endpoint and refresh the page, these two pending transactions will be added to block 4:</span></p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/b3f545a4-177f-4d10-a953-edc12af7839b.png" /></div><p> </p><p> </p><p><span>We have successfully mined a new block. </span>It's got our data, and it also has three transactions. The first two transactions are the ones <span>we <span>created</span><a id="id325893211" class="indexterm"></a> in Postman, and the third one is our mining reward transaction</span>. <span>Now, if we go back to our <code class="literal">/blockchain</code> endpoint and refresh it, we will see that the two pending transactions are gone and that they have been added to block 4:</span></p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/1dacb4e6-2b82-41b7-b898-dc3da6a40153.png" /></div><p>As you can see, block 4 has all three transactions, and our <code class="literal">pendingTransactions</code> is empty now. It worked out well. Now, I wo<span>uld encourage you to create a couple more transactions and mine another block </span>just <span>to make sure that everything is working </span>properly.</p><p><span>By building this whole API and blockchain and really understanding how the code works, it becomes </span>a lot easier to understand how the blockchain <span>technology</span><a id="id325923945" class="indexterm"></a> actually works, and you also realize that a lot of it isn't actually so complicated.</p><p> </p><p> </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note9"></a>Note</h3><p><span>At any point while you are testing these endpoints, if you make changes to a file and save it, then the server will restart. This will result in a new instance of blockchain, which means that everything you have created so far will be cleared out.</span></p></div></div></div>