<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec56"></a>Building the /transaction/:transactionId endpoint</h2></div></div><hr /></div><p>Let's build the <code class="literal">/transaction/:transactionId</code> endpoint by <span>using</span><a id="id325458913" class="indexterm"></a> the <code class="literal">getTransaction</code> method that we built in the previous section. Let's begin:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>The first thing to do inside of this endpoint is to store the transaction ID sent as a request parameter. Let's store that in a <code class="literal">transactionId</code> variable, as follows:</li></ol></div><pre class="programlisting">app.get('/transaction/:transactionId', function(req, res) {
<span class="strong"><strong>const transactionId = req.params.transactionId;</strong></span>
});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The next thing to do is use the <code class="literal">getTransaction</code> method inside of the endpoint. To do this, add the following to the preceding code: </li></ol></div><pre class="programlisting">app.get('/transaction/:transactionId', function(req, res) {
         const transactionId = req.params.transactionId;
<span class="strong"><strong>bitcoin.getTransaction(transactionId); </strong></span>

});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>From the <code class="literal">getTransaction</code> method, we get an object returned to us that has the transaction we're looking for, and the block that the transaction is in. We want to store this data in a variable called <code class="literal">transactionData</code>, as follows: </li></ol></div><pre class="programlisting">app.get('/transaction/:transactionId', function(req, res) {
         const transactionId = req.params.transactionId;
<span class="strong"><strong>const trasactionData</strong></span> = bitcoin.getTransaction(transactionId);<span class="strong"><strong></strong></span>

});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Finally, we want to send back a<span>simple</span><a id="id325693412" class="indexterm"></a> response with the<code class="literal">transactionData</code> variable in it:</li></ol></div><pre class="programlisting">app.get('/transaction/:transactionId', function(req, res) {
         const transactionId = req.params.transactionId;
<span class="strong"><strong>const trasactionData</strong></span> = bitcoin.getTransaction(transactionId);
         res.json({
    transaction: trasactionData.transaction,
    block: trasactionData.block
         });   
<span class="strong"><strong></strong></span>

});</pre><p>And this is how we build the <code class="literal">/transaction/:transactionId</code> endpoint. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec43"></a>Testing the /transaction/:transactionId endpoint</h3></div></div></div><p>Now, it's time to test the <code class="literal">/transaction/:transactionId</code> endpoint to <span>verify</span><a id="id325698323" class="indexterm"></a> that it works as expected. However, before doing that, we need to add some transaction data and blocks to the blockchain.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec7"></a>Adding new transactions and blocks to the blockchain </h4></div></div></div><p>Similar to what we did in the <span>previous</span><a id="id325698339" class="indexterm"></a> section, first, let's add some <span>transactions</span><a id="id325698347" class="indexterm"></a> and blocks to the blockchain:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Therefore, head over to Postman and hit the <code class="literal">localhost:3001/transaction/broadcast</code> endpoint to send the transaction to all the nodes in the network.  </li><li>Now, send a couple of example transactions to the network. You can create the transactions as seen in the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/47f26602-65d6-470f-afc9-c0f59f7666d3.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>After adding the transaction data, click on the <strong class="userinput"><code>Send</code></strong> button to send the transaction to the network. Similarly, you can add one more transaction of <code class="literal">"amount": 200</code> and send that to the network.   </li><li>Next, mine a new block so that we can add these transactions into the blockchain. In the browser, open a tab and type <code class="literal">localhost:3001/mine</code> into the address bar. The new block will then be created: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/293ab4be-b9ff-4b84-9f64-39a40a421148.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Next, send <span>another</span><a id="id325820492" class="indexterm"></a> transaction of <code class="literal">"amount": 300</code> and send this to the network using the previously mentioned process. Once the transaction has been sent, let's <span>mine</span><a id="id325982005" class="indexterm"></a> a block again to add the transaction to the blockchain:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/18dfd46e-0e89-407f-abb0-68c3a53126b9.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, add two <span>more</span><a id="id325982032" class="indexterm"></a> transactions, with <code class="literal">"amount":</code> values of <code class="literal">400</code> and <code class="literal">500</code>, and send those to the network. Lastly, mine a block again to add the transactions that we <span>created</span><a id="id326009392" class="indexterm"></a> now to the blockchain:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/c2329be5-c8c2-4eae-8d75-036c4695d212.png" /></div><p>Now, if you go to <code class="literal">localhost:3001/blockchain</code>, you'll see all of the blocks and transactions that we just added to the blockchain.   </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec8"></a>Testing the endpoint </h4></div></div></div><p>After adding <span>transactions</span><a id="id326009424" class="indexterm"></a> and blocks to the blockchain, let's <span>test</span><a id="id326009432" class="indexterm"></a> the <code class="literal">/transaction/:transactionId</code> endpoint:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to the browser and open another tab. In the address bar, type <code class="literal">localhost:3001/transaction/</code> and then append a <code class="literal">transactionId</code> value from any block present in the blockchain to the end of this URL and press <span class="emphasis"><em>Enter</em></span>. Take a look at the following screenshot for reference: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/a60c55c9-8fae-4b1c-a386-14eeb66c6801.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Once you run this endpoint, the following output should be returned:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/cbc7c0a9-c77f-4ecf-b013-778e715d8964.png" /></div><p> </p><p> </p><p>In the preceding screenshot, you can observe that we had the transaction, associated with the <code class="literal">transactionId</code> that we passed with endpoint, returned as output. We also had the block returned, which consisted of the particular <code class="literal">transactionId</code> that we were looking for. </p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Now, carry out <span>another</span><a id="id326084851" class="indexterm"></a> example with a <code class="literal">transactionId</code> which doesn't <span>exist</span><a id="id326084862" class="indexterm"></a> in the blockchain. To do this, go to the browser and type <code class="literal">localhost:3001/transaction/</code> into the address bar. After doing this, add a random hash value to the endpoint. Take a look at the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/b72575f2-fbc8-4be1-8854-c7ef5c0b47ff.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>When you run this endpoint you will get the value null returned as output, as seen in the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/0801bb83-82c9-4c65-8d4f-4fb3f80ff9c7.png" /></div><p>The null value returned as seen in the preceding screenshot, indicates to us that this <code class="literal">transactionId</code> does not exist in the blockchain.</p><p>From the test, we can conclude that the <code class="literal">/transaction/:transactionId</code> endpoint and the <code class="literal">getTransaction</code> method are working just as they should.</p></div></div></div>