<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec55"></a>Defining the getTransaction method</h2></div></div><hr /></div><p>Let's add a new method on the <span>blockchain</span><a id="id325458916" class="indexterm"></a> data structure called <code class="literal">getTransaction</code>. This will allow us to get a specific transaction by passing <code class="literal">transactionId</code>. We'll use this new method inside of the <code class="literal">/transaction/:transactionId</code> endpoint. So, let's get started!</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to the <code class="literal">dev/blockchain.js</code> file, and after the <code class="literal">getBlock</code> method, define the <code class="literal">getTransaction</code> as follows: </li></ol></div><pre class="programlisting">Blockchain.prototype.getTransaction = function(transactionId) { 

}):</pre><p>This method is very similar to the <code class="literal">getBlock</code> method. Here, we'll iterate through the entire chain and will set a flag equal to the correct transaction that we are looking for.</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The next step in building this method will be to iterate through the entire blockchain. For this, use the <code class="literal">forEach</code> loop as follows: </li></ol></div><pre class="programlisting">Blockchain.prototype.getTransaction = function(transactionId) { 
<span class="strong"><strong>this.chain.forEach(block =&gt; { </strong></span>
<span class="strong"><strong></strong></span>
<span class="strong"><strong>       });</strong></span>

}):</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Since, in this method, we're looking for transactions, we need to iterate through every single transaction on every block in the chain. Therefore, we need to add another <code class="literal">for</code> loop inside the preceding <code class="literal">for</code> loop: </li></ol></div><pre class="programlisting">Blockchain.prototype.getTransaction = function(transactionId) { 
       this.chain.forEach(block =&gt; { 
<span class="strong"><strong>block.transactions.forEach(transaction =&gt; { </strong></span>
<span class="strong"><strong></strong></span>
<span class="strong"><strong>               });</strong></span>
       });

});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now that we have access to every single transaction on the blockchain, we simply need to compare the <code class="literal">transactionId</code> of every transaction with the <code class="literal">transactionId</code> that we're looking for. When the two match, then we know we have found the correct transaction. Let's define this condition inside the loop as follows: 
</li></ol></div><pre class="programlisting">Blockchain.prototype.getTransaction = function(transactionId) { 
       this.chain.forEach(block =&gt; { 
               block.transactions.forEach(transaction =&gt; { 
<span class="strong"><strong>if (transaction.transactionId === transactionId) {</strong></span>
<span class="strong"><strong></strong></span>
<span class="strong"><strong>                       };</strong></span>
               });
       });

});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Next, just like we did inside of the <code class="literal">getBlock</code> method, we want to set a flag to indicate that we have found the correct transaction inside the <code class="literal">getTransaction</code> method. Consequently, at the top of both of the loops, define the flag variable and use it as follows: </li></ol></div><pre class="programlisting">Blockchain.prototype.getTransaction = function(transactionId) {
<span class="strong"><strong><span>let</span> correctTransaction <span>=</span><span>null</span>;</strong></span>
       this.chain.forEach(block =&gt; { 
               block.transactions.forEach(transaction =&gt; { 
                       if (transaction.transactionId === transactionId) {
<span class="strong"><strong>correctTransaction = transaction;</strong></span>

                       }; 
               });
       });

});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, just to make this <span>method</span><a id="id325704785" class="indexterm"></a> a little bit more useful, we're also going to send back the block in which we found the transaction we were hunting for. To do this, define another flag as follows:</li></ol></div><pre class="programlisting">let correctBlock = null;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>If we then find the transaction we're looking for, set the condition as follows: </li></ol></div><pre class="programlisting">Blockchain.prototype.getTransaction = function(transactionId) {
<span>let</span> correctTransaction <span>=</span><span>null</span>;
  let correctBlock = null;  
       this.chain.forEach(block =&gt; { 
               block.transactions.forEach(transaction =&gt; { 
                       if (transaction.transactionId === transactionId) {
<span class="strong"><strong></strong></span>correctTransaction = transaction;         
<span class="strong"><strong>correctBlock = block; </strong></span>
                       }; 
               });
       });

});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>And then, finally, the last thing to do is to return both variables as output. Let's define this return condition as follows, outside of both the loops:</li></ol></div><pre class="programlisting">return {
         transaction: correctTransaction,
         block: correctBlock
};</pre></div>