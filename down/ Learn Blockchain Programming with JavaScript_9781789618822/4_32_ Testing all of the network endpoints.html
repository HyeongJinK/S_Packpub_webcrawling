<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec36"></a>Testing all of the network endpoints</h2></div></div><hr /></div><p>From what we have learned in the <span>preceding</span><a id="id325268059" class="indexterm"></a> section,  we know that our <code class="literal">register-node</code> route and that the <code class="literal">register-nodes-bulk</code> route are both working correctly. So, in this section, let's put it all together and test our <code class="literal">register-and-broadcast-node</code> route, which uses the both the <code class="literal">register-node</code> route and the <code class="literal">register-nodes-bulk</code> route.</p><p>The <code class="literal">register-and-broadcast-node</code> endpoint will allow us to build a decentralized blockchain network by allowing us to create a network and add new nodes to it. Let's jump right into our first example to get a better understanding of it. <span>To understand how the <code class="literal">register-and-broadcast-node</code> route works, we'll make use of  Postman.</span></p><p>In the Postman application, we want to make a post request to register and broadcast the node on <code class="literal">localhost:3001</code>. However, before we do that, just make sure that all four nodes are running so that we can test the routes.</p><p>At this point, we have no network at all; we just have five individual nodes running, but they are not connected in any way. Therefore, the first call that we're going to make is simply going to connect two nodes together to form the beginnings of our network. We will now register a node with our node that's hosted on port <code class="literal">3001</code>. When we hit the <code class="literal">register-and-broadcast-node</code> endpoint, we must send in a <code class="literal">newNodeUrl</code> that we want to register. In Postman, add the following code:</p><pre class="programlisting">{
    "newNodeUrl": ""
}</pre><p>For this first test, we want to register our second node hosted on port <code class="literal">3002</code> with our first node. To do that, we will add the following highlighted code:</p><pre class="programlisting">{
    "newNodeUrl": "http://localhost:3002"
}</pre><p>Now, when we make this request, it should register our node that's hosted on <code class="literal">localhost:3002</code> with our node that's hosted on <code class="literal">localhost:3001</code>. Let's verify this by clicking the <strong class="userinput"><code>Send</code></strong> button. You will see an output similar to what's shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/44053a9a-a919-4352-a8ed-05c520d1d38b.png" /></div><p>From the preceding screenshot, we can see that the new node has been registered successfully with the network. Let's verify this by going to the browser.</p><p>In the browser, you will have <span>access</span><a id="id325897649" class="indexterm"></a> to all five nodes that are running. We have now registered the node on port <code class="literal">3002</code> with the node  hosted on <code class="literal">localhost:3001</code>. So, if we refresh the page on the browser now, we'll get to observe that <code class="literal">localhost:3002</code> has been registered in the <code class="literal">networkNodes</code> array of port <code class="literal">3001</code>:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/8b7ad793-2b73-4a38-8a58-f11b907c6cc8.png" /></div><p>From the preceding screenshot, we can see that we've registered <code class="literal">localhost:3002</code>. Now, if we go to <code class="literal">localhost:3002</code>, we should have <code class="literal">localhost:3001</code> registered in its <code class="literal">networkNodes</code> array. Let's refresh and see what we get here:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/4a91d990-51f9-4a65-afe2-0280fa8efc39.png" /></div><p>From the preceding screenshot, we can see that both nodes have now formed a network and registered each other as a network node.</p><p>Next, let's add another node to this network. Let's head back to Postman and change the <code class="literal">localhost:3002</code> to <code class="literal">localhost:3003</code>. We're going to make a request to the node that is on <code class="literal">3001</code>:</p><pre class="programlisting">{
    "newNodeUrl": "<span class="strong"><strong>http://localhost:3003</strong></span>"
}</pre><p>What this should do is register our node that's hosted on <code class="literal">localhost:3003</code> with all the other nodes in the network. So, <code class="literal">3003</code> should register with <code class="literal">3001</code> and <code class="literal">3002</code>. Let's send this request and see if it works. If it's successfully registered, you will see an output similar to what's <span>shown</span><a id="id325762129" class="indexterm"></a> in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/c8bda1e2-4e80-4b12-b9a6-971c48be72f2.png" /></div><p>Let's verify this in our browser. When we refresh in the <code class="literal">localhost:3001</code>, we should have <code class="literal">localhost: 3003</code> inside of the <code class="literal">networkNodes</code> array:</p><p> </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/846f8022-523a-4ac0-a79a-58946f2741c9.png" /></div><p> </p><p>Now, since <code class="literal">localhost:3002</code> is also part of the network, it should have <code class="literal">localhost:3003</code> inside of the <code class="literal">networkNodes</code> array. When we made this request, we made it to <code class="literal">3001</code> not <code class="literal">3002</code>. Localhost <code class="literal">3002 </code>was already part of the network, and the broadcast registered <code class="literal">3003</code> with all the network nodes that are present in the network. To verify this, refresh the <code class="literal">networkNodes</code> array on <code class="literal">3002</code>. You will see an output similar to what's shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/a597effe-5723-4288-bcd7-70b32548f72f.png" /></div><p>From the preceding screenshot, we can <span>see</span><a id="id325826668" class="indexterm"></a> that we have our third node inside of the <code class="literal">localhost:3002</code><code class="literal">networkNodes</code> array as well now. Furthermore, if we go over to the <code class="literal">networkNodes</code> on <code class="literal">localhost:3003</code> and refresh the page,  we should have both <code class="literal">3001</code> and <code class="literal">3002</code> inside of the <code class="literal">networkNodes</code> array: </p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/6f60d331-8528-4b4c-9625-d24bc47422c5.png" /></div><p>Consequently, we now have a network comprised of our nodes on <code class="literal">3001</code>, <code class="literal">3002</code>, and <code class="literal">3003</code>. These are registered with each other.</p><p>Now, let's head back to Postman and register the remaining <code class="literal">localhost:3004</code> and <code class="literal">localhost:3005</code> with the network by following the same procedures that we followed to register the initial nodes. </p><p>After registering both <code class="literal">3004</code> and <code class="literal">3005</code> with the network, if you go to the browser, all of these registered nodes should have <code class="literal">localhost:3004</code> and <code class="literal">localhost:3005</code> inside of their <code class="literal">networkNodes</code> array. Refresh the <code class="literal">localhost:3001</code> page and you see an output similar to what's shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781789618822/graphics/766dcd26-5f69-4dff-8da0-26a70f6249fc.png" /></div><p>Similarly, if you refresh the other pages, you will get to observe all the nodes, similar to what we observed in the preceding screenshot.</p><p>So, this is how we've built up a decentralized network that is comprised of five different nodes.  </p><p> Now, you might be wondering how all of this is working. It's working b<span>ecause</span> when we make a <code class="literal">"newNodeUrl": "http://localhost:3004"</code> request, we are actually adding a command to add <code class="literal">3004</code> to the network. But then how does <code class="literal">localhost:3004</code> become aware of the entire network from one request?</p><p>If you remember from the preceding sections, when we built the <code class="literal">/register-and-broadcast-node</code> endpoint, there was actually a lot of calculations going on. So, if we take a look at the <code class="literal">/register-and-broadcast-node</code> endpoint code, we can see that the first thing that happens inside of our <code class="literal">register-and-broadcast-node</code> endpoint is that we take in the <code class="literal">newNodeUrl</code> and then broadcast it to every single node in the network by hitting their <code class="literal">register-node</code> endpoint. So, every node in the network will become aware of the new node that's being added.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Note</h3><p>For the complete code, please visit <a class="ulink" href="https://github.com/PacktPublishing/Learn-Blockchain-Programming-with-JavaScript/blob/master/dev/networkNode.js" target="_blank">https://github.com/PacktPublishing/Learn-Blockchain-Programming-with-JavaScript/blob/master/dev/networkNode.js</a> and refer to the code block which starts with this comment: <code class="literal">//registering a node and broadcasting it the network</code>.</p></div><p>Then, after the broadcast takes place, we send the request to the new node that was just added and register all of the network nodes that are already present in the network with the new node. This is where the reverse registration takes place. At this point, all of the original nodes in the network are aware of the new node, and the new node is aware of all the other nodes in the network. Thus, all of the nodes inside of the network become aware of each other, which is what needs to happen for our blockchain to work properly.</p><p>So, all three of the endpoints (<code class="literal">register-and-broadcast-node</code>, <code class="literal">register-node</code>, and <code class="literal">register-nodes-bulk</code>) that we built are very powerful because they <span>work</span><a id="id325924598" class="indexterm"></a> together to create a decentralized blockchain network. This is what we have built in this chapter.</p><p>At this point in the book, it is recommended that you to take some time to play around with these endpoints a little bit, making different networks with different nodes, and testing it a little bit more to get more familiar with how it's all working.</p><p>If you are confused about any of the concepts or topics we've covered, it is recommend that you once again read through all of the sections in this chapter. You'd be surprised how much you can learn and pick up the second time around after you already have some context for what is going to be happening and what we're going to be building. </p><p> </p><p> </p></div>