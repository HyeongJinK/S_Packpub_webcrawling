<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec30"></a>Creating multiple nodes</h2></div></div><hr /></div><p>Let's begin by building the <span>decentralized</span><a id="id325268059" class="indexterm"></a> network:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>The first thing that we'll have to do to create our decentralized blockchain network is make some modifications to our <code class="literal">api.js</code> file.</li><li>In our decentralized network, we're going to have multiple instances of our API, and each one of them will act as a network node. Since we'll be dealing with multiple network nodes, it will be better to rename our <code class="literal">api.js</code>file to <code class="literal">networkNode.js</code>for easy reference. </li><li>To set up the decentralized network, we'll have to run the <code class="literal">networkNode.js</code>file multiple times. Each time we run the file, we want it to act as a different network node. Let's do this by running the file on different ports every time we run it. To have a different ports value every time, we'll have to make port a variable. To do this, add the following line at the start of the code in our <code class="literal">dev/networkNode.js</code>:</li></ol></div><pre class="programlisting">const port = process.argv[2]; </pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Next, go to the <code class="literal">package.json</code> file and make modifications to the <code class="literal">start</code> command. What we'll do here is go to the end of our command and pass a variable for the port number on which we want a network node to run. In our example, we want to run our network node to run on port number <code class="literal">3001</code>. Consequently, pass <code class="literal">3001</code> as a variable at the end of the start command:</li></ol></div><pre class="programlisting">"start": "nodemon --watch dev -e js dev/api.js 3001"</pre><p>To get access to this variable, we passed the <code class="literal">process.argv</code> variable in our<code class="literal">networkNode.js</code>file. So, what is the<code class="literal">process.argv</code>variable? This variable simply refers to the<code class="literal">start</code>command that we run to start our server.</p><p>You can think of the preceding <code class="literal">start</code> command as an array of elements. The first and the second elements of the command are comprised of <code class="literal">"nodemon --watch dev -e js dev/api.js</code>, and the third element of the command is the <code class="literal">3001</code> variable.</p><p> </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip10"></a>Note</h3><p>If you want to add more variables to the command, you can simply make a space and then add more variables to it.</p></div><p>Consequently, to access the port variable in the <code class="literal">start</code> command, we passed the variable as <code class="literal">process.argv [2]</code> because this array starts with a <code class="literal">0</code> index and our port variable is the third element in the start command.  To simplify this, we can access the <code class="literal">3001</code> variable by stating <code class="literal">process.argv</code> at position 2. As a result, we gain access to our <code class="literal">port</code> variable inside of our <code class="literal">dev/networkNode.js</code> file.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Next, we want to use the <code class="literal">port</code> variable. Therefore, in the <code class="literal">dev/networkNode.js</code>  file, go to the bottom, where we have mentioned the following code:</li></ol></div><pre class="programlisting">app.listen(3000, function() {
    console.log('Listening on port 3000...');
});</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Once you have found this, make the following highlighted modifications to it: </li></ol></div><pre class="programlisting">app.listen(<span class="strong"><strong>port</strong></span>, function() {
    console.log(<span class="strong"><strong>`Listening on port ${port}...`</strong></span>);
});</pre><p>In the preceding block of code, we replaced the hardcoded <code class="literal">3000</code> port number with our <code class="literal">port</code> variable. We also changed <code class="literal">Listening on port 3000...</code> to <code class="literal">Listening on port ${port}...</code> by using string interpolation and passing the port variable.  Now, when we run the <code class="literal">networkNode.js</code> file, it should be listening on port <code class="literal">3001</code> instead of port <code class="literal">3000</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>One tiny thing that we need to <span>change</span><a id="id326092825" class="indexterm"></a> before we run the <code class="literal">networkNode.js</code> file is that in the <code class="literal">package.json</code> file in the <code class="literal">start</code> command, we'll have to  change the name of the <code class="literal">api.js</code> file to <code class="literal">networkNode.js</code>.</li><li>Now we're all set to run the <code class="literal">networkNode.js</code>file by<span>passing</span>in the variable of whatever port we want as a variable.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Let's run the <code class="literal">networkNode.js</code>file. In the terminal window, type <code class="literal">npm start</code>. By typing this command, the server should start listening to port <code class="literal">3001</code>, as we can observe in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/f4087cc5-3cbe-4828-9bd8-99d41b49c099.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>From the preceding screenshot, we can observe that the server is listening to port <code class="literal">3001</code>. We can further verify this by typing <code class="literal">localhost:3001/blockchain</code> in the browser. You should see an output similar to what's shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/b2d65e5b-f1d4-49f2-8f31-f634c0753a17.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>From the preceding screenshot, we can <span>see</span><a id="id326126923" class="indexterm"></a> that our blockchain is now hosted on port <code class="literal">3001</code> instead of on port <code class="literal">3000</code>. If we went to port <code class="literal">3000</code>, there would be nothing there, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/65b2b550-bd73-45b9-84db-2186ca90813d.png" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec22"></a>Running multiple instances of networkNode.js</h3></div></div></div><p>The next thing that we will <span>want</span><a id="id326126960" class="indexterm"></a> to do is run multiple instances of <code class="literal">networkNode.js</code>. To do that, we are going to add a few more commands to the <code class="literal">package.json</code> file:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To begin with, in the <code class="literal">package.json</code> file, we must change the <code class="literal">"start"</code> command to <code class="literal">"node_1"</code>. Now, when we run this command, it's going to start our first node, which is on port <code class="literal">3001</code>. Let's give this a try.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Save the file, go to your terminal, and cancel the previous process by typing <code class="literal">^C%</code>. After doing this, instead of typing <code class="literal">npm start</code>,  type<code class="literal">npm run node_1</code>. With the help of this command, run our<code class="literal">node_1</code>on port <code class="literal">3001</code>: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/709a78d8-0aa0-4862-aec8-fceed28ab13f.png" /></div><p>All we really did in this process is change the <code class="literal">npm start</code> command to<code class="literal">npm run node_1</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>For our decentralized network, we want to run a couple more of these nodes at the same time. Let's go back to our <code class="literal">package.json</code> file and add more commands that are similar to <code class="literal">"node_1"</code>. To do this, duplicate the <code class="literal">"node_1": "nodemon --watch dev -e js dev/networkNode.js 3001",</code> command four more times and then make modifications to these commands, as shown in the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/4fac49b9-e92c-4a28-95e5-9fa53114d748.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now, save this modification and let's head back over to our terminal and start up the other network nodes. From the previous run, we have the first node, <code class="literal">node_1</code>, running on port <code class="literal">3001</code>. For this run, we'll want to run the second node, <code class="literal">node_2</code>, on port <code class="literal">3002</code>. Therefore, simply type <code class="literal">npm  run node_2</code> and then press <span class="emphasis"><em>Enter</em></span>. We'll get to observe the following output on the screen: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/ebbfced8-7237-4bb2-81af-cc29bf4fce52.png" /></div><p>We now have one network node running on port <code class="literal">3001</code>, and the other network node running on port <code class="literal">3002</code>. Follow a similar process to run the remaining network nodes on the remaining ports. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip11"></a>Note</h3><p>For better visualization and easy understanding, it is recommended that you try to run each node on different tabs of the terminal window. </p></div><p>By following this process, what we <span>are</span><a id="id326168944" class="indexterm"></a> actually doing is creating five different instances of our <code class="literal">networkNode.js</code> file. So, essentially, we have five different network nodes running.</p><p>In the browser, we can check each one of these network nodes by changing the port number in <code class="literal">localhost:3001/blockchain</code>. By doing this, we're going to get back a different blockchain running on the different ports. </p><p> </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec23"></a>Testing the multiple nodes</h3></div></div></div><p>We will continue exploring the five <span>separate</span><a id="id326168971" class="indexterm"></a> network nodes that we created in the previous section. By now, you might have all five of the network nodes running. If not, going to the previous section and understanding how to get each of these nodes running is recommended. <span>What we've currently got, which is five separate network nodes running, is not really a network.</span> All we have is five separate nodes or five separate instances of our API running, but they are not connected in any way. To verify that these network nodes are not connected, we can carry out a couple of tests:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>So, let's head over to Postman and try make a couple of different transactions by hitting the <code class="literal">/transaction</code> endpoint on the different network nodes that we have running.</li><li>The first transaction that we want to make is going to be to our network node, which is hosted on port <code class="literal">3001</code>. So, let's go into the body and type in some random transaction data, as shown in the following screenshot:  </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/cb17998e-e810-425a-a9ee-3f468844fb4b.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Our transaction data has an amount of 30,000 bitcoins, and we're sending this to network node that's hosted on port <code class="literal">3001</code>. Click on the <strong class="userinput"><code>Send</code></strong> button, and if the transaction is successful you'll get the following response, as highlighted in the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/74749b23-014b-4013-abad-7d47b5d56c9d.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now let's make a transaction to our network node hosted on port <code class="literal">3003</code> with the transaction amount as 10 bitcoins. Then click on the <strong class="userinput"><code>Send</code></strong> button to send the transaction to the network node on port <code class="literal">3003</code>. Here you will also get to observe the similar response. </li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Now that we have sent the <span>transaction</span><a id="id326191393" class="indexterm"></a> data to the network nodes, let's verify it. Go to the browser and go to <code class="literal">localhost:3001/blockchain</code>, and then press<span class="emphasis"><em>Enter</em></span>. You'll get to observe a similar response, as shown in the following screenshot: </li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/b9910ab6-a682-4ed2-81a0-b4483aa0ae5b.png" /></div><p>From the preceding screenshot, you can observe that we have one pending transaction for 30,000 bitcoin. That's one of the transactions that we just added.</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, in the other tab, if we go to <code class="literal">localhost:3002/blockchain</code>, you'll see that we have no pending transactions because we did not send any transactions to this network node:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/f41c76d6-349d-4a46-92b5-f9f8606d73da.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Next, if we go to <code class="literal">localhost:3003/blockchain</code>, you'll see that we have a pending transaction here for the amount of 10 <span>Bitcoin</span>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789618822/graphics/0d54d9df-257f-4ea8-bfa3-c5951bde3186.png" /></div><p>This was one of the other transactions that we made.</p><p>If we were to go to <code class="literal">localhost: 3004/blockchain</code> and <code class="literal">localhost:3005/blockchain</code>, there should be no transactions there as we've not sent any of the transactions to these network nodes. </p><p>The conclusion that we can draw <span>from</span><a id="id326269723" class="indexterm"></a> this test is that although we do have five different network nodes running parallel to each other, they are not connected in any way. As a consequence, our main motive of this chapter will be to connect all of the network nodes to each other in order to build up a decentralized network. </p></div></div>