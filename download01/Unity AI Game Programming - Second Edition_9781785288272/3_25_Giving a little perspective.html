<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec29"></a>Giving a little perspective</h2></div></div><hr /></div><p>The perspective <a id="id98" class="indexterm"></a>sense will detect whether a specific aspect is within its field of view and visible distance. If it sees anything, it will take the specified action.</p><p>The code in the <code class="literal">Perspective.cs</code> file can be shown as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class Perspective : Sense {
  public int FieldOfView = 45;
  public int ViewDistance = 100;

  private Transform playerTrans;
  private Vector3 rayDirection;

  protected override void Initialize() {

    //Find player position
    playerTrans = 
      
  GameObject.FindGameObjectWithTag("Player").transform;
  }

  // Update is called once per frame
  protected override void UpdateSense() {
    elapsedTime += Time.deltaTime;

    // Detect perspective sense if within the detection rate
    if (elapsedTime &gt;= detectionRate) DetectAspect();
  }

  //Detect perspective field of view for the AI Character
  void DetectAspect() {
    RaycastHit hit;

    //Direction from current position to player position
    rayDirection = playerTrans.position - 
        transform.position;

    //Check the angle between the AI character's forward
    //vector and the direction vector between player and AI
    if ((Vector3.Angle(rayDirection, transform.forward)) &lt; FieldOfView) {
      // Detect if player is within the field of view
      if (Physics.Raycast(transform.position, rayDirection, 
          out hit, ViewDistance)) {
        Aspect aspect = 
        hit.collider.GetComponent&lt;Aspect&gt;();

        if (aspect != null) {
          //Check the aspect
          if (aspect.aspectName == aspectName) {
            print("Enemy Detected");
          }
        }
      }
    }
  }</pre></div><p>We need to <a id="id99" class="indexterm"></a>implement the <code class="literal">Initialize</code> and <code class="literal">UpdateSense</code> methods that will be called from the <code class="literal">Start</code> and <code class="literal">Update</code> methods of the parent <code class="literal">Sense</code> class, respectively. Then, in the <code class="literal">DetectAspect</code> method, we first check the angle between the player and the AI's current direction. If it's in the field of view range, we shoot a ray in the direction where the player tank is located. The ray length is the value of visible distance property. The <code class="literal">Raycast</code> method will return when it first hits another object. Then, we'll check against the aspect component and the aspect name. This way, even if the player is in the visible range, the AI character will not be able to see if it's hidden behind the wall.</p><p>The <code class="literal">OnDrawGizmos</code> method draws lines based on the perspective field of view angle and viewing distance so that we can see the AI character's line of sight in the editor window during play testing. Attach this script to our AI character and be sure that the aspect name is set to <code class="literal">Enemy</code>.</p><p>This method can be <a id="id100" class="indexterm"></a>illustrated as follows:</p><div class="informalexample"><pre class="programlisting">  void OnDrawGizmos() {
    if (playerTrans == null) return;

    Debug.DrawLine(transform.position, playerTrans.position, Color.red);

    Vector3 frontRayPoint = transform.position + 
        (transform.forward * ViewDistance);

    //Approximate perspective visualization
    Vector3 leftRayPoint = frontRayPoint;
    leftRayPoint.x += FieldOfView * 0.5f;

    Vector3 rightRayPoint = frontRayPoint;
    rightRayPoint.x -= FieldOfView * 0.5f;

    Debug.DrawLine(transform.position, frontRayPoint, Color.green);

    Debug.DrawLine(transform.position, leftRayPoint, Color.green);

    Debug.DrawLine(transform.position, rightRayPoint, Color.green);
  }
}</pre></div></div>