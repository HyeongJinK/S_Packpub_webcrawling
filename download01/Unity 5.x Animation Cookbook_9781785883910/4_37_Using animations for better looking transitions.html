<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec41"></a>Using animations for better looking transitions</h2></div></div><hr /></div><p>You've probably already noticed that sometimes when our character stops walking, it blends to the <strong class="userinput"><code>Idle</code></strong> animation in a strange way (with sliding feet). That is mostly visible when legs in the <strong class="userinput"><code>Walk</code></strong><span>animation</span><a id="id325289105" class="indexterm"></a> are in a pose that looks like a mirrored Idle pose. We are going to fix this problem in this recipe.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec116"></a>Getting ready</h3></div></div></div><p>You should use the same character as in the previous recipe and prepare one additional animation that will be a transition from a mirrored Idle pose to a normal Idle pose. You can also go to the <code class="literal">Chapter 04 Character movement\Recipe 04 Using animations for better looking transitions</code> directory and open the <code class="literal">Example.unity</code> scene. You will find our Humanoid character working the same way as in the previous recipe, but with a <strong class="userinput"><code>ToIdle</code></strong> animation added. You can also find the rig with all required animations in the <code class="literal">Rigs</code> directory.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec117"></a>How to do it...</h3></div></div></div><p>To use additional animations for a better-looking transition, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, follow all the points from the <span class="emphasis"><em>Using root motion to steer a character</em></span> recipe to have a working character driven by root motion animations.</li><li>In the <strong class="userinput"><code>Animation Import Settings</code></strong> of the character, find your additional <strong class="userinput"><code>ToIdle</code></strong> animation. You may need to add it as a new clip by clicking on the plus button in the <strong class="userinput"><code>Clips</code></strong> section (<strong class="userinput"><code>Animations</code></strong> tab) and choosing the <strong class="userinput"><code>ToIdle</code></strong> animation as the source.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Check the <strong class="userinput"><code>Bake Into Pose</code></strong> option for <strong class="userinput"><code>Root Transform Rotation</code></strong> and <strong class="userinput"><code>Root Transform Position (Y)</code></strong> in the <strong class="userinput"><code>ToIdle</code></strong> animation.</li><li>Open the <span>Animator</span><a id="id325509814" class="indexterm"></a> Controller (this should be the same controller as in the previous recipe), add another float parameter, and call it <strong class="userinput"><code>ToIdle</code></strong>.</li><li>Go back to the <strong class="userinput"><code>Animation Import Settings</code></strong> and find the <strong class="userinput"><code>WalkForward</code></strong> animation.</li><li>In its import settings, go down to the <strong class="userinput"><code>Curves</code></strong> section, unfold it, and click on the plus icon to add a new <strong class="userinput"><code>Animation Curve</code></strong>.</li><li>Name it <code class="literal">ToIdle</code> (its name should match exactly the parameter we created in the Animator Controller in step 4). Click on the curve (it's a flat green line at the moment) to open the <strong class="userinput"><code>Curve Editor</code></strong>. Curves are described by float values on the vertical axis and normalized animation time on the horizontal axis.</li><li>Create a square-shaped curve with its maximum value equal to 1 and its minimum value equal to 0 (point <span class="strong"><strong>1</strong></span> in the following screenshot). You can add curve control points by clicking on the curve. You can select points by clicking on them. You can remove points with the <span class="emphasis"><em>Delete</em></span> key. To adjust the handles and interpolation types of a point, right-click on it. To set a square curve, choose <strong class="userinput"><code>Both Tangents</code></strong> | <strong class="userinput"><code>Constant</code></strong>. You can save a <strong class="userinput"><code>Curve Preset</code></strong> for later use by clicking on the small gear icon in the lower left corner of the <strong class="userinput"><code>Curve Editor</code></strong> (see point <span class="strong"><strong>2</strong></span> in the following screenshot). When you scrub through the timeline (point <span class="strong"><strong>3</strong></span> in the following screenshot), you can see where your curve starts in the normalized animation time (point <span class="strong"><strong>4</strong></span> in the following screenshot):</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/38ca8c9e-f218-47ea-b417-237ab952ad60.png" /></div><p>Animation Curve and the Curve Editor</p><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>In our example, the <strong class="userinput"><code>Idle</code></strong><span>animation</span><a id="id325522942" class="indexterm"></a> has its left foot in front and our <strong class="userinput"><code>ToIdle</code></strong> animation starts with its right foot in front. During the animation, the character makes a small step to go back to the proper <strong class="userinput"><code>Idle</code></strong> pose with its left foot in front. In the <strong class="userinput"><code>WalkForward</code></strong> animation settings, try to set the curve value to 1, on the passing pose, when the right foot passes the left foot (and will be in front of the character few frames later).</li><li>Save the curve as a <strong class="userinput"><code>Curve Preset</code></strong> and add it to the <strong class="userinput"><code>WalkLeft</code></strong> and <strong class="userinput"><code>WalkRight</code></strong> animations. Set their curves names to <strong class="userinput"><code>ToIdle</code></strong> as well.</li><li>Go to the Animator Controller.</li><li>Add the <strong class="userinput"><code>ToIdle</code></strong> animation and create new state transitions:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Steering</code></strong> | <strong class="userinput"><code>ToIdle</code></strong> with two conditions, the <strong class="userinput"><code>Speed</code></strong> parameter less than 0.5 and the <strong class="userinput"><code>ToIdle</code></strong> parameter set to greater than 0.5. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to false and <strong class="userinput"><code>Transition Duration</code></strong> should be set to 0.2 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>ToIdle</code></strong> | <strong class="userinput"><code>Idle</code></strong> with no conditions, <strong class="userinput"><code>Has Exit Time</code></strong> set to true, and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds.</li></ul></div></li><li>Alter the <strong class="userinput"><code>Steering</code></strong> | <strong class="userinput"><code>Idle</code></strong> transition by adding a second condition to it: the <strong class="userinput"><code>ToIdle</code></strong> parameter set to less than 0.5. See the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/8a35647d-6439-4f8b-8536-34d961748954.png" /></div><p>Animator Controller using an additional ToIdle transition animation</p><div class="orderedlist"><ol class="orderedlist arabic" start="14" type="1"><li>Start the game and try walking and stopping the character in different time of the walk animation. You should see that the character plays the <strong class="userinput"><code>ToIdle</code></strong> animation to prevent foot sliding in the most visible case of the walk pose being a mirrored idle pose.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec118"></a>How it works...</h3></div></div></div><p>There are a few key elements of this recipe:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Animation Curves</strong></span>: You can add curves to your <span>animation</span><a id="id325531949" class="indexterm"></a>s (multiple curves per animation clip) in the <strong class="userinput"><code>Import Settings</code></strong>, <strong class="userinput"><code>Animation</code></strong> tab. Curves assign arbitrary float values to the animation frames. If the name of the curve is the same as the name of a parameter in the Animator Controller, the value of the parameter will be set to the value of the curve in any given frame of the animation.</li><li style="list-style-type: disc"><span class="strong"><strong>Using curve values</strong></span>: We are using the <strong class="userinput"><code>ToIdle</code></strong> value set by the <strong class="userinput"><code>Animation Curves</code></strong> in the <strong class="userinput"><code>WalkForward</code></strong>, <strong class="userinput"><code>WalkLeft</code></strong>, and <strong class="userinput"><code>WalkRight</code></strong> animations to trigger the transition from <strong class="userinput"><code>Steering</code></strong> to <strong class="userinput"><code>Idle</code></strong> (when the <strong class="userinput"><code>ToIdle</code></strong> value is less than 0.5) or from <strong class="userinput"><code>Steering</code></strong> to <strong class="userinput"><code>ToIdle</code></strong> animation (when the <strong class="userinput"><code>ToIdle</code></strong> parameter is greater than 0.5). This allows us to control the state transitions in the Animator Controller depending on the poses in the animations.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec119"></a>There's more...</h3></div></div></div><p>We've covered the most simple (yet most visible) case in this recipe. You can add more stop animations (or any transition animations) from different walk and run poses. You may need to add a stop animation for walk and run passing poses and for all the extremes, depending on your Idle pose. To do so, add more curves to your animations and react to them in the Animator Controller. For instance, you may have curves for <code class="literal">LeftFootExtreme</code>, <code class="literal">RightFootExtreme</code>, <code class="literal">LeftFootPassing</code>, and <code class="literal">RightFootPassing</code>; use them in your <strong class="userinput"><code>Walk</code></strong> and <strong class="userinput"><code>Run</code></strong> animations to trigger appropriate stop animations.</p><p>You can also check the value of an <strong class="userinput"><code>Animation Curve</code></strong> in runtime by checking the corresponding parameter value of the Animator Controller in scripts. To do so, use the <code class="literal">animator.GetFloat()</code> method, where <code class="literal">animator</code> is the reference to the Animator component.</p></div></div>