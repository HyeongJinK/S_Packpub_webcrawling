<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec71"></a>Using Animation Events to trigger sound and visual effects</h2></div></div><hr /></div><p>This recipe shows a simple, generic way of playing different <span>sound</span><a id="id325549038" class="indexterm"></a> and visual effects with <span>Animation Events</span><a id="id325549047" class="indexterm"></a>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec221"></a>Getting ready</h3></div></div></div><p>To start, you need to have a character with one looped animation: <strong class="userinput"><code>Jump</code></strong>. We also need a sound effect and a particle system. We will need a transparent <code class="literal">DustParticle.png</code> texture for the particle system. It should resemble a small dust cloud. You can open the provided example Unity project and go to the <code class="literal">Chapter 07 Special effects\Recipe 01 Using animation events to trigger sound and visual effects</code> directory. In the <code class="literal">Rigs</code> directory, you will find all the needed animations, and in the <code class="literal">Resources</code> folder, you will find all other necessary assets. When you play the game, you will see a character playing the <strong class="userinput"><code>Jump</code></strong> animation. It will also play a sound effect and a particle effect when landing.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec222"></a>How to do it...</h3></div></div></div><p>To play sound and visual effects with <span>Animation Events</span><a id="id325550899" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import the character with the <strong class="userinput"><code>Jump</code></strong> animation.</li><li>In the <strong class="userinput"><code>Import Settings</code></strong>, <strong class="userinput"><code>Animation</code></strong> tab, select the <strong class="userinput"><code>Jump</code></strong> animation.</li><li>Make it loop.</li><li>Go to the <strong class="userinput"><code>Events</code></strong> section.</li><li>Scrub through the timeline in the <strong class="userinput"><code>Preview</code></strong> section and click on the <strong class="userinput"><code>Add Event</code></strong> button. The <strong class="userinput"><code>Edit Animation Event</code></strong> window will appear, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/1fc37d57-cca8-4cdc-9253-183b12c8d414.png" /></div><p>Edit Animation Event window</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Type <code class="literal">Sound</code> in the <strong class="userinput"><code>Function</code></strong> field and <code class="literal">Jump</code> in the <strong class="userinput"><code>String</code></strong> field. This will call a <strong class="userinput"><code>Sound</code></strong> function in a script attached to the character and pass the <strong class="userinput"><code>Jump</code></strong> word as a string parameter to it.</li><li>Create another Animation Event. Set the <strong class="userinput"><code>Function</code></strong> field to <strong class="userinput"><code>Effect</code></strong> and the <strong class="userinput"><code>String</code></strong> field to <strong class="userinput"><code>Dust</code></strong>.</li><li>Apply the <strong class="userinput"><code>Import Settings</code></strong>.</li><li>Create an Animator Controller for the character with just the <strong class="userinput"><code>Jump</code></strong> animation in it.</li><li>Place the character in the scene.</li><li>Attach the controller to the Animator component of the character.</li><li>Attach an <strong class="userinput"><code>Audio Source</code></strong> component to the character.</li><li>Uncheck the <strong class="userinput"><code>Play On Awake</code></strong> option.</li><li>Create an empty game object and name it <strong class="userinput"><code>Dust</code></strong>.</li><li>Add a <strong class="userinput"><code>Particle System</code></strong> component to it. This will be our dust effect.</li><li>Set the <strong class="userinput"><code>Particle System's</code></strong> parameters as follows: 
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Duration</code></strong> to 1 second</li><li style="list-style-type: disc"><strong class="userinput"><code>Start Life Time</code></strong> to 0.5 seconds</li><li style="list-style-type: disc"><strong class="userinput"><code>Start Speed</code></strong> to 0.4</li><li style="list-style-type: disc"><strong class="userinput"><code>Start Size</code></strong> to random between two constants: 1 and 2</li><li style="list-style-type: disc"><strong class="userinput"><code>Start Color</code></strong> to a light brown</li><li style="list-style-type: disc"><strong class="userinput"><code>Emission</code></strong> | <strong class="userinput"><code>Rate</code></strong> to 0</li><li style="list-style-type: disc"><strong class="userinput"><code>Emission</code></strong> | <strong class="userinput"><code>Bursts</code></strong> to one burst with Time set to 0, <strong class="userinput"><code>Min</code></strong> and <strong class="userinput"><code>Max</code></strong> set to 5</li><li style="list-style-type: disc"><strong class="userinput"><code>Shape</code></strong> | <strong class="userinput"><code>Shape</code></strong> to Sphere</li><li style="list-style-type: disc"><strong class="userinput"><code>Shape</code></strong> | <strong class="userinput"><code>Radius</code></strong> to 0.2</li><li style="list-style-type: disc"><strong class="userinput"><code>Color Over Lifetime—</code></strong>Create a gradient for the alpha channel. In the 0% mark and 100% mark, it should be set to 0. In the 10% and 90% mark, it should be set to 255.</li></ul></div></li><li>Create a new <strong class="userinput"><code>Material</code></strong> and set the shader to <strong class="userinput"><code>Particles</code></strong> | <strong class="userinput"><code>Alpha Blended</code></strong>.</li><li>Drag and drop a transparent texture of a <code class="literal">DustParticle.png</code> into the <strong class="userinput"><code>Texture</code></strong> field of the <strong class="userinput"><code>Material</code></strong>.</li><li>Drag and drop the <strong class="userinput"><code>Material</code></strong> into the <strong class="userinput"><code>Renderer</code></strong> | <strong class="userinput"><code>Material</code></strong> slot of our <strong class="userinput"><code>Dust</code></strong><strong class="userinput"><code>Particle System</code></strong>.</li><li>Create a <code class="literal">Resources</code> folder in the project's structure. Unity can load assets from the <code class="literal">Resources</code> folder in runtime, without the need to reference them as prefabs.</li><li>Drag and drop the <code class="literal">Jump.ogg</code> sound and the <strong class="userinput"><code>Dust</code></strong> game object into the <code class="literal">Resources</code> folder.</li><li>Write a new script and name it <code class="literal">TriggerEffects.cs</code>.</li><li>This script has two public void functions. Both are called from the <strong class="userinput"><code>Jump</code></strong> animation as Animation Events. In the first function, we load an Audio Clip from the <code class="literal">Resources</code> folder. We set the <code class="literal">Audio Clip</code> name in the Animation Event itself as the string parameter (it was set to <strong class="userinput"><code>Jump</code></strong>). When we successfully load the <code class="literal">Audio Clip</code>, we play it using the Audio Source component, reference to which we store in the <code class="literal">source</code> variable. We also randomize the pitch of the Audio Source to have a little variation when playing the <code class="literal">Jump.ogg</code> sound:</li></ol></div><pre class="programlisting">        public void Sound (string soundResourceName) { 

            AudioClip clip = (AudioClip)
            Resources.Load(soundResourceName); 

            if (clip != null) 
            { 
                source.pitch = Random.Range(0.9f, 1.2f); 
                source.PlayOneShot(clip); 
            } 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="24" type="1"><li>In the second function, we try to load a prefab with the name specified as the function's parameter. We also set this name in the Animation Event (it was set to <strong class="userinput"><code>Dust</code></strong>). If we manage to load the prefab, we instantiate it, creating the dust effect under our character's feet:</li></ol></div><pre class="programlisting">        public void Effect (string effectResourceName) { 
            GameObject effectResource = 
            (GameObject)Resources.Load(effectResourceName); 
            if (effectResource != null) 
            { 
                GameObject.Instantiate(effectResource, 
                transform.position, Quaternion.identity); 
            } 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="25" type="1"><li>Assign the script to our character and play the game to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec223"></a>How it works...</h3></div></div></div><p>We are using one important feature of Animation Events in this recipe: the possibility to pass a <code class="literal">string</code>, <code class="literal">int</code>, or <code class="literal">float</code> parameter to our script's functions. This way we can create one function for playing all the sound effects associated with our <span>character</span><a id="id325241532" class="indexterm"></a> and pass the clips' names as <code class="literal">string</code> parameters from the <span>Animation Events</span><a id="id325241544" class="indexterm"></a>. The same concept is used for spawning the <strong class="userinput"><code>Dust</code></strong> effect.</p><p>The <code class="literal">Resources</code> folder is needed to get any resources (prefab, texture, audio clip, and so on) with the <code class="literal">Resources.Load(string path)</code> function. This method is convenient for loading assets using their names.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec224"></a>There's more...</h3></div></div></div><p>Our <strong class="userinput"><code>Dust</code></strong> effect has the <code class="literal">AutoDestroy.cs</code> script attached to make it disappear after a certain time. You can find that script in the <code class="literal">Shared Scripts</code> folder in the provided example Unity project.</p></div></div>