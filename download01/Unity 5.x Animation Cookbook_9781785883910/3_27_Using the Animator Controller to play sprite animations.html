<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec32"></a>Using the Animator Controller to play sprite animations</h2></div></div><hr /></div><p>In this recipe, we will create an Animator Controller to play 2D animations of a character. Unity's animation system is using the same principles for both 2D and 3D animation clips, which makes it quite intuitive to use.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec87"></a>Getting ready</h3></div></div></div><p>First, you should have at least two sprite animations (or 2D sprite doll animations) ready. You can also go to the <code class="literal">Chapter 03 2D and user interface animation\Recipe 04 Using the animator controller to play sprite animations</code> directory and open the <code class="literal">Example.unity</code> scene. You will find an already animated <strong class="userinput"><code>Warrior</code></strong> game object there. If you play the game, you can use the arrow keys (left and right) to move the character. It will play 2D animations accordingly.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec88"></a>How to do it...</h3></div></div></div><p>To create an Animator Controller for 2D animation, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import your 2D sprite sheets to Unity the same way as in the <span class="emphasis"><em>Exporting a 2D sprite animation from a 3D package</em></span> recipe.</li><li>Drag and drop one of the child sprites (not sprite sheets) into the <strong class="userinput"><code>Hierarchy</code></strong>.</li><li>Select the sprite game object and give it an appropriate name (it is named <strong class="userinput"><code>Warrior</code></strong> in this example).</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>With the <strong class="userinput"><code>Warrior</code></strong> game object selected, go to <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Animation</code></strong> to open the <strong class="userinput"><code>Animation</code></strong> View.</li><li>Create the required Animation Clips using the <strong class="userinput"><code>Animation</code></strong> View (the same way as in the <span class="emphasis"><em>Creating a frame-by-frame sprite animation with the Animation View</em></span> recipe). In this example, we use two animations: <strong class="userinput"><code>Warrior2dIdle</code></strong> and <strong class="userinput"><code>Warrior2dWalk</code></strong>.</li><li>An Animator Controller will be automatically created and assigned to the Animator component on the <strong class="userinput"><code>Warrior</code></strong> game object.</li><li>Open the created Animator Controller (you can easily do it by selecting the <strong class="userinput"><code>Warrior</code></strong> game object in the <strong class="userinput"><code>Hierarchy</code></strong> and going to <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Animator</code></strong>).</li><li>Create a new <code class="literal">float</code> parameter in the Animator Controller and name it <code class="literal">Speed</code>. We will use it for controlling the animation flow.</li><li>Create two transitions: from <strong class="userinput"><code>Warrior2dIdle</code></strong> to <strong class="userinput"><code>Warrior2dWalk</code></strong> and from <strong class="userinput"><code>Warrior2dWalk</code></strong> to <strong class="userinput"><code>Warrior2dIdle</code></strong>. The first one should have a condition of Speed greater than 0.1 and the second should have a condition of <strong class="userinput"><code>Speed</code></strong> less than 0.1. See the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/21b92907-8095-4f76-b802-dd77448d6af5.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Set the <strong class="userinput"><code>Has Exit Time</code></strong> to false and the <strong class="userinput"><code>Transition Duration</code></strong> to 0 in both transitions (you cannot blend frame by frame sprite animations).</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Write a script to set the <strong class="userinput"><code>Speed</code></strong> parameter based on the player input. You can also find and use the <code class="literal">Warrior2dMove.cs</code> script in the provided Unity project in the <code class="literal">Scripts</code> directory of this recipe.</li><li>In this script's <code class="literal">Update()</code> function, we take the <code class="literal">Horizontal</code> axis as the input. Then we set the <strong class="userinput"><code>Speed</code></strong> variable to be the absolute value of the input because in our Animator Controller, we check only if it's greater or less than 0.1, and the <code class="literal">Horizontal</code> axis can have values between<code class="literal">-1</code> and <code class="literal">1</code>. We use the <code class="literal">speed</code> variable to set the <strong class="userinput"><code>Speed</code></strong> parameter in our Animator Controller. The <code class="literal">animator</code> variable holds reference to the Animator component on the same game object (we set this reference in the <code class="literal">Start()</code> function):</li></ol></div><pre class="programlisting">        hor = Input.GetAxis("Horizontal"); 
        speed = Mathf.Abs(hor); 
        animator.SetFloat("Speed", speed); </pre><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>This will make the character play the <strong class="userinput"><code>Warrior2dWalk</code></strong> animation when the user presses the left or right arrow on the keyboard and <strong class="userinput"><code>Warrior2dIdle</code></strong> animation when player is not pressing any button.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec89"></a>How it works...</h3></div></div></div><p>There are a few key elements of this recipe:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Animator Controller for 2D animations</strong></span>: Controlling 2D animations playback works very similar to 3D and skeletal animations in Unity. You can create Animator Controllers as usual, with all required states and transitions between them.</li><li style="list-style-type: disc"><span class="strong"><strong>Transition Duration set to 0</strong></span>: The <strong class="userinput"><code>Transition Duration</code></strong> parameter only makes sense with animations that can be blended together to create a smooth transition. In 2D frame by frame animation, this is not possible (Unity cannot create "in between sprites" automatically). This is the reason to set the parameter to 0 and have a sharp, immediate transition. In case of the parameter value being greater than 0, the transition will still look sharp but also be delayed.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec90"></a>There's more...</h3></div></div></div><p>We have used a simple trick in our <code class="literal">Warrior2dMove.cs</code> script to lower the number of required animations. Our character can move left and right, but we use only one animation: <strong class="userinput"><code>Warrior2dWalk</code></strong> (in which the character is moving right). In the script's <code class="literal">Update()</code> function, we check if the player <code class="literal">Horizontal</code> axis input is greater than 0 or less than 0 and set the local X scale of the character to <code class="literal">1</code> or<code class="literal">-1</code>, depending on the movement direction. This flips the character and saves us around 50 percent of the animations:</p><pre class="programlisting">if (hor &gt; 0f) 
{ 
     transform.localScale = Vector3.one; 
} 
else if (hor &lt; 0f) 
{ 
    transform.localScale = new Vector3(-1f, 1f, 1f); 
} </pre></div></div>