<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec95"></a>Dismemberment</h2></div></div><hr /></div><p>This recipe shows how to create a <span>dismemberment effect</span><a id="id325241232" class="indexterm"></a> for a rigged character. We are going to create a decapitation as an example. This effect is often used in various combat games (both shooters and melee combat games):</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/80a7ab2b-267a-4c03-8e49-cff2d26b7765.png" /></div><p>Decapitation—an example of the dismemberment effect</p><p></p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec296"></a>Getting ready</h3></div></div></div><p>We are going to use the same character as in the <span class="emphasis"><em>Creating a humanoid ragdoll with the ragdoll wizard</em></span> recipe. We will also use the <code class="literal">HandleRagdoll.cs</code> script from the same recipe to turn the ragdoll on. On top of that, we will need to have two additional meshes: the <strong class="userinput"><code>Head</code></strong> model and the <strong class="userinput"><code>Neck</code></strong> model. See the following screenshot for reference:</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/0ac37302-2444-4eeb-a7b8-d4d0b89c6cd4.png" /></div><p>Neck and head models</p><p>You can also <span>open</span><a id="id325241707" class="indexterm"></a> the example Unity project and go to the <code class="literal">Chapter 09 Physics and animations\Recipe 07 Dismemberment</code> directory. If you open the <code class="literal">Example.unity</code> scene there, play the game and press the space bar so that the poor character will be decapitated. You can find all the additional models in the <code class="literal">Models</code> directory.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec297"></a>How to do it...</h3></div></div></div><p>To create a decapitation effect, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Follow the <span class="emphasis"><em>Creating a humanoid ragdoll with the ragdoll wizard</em></span> recipe to have a character with a working ragdoll and the <code class="literal">HandleRagdoll.cs</code> script (a script to turn the ragdoll on).</li><li>Import the <strong class="userinput"><code>Neck</code></strong> and <strong class="userinput"><code>Head</code></strong> models and place them in the scene near the character.</li><li>Create two empty game objects; name the first one <strong class="userinput"><code>HeadMarker</code></strong> and the second one <strong class="userinput"><code>NeckMarker</code></strong>.</li><li>Parent the <strong class="userinput"><code>HeadMarker</code></strong> to the head bone and the <strong class="userinput"><code>NeckMarker</code></strong> to the neck bone. Make sure that the local position of <strong class="userinput"><code>HeadMarker</code></strong> and <strong class="userinput"><code>NeckMarker</code></strong> is 0.</li><li>Parent the <strong class="userinput"><code>Head</code></strong> object to the <strong class="userinput"><code>HeadMarker</code></strong> and the <strong class="userinput"><code>Neck</code></strong> object to the <strong class="userinput"><code>NeckMarker</code></strong>. Zero out <strong class="userinput"><code>Head</code></strong>'s and <strong class="userinput"><code>Neck</code></strong>'s local rotation and position.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Use the <strong class="userinput"><code>HeadMarker</code></strong> and <strong class="userinput"><code>NeckMarker</code></strong> to position the <strong class="userinput"><code>Head</code></strong> and the <strong class="userinput"><code>Neck</code></strong> to match the head and neck of the character as closely as possible. Remember that <strong class="userinput"><code>Head</code></strong>'s and <strong class="userinput"><code>Neck</code></strong>'s local position and rotation is 0, so when we position them by manipulating <strong class="userinput"><code>HeadMarker</code></strong> and <strong class="userinput"><code>NeckMarker</code></strong>, it will make is easier for us to spawn the <strong class="userinput"><code>Head</code></strong> and <strong class="userinput"><code>Neck</code></strong> later.</li><li>Add a <strong class="userinput"><code>Sphere Collider</code></strong> and a <strong class="userinput"><code>Rigidbody</code></strong> component to the <strong class="userinput"><code>Head</code></strong> game object.</li><li>Make a prefab <span>from</span><a id="id325526779" class="indexterm"></a> the <strong class="userinput"><code>Head</code></strong> game object and another one from the <strong class="userinput"><code>Neck</code></strong> game object.</li><li>Delete <strong class="userinput"><code>Head</code></strong> and <strong class="userinput"><code>Neck</code></strong> from the scene, but make sure to leave <strong class="userinput"><code>HeadMarker</code></strong> and <strong class="userinput"><code>NeckMarker</code></strong> still parented to their corresponding bones in the character's rig.</li><li>Create a new C# script and name it <code class="literal">Dismemberment.cs</code>. In this script's <code class="literal">Update()</code> function, we check whether the player presses the space bar and we call the <code class="literal">void Decapitate()</code> function if the <code class="literal">wasSevered</code> flag is <code class="literal">false</code> (you can really only decapitate someone once):</li></ol></div><pre class="programlisting">      if (Input.GetKeyDown(KeyCode.Space) &amp;&amp; !wasSevered) 
      { 
          Decapitate(); 
      }     </pre><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>The <code class="literal">void Decapitate()</code> function does the rest. First it checks if the <code class="literal">HandleRagdoll.cs</code> script was found (the reference to it is set in the <code class="literal">Start()</code> function). If it was found, we enable the ragdoll with it and disable the script. Next we remove the <strong class="userinput"><code>Character Joint</code></strong>, <strong class="userinput"><code>Rigidbody</code></strong>, and <strong class="userinput"><code>Collider</code></strong> components from the head bone (we are going to scale it to 0 because we don't want to bother with this joint anymore). Next we spawn the new, severed <strong class="userinput"><code>Head</code></strong> from a prefab stored in the <code class="literal">public GameObject headPrefab</code> variable. The <strong class="userinput"><code>Head</code></strong> is spawned with the <strong class="userinput"><code>HeadMarker</code></strong> position and rotation, a reference to which is stored in the <code class="literal">public Transform headMarker</code> variable. Then we get the <strong class="userinput"><code>Rigidbody</code></strong> component of the spawned <strong class="userinput"><code>Head</code></strong> and apply a random force and random torque to make it move. We use the <code class="literal">public Vector3</code> variables to store the <code class="literal">randomForce1</code>, <code class="literal">randomForce2</code>, <code class="literal">randomTorque1</code>, and <code class="literal">randomTorque2</code> values. We have a small helper function <code class="literal">Vector3 RandomVector(Vector3 v1, Vector3 v2)</code> that takes two vectors and returns a random vector build from those two parameters. Lastly, we scale the head bone to 0 (reference to it is stored in the <code class="literal">public Transform head</code> variable). Finally, we spawn the <strong class="userinput"><code>Neck</code></strong> prefab and parent it to the <strong class="userinput"><code>NeckMarker</code></strong>:</li></ol></div><pre class="programlisting">      wasSevered = true; 
      if (ragdollHandler != null) 
      { 
          ragdollHandler.EnableRagdoll(true); 
          ragdollHandler.enabled = false; 
      } 
      Joint headJoint = head.GetComponent&lt;Joint&gt;(); 
      if (headJoint != null) 
      { 
          Destroy(headJoint); 
      } 
      Collider headCollider = head.GetComponent&lt;Collider&gt;(); 
      if (headCollider != null) 
      { 
          Destroy(headCollider); 
      } 
      Rigidbody headRigidBody = head.GetComponent&lt;Rigidbody&gt;(); 
      if (headRigidBody != null) 
      { 
          Destroy(headRigidBody); 
      } 
      GameObject spawnedHead = 
      (GameObject)GameObject.Instantiate(headPrefab, 
      headMarker.position, headMarker.rotation); 
 
   Rigidbody spawnedHeadRB = spawnedHead.GetComponent&lt;Rigidbody&gt;(); 
      if (spawnedHeadRB != null) 
      { 
          spawnedHeadRB.AddForce(RandomVector(randomForce1, 
          randomForce2), ForceMode.Impulse); 
 
          spawnedHeadRB.AddTorque(RandomVector(randomTorque, 
          randomTorque2),ForceMode.Impulse); 
      } 
      head.localScale = Vector3.zero; 
 
      GameObject spawnedNeck = 
      (GameObject)GameObject.Instantiate(neckPrefab, 
      neckMarker.position, neckMarker.rotation); 
      spawnedNeck.transform.parent = neckMarker;     </pre><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>Add the <span>script</span><a id="id325241378" class="indexterm"></a> to the character.</li><li>Play the game and press the space bar to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec298"></a>How it works...</h3></div></div></div><p>The main feature of this recipe is hiding the character's head. To do so, we simply need to scale the head bone to 0. All vertices assigned to this bone will be then squashed to the same point in space. After we hide the head, we can spawn a second one with a <strong class="userinput"><code>Rigidbody</code></strong> component and a <strong class="userinput"><code>Collider</code></strong> attached. This way our second head will fall down. To make the effect more spectacular, we're adding a small random force and torque to the newly spawned head. This makes it rotate and fly up after the <span>decapitation</span><a id="id325241401" class="indexterm"></a>.</p><p>We also spawn a neck game object to mask the stretched polygons that appear after we scale the head to 0. We use the <strong class="userinput"><code>HeadMarker</code></strong> and <strong class="userinput"><code>NeckMarker</code></strong> game objects parented to the corresponding bones in the character's rig just because they make it easier to match the position and rotation of the <strong class="userinput"><code>Head</code></strong> and <strong class="userinput"><code>Neck</code></strong> objects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec299"></a>There's more...</h3></div></div></div><p>You can also cut off other limbs with this technique. If you want to use this concept for cutting off arms or legs, consider spawning a rigged severed arm or leg with a ragdoll. Such a ragdoll can contain only two <strong class="userinput"><code>Rigidbody</code></strong> components, two <strong class="userinput"><code>Colliders</code></strong>, and one <strong class="userinput"><code>Character Joint</code></strong> (the elbow or the knee).</p></div></div>