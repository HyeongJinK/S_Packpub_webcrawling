<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec94"></a>Applying force to a ragdoll</h2></div></div><hr /></div><p>In this recipe, we are going to apply some additional force to a ragdoll when we turn it on. Normally, when you turn the <span>ragdoll</span><a id="id325241224" class="indexterm"></a> on, it starts from idle; no initial movement is introduced. It looks stiff and unnatural. Applying force to a body part will help to avoid that.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec292"></a>Getting ready</h3></div></div></div><p>We are going to use the same character as in the <span class="emphasis"><em>Creating a humanoid ragdoll with the ragdoll wizard</em></span> recipe. We will also use the <code class="literal">HandleRagdoll.cs</code> script from the same recipe to turn the ragdoll on. You can also open the example Unity project and go to the <code class="literal">Chapter 09 Physics and animations\Recipe 06 Applying force to a ragdoll</code> directory. If you open the <code class="literal">Example.unity</code> scene there and play the game, you will be able to click on any body part of the character. That will turn the <span>ragdoll</span><a id="id325241260" class="indexterm"></a> on and apply force to this body part, which will make the character look like it was hit or shot in that particular limb:</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/6ae27889-4958-4545-aa19-2bb76aa435c2.png" /></div><p>Force applied directly to the head of the character</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec293"></a>How to do it...</h3></div></div></div><p>To apply force to a ragdoll's body part, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Follow the <span class="emphasis"><em>Creating a humanoid ragdoll with the ragdoll wizard</em></span> recipe to have a character with a working ragdoll and the <code class="literal">HandleRagdoll.cs</code> script (a script to turn the ragdoll on).</li><li>Create a new C# script and name it <code class="literal">RagdollForceApply.cs</code>. In this script's <code class="literal">Update()</code> function, we first check whether the player clicks on the left mouse button. Then we create a ray from the mouse cursor position in the camera's direction and we check if we hit a collider that has one of the layers described by the <code class="literal">public</code><code class="literal">Layer Mask ragdollBodyPartsLayer</code> variable. If we manage to hit a collider, we try to get the <strong class="userinput"><code>Rigidbody</code></strong> component from it and store it in our <code class="literal">Rigidbody hitBodyPart</code> variable. If we indeed find the rigid body, we call the <code class="literal">void ApplyForce()</code> function:</li></ol></div><pre class="programlisting">      if (Input.GetKeyDown(KeyCode.Mouse0)) 
      { 
          if (Physics.Raycast(Camera.main.ScreenPointToRay 
          (Input.mousePosition), out hitInfo, 100f, 
          ragdollBodyPartsLayer)) 
          { 
              hitPodyPart = hitInfo.collider.gameObject 
              .GetComponent&lt;Rigidbody&gt;(); 
              if (hitPodyPart != null) 
              { 
            AddForce(); 
              } 
          } 
      }     </pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>The <code class="literal">void ApplyForce()</code> function turns the ragdoll on using the <code class="literal">HandleRagdoll</code> script. After that, it applies the force in the camera direction with the <code class="literal">public float forceMagnitude strength</code>:</li></ol></div><pre class="programlisting">      void AddForce() 
      { 
          ragdollHandler.EnableRagdoll(true); 
     
          force = (hitInfo.point - 
          Camera.main.transform.position).normalized * 
          forceMagnitude; 
     
          hitPodyPart.AddForce(force, ForceMode.Impulse); 
      } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>We set the reference to the <code class="literal">HandleRagdoll</code> script in the <code class="literal">Start()</code> function.</li><li>Add the script to the character.</li><li>Make sure the character ragdoll's body parts have the proper Layer set.</li><li>Set the <strong class="userinput"><code>Ragdoll Body Parts Layer</code></strong> mask in the <strong class="userinput"><code>RagdollForceApply</code></strong> in the <strong class="userinput"><code>Inspector</code></strong> to match the layer of the ragdoll's body parts.</li><li>Play the game and click on any given body part of the character to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec294"></a>How it works...</h3></div></div></div><p>This recipe simply applies a force to a chosen body part of the ragdoll using the <code class="literal">AddForce()</code> function called on the limb's <strong class="userinput"><code>Rigidbody</code></strong> component. This function requires a <code class="literal">Vector3 force</code> parameter that describes the direction and magnitude of the applied force. We can also specify a <code class="literal">ForceMode</code> mode parameter to change the mode of the applied force. Here we've chosen to use the <code class="literal">ForceMode.Impulse</code> as our force is applied only in one frame.</p><p>The rest of the script handles selecting the body part we want to apply the force to. In this example, we are using the mouse input to cast a ray and try to hit a body part's collider. If we manage to do so, we choose this particular limb as the target that we want to apply the force to.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec295"></a>There's more...</h3></div></div></div><p>You can also use the concept illustrated in the <span class="emphasis"><em>Destructible objects</em></span> recipe to store the velocity of the character (or of its limbs) and then apply it to the ragdoll's body parts. To do so, you may calculate the linear and angular velocity of any given body part in the <code class="literal">Update()</code> function, by subtracting the previous position from the current position, and the previous rotation in Euler angles from the current rotation. Then you can apply the calculated values as the <code class="literal">velocity</code> and <code class="literal">angularVelocity</code> to that part's <strong class="userinput"><code>Rigidbody</code></strong> component when you turn the <span>ragdoll</span><a id="id325509753" class="indexterm"></a> on.</p></div></div>