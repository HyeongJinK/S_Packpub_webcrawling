<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec42"></a>Using root motion for a 180 degrees turn</h2></div></div><hr /></div><p>In the previous recipe, we've added a stop animation for a better transition to the idle state. We can add <span>even</span><a id="id325531890" class="indexterm"></a> more animations to our movement to make it more accurate and responsive. An example of such animation is a <span>180-degree</span><a id="id325531898" class="indexterm"></a> turn.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec120"></a>Getting ready</h3></div></div></div><p>Use the same <span>character</span><a id="id325531913" class="indexterm"></a> as in the previous recipe. Add a <span>180-degree</span><a id="id325532256" class="indexterm"></a> turn animation, starting with the Idle pose and ending with the Idle pose rotated by 180 degrees in the vertical axis. Name the animation <code class="literal">180Turn</code> for clarity. You can open the provided example Unity project and go to the <code class="literal">Chapter 04 Character movement\Recipe 05 Using root motion for a 180 degrees turn</code> directory. You will find an <code class="literal">Example.unity</code> scene there. Play the game and try to walk in the direction opposite to the one the character is facing (press the down arrow). You can find the <code class="literal">Humanoid.fbx</code> asset in the <code class="literal">Rigs</code> directory with all the required animations.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec121"></a>How to do it...</h3></div></div></div><p>To make a 180-degree turn, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create four transitions (see the following screenshot):</li><li>Drag and drop your <strong class="userinput"><code>180Turn</code></strong> animation into the Animator Controller to create a new state.</li><li>Open the Animator Controller (this should be the same controller as in the previous recipe), add two float parameters, and call them <code class="literal">DirectionRaw</code> and <code class="literal">SpeedRaw</code>.</li><li>Check the <strong class="userinput"><code>Bake Into Pose</code></strong> option for the <strong class="userinput"><code>Root Transform Position (Y)</code></strong> in the <strong class="userinput"><code>180Turn</code></strong> animation.</li><li>In the <strong class="userinput"><code>Animation Import Settings</code></strong> of the character, find your additional <strong class="userinput"><code>180Turn</code></strong> animation. You may need to add it as a new clip by clicking on the plus button in the <strong class="userinput"><code>Clips</code></strong> section (<strong class="userinput"><code>Animations</code></strong> tab) and choosing the <strong class="userinput"><code>180Turn</code></strong> animation as the source.</li><li>Import the character and repeat all the steps from the <span class="emphasis"><em>Using root motion to steer a character</em></span> and <span class="emphasis"><em>Using animations for better looking transitions</em></span> recipes to have a character that is able to walk.
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>180Turn</code></strong> with two conditions: The <strong class="userinput"><code>SpeedRaw</code></strong> parameter should be greater than 0.5 and the <strong class="userinput"><code>DirectionRaw</code></strong> parameter should be greater than 160. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to false and <strong class="userinput"><code>Transition Duration</code></strong> should be set to around 0.1 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>180Turn</code></strong> (a second one) with two conditions: The <strong class="userinput"><code>SpeedRaw</code></strong> parameter should be greater than 0.5 and the <strong class="userinput"><code>DirectionRaw</code></strong> parameter should be less than -160. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to false and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds. We have two transitions between the same states because we want them to work as a logical OR operator; if any of them is met, the transition will be triggered.</li><li style="list-style-type: disc"><strong class="userinput"><code>180Turn</code></strong> | <strong class="userinput"><code>Idle</code></strong> with one condition: <strong class="userinput"><code>Speed</code></strong> parameter less than 0.5. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>180Turn</code></strong> | <strong class="userinput"><code>Steering</code></strong> with one condition: <strong class="userinput"><code>Speed</code></strong> parameter greater than 0.5. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds.</li></ul></div></li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/5aea60d4-792f-4f2d-b12e-7a5096cf9a16.png" /></div><p>Animator Controller with additional 180Turn transition animation</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Edit the <strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>Steering</code></strong> transition by adding two more conditions: <strong class="userinput"><code>DirectionRaw</code></strong> parameter greater than -160 and <strong class="userinput"><code>DirectionRaw</code></strong> parameter less than 160. Multiple conditions in the same transition work as an AND logical operator; all of them have to be met to trigger the transition.</li><li>The Animator Controller is set up, but we need to set the <strong class="userinput"><code>SpeedRaw</code></strong> and <strong class="userinput"><code>DirectionRaw</code></strong> parameters from scripts. We've created those two additional parameters because we need raw values here (not damped in time). First, open the script in which we calculate and set the <code class="literal">direction</code> and <code class="literal">speed</code> parameters. In this example, it is called <code class="literal">RootMotionSteering.cs</code>; you can find it in the <code class="literal">Chapter 04 Character movement\Recipe 03 Using root motion to steer a character\Scripts</code> directory.</li><li>We have two <code class="literal">float</code> variables there: <code class="literal">direction</code> and <code class="literal">speed</code>. They are being calculated every frame. We just need to make them <code class="literal">public</code> to be able to read them in another script (they are already public in the example script).</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Write another script and call it <code class="literal">SetRawDirectionAndSpeed.cs</code> (you can find it in the <code class="literal">Scripts</code> directory of this recipe). To set the <strong class="userinput"><code>DirectionRaw</code></strong> and <strong class="userinput"><code>SpeedRaw</code></strong> parameters, we use the following lines in the <code class="literal">Update()</code> function:</li></ol></div><pre class="programlisting">        anim.SetFloat("DirectionRaw", steeringScript.direction); 
        anim.SetFloat("SpeedRaw", steeringScript.speed); </pre><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>In the <span>preceding</span><a id="id325532012" class="indexterm"></a> lines, the <code class="literal">anim</code> variable is the reference to the Animator <span>component</span><a id="id325532059" class="indexterm"></a>, the <code class="literal">steeringScript</code> variable is the reference to the <strong class="userinput"><code>RootMotionScript</code></strong> component (we set it with the <code class="literal">steeringScript = GetComponent&lt;RootMotionSteering&gt;()</code> line in the <code class="literal">Start()</code> function), and the <code class="literal">steeringScript.direction</code> and <code class="literal">steeringScript.speed</code> variables are the calculated raw direction and speed values.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip11"></a>Note</h3><p>Alternatively, you can call the <code class="literal">anim.SetFloat("DirectionRaw", direction)</code> and <code class="literal">anim.SetFloat("SpeedRaw", speed)</code> methods directly in the <code class="literal">Update()</code> function of the <code class="literal">RootMotionSteering.cs</code> script (without writing another script).</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>Assign the script to the character, play the game, and try to walk in the direction opposite to the direction the character is facing. The character should start with an <strong class="userinput"><code>180Turn</code></strong> animation first.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec122"></a>How it works...</h3></div></div></div><p>This recipe adds a start animation that works as a transition between the <strong class="userinput"><code>Idle</code></strong> and <strong class="userinput"><code>Steering</code></strong> states. We use the <strong class="userinput"><code>SpeedRaw</code></strong> and <strong class="userinput"><code>DirectionRaw</code></strong> parameters to check the raw player input (not damped). Using damped values wouldn't work in this case because the damped <strong class="userinput"><code>Direction</code></strong> parameter always starts from 0 and increases in time to the raw input direction value. This would always trigger the <strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>Steering</code></strong> transition before the <strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>180Turn</code></strong> transition as the <strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>180Turn</code></strong> transition checks if the direction is greater than 160 or less than -160 degrees.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec123"></a>There's more...</h3></div></div></div><p>To make it <span>simple</span><a id="id325532167" class="indexterm"></a>, this <span>recipe</span><a id="id325532176" class="indexterm"></a> shows just one case of a start animation: the 180 degrees turn. You may require more start animations (-90 and +90 degrees turn or even -45, +45, -270, and +270 turns). You may also need to add a 180 degree turn transition from walking/running to make the character react to the input faster. In such a case, you may need to use <strong class="userinput"><code>Animation Curves</code></strong> to determine the walk/run position (<code class="literal">LeftPassing</code>, <code class="literal">RightPassing</code>, <code class="literal">LeftExtreme</code>, <code class="literal">RightExtreme</code>) and play an appropriate turn animation accordingly (starting with the <code class="literal">LeftPassing</code>, <code class="literal">RightPassing</code>, <code class="literal">LeftExtreme</code>, or <code class="literal">RightExtreme</code> pose).</p></div></div>