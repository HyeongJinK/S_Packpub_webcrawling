<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec89"></a>Using cloth</h2></div></div><hr /></div><p>In this recipe, we will create a simple <span>cloth simulation</span><a id="id325241232" class="indexterm"></a>:</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/1105b035-9180-43df-8150-09ef509bd564.png" /></div><p>Cloth simulation used to create a flag</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec276"></a>Getting ready</h3></div></div></div><p>For this recipe, we need a model of the cloth. It should be a plane divided several times to have enough vertices for the cloth simulation to work. In our example, we use one additional model: the flag pole. You can go to the <code class="literal">Chapter 09 Physics and animations\Recipe 01 Using cloth</code> directory. You will find a <strong class="userinput"><code>FlagPole</code></strong> game object in the <code class="literal">Example.unity</code> scene there. This object contains the <strong class="userinput"><code>Flag</code></strong> and the <strong class="userinput"><code>FlagPole</code></strong> objects as children. The <strong class="userinput"><code>Flag</code></strong> game object uses the cloth simulation.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec277"></a>How to do it...</h3></div></div></div><p>To use <span>cloth simulation</span><a id="id325550872" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Place the <strong class="userinput"><code>Flag</code></strong> game object in the scene.</li><li>Add the <strong class="userinput"><code>Cloth</code></strong> component to the <strong class="userinput"><code>Flag</code></strong> game object (go to <strong class="userinput"><code>Component</code></strong> | <strong class="userinput"><code>Physics</code></strong> | <strong class="userinput"><code>Cloth</code></strong>).</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Notice that a <strong class="userinput"><code>Skinned Mesh Renderer</code></strong> component is automatically added. You may remove the <strong class="userinput"><code>Mesh Renderer</code></strong> component from the object.</li><li>Find the mesh of the <strong class="userinput"><code>Flag</code></strong> and drag it to the <strong class="userinput"><code>Mesh</code></strong> field in the <strong class="userinput"><code>Skinned Mesh Renderer</code></strong> component. If your game object still has the <strong class="userinput"><code>Mesh Filter</code></strong> component, you may click on the mesh attached to it and it will be displayed in the <strong class="userinput"><code>Project</code></strong> View. This makes it easier to find the mesh we need.</li><li>If your game object still has the <strong class="userinput"><code>Mesh Filter</code></strong> component attached, you can remove it.</li><li>You may need to add a material to the <strong class="userinput"><code>Flag</code></strong> game object. If it lacks the material, drag appropriate materials into the <strong class="userinput"><code>Materials</code></strong> section in the <strong class="userinput"><code>Skinned Mesh Renderer</code></strong>.</li><li>Go to the <span>Cloth</span><a id="id325241690" class="indexterm"></a> component settings in the <strong class="userinput"><code>Inspector</code></strong> and click on the <strong class="userinput"><code>Edit Constraints</code></strong> button, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/22d2e075-a8e2-4052-8abb-815ebe6c79ad.png" /></div><p>Edit Constraints button</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>The <strong class="userinput"><code>Cloth Constraints</code></strong> window will appear, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/fc830e28-ee79-4c36-a6f4-eafde44c4e4a.png" /></div><p>Editing constraints</p><p></p><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>It is used to constrain the cloth movement. To pin a cloth to something, select the <strong class="userinput"><code>Paint</code></strong> tab and click on the <strong class="userinput"><code>Max Distance</code></strong> checkbox. By left-clicking on a vertex, you can paint it red, which means its movement is fully constrained. You may choose a different color to make the cloth move slightly. Black means no constrains at all.</li><li>After painting at least one vertex, you may switch to the <strong class="userinput"><code>Select</code></strong> tab. In this tab, you can box-select vertices. After selecting a group of vertices, you may check the <strong class="userinput"><code>Max Distance</code></strong> checkbox and edit the value for all selected <span>vertices</span><a id="id325241320" class="indexterm"></a> at once.</li><li>If you cannot select or paint the vertices, rotate the view—you may be looking at your mesh from the backfaces side. Selecting and painting works only on the frontfaces side, unless you check the <strong class="userinput"><code>Manipulate Backfaces</code></strong> option in the <strong class="userinput"><code>Visualization</code></strong> dropdown.</li><li>Our Flag's orientation is top to bottom (it is pinned with its top to the pole). So we should select all top vertices and paint them red (set the <strong class="userinput"><code>Max Distance</code></strong> to 0). In your case, you may want to pin other vertices.</li><li>To remove the constrain from any given vertex, select it (you need to be in the <strong class="userinput"><code>Select</code></strong> tab) and uncheck the <strong class="userinput"><code>Max Distance</code></strong> checkbox. The vertex will turn black, which means it is not constrained any more.</li><li>To make the <strong class="userinput"><code>Flag</code></strong> collide with other game objects, go to the <strong class="userinput"><code>Capsule Colliders</code></strong> and <strong class="userinput"><code>Sphere Colliders</code></strong> array in the <strong class="userinput"><code>Cloth</code></strong> component's settings. You may add <strong class="userinput"><code>Sphere Colliders</code></strong> or <strong class="userinput"><code>Capsule Colliders</code></strong> located in the scene here. <strong class="userinput"><code>Cloth</code></strong> can collide only with those two types of colliders.</li><li>Play the game to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec278"></a>How it works...</h3></div></div></div><p>Cloth simulation uses vertices of a mesh to simulate cloth-like behavior. The mesh needs to be dense enough to make the simulation look good. The flag used in this example has 100 vertices.</p><p>The <strong class="userinput"><code>Cloth</code></strong> component has a number of options to use and tweak:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Stretching Stiffness</strong></span>: How stiff the cloth is when stretching.</li><li style="list-style-type: disc"><span class="strong"><strong>Bending Stiffness</strong></span>: How stiff the cloth is when bending.</li><li style="list-style-type: disc"><span class="strong"><strong>Use Tethers</strong></span>: This helps prevent unconstrained vertices going too far away from the constrained ones</li><li style="list-style-type: disc"><span class="strong"><strong>Use Gravity</strong></span>: This applies gravity to cloth vertices.</li><li style="list-style-type: disc"><span class="strong"><strong>Damping</strong></span>: This damps the motion of cloth vertices.</li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>External Acceleration</strong></span>: This is a constant acceleration of cloth vertices and can be used to simulate wind.</li><li style="list-style-type: disc"><span class="strong"><strong>Random Acceleration</strong></span>: This is similar to the preceding option, but is random. It is useful for simulating wind.</li><li style="list-style-type: disc"><span class="strong"><strong>World Velocity Scale</strong></span>: This scales the world velocity of the object to which the cloth is attached to. It is useful for a character's clothing.</li><li style="list-style-type: disc"><span class="strong"><strong>World Acceleration Scale</strong></span>: This scales the world acceleration of cloth vertices when the object the cloth is attached to accelerates. It is useful for a character's clothing.</li><li style="list-style-type: disc"><span class="strong"><strong>Friction</strong></span>: The friction to apply when <span>cloth</span><a id="id325241452" class="indexterm"></a> vertices collide with something.</li><li style="list-style-type: disc"><span class="strong"><strong>Collision Mass Scale</strong></span>: This scales the mass of cloth vertices when they collide with something.</li><li style="list-style-type: disc"><span class="strong"><strong>Use Continuous Collision</strong></span>: This is similar to the continuous collision detection of the rigid bodies and improves collision quality but is heavier on performance.</li><li style="list-style-type: disc"><span class="strong"><strong>Use Virtual Particles</strong></span>: This adds one virtual particle/vertex per cloth triangle and improves collision quality.</li><li style="list-style-type: disc"><span class="strong"><strong>Solver Frequency</strong></span>: Number of solver iterations per second.</li><li style="list-style-type: disc"><span class="strong"><strong> Sleep Threshold</strong></span>: The threshold after which cloth stops being simulated (sleeps).</li><li style="list-style-type: disc"><span class="strong"><strong>Capsule Colliders</strong></span>: An array of capsule colliders to collide with.</li><li style="list-style-type: disc"><span class="strong"><strong>Sphere Colliders</strong></span>: An array of sphere colliders to collide with.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec279"></a>There's more...</h3></div></div></div><p>Cloth works best with single-sided flat meshes (subdivided planes). It can also be used on thin subdivided boxes. Avoid using copied planes with inverted face normals (that makes two sheets of cloth that constantly collide with each other).</p><p>For best results, you should use some kind of double-sided shader on the single-sided flat mesh. You may use a simple shader provided with the example project; you can find it in the <code class="literal">Textures materials and shaders\Shaders</code> directory. It doesn't support shadows. You can also find good double-sided shaders in the Asset Store; I can recommend the <span class="strong"><strong><span>Double Sided Standard</span><a id="id325241514" class="indexterm"></a> Mobile Legacy Shaders</strong></span> package created by Mario Lelas.</p><p>Cloth components can be used with any Skinned Mesh Renderer. So you can make parts of your characters be simulated as cloth. The best practice would be to have a second Skinned Mesh Renderer with just the cloth mesh (it will be far easier to constrain such mesh than trying to constrain the whole character).</p></div></div>