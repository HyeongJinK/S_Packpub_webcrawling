<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec63"></a>Using root motion to create a dodge move</h2></div></div><hr /></div><p>We can achieve a lot of <span>gameplay</span><a id="id325241217" class="indexterm"></a> actions in combat using just animations. A great example of such an action is the dodge move.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec194"></a>Getting ready</h3></div></div></div><p>To follow this recipe, we need a character with <strong class="userinput"><code><span>SpiderIdle</span><a id="id325241233" class="indexterm"></a></code></strong> and <strong class="userinput"><code>Dodge</code></strong> animations (we will be using our <strong class="userinput"><code>Spider</code></strong> character in this example). The dodge animation should be created with root motion. Please check the example in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/13ef0c77-61b8-4c72-8fd1-e8e2f3baea2c.png" /></div><p>Spider dodge with root motion translation</p><p>You can also go to the <code class="literal">Chapter 06 Handling combat\Recipe 04 Using root motion to create a dodge move</code> directory. Open the <code class="literal">Example.unity</code> scene there. You will find the same <strong class="userinput"><code>Humanoid</code></strong> and <strong class="userinput"><code>Spider</code></strong> characters we had in previous recipes. They have the same animations and scripts as in the <span class="emphasis"><em>Using transitions from Any State to play hit reactions</em></span> recipe. The <strong class="userinput"><code>Spider</code></strong> has one additional animation: <strong class="userinput"><code>Dodge</code></strong>. If you hit the space bar in <strong class="userinput"><code>Play Mode</code></strong>, the <strong class="userinput"><code>Spider</code></strong> will attempt to dodge the sword swing. You can find all the necessary animations in the <code class="literal">Chapter 06 Handling combat\Recipe 02 Using animation events to trigger script functions\Rigs</code> directory.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec195"></a>How to do it...</h3></div></div></div><p>To make a <span>character dodg</span><a id="id325241310" class="indexterm"></a>e, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import the character into Unity and place it in a scene.</li><li>If you want the character to get damage and play hit reactions, follow the previous recipe.</li><li>Create a new Animator Controller or edit the one from the previous recipe.</li><li>Drag and drop the <strong class="userinput"><code>Dodge</code></strong> animation into the controller.</li><li>Create a <strong class="userinput"><code>Dodge </code></strong><code class="literal">Trigger</code> parameter in the controller.</li><li>Create two transitions:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>SpiderIdle</code></strong> | <strong class="userinput"><code>Dodge</code></strong> with one condition: <strong class="userinput"><code>Dodge </code></strong><code class="literal">Trigger</code> parameter. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to false and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>Dodge</code></strong> | <strong class="userinput"><code>SpiderIdle</code></strong> with no conditions: <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds.</li></ul></div></li><li>Add a <strong class="userinput"><code>Rigidbody</code></strong> component to the <strong class="userinput"><code>Spider</code></strong> character and freeze its rotations.</li><li>Add a collider to the <strong class="userinput"><code>Spider</code></strong> character (we are using <strong class="userinput"><code>Sphere Collider</code></strong> for our <strong class="userinput"><code>Spider</code></strong>). You may also need to create a zero friction <strong class="userinput"><code>Physical Material</code></strong> and add it to the collider. It allows the animation to control Rigid Body movement without any additional friction.</li><li>Set the <strong class="userinput"><code>Animator</code></strong> component's <strong class="userinput"><code>Update Mode</code></strong> to <strong class="userinput"><code>Animate Physics</code></strong> in our <strong class="userinput"><code>Spider</code></strong>.</li><li>Attach the controller to the <strong class="userinput"><code>Animator</code></strong> component of our <strong class="userinput"><code>Spider</code></strong>.</li><li>Create a new script and call it <code class="literal">Dodge.cs</code>. In this script's <code class="literal">Update()</code> function, we simply set the <strong class="userinput"><code>Dodge </code></strong><code class="literal">Trigger</code> in the controller when player presses the space bar:</li></ol></div><pre class="programlisting">        if (Input.GetKeyDown(KeyCode.Space)) 

        { 

            anim.SetTrigger("Dodge"); 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>As always, the <code class="literal">anim</code> variable stores the reference to the <strong class="userinput"><code>Animator</code></strong> component and is set in the <code class="literal">Start()</code> function.</li><li>Attach the script to the <strong class="userinput"><code>Spider</code></strong> character.</li><li>Play the game and press the space bar to see the <strong class="userinput"><code>Spider</code></strong> play the dodge animation. It should be able to get out of the <strong class="userinput"><code>Humanoid</code></strong> character's attack range and avoid being hit.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec196"></a>How it works...</h3></div></div></div><p>This recipe uses a very simple, yet powerful concept. The only additional thing we do here is triggering the <strong class="userinput"><code>Dodge</code></strong> animation. This animation uses root motion and translates our <strong class="userinput"><code>Spider</code></strong> character. Our <strong class="userinput"><code>Humanoid</code></strong> character uses the <strong class="userinput"><code>Attack Animation Event</code></strong> and the <strong class="userinput"><code>TargetTrigger</code></strong> to check if an enemy is in its attack range (see the <span class="emphasis"><em>Using Animation Events to trigger script functions</em></span> recipe for details). If our <strong class="userinput"><code>Spider</code></strong> leaves the <strong class="userinput"><code>TargetTrigger</code></strong> before the <strong class="userinput"><code>Attack</code></strong> event occurs, it will avoid being hit.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec197"></a>There's more...</h3></div></div></div><p>The <span>Dodge animation</span><a id="id325509833" class="indexterm"></a> will also work for other hit detection mechanisms. For instance, you can manually check the range and attack angle in the <strong class="userinput"><code>Attack</code></strong> event using the <code class="literal">Vector3.Distance()</code> and <code class="literal">Vector3.Angle()</code> methods. You can also use a <strong class="userinput"><code>Rigidbody</code></strong> component on the sword and check its collisions with the <code class="literal">void OnCollisionEnter(Collision collision)</code> method. In both cases, our <strong class="userinput"><code>Dodge</code></strong> move will work just fine. It will also work for bullets that use collisions to determine hits (for example, arrows).</p><p>You can use the same concept for other actions: dashes, combos, and some crazy melee attacks that use root translation and/or rotation (for instance, jump attacks). Root motion is a very powerful tool for combat design. Try experimenting with your own animation ideas to create interesting moves and actions.</p></div></div>