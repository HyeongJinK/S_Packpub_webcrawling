<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec53"></a>Using Blend Trees to create randomized actions</h2></div></div><hr /></div><p>In this recipe, we will create a simple <span>randomized action</span><a id="id325241217" class="indexterm"></a> using a <span>Blend Tree</span><a id="id325241225" class="indexterm"></a>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec159"></a>Getting ready</h3></div></div></div><p>Before we start, we need to have a character with at least two different animations for the randomization to work. In this example, we are using a character with the <strong class="userinput"><code>Walk</code></strong>, <strong class="userinput"><code>Idle</code></strong>, <strong class="userinput"><code>Hurray</code></strong>, <strong class="userinput"><code>Wave</code></strong>, and <strong class="userinput"><code>PickUp</code></strong> animations. The <strong class="userinput"><code>Walk</code></strong> and <strong class="userinput"><code>Idle</code></strong> animations are used as helpers. The three others are being randomized. You can also use the example project; go to the <code class="literal">Chapter 05 Character actions and expressions\Recipe 03 Using blend trees to create randomized actions</code> directory. You can find the <code class="literal">Example.scene</code> scene there, with two characters. You can start the game to see the effect. Both characters should play different animation after walking. You may need to start the game several times because we have only three animations to pick from, so there is a 9 percent chance that both characters will play the same animation. In the <code class="literal">Rigs</code> directory, you can find the required animations.</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/4f7cc977-60a2-4585-9716-2944f64d7ccd.png" /></div><p>Characters with randomized animations</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec160"></a>How to do it...</h3></div></div></div><p>To use <span>randomized</span><a id="id325526659" class="indexterm"></a><span>animations</span><a id="id325526666" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import your character with the animations to pick from. In our case, they are <strong class="userinput"><code>Hurray</code></strong>, <strong class="userinput"><code>Wave</code></strong>, and <strong class="userinput"><code>PickUp</code></strong>. We also use <strong class="userinput"><code>Idle</code></strong> and <strong class="userinput"><code>Walk</code></strong> animations (the Walk animation is used before the randomized action and the Idle animation is used after).</li><li>Create a new Animator Controller (or edit an existing one).</li><li>Create a new <code class="literal">float</code> parameter in the controller and call it <code class="literal">Random</code>.</li><li>Create a new <strong class="userinput"><code>Blend Tree</code></strong> in the controller and name it <code class="literal">RandomAction</code>.</li><li>In the <strong class="userinput"><code>Blend Tree</code></strong> settings, add <strong class="userinput"><code>Motion Fields</code></strong> for your randomized animations. In our example, we have three <strong class="userinput"><code>Motion Fields</code></strong> (for <strong class="userinput"><code>Hurray</code></strong>, <strong class="userinput"><code>Wave</code></strong>, and <strong class="userinput"><code>PickUp</code></strong>).</li><li>Assign your animations to the <strong class="userinput"><code>Motion Fields</code></strong>.</li><li>Choose the <strong class="userinput"><code>Random</code></strong> parameter as the <strong class="userinput"><code>Parameter</code></strong> of the <strong class="userinput"><code>Blend Tree</code></strong>.</li><li>Uncheck the <strong class="userinput"><code>Automate Thresholds</code></strong> option.</li><li>Set the <strong class="userinput"><code>Thresholds</code></strong> to integer numbers, starting from 0. In our example, they are 0, 1, and 2.</li><li>Exit <strong class="userinput"><code>Blend Tree</code></strong> settings.</li><li>Create transitions to and from the <strong class="userinput"><code>Blend Tree</code></strong>, if needed. In our example, we have following transitions:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Walk</code></strong> | <strong class="userinput"><code>RandomAction</code></strong> with no conditions: <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds. Our scene starts with the characters playing one cycle of the <strong class="userinput"><code>Walk</code></strong> animation and then transitioning to the <strong class="userinput"><code>RandomAction</code></strong> Blend Tree.</li><li style="list-style-type: disc"><strong class="userinput"><code>RandomAction</code></strong> | <strong class="userinput"><code>Idle</code></strong> with no conditions: <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds. Our scene ends with the characters transitioning from <strong class="userinput"><code>RandomAction</code></strong> to <strong class="userinput"><code>Idle</code></strong> animation.</li></ul></div></li><li>Place the character in the scene.</li><li>Assign the controller to the character's Animator component.</li><li>Create a new script and call it <code class="literal">RandomAction.cs</code>.</li><li>In this script's <code class="literal">Start()</code> function, we create an integer random value and set it as the value of our <code class="literal">float </code><strong class="userinput"><code>Random</code></strong> parameter in the controller:</li></ol></div><pre class="programlisting">        Animator anim = GetComponent&lt;Animator&gt;(); 
        int randomValue = Random.Range(0, numActions); 
        anim.SetFloat("Random", (float)randomValue); </pre><div class="orderedlist"><ol class="orderedlist arabic" start="16" type="1"><li>In the preceding script, <code class="literal">numActions</code> is a <code class="literal">public int</code> variable that stores the total number of randomized actions in our <strong class="userinput"><code>Blend Tree</code></strong> (3 in our example).</li><li>Assign the script to the character and play the game to see the effect. You may need to start the game multiple times or copy the character several times.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec161"></a>How it works...</h3></div></div></div><p>The trick here is to set the <strong class="userinput"><code>Random</code></strong> parameter in the controller before we transition to the <strong class="userinput"><code>Blend Tree</code></strong>. This way we don't see the sudden change in the animations (the animation is already chosen before we start playing it).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Note</h3><p>We are still using the <code class="literal">float</code> type parameter in the <strong class="userinput"><code>Blend Tree</code></strong> because we cannot use integers in <strong class="userinput"><code>Blend Trees</code></strong> in Unity.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec162"></a>There's more...</h3></div></div></div><p>There are situations where you need to have multiple randomized animations played one after another, for instance, when your character is standing in place and performing some random actions. To be able to set the parameter responsible for randomizing the animations, you may need to transition through a neutral <strong class="userinput"><code>Idle</code></strong> pose. In that state, you can set the parameter value safely. See the following image:</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/ed9b1d91-e0a0-483b-9e45-a888d353fb04.png" /></div><p>Setting the parameter in the safe Idle state</p><p>Additionally, if your random actions blend together nicely (maybe they are different versions of the <strong class="userinput"><code>Idle</code></strong> animation), you can allow the parameter to change when you are already in the <strong class="userinput"><code>Blend Tree</code></strong>. To do so, make sure to use the <code class="literal">SetFloat()</code> function with the <code class="literal">dampTime</code> parameter set to an appropriate value (0.5 should be okay, but you will need to experiment).</p></div></div>