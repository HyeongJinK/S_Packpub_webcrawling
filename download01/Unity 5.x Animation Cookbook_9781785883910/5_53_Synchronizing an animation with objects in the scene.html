<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec56"></a>Synchronizing an animation with objects in the scene</h2></div></div><hr /></div><p>In this recipe, we will synchronize a character's <span>animation</span><a id="id325241268" class="indexterm"></a> with an object placed in the scene. This is again a common mechanism used in games.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec171"></a>Getting ready</h3></div></div></div><p>To follow this recipe, you need two animated game objects: a character and an interactive object. In our example, we use a wheel lever that the character can rotate. We use only two <span>animation</span><a id="id325241352" class="indexterm"></a>s, <strong class="userinput"><code>WheelStart</code></strong> and <strong class="userinput"><code>WheelLoop</code></strong>, for both the <strong class="userinput"><code>Character</code></strong> and the <strong class="userinput"><code>Wheel</code></strong> objects. The animations have the same number of frames and are synchronized in a 3D package already. You can also open the provided example Unity project and go to the <code class="literal">Chapter 05 Character actions and expressions\Recipe 06 Synchronizing an animation with objects in the scene</code> directory. You will find an <code class="literal">Example.scene</code> there. Play the game and press the space bar to see the <strong class="userinput"><code>Character</code></strong> and the <strong class="userinput"><code>Wheel</code></strong> play a synchronized animation. You will find all the necessary animations in the <code class="literal">Rigs</code> directory.</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/b5c04306-62ed-4803-9218-ca53247661c2.png" /></div><p>Character and Wheel objects playing synchronized animations</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec172"></a>How to do it...</h3></div></div></div><p>To make the two objects play synchronized <span>animation</span><a id="id325241581" class="indexterm"></a>s, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import the <strong class="userinput"><code>Character</code></strong> and <strong class="userinput"><code>Wheel</code></strong> objects into Unity.</li><li>Set the <strong class="userinput"><code>Loop Time</code></strong> option in the <strong class="userinput"><code>WheelLoop</code></strong> animations for both the <strong class="userinput"><code>Wheel</code></strong> and the <strong class="userinput"><code>Character</code></strong>.</li><li>Place the <strong class="userinput"><code>Character</code></strong> and the <strong class="userinput"><code>Wheel</code></strong> in the scene and match their position according to what was set in the 3D package.</li><li>Create an <strong class="userinput"><code>Animator Controller</code></strong> for the Character.</li><li>Insert the <strong class="userinput"><code>WheelStart</code></strong> and <strong class="userinput"><code>WheelLoop</code></strong> animations into the controller. Make sure the <strong class="userinput"><code>WheelStart</code></strong> animation is the default state.</li><li>Create a <strong class="userinput"><code>PlayAnim</code></strong> bool parameter in the controller.</li><li>Create two transitions:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>WheelStart</code></strong> | <strong class="userinput"><code>WheelLoop</code></strong> with one condition: <strong class="userinput"><code>PlayAnim</code></strong> parameter set to true parameter. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to false and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>WheelLoop</code></strong> | <strong class="userinput"><code>WheelStart</code></strong> with one conditions: <strong class="userinput"><code>PlayAnim</code></strong> parameter set to false. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds.</li></ul></div></li><li>Assign the controller to the <strong class="userinput"><code>Character</code></strong> game object's <strong class="userinput"><code>Animator</code></strong> component.</li><li>Create an <strong class="userinput"><code>Animator Override Controller</code></strong>. Derive it from the <strong class="userinput"><code>Character's</code></strong> controller. Assign it to the <strong class="userinput"><code>Wheel</code></strong> game object's <strong class="userinput"><code>Animator</code></strong> component.</li><li>Change the animations in the override controller to the <strong class="userinput"><code>Wheel's</code></strong> animations.</li><li>Write a new script and call it <code class="literal">PlayAndStop.cs</code>. In that script's <code class="literal">Update()</code> function, we check if the player pressed the space bar. If so, we set the <strong class="userinput"><code>PlayAnim </code></strong><code class="literal">bool</code> parameter to its inverted value in both the <strong class="userinput"><code>Character's</code></strong> and <strong class="userinput"><code>Wheel's</code></strong> animator controllers:</li></ol></div><pre class="programlisting">        if (Input.GetKeyDown(KeyCode.Space)) 
        { 
            play = !play; 
            characterAnimator.SetBool("PlayAnim", play); 
            objectAnimator.SetBool("PlayAnim", play); 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>In the preceding script, <code class="literal">play</code> is a helper member variable, <code class="literal">characterAnimator</code> is a reference to the <strong class="userinput"><code>Character</code></strong> game object's Animator component, and <code class="literal">objectAnimator</code> is the reference to the <strong class="userinput"><code>Wheel</code></strong> game object's Animator component.</li><li>Assign the script to the <strong class="userinput"><code>Character</code></strong> game object.</li><li>Drag and drop the <strong class="userinput"><code>Character</code></strong> game object to the <strong class="userinput"><code>Character Animator</code></strong> field in the script and the <strong class="userinput"><code>Wheel</code></strong> game object to the <strong class="userinput"><code>Object Animator</code></strong> field.</li><li>Play the game and press the space bar to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec173"></a>How it works...</h3></div></div></div><p>Animations that have the same number of frames and the same playback speed are synchronized in Unity. All we need to care about is to start them in the same frame. That's why we have the <strong class="userinput"><code>WheelStart</code></strong> animations. We also need to take care of the transitions—if the transitions length differs in both <strong class="userinput"><code>Animator Controllers</code></strong>, the animations can be out of sync.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec174"></a>There's more...</h3></div></div></div><p>You can combine this and the previous recipe to create <strong class="userinput"><code>Action Points</code></strong> with synchronized object <span>animation</span><a id="id325509851" class="indexterm"></a>. Make sure to have the <strong class="userinput"><code>Pre-Action</code></strong> animation before a looped action. This way it will be easier to trigger the animations in the same time (for instance, from an <strong class="userinput"><code>Animation Event</code></strong> inside the <strong class="userinput"><code>Pre-Action</code></strong> animation).</p><p>You may also need to turn off <strong class="userinput"><code>Rigidbody</code></strong> physics and the <strong class="userinput"><code>NavMesh</code></strong> Agent component for your character to make it stand in the right position before playing the animation. We did it in the <span class="emphasis"><em>Using triggers to grab an edge while jumping</em></span> recipe in <span><a class="link" href="#" linkend="ch04">Chapter 4</a></span>, <span class="emphasis"><em>Character Movement</em></span>.</p></div></div>