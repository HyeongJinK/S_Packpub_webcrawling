<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec14"></a>Using parameters to control the animation flow</h2></div></div><hr /></div><p>You can define a set of parameters in an Animator Controller and use them to control the transitions between animation states in Mecanim. In this recipe, we will show how to use <span>parameters</span><a id="id325289100" class="indexterm"></a> for transition conditions and use scripts to set values of those <span>parameters</span><a id="id325289109" class="indexterm"></a> in runtime.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec28"></a>Getting ready</h3></div></div></div><p>Before we start, you should prepare an Animator Controller with at least one transition between animation states. The controller should be assigned to a character (its Animator component) placed in a scene. You can also use the provided example Unity project and go to the <code class="literal">Chapter 01 Working with animations\Recipe 05 Using parameters to control the animation flow</code> directory. You will find an <code class="literal">Example.unity</code> scene there. There is a <strong class="userinput"><code>Warrior</code></strong> game object in the scene's <strong class="userinput"><code>Hierarchy</code></strong>. If you run the game and press the space bar, the <strong class="userinput"><code>Warrior</code></strong> will make a wave gesture. You can select the <strong class="userinput"><code>Warrior</code></strong> and open his <strong class="userinput"><code>Animator Controller</code></strong>. If you click on the <strong class="userinput"><code>Idle</code></strong> | <strong class="userinput"><code>Wave</code></strong> transition, you will be able to see the transition condition.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec29"></a>How to do it...</h3></div></div></div><p>To use <span>parameters</span><a id="id325532140" class="indexterm"></a> for controlling <span>state transitions</span><a id="id325532149" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the <strong class="userinput"><code>Animator Controller</code></strong> asset.</li><li>Find the <strong class="userinput"><code>Parameters</code></strong> tab in the upper left corner of the <strong class="userinput"><code>Animator</code></strong> window and click on it.</li><li>Click on the plus icon in the <strong class="userinput"><code>Parameters</code></strong> tab to add a new parameter.</li><li>Choose the <strong class="userinput"><code>Trigger</code></strong> type for the parameter.</li><li>Type a name of the newly created parameter (in the provided example, the name of the parameter is <code class="literal">Wave</code>).</li><li>Click on the transition between states you want to use parameters for. In the provided example, it is the transition between <strong class="userinput"><code>Idle</code></strong> and <strong class="userinput"><code>Wave</code></strong> animation states. <strong class="userinput"><code>Idle</code></strong> is the default state.</li><li>Go to the <strong class="userinput"><code>Inspector</code></strong> tab and find the <strong class="userinput"><code>Conditions</code></strong> section.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Click on the plus icon to add a new condition. If you have only one parameter, it will be chosen as the condition automatically. If you have more parameters, you need to choose the proper one from a drop-down list.</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/7ed925a2-ab6f-4752-bbf9-4143a16cce25.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>If you want to make an <span>immediate</span><a id="id325540286" class="indexterm"></a> transition between your animation states, make sure to disable the <strong class="userinput"><code>Has Exit Time</code></strong> option, found above the <strong class="userinput"><code>Settings</code></strong> foldout.</li><li>Your <span>transition</span><a id="id325540339" class="indexterm"></a> will take place only when its conditions are met. You need to set the parameter using scripts.</li><li>To create a new C# script, click on the right mouse button in the <strong class="userinput"><code>Project View</code></strong> and select <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>C# Script</code></strong>. Name the script as you wish (in the provided example, it's called <code class="literal">Wave</code>, the same as the parameter it sets).</li><li>Open the script and write the following:</li></ol></div><pre class="programlisting">      using UnityEngine; 
      using System.Collections; 
 
      public class Wave : MonoBehaviour { 
      //The anim variable is used to store the reference 
      //to the Animator component of the character. 
      private Animator anim; 
      void Start () { 
      //We get the component and assign it to 
      //the anim variable when the game starts 
      anim = GetComponent&lt;Animator&gt;(); 
      } 
      void Update () { 
      //We check if player pressed the spacebar 
      if (Input.GetKeyDown(KeyCode.Space)) 
      { 
      /*We cal the SetTrigger() function on the 
      Animator component stored in the anim 
      variable. The function requires one 
      parameter - the name of the trigger 
      parameter set in our Animator Controller 
      ("Wave" in our example). Make sure to match 
      it with the name of the parameter you've 
      created in your Animator Controller*/ 
      anim.SetTrigger("Wave"); 
      } 
      } 
      } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>Make sure your class name is the same as the file name of the script, as it won't compile otherwise.</li><li>Assign the script to the character, to the same <strong class="userinput"><code>Transform</code></strong> that has the <strong class="userinput"><code>Animator</code></strong> component with your <strong class="userinput"><code>Animator Controller</code></strong> attached. Play the game and press the space bar; you should see your character switch to the next animation state.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec30"></a>How it works...</h3></div></div></div><p>You can use several types of <span>parameters</span><a id="id325549052" class="indexterm"></a> and corresponding script functions to set them:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Trigger</strong></span>: This is the simplest parameter. It is set to <span class="emphasis"><em>true</em></span> with the <code class="literal">SetTrigger(string name)</code> function called on the <strong class="userinput"><code>Animator</code></strong> component object. It is reset by the <strong class="userinput"><code>Animator Controller</code></strong> after it is consumed (used) by a transition. The <code class="literal">string name</code> parameter of the function has to match your trigger parameter name set in the <strong class="userinput"><code>Animator Controller</code></strong>.</li><li style="list-style-type: disc"><span class="strong"><strong>Int</strong></span>: This is an integer <span>parameter</span><a id="id325550904" class="indexterm"></a>. When you use it, you have to specify a logical comparison in the condition. The transition will only occur if the value of the parameter meets the comparison condition with a given number. You can use the <strong class="userinput"><code>Equal</code></strong>, <strong class="userinput"><code>Greater</code></strong>, <strong class="userinput"><code>Less</code></strong>, and <strong class="userinput"><code>Not Equal</code></strong> options to compare the value of your parameter with the given number. Integer type parameters are set with the <code class="literal">SetInteger(string name, int value)</code> function. The <code class="literal">string name</code> parameter needs to match the parameter name set in the controller. The <code class="literal">int value</code> parameter is the value to set the controller parameter to.</li><li style="list-style-type: disc"><span class="strong"><strong>Float</strong></span>: This is a float <span>parameter</span><a id="id325533067" class="indexterm"></a>. It works the same as the integer type, but uses floating point numbers instead of integers. It is set using the <code class="literal">SetFloat(string name, float value)</code> function.</li><li style="list-style-type: disc"><span class="strong"><strong>Bool</strong></span>: This is a Boolean par<span>ameter</span><a id="id325533085" class="indexterm"></a>. The condition can check if the parameter is true or false. The value of the parameter is set with the <code class="literal">SetBool(string name, bool value)</code> function.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec31"></a>There's more...</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">You can add more than one condition to a state transition by clicking on the plus icon in the <strong class="userinput"><code>Conditions</code></strong> section in the transition <strong class="userinput"><code>Inspector</code></strong>. For the transition to occur, all its conditions have to be met. It works as logical <span class="emphasis"><em>AND</em></span> for the conditions.</li><li style="list-style-type: disc">You can also create more than one transition between the same states. To do this, right-click on the state you want to transition from and choose the <strong class="userinput"><code>Make Transition</code></strong> option, and then select the state you already have a transition to. A multi-transition is marked with three arrows instead of one. If the conditions of any of the transitions are met, the transition will occur. You can use it as logical <span class="emphasis"><em>OR</em></span> for transition conditions.</li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">If you have more than one transition between states, you can only edit one of them at a time. To edit a transition, select it in the <strong class="userinput"><code>Transitions</code></strong> section of the <strong class="userinput"><code>Inspector</code></strong>.</li></ul></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/15f34ac2-0717-4e88-a467-97ec0b53a199.png" /></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">If you want to remove a transition, select it in the <strong class="userinput"><code>Inspector</code></strong> and click on the minus icon, or select it in the <strong class="userinput"><code>Animator Controller</code></strong> and press <span class="emphasis"><em><span class="strong"><strong>Delete</strong></span></em></span> on the keyboard. Pressing <span class="emphasis"><em><span class="strong"><strong>Delete</strong></span></em></span> removes all the transitions.</li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">If you want to remove a condition from a transition, select it in the <strong class="userinput"><code>Inspector</code></strong> tab and click on the minus icon. To select a condition, you need to click on the handle to the left of the condition drop-down list (the handle looks like a = sign).</li><li style="list-style-type: disc">If you want to remove a parameter from the <strong class="userinput"><code>Animator Controller</code></strong>, you need to click on the handle on the left of the parameter and press the <span class="emphasis"><em><span class="strong"><strong>Delete</strong></span></em></span> button on the keyboard. You can also right-click on the parameter and choose the <strong class="userinput"><code>Delete</code></strong> option from the context menu.</li></ul></div></div></div>