<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec74"></a>Using additive Mecanim layers to add extra motion to a character</h2></div></div><hr /></div><p>In previous recipes, we were using <span>Mecanim layers</span><a id="id325241223" class="indexterm"></a> in override mode. We can set a layer to be additive. This can add additional movement to our base layer animations.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec232"></a>Getting ready</h3></div></div></div><p>We will need a character with three animations: <strong class="userinput"><code>Idle</code></strong>, <strong class="userinput"><code>TiredReference</code></strong>, and <strong class="userinput"><code>Tired</code></strong>. The <strong class="userinput"><code>Idle</code></strong> animation is a normal, stationary idle. The <strong class="userinput"><code>TiredReference</code></strong> animation has no motion and is used as a reference pose for calculating additive motion from the <strong class="userinput"><code>Tired</code></strong> animation. The <strong class="userinput"><code>TiredReference</code></strong> animation can be the first frame of the <strong class="userinput"><code>Tired</code></strong> animation. In the <strong class="userinput"><code>Tired</code></strong> animation, our character is breathing heavily.</p><p>You can also go to the <code class="literal">Chapter 07 Special effects\Recipe 04 Using additive mecanim layers to add extra motion to a character</code> directory. Open the <code class="literal">Example.unity</code> scene there. You will find the same <strong class="userinput"><code>Humanoid</code></strong> character there. If you play the game and press the space bar, our character will start breathing heavily while still playing the <strong class="userinput"><code>Idle</code></strong> animation. You can find all the needed animations in the <code class="literal">Rigs</code> directory.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec233"></a>How to do it...</h3></div></div></div><p>To use <span>additive layers</span><a id="id325241438" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import the character into Unity and place it in a scene.</li><li>Go to the <strong class="userinput"><code>Animation</code></strong> tab in the <strong class="userinput"><code>Import Settings</code></strong>.</li><li>Find the <strong class="userinput"><code>TiredReference</code></strong> animation and check the <strong class="userinput"><code>Additive Reference Pose</code></strong> option (you can also use the normal <strong class="userinput"><code>Tired</code></strong> animation and specify the frame in the <strong class="userinput"><code>Pose Frame</code></strong> field).</li><li>Loop the <strong class="userinput"><code>Idle</code></strong> and <strong class="userinput"><code>Tired</code></strong> animations.</li><li>Create a new Animator Controller.</li><li>Drag and drop the <strong class="userinput"><code>Idle</code></strong> animation into the controller and make it the <strong class="userinput"><code>Default</code></strong> state.</li><li>Find the <strong class="userinput"><code>Layers</code></strong> tab in upper left corner of the <strong class="userinput"><code>Animator</code></strong> window.</li><li>Select it and click on the plus button below to add a new layer.</li><li>Name the newly created layer <strong class="userinput"><code>Tired</code></strong>.</li><li>Click on the <strong class="userinput"><code>Gear</code></strong> icon and set the <strong class="userinput"><code>Blending</code></strong> to <strong class="userinput"><code>Additive</code></strong>, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/486a65ca-8d53-4f81-a97b-0c480dcd6eaa.png" /></div><p>Additive layer settings</p><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Drag and drop the <strong class="userinput"><code>Tired</code></strong> animation to the newly created layer.</li><li>Assign the controller to our character.</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>Create a new script and call it <code class="literal">Tired.cs</code>. In this script's <code class="literal">Update()</code> function, we set the weight of the <strong class="userinput"><code>Tired</code></strong> layer when player presses the space bar. The <strong class="userinput"><code>Tired</code></strong> layer has the index of 1. We use a helper variable <code class="literal">weightTarget</code> to set the new <code class="literal">weight</code> to 0 or 1, depending on its current value. This allows us to switch the additive layer on and off every time player presses the space bar. Finally, we interpolate the <code class="literal">weight</code> value in time to make the transition more smooth and we set the <code class="literal">weight</code> of our additive layer with the <code class="literal">SetLayerWeight()</code> function:</li></ol></div><pre class="programlisting">        if (Input.GetKeyDown(KeyCode.Space)) 
        { 
            if (weightTarget &lt; 0.5f) 
            { 
                weightTarget = 1f; 
            } 
            else if (weightTarget &gt; 0.5f) 
            { 
                weightTarget = 0f; 
            } 
        } 
        weight = Mathf.Lerp(weight, weightTarget, Time.deltaTime *
        tiredLerpSpeed); 
 
        anim.SetLayerWeight(1, weight); </pre><div class="orderedlist"><ol class="orderedlist arabic" start="14" type="1"><li>Attach the script to the <strong class="userinput"><code>Humanoid</code></strong> character.</li><li>Play the game and press the space bar to see the additive animation effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec234"></a>How it works...</h3></div></div></div><p>Additive animations are calculated using the reference pose. Movements relative to this pose are then added to other animations. This way we can not only override the base layer with other layers but also modify the base movements by adding secondary motion.</p><p>Try experimenting with different additive animations. You can, for instance, make your character bend, aim, or change its overall body pose.</p><p> </p></div></div>