<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec43"></a>Making a character jump with 3-phase animation</h2></div></div><hr /></div><p>In this recipe, we will make our <span>character</span><a id="id325289099" class="indexterm"></a> jump. Jumping is best done with physics, so we will use this approach.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec124"></a>Getting ready</h3></div></div></div><p>Before we start, you should add three more animations to your character: a short <strong class="userinput"><code>Jump</code></strong> animation starting on the ground in a pose similar to <strong class="userinput"><code>Idle</code></strong>; an <strong class="userinput"><code>InAir</code></strong> animation, a looped animation of the character being in the air; and a <strong class="userinput"><code>Land</code></strong> animation starting when the character touches the ground with his feet and ending with the <strong class="userinput"><code>Idle</code></strong> pose. All those animations should be done "in place" without root node translation. You can open the provided example Unity project and go to the <code class="literal">Chapter 04 Character movement\Recipe 06 Making a character jump with 3-phase animation</code> directory. You will find an <code class="literal">Example.unity</code> scene there. Play the game and press the space bar to see the character jump. You will find all the animations needed in the <code class="literal">Rigs</code> directory.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec125"></a>How to do it...</h3></div></div></div><p>To make the character jump, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import the character and repeat all the steps from the <span class="emphasis"><em>Using root motion to steer a character</em></span>, <span class="emphasis"><em>Using animations for better looking transitions</em></span>, and <span class="emphasis"><em>Using root motion for a 180 degrees turn</em></span> recipes to have a character that is able to move properly.</li><li>In the <strong class="userinput"><code>Animation Import Settings</code></strong> of the character, find your additional <strong class="userinput"><code>Jump</code></strong>, <strong class="userinput"><code>InAir</code></strong>, and <strong class="userinput"><code>Land</code></strong> animations. You may need to add them as new clips by clicking on the plus button in the <strong class="userinput"><code>Clips</code></strong> section (<strong class="userinput"><code>Animations</code></strong> tab) and choosing the appropriate animation as the source.</li><li>Check all the <strong class="userinput"><code>Bake Into Pose</code></strong> options for in <strong class="userinput"><code>Jump</code></strong>, <strong class="userinput"><code>InAir</code></strong>, and <strong class="userinput"><code>Land</code></strong> animations.</li><li>Open the Animator Controller (this should be the same controller as in the previous recipe) and add two parameters: a <code class="literal">Trigger</code> called <strong class="userinput"><code>Jump</code></strong> and a <code class="literal">bool</code> called <strong class="userinput"><code>OnGround</code></strong>.</li><li>Drag and drop your <strong class="userinput"><code>Jump</code></strong>, <strong class="userinput"><code>InAir</code></strong>, and <strong class="userinput"><code>Land</code></strong> animations into the Animator Controller.</li><li>Create these transitions, as shown in the following screenshot:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Any State</code></strong>|<strong class="userinput"><code>Jump</code></strong>with a<strong class="userinput"><code>Jump</code></strong>trigger parameter.<strong class="userinput"><code>Has Exit Time</code></strong>should be set to false and<strong class="userinput"><code>Transition Duration</code></strong>set to around 0.1 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>Jump</code></strong> | <strong class="userinput"><code>InAir</code></strong> with no conditions: <strong class="userinput"><code>Has Exit Time</code></strong> should be set to true and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>InAir</code></strong> | <strong class="userinput"><code>Idle</code></strong> with one condition: <strong class="userinput"><code>OnGround</code></strong> parameter set to true.<strong class="userinput"><code>Has Exit Time</code></strong> should be set to false and <strong class="userinput"><code>Transition Duration</code></strong> set to around 0.1 seconds.</li></ul></div></li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Create a new script and call it <code class="literal">Jump.cs</code> (you can find it in the <code class="literal">Scripts</code> directory of this recipe).</li><li>In the <code class="literal">Update()</code> function of the script, we check if player pressed the space bar and if the character is on the ground: the <code class="literal">onGround</code> variable is set by the <code class="literal">GroundCheck()</code> function. If the player presses space bar and the character is on ground, we save the current game time as our <code class="literal">lastJumpTime</code> (this variable is used in the <code class="literal">GroundCheck()</code> function). Then we disable root motion on the Animator component by setting the <code class="literal">anim.applyRootMotion</code> variable to <code class="literal">false</code>. We set the <code class="literal">onGround</code> variable to <code class="literal">false</code> because our character is jumping. We add force to the <strong class="userinput"><code>Rigidbody</code></strong> component of the character and set the <code class="literal">Trigger</code> Jump in our Animator Controller. Lastly, we call the <code class="literal">GroundCheck()</code> function, which will be described later:</li></ol></div><pre class="programlisting">        if (Input.GetKeyDown(KeyCode.Space) &amp;&amp; onGround) 
        { 
           lastJumpTime = Time.time; 
           anim.applyRootMotion = false; 
           onGround = false; 
           rb.AddForce(Vector3.up* jumpForceUp +
            transform.forward * jumpForceForward, ForceMode.Impulse); 
           anim.SetTrigger("Jump"); 
        } 
        GroundCheck(); </pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>The <code class="literal">anim</code> variable stores the reference to the Animator component. The <code class="literal">rb</code> variable stores the reference to the <strong class="userinput"><code>Rigidbody</code></strong> component. Both variables are set in the <code class="literal">Start()</code> function. The <code class="literal">jumpForceUp</code> and <code class="literal">jumpForceForward</code> are <code class="literal">public float</code> variables that control the applied force magnitude.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>In the <code class="literal">GroundCheck()</code> function, we check if the current game time is bigger than our <code class="literal">lastJumpTime</code> plus the value of the <code class="literal">public float groundCheckPauseTime</code> variable. It this is not true, we are setting the <code class="literal">onGround</code> variable to false (we are assuming that the character is always in the air for a short moment after the player presses the jump button). Then we use the <code class="literal">Physics.Raycast()</code> method to check if our <span>character</span><a id="id325531932" class="indexterm"></a> stands on the ground. This method casts a ray from the <code class="literal">groundCheck</code> transform down. We set the maximum ray cast length with a <code class="literal">public float</code> variable, <code class="literal">maxGroundCheckDistance</code>. If the character is standing on ground, we set the <code class="literal">onGround</code> variable to true and we enable the root motion in the Animator component. We also set the <code class="literal">OnGround</code> parameter in our Animator Controller to the value of the <code class="literal">onGround</code> variable:</li></ol></div><pre class="programlisting">          void GroundCheck() 
        { 
         if(Time.time &gt; lastJumpTime + groundCheckPauseTime      &amp;&amp;            
            Physics.Raycast(groundCheck.position, Vector3.down, 
            maxGroundCheckDistance)) 
            {  
                onGround = true; 
                anim.applyRootMotion = true; 
            } 
            else 
            { 
                onGround = false; 
            } 
            anim.SetBool("OnGround", onGround); 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Assign the script to our character.</li><li>Create an empty child object of the character and call it <code class="literal">GroundCheck</code>. Set its local position to X = 0, Y = 0.1, and Z = 0. Make sure it is a child object of the character game object.</li><li>Assign the <code class="literal">GroundCheck</code> game object to the Ground Check field of the <code class="literal">Jump</code> script attached to the character.</li><li>Play the game and press the space bar to see the result.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec126"></a>How it works...</h3></div></div></div><p>In this recipe, we are using physics to make the character jump. To do it properly, we need to turn off root motion in the Animator component when the character is in the air to make it fully controlled by the physics engine instead of our animations. We are allowing the <span>character</span><a id="id325532209" class="indexterm"></a> to jump only when it's standing on the ground. To avoid setting the <code class="literal">onGround</code> variable to true just after the jump, we temporarily disable the ground checking function after the player presses the jump button.</p><p><span>Jump animatio</span><a id="id325532221" class="indexterm"></a>n is divided into three parts:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code><span>Jump</span><a id="id325532236" class="indexterm"></a></code></strong>: In this animation, our character starts to jump</li><li style="list-style-type: disc"><strong class="userinput"><code>InAir</code></strong>: This is a long looped animation of the character being in the air (or falling down)</li><li style="list-style-type: disc"><span><strong class="userinput"><code>Land</code></strong></span><a id="id325532251" class="indexterm"></a>: This animation is played when the character touches the ground after being in the air</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec127"></a>There's more...</h3></div></div></div><p>Again, this recipe shows the most basic jump setup. You may want to add more start jump animations from different poses (run and walk extremes, passing poses, and another one from the idle animation). To do so, create Animator Controller parameters for each of those poses and <strong class="userinput"><code>Animation Curves</code></strong> with the same names as the parameters you've created. Use the <strong class="userinput"><code>Animation Curves</code></strong> in the walk and run animations to tell Unity which pose is the animation currently in (left/right extreme or left/right passing pose). Use the parameters in the Animator Controller to set the appropriate transitions between the animations. You may also need to add more landing animations that would transition to idle, walk, or run, depending on the current character <strong class="userinput"><code>Speed</code></strong> parameter value (player input).</p></div></div>