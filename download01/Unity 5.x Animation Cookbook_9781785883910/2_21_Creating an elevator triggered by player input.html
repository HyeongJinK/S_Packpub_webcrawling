<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec27"></a>Creating an elevator triggered by player input</h2></div></div><hr /></div><p>In this last recipe, we will use <span>player input</span><a id="id325289202" class="indexterm"></a> to create a simple elevator.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec72"></a>Getting ready</h3></div></div></div><p>Before we start, you should prepare an elevator model to contain the objects: the root object called <strong class="userinput"><code>Elevator</code></strong>, the <strong class="userinput"><code>Lift</code></strong> object (this one will be animated), and the <strong class="userinput"><code>ElevatorFrame</code></strong> object, which will work as decoration. The <strong class="userinput"><code>Lift</code></strong> and <strong class="userinput"><code>ElevatorFrame</code></strong> objects should be children of the empty <strong class="userinput"><code>Elevator</code></strong> object. You can also use the example Unity project provided and go to the <code class="literal">Chapter 02 Working with the animation view\Recipe 07 Creating an elevator triggered by player input</code> directory. You will find an <code class="literal">Example.unity</code> scene there with the <strong class="userinput"><code>Elevator</code></strong> game object and its children <strong class="userinput"><code>Lift</code></strong> and <strong class="userinput"><code>ElevatorFrame</code></strong> objects. The <strong class="userinput"><code>Elevator</code></strong> is already animated in the example assets.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec73"></a>How to do it...</h3></div></div></div><p>To create an <span>elevator triggered</span><a id="id325526769" class="indexterm"></a> by player input, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select the root <strong class="userinput"><code>Elevator</code></strong> object and <span>assign</span><a id="id325526788" class="indexterm"></a> an Animator component to it. Set the <strong class="userinput"><code>Update Mode</code></strong> to <strong class="userinput"><code>Animate Physics</code></strong>.</li><li>Open <strong class="userinput"><code>Window | Animation</code></strong> and create a new Animation Clip by clicking on the <strong class="userinput"><code>Create</code></strong> button. Call it <strong class="userinput"><code>ElevatorGoingDown</code></strong>.</li><li>Make sure the record button is pressed (in the upper-left corner of the <strong class="userinput"><code>Animation</code></strong> View).</li><li>Select your <strong class="userinput"><code>Lift</code></strong> game object and move it to the up position.</li><li>Adjust the timeline a few seconds forward and move the <strong class="userinput"><code>Lift</code></strong> game object to the down position. Your <strong class="userinput"><code>Lift</code></strong> game object should animate going from the maximum up position to the minimum down position.</li><li>Create another Animation Clip by selecting the <strong class="userinput"><code>Create New Clip</code></strong> option from the animations drop-down list (you can find it below the playback buttons). Call it <strong class="userinput"><code>ElevatorGoingUp</code></strong>.</li><li>Animate your <strong class="userinput"><code>Lift</code></strong> game object to go from the down position to the up position.</li><li>Create another Animation Clip and call it <strong class="userinput"><code>ElevatorDown</code></strong>. Create a one-second looping animation for the <strong class="userinput"><code>Lift</code></strong> game object in the down position.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Create another Animation Clip and call it <strong class="userinput"><code>ElevatorUp</code></strong>. Create a one-second looping animation for the <strong class="userinput"><code>Lift</code></strong> game object in the up position.</li><li>Close the <strong class="userinput"><code>Animation</code></strong> View.</li><li>Navigate to the <strong class="userinput"><code><span>ElevatorGoingUp</span><a id="id325532954" class="indexterm"></a></code></strong> and <strong class="userinput"><code>ElevatorGoingDown</code></strong> assets in the <strong class="userinput"><code>Project</code></strong> View. Select them and uncheck the <strong class="userinput"><code>Loop Time</code></strong> option in the <strong class="userinput"><code>Inspector</code></strong>.</li><li>Select the <strong class="userinput"><code><span>Elevator</span><a id="id325536004" class="indexterm"></a></code></strong> game object in the <strong class="userinput"><code>Hierarchy</code></strong> and find its Animator component in the <strong class="userinput"><code>Inspector</code></strong>.</li><li>Double-click on the <strong class="userinput"><code>Controller</code></strong> field to open the automatically created Animator Controller asset.</li><li>Create a new trigger <span>parameter</span><a id="id325540333" class="indexterm"></a> and call it <code class="literal">Move</code>.</li><li>Create a loop of transitions, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/e1d6222f-39bb-4420-b268-214b68c93d48.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="16" type="1"><li>Make sure the <strong class="userinput"><code>ElevatorDown</code></strong> state is the default one. If not, right-click on it and choose the <strong class="userinput"><code>Set as Layer Default State</code></strong> option.</li><li>The <strong class="userinput"><code>ElevatorDown | ElevatorGoingUp</code></strong> and <strong class="userinput"><code>ElevatorUp | ElevatorGoingDown</code></strong> transitions should both have the <strong class="userinput"><code>Move</code></strong> trigger set as the condition and the <strong class="userinput"><code>Has Exit</code></strong>  option set to false.</li><li>The <strong class="userinput"><code>ElevatorGoingDown | ElevatorDown</code></strong> and <strong class="userinput"><code>ElevatorGoingUp | ElevatorUp</code></strong> transitions should have the <strong class="userinput"><code>Has Exit Time</code></strong> option set to true and should have no additional conditions.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="19" type="1"><li>Create a new C# script and call it <code class="literal">Elevator.cs</code>. Write the following code:</li></ol></div><pre class="programlisting">     using UnityEngine; 
     using System.Collections; 
 
     public class Elevator : MonoBehaviour 
     { 
 
         // Update is called once per frame 
         void Update () 
         { 
 
           /*When the player presses the E key, we are setting the 
           Move trigger on the Animator component. We are assuming 
           the Animator component is present on the game object our 
           script is attached to*/ 
             if (Input.GetKeyDown (KeyCode.E)) { 
                 GetComponent&lt;Animator&gt; ().SetTrigger ("Move"); 
             } 
 
         } 
     } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="20" type="1"><li>Assign the <code class="literal">Elevator.cs</code> script to the <strong class="userinput"><code>Elevator</code></strong> game object.</li><li>Select the <strong class="userinput"><code><span>ElevatorFram</span><a id="id325550897" class="indexterm"></a>e</code></strong> game object and add a <strong class="userinput"><code>Mesh Collider</code></strong> component to it.</li><li>Select the <strong class="userinput"><code>Lift</code></strong> game <span>object</span><a id="id325550915" class="indexterm"></a> and add three <strong class="userinput"><code>Cube</code></strong> game objects to it by choosing the <strong class="userinput"><code>3D Object | Cube</code></strong> from the right-click menu. Use the cubes to encapsulate the floor and two barriers of the <strong class="userinput"><code>Lift</code></strong> (the number of the cubes may vary in your particular case). See the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/befb1264-852f-43f1-9a65-39244bc8e636.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="23" type="1"><li>Remove the <strong class="userinput"><code>Mesh Renderer</code></strong> and <strong class="userinput"><code>Mesh Filter</code></strong> components from the cubes, leaving just the <strong class="userinput"><code>Box Collider</code></strong> components. Give the cubes proper names, for example, <code class="literal">FloorCollider</code>, <code class="literal">LeftCollider</code>, and <code class="literal">RightCollider</code>.</li><li>Select the <strong class="userinput"><code>Lift</code></strong> object again. Add a <strong class="userinput"><code>Rigidbody</code></strong> component to it and set it to <strong class="userinput"><code>Is Kinematic</code></strong>.</li><li>Add the <code class="literal">Platform.cs</code> script to the <strong class="userinput"><code>Lift</code></strong> game object. You can find the script in the <span class="emphasis"><em>Animating an object's world position - creating a moving platform</em></span> recipe, the <span><span class="emphasis"><em>How to do it </em></span></span>section, step 13.</li><li>This simple <span>elevator</span><a id="id325289277" class="indexterm"></a> will work for characters using <strong class="userinput"><code>Rigidbody</code></strong> components. You can use the <strong class="userinput"><code>ThirdPersonCharacter</code></strong> prefab from Unity's Standard Assets or use the one in the Unity example project provided.</li><li>Run the game and press the <span class="strong"><strong><span class="emphasis"><em>E</em></span> button</strong></span> on the keyboard to trigger the elevator.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec74"></a>How it works...</h3></div></div></div><p>This recipe has a few key <span>elements</span><a id="id325289307" class="indexterm"></a> that make it work:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Animated Lift game object</strong></span>: The <strong class="userinput"><code>Lift</code></strong> game object uses animations to go from the up to the down position.</li><li style="list-style-type: disc"><span class="strong"><strong>Lift as a child game object</strong></span>: The <strong class="userinput"><code>Lift</code></strong> game object is a child of the <strong class="userinput"><code>Elevator</code></strong> game object, which makes it possible to copy the <strong class="userinput"><code>Elevator</code></strong> and use it in multiple places in the scene.</li><li style="list-style-type: disc"><span class="strong"><strong>Platform.cs script</strong></span>: We are using the same <code class="literal">Platform.cs</code> script as in the <span class="emphasis"><em>Animating an object's world position - creating a moving platform</em></span><span> </span>recipe. This script parents the character to the <strong class="userinput"><code>Lift</code></strong>. This way the character is forced to move with the <strong class="userinput"><code>Lift</code></strong>, which prevents it from jittering (you can try removing the <code class="literal">Platform.cs</code> script from the <strong class="userinput"><code>Lift</code></strong> game object and going down in the <strong class="userinput"><code>Elevator</code></strong>: the character will jump up and down).</li><li style="list-style-type: disc"><span class="strong"><strong>Player input</strong></span>: We are using player input to set the <code class="literal">Move</code> trigger parameter in the Animator Controller of the <strong class="userinput"><code>Elevator</code></strong>. That plays the animation (<strong class="userinput"><code>ElevatorGoingUp</code></strong> or <strong class="userinput"><code>ElevatorGoingDown</code></strong>, depending on the state in which the Elevator is currently in).</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec75"></a>There's more...</h3></div></div></div><p>Right now, the <strong class="userinput"><code><span>Elevator</span><a id="id325532292" class="indexterm"></a></code></strong> will move after every player input, regardless of whether the player is standing in the <strong class="userinput"><code>Lift</code></strong> or not. You can use a <strong class="userinput"><code>Box Collider</code></strong> component set to <strong class="userinput"><code>Is Trigger</code></strong> and write a <span>script</span><a id="id325532311" class="indexterm"></a> to check whether the player is in the <strong class="userinput"><code>Lift</code></strong>, and only then allow the player to use the input. Here is an example <code class="literal">LiftCheck.cs</code> script that would do it (you can find the script in the example Unity project provided in the <code class="literal">Chapter 02 Working with the animation view\Recipe 07 Creating an elevator triggered by player input\Scripts</code><span> </span>directory):</p><pre class="programlisting">     using UnityEngine; 
     using System.Collections; 
 
     public class LiftCheck : MonoBehaviour 
     { 
         Elevator elevatorScript; 
         // Use this for initialization 
         void Start () 
         { 
             /*We try to find the Elevator script on the root 
             transform (we are assuming this is the Elevator game 
             object)*/ 
         elevatorScript = transform.root.GetComponent&lt;Elevator&gt; (); 
         } 
     
         // This function is called when our character 
         enters the trigger 
         void OnTriggerEnter (Collider other) 
         { 
             /*We check if we've found the Elevator script*/ 
             if (elevatorScript != null) { 
                 /*We check if the object which entered 
                 the trigger is the Player*/ 
                 if (other.gameObject.CompareTag ("Player")) { 
                     /*We enable the Elevator script 
                     (and enable the input)*/ 
                     elevatorScript.enabled = true; 
                 } 
             } 
         } 
     
         // This function is called when our character 
         exits the trigger 
         void OnTriggerExit (Collider other) 
         { 
             /*We check if we've found the Elevator script*/ 
             if (elevatorScript != null) { 
                 /*We check if the object which exited the 
                 trigger is the Player*/ 
                 if (other.gameObject.CompareTag ("Player")) { 
                     /*We disable the Elevator script (and , 
                     disable the input)*/ 
                     elevatorScript.enabled = false; 
                 } 
             } 
         } 
     } </pre></div></div>