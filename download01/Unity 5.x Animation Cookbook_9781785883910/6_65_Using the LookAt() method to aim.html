<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec67"></a>Using the LookAt() method to aim</h2></div></div><hr /></div><p>In this recipe, we will use a simple but effective implementation of aiming mechanics.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec209"></a>Getting ready</h3></div></div></div><p>We are going to use the same assets as in the previous recipe. Additionally, we are going to use the <code class="literal">CharacterLookAt.cs</code> created in the <span class="emphasis"><em>Using Quaternion.LookRotation() and Animator.SetLookAtPosition() methods to make characters follow an object with their gaze</em></span> recipe in <span><a class="link" href="#" linkend="ch05">Chapter 5</a></span>, <span class="emphasis"><em>Character Actions and Expressions</em></span>.</p><p>You can also use the provided example Unity project and go to the <code class="literal">Chapter 06 Handling combat\Recipe 08 Using the LookAt method to aim</code> directory. You will find an <code class="literal">Example.unity</code> scene there, with a <strong class="userinput"><code>Humanoid</code></strong> character. Play the game to see the aiming effect.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec210"></a>How to do it...</h3></div></div></div><p>To use the <code class="literal">LookAt<span>()</span><a id="id325241266" class="indexterm"></a></code> method for aiming, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import your character to Unity and place it on the <strong class="userinput"><code>Scene</code></strong>.</li><li>Follow the previous recipe to make a character walk and aim.</li><li>Attach the <code class="literal">CharacterLookAt.cs</code> script to the character.</li><li>Create a new <strong class="userinput"><code>Sphere</code></strong> object and name it <code class="literal">AimTarget</code>.</li><li>Assign the chest bone to the <code class="literal">CharacterLookAt.cs</code> component's <strong class="userinput"><code>Bone</code></strong> field.</li><li>Assign the <strong class="userinput"><code>AimTarget</code></strong> to the <strong class="userinput"><code>Target</code></strong> field of the <code class="literal">CharacterLookAt.cs</code> component.</li><li>Make the <strong class="userinput"><code>AimTarget</code></strong> a child of the <strong class="userinput"><code>Main Camera</code></strong> game object. We are using the same <code class="literal">CameraLook.cs</code> script in this recipe. You can find the script in the <code class="literal">Shared Scripts</code> folder in the example Unity project provided.</li><li>Offset the <strong class="userinput"><code>AimTarget</code></strong> position in its local <span class="emphasis"><em>Z</em></span> axis around 20 units.</li><li>Play the game to see the effect. Our character will try to aim at the <strong class="userinput"><code>AimTarget</code></strong>. You may need to adjust the <strong class="userinput"><code>Additional Rotation</code></strong> vector in the <code class="literal">CharacterLookAt.cs</code> component. In our example, it is set to 15 in <span class="emphasis"><em>X</em></span> and 20 in <span class="emphasis"><em>Y</em></span>.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec211"></a>How it works...</h3></div></div></div><p>We are using the same principle as in the <span class="emphasis"><em>Using LookRotation() and SetLookAtPosition() methods to make characters follow an object with their gaze</em></span> recipe. Our script rotates the chest bone in such a way that the character appears to aim at the target. We use the <strong class="userinput"><code>Additional Rotation</code></strong> vector in the <code class="literal">CharacterLookAt.cs</code> script to adjust the rotation (chest is not facing straight forward in most animations). This way of aiming is good for games in <span>which</span><a id="id325241592" class="indexterm"></a> characters walk relative to the camera (it is suitable for TPP games with an over-the-shoulder camera). It fails when characters have to rotate more than 50-60 degrees. The next recipe solves this problem.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec212"></a>There's more...</h3></div></div></div><p><code class="literal">LookAt()</code> aiming is best used with robots and machines. It can be very useful for implementing turrets. You can find a <strong class="userinput"><code>Turret</code></strong> game object in the scene. It is built of three objects:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Turret</code></strong>: This is the base of the Turret.</li><li style="list-style-type: disc"><strong class="userinput"><code>TurretPivot</code></strong>: This game object only rotates horizontally (in the <span class="emphasis"><em>Y</em></span> axis). This is a child object of the <strong class="userinput"><code>Turret</code></strong>.</li><li style="list-style-type: disc"><strong class="userinput"><code>Gun</code></strong>: This object always points at the target. It is a child object of the <strong class="userinput"><code>TurretPivot</code></strong>. The <strong class="userinput"><code>TurretPivot</code></strong> rotates horizontally, so the <strong class="userinput"><code>Gun</code></strong> looks like it only rotates vertically.</li></ul></div><p>The <span>Turret game object</span><a id="id325289114" class="indexterm"></a> has a <code class="literal">TurretAim.cs</code> script attached. In this script's <code class="literal">Update()</code> function, we first damp the <code class="literal">public Transform target</code> position and save the value in the <code class="literal">Vector3 dampedTargetPosition</code> variable. Then we use this variable to calculate the <code class="literal">aimVector</code> and we use the <code class="literal">aimVector</code> to calculate the <code class="literal">horizontalAimVector</code> (we simply remove the <span class="emphasis"><em>Y</em></span> component from it). Lastly, we calculate new rotations for the <strong class="userinput"><code>TurretPivot</code></strong> and <strong class="userinput"><code>Gun</code></strong> game objects (stored in <code class="literal">public Transform</code> variables) using our <code class="literal">aimVector</code> and <code class="literal">horizontalAimVector</code>:</p><pre class="programlisting">        dampedTargetPosition = 
        Vector3.SmoothDamp(dampedTargetPosition, 
        aimTarget.position, ref refDampSpeed, dampTime); 
 
        aimVector = dampedTargetPosition - turretGun.position; 
 
        horizontalAimVector = aimVector; 
        horizontalAimVector.y = 0f; 
 
        turretPivot.rotation = 
        Quaternion.LookRotation(horizontalAimVector); 
        turretGun.rotation = Quaternion.LookRotation(aimVector); </pre></div></div>