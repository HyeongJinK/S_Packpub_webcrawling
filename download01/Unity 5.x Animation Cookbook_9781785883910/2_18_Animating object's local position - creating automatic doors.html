<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec24"></a>Animating object's local position - creating automatic doors</h2></div></div><hr /></div><p>In this recipe, we will learn how to animate an <span>object</span><a id="id325289099" class="indexterm"></a>'s local position to be able to use the same animated object in multiple locations in the scene. We will create another common gameplay mechanism, <span>automatic door</span><a id="id325289108" class="indexterm"></a>, as an example.
</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec60"></a>Getting ready</h3></div></div></div><p>To make an animated door, you should have two <span>object</span><a id="id325289123" class="indexterm"></a>s ready: the <strong class="userinput"><code>Door Frame</code></strong> and the <strong class="userinput"><code>Door</code></strong>. The <strong class="userinput"><code>Door</code></strong> should be a child of the <strong class="userinput"><code>Frame</code></strong> in the <strong class="userinput"><code>Hierarchy</code></strong>. It should be placed in the <span class="emphasis"><em>closed position.</em></span> We assume that our <strong class="userinput"><code>Door</code></strong> will slide upward when opening. You should also have a player character with the <code class="literal">Player</code> tag assigned. The character should use a <strong class="userinput"><code>Rigidbody</code></strong> component to move or have a kinematic <strong class="userinput"><code>Rigidbody</code></strong><span>component</span><a id="id325289261" class="indexterm"></a>. We will use triggers for our doors, and triggers react to Rigid bodies only. You can also go to the <code class="literal">Chapter 02 Working with the animation view\Recipe 04 Animating objects local position - creating automatic doors</code> directory and find the <code class="literal">Example.unity</code> scene there. If you open it, you can find <strong class="userinput"><code>Automatic Door</code></strong> game object in the <strong class="userinput"><code>Hierarchy</code></strong> and a <strong class="userinput"><code>Sheep</code></strong> game object that will work as our player (it has the <code class="literal">Player</code> tag). If you run the game and go near the door, it will open.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec61"></a>How to do it...</h3></div></div></div><p>To create automatic doors, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select your <strong class="userinput"><code><span class="strong"><strong>Door </strong></span><span class="strong"><strong>Frame</strong></span></code></strong> game object, and add an Animator component to it. To do so, click on the <strong class="userinput"><code>Add Component</code></strong> button in the <strong class="userinput"><code>Inspector</code></strong> and choose <strong class="userinput"><code>Animator</code></strong>. Make sure to add the component to the <strong class="userinput"><code>Door Frame</code></strong> instead of the <strong class="userinput"><code>Door</code></strong> (the parent instead of the child). Set the <strong class="userinput"><code>Update Mode</code></strong> of the <strong class="userinput"><code>Animator</code></strong> component to <strong class="userinput"><code>Animate Physics</code></strong>.</li><li>With the <span class="strong"><strong><strong class="userinput"><code>Door Frame</code></strong></strong></span> game object selected, go to <strong class="userinput"><code>Window | Animation</code></strong> to open the <span class="strong"><strong><strong class="userinput"><code>Animation</code></strong></strong></span> View.</li><li>Create a new Animation Clip and call it <code class="literal">Closed</code>; this will be our animation for the closed door. To create a new clip, click on the drop-down list below the playback buttons and choose the <strong class="userinput"><code>Create New Clip</code></strong> option.</li><li>Click on the <strong class="userinput"><code>Add Property</code></strong> button and find your <strong class="userinput"><code>Door</code></strong> object in the list (a child of the<strong class="userinput"><code> Door Frame</code></strong> game object).</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Unfold the <strong class="userinput"><code>Door</code></strong> game <span>object</span><a id="id325509826" class="indexterm"></a> foldout and find the <strong class="userinput"><code>Transform</code></strong> section. Unfold it and click on the plus icon near the <strong class="userinput"><code>Position</code></strong> property, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/f84033a8-7e5f-4ff8-973b-fd223e3d7175.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Two key frames will be added for the <strong class="userinput"><code>Door</code></strong> game object's local position. We are not going to adjust them (assuming that the <strong class="userinput"><code>Door</code></strong> is in the closed position).</li><li>Add another <span>Animatio</span><a id="id325509866" class="indexterm"></a>n Clip and name it <code class="literal">Door Opening</code>.</li><li>Click on the <strong class="userinput"><code>Add Property</code></strong> button, choose your door game object, and add the <strong class="userinput"><code>Transform | Position</code></strong> key the same way as in step 5.</li><li>Move the second key frame to around the 3 second mark.</li><li>Select the <strong class="userinput"><code>D<strong class="userinput"><code>o</code></strong>or</code></strong> game object (the child of the <strong class="userinput"><code>Door</code></strong> Frame).</li><li>Move it up to the open position. Make sure the record button is active (in the upper-left corner of the <strong class="userinput"><code>Animation</code></strong> View). If you play the animation, it should move the <strong class="userinput"><code>Door</code></strong> game object up.</li><li>Select the last frame of the <strong class="userinput"><code>Door</code></strong> Opening animation (in the <strong class="userinput"><code>Animation</code></strong> View). Go to the <strong class="userinput"><code>Inspector</code></strong> and copy the Door's <strong class="userinput"><code>Transform</code></strong> component. To do so, click on the small gear icon in the upper right corner of the component and choose the <strong class="userinput"><code>Copy Component</code></strong> option.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>Create a new Animation Clip and name it <code class="literal">Opened</code>. Add the key frames to the <strong class="userinput"><code>Door</code></strong> child <span>object</span><a id="id325526662" class="indexterm"></a> the same way as in step 5. If your <strong class="userinput"><code>Door</code></strong> object moved, select it, click on the gear icon near the <strong class="userinput"><code>Transform</code></strong> component in the <strong class="userinput"><code>Inspector</code></strong>, and choose <strong class="userinput"><code>Paste Component</code></strong><strong class="userinput"><code>Values</code></strong>. That will paste our copied <strong class="userinput"><code>Transform</code></strong> properties from the last frame of the <code class="literal">Door Opening</code> animation.</li><li>Make sure both frames in the animation have the same position.</li><li>Create one more Animation Clip (the last one) and name it <code class="literal">Door Closing</code>.</li><li>Make the animation of the <strong class="userinput"><code>Door</code></strong> game object slide down from open to closed positions. Remember that you can copy the Door's <strong class="userinput"><code>Transform</code></strong> component from appropriate animation frames and paste them in the animation you are working on.</li><li>Preview all the animations with the <strong class="userinput"><code>Animation</code></strong> View. You can switch between animations using the drop-down list below the playback buttons.</li><li>If you are happy with your animations, close the <strong class="userinput"><code>Animation</code></strong> View. Select your <strong class="userinput"><code>Door Frame</code></strong><span>game</span><a id="id325526792" class="indexterm"></a> object and find its Animator component in the <strong class="userinput"><code>Inspector</code></strong>.</li><li>Click on the <strong class="userinput"><code>Controller</code></strong> field, which will show you the automatically created Animator Controller in the <strong class="userinput"><code>Project</code></strong> View. Double-click to open it.</li><li>Create a <code class="literal">bool</code> parameter and call it <code class="literal">Open</code>.</li><li>Create a loop of transitions between the animation states: <strong class="userinput"><code>Closed | Door Opening | Open | Door Closing | Closed</code></strong>. See the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/01f81a8c-5253-4236-a26e-f9994cfc01ff.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="22" type="1"><li>Select the <strong class="userinput"><code>Closed | Door Opening</code></strong> transition. Add a condition to it, choose the <code class="literal">Open</code> parameter, and set the condition to true. Disable the <strong class="userinput"><code>Has Exit Time</code></strong> option in the transition.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="23" type="1"><li>Select the <strong class="userinput"><code>Opened | Door Closing</code></strong> transition. Add a condition to it, choose the <code class="literal">Open</code> parameter, and set the condition to false. Disable the <strong class="userinput"><code>Has Exit Time</code></strong> option in the transition.</li><li>Leave the <strong class="userinput"><code>Door Opening | Opened</code></strong> and <strong class="userinput"><code>Door Closing | Closed</code></strong> transitions without a condition. Make sure the <strong class="userinput"><code>Has Exit Time</code></strong> option is enabled in both those transitions.</li><li>Close the <span>Animator</span><a id="id325540333" class="indexterm"></a> Controller.</li><li>Select the Door Frame game <span>object</span><a id="id325540344" class="indexterm"></a> in the scene's Hierarchy.</li><li>Add a <strong class="userinput"><code>Cube</code></strong> child object to the Door Frame game object. To do so, right-click on the <strong class="userinput"><code>Door Frame</code></strong> game object and choose <strong class="userinput"><code>Create | 3D Object | Cube</code></strong>. This will be our trigger.</li><li>Select the <strong class="userinput"><code>Cube</code></strong> and scale it so that it stands out on both sides of the Door Frame. See the following screenshot for reference:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/30b876d1-9dee-4b0c-a2b6-8823ded9a1cf.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="29" type="1"><li>Remove the <strong class="userinput"><code>Mesh Renderer</code></strong> and <strong class="userinput"><code>Mesh Filter</code></strong> components from the <strong class="userinput"><code>Cube</code></strong>. To do so, click on the small gear icon in the upper-right corner of the given component and choose the <strong class="userinput"><code>Remove Component</code></strong> option. That will leave only the <strong class="userinput"><code>Transform</code></strong> and <strong class="userinput"><code>Box Collider</code></strong> components on the Cube.</li><li>Enable the <strong class="userinput"><code>Is Trigger</code></strong> checkbox on the Cube's <strong class="userinput"><code>Box Collider</code></strong> component.</li><li>Rename the Cube game object to <code class="literal">Trigger</code>.</li><li>Select the<strong class="userinput"><code> Door Frame</code></strong> game object and add a <strong class="userinput"><code>Mesh Collider</code></strong> component to it.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="33" type="1"><li>Select the <strong class="userinput"><code>Door</code></strong> game <span>object</span><a id="id325532148" class="indexterm"></a> and add a <strong class="userinput"><code>Box Collider</code></strong> component (or a <strong class="userinput"><code>Mesh Collider</code></strong> set to <strong class="userinput"><code>Convex</code></strong>) and a <strong class="userinput"><code>Rigidbody</code></strong> component. Enable the <strong class="userinput"><code>Is Kinematic</code></strong> option in the <strong class="userinput"><code>Rigidbody</code></strong> component.</li><li>Create a new C# script and name it <code class="literal">AutomaticDoors.cs</code>. Open it and write the following code:</li></ol></div><pre class="programlisting">      using UnityEngine; 
      using System.Collections; 
 
     public class AutomaticDoor : MonoBehaviour 
     { 
 
          /*The anim variable is used to store the reference 
         to the Animator component*/ 
 
          private Animator anim; 
 
         void Start () 
         { 
            /*We assign the Animator component of the parent object 
              because this script is attached to the trigger, which 
              is the child object of our animated doors*/ 
 
              anim = transform.parent.GetComponent&lt;Animator&gt; (); 
          } 
        /* This function is called when a Rigidbody intersects with 
       the collider attached to our game object for the first time. 
       Our collider has to be set to trigger. The Collider other 
       parameter stores information about the object which collided 
       with our trigger (entered the trigger).*/ 
     
          void OnTriggerEnter (Collider other) 
          { 
 
              //We check the tag of the object entering the trigger 
              if (other.gameObject.CompareTag ("Player")) { 
 
                  /*If the tag equals "Player", we set the 
                         bool parameter "Open" to true in our 
                  Animator Controller - that plays the open 
                  animation and opens the doors*/ 
 
                   anim.SetBool ("Open", true); 
              } 
     
          } 
     
     /* This function is called when a Rigidbody exists the trigger 
        (stops colliding with our trigger collider).*/ 
 
         void OnTriggerExit (Collider other) 
          { 
 
             /*Again, we check if the object was the player*/ 
              if (other.gameObject.CompareTag ("Player")) { 
 
                 /*If it's true, we set the bool parameter "Open" 
                 to false in our Animator Controller. That plays 
                 the close animation and closes the doors.*/ 
 
                  anim.SetBool ("Open", false); 
             } 
         } 
     } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="35" type="1"><li>Assign the script to your <strong class="userinput"><code>Trigger</code></strong> game <span>object</span><a id="id325532265" class="indexterm"></a> and make sure your character has a <strong class="userinput"><code>Rigidbody</code></strong> component and the <code class="literal">Player</code> tag.</li><li>Play the game and approach the door; it should open. It should close when you exit the trigger.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec62"></a>How it works...</h3></div></div></div><p>This recipe illustrates a very important feature of Unity's animation workflow, the possibility to animate <span>object</span><a id="id325532289" class="indexterm"></a>s in local space. If we animate child game objects, their position, rotation, and scale will be animated in relation to their parent game objects. This <span>makes</span><a id="id325532297" class="indexterm"></a> it possible to create animated game objects, save them as prefabs, and reuse them in our games.</p><p>There are a few key elements of this recipe:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Door as a child of Door Frame</strong></span>: We have two objects: an animated, moving <strong class="userinput"><code>Door</code></strong> and a stationary <strong class="userinput"><code>Door Frame</code></strong>. The <strong class="userinput"><code>Door</code></strong> game object is the child of the <strong class="userinput"><code>Door Frame</code></strong> <span>game object</span> in the <strong class="userinput"><code>Hierarchy</code></strong>. If we animate it, an Animator component will be added to the <strong class="userinput"><code>Door Frame</code></strong> game object (the parent), and the <strong class="userinput"><code>Door</code></strong> (the child) will be animated relative to the <strong class="userinput"><code>Door Frame </code></strong>(the parent).</li><li style="list-style-type: disc"><span class="strong"><strong>Bool parameter "Open":</strong></span> This parameter is used by the door Animator Controller to switch between Opened and Closed states. We set it in the script attached to the trigger game object. When player enters the trigger, it sets the <code class="literal">Open</code> parameter to true, which tells the <strong class="userinput"><code>Door</code></strong> <span>Animator Controller</span> it should play the <code class="literal">Door Opening</code> animation. When the player exits the trigger, it sets the <code class="literal">Open</code> parameter to false, so the <strong class="userinput"><code>Door</code></strong> <span>Animator Controller</span> plays the <code class="literal">Door Closing</code> animation.
</li><li style="list-style-type: disc"><span class="strong"><strong>Animation-driven movement</strong></span>: The <strong class="userinput"><code>Door</code></strong> game object is animated to open (move up) and close (move down), depending on the <strong class="userinput"><code>bool Open</code></strong> parameter. The <code class="literal">Door</code> game object has a collider to prevent any Rigid body going through it. It also has a <strong class="userinput"><code>Rigidbody</code></strong> component set to <strong class="userinput"><code>Is Kinematic</code></strong>. All <span>moving</span><a id="id325532468" class="indexterm"></a> colliders should be kinematic Rigid bodies for optimization reasons.</li><li style="list-style-type: disc"><span class="strong"><strong>Trigger game object</strong></span>: The <strong class="userinput"><code>Door Frame</code></strong> has also a trigger game object as a child. A trigger is a game object with a collider set to <strong class="userinput"><code>Is Trigger</code></strong>. It recognizes when an object with a <strong class="userinput"><code>Rigidbody</code></strong> component enters or exits the collider and calls the <code class="literal">OnTriggerEnter</code> and <code class="literal">OnTriggerExit</code> functions, respectively. We set the value of the <code class="literal">bool Open</code> parameter in those functions.</li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec63"></a>See also</h3></div></div></div><p>The concept of animating game objects in local space will be used multiple times throughout the course of this book. We are going to create an interesting example in the next recipe.</p></div></div>