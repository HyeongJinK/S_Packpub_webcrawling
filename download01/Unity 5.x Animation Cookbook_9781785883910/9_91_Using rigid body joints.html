<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec90"></a>Using rigid body joints</h2></div></div><hr /></div><p>In this recipe, we will create two objects with physics simulation: a rope and doors. We will use <span>rigid body joints</span><a id="id325241223" class="indexterm"></a> to constrain the movement and rotation of those objects.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec280"></a>Getting ready</h3></div></div></div><p>For this recipe, we need four models: a <strong class="userinput"><code>RopePole</code></strong> (similar to the one from the previous recipe), a skinned <strong class="userinput"><code>Rope</code></strong> with a <strong class="userinput"><code>RopeRig</code></strong> containing around 10 bones,  a<strong class="userinput"><code> Frame</code></strong> and two doors, <strong class="userinput"><code>DoorLeft</code></strong> and <strong class="userinput"><code>DoorRight</code></strong> (resembling those swing doors from a saloon). We also need a character with a rigid body to collide with our objects. You can go to the <code class="literal">Chapter 09 Physics and animations\Recipe 02 Using rigid body joints</code> directory. You will find all these objects in the <code class="literal">Example.unity</code> scene. When you play the game, try to walk with our character and collide with the rope and doors to see the effect.</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/9184a520-9827-45d0-8f7a-c3ca01b52c80.png" /></div><p>Rope and swing doors</p><p></p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec281"></a>How to do it...</h3></div></div></div><p>To use <span>rigid body joints</span><a id="id325241613" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import our swing doors to Unity. The model should contain three objects: <strong class="userinput"><code>Frame</code></strong>, <strong class="userinput"><code>DoorLeft</code></strong>, and <strong class="userinput"><code>DoorRight</code></strong>.</li><li>Place the objects in the scene and parent them all to an empty game object, which you may call <strong class="userinput"><code>SwingDoors</code></strong>.</li><li>Add a <strong class="userinput"><code>Mesh Collider</code></strong> to the <strong class="userinput"><code>Frame</code></strong> game object to prevent our character from going through it.</li><li>Add a <strong class="userinput"><code>Box Collider</code></strong> or a <strong class="userinput"><code>Mesh Collider</code></strong> set to <strong class="userinput"><code>Convex</code></strong> to the <strong class="userinput"><code>DoorLeft</code></strong> game object.</li><li>Add a <strong class="userinput"><code>Rigidbody</code></strong> component to the <strong class="userinput"><code>DoorLeft</code></strong> game object.</li><li>Add a <strong class="userinput"><code>Hinge Joint</code></strong> component to <strong class="userinput"><code>DoorLeft</code></strong>.</li><li>Set the <strong class="userinput"><code>Axis</code></strong> parameter to 0 X, 1 Y, and 0 Z. This is the axis in which our <strong class="userinput"><code>Hinge Joint</code></strong> can rotate.</li><li>Check the <strong class="userinput"><code>Use Limits</code></strong> option and set the <strong class="userinput"><code>Min</code></strong> to -120 and <strong class="userinput"><code>Max</code></strong> to 120 (exact limits may differ in your particular case). Those values describe the range in which our <strong class="userinput"><code>Hinge Joint</code></strong> can rotate from its neutral position.</li><li>If you want the doors to come back to their original position after they are pushed, check the <strong class="userinput"><code>Use Spring</code></strong> option.</li><li>Set the <strong class="userinput"><code>Spring</code></strong> parameter to 1 and <strong class="userinput"><code>Damper</code></strong> to 0.5 (you may need to experiment with the exact values).</li><li>Repeat steps 4-10 for the <strong class="userinput"><code>DoorRight</code></strong> game object.</li><li>Play the game and make any other rigid body collide with the doors to see the effect (you may use your character if it uses rigid body physics to move).</li></ol></div><p>To create a rope using <strong class="userinput"><code><span>Hinge Joints</span><a id="id325509825" class="indexterm"></a></code></strong>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import our <span>skinned</span><a id="id325509841" class="indexterm"></a> <strong class="userinput"><code>Rope</code></strong> model to Unity. Rope should have enough bones to simulate its behavior (around 10-20 should be enough in most cases). Make sure the bones have identical or similar size and are not parented to each other (it will make the editing much easier).</li><li>Place the <strong class="userinput"><code>Rope</code></strong> model in the scene.</li><li>Go to the <strong class="userinput"><code>RopeRig</code></strong> game object and select all the bones.</li><li>Add <strong class="userinput"><code>Capsule Collider</code></strong>, <strong class="userinput"><code>Rigidbody</code></strong>, and <strong class="userinput"><code>Hinge Joint</code></strong> components to all the bones in the rig.</li><li>With all the bones selected, use the Inspector to scale the <strong class="userinput"><code>Capsule Colliders</code></strong> to fit the bones sizes.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Make sure the <strong class="userinput"><code>Auto Configure Connected Anchor</code></strong> option is selected in each bone's <strong class="userinput"><code>Hinge Joint</code></strong> settings.</li><li>For every bone, find its <strong class="userinput"><code><span>Hinge Joint</span><a id="id325522931" class="indexterm"></a></code></strong> settings. Drag and drop the next bone to the <strong class="userinput"><code>Connected Body</code></strong> field of the previous bone. For instance, if you have a rig containing five bones, <strong class="userinput"><code>Bone1</code></strong>, <strong class="userinput"><code>Bone2</code></strong>, <strong class="userinput"><code>Bone3</code></strong>, <strong class="userinput"><code>Bone4</code></strong>, <strong class="userinput"><code>Bone5</code></strong>. <strong class="userinput"><code>Bone5</code></strong> is the top one—drag and drop <strong class="userinput"><code>Bone5</code></strong> to the <strong class="userinput"><code>Connected Body</code></strong> field in the <strong class="userinput"><code>Hinge Joint</code></strong> settings of <strong class="userinput"><code>Bone4</code></strong>. Drag and drop <strong class="userinput"><code>Bone4</code></strong> to <strong class="userinput"><code>Connected Body</code></strong> field in the <strong class="userinput"><code>Hinge Joint</code></strong> settings of <strong class="userinput"><code>Bone3</code></strong> and so on. Leave the top bone's <strong class="userinput"><code>Connected Body</code></strong> field empty—this will constrain its movement in space.</li><li>You may also need to adjust the <strong class="userinput"><code>Limits</code></strong> and <strong class="userinput"><code>Axis</code></strong> fields. The rotation axis should point in the same direction in which the bones are pointing. If you select a game object with a <strong class="userinput"><code>Hinge Joint</code></strong>, you may see the rotation axis as a small brownish arrow.</li><li>Disable or remove the <strong class="userinput"><code>Animator</code></strong> component from the <strong class="userinput"><code>Rope</code></strong> game object.</li><li>Play the game and collide with the rope to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec282"></a>How it works...</h3></div></div></div><p>In this recipe, we used Hinge Joints—one of the joint types in Unity. Those joints constrain <span>rigid</span><a id="id325526778" class="indexterm"></a> body movement. If we use them on a rig of a Skinned Mesh Renderer, we can introduce physics simulation to it (as we did with the rope). <span>Hinge Joints</span><a id="id325526787" class="indexterm"></a> have a few interesting parameters:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Connected Body</code></strong>: We can connect the object to another rigid body by placing it into this field. Connected objects can form ropes, chains, and other interesting structures.</li><li style="list-style-type: disc"><strong class="userinput"><code>Anchor</code></strong>: A defined local space position around which the joint can rotate.</li><li style="list-style-type: disc"><strong class="userinput"><code>Axis</code></strong>: This specifies the axis around which the joint can rotate.</li><li style="list-style-type: disc"><strong class="userinput"><code>Auto Configure Connected Anchor</code></strong>: If we check this, the Connected Anchor will be configured automatically to match the Connected Body's Anchor.</li><li style="list-style-type: disc"><strong class="userinput"><code>Connected Anchor</code></strong>: Here we can manually configure the connected body position (we have to disable <strong class="userinput"><code>Auto Configure Connected Anchor</code></strong> first).</li><li style="list-style-type: disc"><strong class="userinput"><code>Use Spring</code></strong>: If this option is checked, the joint will behave as if a spring is attached to it. It will try to get back to its <strong class="userinput"><code>Target Position</code></strong> (see further down this list).</li><li style="list-style-type: disc"><strong class="userinput"><code>Spring</code></strong>: This is the force of the spring.</li><li style="list-style-type: disc"><strong class="userinput"><code>Damper</code></strong>: This damps the movement caused by the spring force. The object will slow down in time until it completely stops.</li></ul></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Target Position</code></strong>: This is the target angle to which the joint's spring wants to pull the object.</li><li style="list-style-type: disc"><strong class="userinput"><code>Use Motor</code></strong>: This makes the object spin around its joint <strong class="userinput"><code>Axis</code></strong>.</li><li style="list-style-type: disc"><strong class="userinput"><code>Target Velocity</code></strong>: This is the velocity the object wants to achieve when rotating.</li><li style="list-style-type: disc"><strong class="userinput"><code>Force</code></strong>: This is the force applied to the object to achieve the <strong class="userinput"><code>Target Velocity</code></strong>.</li><li style="list-style-type: disc"><strong class="userinput"><code>Free Spin</code></strong>: When you enable this option, the object will not try to slow down to match the <strong class="userinput"><code>Target Velocity</code></strong>, it will only accelerate.</li><li style="list-style-type: disc"><strong class="userinput"><code>Use Limits</code></strong>: Enable this option if you want to limit the rotation of the object around its joint <strong class="userinput"><code>Axis</code></strong>.</li><li style="list-style-type: disc"><strong class="userinput"><code>Min</code></strong>: This is the lowest rotation limit.</li><li style="list-style-type: disc"><strong class="userinput"><code>Max</code></strong>: This is the highest rotation limit.</li><li style="list-style-type: disc"><strong class="userinput"><code>Bounciness</code></strong>: How much the object will bounce off when it reaches the rotation limit.</li><li style="list-style-type: disc"><strong class="userinput"><code>Contact Distance</code></strong>: It makes the limits <span class="emphasis"><em>have some width</em></span> to decrease jitter. In this distance from the limits, the joint will have contact with the given limit.</li><li style="list-style-type: disc"><strong class="userinput"><code>Break Force</code></strong>: This is the <span>force</span><a id="id325240737" class="indexterm"></a> needed to break the joint and is useful if you want to ram your doors.</li><li style="list-style-type: disc"><strong class="userinput"><code>Break Torque</code></strong>: Similar to the preceding one, this is the torque needed to break the joint.</li><li style="list-style-type: disc"><strong class="userinput"><code>Enable Collision</code></strong>: This enables collision between rigid bodies connected to the joint.</li><li style="list-style-type: disc"><strong class="userinput"><code>Enable Preprocessing</code></strong>: his is used to stabilize the situations that are impossible to fulfill.</li></ul></div></div></div>