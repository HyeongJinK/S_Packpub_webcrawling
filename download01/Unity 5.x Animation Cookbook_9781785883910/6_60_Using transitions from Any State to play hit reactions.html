<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec62"></a>Using transitions from Any State to play hit reactions</h2></div></div><hr /></div><p>Often, there are situations when we would like to transition to an animation from any other one. The most common example is the <span>hit reaction</span><a id="id325241552" class="indexterm"></a>. Our characters can be hit while standing, walking, or even attacking. Creating and managing all those transitions would be cumbersome and difficult. In Unity, we can use a special <span class="strong"><strong><span>Any State</span><a id="id325241560" class="indexterm"></a></strong></span> in the controllers to achieve transitions from any given animation.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec191"></a>Getting ready</h3></div></div></div><p>We are going to use the characters from the previous recipe and add one animation to the <strong class="userinput"><code>Spider</code></strong> character: <strong class="userinput"><code>HitReaction</code></strong>. You can also use the example project and go to the <code class="literal">Chapter 06 Handling combat\Recipe 03 Using transitions from any state to play hit reactions</code> directory. You can find the <code class="literal">Example.unity</code> scene there, with two characters: <strong class="userinput"><code>Humanoid</code></strong> and <strong class="userinput"><code>Spider</code></strong>. When you play the game, <strong class="userinput"><code>Spider</code></strong> will react to hits. In the <code class="literal">Rigs</code> directory of the previous recipe, you can find the required animations.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec192"></a>How to do it...</h3></div></div></div><p>To use <span>Any State transitions</span><a id="id325526774" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Follow the previous recipe to import the characters and place them on the scene.</li><li>Create a new <strong class="userinput"><code>Animator Controller</code></strong> for the <strong class="userinput"><code>Spider</code></strong> (you can also edit the existing one).</li><li>Create a new <code class="literal">bool</code> parameter in the controller and call it <strong class="userinput"><code>Dead</code></strong>.</li><li>Create a new <code class="literal">Trigger</code> parameter in the controller and call it <strong class="userinput"><code>Hit</code></strong>.</li><li>Drag and drop the <strong class="userinput"><code>Idle</code></strong>, <strong class="userinput"><code>Death</code></strong>, and <strong class="userinput"><code>HitReaction</code></strong> animations of the <strong class="userinput"><code>Spider</code></strong> into the controller. The <strong class="userinput"><code>Idle</code></strong> animation should be our default state.</li><li>Find the blue <strong class="userinput"><code>Any State</code></strong> node in the controller. See the following screenshot for reference:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/34d96dd4-ab19-48d1-8a5e-c183ae31345d.png" /></div><p>Transitions from Any State</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Right-click on it and create the following transitions:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Any State</code></strong> | <strong class="userinput"><code>HitReaction</code></strong> with one condition: <strong class="userinput"><code>Hit </code></strong><code class="literal">Trigger</code> parameter. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to <code class="literal">false</code>, <strong class="userinput"><code>Can Transition To Self</code></strong> set to true, and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>Any State</code></strong> | <strong class="userinput"><code>Death</code></strong> with one condition: <strong class="userinput"><code>Dead </code></strong><code class="literal">bool</code> parameter set to <code class="literal">true</code>. <strong class="userinput"><code>Has Exit Time</code></strong> should be set to <code class="literal">false</code>, <strong class="userinput"><code>Can Transition To Self</code></strong> set to false, and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds.</li><li style="list-style-type: disc"><strong class="userinput"><code>HitReaction</code></strong> | <strong class="userinput"><code>Idle</code></strong>: For this one, you need to right-click on the <strong class="userinput"><code>HitReaction</code></strong> state first. It should have no conditions, <strong class="userinput"><code>Has Exit Time</code></strong> set to <code class="literal">true</code>, and <strong class="userinput"><code>Transition Duration</code></strong> set to 0.2 seconds.</li></ul></div></li><li>Assign the controller to the <strong class="userinput"><code>Spider's Animator</code></strong> component.</li><li>Create a new script and call it <code class="literal">EnemyWithHits.cs</code>.</li><li>Derive this script from the <code class="literal">Enemy.cs</code> script instead of <code class="literal">MonoBehaviour</code>. You can find the <code class="literal">Enemy.cs</code> script in the previous recipe.</li><li>To make our hit reactions work, we need to <code class="literal">override</code> the <code class="literal">Hit()</code> and <code class="literal">Die()</code> functions. In the first one, we check if our character's <code class="literal">isAlive</code> flag. If our <strong class="userinput"><code>Spider</code></strong> is dead already, we don't attempt to play hit reactions. If it is alive, we play the hit reaction by setting the <strong class="userinput"><code>Hit </code></strong><code class="literal">Trigger</code> parameter in the controller. Next we call the <code class="literal">base</code> implementation of the <code class="literal">Hit()</code> function:</li></ol></div><pre class="programlisting">        public override void Hit(int damage) 

        { 

            if (!isAlive) 
            { 
                return; 
            } 
            anim.SetTrigger("Hit"); 
            base.Hit(damage); 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>In the <code class="literal">Die()</code> function, we set the <code class="literal">isAlive</code> flag to false and call the base implementation of the <code class="literal">Die()</code> function:</li></ol></div><pre class="programlisting">        public override void Die() 
        { 
            isAlive = false; 
            base.Die(); 
        } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>Assign the script to the <strong class="userinput"><code>Spider</code></strong> character and play the game to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec193"></a>How it works...</h3></div></div></div><p><span>Any State</span><a id="id325241276" class="indexterm"></a> is a powerful tool for organizing animation graphs. If we know we need to access an animation state from any other state, we can create a transition from Any State node, instead of creating a web of transitions from all the necessary states.</p><p>This special state's transitions have one additional parameter: <strong class="userinput"><code>Can Transition to Self</code></strong>. If set to <code class="literal">false</code> it blocks transitions to the same state.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip13"></a>Note</h3><p>Any State transitions are most useful for hit reactions and death animations.</p></div></div></div>