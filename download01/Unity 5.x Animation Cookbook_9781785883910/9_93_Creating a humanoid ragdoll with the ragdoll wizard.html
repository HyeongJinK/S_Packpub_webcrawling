<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec92"></a>Creating a humanoid ragdoll with the ragdoll wizard</h2></div></div><hr /></div><p>In this recipe, we will turn our character into a ragdoll and learn how to enable the ragdoll and disable it. We will use Unity's built-in Ragdoll Wizard, which is useful for creating <span>humanoid ragdolls</span><a id="id325241223" class="indexterm"></a>:</p><div class="mediaobject"><img src="/graphics/9781785883910/graphics/b39810a4-53ca-40a2-81cb-16385268b73a.png" /></div><p>A character with the ragdoll effect applied</p><p></p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec286"></a>Getting ready</h3></div></div></div><p>For this recipe, we need an <span>animated</span><a id="id325241257" class="indexterm"></a> character. We can use the one we were using before (for instance, the one from the <span><a class="link" href="#" linkend="ch04">Chapter 4</a></span>, <span class="emphasis"><em>Character Movement</em></span>). You can also go to the <code class="literal">Chapter 09 Physics and animations\Recipe 04 Creating a humanoid ragdoll with ragdoll wizard</code> directory. You can find the <code class="literal">Example.unity</code> scene there. If you play the game and press the space bar, the character will turn into a ragdoll. You can press the space bar again to turn the ragdoll off.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec287"></a>How to do it...</h3></div></div></div><p>To create a <span>humanoid ragdoll</span><a id="id325241612" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Place your character in the scene.</li><li>Go to <strong class="userinput"><code>Game Object</code></strong> | <strong class="userinput"><code>3d Object</code></strong> | <strong class="userinput"><code>Ragdoll</code></strong> to open the <strong class="userinput"><code>Create Ragdoll</code></strong> window.</li><li>Drag and drop the bones from your character rig to the fields in the <strong class="userinput"><code>Create Ragdoll</code></strong> window. The fields' names aren't very accurate. <strong class="userinput"><code>Left Hips</code></strong> means left thigh, <strong class="userinput"><code>Left Knee</code></strong> means left shin, <strong class="userinput"><code>Left</code></strong><strong class="userinput"><code>Arm</code></strong> means the left upper arm, and <strong class="userinput"><code>Left</code></strong><strong class="userinput"><code>Elbow</code></strong> means the lower left arm, as shown in the following screenshot. The same applies to the right side. The rest of the names are self-explanatory:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/43a065c9-a046-4970-aeba-2e5dc5e772d1.png" /></div><p>Create Ragdoll window</p><p></p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>After you assign all the bones, click on the <strong class="userinput"><code>Create</code></strong> button. The ragdoll will be created. <strong class="userinput"><code>Rigidbody</code></strong>, <strong class="userinput"><code>Capsule Collider</code></strong> (or <strong class="userinput"><code>Box Collider</code></strong>), and <strong class="userinput"><code>Character Joint</code></strong> components will be added to the required bones.</li><li>You may need to <span>adjust</span><a id="id325509757" class="indexterm"></a> the size of the colliders to better match your character's shape. See the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/9413139a-cf4b-476b-a7c8-6fe1c7b2824b.png" /></div><p>Configured ragdoll</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Add two layers in the game: <strong class="userinput"><code>Characters</code></strong> and <strong class="userinput"><code>Ragdoll</code></strong>. To do so, go to <strong class="userinput"><code>Edit</code></strong> | <strong class="userinput"><code>Project Settings</code></strong> | <strong class="userinput"><code>Tags and Layers</code></strong>.</li><li>Set the character's layer to <strong class="userinput"><code>Characters</code></strong> and its rig with all its children (the ragdoll) to <strong class="userinput"><code>Ragdoll</code></strong>.</li><li>Go to <strong class="userinput"><code>Edit</code></strong> | <strong class="userinput"><code>Project Settings</code></strong> | <strong class="userinput"><code>Physics</code></strong> and disable the collision between the <strong class="userinput"><code>Characters</code></strong> and <strong class="userinput"><code>Ragdoll</code></strong> layers. This is a good way to prevent our ragdoll colliding with our character's main collider which would cause unwanted behavior (jitter, glitches in movement, and so on).</li><li>Create a new C# script and name it <code class="literal">HandleRagdoll.cs</code>. In this script, we have the <code class="literal">public void EnableRagdoll(bool enable, List&lt;Rigidbody&gt; rigidbodies)</code> function. It iterates through all the rigid bodies attached to any of the children of the <code class="literal">public Transform charactersRig</code> transform and enables them or disables them depending on the enable flag. It also enables or disables the <code class="literal">mainRigidbody</code> and the <code class="literal">mainCollider</code> (attached to the character's root object). Finally, it enables or disables the character's <strong class="userinput"><code>Animator</code></strong> component:</li></ol></div><pre class="programlisting">      public void EnableRagdoll(bool enable, List&lt;Rigidbody&gt; 
      rigidbodies) 
      { 
          for (int i = 0; i &lt; rigidbodies.Count; i++) 
          { 
              rigidbodies[i].isKinematic = !enable; 
          } 
          if (mainCollider != null) 
          { 
              mainCollider.enabled = !enable; 
          } 
          if (mainRigidbody != null) 
          { 
              mainRigidbody.isKinematic = enable; 
          } 
          if (anim != null) 
          { 
              anim.enabled = !enable; 
          } 
      } </pre><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>We call this function every time player presses the space bar. At the start of the game, we collect all rigid bodies attached to character's rig children objects and store them in a global list. We pass that list to the <code class="literal">EnableRagdoll()</code> function every time we call it. We also call the <code class="literal">EnableRagdoll()</code> function at the start of the game with the <code class="literal">enable</code> parameter set to <code class="literal">false</code>. This disables the ragdoll.</li><li>Attach the script to the character and drag its rig to the <strong class="userinput"><code>Characters Rig</code></strong> field of the script.</li><li>Play the game and press the space bar to see the effect.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec288"></a>How it works...</h3></div></div></div><p>The <strong class="userinput"><code>Create Ragdoll</code></strong> window helps with attaching <strong class="userinput"><code>Character Joint</code></strong>, <strong class="userinput"><code>Capsule Collider</code></strong>, and <strong class="userinput"><code>Rigidbody</code></strong> components to <span>humanoid</span><a id="id325241665" class="indexterm"></a> characters' rigs. Those characters don't have to use the HumanoidumanoidHumanoid rig in the same way as the Mecanim feature.</p><p>Rigid bodies, colliders, and character joint components create a ragdoll. To turn the ragdoll on, we need to disable the Animator component as animations override the movement of rigid bodies. This is what our script does. It also makes the ragdoll's rigid bodies kinematic when the ragdoll is off, to turn the physics simulation off when it's not needed.</p></div></div>