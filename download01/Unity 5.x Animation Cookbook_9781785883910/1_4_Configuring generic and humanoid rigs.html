<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec11"></a>Configuring generic and humanoid rigs</h2></div></div><hr /></div><p>This recipe shows how to configure two most frequently used rig types: <strong class="userinput"><code><span>Generic</span><a id="id325289113" class="indexterm"></a></code></strong> and <strong class="userinput"><code><span>Humanoid</span><a id="id325289123" class="indexterm"></a></code></strong>. We will go through all the available options for both of them.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec16"></a>Getting ready</h3></div></div></div><p>As previously mentioned, make sure you have prepared two animated characters. One of them should be a humanoid and the other a non-humanoid, a quadruped for instance. You can also download the provided example Unity project and go to the <code class="literal">Chapter 01 Working with animations\Recipe 02 Configuring generic and humanoid rigs\Rigs</code> directory.</p><p>You will find there three FBX files: </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">Generic.fbx</code></li><li style="list-style-type: disc"><code class="literal">Humanoid.fbx</code></li><li style="list-style-type: disc"><code class="literal">Quadruped.fbx</code></li></ul></div><p>If you are creating your characters from scratch, the bones hierarchy of your <span>humanoid rig</span><a id="id325509744" class="indexterm"></a> is important for Unity to recognize the rig as a humanoid. It should follow this pattern:</p><pre class="programlisting">HIPS -&gt; SPINE -&gt; CHEST -&gt; NECK -&gt; HEAD 
HEAD -&gt; EYE (for left and right eyes) 
HEAD -&gt; JAW 
HIPS -&gt; UPPER LEG -&gt; LOWER LEG -&gt; FOOT -&gt; TOES (for left and right legs) 
CHEST -&gt; SHOULDER -&gt; ARM -&gt; FOREARM -&gt; HAND (for left and right hands) 
HAND -&gt; PROXIMAL -&gt; INTERMEDIATE -&gt; DISTAL (for five fingers in left and right hands) </pre><p>The hip bone is the root <span>bone</span><a id="id325509758" class="indexterm"></a> of the humanoid character. Fingers, shoulders, chest, neck, eyes, jaw, and toes are optional bones. Your humanoid character will work without them.</p><p>You should also remember to model the character in a T-POSE. It should face the <span class="emphasis"><em>Z</em></span> axis in Unity (if your 3D software uses different axis alignment from Unity's like Blender, remember about the <span class="emphasis"><em>-90</em></span> and <span class="emphasis"><em>+90</em></span> degrees rotation trick shown in the <span class="emphasis"><em>Importing skeletal animations</em></span> recipe). Hands of the character should be flat, palm down, and parallel to the ground along the <span class="emphasis"><em>X</em></span> axis. A-POSE characters will also work.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec17"></a>How to do it...</h3></div></div></div><p>To configure a <span>generic rig</span><a id="id325509831" class="indexterm"></a> you need to follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Import your animated asset into Unity the same way as in the <span class="emphasis"><em>Importing skeletal animations</em></span> recipe.</li><li>Select the asset and choose the <strong class="userinput"><code>Rig</code></strong> tab in the <strong class="userinput"><code>Inspector</code></strong>. Then select the <strong class="userinput"><code>Generic</code></strong> option in the <strong class="userinput"><code>Animation Tab</code></strong> drop-down menu. If you are using the provided example Unity Project, select the <code class="literal">Generic.fbx</code> file in the <code class="literal">Chapter 01 Working with animations\Recipe 02 Configuring generic and humanoid rigs\Rigs</code> directory.</li><li>Choose the <strong class="userinput"><code>Create From This Model</code></strong> option from the <strong class="userinput"><code>Avatar Definition</code></strong> drop-down menu.</li><li>Leave the <strong class="userinput"><code>Root Node</code></strong> option set to <strong class="userinput"><code>None</code></strong>.</li><li>Leave the <strong class="userinput"><code>Optimize Game Objects</code></strong> option unchecked.</li><li>Click on the <strong class="userinput"><code>Apply</code></strong> button to complete the configuration.</li></ol></div><p><span>Humanoid rig</span><a id="id325522934" class="indexterm"></a> configuration has a lot more options:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, import your skinned humanoid model to Unity the same way as in the <span class="emphasis"><em>Importing skeletal animations</em></span> recipe.</li><li>Select the asset and choose the <strong class="userinput"><code>Rig</code></strong> tab in the <strong class="userinput"><code>Inspector</code></strong>. Then select the <strong class="userinput"><code>Humanoid</code></strong> option in the <strong class="userinput"><code>Animation Tab</code></strong> drop-down menu. If you are using the provided example Unity Project, select the <code class="literal">Humanoid.fbx</code> file in the <code class="literal">Chapter 01 Working with animations\Recipe 02 Configuring generic and humanoid rigs\Rigs</code> directory.</li><li>Choose the <strong class="userinput"><code>Create From This Model</code></strong> option from the <strong class="userinput"><code>Avatar Definition</code></strong> drop-down menu.</li><li>Leave the <strong class="userinput"><code>Optimize Game Objects</code></strong> option unchecked.</li><li>Click on the <strong class="userinput"><code>Apply</code></strong> button.</li><li>You should see a <strong class="userinput"><code>Configure</code></strong> button with a tick icon near to it.</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/1fdcb327-8b13-4e28-9673-8461df466920.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>The tick icon shows that Unity was able to automatically recognize the rig hierarchy as a humanoid. If Unity fails to recognize it, automatically a cross will be displayed instead of the tick. If you are using the provided example, you can observe it when you try to set the rig to <strong class="userinput"><code>Humanoid</code></strong> for the <code class="literal">Generic.fbx</code> file.
</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note5"></a>Note</h3><p>Some quadruped characters can be mistaken by Unity for humanoids. You can find a <code class="literal">Quadruped.fbx</code> file in the provided example Unity project. Theoretically, you can set its rig to <strong class="userinput"><code><span>Humanoid</span><a id="id325526791" class="indexterm"></a></code></strong>, and Unity will recognize it as valid. This, however, is a mistake—all quadruped characters' rigs should be set to <strong class="userinput"><code>Generic</code></strong>. Setting them as humanoids can cause problems later.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Click on the <strong class="userinput"><code>Configure</code></strong><span>button</span><a id="id325532803" class="indexterm"></a> to enter the <strong class="userinput"><code>Avatar Configuration Inspector</code></strong>. A new scene will be opened. You should be able to see your model in the <strong class="userinput"><code>scene</code></strong> and bone <strong class="userinput"><code>mapping</code></strong> section in the <strong class="userinput"><code>Inspector</code></strong> tab.</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/be3830d1-6989-486c-9dfd-c0b3206de1c5.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Make sure you are in the <strong class="userinput"><code>Mapping</code></strong> section (<span class="strong"><strong>1</strong></span>). All recognized and assigned bones are shown as green body parts on the displayed dummy character. If a required bone is missing or is not assigned, it will show up as red. You can navigate between the <strong class="userinput"><code>Body</code></strong>, <strong class="userinput"><code>Head</code></strong>, <strong class="userinput"><code>Left Hand</code></strong>, and <strong class="userinput"><code>Right Hand</code></strong> sections by clicking on a corresponding button (<span class="strong"><strong>2</strong></span>). All bones are displayed in a list (<span class="strong"><strong>3</strong></span>) for each section. Required bones are marked with circle icons and optional bones are marked with dotted circle icons.</li><li>You can <span>change</span><a id="id325540286" class="indexterm"></a> the bone assignment by dragging a bone from the <strong class="userinput"><code>Hierarchy</code></strong> tab and dropping it onto a corresponding bone slot in the <strong class="userinput"><code>Inspector</code></strong> tab. Unity will occasionally miss a bone or two (especially fingers); thus, you <span>should</span><a id="id325540337" class="indexterm"></a> always check the bone assignment manually.</li><li>If your character is not in a T-POSE (is modeled in an A-POSE for instance), a <strong class="userinput"><code>Character is not in T-POSE</code></strong> message will be displayed in the scene view and the character's bones will show up in red. Unity needs the character in a T-POSE for proper humanoid avatar configuration. You can enforce that pose by choosing the <strong class="userinput"><code>Pose</code></strong> |<strong class="userinput"><code>Enforce T-POSE</code></strong> option, found below the bones <strong class="userinput"><code>mapping</code></strong> list.</li></ol></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/e43e3779-38e8-4fc7-a06b-6278671ee345.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>Click on the <strong class="userinput"><code>Apply</code></strong> button and then the <strong class="userinput"><code>Done</code></strong> button to finish configuration.
</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec18"></a>How it works...</h3></div></div></div><p><strong class="userinput"><code><span>Humanoid</span><a id="id325549045" class="indexterm"></a></code></strong> rig uses more advanced Mecanim features than the <strong class="userinput"><code>Generic</code></strong> rig. You can find the list of such features below:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Automatic retargeting</strong></span>: This is one of the most important differences between those two rigs. The <strong class="userinput"><code>Humanoid</code></strong> rig uses automatic retargeting, which means that you can have the same animations on different humanoid characters. Your characters can share a group of animations (basic movement or some common actions). It gives you the possibility to buy your animation assets from the Asset Store and easily use them on your characters. <strong class="userinput"><code>Generic</code></strong> rigs don't support this feature. You have to prepare animations for your specific rig or retarget them in a 3D package.</li><li style="list-style-type: disc"><span class="strong"><strong>Inverse kinematics</strong></span>: This feature lets you control your characters' feet and hands position with scripting. It is useful for making your characters stand on uneven ground or grab an object in the scene. It is a built-in feature for <span>Humanoid rigs</span><a id="id325550888" class="indexterm"></a> in Unity. <strong class="userinput"><code>Generic</code></strong> rigs have to use custom-made solutions.</li><li style="list-style-type: disc"><span class="strong"><strong>Advanced animation settings</strong></span>: <span>Humanoid rig</span><a id="id325532884" class="indexterm"></a>s have more settings for animation import, such as the <strong class="userinput"><code>mirror</code></strong> option. We will discuss them in depth in the <span class="emphasis"><em>Looping mirroring and offsetting animations</em></span> recipe.</li><li style="list-style-type: disc"><span class="strong"><strong>Look at</strong></span>: Unity has a built-in <span>solution</span><a id="id325532904" class="indexterm"></a> for humanoid characters looking at something. You have to write custom systems for generic characters.</li><li style="list-style-type: disc"><span class="strong"><strong>Additional bones</strong></span>: A lot of people <span>think</span><a id="id325532918" class="indexterm"></a> that they cannot use additional bones with <strong class="userinput"><code>Humanoid</code></strong> rigs. It is not true. If your rig has an animated weapon slot for instance, you can still use it with the <strong class="userinput"><code>Humanoid</code></strong> rig. All you need to do is to find the <strong class="userinput"><code>Mask</code></strong> section in your animation import settings and enable the additional bone for each animation it is used in (you need to use the <strong class="userinput"><code>Transform</code></strong> foldout to find your additional bone).</li></ul></div><p>I highly recommend using <strong class="userinput"><code>Humanoid</code></strong> rigs for all humanoid characters in your game.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec19"></a>There's more...</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">In the <span>Humanoid rig</span><a id="id325532955" class="indexterm"></a> configuration, you can find the <strong class="userinput"><code>Muscles &amp; Settings</code></strong> section, where you can preview and adjust the movement (muscle) range for your character.</li></ul></div><div class="mediaobject"><img src="/graphics/9781785883910/graphics/b26665c5-2b14-4d38-b18d-e0a8abcdd990.png" /></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">You can preview the range of movement in the <strong class="userinput"><code>Muscle Group Preview</code></strong> section by adjusting the sliders (<span class="strong"><strong>1</strong></span>). You can preview the range of movement per muscle in the <strong class="userinput"><code>Per-Muscle Settings</code></strong> section. You can also adjust the range here by unfolding a given muscle foldout and using the slider (<span class="strong"><strong>2</strong></span>). In the <strong class="userinput"><code>Additional Settings</code></strong> section, you can adjust more options of your avatar. These are <span>mainly</span><a id="id325533000" class="indexterm"></a> responsible for the <span class="emphasis"><em>flexibility</em></span> of your rig. You can set how much a bone can be stretched during animation for instance.</li><li style="list-style-type: disc">The <strong class="userinput"><code>Translation DoF</code></strong> option enables animating bones transition in your <strong class="userinput"><code>Humanoid</code></strong> rig. It is turned off by default, meaning that only rotation of the bones is used in animation.</li><li style="list-style-type: disc">In the <strong class="userinput"><code>Rig</code></strong> tab in the <strong class="userinput"><code>model import settings</code></strong>, you can find some additional options:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Avatar Definition</code></strong>: This option is responsible for creating a new avatar or copying the avatar from another model. The second option is useful for storing animations in multiple files. It will be discussed further in the <span class="emphasis"><em>Using animations from multiple assets</em></span> recipe.</li><li style="list-style-type: disc"><strong class="userinput"><code>Optimize Game Objects</code></strong>: This option lets you hide all bones from the <strong class="userinput"><code>Hierarchy</code></strong> view. The number of game objects in the game has an impact on the performance. You can still choose a number of bones that will be displayed in the <strong class="userinput"><code>Hierarch</code></strong>y. It is useful for having exposing weapon slots and similar gameplay-related bones while hiding others.</li><li style="list-style-type: disc"><strong class="userinput"><code>Root node</code></strong>: This option is visible only for <strong class="userinput"><code>Generic</code></strong> rigs. It lets you choose the bone responsible for root motion calculation. We will discuss it further in <span><a class="link" href="#" linkend="ch04">Chapter 4</a></span>, <span class="emphasis"><em>Character Movement</em></span><span>.</span></li></ul></div></li></ul></div></div></div>