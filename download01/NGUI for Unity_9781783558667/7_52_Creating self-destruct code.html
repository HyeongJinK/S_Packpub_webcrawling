<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec52"></a>Creating self-destruct code</h2></div></div><hr /></div><p>Dropping <a id="id329" class="indexterm"></a>barriers on the screen is not enough. <a id="id330" class="indexterm"></a>We will use a self-destruct code to destroy enemies too.</p><p>Each enemy will get a chance to have a self-destruct code. If it has one, an empty slider with <span class="strong"><strong>Code Encrypted</strong></span> displayed inside it will appear above the concerned enemy.</p><p>When the player clicks on the enemy, the hacking process starts. When the hacking is complete, a word will appear as shown in the following screenshot, and the player will have to type it on his keyboard to destroy it:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_07_05.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec73"></a>The hacking slider</h3></div></div></div><p>Let's start<a id="id331" class="indexterm"></a> by creating the hacking slider indicator inside our <span class="strong"><strong>Spaceship</strong></span> prefab by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> view, select our <span class="strong"><strong>Spaceship</strong></span> prefab.</p></li><li><p>Drag it in the <span class="strong"><strong>Hierarchy</strong></span> view as child of the <span class="strong"><strong>Viewport</strong></span> GameObject.</p></li><li><p>Open the <span class="strong"><strong>Wiget Tool</strong></span> window by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span> and then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <span class="strong"><strong>Game</strong></span> Atlas.</p></li><li><p>Select the <span class="strong"><strong>Progress Bar</strong></span> template.</p></li><li><p>Select the <span class="strong"><strong>Button</strong></span> sprite for the <span class="strong"><strong>Empty</strong></span> field.</p></li><li><p>Select the <span class="strong"><strong>Button</strong></span> sprite for the <span class="strong"><strong>Full</strong></span> field.</p></li></ol></div></li><li><p>With<a id="id332" class="indexterm"></a> our <span class="strong"><strong>Spaceship</strong></span> instance selected, click on the <span class="strong"><strong>Add To</strong></span> button.</p></li><li><p>Select the new <span class="strong"><strong>Progress Bar</strong></span> GameObject and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename it as <code class="literal">DestructCode</code>.</p></li><li><p>Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">-100</code>, <code class="literal">100</code>, <code class="literal">0</code>}.</p></li><li><p>Set the value of <span class="strong"><strong>UISlider</strong></span> to <code class="literal">0</code>.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>DestructCode</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change its <span class="strong"><strong>Color Tint</strong></span> values to {<code class="literal">255</code>, <code class="literal">140</code>, <code class="literal">140</code>, <code class="literal">255</code>}.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">2</code>.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Foreground</strong></span> GameObject from <span class="strong"><strong>DestructCode</strong></span> and then perform the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">50</code>, <code class="literal">180</code>, <code class="literal">220</code>, <code class="literal">255</code>}.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">3</code>.</p></li></ol></div></li></ol></div><p>Ok, the slider is ready. Let's add a label that will display <span class="strong"><strong>Code Encrypted</strong></span> and will change to the self-destruct code when the hacking process is finished.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> view, select our <span class="strong"><strong>DestructCode</strong></span> GameObject.</p></li><li><p>Open the <span class="strong"><strong>Widget Tool</strong></span> window by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span> and perform the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <span class="strong"><strong>SciFi Font – Normal</strong></span> font.</p></li><li><p>Select the <span class="strong"><strong>Label</strong></span> template.</p></li><li><p>Change the <span class="strong"><strong>Color</strong></span> to <span class="strong"><strong>R</strong></span>: <code class="literal">255</code>, <span class="strong"><strong>G</strong></span>: <code class="literal">215</code>, <span class="strong"><strong>B</strong></span>: <code class="literal">190</code>, and <span class="strong"><strong>A</strong></span>: <code class="literal">255</code>.</p></li></ol></div></li><li><p>With the <span class="strong"><strong>DestructCode</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</p></li><li><p>Select the new <span class="strong"><strong>Label</strong></span> GameObject from <span class="strong"><strong>DestructCode</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">100</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li><li><p>Set its text to <code class="literal">Code Encrypted</code>.</p></li></ol></div></li></ol></div><p>Your <span class="strong"><strong>Hierarchy</strong></span> view and <span class="strong"><strong>Spaceship</strong></span> should look as follows:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_07_06.jpg" /></div><p>Great! Let's <a id="id333" class="indexterm"></a>apply these new modifications to our <span class="strong"><strong>Spaceship</strong></span> prefab by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> view, select our <span class="strong"><strong>Spaceship</strong></span> GameObject.</p></li><li><p>Click on the <span class="strong"><strong>Apply</strong></span> button at the top of the <span class="strong"><strong>Inspector</strong></span> view to update the prefab.</p></li><li><p>Delete the <span class="strong"><strong>Spaceship</strong></span> instance from our <span class="strong"><strong>Hierarchy</strong></span> view.</p></li></ol></div><p>Ok, we now have a slider that will indicate the hacking status and a label that will display the self-destruct code.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec74"></a>Self-destruct code</h3></div></div></div><p>Let's add <a id="id334" class="indexterm"></a>some self-destruct code and hacking status in the localization files. Open the <code class="literal">English.txt</code> and add the following lines:</p><div class="informalexample"><pre class="programlisting">//Hacking status
CodeEncrypted = Code Encrypted
Hacking = [FF6666]Hacking...
//Self-Destruct Codes
Space = space
Neptune = neptune
Moon = moon
Mars = mars
Jupiter = jupiter</pre></div><p>Now, open the <code class="literal">French.txt</code> file and add the following lines:</p><div class="informalexample"><pre class="programlisting">//Hacking status
CodeEncrypted = Code Crypté
Hacking = [FF6666]Piratage...
//Self-Destruct Codes
Space = espace
Neptune = neptune
Moon = lune
Mars = mars
Jupiter = jupiter</pre></div><p>Good! We now have our necessary localization strings.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec75"></a>Assigning code to an enemy</h3></div></div></div><p>We will now add a <a id="id335" class="indexterm"></a>new <code class="literal">SetDestructCode()</code> method in our <code class="literal">EnemyController.cs</code> script that will assign a self-destruct code to our enemy during initialization. First, let's add the necessary global variables to it.</p><p>Open our <code class="literal">EnemyController.cs</code> script and add the following global variables:</p><div class="informalexample"><pre class="programlisting">//Boolean to check if enemy is hacked or not
public bool hacked = false;
//We will need the Self-Destruct Code Label
private UILabel codeLabel;
//We will also need the hacking slider
private UISlider hackSlider;
//We will need to store the destructCode
public string destructCode = "";
//We will need a hackSpeed float
float hackSpeed = 0.2f;</pre></div><p>We must set these variables. Add the following lines at the end of the <code class="literal">Initialize()</code> method:</p><div class="informalexample"><pre class="programlisting">//Get the hacking slider
hackSlider = transform.FindChild("DestructCode").GetComponent&lt;UISlider&gt;();
//Get the hacking status label
codeLabel = hackSlider.transform.FindChild("Label").GetComponent&lt;UILabel&gt;();</pre></div><p>Ok, now, let's add the <code class="literal">SetDestructCode()</code> method<a id="id336" class="indexterm"></a> that will assign a self-destruct code to the enemy. This method will have a string parameter containing the key of the self-destruct code to be assigned, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public void SetDestructCode(string randomWordKey)
{
  //If the randomWordKey is not empty...
  if(!string.IsNullOrEmpty(randomWordKey))
  {
    //... Get the corresponding localized code
    destructCode = Localization.instance.Get(randomWordKey);
    //Set the Label to "Code Encrypted" 
    codeLabel.text = Localization.instance.Get("CodeEncrypted");
  }
  //If the randomWordKey is empty, disable hacking slider
  else
  hackSlider.gameObject.SetActive(false);
}</pre></div><p>Ok, we have a <a id="id337" class="indexterm"></a>method that sets the correct destruct code. Now, let's create a <code class="literal">Hack()</code> coroutine that will be called to start the hacking process.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec76"></a>The hacking process</h3></div></div></div><p>The <code class="literal">Hack()</code> coroutine <a id="id338" class="indexterm"></a>will gradually fill the hacking slider and display the enemy's self-destruct code when the hacking is complete.</p><p>Add the <code class="literal">Hack()</code> coroutine to the <code class="literal">EnemyController.cs</code> script using the following code snippet:</p><div class="informalexample"><pre class="programlisting">IEnumerator Hack()
{
  //Set the Label to "Hacking..."
  codeLabel.text = Localization.instance.Get("Hacking");
  //While hacking slider is not full
  while(hackSlider.value &lt; 1)
  {
    //Increase slider value, framerate independant
    hackSlider.value += Time.deltaTime * hackSpeed;
    //Wait for next frame
    yield return null;
  }
  //Make sure slider is at 1
  hackSlider.value = 1;
  //Set the hacked bool to true for this enemy
  hacked = true;
  //Display the Self-Destruct code now
  codeLabel.text = "[99FF99]" + destructCode;
}</pre></div><p>Now, let's add an <code class="literal">OnClick()</code> method that will actually launch the hacking process when the enemy is clicked on by the player. We do this in the following manner:</p><div class="informalexample"><pre class="programlisting">void OnClick()
{
  //If the enemy has a destruct code, launch hacking
  if(!string.IsNullOrEmpty(destructCode))
    StartCoroutine(Hack());
}</pre></div><p>Ok, the methods <a id="id339" class="indexterm"></a>are set for our enemy. Now, we can edit our <code class="literal">EnemySpawnController.cs</code> script to call the <code class="literal">SetDestructCode()</code> method when a new enemy is initialized and pass a random destruct code in parameter. First, we will add the necessary variables.</p><p>We will need a <code class="literal">List</code> array to store the enemies in the scene. A <code class="literal">List</code> is like an array but easier to manage with useful methods, such as <code class="literal">Add()</code> and <code class="literal">Remove()</code>. In order to use a <code class="literal">List</code>, you need to include a specific library.</p><p>Open the <code class="literal">EnemySpawnController.cs</code> script and simply add the following line at the very beginning of the file, along with the two other include lines already present:</p><div class="informalexample"><pre class="programlisting">//Include Lists
using System.Collections.Generic;</pre></div><p>Now, add these new global variables within our <code class="literal">EnemySpawnController</code> class:</p><div class="informalexample"><pre class="programlisting">//Chance for each enemy to have a destructCode
public float destructCodeChance = 60;
//Array of strings to store destructCodes keys
public string[] wordKeys;
//We will need a list of enemies
private List&lt;EnemyController&gt; enemies;
//We will need a static instance of this script
public static EnemySpawnController instance;
//This will store the current word typed by the player
public string currentWord;</pre></div><p>Ok, now initialize some of these variables in the new <code class="literal">Awake()</code> method:</p><div class="informalexample"><pre class="programlisting">void Awake()
{
  //Store the instance of this script
  instance = this;
  //Initialize the List
  enemies = new List&lt;EnemyController&gt;();
}</pre></div><p>Before we continue, let's assign the remaining variables in the <span class="strong"><strong>Inspector</strong></span> view. Save the script, go back to Unity, and select our <span class="strong"><strong>Enemies</strong></span> GameObject from <span class="strong"><strong>Viewport</strong></span>.</p><p>Now, set the <span class="strong"><strong>Word Keys</strong></span> array and spawning values as follows:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_07_07.jpg" /></div><p>Good, our <span class="strong"><strong>Word Keys</strong></span> array<a id="id340" class="indexterm"></a> is now set up. Let's return to our <code class="literal">EnemySpawnController.cs</code> script and add the following lines in the <code class="literal">SpawnEnemy()</code> coroutine at the very end of its <code class="literal">while()</code> loop:</p><div class="informalexample"><pre class="programlisting">//Create a new empty string for destruct code
string randomCode = "";
//If the random is valid, get a random word
if(Random.Range(0f,100f) &lt; destructCodeChance)
randomCode = GetRandomWord();
//Set the enemy's the DestructCode newEnemy.SetDestructCode(randomCode);
//Add the enemy to the list of enemies
enemies.Add(newEnemy);</pre></div><p>When an enemy is initialized, the previous code adds it to the <code class="literal">List</code> of enemies and sets its self-destruct code. Now, using the following code, let's create the <code class="literal">GetRandomWord()</code> method<a id="id341" class="indexterm"></a> that will return one of our predefined words:</p><div class="informalexample"><pre class="programlisting">private string GetRandomWord()
{
  //Return a random Word Key
  return wordKeys[Random.Range(0, wordKeys.Length)];
}</pre></div><p>Good. Some of our enemies have a destruct code assigned. Let's just add a method to remove an enemy from the <code class="literal">List</code>, which will be called each time an enemy is destroyed. The method is added as follows:</p><div class="informalexample"><pre class="programlisting">public void EnemyDestroyed(EnemyController destroyedEnemy)
{
  //Remove the destroyed enemy from the List
  enemies.Remove(destroyedEnemy);
}</pre></div><p>Open<a id="id342" class="indexterm"></a> the <code class="literal">EnemyController.cs</code> script. Within the <code class="literal">Kill()</code> coroutine, just before the <code class="literal">Destroy(gameObject)</code> line, add the following line to remove the enemy from the <code class="literal">List</code>:</p><div class="informalexample"><pre class="programlisting">//Remove enemy from the List
EnemySpawnController.instance.EnemyDestroyed(this);</pre></div><p>Perfect. Save all of the scripts and hit the play button. If you click on an enemy that has the hacking slider, the hacking process starts and displays a destruct code when finished. </p><p>The last step is to handle the player's input in order to check if he or she types one of the enemies' self-destruct words.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec77"></a>Handling player input</h3></div></div></div><p>We will <a id="id343" class="indexterm"></a>use the <code class="literal">Update()</code> method of our <code class="literal">EnemySpawnController.cs</code> script to check which characters the player types with his or her keyboard. These characters will be stored one by one and will be compared to our enemies' destruct codes.</p><p>Open our <code class="literal">EnemySpawnController.cs</code> script and create a new <code class="literal">Update()</code> method:</p><div class="informalexample"><pre class="programlisting">void Update()
{
  //If the player has typed a character
  if(!string.IsNullOrEmpty(Input.inputString)) 
  {
    //Add this new character to the currentWord
    currentWord += Input.inputString;
    //We need to know if the code matches at least 1 enemy
    bool codeMatches = false;
    //Check enemies' destruct codes one by one
    for each(EnemyController enemy in enemies)
    {
      //If the enemy has a destruct code AND is hacked
      if(enemy.destructCode != "" &amp;&amp; enemy.hacked)
      {
        //currentWord contain the destruct code?
        if(currentWord.Contains(enemy.destructCode))
        {
          //Yes - Destroy it and update our bool
          StartCoroutine(enemy.Kill());
          codeMatches = true;
        }
      }
    }
    //Did the word match at least 1 enemy?
    if(codeMatches)
    //In that case, reset the currentWord to empty
    currentWord = "";
  }
}</pre></div><p>Save this script.<a id="id344" class="indexterm"></a> Now, when you hack an enemy, you can destroy it by typing its self-destruct code! If multiple enemies have the same code, they will be destroyed simultaneously.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"></a>Note</h3><p>Typing a word may scroll the viewport; this is because Q, A, S, and D are set as Horizontal and Vertical axes by default. Go to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Input</strong></span> and delete (a, d) and (s, w) from the Horizontal and Vertical axes' Alt Positive Button and Alt Negative Button fields respectively.</p></div></div></div>