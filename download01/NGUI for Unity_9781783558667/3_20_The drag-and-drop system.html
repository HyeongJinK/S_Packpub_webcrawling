<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec24"></a>The drag-and-drop system</h2></div></div><hr /></div><p>We <a id="id126" class="indexterm"></a>will now create our own <span class="strong"><strong>drag-and-drop</strong></span> system that<a id="id127" class="indexterm"></a> will enable the user to select a power. They will be able to drag one of the two available powers inside a selection box as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_03_01.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec41"></a>Powers selection</h3></div></div></div><p>Let's <a id="id128" class="indexterm"></a>create a drag-and-drop system to select which of the two powers the player can choose: a <span class="strong"><strong>Bomb</strong></span> power, which will explode or a <span class="strong"><strong>Time</strong></span> power, which will slow down time for a few seconds.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec10"></a>Draggable items container</h4></div></div></div><p>Let's start <a id="id129" class="indexterm"></a>by creating a nice box for our powers and a draggable items container by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>MainMenu</strong></span> GameObject and perform the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new empty child GameObject by pressing <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span>.</p></li><li><p>Rename it as <code class="literal">Powers</code>.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Background</strong></span> and <span class="strong"><strong>Label</strong></span> GameObjects from <span class="strong"><strong>Sound</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate them.</p></li><li><p>Drag these new duplicates inside our <span class="strong"><strong>Powers</strong></span> GameObject.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Background</strong></span> GameObject in <span class="strong"><strong>Powers</strong></span> and perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">320</code> x <code class="literal">420</code>.</p></li><li><p>Set the <span class="strong"><strong>Pixel Offset</strong></span> in <span class="strong"><strong>UIAnchor</strong></span> to {<code class="literal">0</code>, <code class="literal">-100</code>}.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Label</strong></span> GameObject in <span class="strong"><strong>Powers</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename it as <code class="literal">TitleLabel</code>.</p></li><li><p>Change its text to <code class="literal">[AAFFFF]Powers</code>.</p></li></ol></div></li><li><p>Select<a id="id130" class="indexterm"></a> the <span class="strong"><strong>Label</strong></span> GameObject, which is a child of <span class="strong"><strong>Title</strong></span>, and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate it.</p></li><li><p>Rename this new duplicate as <code class="literal">SelectedLabel</code>.</p></li><li><p>Drag it inside our <span class="strong"><strong>Powers</strong></span> GameObject.</p></li><li><p>Drag our <span class="strong"><strong>Background</strong></span> GameObject in <span class="strong"><strong>Powers</strong></span> to the <span class="strong"><strong>Container</strong></span> field in its <span class="strong"><strong>UIAnchor</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Side</strong></span> parameter in <span class="strong"><strong>UIAnchor</strong></span> to <span class="strong"><strong>Top</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Pixel Offset</strong></span> in <span class="strong"><strong>UIAnchor</strong></span> to {<code class="literal">0</code>, <code class="literal">-95</code>}.</p></li><li><p>Change its <span class="strong"><strong>Font</strong></span> to <code class="literal">SciFi Font – Normal</code>.</p></li><li><p>Change its text to <code class="literal">[AAFFFF]Selected</code>.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>SelectedLabel</strong></span> GameObject in <span class="strong"><strong>Powers</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate it.</p></li><li><p>Rename this new duplicate as <code class="literal">AvailableLabel</code>.</p></li><li><p>Change its text to <code class="literal">[AAFFFF]Available</code>.</p></li><li><p>Set its <span class="strong"><strong>Pixel Offset</strong></span> in <span class="strong"><strong>UIAnchor</strong></span> to {<code class="literal">0</code>, <code class="literal">-295</code>}.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>SelectedLabel GameObject</strong></span> in <span class="strong"><strong>Powers</strong></span> and perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate it.</p></li><li><p>Rename this new duplicate it as <code class="literal">InstructionsLabel</code>.</p></li><li><p>Change text to <code class="literal">[55AA99]Drag Power Here</code>—one word per line.</p></li><li><p>Set its <span class="strong"><strong>Overflow</strong></span> parameter to <span class="strong"><strong>Shrink Content</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">4</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">128</code> x <code class="literal">45</code>.</p></li><li><p>Set its <span class="strong"><strong>Pixel Offset</strong></span> in <span class="strong"><strong>UIAnchor</strong></span> to {<code class="literal">0</code>, <code class="literal">-175</code>}.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>Background</strong></span> sprite GameObject in <span class="strong"><strong>Powers</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate it.</p></li><li><p>Rename this new duplicate as <code class="literal">PowersContainer</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">215</code> x <code class="literal">90</code>.</p></li><li><p>Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">100</code>, <code class="literal">100</code>, <code class="literal">100</code>, <code class="literal">255</code>}.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">3</code>.</p></li><li><p>Drag our <span class="strong"><strong>AvailableLabel</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> to the <span class="strong"><strong>Container</strong></span> field in its <span class="strong"><strong>UIAnchor</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Pixel Offset</strong></span> in <span class="strong"><strong>UIAnchor</strong></span> to {<code class="literal">0</code>, <code class="literal">-60</code>}.</p></li></ol></div></li></ol></div><p>Ok, we now <a id="id131" class="indexterm"></a>have our powers box with the correct labels and a background.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec11"></a>Draggable items</h4></div></div></div><p>Now that we <a id="id132" class="indexterm"></a>have the PowersContainer, let's create the following two draggable items:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_03_02.jpg" /></div><p>Follow the ensuing steps to create them:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>PowersContainer</strong></span> GameObject in <span class="strong"><strong>Powers</strong></span>.</p></li><li><p>Create a new child GameObject with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span> and rename it as <code class="literal">Bomb</code>.</p></li><li><p>Attach a <span class="strong"><strong>Collider</strong></span> object to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span>. It will be used to detect the mouse and receive the correct messages for the drag-and-drop system by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Check the <span class="strong"><strong>Is Trigger</strong></span> Boolean.</p></li><li><p>Set its <span class="strong"><strong>Size</strong></span> field of new <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">90</code>, <code class="literal">90</code>, <code class="literal">1</code>}.</p></li></ol></div></li><li><p>Attach a <span class="strong"><strong>Drag Object</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag our <span class="strong"><strong>Bomb</strong></span> from <span class="strong"><strong>PowersContainer</strong></span> in its <span class="strong"><strong>Target</strong></span> field.</p></li><li><p>Set its <span class="strong"><strong>Scale</strong></span> to {<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>}.</p></li><li><p>Set the <span class="strong"><strong>Momentum Amount</strong></span> to <code class="literal">0</code>.</p></li></ol></div></li><li><p>Select and duplicate the <span class="strong"><strong>Background</strong></span> sprite GameObject in <span class="strong"><strong>Powers</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag it inside our new <span class="strong"><strong>Bomb</strong></span> GameObject.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">5</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">90</code> x <code class="literal">90</code>.</p></li><li><p>Remove its <span class="strong"><strong>UIAnchor</strong></span> component.</p></li><li><p>Reset its <span class="strong"><strong>Transform</strong></span> position values to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li></ol></div></li><li><p>Select<a id="id133" class="indexterm"></a> and duplicate the <span class="strong"><strong>AvailableLabel</strong></span> GameObject in <span class="strong"><strong>Powers</strong></span>. Then perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename that new duplicate as <code class="literal">Label</code>.</p></li><li><p>Drag it inside our new <span class="strong"><strong>Bomb</strong></span> GameObject.</p></li><li><p>Change its text to <code class="literal">[AAFFFF]Bomb</code>.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">6</code>.</p></li><li><p>Remove its <span class="strong"><strong>UIAnchor</strong></span> component.</p></li><li><p>Reset its <span class="strong"><strong>Transform</strong></span> position values to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>Bomb</strong></span> GameObject.</p></li><li><p>Attach a <span class="strong"><strong>Button Color</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span> and perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag our <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>Bomb</strong></span> to the <span class="strong"><strong>Target</strong></span> field.</p></li><li><p>Set its <span class="strong"><strong>Pressed</strong></span>
<code class="literal"> </code>color to {<code class="literal">0</code>, <code class="literal">255</code>, <code class="literal">0</code>, <code class="literal">150</code>}.</p></li></ol></div></li><li><p>Create a new <code class="literal">DragItem.cs</code> C# script and attach this script to the <span class="strong"><strong>Button Color</strong></span> component.</p></li></ol></div><p>We have one draggable Bomb power with a <code class="literal">DragItem.cs </code>script attached to it. Let's create the second Time power by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select and duplicate our <span class="strong"><strong>Bomb</strong></span> GameObject in <span class="strong"><strong>PowersContainer</strong></span>.</p></li><li><p>Rename that new duplicate as <code class="literal">Time</code>.</p></li><li><p>Select our new <span class="strong"><strong>Label</strong></span> GameObject, which is a child of <span class="strong"><strong>Time</strong></span>.</p></li><li><p>Change its text to <code class="literal">[AAFFFF]Time</code>.</p></li></ol></div><p>Ok, we now have our two draggable Powers, and they are on top of each other. Let's correct this using Anchors and a Grid component, which will automatically align our items. We can do this using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>PowersContainer</strong></span> GameObject.</p></li><li><p>Create a new child by pressing <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span> and rename this new child as <code class="literal">Grid</code>.</p></li><li><p>Attach a <span class="strong"><strong>Grid</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>.</p></li><li><p>Drag both our <span class="strong"><strong>Bomb</strong></span> and <span class="strong"><strong>Time</strong></span> GameObjects in our new <span class="strong"><strong>Grid</strong></span> GameObject.</p></li><li><p>Select our <span class="strong"><strong>Grid</strong></span> GameObject and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Cell Width</strong></span> to <code class="literal">105</code>.</p></li><li><p>Check the <span class="strong"><strong>Sorted</strong></span> Boolean.</p></li><li><p>Check the <span class="strong"><strong>Reposition Now</strong></span> Boolean to update the table.</p></li><li><p>Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">-52</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li></ol></div></li></ol></div><p>The UIGrid component <a id="id134" class="indexterm"></a>automatically aligns its children. We now have our two draggable powers aligned. If you click on play, you'll see that you can drag them around as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_03_03.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec12"></a>The drop surface</h4></div></div></div><p>We will<a id="id135" class="indexterm"></a> create a new <span class="strong"><strong>Surface</strong></span> GameObject with a <code class="literal">DropSurface.cs</code> script and a <span class="strong"><strong>Box Collider</strong></span> component to define where the draggable items can be dropped.</p><p>When the user drops an object with a <span class="strong"><strong>DragItem</strong></span> component on the <span class="strong"><strong>Surface</strong></span> GameObject, the <span class="strong"><strong>DragItem</strong></span> component will be destroyed, and a "dropped version" of the object will be instantiated as a child of the <span class="strong"><strong>Surface</strong></span> GameObject.</p><p>First, let's create and configure the <span class="strong"><strong>Surface</strong></span> GameObject by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select and duplicate our <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> and rename this new duplicate as <code class="literal">Surface</code>.</p></li><li><p>Select our new <span class="strong"><strong>Surface</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> and perform these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change its <span class="strong"><strong>Sprite</strong></span> to <span class="strong"><strong>Highlight</strong></span>.</p></li><li><p>Change its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">0</code>, <code class="literal">25</code>, <code class="literal">5</code>, <code class="literal">255</code>}.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">3</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">130</code> x <code class="literal">130</code>.</p></li><li><p>Drag our <span class="strong"><strong>SelectedLabel</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> to the <span class="strong"><strong>Container</strong></span> field in its <span class="strong"><strong>UIAnchor</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Pixel Offset</strong></span> to {<code class="literal">0</code>, <code class="literal">-80</code>}.</p></li></ol></div></li><li><p>Attach<a id="id136" class="indexterm"></a> a <span class="strong"><strong>Collider</strong></span> object to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span> | <span class="strong"><strong>Collider</strong></span>. It will detect <span class="strong"><strong>DragItems</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Check its <span class="strong"><strong>Is Trigger</strong></span> Boolean.</p></li><li><p>Set its <span class="strong"><strong>Size</strong></span> to {<code class="literal">130</code>, <code class="literal">130</code>, <code class="literal">1</code>}.</p></li></ol></div></li><li><p>Create and attach a new <code class="literal">DropSurface.cs</code> C# script to it.</p></li></ol></div><p>Good, our surface is now ready to detect our items.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec13"></a>Prefab instantiated on drop</h4></div></div></div><p>Now, we<a id="id137" class="indexterm"></a> need to create two prefabs for our powers that will be instantiated as children of the <span class="strong"><strong>Surface</strong></span> GameObject when a <span class="strong"><strong>DragItem</strong></span> component is dropped on it. They will look as follows:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_03_04.jpg" /></div><p>Let's create these prefabs by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <span class="strong"><strong>Bomb</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span> and the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate it.</p></li><li><p>Rename it as <code class="literal">SelectedBomb</code>.</p></li></ol></div></li><li><p>Select our new <span class="strong"><strong>SelectedBomb</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change its <span class="strong"><strong>Normal</strong></span> color tint to <span class="strong"><strong>R</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>G</strong></span>: <code class="literal">145</code>, <span class="strong"><strong>B</strong></span>: <code class="literal">60</code>, and <span class="strong"><strong>A</strong></span>: <code class="literal">255</code>.</p></li><li><p>Remove its <span class="strong"><strong>Box Collider</strong></span> component.</p></li><li><p>Remove its <span class="strong"><strong>Drag Item</strong></span> component.</p></li></ol></div></li><li><p>Create and attach a new <code class="literal">Power.cs</code> C# script to it.</p></li><li><p>Select the <span class="strong"><strong>Background</strong></span> sprite GameObject from <span class="strong"><strong>SelectedBomb</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change the <span class="strong"><strong>Sprite</strong></span> to <span class="strong"><strong>Light</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">4</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">120</code> x <code class="literal">120</code>.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Label</strong></span> GameObject from <span class="strong"><strong>SelectedBomb</strong></span> and set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">5</code>.</p></li><li><p>Drag our <span class="strong"><strong>SelectedBomb</strong></span> GameObject into a folder of your choice in your <span class="strong"><strong>Project</strong></span> view to create a prefab from it.</p></li><li><p>Once our <span class="strong"><strong>SelectedBomb</strong></span> is a prefab (blue in the scene's <span class="strong"><strong>Hierarchy</strong></span>), you may delete it from the scene.</p></li></ol></div><p>We now<a id="id138" class="indexterm"></a> have our <span class="strong"><strong>SelectedBomb</strong></span> prefab. Let's declare a variable in our <code class="literal">DragItem.cs</code> script that will store the prefab to instantiate on drop. We can do this by following the ensuing steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Bomb</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span>.</p></li><li><p>Open the <code class="literal">DragItem.cs</code> script attached to it and add this public variable using the following code:</p><div class="informalexample"><pre class="programlisting">public Object CreateOnDrop;</pre></div></li><li><p>Save the script and go back to Unity.</p></li><li><p>Select our <span class="strong"><strong>Bomb</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span> and drag our <span class="strong"><strong>SelectedBomb</strong></span> prefab from the Project view in the <span class="strong"><strong>Create On Drop</strong></span> field in its <span class="strong"><strong>Drag Item</strong></span>.</p></li></ol></div><p>Now let's do the same for our <span class="strong"><strong>Time</strong></span> power in the following manner:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>SelectedBomb</strong></span> prefab in the <span class="strong"><strong>Project</strong></span> view and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate it with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>.</p></li><li><p>Rename the new duplicate prefab as <code class="literal">SelectedTime</code>.</p></li></ol></div></li><li><p>Select its <span class="strong"><strong>Label</strong></span> child GameObject and change its text to <code class="literal">[AAFFFF]Time</code>.</p></li><li><p>Select our <span class="strong"><strong>Time</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span> in the scene's <span class="strong"><strong>Hierarchy</strong></span>.</p></li><li><p>Drag our <span class="strong"><strong>SelectedTime</strong></span> prefab from the <span class="strong"><strong>Project</strong></span> view in the <span class="strong"><strong>Create On Drop</strong></span> field in its <span class="strong"><strong>Drag Item</strong></span>.</p></li></ol></div><p>We can now add an <code class="literal">OnDrop()</code> method to our <code class="literal">DropSurface.cs</code> script to handle dropped objects in the following manner:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Surface</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span>.</p></li><li><p>Open its attached <code class="literal">DropSurface.cs</code> script.</p></li></ol></div><p>The <code class="literal">OnDrop()</code> event has one argument: the <code class="literal">dropped</code> GameObject. Let's add this method to our script<a id="id139" class="indexterm"></a> to handle the drop by using the following code snippet:</p><div class="informalexample"><pre class="programlisting">//Called when an object is dropped on DropSurface
public void OnDrop(GameObject dropped)
{
  //Get the DragItem from the dropped object
  DragItem dragItem = dropped.GetComponent&lt;DragItem&gt;();
  //If it has none, don't go further
  if(dragItem == null) return;
  //Instantiate the defined CreateOnDrop Object
  GameObject newPower = NGUITools.AddChild(this.gameObject, dragItem.CreateOnDrop as GameObject);
  //Destroy the dropped Object
  Destroy(dropped);
}</pre></div><p>Save the script and click on the play button. When you drop a power on the <span class="strong"><strong>Surface</strong></span> GameObject, nothing happens! Why?</p><p>That's because the <code class="literal">OnDrop()</code> event depends on the Raycast from <code class="literal">Camera</code>, and at the moment of the drop, our dragged power's <span class="strong"><strong>Box Collider</strong></span> component is in the way of the mouse cursor and the <span class="strong"><strong>Surface</strong></span> GameObject.</p><p>We just have to disable the collider of <span class="strong"><strong>Power</strong></span> while it is dragged. We can do this in the following manner:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Bomb</strong></span> GameObject from <span class="strong"><strong>Grid</strong></span>.</p></li><li><p>Open its attached <code class="literal">DragItem.cs</code> script.</p></li></ol></div><p>We will use the <code class="literal">OnPress()</code> event to do this. The <code class="literal">OnPress()</code> method will take the object's <code class="literal">pressed</code> state as an argument in the following manner:</p><div class="informalexample"><pre class="programlisting">//Method called when the Item is Pressed or Released
void OnPress(bool pressed)
{
  //Invert the collider's state
  collider.enabled = !pressed;
}</pre></div><p>Save the script and click on play. You can now drag-and-drop the powers on the surface!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec14"></a>Handling an invalid drop</h4></div></div></div><p>Now, let's <a id="id140" class="indexterm"></a>make sure power is repositioned to its default position if the user drops it outside the <span class="strong"><strong>Surface</strong></span> GameObject.</p><p>To achieve this, we can check the camera's last hit when the <code class="literal">OnPress(false)</code> event occurs. Open our <code class="literal">DragItem.cs</code> and add the following lines after <code class="literal">collider.enabled = !pressed</code>:</p><div class="informalexample"><pre class="programlisting">//If the Item is released
if(!pressed)
{
  //Get the last hit collider
  Collider col = UICamera.lastHit.collider;
  //If there is no collider, or no DropSurface behind the Power
  if(col == null || col.GetComponent&lt;DropSurface&gt;() == null)
  {
    //Get the grid in parent objects
    UIGrid grid = NGUITools.FindInParents&lt;UIGrid&gt;(gameObject);
    //If a grid is found, order it to Reposition now
    if(grid != null) grid.Reposition();
  }
}</pre></div><p>Save and click on play. If you drop a Power anywhere but on the <span class="strong"><strong>Surface</strong></span> GameObject, our items will be repositioned automatically. Great!</p><p>A slight problem: you can drop both of them on the surface, and then you're stuck. Let's explore the solution in the following sections.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec15"></a>Replacing the current item</h4></div></div></div><p>We will <a id="id141" class="indexterm"></a>now ensure that you can only have one power on the surface. If you drag a second one while the DropSurface is already occupied, the current power will be replaced by the new one and the drag item component will reappear in the <span class="strong"><strong>PowersContainer</strong></span> GameObject.</p><p>We will need to know which power is currently dropped on the surface and which original drag Item component must be instantiated in <span class="strong"><strong>Grid</strong></span> in <span class="strong"><strong>PowersContainer</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>SelectedBomb</strong></span> prefab in the <span class="strong"><strong>Project</strong></span> view.</p></li><li><p>Open its attached <code class="literal">Power.cs</code> script.</p></li></ol></div><p>This script will be used to contain information about the dropped item. Let's declare a new <code class="literal">enum</code> to distinguish which type of power, and an <code class="literal">Object</code> variable to set which prefab will be instantiated to make the draggable item in power reappear when replaced:</p><div class="informalexample"><pre class="programlisting">//Declare an enum to define type of Power
public enum Type 
{
  None,
  Time,
  Bomb
}
//Declare a Type variable to choose it in Inspector
public Type type;
//Object variable to define the DragItem to recreate
public Object createOnDestroy;</pre></div><p>Now, we need<a id="id142" class="indexterm"></a> to go back to Unity and create prefabs for our <code class="literal">Bomb</code> and <code class="literal">Time</code> draggable items before we assign them to the <code class="literal">createOnDestroy</code> variables:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Bomb</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> of <span class="strong"><strong>Scene</strong></span> and drag it into a folder of your choice in your <span class="strong"><strong>Project</strong></span> view to create a prefab from it.</p></li><li><p>Select our <span class="strong"><strong>SelectedBomb</strong></span> Prefab in the <span class="strong"><strong>Project</strong></span> view and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Power</strong></span> component's <span class="strong"><strong>Type</strong></span> variable to <span class="strong"><strong>Bomb</strong></span>.</p></li><li><p>Drag our new <span class="strong"><strong>Bomb</strong></span> Prefab from the Project view to the <span class="strong"><strong>Power</strong></span> component's <span class="strong"><strong>Create On Destroy</strong></span> field.</p></li></ol></div></li></ol></div><p>We assigned the <span class="strong"><strong>Type</strong></span> parameter of <span class="strong"><strong>SelectedBomb</strong></span> to <span class="strong"><strong>Bomb</strong></span>, and it now has an assigned prefab that we will instantiate to recreate the draggable item when it gets replaced.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>Repeat steps 1 and 2, replacing the word <code class="literal">Bomb</code> with <code class="literal">Time</code> to do the same for our Time power GameObject and prefab.</p></div><p>Now, we have to code a system that will register which type of power is currently selected. We'll use the <code class="literal">GameManager.cs</code> script in the following manner to store it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open our <code class="literal">GameManager.cs</code> script and declare this new static variable:</p><div class="informalexample"><pre class="programlisting">//This static variable will contain the selected power
public static Power.Type SelectedPower = Power.Type.None;</pre></div></li><li><p>Add this new static method to set our <code class="literal">SelectedPower</code> from other scripts:</p><div class="informalexample"><pre class="programlisting">//This static method changes the SelectedPower value
public static void SetPower(Power.Type newPower)
{
  SelectedPower = newPower;
}</pre></div></li></ol></div><p>Ok, we now have a method to register the currently selected power. It is time to modify our <code class="literal">DropSurface.cs</code> script:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Surface</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> and open the <code class="literal">DropSurface.cs</code> script.</p></li><li><p>Declare a new <code class="literal">GameObject</code> variable to store our <span class="strong"><strong>Grid</strong></span> GameObject:</p><div class="informalexample"><pre class="programlisting">public GameObject dragItemsContainer;</pre></div></li><li><p>Save the script, select our <span class="strong"><strong>Surface</strong></span> GameObject from <span class="strong"><strong>Powers</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> view. Drag our <span class="strong"><strong>Grid</strong></span> GameObject from <span class="strong"><strong>PowersContainer</strong></span> in its <span class="strong"><strong>DropSurface</strong></span> component's <span class="strong"><strong>Drag Items Container</strong></span> field.</p></li></ol></div><p>Now, go <a id="id143" class="indexterm"></a>back to our <code class="literal">DropSurface.cs</code> script. We will add these following lines to handle the fact that the user cannot drop two powers on the surface; it will replace the previous one and recreate its original <code class="literal">Drag Item</code>. In the <code class="literal">OnDrop()</code> method, just below the <code class="literal">if(dragItem == null) return</code> line, add the following:</p><div class="informalexample"><pre class="programlisting">RecreateDragItem();</pre></div><p>Now, add a new <code class="literal">RecreateDragItem()</code> method<a id="id144" class="indexterm"></a> to the file:</p><div class="informalexample"><pre class="programlisting">void RecreateDragItem()
{
  //If there's already a Power selected
  if(GameManager.SelectedPower != Power.Type.None)
  {
    //Get the selected power's Power.cs script
    Power selectedPowerScript = transform.GetChild(0).GetComponent&lt;Power&gt;();
    //Add the Drag Item to the grid
    NGUITools.AddChild(dragItemsContainer, selectedPowerScript.createOnDestroy as GameObject);
    //Destroy the currently selected Power
    Destroy(selectedPowerScript.gameObject);
  }
}</pre></div><p>Ok, we now have to inform the <code class="literal">GameManager.cs</code> script that the selected Power has changed. We can do this by calling our <code class="literal">SetPower()</code> static method.</p><p>Add the following line in the <code class="literal">OnDrop()</code> method just before the <code class="literal">Destroy(dropped)</code> line:</p><div class="informalexample"><pre class="programlisting">//Set the new selected power in the GameManager
GameManager.SetPower(newPower.GetComponent&lt;Power&gt;().type);</pre></div><p>Save all the scripts and click on the play button. You can drop the first Power on the <span class="strong"><strong>Surface</strong></span> GameObject and then drop the second one. The first power is now replaced and will reappear in the <span class="strong"><strong>Available</strong></span> power container.</p><p>Unfortunately, we cannot simply remove the power. Let's correct this in the following sections.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec16"></a>Removing the current item</h4></div></div></div><p>We want <a id="id145" class="indexterm"></a>to remove the selected power by clicking on it. In our <code class="literal">DropSurface.cs</code> script, add this new <code class="literal">OnClick()</code> method that will be called when the user clicks on the surface:</p><div class="informalexample"><pre class="programlisting">void OnClick()
{
  //Recreate the DragItem now
  RecreateDragItem();
  //Reset SelectedPower to None
  GameManager.SetPower(Power.Type.None);
  //Force reposition of the grid
  dragItemsContainer.GetComponent&lt;UIGrid&gt;().Reposition();
}</pre></div><p>Now click on play. You can now remove the selected power by right- or left-clicking on it.</p></div></div></div>