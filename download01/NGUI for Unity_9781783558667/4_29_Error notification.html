<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec32"></a>Error notification</h2></div></div><hr /></div><p>We <a id="id214" class="indexterm"></a>want the user to enter a nickname in the input field and select a power before he or she can launch the game.</p><p>Right now, <a id="id215" class="indexterm"></a>the user can launch the game regardless of the input and selected power value. Let's correct this by preventing the game's launch and notifying the user, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_04_05.jpg" /></div><p>We will use a TweenScale through code that will gradually scale up the notification from {0, 0, 0} to {1, 1, 1} by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Tooltip</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> window.</p></li><li><p>Duplicate it with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>.</p></li><li><p>Rename this new duplicate as <code class="literal">Notification</code> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Depth</strong></span> parameter in <span class="strong"><strong>UIPanel</strong></span> to 5.</p></li><li><p>Remove its <span class="strong"><strong>UITooltip</strong></span> component.</p></li><li><p>Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">-355</code>, <code class="literal">0</code>}.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>Label</strong></span> GameObject in <code class="literal">Notification</code> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change its text to <code class="literal">This is a Notification</code>.</p></li><li><p>Set the <span class="strong"><strong>Overflow</strong></span> parameter to <span class="strong"><strong>Shrink Content</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Center</strong></span> (middle button + middle button).</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">550</code> x <code class="literal">80</code>.</p></li><li><p>Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li></ol></div></li><li><p>Attach <a id="id216" class="indexterm"></a>a <span class="strong"><strong>Localize</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span>.</p></li><li><p>Select our <span class="strong"><strong>Background</strong></span> GameObject in <code class="literal">Notification</code> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Center</strong></span> (middle button + middle button).</p></li><li><p>Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> parameters to <code class="literal">600</code> x <code class="literal">100</code>.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>Notification</strong></span> GameObject and set its <span class="strong"><strong>Transform</strong></span> scale to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">1</code>}.</p></li><li><p>Create and attach a new <code class="literal">NotificationManager.cs</code> C# script to it and open this new <code class="literal">NotificationManager.cs</code> script.</p></li></ol></div><p>Ok. We have our <span class="strong"><strong>Notification</strong></span> GameObject ready with a scale of {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">1</code>}. Let's use the new <code class="literal">NotificationManager.cs</code> script to launch a TweenScale through code when the <span class="strong"><strong>Notification</strong></span> GameObject is activated.</p><p>We will use an enum to define which notification type will be displayed. This time, we will use the <span class="strong"><strong>UILocalize</strong></span> component for localized text and change the <code class="literal">key</code> parameter through code instead of using the <code class="literal">Localization.instance.Get()</code> method.</p><p>First, declare these variables in the <code class="literal">NotificationManager.cs</code> script as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">//Create an enum to define Notification Type
public enum Type
{
  Nickname,
  Power
}
//Declare necessary variables
public UILocalize loc;
public Type type;
//Store the Notification to access it in static methods
public static NotificationManager instance;</pre></div><p>Save the script. We will stock the instance of <code class="literal">NotificationManager</code> on the scene in the script to be able to access it from any other script easily.</p><p>First, let's assign our <code class="literal">Loc</code> variable using the <span class="strong"><strong>Inspector</strong></span> window.</p><p>Select our <span class="strong"><strong>Notification</strong></span> GameObject and drag our <span class="strong"><strong>Label</strong></span> GameObject in <span class="strong"><strong>Notification</strong></span> in to the <span class="strong"><strong>Loc</strong></span> field.</p><p>Ok, now<a id="id217" class="indexterm"></a> return to our <code class="literal">NotificationManager.cs</code> script. We will first create an <code class="literal">Awake()</code> method with our static instance variable's initialization and disable our <span class="strong"><strong>Notification</strong></span> GameObject to make it invisible when the game starts:</p><div class="informalexample"><pre class="programlisting">void Awake()
{
  //Set the static instance to this NotificationManager
  instance = this;
  //Deactivate Notification GameObject on awake
  gameObject.SetActive(false);
}</pre></div><p>Now that our <code class="literal">Awake()</code> method<a id="id218" class="indexterm"></a> is written, let's create an <code class="literal">OnEnable()</code> method<a id="id219" class="indexterm"></a> that will declare the <code class="literal">TweenScale</code> object and set the corresponding <code class="literal">key</code> parameter for the <code class="literal">UILocalize</code> component as follows:</p><div class="informalexample"><pre class="programlisting">void OnEnable () 
{
  //Start a TweenScale of 0.5 second towards {1, 1, 1}
  TweenScale tween = TweenScale.Begin(this.gameObject, 0.5f, new Vector3(1,1,1));
  //Add an easing in and out method to our Tween
  tween.method = UITweener.Method.EaseInOut;
  //Set the Localize key to TypeName + "Notification"
  loc.key = type.ToString() + "Notification"; 
  //Force Update the UILocalize with new key
  loc.Localize();
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"></a>Note</h3><p>Don't forget that if you change a <code class="literal">key</code> parameter when the <span class="strong"><strong>UILocalize</strong></span> component is already active, you must call its <code class="literal">Localize()</code> method to update it.</p></div><p>Good. Click on the play button. Activate our <span class="strong"><strong>Notification</strong></span> GameObject while Unity is running the play mode.</p><p>You can see that our <span class="strong"><strong>Notification</strong></span> GameObject appears smoothly. Let's add a <code class="literal">Show()</code> method to display it through code as follows:</p><div class="informalexample"><pre class="programlisting">public void Show(Type notificationType, float duration)
{
  //If there is no current Notification
  if(!gameObject.activeInHierarchy)
  {
    //Set the asked Notification type
    type = notificationType;
    //Enable our Notification on scene
    gameObject.SetActive(true);
    //Start Couroutine to remove in asked duration
    StartCoroutine(Remove(duration));
  }
}</pre></div><p>The previous <a id="id220" class="indexterm"></a>method shows our notification by activating its corresponding GameObject. The <code class="literal">OnEnable()</code> method will perform the tween and localization.</p><p>On its last line, the <code class="literal">Show()</code> method starts the <code class="literal">Remove()</code> coroutine. Let's add the following <code class="literal">Remove()</code> coroutine that will make the notification disappear after a given duration:</p><div class="informalexample"><pre class="programlisting">public IEnumerator Remove(float duration)
{
  //Wait for the Notification display duration 
  yield return new WaitForSeconds(duration);
  //Start the TweenScale to disappear
  TweenScale.Begin(gameObject, 0.5f, new Vector3(0,0,1));
  //Wait for 0.5s, the duration of the TweenScale
  yield return new WaitForSeconds(0.5f);
  //Deactivate the Notification GameObject
  gameObject.SetActive(false);
}</pre></div><p>Great. Now we can add the right localization strings in <code class="literal">English.txt</code> as follows:</p><div class="informalexample"><pre class="programlisting">NicknameNotification = [AAFFFF]Please Enter a [00FFAA]Nickname[AAFFFF] before you continue!
PowerNotification = [AAFFFF]Please Select a [00FFAA]Power[AAFFFF] before you continue!</pre></div><p>We can also add the correct strings in <code class="literal">French.txt</code> as follows:</p><div class="informalexample"><pre class="programlisting">NicknameNotification = [AAFFFF]Merci d'entrer un [00FFAA]Pseudo[AAFFFF] avant de continuer !
PowerNotification = [AAFFFF]Merci de s√©lectionner un [00FFAA]Power-Up[AAFFFF] avant de continuer !</pre></div><p>We can now call our <code class="literal">Show()</code> method if the player presses the play button with no nickname entered, or if he or she does not select a power.</p><p>In order to do this, we will remove the current <span class="strong"><strong>Load Level On Click</strong></span> component from our <span class="strong"><strong>Play</strong></span> button and attach a new <code class="literal">LaunchValidator.cs</code> script to it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">Play</code> button GameObject and remove its <span class="strong"><strong>Load Level On Click</strong></span> component.</p></li><li><p>Create and attach a new <code class="literal">LaunchValidator.cs</code> C# script to it and open this new <code class="literal">LaunchValidator.cs</code> script.</p></li></ol></div><p>In this <a id="id221" class="indexterm"></a>new script, we will need our nickname's <span class="strong"><strong>UIInput</strong></span> component. Let's declare it as follows:</p><div class="informalexample"><pre class="programlisting">public UIInput nicknameInput;</pre></div><p>Save the script. Let's assign this variable right now in the <span class="strong"><strong>Inspector</strong></span> window. Then select our <span class="strong"><strong>Play</strong></span> GameObject and drag our <span class="strong"><strong>Input</strong></span> GameObject from <span class="strong"><strong>Nickname</strong></span> in the <span class="strong"><strong>Nickname Input</strong></span> field in its <span class="strong"><strong>Launch Validator</strong></span>.</p><p>Go back to our <code class="literal">LaunchValidator.cs</code> script. We will now add an <code class="literal">OnClick()</code> method to add a nickname and power validation before we actually load the game, as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">void OnClick() 
{
  //If the nickname input is empty...
  if(string.IsNullOrEmpty(nicknameInput.value))
  {
    //...Show a Nickname error notification for 2.5 sec
    NotificationManager.instance.Show(NotificationManager.Type.Nickname, 2.5f);
  }
  //If there's a nickname but no Power is selected...
  else if(GameManager.SelectedPower == Power.Type.None)
  {
    //...Show a Power error notification for 2.5 sec...
    NotificationManager.instance.Show(NotificationManager.Type.Power, 2.5f);
  }
  //If there is a nickname AND a Power selected...
  else
  {
    //... Load Game Scene
    Application.LoadLevel("Game");
  }
}</pre></div><p>Click on the play button. Perfect, we now have notifications that prevent the game from launching if the user has no nickname entered or has no power selected!</p></div>