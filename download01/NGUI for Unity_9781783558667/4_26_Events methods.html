<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec29"></a>Events methods</h2></div></div><hr /></div><p>When<a id="id169" class="indexterm"></a> using C# with NGUI, there are some methods that you<a id="id170" class="indexterm"></a> will regularly use when you need to know if your object is currently hovered upon, pressed, or clicked.</p><p>If you attach a script to any object with a collider on it (for example, a button or a 3D object), you can add the following useful methods in the script to catch events:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">OnHover(bool state)</code>: This <a id="id171" class="indexterm"></a>method is called <a id="id172" class="indexterm"></a>when the object is hovered or unhovered. The <code class="literal">state</code> bool gives the hover state; if <code class="literal">state</code> is <code class="literal">true</code>, the cursor just entered the object's collider. If <code class="literal">state</code> is <code class="literal">false</code>, the cursor has just left the collider's bounds.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnPress(bool state)</code>: This<a id="id173" class="indexterm"></a> method works<a id="id174" class="indexterm"></a> in the exact same way as the previous <code class="literal">OnHover()</code> method, except it is called when the object is pressed. It works with a touch or click. If you need to know which mouse button was used to press the object, use the <code class="literal">UICamera.currentTouchID</code> variable; if this int is equal to -1, it's a left-click. If it's equal to -2, it's a right-click. Finally, if it's equal to -3, it's a middle-click.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnClick()</code>: This<a id="id175" class="indexterm"></a> method is similar to <code class="literal">OnPress()</code>, except<a id="id176" class="indexterm"></a> that this method is exclusively called when the click is validated, meaning when an <code class="literal">OnPress(true)</code> event occurs followed by an <code class="literal">OnPress(false)</code> event. It works with mouse click and touch.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>You can also use the <code class="literal">OnDoubleClick()</code> method, which works in the same way.</p></div></li><li style="list-style-type: disc"><p>
<code class="literal">OnDrag(Vector2 delta)</code>: This <a id="id177" class="indexterm"></a>method is <a id="id178" class="indexterm"></a>called at each frame when the mouse or touch moves between the <code class="literal">OnPress(true)</code> and <code class="literal">OnPress(false)</code> events. The <code class="literal">Vector2</code> <code class="literal">delta</code> argument gives you the object's movement since the last frame.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnDrop(GameObject droppedObj)</code>: This<a id="id179" class="indexterm"></a> method is called when an object is <a id="id180" class="indexterm"></a>dropped on the GameObject on which this script is attached. The dropped GameObject is passed as the <code class="literal">droppedObj</code> parameter.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnSelect()</code>: This method<a id="id181" class="indexterm"></a> is called when the <a id="id182" class="indexterm"></a>user clicks on the object. It will not be called again until another object is clicked on or the object is deselected (click on nothing).</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnInput(string text)</code>: This <a id="id183" class="indexterm"></a>method<a id="id184" class="indexterm"></a> is called when the user types in text while an object is selected. The <code class="literal">text</code> parameter gives the entered text.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnTooltip(bool state)</code>: This<a id="id185" class="indexterm"></a> method is called<a id="id186" class="indexterm"></a> when the cursor is over the object for more than the duration defined by the <span class="strong"><strong>Tooltip Delay</strong></span> inspector parameter of <span class="strong"><strong>UICamera</strong></span>. If the <span class="strong"><strong>Sticky Tooltip</strong></span> Boolean of <span class="strong"><strong>UICamera</strong></span> is checked, the tool tip will remain visible until the cursor moves outside the Collider's Bounds, otherwise the tool tip disappears as soon as the cursor moves.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnScroll(float delta)</code>: This<a id="id187" class="indexterm"></a> method is<a id="id188" class="indexterm"></a> called when the mouse's scroll wheel is moved while the object is hovered—the delta parameter gives you the amount and direction of the scroll.</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnKey(KeyCode key)</code>: This <a id="id189" class="indexterm"></a>method<a id="id190" class="indexterm"></a> is called when the user clicks on a key while the object is selected. The pressed key is stored in the <code class="literal">key</code> parameter.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>If you attach your script on a 3D object to catch these events, make sure it is on a layer included in <code class="literal">Event</code> <code class="literal">Mask</code> of <code class="literal">UICamera</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec48"></a>Creating a tool tip</h3></div></div></div><p>Let's <a id="id191" class="indexterm"></a>now<a id="id192" class="indexterm"></a> use the <code class="literal">OnTooltip()</code> event<a id="id193" class="indexterm"></a> to show a tool tip for our powers, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_04_01.jpg" /></div><p>We will also make sure it is localized using methods integrated with NGUI.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec17"></a>The tool tip reference</h4></div></div></div><p>First, we will create our tool tip that will be shown when needed. These are the steps to do so:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select and duplicate our <span class="strong"><strong>Help</strong></span> GameObject with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename this new duplicate as <code class="literal">Tooltip</code>.</p></li><li><p>Set <span class="strong"><strong>Depth</strong></span> in <span class="strong"><strong>UIPanel</strong></span> to <code class="literal">4</code>.</p></li><li><p>Set <span class="strong"><strong>Clipping</strong></span> in <span class="strong"><strong>UIPanel</strong></span> to <span class="strong"><strong>None</strong></span>.</p></li><li><p>Remove its <span class="strong"><strong>Box Collider</strong></span> component.</p></li><li><p>Remove its <span class="strong"><strong>UIDrag</strong></span>
<code class="literal"> Object</code> component.</p></li><li><p>Remove its <span class="strong"><strong>UIAnchor</strong></span> component.</p></li><li><p>Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li></ol></div></li><li><p>Select <a id="id194" class="indexterm"></a>our new <span class="strong"><strong>Background</strong></span>, which is a child GameObject of <span class="strong"><strong>Tooltip</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">0</code>.</p></li><li><p>Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Top Left</strong></span> (left arrow + up arrow).</p></li><li><p>Reset its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">200</code> x <code class="literal">50</code>.</p></li></ol></div></li><li><p>Select <span class="strong"><strong>Label</strong></span>, which is a child GameObject of <span class="strong"><strong>Tooltip</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Depth</strong></span>
<code class="literal"> </code>to <code class="literal">1</code>.</p></li><li><p>Change its text to <code class="literal">This is a Tooltip</code>.</p></li><li><p>Change its <span class="strong"><strong>Overflow</strong></span> parameter to <span class="strong"><strong>Resize Height</strong></span>.</p></li><li><p>Remove its <span class="strong"><strong>Tween Position</strong></span> component.</p></li><li><p>Remove its <span class="strong"><strong>UILocalize</strong></span> component.</p></li><li><p>Set its <span class="strong"><strong>Pivot</strong></span> parameter to <span class="strong"><strong>Top Left</strong></span> (left arrow + up arrow).</p></li><li><p>Set its <span class="strong"><strong>Transform</strong></span> position to {<code class="literal">15</code>, <code class="literal">-15</code>, <code class="literal">0</code>}.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> parameter to <code class="literal">200</code> x <code class="literal">20</code>.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>Tooltip</strong></span> GameObject.</p></li><li><p>Attach a <span class="strong"><strong>Tooltip</strong></span> to the selected object by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>UI</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag our <span class="strong"><strong>Label</strong></span> GameObject from <span class="strong"><strong>Tooltip</strong></span> to its <span class="strong"><strong>Text</strong></span> field.</p></li><li><p>Drag our <span class="strong"><strong>Window</strong></span> GameObject from <span class="strong"><strong>Tooltip</strong></span> to its <span class="strong"><strong>Background</strong></span> field.</p></li></ol></div></li></ol></div><p>Ok. Our tool tip is ready to be displayed. The fact that we have set the <span class="strong"><strong>Pivot</strong></span> parameter of <span class="strong"><strong>Label</strong></span> under <span class="strong"><strong>Tooltip</strong></span> to <span class="strong"><strong>Top left</strong></span>, with a position of {<code class="literal">15</code>, <code class="literal">-15</code>, <code class="literal">0</code>}, will force a margin between the text and the background sprite.</p><p>The <span class="strong"><strong>Overflow</strong></span> parameter will let the text be resized in height only, which will make our tool tip coherent even if we have a long tool tip—the <span class="strong"><strong>Background</strong></span> sprite will automatically resize to fit the <span class="strong"><strong>Label</strong></span> GameObject.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec18"></a>Showing the tool tip</h4></div></div></div><p>We must<a id="id195" class="indexterm"></a> now show the tool tip when needed. In order to do that, we just need to use the <code class="literal">OnTooltip()</code> event, in which we will create a new tool tip with localized text.</p><p>In the <span class="strong"><strong>Project</strong></span> view, select both our <span class="strong"><strong>Time</strong></span> and <span class="strong"><strong>Bomb</strong></span> prefabs and create and add a new <code class="literal">TooltipManager.cs</code> C# script to it.</p><p>You can<a id="id196" class="indexterm"></a> now open this new <code class="literal">TooltipManager.cs</code> script and declare the following enum, which will define which type of tool tip it must display:</p><div class="informalexample"><pre class="programlisting">//Enum to define which type of tooltip must be shown
public enum Type
{
  Bomb,
  Time
}

//Declare the Type enum variable
public Type type;</pre></div><p>Ok, now add the following <code class="literal">OnTooltip()</code> method that will create a tool tip with localized text depending on its current type:</p><div class="informalexample"><pre class="programlisting">//When a Tooltip event is triggered on this object
void OnTooltip(bool state)
{
  //If state is true, create a new Tooltip depending on the type
  if(state)
    UITooltip.ShowText(Localization.instance.Get(type.ToString() + "Tooltip"));
  //If state is false, hide tooltip by setting an empty string
  else
  UITooltip.ShowText("");
}</pre></div><p>Save the script. As you can see, we use a useful <code class="literal">Localization.instance.Get(string key)</code> method that returns localized text of the corresponding <code class="literal">key</code> parameter that is passed. You can now change a label to localized text through code anytime!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>To use <code class="literal">Localization.instance.Get(string key)</code>, your label must not have a <span class="strong"><strong>UILocalize</strong></span> component attached to it; otherwise, the value of <span class="strong"><strong>UILocalize</strong></span> will overwrite anything you assign to the label.</p></div><p>Ok, we have added the code to show our tool tip with localized text. Now we have to add these localized strings to the <code class="literal">English.txt</code> file using the following code:</p><div class="informalexample"><pre class="programlisting">BombTooltip = Explodes all\nenemies at once
TimeTooltip = Slows Time\nfor 10 seconds</pre></div><p>Similarly, add the following lines in the <code class="literal">French.txt</code> file:</p><div class="informalexample"><pre class="programlisting">BombTooltip = Détruit tous les ennemis d'un coup
TimeTooltip = Ralentit le temps pour 10 secondes</pre></div><p>Save these<a id="id197" class="indexterm"></a> files and go back to Unity to assign the <span class="strong"><strong>TooltipManager</strong></span> type's variables by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> view, select our <span class="strong"><strong>Bomb</strong></span> prefab and set its <span class="strong"><strong>Type</strong></span> field in <span class="strong"><strong>TooltipManager</strong></span> to <code class="literal">Bomb</code>.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> view, select our <span class="strong"><strong>Time</strong></span> prefab and set its <span class="strong"><strong>Type</strong></span> field in <span class="strong"><strong>TooltipManager</strong></span> to <span class="strong"><strong>Time</strong></span>.</p><p>Click on the play button. When you leave your cursor on the <span class="strong"><strong>Bomb</strong></span> or <span class="strong"><strong>Time</strong></span> power in the <span class="strong"><strong>Available powers</strong></span> slot, our localized tool tip appears! I actually have the feeling that the delay is too long. Let's correct this.</p></li><li><p>Select our <span class="strong"><strong>Camera</strong></span> GameObject from <span class="strong"><strong>UI Root (2D)</strong></span> and set its <span class="strong"><strong>Tooltip Delay</strong></span> value in <span class="strong"><strong>UICamera</strong></span> to <code class="literal">0.3</code>.</p></li></ol></div><p>That's better—our localized tool tip appears within 0.3 seconds of hovering.</p></div></div></div>