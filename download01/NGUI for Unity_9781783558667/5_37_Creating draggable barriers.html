<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec39"></a>Creating draggable barriers</h2></div></div><hr /></div><p>It is time to create our <a id="id242" class="indexterm"></a>draggable barriers. The player will be able to drag-and-drop the <span class="strong"><strong>BarrierObject</strong></span> prefab in the <span class="strong"><strong>Viewport</strong></span> GameObject. This <span class="strong"><strong>BarrierObject</strong></span> prefab will look as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_05_06.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec53"></a>The BarrierObject prefab</h3></div></div></div><p>First, we need<a id="id243" class="indexterm"></a> to create our <span class="strong"><strong>BarrierObject</strong></span> prefab's holder that will contain the draggable object:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>UI</strong></span> GameObject.</p></li><li><p>Create a new child with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span> and rename it as <code class="literal">Barrier</code>.</p></li><li><p>Open the <span class="strong"><strong>Widget Tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Open</strong></span> and perform the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select <span class="strong"><strong>Sprite</strong></span> for the <span class="strong"><strong>Template</strong></span> parameter.</p></li><li><p>Select <span class="strong"><strong>Dark</strong></span> sprite for the <span class="strong"><strong>Sprite</strong></span> field.</p></li><li><p>With our <span class="strong"><strong>Barrier</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</p></li></ol></div></li><li><p>Select our new barrier's <span class="strong"><strong>Sprite (Dark)</strong></span> GameObject and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename it as <code class="literal">Background</code>.</p></li><li><p>Set its <span class="strong"><strong>Sprite Type</strong></span> to <span class="strong"><strong>Sliced</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Color Tint</strong></span> to {<code class="literal">0</code>, <code class="literal">250</code>, <code class="literal">250</code>, <code class="literal">170</code>}.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">0</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">200</code> x <code class="literal">200</code>.</p></li></ol></div></li><li><p>Select our <span class="strong"><strong>Barrier</strong></span> GameObject.</p></li><li><p>Attach a collider to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach a Collider</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Center</strong></span> coordinates in <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li><li><p>Set the <span class="strong"><strong>Size</strong></span> parameter of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">200</code>, <code class="literal">200</code>, <code class="literal">1</code>}.</p></li></ol></div></li><li><p>Attach <span class="strong"><strong>Anchor</strong></span> to it by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Attach</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag our <span class="strong"><strong>Viewport</strong></span> GameObject in its <span class="strong"><strong>Container</strong></span> field.</p></li><li><p>Set its <span class="strong"><strong>Side</strong></span> parameter to <span class="strong"><strong>TopLeft</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Pixel Offset</strong></span> to {<code class="literal">100</code>, <code class="literal">-100</code>}.</p></li></ol></div></li></ol></div><p>Ok, we have our <span class="strong"><strong>BarrierObject</strong></span> holder's background at the top left-hand corner as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783558667/graphics/8667OT_05_07.jpg" /></div><p>Let's create<a id="id244" class="indexterm"></a> the actual <span class="strong"><strong>BarrierObject</strong></span> prefab, which will be a custom button:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Barrier</strong></span> GameObject.</p></li><li><p>Open the <span class="strong"><strong>Widget tool</strong></span> wizard by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create a Widget</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag the <span class="strong"><strong>SciFi Font â€“ Normal</strong></span> prefab into the <span class="strong"><strong>Widget Tool</strong></span> wizard's <span class="strong"><strong>Font</strong></span> field by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Examples</strong></span> | <span class="strong"><strong>Atlases</strong></span> | <span class="strong"><strong>SciFi</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Button</strong></span> for the <span class="strong"><strong>Template</strong></span> field.</p></li><li><p>Select the <span class="strong"><strong>Highlight</strong></span> sprite for the <span class="strong"><strong>Background</strong></span> field.</p></li><li><p>With our <span class="strong"><strong>Barrier</strong></span> GameObject selected, click on the <span class="strong"><strong>Add To</strong></span> button.</p></li></ol></div></li><li><p>Select our new <span class="strong"><strong>Button</strong></span> GameObject from <span class="strong"><strong>Barrier</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename it as <code class="literal">BarrierObject</code>.</p></li><li><p>Set its <span class="strong"><strong>Center</strong></span> coordinates <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>}.</p></li><li><p>Set <span class="strong"><strong>Size</strong></span> of <span class="strong"><strong>Box Collider</strong></span> to {<code class="literal">160</code>, <code class="literal">160</code>, <code class="literal">0</code>}.</p></li></ol></div></li><li><p>Drag the <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>BarrierObject</strong></span> into the <span class="strong"><strong>Target</strong></span> field in <span class="strong"><strong>UIButton</strong></span>. Then perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Normal Color</strong></span> to {<code class="literal">125</code>, <code class="literal">255</code>, <code class="literal">155</code>, <code class="literal">130</code>}.</p></li><li><p>Set its <span class="strong"><strong>Hover Color</strong></span> to {<code class="literal">100</code>, <code class="literal">255</code>, <code class="literal">60</code>, <code class="literal">255</code>}.</p></li><li><p>Set its <span class="strong"><strong>Pressed Color</strong></span> to {<code class="literal">20</code>, <code class="literal">255</code>, <code class="literal">0</code>, <code class="literal">160</code>}.</p></li><li><p>Set its <span class="strong"><strong>Disabled Color</strong></span> to {<code class="literal">115</code>, <code class="literal">115</code>, <code class="literal">155</code>, <code class="literal">255</code>}.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Background</strong></span> GameObject from <span class="strong"><strong>BarrierObject</strong></span> and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its <span class="strong"><strong>Depth</strong></span> value to <code class="literal">1</code>.</p></li><li><p>Set its <span class="strong"><strong>Dimensions</strong></span> to <code class="literal">160</code> x <code class="literal">160</code>.</p></li></ol></div></li><li><p>Select the <span class="strong"><strong>Label</strong></span> GameObject from <span class="strong"><strong>BarrierObject</strong></span> and then perform the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its text to <code class="literal">[99FF99]Barrier</code>.</p></li><li><p>Set its <span class="strong"><strong>Depth</strong></span> to <code class="literal">2</code>.</p></li></ol></div></li></ol></div><p>Ok. We<a id="id245" class="indexterm"></a> now have our <span class="strong"><strong>BarrierObject</strong></span> in the <span class="strong"><strong>Barrier</strong></span> holder. Let's make it draggable by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>BarrierObject</strong></span> GameObject.</p></li><li><p>Attach a <span class="strong"><strong>Drag Object</strong></span> component to it by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Interaction</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag our <span class="strong"><strong>BarrierObject</strong></span> GameObject in its <span class="strong"><strong>Target</strong></span> field.</p></li><li><p>Set its <span class="strong"><strong>Scale</strong></span> parameter to {<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>} to avoid Z scrolling.</p></li><li><p>Set its <span class="strong"><strong>Drag Effect</strong></span> parameter to <span class="strong"><strong>None</strong></span>. We want it to be precise.</p></li></ol></div></li><li><p>Create and attach a new <code class="literal">BarrierObjectController.cs</code> C# script to it.</p></li></ol></div><p>Click on the play button. The <span class="strong"><strong>BarrierObject</strong></span> prefab is now draggable. Now, it is time to handle the drop on the <span class="strong"><strong>Viewport</strong></span> GameObject.</p><p>Before we continue, drag our <span class="strong"><strong>BarrierObject</strong></span> in a folder of your choice in the <span class="strong"><strong>Project</strong></span> view to make it a prefab.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec54"></a>Dropping a barrier on Viewport</h3></div></div></div><p>In order to drop<a id="id246" class="indexterm"></a> a barrier inside the <span class="strong"><strong>Viewport</strong></span> GameObject, we need to catch the <span class="strong"><strong>Viewport</strong></span> GameObject's <code class="literal">OnDrop()</code> event and check what was dropped:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <span class="strong"><strong>Viewport</strong></span> GameObject.</p></li><li><p>Create and attach a new <code class="literal">ViewportHolder.cs</code> C# script to it.</p></li><li><p>Open this new <code class="literal">ViewportHolder.cs</code> script.</p></li></ol></div><p>In this script, we can add a new <code class="literal">OnDrop()</code> method that will be called when an object is dropped on it:</p><div class="informalexample"><pre class="programlisting">void OnDrop(GameObject droppedObj)
{
  //Get the dropped object's BarrierObjectController
  BarrierObjectController barrierObj = droppedObj.GetComponent&lt;BarrierObjectController&gt;();

  //If it actually has one, destroy the droppedObj
  if(barrierObj != null){
    Destroy(droppedObj);
  }
}</pre></div><p>Save the<a id="id247" class="indexterm"></a> script and click on the play button. Surprisingly, when you drop the <span class="strong"><strong>BarrierObject</strong></span> on the <span class="strong"><strong>Viewport</strong></span> GameObject, nothing happens!</p><p>That's because, like in <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Enhancing your UI</em></span>, the Collider of <span class="strong"><strong>BarrierObject</strong></span> is enabled when the <code class="literal">OnPress(false)</code> event occurs. This obstructs the collision detection of <span class="strong"><strong>UICamera</strong></span>.</p><p>We just have to disable the collider while dragging, and re-enable it when dropping it. Let's also make it reposition itself if it isn't dropped on the <span class="strong"><strong>Viewport</strong></span> GameObject. Open our <code class="literal">BarrierObjectController.cs</code> script, and add following <code class="literal">OnPress()</code> method to do so:</p><div class="informalexample"><pre class="programlisting">void OnPress(bool pressed)
{
  //Invert the Collider's state
  collider.enabled = !pressed;

  //If it has just been dropped
  if(!pressed)
  {
    //Get the target's collider
    Collider col = UICamera.lastHit.collider;
    //If the target has no collider or is not the viewport
    if(col == null || col.GetComponent&lt;ViewportHolder&gt;() == null)
    //Reset its localPosition to {0,0,0}
    transform.localPosition = Vector3.zero;
  }
}</pre></div><p>Save the script and click on the play button. This time, the collider is disabled when the <span class="strong"><strong>BarrierObject</strong></span> prefab is dropped. So, it is indeed dropped on the collider of <span class="strong"><strong>Viewport</strong></span> and destroyed instantly.</p><p>If it is dropped somewhere else (out of screen or on the barrier's container), it is automatically replaced at the center of the barrier's container. Let's make this <span class="strong"><strong>BarrierObject</strong></span> a prefab by dragging it in the folder of your choice inside the <span class="strong"><strong>Project</strong></span> view.</p><p>We can now create an <span class="strong"><strong>ActiveBarrier</strong></span> prefab that will be instantiated on the <span class="strong"><strong>Viewport</strong></span> GameObject.</p></div></div>