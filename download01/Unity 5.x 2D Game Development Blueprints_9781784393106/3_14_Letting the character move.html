<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec17"></a>Letting the character move</h2></div></div><hr /></div><p>In the following section, we will learn how to use the 2D controller and the physic engine of Unity to let our character move.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec14"></a>Adjusting the Platformer 2D controller</h3></div></div></div><p>Before we start to add a new controller, we need to remove the previous one. So, select the <code class="literal">Player</code> object, and in the <span class="strong"><strong>Inspector</strong></span>, right-click on the <span class="strong"><strong>PlayerMovement</strong></span> script and then <span class="strong"><strong>Remove Component</strong></span>. As a result, our script will no longer be attached to the <code class="literal">Player</code> object.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip11"></a>Tip</h3><p>Since we are going to use the <code class="literal">Character Controller</code> inside the <span class="strong"><strong>Standard Assets</strong></span>, we need to have it in our project. If you haven't downloaded it yet, you can do so by going in the <span class="strong"><strong>Asset Store</strong></span>: <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Asset Store</strong></span> or alternatively, <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>9</em></span>. If you have already downloaded them, but not imported them into this project, you can do so by by clicking on <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package </strong></span>or again, using the <span class="strong"><strong>Asset Store</strong></span>. At the end, you should have everything that you need in the <code class="literal">2D</code> folder.</p></div><p>Let's add the components <code class="literal">PlatformerCharacter2D</code> and <code class="literal">Platformer2DUserControl</code> to the <code class="literal">Player</code> object. You can use either the search tool in the <span class="strong"><strong>Project</strong></span> panel and then drag and drop them, or click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Scripts</strong></span> in the Inspector when the <code class="literal">Player</code> object is selected.</p><p>At the end, the <code class="literal">PlatformerCharacter2D</code> component should look as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_007.jpg" /></div><p>
</p><p>Let's see what the main features of this controller component are:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Max Speed</strong></span>: This is the maximum speed that the player can reach when moving along the <span class="emphasis"><em>X</em></span> axis</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Jump Force</strong></span>: This is the force that will be applied to the player's rigid body when he jumps</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Crouch Speed</strong></span>: This is the player's speed while crouching (crouching is done by pressing <span class="emphasis"><em>Ctrl</em></span>)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Air Control</strong></span>: If marked true, the player can also be controlled in air, when he is not being grounded</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>What Is Ground</strong></span>: These are the layers that will be treated as the ground</p></li></ul></div><p>The <code class="literal">PlatformerCharacter2D</code> component makes use of the rigid body attached to the object to move the character in a Platformer fashion. It still allows us to use the other physical forces in the scene, making the character even more believable.</p><p>However, before we use it, we need to make some changes to the controller. As a result, we can achieve exactly what we want:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's start by changing the values in the <code class="literal">PlatformerCharacter2D</code> component to match the values shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_008.jpg" /></div><p>
</p></li><li><p>Now we need to define which are the top and bottom ends of the <code class="literal">Player</code> object. This is because they are used by the <code class="literal">PlatformerCharacter2D</code> component to understand the dimensions of the character. We can easily do this by adding two empty child game objects to the <code class="literal">Player</code>, as shown in the following image:</p></li></ol></div><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_009.jpg" /></div><p>
</p><p>Now we also need to adjust their positions. Here are the <span class="strong"><strong>CeilingCheck</strong></span> settings:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_010.jpg" /></div><p>
</p><p>Here are the <span class="strong"><strong>GroundCheck</strong></span> ones:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_011.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec15"></a>Defining a physical shape for the character</h3></div></div></div><p>For the next step, we have to give a physical shape to our character. So, let's add another collider: <code class="literal">CircleCollider2D</code>. Now, we need to adjust the values on both the colliders that are attached to the player, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_012.jpg" /></div><p>
</p><p>This is how the colliders will look in the <span class="strong"><strong>Scene</strong></span> view after the changes:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_013.jpg" /></div><p>
</p><p>Finally, in the <code class="literal">RigidBody2D</code> component, we need to change <span class="strong"><strong>Fixed Angle</strong></span> to <span class="strong"><strong>True</strong></span>. As a result, our character will not rotate. Also, in the <span class="strong"><strong>Interpolate</strong></span> variable, choose the <code class="literal">Interpolate</code> method in order to smooth the character movement.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec16"></a>Improving the Animator</h3></div></div></div><p>In the <span class="strong"><strong>Animator</strong></span> component, choose <code class="literal">Animate Physics</code> inside the <span class="strong"><strong>Update Mode</strong></span>. We use this option to keep the animator in sync with the <code class="literal">FixedUpdate</code> calls in the code. As a result, our character is animated properly.</p><p>In the next step, we have to change the Animator parameters in order to match the variables in the <code class="literal">PlatformerCharacter2D</code> class. Select the <code class="literal">Player</code> object and open the <span class="strong"><strong>Animator</strong></span> window by double-clicking on it. Now, we need to apply the following changes:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Rename the parameter <code class="literal">PlayerSpeed</code> to <code class="literal">Speed</code>. This is the speed of the player.</p></li><li><p>Rename the parameter <code class="literal">Jump</code> to <code class="literal">Ground</code>. This stores information about whether the character is grounded or not.</p></li><li><p>Add a new parameter of type <code class="literal">Boolean</code> and name it <code class="literal">Crouch</code>. This stores if the player is crouched or not.</p></li><li><p>Add a new parameter of type <code class="literal">float</code> and name it <code class="literal">vSpeed</code>. This is the vertical speed.</p></li></ol></div><p>So, in the end, we should have the following parameters set in the <span class="strong"><strong>Parameters</strong></span> tab:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_014.jpg" /></div><p>
</p><p>Now that we have set the parameters, we can use them in our state machine. So, let's start to modify it by following these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Delete the transition from the <code class="literal">Idle</code> state to the <code class="literal">Jump</code> state.</p></li><li><p>Add a new transition from <code class="literal">Any State</code> to <code class="literal">Jump</code> and name it <code class="literal">StartJump</code>. Then, add a new condition that uses the <code class="literal">Ground</code> parameter with the value <code class="literal">False</code>.</p></li><li><p>In the transition from <code class="literal">Jump</code> to <code class="literal">Idle</code>, change the <span class="strong"><strong>Transition Duration</strong></span> to 0, so to minimize the time between the two states. Also, make sure that the condition uses the <code class="literal">Ground</code> parameter with the value <code class="literal">True</code>.</p></li><li><p>In the transition from <code class="literal">Idle</code> to <code class="literal">Walk</code>, the condition should use the <span class="strong"><strong>Speed</strong></span> parameter with a value greater than <code class="literal">0.1</code>, and not the old parameter we have erased.</p></li><li><p>Finally, in the transition from <code class="literal">Walk</code> to <code class="literal">Idle</code>, again the condition has to use the <span class="strong"><strong>Speed</strong></span> parameter with a value less than <code class="literal">0.1</code>.</p></li></ol></div><p>After we have made the above changes, the Animator screen should look as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_015.jpg" /></div><p>
</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec1"></a>Testing the character movement</h4></div></div></div><p>As the last step, we can press the play button and see what we have achieved so far. As you move the character, you can see that he moves along the <span class="emphasis"><em>X</em></span> axis and he can jump!</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_016.jpg" /></div><p>
</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_03_017.jpg" /></div><p>
</p></div></div></div>