<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec49"></a>The tower seller</h2></div></div><hr /></div><p>One of the key gameplay elements of a tower defense game is, of course, the ability to buy and place towers. Buying a tower is something that the player should be able to do through the UI. In this section, we will learn how to create a button for the player to buy towers. In the next chapter, we will also see how to place it in the map.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec32"></a>Creating and placing the tower seller</h3></div></div></div><p>Let's start by creating a new Image by right-clicking on the <span class="strong"><strong>Hierarchy</strong></span> panel and then <span class="strong"><strong>UI/Image</strong></span>. We should also rename it <code class="literal">TowerSeller</code> and assign to the <span class="strong"><strong>Source Image</strong></span> the <code class="literal">tower_rect</code> image in our package. We may want to press <span class="strong"><strong>Set Native Size</strong></span> and then scale it down to fit the screen. Finally, we can drag and drop it next to the <code class="literal">LivesCounter</code>, as shown in the following picture:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_010.jpg" /></div><p>
</p><p>Now, we need to add text where the price of our tower will be shown. Right-click on <span class="strong"><strong>TowerSeller</strong></span> and then <span class="strong"><strong>UI/Text</strong></span>. Rename it <code class="literal">PriceText</code>, and we need to change its setting to the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_011.jpg" /></div><p>
</p><p>In particular, we have set its color to white and the <span class="strong"><strong>Font Size</strong></span> to <code class="literal">17</code>. In this way, it has the right dimensions and color to fit in our UI. Finally, we have to place it just next to the <code class="literal">LivesCounter</code>, but still inside the box, as in the next image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_012.jpg" /></div><p>
</p><p>The next step is to add a button where the player can click to buy the tower. Right-click on TowerSeller again and then <span class="strong"><strong>UI/Button</strong></span>. We have to assign the <span class="strong"><strong>Source Image</strong></span> to the <code class="literal">empty_rect</code> image in our package. Also, we should adjust the text inside the button by clicking on its child, called <code class="literal">Text</code>, as default. Similar settings to the price text apply here too, and change the text into <code class="literal">buy</code>. At the end, we should have something similar to this:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_013.jpg" /></div><p>
</p><p>If we did everything right, our scene should look like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_014.jpg" /></div><p>
</p><p>Now, we need to add a script to it. This will handle the interaction with the player, by giving him the possibility to buy a tower. To create the script, select TowerSeller and, in the Inspector, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>. Name it <code class="literal">BuyTowerScript</code>, and then click on <span class="strong"><strong>Create and Add</strong></span>. Double-click to open it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec33"></a>Scripting the tower seller</h3></div></div></div><p>The first thing to do is to add the following line at the beginning of our script:</p><pre class="programlisting">using UnityEngine.UI; 
</pre><p>As result, we will be able to use the UI classes.</p><p>We need a private variable to store our <code class="literal">MoneyCounter</code>, since we need to get how much money the player has. In fact, we need to compare that value with the price to check whether the player has enough money to actually buy the tower:</p><pre class="programlisting">    MoneyCounterScript moneyCounter; 
</pre><p>On the other hand, we need three public variables. One is needed to store the <code class="literal">uiText</code> to show the price. Another one is the price itself, since you may want to adjust it without changing the script. The last one is the <code class="literal">towerprefab</code>, to instantiate it if the player buys it:</p><pre class="programlisting">    public Text uiPrice; 
    public int price; 
    public GameObject towerPrefab; 
</pre><p>In the <code class="literal">Start()</code> function, we can set our private variable by finding the <code class="literal">MoneyCounter</code> in the scene. Furthermore, we need to update the <code class="literal">uiText</code> that shows the price, since we suppose it won't change over time:</p><pre class="programlisting">  void Start () { 
        moneyCounter = GameObject.Find("MoneyCounter").GetComponent&lt;MoneyCounterScript&gt;(); 
        uiPrice.text = "$" + price; 
  } 
</pre><p>Now, we need to create a function that is called every time the button is pressed. The first thing to do here is to get the current money for the player and then compare this to the price. If the player has enough money, then we need to reduce the amount of money by calling the <code class="literal">changeMoney()</code> function we have created in the previous section of this chapter. We need to pass to it a negative value, since we are reducing the player's money. Finally, instantiate a new tower on the mouse position:</p><pre class="programlisting">    public void OnClick() { 
        int money = moneyCounter.getMoney(); 
        if (money &gt;= price) {         
          moneyCounter.changeMoney(-price); 
          Instantiate(towerPrefab,Input.mousePosition,Quaternion.identity); 
        } 
    } 
</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip27"></a>Tip</h3><p>Here, we are not giving any feedback to the player when he presses the buy button. In fact, when he or she hasn't got enough money, there is nothing set to relay this information back to the player. Since, in general, it's a good practice to give feedback to the player, we need to add an <code class="literal">else</code> statement. Inside this branch, we can implement a way to warn the player that he or she hasn't enough money. For instance, it could be a sound or voice, red text on the screen, or both. This depends also on the kind of atmosphere you want to give to your game.</p></div><p>We can save the script and return back to the Unity <span class="strong"><strong>Editor</strong></span>. In fact, we haven't finished yet, since we need to assign our variables to the script, and call the <code class="literal">OnClick()</code> function every time the buy button is pressed.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec34"></a>Finishing the tower seller</h3></div></div></div><p>In order to finalize our seller, we need to link the <code class="literal">OnClick()</code>function with the event of pressing the buy button. This can be done by using the UI events integrated into Unity. Select <span class="strong"><strong>BuyButton</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> panel. In the <span class="strong"><strong>Inspector</strong></span>, at the bottom of the <span class="strong"><strong>Button</strong></span> component, there is a tab called <span class="strong"><strong>On Click ()</strong></span>. To add a new event, press the <span class="strong"><strong>+</strong></span> in the lower-right corner. Now, in the <span class="strong"><strong>Object</strong></span> variable, we have to drag the script that is just below the tab, <code class="literal">BuyTowerScript</code>. Then, click on the drop-down menu where <code class="literal">no function</code> is written and select <span class="strong"><strong>BuyTowerScript</strong></span> | <span class="strong"><strong>On Click ()</strong></span>. Once we have done all of this, the <span class="strong"><strong>Button</strong></span> component should appear like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_015.jpg" /></div><p>
</p><p>Now, we still have to assign the variable to the script that we have just created.</p><p>Drag and drop the <span class="strong"><strong>PriceText</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> panel into the <code class="literal">uiPrice</code> variable. Then, set a price for your tower, for instance, <code class="literal">1200</code>. Finally, drag and drop from the <span class="strong"><strong>Project</strong></span> panel the <code class="literal">towerprefab</code> we created in the previous chapter. However, keep in mind that we are going to modify it in the next chapter. In the end, our script should be like the following, in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_08_016.jpg" /></div><p>
</p></div></div>