<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec13"></a>The Animator</h2></div></div><hr /></div><p>In order to display an animation on a game object, you will be using both <code class="literal">Animator Components</code> and <code class="literal">Animator Controllers</code>. These two work hand in hand to control the animation of any animated object that you might have, and are described below:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">Animator Controller</code> uses a state-machine to manage the animation states and the transitions between one another, almost like a flow chart of animations.</p></li><li style="list-style-type: disc"><p>
<code class="literal">Animator Component</code> uses an <code class="literal">Animator Controller</code> to define which animation clips to use and applies them on the game object when needed. It also controls the blending and the transitions between them.</p></li></ul></div><p>Let's start modifying our controller to make it right for our character animations. Click on the <code class="literal">Player</code> and then open the Animator window from <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span>. We should see something like this:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_007.jpg" /></div><p>
</p><p>Although it is automatically generated, this is a state machine. To move around the grid, hold the middle mouse button and drag around.</p><p>First, let's understand how all the different kinds of nodes work:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Entry node</strong></span> (marked green): This is used when transitioning into a state machine, provided the required conditions were met.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Exit node</strong></span> (marked red): This is used to exit a state machine when the conditions have been changed or completed. By default it is not present, as there isn't one in the previous image.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Default node</strong></span> (marked orange): This is the default state of the <span class="strong"><strong>Animator</strong></span> and is automatically transitioned to from the entry node.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Sub-state nodes</strong></span> (marked grey): These are also called custom nodes. They are used typically to represent a state for an object where an event will occur (in our case, an animation will be played).</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Transitions</strong></span> (arrows): These allow state machines to switch between one another by setting the conditions that will be used by <code class="literal">Animator</code> to decide which state will be activated.</p></li></ul></div><p>To keep things organized, let's reorder the nodes in the grid. Drag the three sub-states right under the <span class="strong"><strong>Entry</strong></span> node. Order them from left to right <span class="strong"><strong>WalkAnim</strong></span>, <span class="strong"><strong>New Animation</strong></span>, and <span class="strong"><strong>JumpAnim</strong></span>. Then, right-click on <span class="strong"><strong>New Animation</strong></span> and choose <span class="strong"><strong>Set as Layer Default State</strong></span>. Now, our <span class="strong"><strong>Animator</strong></span> window should look like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_008.jpg" /></div><p>
</p><p>To edit a node, we need to select it and modify it as needed in the <span class="strong"><strong>Inspector</strong></span>. So, select <span class="strong"><strong>New Animation,</strong></span> and the <span class="strong"><strong>Inspector</strong></span> should look like the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_009.jpg" /></div><p>
</p><p>Here, we can have access to all the properties of the state or node <code class="literal">New Animation</code>. Let's change its name to <code class="literal">Idle</code>. Next, we need to change the speed of the state machine, which controls how fast the animation will be played. Next, we have <span class="strong"><strong>Motion,</strong></span> which refers to the animation that will be used for this state. After we have changed the name, save the scene, and this is what everything should look like now:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_010.jpg" /></div><p>
</p><p>We can test what we have done so far, by hitting play. As we can see in the <span class="strong"><strong>Game</strong></span> view, the character is not animated. This is because the character is always in the <code class="literal">Idle</code> state and there are no transitions to let him change state. While the game is in runtime, we can see in the Animator window that the <code class="literal">Idle</code> state is running. Stop the game, and right-click on the <code class="literal">WalkAnim</code> node in the <span class="strong"><strong>Animator</strong></span> window. Select from the menu <code class="literal">SetasLayerDefaultState</code>. As a result, the walking animation will be played automatically at the beginning of the game.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_011.jpg" /></div><p>
</p><p>If we press the play button again, we can see that the walk animation is played, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_012.jpg" /></div><p>
</p><p>You can experiment with the other states of the <code class="literal">Animator</code>. For example, you can try to set <code class="literal">JumpAnim</code> as the default animation, or even tweak the speed of each state to see how they will be affected.</p><p>Now that we know the basics of how the <code class="literal">Animator</code> works, let's stop the playback and revert the default state to the <code class="literal">Idle</code> state.</p><p>To be able to connect our states together, we need to create transitions. To achieve this, right-click on the <code class="literal">Idle</code> state and select <span class="strong"><strong>Make Transition,</strong></span> which turns the mouse cursor into an arrow. By clicking on other states, we can connect them with a transition. In our case, click on the <code class="literal">WalkAnim</code> state to make a transition from the <code class="literal">Idle</code> state to the <code class="literal">WalkAnim</code> state. The animator window should look like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_013.jpg" /></div><p>
</p><p>If we click on the arrow, we can have access to its properties in the <span class="strong"><strong>Inspector</strong></span>, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_014.jpg" /></div><p>
</p><p>The main properties that we might want to change are:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Name</strong></span> (optional): We can assign a name to the transition. This is useful to keep everything organized and easy to access. In this case, let's name this transition <code class="literal">StartWalking</code>.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Has Exit Time</strong></span>: Whether or not the animation should be played to the end before exiting its state when the conditions are not being met any more.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Conditions</strong></span>: The conditions that should be met so that the transition takes place.</p></li></ul></div><p>Let's try adding a condition and see what happens:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_015.jpg" /></div><p>
</p><p>When we try to create a condition for our transition, the following message appears next to <span class="strong"><strong>Parameter does not exist in Controller</strong></span> which means that we need to add parameters that will be used for our condition.</p><p>To create a parameter, switch to <code class="literal">Parameters</code> in the top left of the <span class="strong"><strong>Animator</strong></span> window and add a new float using the <span class="strong"><strong>+</strong></span> button and name it <code class="literal">PlayerSpeed</code>, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_016.jpg" /></div><p>
</p><p>Any parameters that are created in the <code class="literal">Animator</code> are usually changed from code and those changes affect the state of animation. In the following image, we can see the <code class="literal">PlayerSpeed</code> parameter on the left side:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_017.jpg" /></div><p>
</p><p>Now that we have created a parameter, let's head back to the transition.</p><p>Click the drop down button next to the condition we created earlier and choose the parameter <span class="strong"><strong>PlayerSpeed</strong></span>. After choosing the parameter, another option appears next to it. You can either choose <span class="strong"><strong>Greater</strong></span> or <span class="strong"><strong>Less</strong></span>, which means that the transition will happen when this parameter is respectively less than <span class="emphasis"><em>X</em></span> or greater than <span class="emphasis"><em>X</em></span>. Don't worry, as that <span class="emphasis"><em>X</em></span> will be changed by our code later on.</p><p>For now, choose <span class="strong"><strong>Greater</strong></span> and set the value to <code class="literal">1</code>, which means that when the player speed is more than one, the walk animation starts playing.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_02_018.jpg" /></div><p>
</p><p>You can test what we have done so far and change the <span class="strong"><strong>PlayerSpeed </strong></span>parameter in runtime.</p></div>