<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec58"></a>Upgrading towers</h2></div></div><hr /></div><p>If you have reached this point, it means that there is just one thing missing from your game. However, this is an optional section, and it is only for those who have done the optional section of the previous chapter, since we are going to finish what we started.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec49"></a>Finishing the TowerScript</h3></div></div></div><p>In the previous chapter, we created a <code class="literal">TowerMenuScript</code> that interacts with one instance of the <code class="literal">TowerScript</code> stored inside the <code class="literal">currentTower</code> variable. In particular, it has access to one variable of the tower called <code class="literal">upgradeLevel</code>; however, we have never created this variable. So, open the <code class="literal">TowerScript</code> and let's add this one line:</p><pre class="programlisting">public int upgradeLevel = 0; &#13;
</pre><p>It starts with the value 0, since now we have set the <code class="literal">TowerMenuScript</code>, the levels of our towers start from 0 up to 2.</p><p>Furthermore, <code class="literal">TowerMenuScript</code> calls the <code class="literal">Upgrade()</code> function of our tower, that we don't have. In this function, we need to increase the stats of the tower, including the level, and then we can also close the <code class="literal">TowerMenuScript</code>. To do this, we need to reference it, but for now, assume that it is stored inside the <code class="literal">towerMenu</code> variable. Of course, feel free to change how the stats are improved as you like. Therefore, we can write:</p><pre class="programlisting">    public void Upgrade() { &#13;
        rangeRadius += 1f; &#13;
        reloadTime -= 0.5f; &#13;
        upgradeLevel++; &#13;
        towerMenu.SetActive(false); &#13;
    } &#13;
</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip34"></a>Tip</h3><p>As we already have seen, having values inside the code is not a good practice. Replacing them with variables is left again, as an exercise.</p></div><p>Now we would like to open the <span class="strong"><strong>Tower Menu</strong></span> when a tower is selected. As we have seen for the allowed areas to place the tower, we can use the function <code class="literal">OnMouseDown()</code>. So let's write it down, keeping in mind that it is called when the mouse clicks on our tower. We need to disable the <code class="literal">TowerMenu</code>, update its <code class="literal">currentTower</code> variable, and then enable it again:</p><pre class="programlisting">    void OnMouseDown() { &#13;
        towerMenu.SetActive(false); &#13;
        towerMenu.GetComponent&lt;TowerMenuScript&gt;().currentTower = this; &#13;
        towerMenu.SetActive(true); &#13;
    } &#13;
</pre><p>As we already know, this function works only with a collider attached. But every time a tower is placed by the <code class="literal">PlacingTowerScript</code>, a collider is added. Therefore, we don't need to worry about it.</p><p>Now, everything seems to work, but we haven't yet defined the variable <code class="literal">towerMenu</code>! Since the <code class="literal">TowerMenu</code> is only one, we can share this variable among all the <code class="literal">TowerScript</code> instances by making it static. So, let's write:</p><pre class="programlisting">public static GameObject towerMenu; &#13;
</pre><p>We have now declared it, but it is not set yet. This is because we will set this from the <code class="literal">TowerMenuScript</code>, and thus it has to be public.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec50"></a>Final adjustments to the TowerMenuScript</h3></div></div></div><p>We need to open our <code class="literal">TowerMenuScript </code>again, because when the game starts it has to set the <code class="literal">towerMenu</code> variable to all the <code class="literal">TowerScript</code> instances. We can achieve this by adding the following line to the <code class="literal">Awake()</code> function:</p><pre class="programlisting">  void Awake () { &#13;
        moneyCounter = GameObject.Find("MoneyCounter").GetComponent&lt;MoneyCounterScript&gt;(); &#13;
        uiImage = GetComponent&lt;Image&gt;(); &#13;
     TowerScript.towerMenu = this.gameObject; &#13;
  } &#13;
</pre><p>As a result, we will have the <code class="literal">towerMenu</code> variable set, ready to use in the function written in the previous section.</p><p>Furthermore, we also need to disable the game object related to the <code class="literal">TowerMenuScript</code> from the beginning, because we don't want to show it from the beginning:</p><pre class="programlisting">  void Awake () { &#13;
        moneyCounter = GameObject.Find("MoneyCounter").GetComponent&lt;MoneyCounterScript&gt;(); &#13;
        uiImage = GetComponent&lt;Image&gt;(); &#13;
        TowerScript.towerMenu = this.gameObject; &#13;
      gameObject.SetActive(false); &#13;
  } &#13;
</pre><p>By doing this, we have finished implementing our upgrade and selling tower system. Even if this was harder than the rest of the game elements, it was definitely worth it.</p></div></div>