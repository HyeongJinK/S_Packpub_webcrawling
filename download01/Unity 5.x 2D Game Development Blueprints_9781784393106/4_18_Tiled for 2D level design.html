<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec20"></a>Tiled for 2D level design</h2></div></div><hr /></div><p>In this chapter, we are going to finish the game that we started in the previous chapters. To begin, let's start by designing an even cooler level!</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip13"></a>Tip</h3><p>Before we start creating our level, it's good practice to design our level on paper, even if it's some sketches of different ideas.</p></div><p>We will be using a third-party tool named <span class="strong"><strong>Tiled</strong></span> for this purpose. Tiled is a free 2D map editor that will save you a lot of time working on your levels. It is a tool that makes it much easier to create a 2D level, instead of doing it within Unity by duplicating game objects. Here is the download link for it: <a class="ulink" href="http://www.mapeditor.org/download.html" target="_blank">http://www.mapeditor.org/download.html</a>.</p><p>Lastly, in order to use what you will create in Tiled, you also need to download another program called <span class="strong"><strong>Tiled2Unity</strong></span>. It is a utility that allows us to import levels that have been created in Tiled, as prefabs into Unity. Here is the link to download Tiled2Unity: <a class="ulink" href="http://www.seanba.com/tiled2unity" target="_blank">http://www.seanba.com/tiled2unity</a>.</p><p>After installing both programs, we can start by opening Tiled. This is what it looks like when it is opened:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_001.jpg" /></div><p>
</p><p>Click on the <span class="strong"><strong>New</strong></span> button in the top-left corner. A box will appear on screen, where we can set the new map properties, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_002.jpg" /></div><p>
</p><p>From the <span class="strong"><strong>Tilesets</strong></span> panel in the bottom-right corner, click on <span class="strong"><strong>New Tileset</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_003.jpg" /></div><p>
</p><p>Link the source to the Tiles sprite sheet we have in our project <code class="literal">PlatformerPack</code> | <code class="literal">tiles_spritesheet.png</code> and configure the rest, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_004.jpg" /></div><p>
</p><p>A new map will be created with our tiles being available for selection in the <span class="strong"><strong>Tilesets</strong></span> panel:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_005.jpg" /></div><p>
</p><p>Before we start drawing, a good rule of thumb is to select <span class="strong"><strong>Snap to Grid</strong></span> and <span class="strong"><strong>Snap to Fine Grid</strong></span> in the <span class="strong"><strong>View</strong></span> menu:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_006.jpg" /></div><p>
</p><p>Click on any of the tiles and left-click and drag your mouse inside the map. Here, you will see that the tile is being placed in each grid you pass over:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_007.jpg" /></div><p>
</p><p>Now, let's try to make something a little more pleasing to the eye than the preceding image. An example can be using a mixture of the tiles that we've got:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_008.jpg" /></div><p>
</p><p>While painting your way through the level, you may have noticed the <span class="strong"><strong>Layers</strong></span> panel and that the current layer we have been working on is called <code class="literal">TileLayer1</code>. Let's call it <code class="literal">Ground</code> and then add another layer called <code class="literal">Water</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_009.jpg" /></div><p>
</p><p>
<span class="strong"><strong>Layers</strong></span> allow you to improve the organization of your level. All the work we've done so far has been put on the <code class="literal">Ground</code> layer, which is good. But now we need to add some water. Therefore, select the <code class="literal">Water</code> layer and add some water tiles. Make sure to leave the top three tiles empty; we will use them next. Now, to finish the water area of our map off, add the wave tiles to the top in the empty space above the original water area, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_010.jpg" /></div><p>
</p><p>Each layer has its own properties, and the cool thing is that when we import the map using Tiled2Unity, it will apply each layer's properties to the soon to be in-game objects. This can save a lot of time later on.</p><p>Select the <code class="literal">Ground</code> layer and navigate to the <span class="strong"><strong>Properties</strong></span> panel on the left-hand side of the screen and add the following <span class="strong"><strong>Custom Properties</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_011.jpg" /></div><p>
</p><p>Now, let's repeat these steps again for the the <code class="literal">Water</code> layer, but change the <span class="strong"><strong>unity:isTrigger</strong></span> property to <code class="literal">true</code> instead of <code class="literal">false</code>. In fact, we will use this trigger later in the game to check if the player falls into the water gap.</p><p>The next step is to add some colliders to our tiles in the map. To add a collider to a tile, you need to select that tile from the <span class="strong"><strong>Tilesets</strong></span> panel and navigate to <span class="strong"><strong>View</strong></span> | <span class="strong"><strong>Tile Collision Editor</strong></span>.</p><p>After opening the <span class="strong"><strong>Tile Collision Editor</strong></span>, use the rectangle tool to fully enclose our tile, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_012.jpg" /></div><p>
</p><p>Repeat the previous steps for all of the tiles we have added into the map, except for any decorative tiles such as grass or rocks. When you are done, make sure to save the file. In our case, we will name it <code class="literal">Platformer</code>. Before going any further, make sure that our Unity project is opened!</p><p>In order to import what we have done so far in Tiled to Unity, we will need to use the <code class="literal">Tiled2Unity</code> tool that we installed earlier. After you have opened the program, you will see a window like the one in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_013.jpg" /></div><p>
</p><p>As you can see, this tool is pretty straight-forward. Click on <span class="strong"><strong>Help</strong></span> | <span class="strong"><strong>Import Unity Package To Project</strong></span> and inside Unity, click on <span class="strong"><strong>Import</strong></span>.</p><p>What this will do isÂ  import the plugin into Unity so that we will be able to use the files that come next in our scene. Next, go to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open Tiled File</strong></span> and select the saved file <code class="literal">Platformer.tmx</code>.</p><p>Next, click on the <span class="strong"><strong>ExportTo</strong></span> button and make sure it is set to the <code class="literal">Tiled2Unity.export</code> file inside the folder <code class="literal">Assets/Tiled2Unity</code>. Finally, set the <span class="strong"><strong>Vertex Scale</strong></span> to <code class="literal">0.018</code> and then click on <span class="strong"><strong>Export</strong></span>.</p><p>The files will be imported to Unity and the program will display the stats for the conversion, as seen in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_014.jpg" /></div><p>
</p><p>You can close <span class="strong"><strong>Tiled</strong></span> and <span class="strong"><strong>Tiled2Unity,</strong></span> as we do not need them, and head back to Unity.</p><p>A new folder has been created inside our project called <code class="literal">Tiled2Unity</code>. Inside it, our map is set as a ready-to-use prefab in the <code class="literal">Prefabs</code> folder under the same name we saved it as. In this case, <code class="literal">Platformer</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_015.jpg" /></div><p>
</p><p>Disable the <code class="literal">Floor</code> object then drag and drop the <code class="literal">Platformer</code> prefab into the scene. Modify its transform position, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_016.jpg" /></div><p>
</p><p>Next, modify the scale of the <code class="literal">Background</code> object to <code class="literal">(5,3,1)</code> and then parent it to the <code class="literal">Camera</code> object, so that the background will follow our character as well. Now the scene should look as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_017.jpg" /></div><p>
</p><p>Here, we can have an idea of how to organize everything in the <span class="strong"><strong>Project</strong></span> panel:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_018.jpg" /></div><p>
</p><p>Press the play button to see what we have accomplished so far!</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_019.jpg" /></div><p>
</p><p>Our scene looks much better, but we can still improve it.</p><p>Let's start by adding some clouds to the <span class="strong"><strong>Background</strong></span> object under <span class="strong"><strong>Main Camera</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_020.jpg" /></div><p>
</p><p>This is how the scene should look afterwards:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_021.jpg" /></div><p>
</p><p>Remove the old <code class="literal">Floor_#</code> objects and add some new floor tiles. Then, assign colliders to them and platform effectors. Finally, parent them to the <code class="literal">Floors</code> game object, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_022.jpg" /></div><p>
</p><p>You will notice that we assigned the collider and the effector to each group of floor tiles instead of the tiles directly. This is something that I recommend, as it will be easier to organize and edit along the way, especially when your scene starts getting bigger. Also, make sure that the <span class="strong"><strong>One Way Boolean</strong></span> inside the <span class="strong"><strong>Platform Effectors</strong></span> is <code class="literal">true</code>, as it will be better for our intended gameplay.</p><p>Let's add some coins to the scene just above the top floor so that the player can increase his score by collecting each one. We will configure their behavior later, but for now, don't forget to add a collider to each coin and set the <span class="strong"><strong>IsTrigger</strong></span> property to <code class="literal">true</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/image_04_023.jpg" /></div><p>
</p><p>Now, let's add an exit area in our scene so that the player can finish the level and end the game. Grab a ladder sprite and add it at the end of the scene and then attach a collider to it with the <span class="strong"><strong>IsTrigger</strong></span> option turned on:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781784393106/graphics/3647_04_26.jpg" /></div><p>
</p><p>We should group our scene items now so that everything will be kept neat and clean for future changes. Create a new game object named <code class="literal">SceneObjects</code>. We have finally finished designing our scene! The next step is to implement the User Interface.</p></div>