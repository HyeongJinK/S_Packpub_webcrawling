<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec57"></a>Finishing the gameplay</h2></div></div><hr /></div><p>We are almost there!</p><p>There are a few things to take into account in order to finally complete this project. If we press play, the game works, but there are no game over conditions. In particular, our game can have two outcomes: the player wins, by destroying all the enemies, or he fails in defending his fortress.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec47"></a>Winning conditions</h3></div></div></div><p>Sometimes games go in our favor and the player rises victorious! In this case, he has managed to destroy all the enemies, taken away resources from his opponents, and left them with the bitterness of defeat.</p><p>A very easy way to see whether the player has destroyed all the enemies is to perform this check inside the coroutine of the previous section. At the end of the <code class="literal">for</code> loop, we can have a <code class="literal">while</code> loop where every second it checks whether there are no more enemies. In this case, we just run our game over screen (win). So, after we have opened the <code class="literal">GameManager</code>, let's add this to the end of our coroutine:</p><pre class="programlisting">    IEnumerator SpawnEnemies(int number) { &#13;
        for (int i = 0; i &lt; number; i++) { &#13;
            //... &#13;
        } &#13;
     //GameOverConditions &#13;
     bool isGameOver = false; &#13;
     while (!isGameOver) { &#13;
         if (GameObject.FindGameObjectsWithTag("Enemy").Length == 0) { &#13;
             isGameOver = true; &#13;
             //GameOver Screen (win) &#13;
         } &#13;
         else { &#13;
             yield return new WaitForSeconds(1); &#13;
         } &#13;
     } &#13;
    } &#13;
</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip33"></a>Tip</h3><p>This is not the best way to implement such a coroutine, since we are using a very expensive function, <code class="literal">Find()</code>. However, it is called only every second and not every frame. In any case, a better implementation would be to have a counter which, once the spawning process has finished, keeps track of how many enemies are left. Every time that an enemy dies, it decreases. The implementation of this other method is left as an exercise.</p></div><p>By doing this, we have finally given the player the possibility to win the game.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec48"></a>Losing conditions</h3></div></div></div><p>Nevertheless, the life for our player is not always be good, especially with a horde of slimes at the door of his fortress. When too many enemies cross the end of the path and the number of lives of the player goes to zero, there is nothing he can do, this is game over and the player has lost.</p><p>In order to implement this sad scenario, we need to check whether the number of lives of the player has reached zero. This can be done every time that an enemy reaches the end of the path. For this reason, we passed this through the <code class="literal">GameManagerScript</code> to decrease the number of lives in the <span class="emphasis"><em>Integrating the UI in the game</em></span> section. Therefore, let's open the <code class="literal">GameMangerScript</code>, and modify the <code class="literal">enemyHasReachedTheFortress()</code> function to check whether the number of lives goes to or below zero. If so, we need to stop the coroutine that spawns enemies and check the winning conditions and display the game over screen:</p><pre class="programlisting">    public void enemyHasReachedTheFortress() { &#13;
        livesCounter.loseLife(10); &#13;
 &#13;
     //GAMEOVER CONDITIONS &#13;
     if (livesCounter.getLives() &lt;= 0) { &#13;
         StopCoroutine("SpawnEnemies"); &#13;
         //GameOver Screen (loose) &#13;
     } &#13;
    } &#13;
</pre><p>By doing this, we have just allowed the terrible slimes to overcome the player.</p></div></div>