<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec29"></a>Making sprinkles</h2></div></div><hr /></div><p>In the <span class="emphasis"><em>Prefabs</em></span> section, we created the Prefab for our sprinkle projectile. In this section, we will see how to make sprinkles move into the 2D space. In particular, we will learn how to create and use scripts in Unity for 2D game elements.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec15"></a>The projectile class</h3></div></div></div><p>Since there might be different projectiles in our game that can be thrown against the sweet-tooth pandas, and not only sprinkles, we need to define a general class. All the different kinds of projectile will follow some general rules:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>They move in a straight line</p></li><li style="list-style-type: disc"><p>They carry information about how much damage they will inflict on the enemies</p></li></ul></div><p>Whereas the first is identical for all the projectiles, the second depends on the specific kind of projectile that will be fired. So, we need to create a template. Once we attach this script to a game object, we can set some of its variables and tweak its behavior. In this specific case, we want to tweak how much damage is given and how fast.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec7"></a>Scripting the projectile mother class</h4></div></div></div><p>So, to begin, let's create a new script and name it <code class="literal">ProjectileScript</code>. Next, we need to define four variables. The first is for the amount of damage, the second for its speed, and the third one, for its direction, since we need to know where the projectile is heading. The last variable stores its life duration expressed in seconds. As a consequence, it also sets, together with the speed variable, how far the projectile can reach. In fact, if the projectile misses the target, we don't want it going straight on forever, because this would consume computational resources and slow down our game. So after this duration, we need to destroy it. To do this, we can add the following four variables:</p><pre class="programlisting">public float damage;    <span class="emphasis"><em> //How much damage will the enemy receive</em></span> &#13;
public float speed = 1f;       <span class="emphasis"><em>//How fast the projectile moves</em></span> &#13;
public Vector3 direction; <span class="emphasis"><em>//What direction the projectile is heading</em></span> &#13;
public float lifeDuration = 10f; <span class="emphasis"><em>//How long the projectile lives before</em></span>
<span class="emphasis"><em>  self-destructing</em></span>
</pre><p>The next thing to do is to set some of these parameters in the <code class="literal">Start()</code> function. Since the direction will be given by the entity that will throw the projectile, we don't have a guarantee that it has a unit norm. As consequence, we need to normalize the direction. Then, we need to rotate the graphic of our projectile, which in this case is the sprinkle, towards the right direction. In order to achieve this, we need to compute the angle using the <code class="literal">Atan2()</code> function. After we have transformed this in degrees, we use the <code class="literal">AngleAxis()</code> function in the <code class="literal">Quaternion</code> class to rotate our game object. Finally, we need to set a timer before the game object is destroyed. As a result, this will be our <code class="literal">Start()</code> function:</p><pre class="programlisting">void Start() { &#13;
<span class="emphasis"><em>  //Normalize the direction</em></span> &#13;
  direction = direction.normalized; &#13;
 &#13;
<span class="emphasis"><em>  //Fix the rotation</em></span> &#13;
  float angle = Mathf.Atan2(-direction.y, direction.x) * Mathf.Rad2Deg; &#13;
  transform.rotation = Quaternion.AngleAxis(angle, Vector3.forward); &#13;
 &#13;
<span class="emphasis"><em>  //Set the timer for self-destruction</em></span> &#13;
  Destroy(gameObject, lifeDuration); &#13;
} &#13;
</pre><p>In the <code class="literal">Update()</code> function, we just need to move the sprinkle in that direction. If the sprinkle collides with something, such as a Panda, it's a case that we will discuss in <a class="link" href="#" linkend="ch04">Chapter 5</a>, <span class="emphasis"><em>No Longer Alone - Sweet-Toothed Pandas Strike</em></span>. So, we need to update its position according to its direction and speed, keeping it dependent on the time. So, we can write the following:</p><pre class="programlisting">
<span class="emphasis"><em>// Update the position of the projectile according to time and speed</em></span> &#13;
void Update() { &#13;
  transform.position += direction * Time.deltaTime * speed; &#13;
} &#13;
</pre><p>At the end, save the script. There is still a lot of work to do on this script. For instance, the direction should be only on the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span>, and not on the <span class="emphasis"><em>z</em></span>, since it is used in the Z-Buffering method. However, for now it is fine, and we will look at all these issues later on in the book.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec16"></a>Tons of sprinkles through Prefabs</h3></div></div></div><p>Now that we have a general script that achieves the behavior of a projectile, we need to actually make the Prefab of our sprinkles with such behavior.</p><p>We have already created a Prefab for our sprinkle projectile, but we need to change it. So, go into the <code class="literal">Prefabs</code> folder in the <span class="strong"><strong>Project</strong></span> panel, and select our <code class="literal">Pink_Sprinkle_Projectile_Prefab</code>. In the <span class="strong"><strong>Inspector</strong></span>, we need to add the script that we have just created. So, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Script</strong></span> | <span class="strong"><strong>ProjectileScript</strong></span>. As a result, you should see the following:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_025.jpg" /></div><p>We need to tweak the values, at least for testing purposes, so that we can see our sprinkle moving. We can assign a direction such as (1, 1, 0) and any value to the <span class="strong"><strong>Damage</strong></span> variable. At the end, we should have something like the following:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_026.jpg" /></div><p>If we press the play button, we can see our sprinkle leading in the direction we specified, and be destroyed after <code class="literal">10</code> seconds.</p><p>Then, we need to assign the <span class="strong"><strong>Z</strong></span> value on the Prefab. Since it is a projectile, we can look at the table with all the <span class="strong"><strong>Z </strong></span>values for our objects we made earlier. Therefore, we need to assign <code class="literal">-2</code> as the value. We also need to assign the tag to our projectile. We will use this tag later on, but it's better to assign it now to the Prefab.</p><p>To assign a tag, on top of the <span class="strong"><strong>Inspector</strong></span>, just below the game object name, there is the <span class="strong"><strong>Tag</strong></span> field, as highlighted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_027.jpg" /></div><p>Once clicked, a drop-down menu appears, where it is possible to choose from the different tags, including the two we defined previously:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_028.jpg" /></div><p>We can assign the <span class="strong"><strong>Projectile</strong></span> tag to our Prefab, and in the end, it should look like this:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_029.jpg" /></div><p>And this is all we need to do to fabricate our projectiles. In fact, we can now use this Prefab to spawn the sprinkles when we need to.</p></div></div>