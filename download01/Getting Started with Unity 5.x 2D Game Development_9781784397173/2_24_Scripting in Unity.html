<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec28"></a>Scripting in Unity</h2></div></div><hr /></div><p>In this section, we will learn one of the toughest topics in game development! However, I strongly encourage you not to be scared, but try to practice a lot. As a result, you will be able to master every single detail of your game. And that is awesome!</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec11"></a>Creating new scripts</h3></div></div></div><p>First of all, we need to understand how to create new scripts in Unity. The easiest way is to select a game object and in the <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>. In this way, you still have the possibility to rename it, but the script will be located in the <code class="literal">Asset</code> folder. Furthermore, it's not possible to create a class that cannot be attached to a game object.</p><p>A much better way is to create a folder called <code class="literal">Scripts</code> in the <span class="strong"><strong>Project</strong></span> panel, if you haven't done so yet. Then, right-click and navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>C# Script</strong></span>. As a result, it will be in the right folder, and we don't have problems if we create a script that cannot be attached to game objects.</p><p>For the rest of this book, it will be assumed that every new script will be created in this way, and always in the <code class="literal">Scripts</code> folder.</p><p>Keeping the name of the script in mind is important, because the file should have the same name as the main class in the script. This means that if we change the name of the class later on, we need to rename the file accordingly as well. However, this may break some references in other scripts that will require correcting. So, be careful when changing names.</p><p>To open a script, you need to double-click on it. Unity will open a script editor. By default, it will be Monodevelop. However, it is possible to change this setting by navigating through <span class="strong"><strong>Edit | Preferences...</strong></span>. In the <span class="strong"><strong>External Tool</strong></span> tab, you can change the <span class="strong"><strong>External Script Editor</strong></span>. Another commonly used script editor is Visual Studio, it can can be downloaded from <a class="ulink" href="https://www.visualstudio.com/" target="_blank">https://www.visualstudio.com/</a>.</p><p>However, if this is your first experience with Unity, I suggest that you stick with Monodevelop. In any case, for this book, we don't have any requirements (as far as you are able to edit the scripts), so feel free to choose the one you like best.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec12"></a>Basics about scripts</h3></div></div></div><p>If this is your first time scripting in Unity, there is some information to know before we begin.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>Unity mainly supports two languages: C# and JavaScript. Since we created a C# script in the previous section, we are going to use this language for the rest of this book.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec4"></a>Variables</h4></div></div></div><p>Variables can be public, private, or protected. We will not cover the last one, since we don't have enough time for that, and it's not really important when getting started with Unity development. Private variables can be used only within the script itself. Usually they are used to store internal data of the script that doesn't need to be shared among other components.</p><p>Public variables, instead, can be accessed from any script, so we need to pay attention where to use them. It's good practice to implement the <code class="literal">get</code> and <code class="literal">set</code> functions, when applicable. Even if we will not use them much in this book, it's worth learning what they are, which you can do at <a class="ulink" href="https://msdn.microsoft.com/en-us/library/w86s7x04.aspx" target="_blank">https://msdn.microsoft.com/en-us/library/w86s7x04.aspx</a>.</p><p>Furthermore, public variables are visible in the <span class="strong"><strong>Inspector</strong></span>. In fact, just for testing purposes, you can create a new script and add the following integer variable:</p><pre class="programlisting">public int testVariable; &#13;
</pre><p>As a result, after you have saved the script, you are able to set its value in the <span class="strong"><strong>Inspector</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_019.jpg" /></div><p>As a consequence, public variables don't need to be set within the script in order to be able to use them. Often, we would like to have a public variable, since it will be set from another script, but not visible on the <span class="strong"><strong>Inspector</strong></span>. You can achieve that in Unity by using an attribute.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec5"></a>Attributes</h4></div></div></div><p>Before variables and functions, Unity allows us to insert an attribute. An attribute is enclosed between <code class="literal">[</code> and <code class="literal">]</code>, and can contain different parameters. Around 30 attributes exist and they really differ in functionality and usage. Since we don't have the time to go through them all, we will just cover the most commonly used ones:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">Header</code> attribute is formatted as <code class="literal">[Header("string")]</code>. It creates a header before the variables that follow it. Here is an example of adding the attribute to the variable of the test script we used earlier:</p><pre class="programlisting">        [Header("This is a heading")] &#13;
        public int testVariable; &#13;
</pre><p>The result is the following:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_020.jpg" /></div></li><li style="list-style-type: disc"><p>The <code class="literal">HideInInspector</code> attribute is formatted as <code class="literal">[HideInInspector]</code>. It hides the variable that follows it from the <span class="strong"><strong>Inspector</strong></span>. Here it is in use, in the previous example:</p><pre class="programlisting">        [HideInInspector]&#13;
        public int testVariable;</pre><p>And this is the result:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_021.jpg" /></div></li><li style="list-style-type: disc"><p>The <code class="literal">Range</code> attribute is formatted as <code class="literal">[Range(minValue, maxValue)]</code>. It captures the possible values of the variable in the range of numbers from <code class="literal">minValue</code> to <code class="literal">maxValue</code>. Again, we use the previous example:</p><pre class="programlisting">        [Range(-10, 10)] &#13;
        public int testVariable; &#13;
</pre><p>This is the result we obtain:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_022.jpg" /></div></li><li style="list-style-type: disc"><p>Finally, The <code class="literal">Tooltip</code> attribute is formatted as <code class="literal">[Tooltip("string")]</code>. It creates a tooltip in the <span class="strong"><strong>Inspector</strong></span> when the cursor is hovering over that variable:</p><pre class="programlisting">        [Tooltip("This is a tooltip")] &#13;
        public int testVariable; &#13;
</pre><p>Here is the result (when the cursor hovers):</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_023.jpg" /></div></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec6"></a>Functions</h4></div></div></div><p>Any script that derives from the <code class="literal">MonoBehaviour</code> class has two main functions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">Start()</code>: This function is called only once, when the game starts. It's useful to set all the variables and get the references we need within this function.</p></li><li style="list-style-type: disc"><p><code class="literal">Update()</code>: This function is called every frame, and needs to compute things in real time, such as velocity or behaviors. However, since this is called so often, we need to pay attention to what we code inside, to avoid slowing down our game too often.</p></li></ul></div><p>There are other functions that can be implemented and that will be automatically called. In actual fact, there are more than 60!</p><p>We will use some of them later on, so we will introduce them here and see them in detail in later chapters:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">OnTriggerEnter2D()</code>: This is called when another object with a collider enters the trigger collider attached to the game object. We will see this better later on, when we deal with physics.</p></li><li style="list-style-type: disc"><p><code class="literal">OnMouseDown()</code>: This is called when the player has pressed the mouse button while over the game object if it has a collider attached. Furthermore, it can be a <code class="literal">Coroutine</code> and works with <code class="literal">GUIElements</code> too.</p></li><li style="list-style-type: disc"><p><code class="literal">OnEnable()</code>: This is called when the object becomes enabled and active.</p></li></ul></div><p>You can find out more about them at <a class="ulink" href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" target="_blank">https://docs.unity3d.com/ScriptReference/MonoBehaviour.html</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec13"></a>Comments</h3></div></div></div><p>As we mentioned in the previous chapter, game development is not an easy process, since it involves many stages. For this reason, it's really important to document everything that we do. This doesn't mean writing something that will be published, but just a couple of lines to remind yourself and your team what you have accomplished. In fact, human memory is great at remembering concepts, but not good for details! This is essential during the scripting stage. It is important to be able to read what the rest of your team or yourself have written a few days ago. When coding, it's easy to get lost among the many lines of code when you don't use comments!</p><p>Since Unity uses a C# compiler, it is possible to insert comments inside the code. Comments are lines that will be ignored (not compiled), and as the name suggests, they help to leave messages to those who will read the code.</p><p>There are two main ways to comment in C#. The first is to insert <code class="literal">//</code> at the beginning of a line. As a result, everything that comes after until the next line will be ignored. The second one is used when we have more than one line. It consists to surround the comment with an opening tag <code class="literal">/*</code> and the closing tag <code class="literal">*/</code>. As a result, everything within these two tags will be ignored. Here is an example:</p><pre class="programlisting">
<span class="emphasis"><em>//This line is commented</em></span> &#13;
This other one is not. &#13;
<span class="emphasis"><em>/*Here it is &#13;
again &#13;
commented*/</em></span>
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>Comments are also used to build automatic documentations and as markups for other things. However, this is out the scope of this book.</p></div><p>I strongly suggest that you always try to insert comments in your code, so it is easier to read later on. For your convenience, all the code that comes with this book is provided with comments, helping you to understand what is happening and where.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec14"></a>Execution order</h3></div></div></div><p>Another important concept about scripting in Unity is the <span class="strong"><strong>Execution Order</strong></span>. It may be fundamental that some scripts or parts of code are executed before others. As a result, this will affect how the shared resources are modified and the efficiency as well.</p><p>The standard ordering is as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p><span class="strong"><strong>Editor</strong></span>: In particular, the <code class="literal">Reset()</code> function.</p></li><li><p><span class="strong"><strong>Scene Load</strong></span>: Functions such as <code class="literal">Awake()</code>, <code class="literal">OnEnable()</code>, and <code class="literal">OnLevelWasLoaded()</code> are called.</p></li><li><p><span class="strong"><strong>Before the first frame update</strong></span>: All the <code class="literal">Start()</code> functions in the scripts are called (if the object is active!).</p></li><li><p><span class="strong"><strong>In between frames</strong></span>: the <code class="literal">OnApplicationPause()</code> function is performed.</p></li><li><p><span class="strong"><strong>Update</strong></span>: All the different <code class="literal">Update()</code> functions are called.</p></li><li><p><span class="strong"><strong>Rendering</strong></span>: Specific rendering functions are performed.</p></li><li><p><span class="strong"><strong>Coroutines</strong></span>: They are executed until a yield statement is found</p></li><li><p><span class="strong"><strong>When the object is destroyed</strong></span>: The <code class="literal">Destroy()</code> function is called.</p></li><li><p><span class="strong"><strong>When quitting</strong></span>: Functions to be executed when disabling game objects or when quitting the game are called.</p></li></ol></div><p>Of course, this is just scratching the surface to give you an idea about the execution order. If you are interested in finding out more on this topic, you can find a detailed explanation of the execution order in the official documentation, at <a class="ulink" href="https://docs.unity3d.com/Manual/ExecutionOrder.html" target="_blank">https://docs.unity3d.com/Manual/ExecutionOrder.html</a>.</p><p>Unity offers also the possibility to change the execution order within your scripts when you have specific needs. This can be done by navigating on the toolbar to, <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Script Execution Order</strong></span>. As a result, this window will appear on the <span class="strong"><strong>Inspector</strong></span>, where it is possible to change the order:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_02_024.jpg" /></div><p>For more information about this, you can visit the following link: <a class="ulink" href="https://docs.unity3d.com/Manual/class-ScriptExecution.html" target="_blank">https://docs.unity3d.com/Manual/class-ScriptExecution.html</a>. However, the execution order for scripts is for specific needs that we don't have, so we won't touch any of these settings. However, I hope that this section helped you to get a better understanding of the logic behind Unity. Saying that, I encourage you to re-read this section when you gain a better understanding of scripting in Unity.</p></div></div>