<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec65"></a>Physics for our game</h2></div></div><hr /></div><p>In this section we will apply some concepts of this chapter into our game. In particular, we will see how to detect when a sprinkle hits a panda and applies damage to it using the Physics engine.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec75"></a>Set up Pandas as a rigidbodies</h3></div></div></div><p>Since we will take advantage of the Physics engine, we need to proper set up the Panda as that to be a physical object in the scene. This means giving it a rigidbody component.</p><p>Therefore, we can start by adding a 
<span class="strong"><strong>Rigidbody2D</strong></span> component to the Panda prefab, and set its 
<span class="strong"><strong>Body Type</strong></span> as 
<span class="strong"><strong>Kinematic</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/B03794_05_60.jpg" /></div><p>In theory, we should have done, since the Panda is considered a physical object now. However, in the previous chapter, we have written a function that allows the Panda to move by assigning its new position directly on its Transform. Since now the Panda has a <span class="strong"><strong>Rigidbody2D</strong></span> component, we cannot do in this way anymore (as we already explained previously in the <span class="emphasis"><em>Rigidbodies</em></span> section). Therefore, we need to slightly modify the <code class="literal">PandaScript</code>. In particular, we need to get a reference to the rigidbody of the Panda, then use the <code class="literal">MovePosition()</code> function for Kinematic rigidbodies. Basically, we are applying what we have learnt in the <span class="emphasis"><em>Dealing with rigidbodies</em></span> section.</p><p>Hence, open the script, and add the following private variable:</p><pre class="programlisting">
<span class="emphasis"><em>//Private variable to store the rigidbody2D</em></span>&#13;
private Rigidbody2D rb2D;</pre><p>Then, in the <code class="literal">Start()</code> function add this line at the end of the function:</p><pre class="programlisting">
<span class="emphasis"><em>//Get the reference to the Rigidbody2d</em></span>&#13;
rb2D = GetComponent&lt;Rigidbody2D&gt;();</pre><p>In the <code class="literal">MoveTowards()</code> function, we need to use the <code class="literal">MovePosition()</code> function on the Panda's rigidbody to change its position. In addition, we shouldn't use <code class="literal">deltaTime</code> anymore, and substitute it with <code class="literal">fixedDeltaTime</code>. As such, here is highlighted what is changed from the previous chapter:</p><pre class="programlisting">
<span class="emphasis"><em>//Function that based on the speed of the Panda makes it moving towards the destination point, specified as Vector3</em></span>&#13;
private void MoveTowards(Vector3 destination) {&#13;
<span class="emphasis"><em>  //Create a step and then move in towards destination of one step</em></span>&#13;
  float step = speed * <span class="strong"><strong>Time.fixedDeltaTime</strong></span>;&#13;
<span class="strong"><strong>  rb2D.MovePosition(</strong></span>Vector3.MoveTowards(transform.position,&#13;
    destination, step)<span class="strong"><strong>);&#13;
</strong></span>}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note88"></a>Note</h3><p>We need to remember that the <code class="literal">MoveTowards()</code> function, now, should be called within a <code class="literal">FixedUpdate()</code> and not in the <code class="literal">Update()</code>. We will see this in <a class="ulink" href="https://cdp.packtpub.com/b03794gettingstartedwithunity2dgamedevelopmentsecondedition/wp-admin/post.php?post=220&amp;action=edit#post_247" target="_blank">Chapter 7</a>, <span class="emphasis"><em>Trading Cupcakes and the Ultimate Battle for the Cake – Gameplay Programming</em></span>. But you can have an example in the next section.</p></div><p>Finally, we can save the script, and we have done with the Panda.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec76"></a>Set up projectiles as rigidbodies</h3></div></div></div><p>Similar to what we did for the Pandas, we need to add a <span class="strong"><strong>Rigidbody2D</strong></span> component to all the projectiles, and again set the <span class="strong"><strong>Body Type</strong></span> to <span class="strong"><strong>Kinematic</strong></span>.</p><p>If you remember, also projectiles used to move by changing directly their Transforms, and we need to fix this, since they have a <span class="strong"><strong>Rigidbody2D</strong></span> component as well.</p><p>Open the script, and as we did for the Pandas, add the following private variable:</p><pre class="programlisting">
<span class="emphasis"><em>//Private variable to store the rigidbody2D</em></span>&#13;
private Rigidbody2D rb2D;</pre><p>Then, in the <code class="literal">Start()</code> function, let’s get the reference to it:</p><pre class="programlisting">
<span class="emphasis"><em>//Get the reference to the Rigidbody2d</em></span>&#13;
rb2D = GetComponent&lt;Rigidbody2D&gt;();</pre><p>Now, we need to replace the <code class="literal">Update()</code> function with the <code class="literal">FixedUpdate()</code> one, since we are dealing with the Physics engine. Moreover, we need to slightly change the code (note also the use of the <code class="literal">fixedDeltaTime</code>):</p><pre class="programlisting">
<span class="emphasis"><em>// Update the position of the projectile according to time and speed</em></span>&#13;
void FixedUpdate() {&#13;
  rb2D.MovePosition(transform.position + direction *&#13;
    Time.fixedDeltaTime * speed);&#13;
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note89"></a>Note</h3><p>A careful reader would notice that we are applying the equation of motion explained in the information box within the <span class="emphasis"><em>Dealing with rigidbodies</em></span> section. In particular, here we have split the velocity into a direction and a speed (which multiplied them together give back the velocity).</p></div><p>Save the script, and let’s see how we can detect when a sprinkle hits a panda in the next section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec77"></a>Detect sprinkles</h3></div></div></div><p>In order to detect a collision between a sprinkle and a Panda, we need to add them both a <span class="strong"><strong>Collider2D</strong></span>. You can choose the one that better suits your needs, I'll go for the <span class="strong"><strong>Box2D</strong></span> collider. Then, you need to make one of them act as a Trigger, in our example we can take the Panda.</p><p>The next step is to implement the <code class="literal">OnTriggerEnter2D()</code> function, which is called from the Physics engine of Unity, on the <code class="literal">PandaScript</code>. As a result, we are able to detect when something hits the panda, and check if it is an actual sprinkle, so to apply damage to the panda with the <code class="literal">Hit()</code> function written in the previous chapter.</p><pre class="programlisting">
<span class="emphasis"><em>//Function that detects projectiles</em></span>&#13;
void OnTriggerEnter2D(Collider2D other) {&#13;
  <span class="emphasis"><em>//Check if the other object is a projectile</em></span>&#13;
  if(other.tag == "Projectile") {&#13;
  <span class="emphasis"><em>  //Apply damage to this panda with the Hit function</em></span>&#13;
    Hit(other.GetComponent&lt;ProjectileScript&gt;().damage);&#13;
  }&#13;
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note90"></a>Note</h3><p>Of course, we need to be sure that every object with the Projectile tag have a <span class="strong"><strong>ProjectileScript</strong></span> component attached. This check is left as an exercise.</p></div><p>Finally, save the script, and we have done with Physics for our game, at least in this chapter. In fact, in the next chapter, we will use again the Physics engine, but for other reasons.</p></div></div>