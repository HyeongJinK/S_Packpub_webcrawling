<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec42"></a>Implementing the sugar meter</h2></div></div><hr /></div><p>If in the previous section we have seen how the sweet-tooth pandas can defeat the player, now it's time to give the player a way to stop them. The first step is to have enough sugar to build cupcakes towers. As such, we need a sugar meter to keep track of the amount of sugar that the player possesses.</p><p>As we have seen in our design, this will be a number, and not a bar like the health. Therefore, even if the concepts are similar, the implementation is slightly different.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec33"></a>Creating and place</h3></div></div></div><p>The process for creating the sugar meter is similar to the health bar, so let's start to create a new Image, parented with the Canvas, named <code class="literal">Sugar_Meter</code>. As a Sprite, you can use the <code class="literal">ui_sugar_meter</code> file in the <code class="literal">Graphic/UI</code> folder. Place it, and scale it if necessary, in the scene to match the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_058.jpg" /></div><p>Next, create a Text component, parent it to <code class="literal">Sugar_Meter</code>, and name it <code class="literal">Sugar_Meter_Text</code>. You can set the font and the color that you prefer. At the end you should have something similar to this:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_059.jpg" /></div><p>At the end, we should have the following in the <span class="strong"><strong>Hierarchy</strong></span> panel:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_060.jpg" /></div><p>Now, let's make it work with a script.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec34"></a>Scripting the sugar meter</h3></div></div></div><p>The script for the sugar meter works similarly to the script for the health bar. Let's import the namespace in order to use UI classes by adding the following line at the beginning of our script:</p><pre class="programlisting">using UnityEngine.UI; &#13;
</pre><p>We need two private variables to store the reference to <code class="literal">Sugar_Meter_Text</code> and the actual amount of sugar possessed by the player. As you can see, we don't have a maximum, because in theory the player can accumulate an infinite amount of sugar:</p><pre class="programlisting">private Text sugarMeter; <span class="emphasis"><em>//Reference to the Text component</em></span> &#13;
private int sugar; <span class="emphasis"><em>//Amount of sugar that the player possesses &#13;
</em></span>
</pre><p>In the <code class="literal">Start()</code> function, just get the reference to the UI text and update the graphic through a function, which we will implement in few steps:</p><pre class="programlisting">void Start () { &#13;
  <span class="emphasis"><em>//Get the reference to the Sugar_Meter_Text</em></span> &#13;
  sugarMeter = GetComponentInChildren&lt;Text&gt;(); &#13;
 <span class="emphasis"><em> //Update the Sugar Meter graphic </em></span> &#13;
  updateSugarMeter(); &#13;
} &#13;
</pre><p>Now we need a generic function to increase or decrease player's sugar by an arbitrary amount the. We also need to take into account that it is not possible to have a negative amount of sugar. This is more for code robustness rather than a real need for the game. In fact, the only way to decrease the sugar is if the player buys cupcake towers (or upgrades their towers), but he or she won't if he or she doesn't have enough sugar. One last thing to do is to update the graphic of the Sugar Meter as well:</p><pre class="programlisting">
<span class="emphasis"><em>//Function to increase or decrease the amount of sugar</em></span> &#13;
public void ChangeSugar(int value) { &#13;
  <span class="emphasis"><em>//Increase (or decrease, if value is negative) the amount of sugar</em></span> &#13;
  sugar += value; &#13;
  <span class="emphasis"><em>//Check if the amount of sugur is negative, is so set it to zero &#13;
</em></span>  if(sugar &lt; 0) { &#13;
    sugar = 0; &#13;
  } &#13;
  <span class="emphasis"><em>//Update the Sugar Meter graphic </em></span> &#13;
  updateSugarMeter(); &#13;
} &#13;
</pre><p>Since we will need to retrieve the amount of the sugar that the player has in the upcoming chapters, mainly to check if he or she has enough to buy an upgrade or a tower, we need a function to retrieve this value. The reason to create this function is that the sugar amount is a private variable, and we don't want to make it public, since for robustness we want it to change only with the <code class="literal">ChangeSugar()</code> function, which updates the graphic too:</p><pre class="programlisting">
<span class="emphasis"><em>//Function to return the amount of sugur, since it is a private&#13;
  variable</em></span> &#13;
public int getSugarAmount() { &#13;
  return sugar; &#13;
} &#13;
</pre><p>Finally, we need the function to update the graphic. This function converts the amount of sugar possessed by the player into a string, and assigns the string to the <span class="strong"><strong>Text</strong></span> component of <code class="literal">Sugar_Meter_Text</code>:</p><pre class="programlisting">
<span class="emphasis"><em>//Function to update the Sugar Meter graphic </em></span> &#13;
void updateSugarMeter() { &#13;
 <span class="emphasis"><em> //Assign the amount of sugar converted to a string to the text in the&#13;
    Sugar Meter</em></span> &#13;
  sugarMeter.text = sugar.ToString(); &#13;
} &#13;
</pre><p>Once the script is saved, we don't have any parameters to set in the <span class="strong"><strong>Inspector</strong></span>. Therefore, our sugar meter is ready to measure the amount of sugar.</p></div></div>