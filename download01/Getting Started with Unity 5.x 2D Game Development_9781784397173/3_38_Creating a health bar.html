<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec41"></a>Creating a health bar</h2></div></div><hr /></div><p>In our game world, the terrible sweet-tooth pandas make a lot of trouble for our player, especially when they reach the longed-awaited cake. As such, with every bite they take, the player will lose some life. However, the player needs a way, and so does the game, to keep track of his or her life. In our design, we chose a health bar, which we are going to implement in this section.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec31"></a>Creating and placing the health bar</h3></div></div></div><p>Within the <code class="literal">UI_Background</code> we created before, let's create another image by selecting <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span> (you can right-click directly on <code class="literal">UI_Background</code> to parent already the new image to it). Then, rename it <code class="literal">Health_Bar</code>.</p><p>Assign <code class="literal">ui_health_bar_frame</code> as a Sprite in the <code class="literal">Graphics/UI</code> folder. Again, scale it properly (and if you wish use also the <span class="strong"><strong>Set Native Size</strong></span> button, like we did for the bar) and place it as in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_053.jpg" /></div><p>Now, we need to create the health bar filling. Create a new image and name it <code class="literal">Health_Bar_Filling</code>. Assign <code class="literal">ui_health_bar_filling</code> to the image Sprite, and place in the scene as follows:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_054.jpg" /></div><p>At the end, you should have the following in the <span class="strong"><strong>Hierarchy</strong></span> panel:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_055.jpg" /></div><p>Now, in the <span class="strong"><strong>Inspector</strong></span>, we need to set the <span class="strong"><strong>Image Type</strong></span> of <code class="literal">Health_Bar_Filling</code> to <span class="strong"><strong>Filled</strong></span>. Then, set <span class="strong"><strong>Fill </strong></span>Method to <span class="strong"><strong>Horizontal</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> to <span class="strong"><strong>Left</strong></span>, as shown here:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_056.jpg" /></div><p>As a result, if we change the amount variable (you can play with in in the Inspector with the slider), the bar will be more or less filled, as a health bar should be.</p><p>Now we are ready to actual make the health bar work by using a specific script.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec32"></a>Scripting the health bar</h3></div></div></div><p>Finally, after many pages about UI, we start to see some code in this chapter. Again, as we said in the last chapter, don't be afraid of code, but try hard to understand why it works in that specific way, and you will be rewarded with the ability to program a game, which in my opinion is not bad.</p><p>Okay, let's start to create a new Script within the Script folder. If you prefer, you can also create a sub-folder named <code class="literal">UI_Scripts</code>, but this is up to you. We can name the script <code class="literal">HealthbarScript</code>.</p><p>Let's open the script by double-clicking on it. In order to use the UI classes, we need to import the namespace. This can be done by adding the following line at the beginning of our code, as we already pointed out:</p><pre class="programlisting">using UnityEngine.UI; &#13;
</pre><p>Now that we can use also the UI classes, we need three variables. One is a public variable that allows us to decide the maximum amount of health that the player can have. The other two are private to keep track of the Image component attached to <code class="literal">Health_Bar_Filling</code>, in order to change the bar filling, and the current amount of health that the player possesses:</p><pre class="programlisting">public int maxHealth; <span class="emphasis"><em>//The maximum amount of health that the player can possess</em></span>&#13;
private Image fillingImage; <span class="emphasis"><em>//The reference to "Health_Bar_Filling" Image component</em></span> &#13;
private int health;  <span class="emphasis"><em>//The current amount of health of the player &#13;
</em></span>
</pre><p>Next, we have to set a couple of variables in our <code class="literal">Start()</code> function, in particular, the reference to the UI Image of <code class="literal">Health_Bar_Filling</code> by using the <code class="literal">GetComponentInChildren()</code> function. We also need to set the current amount of health to the maximum. In this way, the player will start with the maximum amount of health, and this makes sense. Finally, we call a function to update the graphic of the health bar, which we will implement in a few steps:</p><pre class="programlisting">void Start () { &#13;
  <span class="emphasis"><em>//Get the reference to the filling image</em></span> &#13;
  fillingImage = GetComponentInChildren&lt;Image&gt;(); &#13;
 &#13;
 <span class="emphasis"><em> //set the health to the maximum</em></span> &#13;
  health = maxHealth; &#13;
 &#13;
  <span class="emphasis"><em>//Update the graphics of the Health Bar</em></span> &#13;
  updateHealthBar(); &#13;
} &#13;
</pre><p>Then, we need to expose a public method to reduce the amount of health the player possesses, based on an integer parameter we pass to it. This function will be called when one of the sweet-tooth pandas bites the cake, or in the worst-case scenario, it will dive into the cake. At the same time, the function should also check if the amount of health has reached zero. In this case, for the player, the game is over. As such, this function will return a Boolean value, which if true, means there is no more cake: the sweet-tooth pandas have eaten it all! Of course, we also need to update the graphic of the health bar when we change the health amount. Furthermore, to make the code slightly more robust. When the amount of health reaches zero or below, the current health is just set to zero and not to negative values. Therefore, we can write the following:</p><pre class="programlisting">
<span class="emphasis"><em>//Function to apply damage to the player</em></span> &#13;
public bool ApplyDamage(int value) { &#13;
 <span class="emphasis"><em> //Apply damage to the player</em></span> &#13;
  health -= value; &#13;
 &#13;
  <span class="emphasis"><em>//Check if the player has still health and update the Health Bar</em></span> &#13;
  if(health &gt; 0) { &#13;
    updateHealthBar(); &#13;
    return false; &#13;
  } &#13;
 &#13;
    <span class="emphasis"><em>//In case the player has no health left, set health to zero and&#13;
      return true</em></span> &#13;
    health = 0; &#13;
    updateHealthBar(); &#13;
    return true; &#13;
} &#13;
</pre><p>Finally, we need to write the function to update the Health Bar graphic, the one we have called in the previous functions. First, based on the current amount of health and the maximum available, the function computes the percentage (from 0% to 100%) of the amount of health of the player as a float between <code class="literal">0.0</code> and <code class="literal">1.0</code>. Note that <code class="literal">*1f</code> is a fast way to convert the number into a float, and therefore make a division between floats, instead of integers. Then, the function assigns this percentage to the <code class="literal">fillingAmount</code> of the image component:</p><pre class="programlisting">
<span class="emphasis"><em>//Function to update the Health Bar Graphic</em></span> &#13;
void updateHealthBar() { &#13;
 <span class="emphasis"><em> //Calculate the percentage (from 0% to 100%) of the current amount of&#13;
    health of the player</em></span> &#13;
  float percentage = health * 1f / maxHealth; &#13;
 <span class="emphasis"><em> //Assign the percentage to the fillingAmount variable of the&#13;
    "Health_Bar_Filling"</em></span> &#13;
  fillingImage.fillAmount = percentage; &#13;
} &#13;
</pre><p>After we have saved the script, it is ready to go. Also, remember to assign the maximum amount of health in the Inspector. For the purpose of our game, we set it to <code class="literal">100</code>. At the end, our script will be like the following in the <span class="strong"><strong>Inspector</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784397173/graphics/image_03_057.jpg" /></div><p>Now that the player has a health, we need to focus on storing and displaying the amount of sugar that the player collects.</p></div></div>