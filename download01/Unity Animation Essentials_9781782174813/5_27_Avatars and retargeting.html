<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec29"></a>Avatars and retargeting</h2></div></div><hr /></div><p>Selecting a <span class="strong"><strong>Humanoid</strong></span> rig<a id="id191" class="indexterm"></a> for an imported character mesh means that Unity will automatically try to configure your mesh in a special way that Mecanim requires. It does this using a data structure, called an <span class="strong"><strong>Avatar</strong></span>. When the autoconfigure process completes, your mesh will either pass or fail the autoconfiguration process. If the process fails, then you <a id="id192" class="indexterm"></a>will certainly need to configure your mesh Avatar manually. To do this, click on the <span class="strong"><strong>Configure</strong></span> button to show the Avatar editor. Unity will switch to a different mode, and it may ask you to save your current scene before doing so.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>Remember that even if the process of avatar generation completes automatically, you may still need to manually tweak or change a character Avatar. For that reason, don't skip this section even if your character mesh gets imported without any issues.</p></div><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_06.jpg" /><div class="caption"><p>Using the Avatar editor to configure a character</p></div></div><p>The Avatar editor <a id="id193" class="indexterm"></a>spans across three views in the interface, namely the Hierarchy panel, the Scene panel, and the Object Inspector panel (as shown in the preceding screenshot). Together, these constitute all of the data within the Avatar. The Hierarchy panel lists all the bones and their structure within the mesh. The Scene panel displays the character mesh alongside the bones. The Object Inspector panel, by default, displays a map of the human body. The idea of the Avatar editor is to ensure that all the appropriate bones in the mesh and hierarchy (such as the thighs, head, hands, shin, spine and so on) match the body map in the Object Inspector panel. Bones rendered in green inside the viewport are those that have been automatically and correctly mapped by Unity to the Avatar. Noncolored bones are those that have been ignored. Red bones are problematic; either their association to the map is wrong, or they are not oriented and aligned as they should be.</p><p>You can easily test and verify how the bones in the mesh have been assigned to the map by clicking on any of the circular icons on the body map. Doing this will select the corresponding bone object in the scene and hierarchy. By clicking on any of the circles, you should be able to verify that the correct bone has been mapped to the right location within the body map.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_07.jpg" /><div class="caption"><p>Mapping bones to the body</p></div></div><p>You can reassign <a id="id194" class="indexterm"></a>any bone in the mesh to its correct place in the map by dragging and dropping the bone object from the hierarchy panel into the corresponding bone field in the Object Inspector.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_08.jpg" /><div class="caption"><p>Remapping bones where required</p></div></div><p>Unless there are obvious red bones inside the viewport of the Avatar editor, it may not always be <a id="id195" class="indexterm"></a>clear how the bones are related to the mesh and whether they will deform and animate as you expect. Therefore, you can perform a stress test on the mesh using the <span class="strong"><strong>Muscles</strong></span> tab from the Object Inspector. To access this, click on the <span class="strong"><strong>Muscles</strong></span> option.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_09.jpg" /><div class="caption"><p>Accessing the Muscles tab to stress-test the mesh</p></div></div><p>When you access the <span class="strong"><strong>Muscles</strong></span> tab, the character will enter a different pose in the viewport. Also, a new set of options will show up in the Object Inspector. Using the <span class="strong"><strong>Muscle Group Preview</strong></span> sliders, you can push the character from neutral to extreme poses. This is useful because you can see how the character deforms in the skeleton across a spectrum of poses, allowing you to examine deformations at the extremes. This means that you can quickly identify any potential deformation issues.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_10.jpg" /><div class="caption"><p>Push characters to extreme poses to test their deformation potential</p></div></div><p>If you're character <a id="id196" class="indexterm"></a>isn't deforming properly in extreme poses, you can expand the <span class="strong"><strong>Per-Muscle Settings</strong></span> group sliders to define the minimum and maximum extents for the deformations. In other words, the sliders control the limits to which the skeleton affects the mesh, allowing you to reduce or increase the deformation extremes.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_11.jpg" /><div class="caption"><p>Correcting or adjusting extreme poses using the Muscles tab</p></div></div><p>When your avatar is working and deforming your character as needed, you can click on the <span class="strong"><strong>Apply</strong></span> button. This configures the Avatar for the mesh file. A successfully configured Avatar is important for Mecanim because it lets you achieve retargeting. This means that <span class="emphasis"><em>any</em></span> character with a correctly configured Avatar can be animated by the rig, and animations of <span class="emphasis"><em>any</em></span> other character with a correctly configured Avatar. All rigs and animations are entirely interchangeable between all meshes with a configured humanoid Avatar, hence <a id="id197" class="indexterm"></a>the name <span class="strong"><strong>Retargeting</strong></span>â€”because <a id="id198" class="indexterm"></a>the animation from one mesh can be retargeted to work on another. This lets you recycle and reuse all character animations. For example, you can make only one walk cycle and then share it for all walking characters.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_12.jpg" /><div class="caption"><p>Click on Apply in the Avatar editor to create a working Avatar for a character mesh</p></div></div></div>