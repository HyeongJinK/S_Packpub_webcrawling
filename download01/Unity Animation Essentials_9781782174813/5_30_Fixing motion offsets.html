<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec32"></a>Fixing motion offsets</h2></div></div><hr /></div><p>A common<a id="id206" class="indexterm"></a> problem when importing root motion animations into Unity is related to offsetting. To see this problem, play the walking animation scene you've just created, or load it from this book's companion files in the <code class="literal">Chapter05/char_anim_walk_start</code> folder. When you play this project and observe the character walking with root motion enabled, you'll see that not only does he walk forward in the scene, but he gradually wanders or moves off course. This is because he's not walking in a completely straight line. There's a degree of wander, or offset, that causes his path to deviate slowly over time. This isn't especially noticeable at first, but across larger spans of time, it's possible for a character to wander dramatically from its original path.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_22.jpg" /><div class="caption"><p>Root motion deviation</p></div></div><p>This problem is not scene- or character-related, but is embedded inside the animation root motion. To<a id="id207" class="indexterm"></a> fix it, you should select the animation file in the Project Panel to display its properties. For the sample walk animation used here, the animation file can be found by going to <span class="strong"><strong>Standard Assets</strong></span> | <span class="strong"><strong>ThirdPersonCharacter</strong></span> | <span class="strong"><strong>Animation</strong></span>. Select the <code class="literal">HumanoidWalk.fbx</code> file. In the Project Panel, select the <span class="strong"><strong>Animation</strong></span> tab to view the animation data in the file. If you play the file in the Preview Panel, you'll see the offsetting problem there too.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_23.jpg" /><div class="caption"><p>Viewing animation data for a selected file</p></div></div><p>The problem occurs due to the angular velocity. This value is shown in the Object Inspector. The <a id="id208" class="indexterm"></a>
<span class="strong"><strong>Average Velocity</strong></span> vector indicates the direction and orientation of the character throughout the lifetime of the animation. For the default walk animation, this value includes a marginal, negative value for the <span class="emphasis"><em>x</em></span> component of the velocity. Therefore, the model deviates from its course over time.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_24.jpg" /><div class="caption"><p>Examining the average velocity for root motion</p></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note19"></a>Note</h3><p>To fix the issue, select the <span class="strong"><strong>Bake Into Pose</strong></span> checkbox for <span class="strong"><strong>Root Transform Rotation</strong></span> and change the <span class="strong"><strong>Offset</strong></span> field until the <span class="strong"><strong>Average Velocity</strong></span> value of the <span class="emphasis"><em>x</em></span> parameter reaches <span class="strong"><strong>0</strong></span>. The <span class="emphasis"><em>z</em></span> value should remain nonzero, since the character should walk forward. To edit these settings, you may have to click on the <span class="strong"><strong>Edit</strong></span> button in the top-right corner of the Object Inspector when the mesh is selected.</p></div><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_25.jpg" /><div class="caption"><p>Adjusting root motion offsets with Bake Into Pose</p></div></div><p>Finally, if <a id="id209" class="indexterm"></a>your characters appear to be walking through the floor, are centered on their hip bones, or are walking either higher or lower than they should be, you should change the <span class="strong"><strong>Root Transform Position (Y)</strong></span> value to be <span class="strong"><strong>Feet</strong></span>, for the <span class="strong"><strong>Based Upon (at Start)</strong></span> field. This ensures that the root <span class="emphasis"><em>y</em></span> position for your character is based on the feet bones.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_05_26.jpg" /><div class="caption"><p>Setting the character's feet for animation</p></div></div></div>