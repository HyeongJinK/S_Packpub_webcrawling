<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec18"></a>Particle Systems</h2></div></div><hr /></div><p>Particle systems <a id="id125" class="indexterm"></a>are primarily responsible for creating special effects and animation where many parts or things must move together as something cohesive, such as rain, snow, sparkles, fairy dust, flocks of birds, swarms of bees, and more. They're also used to simulate intangible things, such as light rays, dust, ghosts, holograms, and others.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_16.jpg" /><div class="caption"><p>A fire particle system in action</p></div></div><p>Unity 5 ships with a wide range of premade particle systems that can simply be dragged and dropped into <a id="id126" class="indexterm"></a>a scene to create the most common particle effects, such as explosions, fire, steam, and smoke. To access these effects, import the Particle Systems asset package into your project by going to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>ParticleSystems</strong></span> from the application menu. After this import, all the premade systems will be available by going to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>ParticleSystems</strong></span> | <span class="strong"><strong>Prefabs</strong></span> from the Unity Project panel.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_17.jpg" /><div class="caption"><p>Unity 5 ships with many premade particle systems</p></div></div><p>Despite the differences between them, all particle systems have three features in common. The first is an <a id="id127" class="indexterm"></a>
<span class="strong"><strong>emitter</strong></span> element, which is like a hose, or portal, from which particles are emitted or spewed. The second is the <a id="id128" class="indexterm"></a>
<span class="strong"><strong>particle</strong></span> itself—the small things or pieces that the emitter generates. For rain systems, each rain drop is a particle; for snow, each snow flake; for a flock of birds, each bird is a particle; and so on. Finally, once a particle is emitted, it has a <span class="strong"><strong>lifetime</strong></span> that defines the duration for which it exists, and also a trajectory or velocity that defines what happens to the particle during its lifetime (how it moves, how fast it travels, and so on). Therefore, creating a particle system for animation is all about defining how these three elements work together. Consider the next section for a practical project—creating a particle system from the ground up using the Shuriken System.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec29"></a>Starting a firefly particle system</h3></div></div></div><p>A common<a id="id129" class="indexterm"></a> particle system included in games, especially <a id="id130" class="indexterm"></a>in fantasy RPGs, is fireflies. If you're navigating through a dark forest at night, or are wading through a treacherous swamp in the mist, you'll often find small, bright fireflies hovering around. They don't really do anything functional in terms of the gameplay; that is, they<a id="id131" class="indexterm"></a> neither harm nor benefit you. Rather, their purpose is entirely cosmetic and <a id="id132" class="indexterm"></a>emotional. They convey an atmosphere and setting. In this system, a group of bright fireflies moves around slowly and calmly, each fly following its own unique velocity.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>The complete Unity project for this particle system is included in the companion files in the <code class="literal">Chapter03/ParticleSystems</code> folder.</p></div><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_18.jpg" /><div class="caption"><p>Creating a firefly particle system with shuriken</p></div></div><p>The standard Unity particle package doesn't include the firefly effect, so we'll create it here. To do this, we'll use the Unity Shuriken System. Let's create a new particle system by going to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>ParticleSystem</strong></span> from the application menu. Choosing this creates a new default particle system object in the scene. When selected, the particle system will automatically play in the scene viewport.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_19.jpg" /><div class="caption"><p>Creating a particle system with Shuriken</p></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>For this project, I've set the scene lighting to night time, or just after sunset. To do this, simply create a new scene and rotate the default directional light to face upwards. The Unity 5 default skybox will automatically respond to the light orientation.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec30"></a>The Particle System's global properties</h3></div></div></div><p>When<a id="id133" class="indexterm"></a> the Particle System is selected in the scene, you can view its properties from the Shuriken Editor, which appears as a Particle System component in the Object Inspector. This editor is divided into several distinct categories. The main global properties control general attributes and behavior for the selected Particle System.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_20.jpg" /><div class="caption"><p>Setting the fireflies' global properties</p></div></div><p>The <span class="strong"><strong>Duration</strong></span> value<a id="id134" class="indexterm"></a> defines the total length of the particle system animation before it begins again and loops. For the firefly effect, the <span class="strong"><strong>Start Speed</strong></span> value has been set to 0, because the speed and motion will vary on a per particle basis and will be overridden, or controlled, by more advanced settings in the Shuriken Editor. <span class="strong"><strong>Start Size</strong></span> controls the overall size of a generated particle. This field has been changed from a single constant value (making all particles the same size) to a random value for each particle, chosen between a minimum value and a maximum value (allowing each particle to get a different size). This gives us size variation among the fireflies in the system. To access this setting, click on the right-hand-side arrow for the <span class="strong"><strong>Start Size</strong></span> field and choose <span class="strong"><strong>Random Between Two Constants</strong></span> from the context menu.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_21.jpg" /><div class="caption"><p>Picking random values between a minimum and maximum</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec31"></a>Emitter shape and emission rate</h3></div></div></div><p>As mentioned, every Particle System has an emitter, a spawn point at which new particles are generated. The <a id="id135" class="indexterm"></a>emitter itself has a shape. It can be flat, a point, a cube, a sphere, or a custom mesh, and it represents the surface area or volume inside which the particles are generated. The exact point <a id="id136" class="indexterm"></a>on the surface is randomly selected for each particle. To control the shape of the Emitter, expand the <span class="strong"><strong>Shape</strong></span> tab in the Shuriken Editor, making sure that there's a checkmark in the <span class="strong"><strong>Shape</strong></span> box. For the firefly system, all flies should be generated within a spherical volume. I set the radius of the sphere to 2.5 (meters). The <span class="strong"><strong>Radius</strong></span> size is not essential, but a value that looks right and is appropriate for your scene needs to be chosen.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_22.jpg" /><div class="caption"><p>Setting an emitter shape</p></div></div><p>Next, let's expand the Emission section in the Shuriken Editor. This controls the frequency, or the rate at which new particles are generated from the Emitter per second. When generating fireflies, it's important not to cause too dense or thick a generation of particles. I set <span class="strong"><strong>Emission Rate</strong></span> to <span class="strong"><strong>18.5</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_23.jpg" /><div class="caption"><p>Setting the emission rate</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec32"></a>Particle Renderer</h3></div></div></div><p>Every <a id="id137" class="indexterm"></a>particle in the system shares the same renderer, or appearance. The appearance settings for particles are controlled by the <span class="strong"><strong>Renderer</strong></span> section of the Shuriken editor. The <span class="strong"><strong>Render Mode</strong></span> field controls how the particle is displayed, and it mainly consists of two types: <span class="strong"><strong>Billboard</strong></span> and <span class="strong"><strong>Mesh</strong></span>. Billboard particles are made from a quad mesh with a texture assigned. Mesh particles are composed from more complex meshes other than quads, and you can use any mesh imported into the project. In addition to the <span class="strong"><strong>Render Mode</strong></span> setting, a particle needs a material to be assigned to the particle mesh. </p><p>For particles you can use any material, but the firefly system will use a premade material provided as part of the default Unity Particle assets (which can be imported by going to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>ParticleSystems</strong></span> from the application menu). The material I chose was <span class="strong"><strong>ParticleAfterburner</strong></span>. You can simply drag and drop this material into the <span class="strong"><strong>Material</strong></span> slot in the Object Inspector.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_24.jpg" /><div class="caption"><p>Setting the particle renderer</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec33"></a>Particle velocity</h3></div></div></div><p>One<a id="id138" class="indexterm"></a> of the most critical features of the behavior of the firefly particle system is that each particle should move on its own trajectory. This is the case because each particle is supposed to be a separate and independent firefly, which is only part of a larger system of flies because of its proximity to other flies. The velocity of a particle during its lifetime is controlled by the <span class="strong"><strong>Velocity over Lifetime</strong></span> section. When this section is expanded in the Object Inspector, you will be presented with three constant values for the <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>, and <span class="emphasis"><em>z</em></span> axes. Together, these define a three-component vector, indicating the direction and speed at which all particles should travel. Therefore, three constant values are inappropriate for the firefly system because they cause <span class="emphasis"><em>all</em></span> flies to travel in the same direction. </p><p>To randomize the direction of each fly, we'll need to change the Velocity mode from <span class="strong"><strong>Constant</strong></span> to <span class="strong"><strong>Random Between Two Curves</strong></span>. To change this, click on the downward-pointing arrow in the top-right corner of the <span class="strong"><strong>Velocity over Lifetime</strong></span> section. If the options are ghosted or faded, ensure that the <span class="strong"><strong>Velocity over Lifetime</strong></span> checkbox is enabled.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_25.jpg" /><div class="caption"><p>Preparing to control Velocity over Lifetime</p></div></div><p>By using two <a id="id139" class="indexterm"></a>curves, a complete range of minimum and maximum velocity values can be set for each particle as it travels throughout its lifetime. To set the curves, click on an axis in the inspector to toggle its visibility as a graph in the Preview panel of the Object Inspector. View each axis one at a time by clicking on it. From the Preview panel, double-click to plot points on the line, and then click on the plot points and drag to reshape the curves. The Horizontal axis refers to time (the left side represents particle birth and the right side represents particle death), and the Vertical axis refers to the value (velocity) at that time. The idea is to create a variation in the curve to produce the corresponding variation in the particle's velocity throughout its lifetime. Points can be created along the curve simply by double-clicking wherever you want to add them.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_26.jpg" /><div class="caption"><p>Plotting particle velocity</p></div></div><p>After creating <a id="id140" class="indexterm"></a>the first curve, repeat the procedure for the remaining axes. Once completed, the particles will move independently.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_27.jpg" /><div class="caption"><p>Completing the Velocity over Lifetime graph</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec34"></a>Particle color and disappearance</h3></div></div></div><p>To complete <a id="id141" class="indexterm"></a>the firefly system, we should change the way the particles are born and die within the system. By default, particles are born by popping into existence, and then also die by simply popping out of existence. This produces a hard and binary transition between something existing and not existing, resulting in an unbelievable appearance for the system as a whole. This is because particles are visible in one moment and vanish in the next. To solve this, we can use the <span class="strong"><strong>Color over Lifetime</strong></span> section, changing how the color of a particle fluctuates over its lifetime. This is important because a significant part of a particle color includes its alpha channel, or alpha transparency. Consequently, by controlling color, we can fade in and fade out particles with alpha.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_28.jpg" /><div class="caption"><p>Controlling particle transparency with Color over Lifetime</p></div></div><p>To control <a id="id142" class="indexterm"></a>the color throughout a particle's lifetime, click on the color gradient swatch inside the <span class="strong"><strong>Color over Lifetime</strong></span> section, in the Object Inspector. This displays the <span class="strong"><strong>Gradient Editor</strong></span> dialog. From here, you can view the color of a particle across its lifetime through a gradient control. The control spans the horizontal axis; the left side represents particle birth, and the right side represents particle death. The underside of the gradient bar charts the hue (color) of the particle, and the top side of the gradient bar charts transparency. You can control transparency by clicking at the top of the gradient to insert a bookmark slider at the mouse's position, and then clicking on the slider itself to set its alpha for that time (0 means transparent and 255 means fully visible). Insert two bookmarks at the beginning and end of the gradient to set the particle transparency to 0, marking the particle's birth and death respectively. Then insert two further bookmarks between 0 and 1 to raise the particle visibility to 255 to make particles fully visible. This results in particles that fade in at birth and fade out at death. This produces a smoother and tidier transition between particles as they enter and leave the system.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_29.jpg" /><div class="caption"><p>The final firefly system</p></div></div><p>Congratulations! You've <a id="id143" class="indexterm"></a>just completed the firefly particle system, which can be used in a variety of games and circumstances. Now is a great time to create a prefab of the system, making it easier to drag and drop it into any of your scenes.</p></div></div>