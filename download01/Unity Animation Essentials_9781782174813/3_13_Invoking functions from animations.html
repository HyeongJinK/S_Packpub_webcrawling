<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec17"></a>Invoking functions from animations</h2></div></div><hr /></div><p>Frequently, you'll <a id="id121" class="indexterm"></a>need to link animations with the script and game logic. Specifically, when animation playback reaches a specific frame or time, or when an animation begins or ends, you may want something else to happen in script, even on a completely different object. In the camera fly-through animation for example, we may want to show a message on the screen saying "<span class="strong"><strong>Welcome!</strong></span>", when the fly-through animation ends. There are many ways to handle this type of requirement. One way is to run a function in script when a frame shows up in the animation. To create this kind of connectivity between animation and script, we'll need an animation event.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>The complete Unity project for an animation event is included in this book's companion files in the <code class="literal">Chapter03/AnimationEvents</code> folder.</p></div><p>To get started with calling functions from animations, create a new C# script file or edit an existing file. Add a function of any name that returns void and either; has no arguments, or accepts a string, a float, an integer, or a GameObject. See the following code sample, which accepts no arguments and shows a GUI canvas object when called, to display a welcome message, which should happen when the camera fly-through animation completes. The script file should be attached to the camera object in the scene.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>More information on animation events can be found at the online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/Manual/animeditor-AnimationEvents.html" target="_blank">docs.unity3d.com/Manual/animeditor-AnimationEvents.html</a>.</p></div><div class="informalexample"><pre class="programlisting">//--------------------------------------------
using UnityEngine;
using System.Collections;
using UnityEngine.UI;
//--------------------------------------------
public class ShowMessage : MonoBehaviour 
{
  //Reference to GUI canvas to show on event
  public Canvas UICanvas = null;

  //Function to be called from an Animation Event
<span class="strong"><strong>  void ShowWelcomeMessage()</strong></span>
  {
    //Enable canvas to show message
    UICanvas.gameObject.SetActive(true);
  }
}
//--------------------------------------------</pre></div><p>To create <a id="id122" class="indexterm"></a>a link between the animation and the <code class="literal">ShowWelcomeMessage</code> function, open the <span class="strong"><strong>Animation</strong></span> window and right-click on the grey bar above the final key frame at time 1:00 but below the time header. When you do this, a context menu appears, showing the option to create an animation event at the selected key frame, like this:</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_12.jpg" /><div class="caption"><p>Adding an animation event</p></div></div><p>Click on <span class="strong"><strong>Add Animation Event</strong></span> from the context menu. After this, the <span class="strong"><strong>Edit Animation Event</strong></span> dialog appears, featuring a drop-down list control. This allows you to choose the function to call<a id="id123" class="indexterm"></a> duration the event. If your custom function is not shown in the list as an option, make sure that all the relevant script files are attached to the animated game object.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_13.jpg" /><div class="caption"><p>Selecting a function to call during an animation event</p></div></div><p>Close the <span class="strong"><strong>Edit Animation Event</strong></span> dialog, and now a white marker will be added to the Animation timeline, indicating the time of the function call. The marker can be edited, deleted, and moved, just like a regular key frame object.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_14.jpg" /><div class="caption"><p>Invoking an animation event from an animation timeline</p></div></div><p>And that's it! The animation event will now run automatically on the animated object at runtime whenever the play head hits the final frame. Click on <span class="strong"><strong>Play</strong></span> in the Unity toolbar to give the project a test run.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>Remember that the UI Canvas public member of the <code class="literal">ShowMessage</code> script should reference a valid UI Canvas object in the scene. See the companion files folder <code class="literal">Chapter3\AnimationEvents</code>. More information on <a id="id124" class="indexterm"></a>UI Canvas can be found in the online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Canvas.html" target="_blank">http://docs.unity3d.com/ScriptReference/Canvas.html</a>.</p></div><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_03_15.jpg" /><div class="caption"><p>Showing a Welcome! message when an animation ends</p></div></div></div>