<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec23"></a>Mecanim transitions and parameters</h2></div></div><hr /></div><p>The <a id="id159" class="indexterm"></a>problem with the push-button Mecanim graph created previously is that although it prevents any animation from playing automatically at scene startup, there's still no way to initiate the push-button animation when it's supposed to play later, that is, when the player clicks on it. The aim now is to rewire the Mecanim graph so that we have control over when the button-push animation plays, allowing playback at an arbitrary time. To achieve this we'll use <a id="id160" class="indexterm"></a>
<span class="strong"><strong>transitions</strong></span> and <a id="id161" class="indexterm"></a>
<span class="strong"><strong>parameters</strong></span>. Transitions are simply connections between states that allow one state to move to another. Parameters <a id="id162" class="indexterm"></a>are variables, or switches, that we can create to fire a transition between two states. Let's now create a parameter that'll help us control when the <span class="strong"><strong>Idle</strong></span> state (doing nothing) becomes a button-push state. Effectively, this parameter will act as a control switch for initiating animation playback. Inside the Animator window, click on the <span class="strong"><strong>Parameters</strong></span> tab in the top-left corner.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_13.jpg" /><div class="caption"><p>Accessing the Parameters tab</p></div></div><p>Then click <a id="id163" class="indexterm"></a>on the <span class="strong"><strong>+</strong></span> icon to add a new parameter. There are <a id="id164" class="indexterm"></a>different types that can be selected. For this sample, select <span class="strong"><strong>Trigger</strong></span>. Triggers act like control switchesâ€”once activated, they will fire a transition from one state to another.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_14.jpg" /><div class="caption"><p>Creating a trigger</p></div></div><p>Assign the trigger a name, such as <code class="literal">PushButton</code>. Once created, the trigger appears in the parameter list and features a checkmark icon next to its name, which can be pushed at runtime for debugging <a id="id165" class="indexterm"></a>and testing purposes, allowing us to activate the trigger directly from the editor. Now that the trigger has been created, it must be linked to a <a id="id166" class="indexterm"></a>transition in the graph to be really effective. A transition should be created between the <span class="strong"><strong>Idle</strong></span> state (doing nothing) and the push-button animation. This creates a link between the <span class="strong"><strong>Idle</strong></span> state and the animation. To create the transition, right-click on the <span class="strong"><strong>Idle</strong></span> state in the graph and then choose <span class="strong"><strong>Make Transition</strong></span> from the context menu.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_15.jpg" /><div class="caption"><p>Creating a transition</p></div></div><p>You can then click on a connecting transition arrow that runs from the <span class="strong"><strong>Idle</strong></span> state to the button-animation, establishing a one way connection. When you select the transition arrow between the states, you will see more properties displayed in the Object Inspector. These properties control how and when the transition occurs.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_16.jpg" /><div class="caption"><p>Selecting a transition displays more properties in the Object Inspector</p></div></div><p>By default, the <a id="id167" class="indexterm"></a>transition occurs at exit time, which means that the <span class="strong"><strong>Idle</strong></span> state plays once, or for a period of time, and then automatically transitions to the <a id="id168" class="indexterm"></a>button push state, even if the player does not press the button. This can be confirmed by playing the scene and observing what happens to the button object in the <span class="strong"><strong>Scene</strong></span> tab; it'll just push inwards automatically, a few seconds after the scene start. In contrast to the default settings, the transition should occur when the <span class="strong"><strong>PushButton</strong></span> trigger is activated. To achieve this, disable the <span class="strong"><strong>Has Exit Time</strong></span> checkbox from the Object Inspector when the transition is selected. This prevents the <span class="strong"><strong>Idle</strong></span> state from automatically transitioning to the button-push animation.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_17.jpg" /><div class="caption"><p>Disabling Has Exit Time</p></div></div><p>Next, the <span class="strong"><strong>Conditions</strong></span> panel in <a id="id169" class="indexterm"></a>the Object Inspector <a id="id170" class="indexterm"></a>can be used to specify when the transition should be activated. Click on the <span class="strong"><strong>+</strong></span> icon to add a new condition. Then, from the drop-down list, select the <span class="strong"><strong>PushButton</strong></span> trigger, if it's not already selected. This finally connects the <span class="strong"><strong>PushButton</strong></span> trigger to the transition.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_18.jpg" /><div class="caption"><p>Connect the transition to the PushButton trigger</p></div></div><p>You can test the trigger connection for the transition at runtime. Just select the button object in the scene, and then click on the <span class="strong"><strong>Play</strong></span> button in the toolbar. Next, click on the <span class="strong"><strong>Trigger</strong></span> checkbox in the <span class="strong"><strong>Parameter</strong></span> panel of the Animator window. When you do this, you'll see the button push animation activated in the <span class="strong"><strong>Scene</strong></span> or <span class="strong"><strong>Game</strong></span> tab.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_19.jpg" /><div class="caption"><p>Testing the PushButton trigger</p></div></div><p>The final limitation <a id="id171" class="indexterm"></a>of our state machine for the button in the Mecanim graph is that once the button is pushed, the graph transitions to the push-animation state and <a id="id172" class="indexterm"></a>remains there, even after the animation completes. This means that the player cannot push the button a second, third, or fourth time simply because the graph "gets stuck" in the animation state. We want the button-push animation to transition back to the <span class="strong"><strong>Idle</strong></span> state when completed, allowing multiple button pushes. To achieve this, right-click on the push-button animation state in the graph and select <span class="strong"><strong>Make Transition</strong></span> from the context menu that appears. Then drag a connection back to the <span class="strong"><strong>Idle</strong></span> state. All the settings for the transition can be left at their default values.</p><div class="mediaobject"><img src="/graphics/9781782174813/graphics/B04103_04_20.jpg" /><div class="caption"><p>Creating a two-way connection between states</p></div></div><p>This now completes the Mecanim graph for the button object in the scene. As we've seen, the connectivity <a id="id173" class="indexterm"></a>between the trigger and transition can be tested <a id="id174" class="indexterm"></a>at runtime from the Animator window. But even so, the player <span class="emphasis"><em>still cannot</em></span> trigger the transition by clicking on the button object in the scene. This will be fixed soon, after considering the use of the Mecanim graph for the door.</p></div>