<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec39"></a>If looks could kill</h2></div></div><hr /></div><p>We got this far. We might as <span>well</span><a id="id325547516" class="indexterm"></a> try to kill Ethan (haha!). Here are the specifications for this new feature:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Looking at Ethan hits him with our line-of-sight raygun</li><li style="list-style-type: disc">Sparks are emitted when the gun hits its target</li><li style="list-style-type: disc">After 3 seconds of being hit, Ethan is killed</li><li style="list-style-type: disc">When he's killed, Ethan explodes (we get a point) and then he respawns at a new location</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec64"></a>The KillTarget script</h3></div></div></div><p>This time, we'll <span>attach</span><a id="id325578233" class="indexterm"></a> the script to a <span>new</span><a id="id325578240" class="indexterm"></a> empty <code class="literal">GameController</code> object by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create an empty game object and name it <code class="literal">GameController</code>.</li><li>Attach a new C# script to it, using <strong class="userinput"><code>Add Component</code></strong>, named <code class="literal">KillTarget</code>.</li><li>Open the script in MonoDevelop.</li></ol></div><p>Here's the completed <code class="literal">KillTarget.cs</code> script:</p><pre class="programlisting">using UnityEngine; 
using System.Collections; 
 
public class KillTarget : MonoBehaviour { 
  public GameObject target; 
  public ParticleSystem hitEffect; 
  public GameObject killEffect; 
  public float timeToSelect = 3.0f; 
  public int score; 
 
  private float countDown; 
 
  void Start () { 
    score = 0; 
    countDown = timeToSelect; 
  } </pre><pre class="programlisting">void Update () { 
    Transform camera = Camera.main.transform; 
    Ray ray = new Ray (camera.position, camera.rotation * 
       Vector3.forward); 
    RaycastHit hit; 
    if (Physics.Raycast (ray, out hit) &amp;&amp; (hit.collider.gameObject 
       == target)) { 
      if (countDown &gt; 0.0f) { 
        // on target 
        countDown -= Time.deltaTime; 
        // print (countDown); 
        hitEffect.transform.position = hit.point; 
        hitEffect.Play(); 
      } else { 
        // killed 
        Instantiate( killEffect, target.transform.position, 
           target.transform.rotation ); 
        score += 1; 
        countDown = timeToSelect; 
        SetRandomPosition(); 
      } 
    } else { 
      // reset 
      countDown = timeToSelect; 
      hitEffect.Stop(); 
    } 
  } 
 
  void SetRandomPosition() { 
    float x = Random.Range (-5.0f, 5.0f); 
    float z = Random.Range (-5.0f, 5.0f); 
    target.transform.position = new Vector3 (x, 0.0f, z); 
  } 
} </pre><p>Let's go through this. First, we declare a number of public variables, as follows:</p><pre class="programlisting">  public GameObject target; 
  public ParticleSystem hitEffect; 
  public GameObject killEffect; 
  public float timeToSelect = 3.0f; 
  public int score; </pre><p>Like we did in the previous <code class="literal">LookMoveTo</code> script, our target will be Ethan. We're also adding a <code class="literal">hitEffect</code> particle emitter, a <code class="literal">killEffect</code> explosion, and a start value for the countdown timer, <code class="literal">timeToSelect</code>. Lastly, we'll keep track of our kills in the <code class="literal">score</code> variable.</p><p>The <code class="literal">Start()</code> method, which is called at the start of the gameplay, initializes the score to zero and sets the <code class="literal">countDown</code> timer to its starting value.</p><p>Then, in the <code class="literal">Update()</code> method, like in the <code class="literal">LookMoveTo</code> script, we cast a ray from the camera and check whether it hits our target, Ethan. When it does, we check the <code class="literal">countDown</code> timer.</p><p>If the timer is still counting, we decrement its value by the amount of time that's gone by since the last time <code class="literal">Update()</code> was called, using <code class="literal">Time.deltaTime</code>, and make sure that <code class="literal">hitEffect</code> is emitting at the hit point.</p><p>If the ray is still on its target and the timer is done counting down, Ethan is killed. We explode, bump up the score by one, reset the timer to its starting value, and move (respawn) Ethan to a random new location.</p><p>For an explosion, we'll use one of Unity's standard assets found in the <code class="literal">ParticleSystems</code> package. To activate it, <code class="literal">killEffect</code> should be set to the prefab named <code class="literal">Explosion</code>. Then, the script <span class="emphasis"><em>instantiates</em></span> it. In other words, it makes it an object in the scene (at a specified transform), which kicks off its awesome scripts and effects.</p><p>Lastly, if the ray did not hit Ethan, we <span>reset</span><a id="id325594728" class="indexterm"></a> the counter and turn off the particles.</p><p>Save the script and <span>go</span><a id="id325594739" class="indexterm"></a> into the Unity Editor.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note42"></a>Note</h3><p><span class="strong"><strong>Extra challenge</strong></span>: Refactor the script to use co-routines to manage the delay timing, like we did in the <code class="literal">RandomPosition</code> script at the start of this chapter.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec65"></a>Adding particle effects</h3></div></div></div><p>Now, to <span>populate</span><a id="id325594763" class="indexterm"></a> the <code class="literal">public</code> variables, we <span>will</span><a id="id325317257" class="indexterm"></a> perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, we need the <code class="literal">ParticleSystems</code> package that comes with Unity standard assets. If you do not have them, navigate to <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Import Package</code></strong> | <strong class="userinput"><code>ParticleSystems</code></strong>, choose <strong class="userinput"><code>All</code></strong>, and then click on <strong class="userinput"><code>Import</code></strong>.</li><li>Select <code class="literal">GameController</code> from the <strong class="userinput"><code>Hierarchy</code></strong> panel and go to the <strong class="userinput"><code>Kill Target (Script)</code></strong> pane in the <strong class="userinput"><code>Inspector</code></strong> panel.</li><li>Drag the <code class="literal">Ethan</code> object from the <strong class="userinput"><code>Hierarchy</code></strong> panel onto the <strong class="userinput"><code>Target</code></strong> field.</li><li>From the main menu bar, navigate to <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Effects</code></strong> | <strong class="userinput"><code>Particle System</code></strong> and name it <code class="literal">SparkEmitter</code>.</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Reselect <code class="literal">GameController</code> and drag <code class="literal">SparkEmitter</code> onto the <strong class="userinput"><code>Hit Effect</code></strong> field.</li><li>In the <strong class="userinput"><code>Project</code></strong> panel, find the <code class="literal">Explosion</code> prefab in <code class="literal">Assets/Standard Assets/ParticleSystems/Prefabs</code> and drag the <code class="literal">Explosion</code> prefab onto the <strong class="userinput"><code>Kill Effect</code></strong> field.</li></ol></div><p>The script pane looks like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/c78bf067-09b0-4f54-bf98-b9e19a893bdf.png" /></div><p>We created a default particle system that will be used as the spark emitter. We need to set that up to our liking. I'll get you started, and you can play with it as you desire, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select <code class="literal">SparkEmitter</code> from the <strong class="userinput"><code>Hierarchy</code></strong> panel.</li><li>And in its <strong class="userinput"><code>Inspector</code></strong> panel, under <strong class="userinput"><code>Particle System</code></strong>, set the following values:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Start Size</code></strong>: <code class="literal">0.15</code></li><li style="list-style-type: disc"><strong class="userinput"><code>Start Color</code></strong>: pick a red/orange color</li><li style="list-style-type: disc"><strong class="userinput"><code>Start Lifetime</code></strong>: <code class="literal">0.3</code></li><li style="list-style-type: disc"><strong class="userinput"><code>Max Particles</code></strong>: <code class="literal">50</code></li></ul></div></li><li>Under <strong class="userinput"><code>Emission</code></strong>, set <strong class="userinput"><code>Rate over Time</code></strong>: <code class="literal">100</code></li><li>Under <strong class="userinput"><code>Shape</code></strong>, set <strong class="userinput"><code>Shape</code></strong>: <strong class="userinput"><code>Sphere</code></strong> and <strong class="userinput"><code>Radius</code></strong>: <code class="literal">0.01</code></li></ol></div><p>Here's what my <strong class="userinput"><code>Scene</code></strong> view looks like as I run Play Mode and zap Ethan in the chest:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/bbf957a1-c48b-4256-928c-b0cf41886ac8.png" /></div><p>When Ethan is shot, the <code class="literal">hitEffect</code> particle system is activated. After 3 seconds (or whatever value you set in the <code class="literal">TimeToSelect</code> variable), his <span class="emphasis"><em>health</em></span> is depleted, the explosion effect is instantiated, the score is incremented, and he respawns at a new location. In  <a class="link" href="#" linkend="ch06">Chapter 6</a><span class="emphasis"><em>, World Space UI</em></span>, we'll see how we can show the current score to the player.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec66"></a>Cleaning up</h3></div></div></div><p>One last thing before we're done: let's <span>clean</span><a id="id325578147" class="indexterm"></a> up the <code class="literal">Assets</code> folder a bit and move all the scripts into an <code class="literal">Assets/Scripts/</code> subfolder. Select the Project Assets folder in Project, create a folder, name it Scripts, and drag all your scripts into it.</p><p> </p></div></div>