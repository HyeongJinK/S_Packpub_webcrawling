<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec82"></a>Displaying the art info</h2></div></div><hr /></div><p>Now that we have more information on <span>each</span><a id="id325317294" class="indexterm"></a> art piece, we can incorporate that into our project. We will add a UI canvas to the ArtworkRig. First, we'll include an info plaque with each picture. Then we'll make it interactive. If you'd like a reminder introduction to Unity's canvas and UI elements, please look at <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>World Space UI</em></span>. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec124"></a>Creating the title plaque</h3></div></div></div><p>The title plaque will be a small canvas next to <span>each</span><a id="id325552045" class="indexterm"></a> picture, with a title text UI element:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select one of the <strong class="userinput"><code>ArtworkRig</code></strong> objects in <strong class="userinput"><code>Hierarchy.</code></strong></li><li>Add a child canvas, <strong class="userinput"><code>Create UI</code></strong> | <strong class="userinput"><code>Canvas</code></strong>, named InfoPlaque.</li><li>Set its <strong class="userinput"><code>Render Mode</code></strong> to <strong class="userinput"><code>World Space.</code></strong></li><li>Initially reset its position <strong class="userinput"><code>Pos</code></strong> to (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>).</li><li>Set the canvas <strong class="userinput"><code>Width</code></strong>: <code class="literal">640</code>, <strong class="userinput"><code>Height</code></strong>: <code class="literal">480</code>.</li><li>If you recall, the canvas scaled in world space will be 640 meters wide! Set the <strong class="userinput"><code>Scale</code></strong> to <code class="literal">0.0006.</code></li><li>Now you can visually adjust the position using the move gizmo, we found this works: <strong class="userinput"><code>Pos</code></strong> (<code class="literal">0.8</code>, <code class="literal">-0.1</code>, <code class="literal">-0.01</code>).</li><li>Next, create a child pane, <strong class="userinput"><code>Create UI</code></strong> | <strong class="userinput"><code>Panel</code></strong>.</li><li>And a sub-child of the panel, create a child text element, <strong class="userinput"><code>Create UI</code></strong> | <strong class="userinput"><code>Text</code></strong>, rename it Title.</li><li>Set some default <strong class="userinput"><code>text</code></strong>, like Title title title title.</li><li>For <strong class="userinput"><code>Anchor Presets</code></strong> (the fancy icon in the top-left of the Transform panel), select <strong class="userinput"><code>Stretch</code></strong><strong class="userinput"><code>/</code></strong><strong class="userinput"><code>Stretch</code></strong>, click and also <strong class="userinput"><code>Alt-click</code></strong> it. This will let the text fill the panel area.</li><li><strong class="userinput"><code>Font Size</code></strong>: <code class="literal">80</code>.</li><li><strong class="userinput"><code>Alignment</code></strong>: <strong class="userinput"><code>Middle, Center</code></strong>.</li><li>Set its <strong class="userinput"><code>Horizontal Overflow:</code></strong><code class="literal">Wrap</code>, and <strong class="userinput"><code>Vertical Overflow:</code></strong><code class="literal">Truncate</code>.</li></ol></div><p>Now, we can modify <code class="literal">ArtworkController</code> script to add a new <code class="literal">public Text title</code> variable and set its <code class="literal">text</code> property to the <code class="literal">info.title</code>, as follows:</p><pre class="programlisting">using UnityEngine;
<span class="strong"><strong>using UnityEngine.UI;</strong></span>

public class ArtworkController : MonoBehaviour {

    public GameObject image;
<span class="strong"><strong>    public Text title;</strong></span>

    public void SetArtInfo(ArtInfo info)
    {
        Renderer rend = image.GetComponent&lt;Renderer&gt;();
        Material material = rend.material;
        material.mainTexture = info.image;

<span class="strong"><strong>        title.text = info.title;</strong></span>
    }
}</pre><p>That was easy. Save the script, and then:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag the Title element onto the <strong class="userinput"><code>Text</code></strong> slot</li><li>To save the prefab, make sure the <code class="literal">ArtworkRig</code> itself is selected in the <strong class="userinput"><code>Hierarchy</code></strong>, then press <strong class="userinput"><code>Apply</code></strong></li></ol></div><p>Now when you press <strong class="userinput"><code>Play</code></strong>, the picture <span>images</span><a id="id325577450" class="indexterm"></a> and title text will get initialized on <code class="literal">Start</code> for each of the artwork rigs. Here's one of my photos with a title plaque:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/0c124b4c-aa29-457e-9845-7e0d61285009.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec125"></a>Interactive info details</h3></div></div></div><p>We have more information on each <span>picture</span><a id="id325577476" class="indexterm"></a> that fits on the plaque, so we'll allow the player to click an input controller button to open the detail infobox. Let's create that canvas first, with text for artist and description:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>As a shortcut, duplicate the <strong class="userinput"><code>InfoPlaque</code></strong> and name it <code class="literal">DetailsCanvas</code>.</li><li>Scale and position it, perhaps out front and a slight angle. The following values work for me: <strong class="userinput"><code>Pos</code></strong> (<code class="literal">0.7</code>, <code class="literal">0</code>, <code class="literal">-0.2</code>), <strong class="userinput"><code>Width Height</code></strong> (<code class="literal">1200</code>, <code class="literal">900</code>), <strong class="userinput"><code>Rotation</code></strong> (<code class="literal">0</code>, <code class="literal">15</code>, <code class="literal">0</code>).</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Rename the <strong class="userinput"><code>Title</code></strong> text element to <code class="literal">Description</code>.</li><li>Duplicate <strong class="userinput"><code>Description</code></strong>, rename it <code class="literal">Artist</code>, set to <strong class="userinput"><code>Top Alignment.</code></strong></li><li>Press <strong class="userinput"><code>Apply</code></strong> to save the prefab.</li></ol></div><p>The <code class="literal">ArtworkController</code>  can now populate the details fields too:</p><pre class="programlisting"> public Text artist;
 public Text description;
 public GameObject detailsCanvas;</pre><p>And in the <code class="literal">SetArtInfo</code> function:</p><pre class="programlisting">     artist.text = info.artist;
     description.text = info.description;</pre><p>Then, we'll add an <code class="literal">Update</code> handler to check for user input and display (or hide) the details canvas. And ensure the canvas starts out disabled in <code class="literal">Start</code>.</p><pre class="programlisting">    void Start()
    {
        detailsCanvas.SetActive(false);
    }

    void Update()
    {
        if (Input.GetButtonDown("Fire1"))
        {
            detailsCanvas.SetActive(true);
        }
        if (Input.GetButtonUp("Fire1"))
        {
            detailsCanvas.SetActive(false);
        }
    }</pre><p>For Daydream on Android, you would call <code class="literal">GvrControllerInput.ClickButtonDown</code> and <code class="literal">ClickButtonUp</code>.</p><p>Save the script.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag the <strong class="userinput"><code>Artist</code></strong> and <strong class="userinput"><code>Description</code></strong> elements onto the corresponding slots</li><li>Drag the <strong class="userinput"><code>InfoDetails</code></strong> canvas onto the <strong class="userinput"><code>Details Canvas</code></strong> slot</li><li>Press <strong class="userinput"><code>Apply</code></strong> on the <strong class="userinput"><code>ArtworkRig</code></strong> to save the prefab changes</li></ol></div><p>Now, when you <strong class="userinput"><code>Play</code></strong> and press the Fire1 button on <span>your</span><a id="id325590371" class="indexterm"></a> input controller, the details canvas will show, as follows:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/d3a704c0-8219-4fb5-bfcf-24c99530429e.png" /></div><p>If you would like to implement a different button, such as the finger trigger, or are using a device without a Fire1 mapping (Daydream), please refer to <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Handy Interactables,</em></span> for implementation options and handling input events.</p><p>As implemented, all the details canvases will appear when you press the button. If you want to control one canvas at a time, you could add a UI button to the <strong class="userinput"><code>InfoPlaque</code></strong>, for example, and then use click events on that to trigger the canvas visibility, using gaze-based look and click, or laser pointer &amp; click interactions. Reference <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>World Space UI</em></span>, for implementation ideas.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec126"></a>Adjusting for image aspect ratio</h3></div></div></div><p>You probably noticed that some of <span>your</span><a id="id325594755" class="indexterm"></a> pictures appear squished since our framed image is shown at a fixed size and aspect ratio. What we really would like is for the frame and image to adjust themselves depending on the dimensions of the image.</p><p>When Unity imports a texture, it prepares it (by default) for GPU rendering as an object material texture, which includes resizing it to a square power of two (for example, 1024 x 1024, 2048 x 2048, and so on). If you adapt your project to read images at runtime, for example, from the <span>Resources</span> directory, the device's photo stream, or over the web, then you will have access to the image file's metadata header that includes its pixel width and height. In lieu of that, since we're using imported textures, we can change the Advanced import settings for the images we're using:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From your <strong class="userinput"><code>Assets Photos</code></strong> folder, select an image texture</li><li>In <strong class="userinput"><code>Inspector</code></strong>, under <strong class="userinput"><code>Advanced</code></strong>, change <strong class="userinput"><code>Non Power of 2</code></strong> to <strong class="userinput"><code>None</code></strong></li><li>Press <strong class="userinput"><code>Apply</code></strong></li></ol></div><p>Repeat this for each image in the project. Note that this also decompresses the image, so what might start out as a 400k <code class="literal">.jpg</code> file becomes a 3 MB, 24-bit image in the project, so be cautious of the width and height of the source images you choose to use.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip91"></a>Note</h3><p>Not scaling textures to a power of two is really bad for performance. If you have more than a few images, you should avoid this. One approach would be to add the image aspect ratio as another field of the ArtInfo, and manually set the value in the corresponding scripted objects. Then, change ArtworkController to use this value instead of calculating it. </p></div><p>In <code class="literal"><span>ArtworkController.cs</span></code>, add the following helper function, which returns a normalized scale of a texture. The larger dimension will be <span>1.0</span> and the smaller one will be a fraction. For example, an image that is 1024w x 768h will get a scale of (<span>1.0</span>, <span>0.75</span>). It also maintains the current relative scale of the picture using the Z scale value, since that's not changed by our aspect ratio calculation, but will be changed by the Scale tool!</p><p>Modify <code class="literal">ArtworkController</code> first by adding a private function <code class="literal">TextureToScale</code> which normalizes the image scale to 1.0 for the larger of width or height, and sets the other dimension to the aspect ratio, as follows:</p><pre class="programlisting">    private Vector3 TextureToScale(Texture texture, float depth)
    {
        Vector3 scale = Vector3.one;
        scale.z = depth;
        if (texture.width &gt; texture.height)
        {
            scale.y = (float)texture.height / (float)texture.width;
        } else
        {
            scale.x = (float)texture.width / (float)texture.height;
        }
        return scale;
    }</pre><p>The function also preserves the frame <span>depth</span><a id="id325552713" class="indexterm"></a> in the returned scale vector. Now, we can use this in <code class="literal">SetArtInfo</code> function. Add a new public variable for the <code class="literal">frame</code>:</p><pre class="programlisting">public Transform frame;</pre><p>And then, add this line to set the frame's scale:</p><pre class="programlisting">frame.localScale = TextureToScale(info.image, frame.localScale.z);</pre><p>Save the updates script. Then, in Unity:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag the <strong class="userinput"><code>ArtFrame</code></strong> onto the Frame slot in the component</li><li>Press <strong class="userinput"><code>Apply</code></strong> to save the prefab</li></ol></div><p>Now when you play, the framed images are scaled with the correct aspect ratio, like the one shown here:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/60654d8d-feca-47da-aa19-c35d6612b10f.png" /></div></div></div>