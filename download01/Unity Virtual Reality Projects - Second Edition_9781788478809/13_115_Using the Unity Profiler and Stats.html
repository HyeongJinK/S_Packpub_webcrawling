<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch13lvl1sec111"></a>Using the Unity Profiler and Stats</h2></div></div><hr /></div><p>Optimizing can be a lot of work, and there is a learning curve to <span>get</span><a id="id325552060" class="indexterm"></a> the hang of it. The good <span>news</span><a id="id325567250" class="indexterm"></a> is that it can be accomplished incrementally. Tackle the more obvious, bigger bang-for-the-buck things first. You can accomplish a lot with little or no visual degradation after a bit of experimentation.</p><p>The Unity <strong class="userinput"><code>Editor</code></strong> includes two built-in tools to assess performance: the <strong class="userinput"><code>Stats</code></strong> window and the <strong class="userinput"><code>Profiler</code></strong> window.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec185"></a>The Stats window</h3></div></div></div><p>The <strong class="userinput"><code>Stats</code></strong> window <span>shows</span><a id="id325567592" class="indexterm"></a> real-time rendering statistics when you press <strong class="userinput"><code>Play</code></strong> in the Unity Editor. Reviewing and understanding these statistics is your first line in evaluating and improving the performance of your app, and can help you decide which optimization strategies, including those covered in this chapter, to tackle first.</p><p>In the <strong class="userinput"><code>Game</code></strong> window, enable <strong class="userinput"><code>Stats</code></strong> by pressing the <strong class="userinput"><code>Stats</code></strong> button. A screenshot is shown here:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/4744a608-acf9-4950-beae-08c691815914.png" /></div><p>The actual statistics displayed will vary depending on your <span>current</span><a id="id325572782" class="indexterm"></a> build target (see <a class="ulink" href="http://docs.unity3d.com/Manual/RenderingStatistics.html" target="_blank"><span>http://docs.unity3d.com/Manual/RenderingStatistics.html</span></a>), including:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Graphics FPS (frames per seconds) and time per frame</li><li style="list-style-type: disc">CPU time per frame</li><li style="list-style-type: disc">Tris (triangles)/Verts (vertices)</li><li style="list-style-type: disc">Batches</li></ul></div><p>In VR, you want to pay close attention to the frames per second. The minimum acceptable rate varies depending on your target device, but generally for desktop devices you should keep it at or above 90 FPS, while 60 FPS (or 75 FPS) is considered an absolute minimum. The Sony PlayStation VR accepts 60 FPS but uses hardware to automatically double the rate to 120 FPS to compensate. Windows Mixed Reality HMD will throttle the frame rate between 90 and 60 depending on the graphics processor hardware on your computer, allowing laptops with slower mobile GPU to run VR. Phone-based mobile VR devices can target 60 FPS.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note126"></a>Note</h3><p>When in Editor <strong class="userinput"><code>Play</code></strong> mode, the FPS is not necessarily the same as you'd experience running a built executable in your device, so it should be used as an indicator, not necessarily an actual value. But, thankfully, it does not include any editor-only processing such as drawing the <strong class="userinput"><code>Scene</code></strong> view.</p></div><p>Examining the <strong class="userinput"><code>CPU</code></strong> time per frame and comparing that with the overall graphics time per frame will tell you whether your game is CPU bound or GPU bound. That is, which process is the bottleneck, slowing you down the most. The CPU is used for physics calculations, geometry culling, and other operations that prepare the data for rendering in the GPU. The GPU runs the shaders and actually generates the pixel values for display. Knowing if you're CPU or GPU bound can help dictate where to focus your optimization efforts to improve your game performance. </p><p>The <strong class="userinput"><code>Tris</code></strong> (triangles) and <strong class="userinput"><code>Verts</code></strong> (vertices) values show the size of your geometric models' meshes that are drawn. Only the visible faces of your meshes are counted, so your scene could include much more.  That is, the values in <strong class="userinput"><code>Stats</code></strong> are the geometry the camera is looking at, not including any vertices outside the view, and after any occluded surfaces have been removed. As you move the camera or as objects in the scene move, the numbers will change. As we'll see in the next topic, reducing the poly count of your models can lead to significant gains in performance.</p><p>The <strong class="userinput"><code>Batches</code></strong> value is an indicator of how hard your GPU is working. The more batches, the more rendering the GPU must perform each frame. The number of batches, not the size of a batch, is the bottleneck. You can reduce batches by reducing the geometry in your scene. Since it's faster to have fewer (albeit larger) batches than lots of small ones, you can tell Unity to optimize the graphics by combining more geometry into larger batches, and pump that through the GPU pipeline.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip127"></a>Note</h3><p>When profiling and optimizing, write down (or take screenshots of) the stats and label them, perhaps in a spreadsheet, to log your progress and measure the effectiveness of each technique that you try.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec186"></a>Overview of the Profiler</h3></div></div></div><p>The Unity <strong class="userinput"><code>Profiler</code></strong> is a performance instrumentation tool that reports how much <span>processing</span><a id="id325577433" class="indexterm"></a> time is spent in various areas of your game, including rendering and scripts. It records the statistics over time during gameplay and shows them in a timeline graph. Clicking lets you drill down into the details. See <a class="ulink" href="http://docs.unity3d.com/Manual/Profiler.html" target="_blank"><span>http://docs.unity3d.com/Manual/Profiler.html</span></a> and the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/1e116a2d-ee00-4bfb-af01-77b462dd5f0b.png" /></div><p>The <strong class="userinput"><code>Profiler</code></strong> compacts a lot of information into a small space, so you should recognize its various parts to understand better what you're seeing. Along the top of the window is the Profiler controls toolbar, which enables you to turn profiling on and off (<strong class="userinput"><code>Record</code></strong>) and navigate through profiled frames. The white vertical line in the profile Tracks is the playhead, indicating the <span>current</span><a id="id325577464" class="indexterm"></a> frame being examined.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note128"></a>Note</h3><p>The <strong class="userinput"><code>Deep Profile</code></strong> button lets you drill down into more detail, recording all function calls in your scripts. This can be useful to see exactly where time is spent in your game code. Note that deep profiling incurs a lot of overhead and causes your game to run very slowly.</p></div><p>Underneath the toolbar are the profile tracks. Scroll down the Tracks pane to reveal more.  You can add and remove tracks using the <strong class="userinput"><code>Add Profiler</code></strong> select list. </p><p>Each track includes stats for many parameters pertaining to that category of processing. For example, <strong class="userinput"><code>CPU Usage</code></strong> includes <strong class="userinput"><code>Scripts</code></strong> and <strong class="userinput"><code>Physics</code></strong>; the <strong class="userinput"><code>Rendering</code></strong> one include <strong class="userinput"><code>Batches</code></strong> and <strong class="userinput"><code>Triangles</code></strong>. The visual graph allows you to readily detect anomalies. When troubleshooting, look for stretches and spikes where the data exceeds your expected thresholds. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip129"></a>Note</h3><p>You can profile your game running in the Unity Editor, or remote profile your game running <span>in a separate player</span>, such as a mobile device.</p></div></div></div>