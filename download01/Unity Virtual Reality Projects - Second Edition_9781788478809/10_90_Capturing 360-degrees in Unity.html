<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec89"></a>Capturing 360-degrees in Unity</h2></div></div><hr /></div><p>We've talked about using 360-degree <span>media</span><a id="id325552311" class="indexterm"></a> captured using 360 cameras. But what if you wanted to capture a 360 image or video from within your Unity app and share it on the internet? This could be useful for marketing and promoting your VR apps, or just simply using Unity as a content generation tool but using 360 video as the final distribution medium.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec144"></a>Capturing cubemaps and reflection probes</h3></div></div></div><p>Unity includes support for <span>capturing</span><a id="id325552326" class="indexterm"></a> scene views as part of its <span>lighting</span><a id="id325552334" class="indexterm"></a> engine. A call to <code class="literal">camera.RenderToCubemap()</code> will bake a static cubemap of your scene, using the camera's current position and other settings.</p><p>The example script given in the Unity documentation,  <a class="ulink" href="https://docs.unity3d.com/Documentation/ScriptReference/Camera.RenderToCubemap.html" target="_blank">https://docs.unity3d.com/Documentation/ScriptReference/Camera.RenderToCubemap.html</a>, implements an editor wizard for <span>capturing</span><a id="id325552353" class="indexterm"></a> a cubemap of your scene directly in the Editor, and is included here:</p><pre class="programlisting">using UnityEngine;
using UnityEditor;
using System.Collections;

public class RenderCubemapWizard : ScriptableWizard
{
    public Transform renderFromPosition;
    public Cubemap cubemap;

    void OnWizardUpdate()
    {
        string helpString = "Select transform to render from and cubemap to render into";
        bool isValid = (renderFromPosition != null) &amp;&amp; (cubemap != null);
    }

    void OnWizardCreate()
    {
        // create temporary camera for rendering
        GameObject go = new GameObject("CubemapCamera");
        go.AddComponent&lt;Camera&gt;();
        // place it on the object
        go.transform.position = renderFromPosition.position;
        go.transform.rotation = Quaternion.identity;
        // render into cubemap
        go.GetComponent&lt;Camera&gt;().RenderToCubemap(cubemap);

        // destroy temporary camera
        DestroyImmediate(go);
    }

    [MenuItem("GameObject/Render into Cubemap")]
    static void RenderCubemap()
    {
        ScriptableWizard.DisplayWizard&lt;RenderCubemapWizard&gt;(
            "Render cubemap", "Render!");
    }
}</pre><p>To run the wizard:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create an <strong class="userinput"><code>Empty</code></strong> game object for the camera position to capture from</li><li>Create a cubemap to render into (<strong class="userinput"><code>Assets | Create | Legacy | Cubemap</code></strong>)</li><li>Set <strong class="userinput"><code>Face size</code></strong> to a high resolution, such as <code class="literal">2048</code></li><li>Check the <strong class="userinput"><code>Readable</code></strong> checkbox</li><li>Run the wizard (<strong class="userinput"><code>GameObject | Render into Cubemap</code></strong>)</li><li>Drag the position object into the <strong class="userinput"><code>Render From Position</code></strong> slot</li><li>Drag cubemap into the <strong class="userinput"><code>Cubemap</code></strong> slot</li><li>Press <strong class="userinput"><code>Render!</code></strong></li></ol></div><p>This <code class="literal">.cubemap</code> file can now be used in a Skybox Cubemap material.</p><p>A similar but different approach is to use <span>Reflection</span><a id="id325577482" class="indexterm"></a> probes. They're normally used by objects with reflective materials to render realistic surface reflections (see <a class="ulink" href="https://docs.unity3d.com/Manual/class-ReflectionProbe.html" target="_blank">https://docs.unity3d.com/Manual/class-ReflectionProbe.html</a>). A reflection probe captures a spherical view of its surroundings and is then stored as a cubemap. Scene designers will strategically place multiple reflection probes in a scene to provide more realistic rendering. You can repurpose a reflection probe as a 360 image capture of your scene! Since they're intended for reflection lighting, they're usually low resolution.</p><p>Unity chooses where to store the reflection probe lightmap file (<code class="literal">.exr</code>) depending on your lighting settings. To save it under your<span class="emphasis"><em>Assets</em></span>folder (rather than the GI cache), go to the<strong class="userinput"><code>Lighting</code></strong>tab, disable<strong class="userinput"><code>Realtime Global Illumination</code></strong>, and disable<strong class="userinput"><code>Auto Generate</code></strong>. This will generate the refection probe <code class="literal">.exr</code> file in a folder with the same name as your scene.</p><p>Try adding one to your scene by navigating to <strong class="userinput"><code>GameObject | Light | Reflection Probe</code></strong>. Set <strong class="userinput"><code>Resolution</code></strong> to a high value, like <code class="literal">2048</code>. Then, press <strong class="userinput"><code>Bake</code></strong>.  You can then assign this <code class="literal">.exr</code> file to a Skybox Cubemap material, making a quick and easy 360 scene-shot.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec145"></a>Using a third-party package for 360 image capture</h3></div></div></div><p>There are a number of <span>packages</span><a id="id325577731" class="indexterm"></a> that provide the ability to capture <span>360</span><a id="id325577739" class="indexterm"></a> images and video in Unity, including:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">360 <span>Panorama</span><a id="id325577753" class="indexterm"></a> Capture from eVRydayVR (free) (<a class="ulink" href="https://assetstore.unity.com/packages/tools/camera/360-panorama-capture-38755" target="_blank">https://assetstore.unity.com/packages/tools/camera/360-panorama-capture-38755</a>)</li><li style="list-style-type: disc">VR Panorama 360 PRO from OliVR ($49) (<a class="ulink" href="https://assetstore.unity.com/packages/tools/video/vr-panorama-360-pro-renderer-35102" target="_blank">https://assetstore.unity.com/packages/tools/video/vr-panorama-360-pro-renderer-35102</a>)</li><li style="list-style-type: disc">Oculus 360-Capture-SDK (free), includes a <span>sample</span><a id="id325581604" class="indexterm"></a> Unity project (<a class="ulink" href="https://github.com/facebook/360-Capture-SDK" target="_blank">https://github.com/facebook/360-Capture-SDK</a>)</li></ul></div><p>Each of these packages support mono and stereoscopic capture, sequenced captures for video encoding, and possibly other features for color conversion, antialiasing, camera image effects, and 3D spatialized audio.</p><p>Using the  360 Panorama Capture script from eVRydayVR, for example, to capture a single 360 image, open a scene you want to capture, then:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create an <strong class="userinput"><code>Empty</code></strong> game object, named <code class="literal">CapturePanorama</code>, positioned where you want to make the capture</li><li>Add the <strong class="userinput"><code>Capture Panorama</code></strong> script as a component</li><li>Press <strong class="userinput"><code>Play</code></strong>, then press <span class="emphasis"><em>P</em></span> on the keyboard</li></ol></div><p>The screen will fade to black, and an image will be captured and saved to your project root directory. The component options are shown here:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/66dc9a24-1c99-4266-b4b9-a72c432801a8.png" /></div><p></p><p>To capture video, you would enable the<strong class="userinput"><code>Capture Every Frame</code></strong>checkbox. It recommends the open source<span class="emphasis"><em>ffmpeg</em></span>tool (<a class="ulink" href="https://www.ffmpeg.org/" target="_blank">https://www.ffmpeg.org/</a>) to assemble the frames and encode the video. See the README file for details.</p><p>Of course, this component can also be controlled via scripts, and can be built into your runtime game, not just used in the Editor.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec146"></a>Unity built-in stereo 360 image and video capture </h3></div></div></div><p>As of Unity 2018.1, Unity includes an <span>integrated</span><a id="id325581710" class="indexterm"></a> stereo 360 image and video <span>capture</span><a id="id325581719" class="indexterm"></a> capability. The feature is based on Google's omni-directional stereo (ODS), described at the beginning of this chapter. Details in this section summarize the Unity Blogs post from January, 2018 (<a class="ulink" href="https://blogs.unity3d.com/2018/01/26/stereo-360-image-and-video-capture/" target="_blank">https://blogs.unity3d.com/2018/01/26/stereo-360-image-and-video-capture/</a>), which explains how to capture ODS stereo cubemaps and convert them to stereo equirectangular textures.</p><p>To capture a scene in Editor or standalone player, call <code class="literal">camera.RenderToCubemap()</code> once per eye. We used this function earlier; there is a variant that takes a <code class="literal">stereoEye</code> parameter, for example:</p><pre class="programlisting">camera.stereoSeparation = 0.064; // Eye separation (IPD) of 64mm.
camera.RenderToCubemap(cubemapLeftEye, 63, 
        Camera.MonoOrStereoscopicEye.Left);
camera.RenderToCubemap(cubemapRightEye, 63,
        Camera.MonoOrStereoscopicEye.Right);</pre><p>To convert cubemaps to stereo equirectangular maps, call <code class="literal">RenderTexture.ConvertToEquirect()</code> as follows:</p><pre class="programlisting">cubemapLeftEye.ConvertToEquirect(equirect, 
        Camera.MonoOrStereoscopicEye.Left);
cubemapRightEye.ConvertToEquirect(equirect, 
        Camera.MonoOrStereoscopicEye.Right);</pre><p>Using the Unity <span>frame</span><a id="id325586494" class="indexterm"></a> recorder (<a class="ulink" href="https://github.com/Unity-Technologies/GenericFrameRecorder" target="_blank">https://github.com/Unity-Technologies/GenericFrameRecorder</a>), a sequence of these images can be captured as frames of a stereo 360 video.</p><p>To capture in the PC standalone build, you need to enable the <strong class="userinput"><code>360 Stereo Capture</code></strong> in the <strong class="userinput"><code>Build Settings</code></strong>, as shown here, so Unity generates the shader variants required by this feature:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/a17ce1e5-058c-4520-8c9d-573a0cba74c8.jpg" /></div><p>Here is an example of a resulting stereo equirectangular video capture (from the Unity blog, <a class="ulink" href="https://blogs.unity3d.com/wp-content/uploads/2018/01/image5-2.gif" target="_blank">https://blogs.unity3d.com/wp-content/uploads/2018/01/image5-2.gif</a>): </p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/985471c4-7a8e-4011-b142-0d39723a386a.jpg" /></div></div></div>