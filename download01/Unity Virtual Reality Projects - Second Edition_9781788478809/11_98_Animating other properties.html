<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec96"></a>Animating other properties</h2></div></div><hr /></div><p>In our story, we want the lighting to start at night and progress through <span>dawn</span><a id="id325317274" class="indexterm"></a> to daylight. We'll do it by manipulating the Directional Light, Skybox Material, and a Spot Light.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec152"></a>Animating lights</h3></div></div></div><p>For dramatic effect, let's <span>make</span><a id="id325317289" class="indexterm"></a> the scene slowly fade from night to daytime. We will turn off the Directional Light at the start and slowly increase its Intensity:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select <code class="literal">BlackbirdController</code> in <strong class="userinput"><code>Hierarchy</code></strong> and open the <strong class="userinput"><code>Timeline Editor</code></strong> window</li><li>Drag the <code class="literal">Directional Light</code> object from <strong class="userinput"><code>Hierarchy</code></strong> onto the <strong class="userinput"><code>Timeline</code></strong></li><li>Press its <strong class="userinput"><code>Record</code></strong> button</li><li>Ensure the <strong class="userinput"><code>Playhead</code></strong> is at <code class="literal">0:00</code></li><li>Select the <code class="literal">Directional Light</code> in <strong class="userinput"><code>Hierarchy</code></strong> and change its <strong class="userinput"><code>Intensity</code></strong> parameter to <code class="literal">0</code></li><li>Move the <strong class="userinput"><code>Playhead</code></strong> to the <code class="literal">40:00</code> second mark</li><li>Set the <strong class="userinput"><code>Intensity</code></strong> to <code class="literal">1</code></li></ol></div><p>The Directional Light's Animation Track with the Intensity parameter curve is shown here:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/09fc11b1-f8e6-46da-bdc5-712e7c57684a.png" /></div><p>Other parameters of the light could also be animated, including its Color and the Transform Rotation angles. Just imagine the possibilities!</p><p>Let's also add a Point Light. For dramatic effect, position it at the same location as the Nest resting position. This will illuminate the baby tree at first, and focus the user's attention on the egg in the nest once the nest settles onto the ground:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><strong class="userinput"><code>Create | Light | Point Light</code></strong></li><li>In <strong class="userinput"><code>Scene</code></strong> view, use the <strong class="userinput"><code>Move Tool</code></strong> gizmo to position it inside the Nest at the Nest's ground position</li><li>Select <code class="literal">BlackbirdDirector</code> and open the <strong class="userinput"><code>Timeline Editor</code></strong></li><li>Drag the <code class="literal">Point Light</code> onto the <strong class="userinput"><code>Timeline Editor</code></strong></li><li>Choose <strong class="userinput"><code>Activation Track</code></strong></li><li>Enable the light from <code class="literal">0</code>s to about <code class="literal">95</code>s, sometime after the egg hatches</li></ol></div><p>Things are looking pretty good!</p><p>Our Timeline is starting to get a little crowded. Let's move the <span>lights</span><a id="id325552496" class="indexterm"></a> into a <strong class="userinput"><code>Track Group</code></strong>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In <strong class="userinput"><code>Timeline</code></strong>, choose <strong class="userinput"><code>Add | Track Group</code></strong></li><li>Click its label and name it "Lights"</li><li>Drag each of the light tracks into the group</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip111"></a>Note</h3><p>Use Group Tracks to organize your Timeline in a nested tree structure</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec153"></a>Animating a scripted component property</h3></div></div></div><p>As we're seeing, you can animate just <span>about</span><a id="id325560698" class="indexterm"></a> any GameObject property that you can modify in the Inspector. This includes your own C# script component's serialized properties. </p><p>We want to fade the environmental lighting from night to day. There are several ways to achieve this (see the discussion of photospheres in the previous chapter). We've decided to do it by modifying the Skybox Material's Exposure value (o is off, 1 is all the way on). But Timeline can only animate GameObject properties, and this is not one. So what we'll do is create an empty LightingController GameObject and write a script that controls the Skybox Material.</p><p>Let's add our own Skybox Material to the scene. You can use any skybox texture you like. We will grab one from the WispySkybox package, <code class="literal">WispyCubemap2</code>, that we imported earlier:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a new <strong class="userinput"><code>Material</code></strong> (<strong class="userinput"><code>Assets | Create | Material</code></strong>), name it <code class="literal">BlackbirdSkyMaterial</code></li><li>In <strong class="userinput"><code>Inspector</code></strong>, for its <strong class="userinput"><code>Shader</code></strong>, select <strong class="userinput"><code>Skybox/Cubemap</code></strong></li><li>Click <strong class="userinput"><code>Select</code></strong> in its <strong class="userinput"><code>Cubemap</code></strong> texture chip, and select <code class="literal">WispyCubemap2</code></li><li>Open the <strong class="userinput"><code>Lighting</code></strong> window (if not already in the Editor, choose <strong class="userinput"><code>Window | Lighting | Settings</code></strong>)</li><li>Drag the <code class="literal">BlackbirdSkyMaterial</code> from <strong class="userinput"><code>Project Assets</code></strong> onto the <strong class="userinput"><code>Skybox Material</code></strong> slot</li><li>Uncheck the <strong class="userinput"><code>Mixed Lighting Baked Global Illumination</code></strong> checkbox</li></ol></div><p>We don't want to bake any of the environment lighting since we're going to modify its settings at runtime.</p><p>Selecting the <code class="literal">BlackbirdSkyMaterial</code> again, see what happens when you slide the <strong class="userinput"><code>Exposure</code></strong> value between <code class="literal">1</code> and <code class="literal">0</code>. It <span>fades</span> the brightness of the skybox. We will animate this value to modify the ambient light in our scene. But Animations can only modify GameObject parameters, so we'll write a script:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a new C# script and name it <code class="literal">SkyboxMaterialExposureControl</code><span>.</span></li><li>Open the script and write it as follows<span>:</span></li></ol></div><pre class="programlisting">public class SkyboxMaterialExposureControl : MonoBehaviour
{
    public Material skyboxMaterial;
    public float exp = 1.0f;

    private void Update()
    {
        SetExposure(exp);
    }

    public void SetExposure(float value)
    {
        skyboxMaterial.SetFloat("_Exposure", value);
    }
}</pre><p>Save the file. In Unity, lets make a LightingController object that uses the script as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li> Create a <strong class="userinput"><code>Empty</code></strong> object in <strong class="userinput"><code>Hierarchy</code></strong>, named "LightingController"</li><li>Add the <code class="literal">SkyboxMaterialExposureControl</code> to this object</li><li>Drag the <code class="literal">BlackbirdSkyMaterial</code> onto its <strong class="userinput"><code>Skybox Material</code></strong> slot</li></ol></div><p>Now, let's animate this parameter:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select <code class="literal">BlackbirdController</code> in <strong class="userinput"><code>Hierarchy</code></strong> and open the <strong class="userinput"><code>Timeline Editor</code></strong> window</li><li>Drag the <code class="literal">LightingController</code> object from <strong class="userinput"><code>Hierarchy</code></strong> onto the <strong class="userinput"><code>Timeline</code></strong></li><li>Press its <strong class="userinput"><code>Record</code></strong> button</li><li>Ensure the <strong class="userinput"><code>Playhead</code></strong> is at <code class="literal">0:00</code></li><li>Select the <code class="literal">LightingController</code> in <strong class="userinput"><code>Hierarchy</code></strong>, and change its <strong class="userinput"><code>Exp</code></strong> parameter to <code class="literal">0</code></li><li>Move the <strong class="userinput"><code>Playhead</code></strong> to the <code class="literal">100:00</code> second mark</li><li>Set the <strong class="userinput"><code>Exp</code></strong> to <code class="literal">1</code></li></ol></div><p>The Timeline Editor window with a <strong class="userinput"><code>SkyboxMaterialExposureControl</code></strong> track is shown here:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/ebb7c31d-f2ba-4a1c-bc5f-d37bb16f42dd.png" /></div><p>Press <strong class="userinput"><code>Play</code></strong>, and the scene lighting will fade from night to day as the skybox material's Exposure animates from 0 to 1. (Note it's not available in the Timeline preview Play, just the Editor Play). Here is a screenshot of the scene playing at <span>about</span><a id="id325552538" class="indexterm"></a> 45 seconds:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/68117089-3296-483b-a690-6856cae5959d.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec154"></a>Controlling particle systems</h3></div></div></div><p>You could continue to <span>improve</span><a id="id325552563" class="indexterm"></a> the scene with other effects. We'd like to include falling leaves, which can be implemented using particle systems and played using a <strong class="userinput"><code>Control Track</code></strong>. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note112"></a>Note</h3><p>Unfortunately, we cannot recommend a specific free "falling leaves" asset as all the ones we found in the Asset Store are paid ones. There's an out-of-date free Sky FX package (<a class="ulink" href="https://assetstore.unity.com/packages/vfx/particles/environment/sky-fx-pack-19242" target="_blank">https://assetstore.unity.com/packages/vfx/particles/environment/sky-fx-pack-19242</a>), from which we borrowed the textures and made our own particle system prefab, included with this book.</p></div><p>Assuming you have a FallingLeaves particle system, we can add it to the project now:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag a copy of the <code class="literal">FallingLeaves</code> prefab into the scene.</li><li>In the <strong class="userinput"><code>Timeline Editor</code></strong> window (with <code class="literal">BlackbirdDirector</code> selected), click <strong class="userinput"><code>Add</code></strong> and choose <strong class="userinput"><code>Control Track.</code></strong></li><li>In the Control Track's menu icon, choose <strong class="userinput"><code><strong class="userinput"><code>Add Control Playable Asset Clip.</code></strong></code></strong></li><li>This creates a small rectangle for the clip on the track. Select it.</li><li>In <strong class="userinput"><code>Inspector</code></strong>, drag the <code class="literal">FallingLeaves</code> game object from <strong class="userinput"><code>Hierarchy</code></strong> onto the <strong class="userinput"><code>Source Game Object</code></strong> slot.</li><li>Going back to the Timeline window, grab and slide the rectangle to the 120-second position, then stretch its right edge to the end of the timeline (165s).
</li></ol></div><p>The playable asset's <strong class="userinput"><code>Inspector</code></strong> is shown here:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/0435f06f-ba85-41ab-9f35-786374d236e5.png" /></div><p>And the Timeline with this <strong class="userinput"><code>Control Track</code></strong> is as follows:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/d1d99725-2f9c-431d-990e-eed6b0b7204b.png" /></div><p>Likewise, if you have multiple Timelines in a scene, you can control them from another Timeline using a Control Track (via game objects with <code class="literal">PlayableDirector</code> components).  In our app, we're using a single Timeline, with<strong class="userinput"><code>Play On Awake</code></strong>, so it starts at the beginning of the app and plays through. However, with multiple Timelines in a scene, you can play them on demand.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note113"></a>Note</h3><p>You can write your own custom Timeline track classes too. For example, using a Control Track for playing Particle Systems is limited. Here (<a class="ulink" href="https://github.com/keijiro/TimelineParticleControl" target="_blank">https://github.com/keijiro/TimelineParticleControl</a>) is a custom track class, <code class="literal">ParticleSystemControlTrack</code>, that offers control of emission rate, velocity, and other functionality. And if you look into their <code class="literal">.cs</code> code, it provides a good example of how to write a custom track class. </p></div><p>Separate Animation Clips are another Playable asset you can add and sequence in Timeline tracks. We look at that next.</p></div></div>