<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch13lvl1sec116"></a>Runtime performance and debugging</h2></div></div><hr /></div><p>Graphics hardware architectures continue to <span>evolve</span><a id="id325317274" class="indexterm"></a> towards performance that <span>benefits</span><a id="id325317281" class="indexterm"></a> rendering pipelines of virtual reality (and augmented reality). VR introduces requirements that weren't so important for traditional video gaming. Latency and dropped frames (where rendering a frame takes longer than the refresh rate) took a back seat to high-fidelity AAA rendering capabilities. VR needs to render each frame in time and do it twice: once for each eye. Driven by the requirements of this emerging industry, semiconductor and hardware manufacturers are building new and improved devices, which will inevitably impact how content developers think about optimization.</p><p>That said, most likely you should develop and optimize for the lower specs that you want to target. If such optimizations necessitate undesirable compromises, consider separate versions of the game for high- versus low-end platforms. VR device manufacturers have started publishing minimum/recommended hardware specifications, which take much of the guesswork out of it. Start with the recommended Unity settings of your target device and adjust as needed. </p><p>For instance, for mobile VR, it is recommended that you tune for CPU-bound rather than GPU-bound usage. Some games will make the CPU work harder, others will impact the GPU. Normally, you should favor CPU over GPU. The Oculus Mobile SDK (GearVR) has an API that is used to throttle the CPU and GPU to control heat and battery drain.</p><p>Running in the editor is not the same as running on a mobile device. But, you can still use the Profiler while running in the device.</p><p>It can be useful to have a developer <span>mode</span><a id="id325317296" class="indexterm"></a> in your app that shows a heads up display (HUD) with current <span class="strong"><strong>frames per second</strong></span> (<span class="strong"><strong>FPS</strong></span>) and other vital statistics at runtime. To make your how FPS HUD display, add a UI Canvas to your scene with a child Text object. The following script updates the text string with the FPS value:</p><pre class="programlisting">public class FramesPerSecondText : MonoBehaviour
{
    private float updateInterval = 0.5f;
    private int framesCount;
    private float famesTime;
    private Text text;

    void Start()
    {
        text = GetComponent&lt;Text&gt;();
    }

    void Update()
    {
        framesCount++;
        framesTime += Time.unscaledDeltaTime;
        if (framesTime &gt; updateInterval)
        {
            float fps = framesCount / framesTime;
            text.text = string.Format("{0:F2} FPS", fps);
            framesCount = 0;
            framesTime = 0;
        }
    }
}</pre><p>Some VR devices also provide their own tools, which we will look at next.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec200"></a>Daydream</h3></div></div></div><p><span>Daydream</span><a id="id325317322" class="indexterm"></a> developer options include the <code class="literal">GvrInstalPreviewMain</code> prefab that lets you use your <span>Daydream</span><a id="id325547517" class="indexterm"></a> device with the Unity Editor Play mode.</p><p>The <span class="emphasis"><em>Daydream Performance HUD</em></span> (<a class="ulink" href="https://developers.google.com/vr/develop/unity/perfhud" target="_blank">https://developers.google.com/vr/develop/unity/perfhud</a>) is built into Android. To enable it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Launch the Daydream application on your phone</li><li>Tap the gear icon on the top right of the screen </li><li>Tab <strong class="userinput"><code>Build Version</code></strong> six times to make the <strong class="userinput"><code>Developer Options</code></strong> item appear</li><li>Select <strong class="userinput"><code>Developer Options | Enable performance heads-up display</code></strong></li></ol></div><p>Then, run a VR app and you will see the performance overlay.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec201"></a>Oculus</h3></div></div></div><p><span>Oculus</span><a id="id325552084" class="indexterm"></a> offers a suite of performance analysis and optimization tools (<a class="ulink" href="https://developer.oculus.com/documentation/pcsdk/latest/concepts/dg-performance/" target="_blank">https://developer.oculus.com/documentation/pcsdk/latest/concepts/dg-performance/</a>), which includes extensive documentation and a workflow guide for developers. Good stuff! It also includes an Oculus Debug Tool, Lost Frame Capture Tool, Performance Profiler, and a Performance Head-Up Display (<a class="ulink" href="https://developer.oculus.com/documentation/pcsdk/latest/concepts/dg-hud/" target="_blank">https://developer.oculus.com/documentation/pcsdk/latest/concepts/dg-hud/</a>).</p><p>To activate the Performance Head-Up Display, you run it from the Oculus Debug Tool as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to <code class="literal">Program Files\Oculus\Support\oculus-diagnostics\</code>.</li><li>Double-click <code class="literal">OculusDebugTool.exe</code>.</li><li><span>They</span> recommend you first turn off Asynchronous Spacewarp (ASW) to get a <span>good</span><a id="id325552125" class="indexterm"></a> sense of your app's performance without ASW. Find <strong class="userinput"><code>Asynchronous Spacewarp</code></strong> and choose <strong class="userinput"><code>Disabled</code></strong> from the select list.</li><li>Find <strong class="userinput"><code>Visible HUD</code></strong> and choose the type you'd like to see: <strong class="userinput"><code>Performance</code></strong>, <strong class="userinput"><code>Stereo Debug</code></strong>, <strong class="userinput"><code>Layer</code></strong>, or <strong class="userinput"><code>None</code></strong>.</li></ol></div></div></div>