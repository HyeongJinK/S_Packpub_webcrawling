<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec37"></a>Ethan, the walker</h2></div></div><hr /></div><p>Gaming is a common application of virtual reality. So, we <span>might</span><a id="id325547516" class="indexterm"></a> as well start out from there, too! We are going to give our character, Ethan, a life of his own. Well, sort of (or not), because he's going to become a zombie!</p><p>We left off at the diorama, with Ethan hanging out. You can make him run around the scene if you have a hand controller with a thumbstick or touchpad, but that is not guaranteed on some VR devices. In fact, if you're viewing the scene with a Google Cardboard, it's pretty unlikely that you'll have a handheld controller (notwithstanding the Bluetooth game controllers). In the next chapter, <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Handy Interactables</em></span>, we will go into handheld input controllers. For now, we will consider another way to make him move around, using the direction of your gaze while wearing your VR headset.</p><p>Before we attempt this, we'll first transform Ethan into a zombie and have him walk around aimlessly without any user control. We'll do this by giving him some AI and writing a script that sends him to random target locations.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip35"></a>Note</h3><p><span class="emphasis"><em>AI controllers</em></span> and <span class="emphasis"><em>N</em></span><span><span class="emphasis"><em>avMesh</em></span></span> are somewhat advanced topics in Unity, but we're going to throw you into it just for fun. Besides, it's not as scary as zombies.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec56"></a>Artificially intelligent Ethan</h3></div></div></div><p>To start, we want to replace the <code class="literal">ThirdPersonController</code> prefab <span>that</span><a id="id325578265" class="indexterm"></a> we used initially with Unity's AI character, <code class="literal">AIThirdPersonController</code>, using the following steps. Unity uses the word <span class="emphasis"><em>artificial intelligence</em></span> loosely to mean <span class="emphasis"><em>script-driven</em></span>. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the Unity project from the previous chapters with the <code class="literal">Diorama</code> scene, and have the <code class="literal">Characters</code> package imported from <code class="literal">Standard Assets</code>.</li><li>In the <strong class="userinput"><code>Project</code></strong> panel, open the <code class="literal">Standard Assets/Characters/ThirdPersonCharacter/Prefabs</code> folder and drag <code class="literal">AIThirdPersonController</code> into the scene. Name it <code class="literal">Ethan</code>.</li><li>In the <strong class="userinput"><code>Hierarchy</code></strong> panel (or in <strong class="userinput"><code>Scene</code></strong>), select the previous <code class="literal">ThirdPersonController</code>, (the old Ethan). Then, in the <strong class="userinput"><code>Inspector</code></strong> panel's <strong class="userinput"><code>Transform</code></strong> pane, choose the <span class="emphasis"><em>gear</em></span> icon on the upper right of the <strong class="userinput"><code>Transform</code></strong> pane and select <strong class="userinput"><code>Copy Component</code></strong>.</li><li>Select the new <code class="literal">Ethan</code> object (from the <strong class="userinput"><code>Hierarchy</code></strong> panel or <strong class="userinput"><code>Scene</code></strong>). Then, in the <strong class="userinput"><code>Inspector</code></strong> panel's <strong class="userinput"><code>Transform</code></strong> pane, choose the <span class="emphasis"><em>gear</em></span> icon and select <strong class="userinput"><code>Paste Component Values</code></strong>.</li><li>Now, you can delete the old <code class="literal">Ethan</code> object by selecting it from the <strong class="userinput"><code>Hierarchy</code></strong> panel, right-clicking to open options, and clicking on <strong class="userinput"><code>Delete</code></strong>.
</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip36"></a>Note</h3><p>If you cannot find the <code class="literal">Characters</code> package to import, you may not have installed <code class="literal">Standard Assets</code> when you installed Unity. To get them now, you will need to run the <code class="literal">UnityDownloadAssistant</code> again as described at the beginning of <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Content, Objects, and Scale</em></span> (and it may already be in your Downloads folder).</p></div><p>Note that this controller has a <code class="literal">NavMesh Agent</code> component and an <code class="literal">AICharacterControl</code> script. The NavMesh Agent has parameters for how Ethan will move around the scene. The <code class="literal">AICharacterControl</code> script takes a target object where Ethan will walk to. Let's populate that, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Add an empty game object to the <strong class="userinput"><code>Hierarchy</code></strong> panel, and rename it <code class="literal">WalkTarget</code>.</li><li>Reset its <strong class="userinput"><code>Transform</code></strong> values to position (<code class="literal">0</code>,<code class="literal">0</code>,<code class="literal">0</code>) (using the gear icon in upper-right of the Transform pane).</li><li>Select Ethan and drag <code class="literal">WalkTarget</code> into the <strong class="userinput"><code>Target</code></strong> property in the <strong class="userinput"><code>Inspector</code></strong> panel's <strong class="userinput"><code>AI Character Control</code></strong> pane, as shown here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788478809/graphics/5bc7f0a3-4336-4567-b5f6-ea83c154bfb8.png" /></div><p></p><p>At this point, we have an AI character in the scene (<code class="literal">Ethan</code>), an empty game object that will be used as a navigation target (<code class="literal">WalkTarget</code>) initially in the center of our scene, and we told the AI Character Controller to use this target object. When we run the game, wherever <code class="literal">WalkTarget</code> is, Ethan will go there. But not yet.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec57"></a>The NavMesh bakery</h3></div></div></div><p>Ethan cannot just go walking around without being told where he's allowed to roam! We need to define a <span class="emphasis"><em>NavMesh</em></span>-a simplified geometrical <span>plane</span><a id="id325577502" class="indexterm"></a> that enables a character to plot its path around obstacles.</p><p>In our scene, Ethan is an agent. Where he's allowed to walk is the <span class="emphasis"><em>navmesh</em></span>. Note that he has a <span class="strong"><strong>NavMesh Agent</strong></span> component and an <code class="literal">AICharacterControl</code> script. The NavMesh Agent has parameters for how Ethan will move around the scene.</p><p>Create a <code class="literal">NavMesh</code> by first identifying the objects in the scene that affect navigation by marking them <strong class="userinput"><code>Navigation Static</code></strong>, and then baking the NavMesh, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select the <strong class="userinput"><code>Navigation</code></strong> panel. If it's not already a tab in your editor, open the <strong class="userinput"><code>Navigation</code></strong> window from the main menu by navigating to <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Navigation</code></strong>.</li><li>Select its <strong class="userinput"><code><span class="strong"><strong>Object</strong></span></code></strong> tab.</li><li>Select the <strong class="userinput"><code>Ground Plane</code></strong> in <strong class="userinput"><code>Hierarchy</code></strong>, then in the <strong class="userinput"><code>Navigation</code></strong> window's Object pane, check the <strong class="userinput"><code>Navigation Static</code></strong> checkbox. (Alternatively, you can use the object's Inspector window Static dropdown list.)</li><li>Repeat step 3 for each of the objects that should get in his way: the cubes and the sphere. An example is shown for the sphere.</li><li>In the Navigation window, select the <strong class="userinput"><code>Bake</code></strong> tab, and click on the <strong class="userinput"><code>Bake</code></strong>button at the bottom of the panel<span>:</span></li></ol></div><div class="mediaobject"><img src="/graphics/9781788478809/graphics/6b831fdb-56fb-4c6b-9cf5-431deabaf82d.png" /></div><p>The <strong class="userinput"><code>Scene</code></strong> view should now show a blue overlay where the NavMesh is defined, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/60c9983c-85c2-4ee7-b1e7-cf480c898119.png" /></div><p></p><p>Let's test this out. Ensure that the <strong class="userinput"><code>Game</code></strong> panel's <strong class="userinput"><code>Maximize on Play</code></strong> is deselected. Click on the <span class="emphasis"><em>Play</em></span> mode button (the triangle at the top of editor). In the <strong class="userinput"><code>Hierarchy</code></strong> panel, select the <code class="literal">WalkTarget</code> object and ensure that the Translate gizmo is active in the <strong class="userinput"><code>Scene</code></strong> panel (press the <span class="strong"><strong>W</strong></span> key on keyboard). Now, drag the red (<strong class="userinput"><code>x</code></strong>) and/or the blue (<strong class="userinput"><code>z</code></strong>) arrow handles on the <code class="literal">WalkTarget</code> object to move it around the floor plane. As you do, Ethan should follow! Click on <span class="emphasis"><em>Play</em></span> again to stop <strong class="userinput"><code>Play Mode</code></strong>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec58"></a>A random walker in the town</h3></div></div></div><p>Now, we'll write a script <span>that</span><a id="id325577665" class="indexterm"></a> moves the <code class="literal">WalkTarget</code> object to random places.</p><p>Writing scripts is an important part of developing with Unity. If you've done anything more that tinker with Unity, you've probably already written at least some scripts. We're going to use the C# programming language.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note37"></a>Note</h3><p>If you are new to programming, don't panic! We provide a more detailed introduction to Unity scripting at the end of this chapter. You can skip to that now and come back, or just follow along.</p></div><p>For this first script, we'll take it slow. We will attach the script to the <code class="literal">WalkTarget</code> object, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select the <code class="literal">WalkTarget</code> object in the <strong class="userinput"><code>Hierarchy</code></strong> panel or the <strong class="userinput"><code>Scene</code></strong> view.</li><li>In its <strong class="userinput"><code>Inspector</code></strong> panel, click on the <strong class="userinput"><code>Add Component</code></strong> button.</li><li>Select <strong class="userinput"><code>New Script</code></strong> (you many need to scroll down to find it).</li><li>Name it <code class="literal">RandomPosition</code>.</li><li>Ensure that the <strong class="userinput"><code>C Sharp</code></strong> language is selected.</li><li>Click on <strong class="userinput"><code>Create and Add</code></strong>.</li><li>This should create a script component on the <code class="literal">WalkTarget</code> object. Double-click on the <code class="literal">RandomPosition</code> script in the slot to the right of <strong class="userinput"><code>Script</code></strong> in the <strong class="userinput"><code>Inspector</code></strong> pane to open it in your code editor.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec59"></a>The RandomPosition script</h3></div></div></div><p>We want to move the <code class="literal">WalkTarget</code> object to a random location <span>so</span><a id="id325552026" class="indexterm"></a> that Ethan will head in <span>that</span><a id="id325552033" class="indexterm"></a> direction, wait a few seconds, and move the <code class="literal">WalkTarget</code> object again. That way, he'll appear to be wandering around aimlessly. We can do this with a script. Rather than developing the script incrementally, I'm presenting the finished version first, and we'll go through it line by line. The <code class="literal">RandomPosition.cs</code> script looks like this:</p><pre class="programlisting">using UnityEngine; 
using System.Collections; 
 
public class RandomPosition : MonoBehaviour { 
 
  void Start () { 
    StartCoroutine (RePositionWithDelay()); 
  } 
 
  IEnumerator RePositionWithDelay() { 
    while (true) { 
      SetRandomPosition(); 
      yield return new WaitForSeconds (5); 
    } 
  } 
 
  void SetRandomPosition() { 
    float x = Random.Range (-5.0f, 5.0f); 
    float z = Random.Range (-5.0f, 5.0f); 
    Debug.Log ("X,Z: " + x.ToString("F2") + ", " + 
       z.ToString("F2")); 
    transform.position = new Vector3 (x, 0.0f, z); 
  } 
} </pre><p>This script defines a <code class="literal">MonoBehaviour</code> sub-class named <code class="literal">RandomPosition</code>. The first thing we do when defining the class is declare any variables that we'll be using. A variable is a placeholder for a value. The value can be initialized here or assigned elsewhere, just as long as it has a value before the script uses it.</p><p>The meat of the script is further down, the function named <code class="literal">SetRandomPosition()</code>. Let's see what that does.</p><p>If you recall, the <code class="literal">GroundPlane</code> plane is 10 units square, with the origin in the middle. So, any (x, z) location on the plane will be within a range from <code class="literal">-5</code> to <code class="literal">5</code> along each axis. The line <code class="literal">float x = Random.Range (-5.0f, 5.0f)</code> picks a random value within the given range and assigns it to a new <code class="literal">float x</code> variable. We do the same thing to get a random <span class="emphasis"><em><strong class="userinput"><code>z</code></strong></em></span> value. (Usually, I discourage <span class="emphasis"><em>hardcoding</em></span> constant values like this instead of using variables, but I'm keeping things simple for illustration purposes.)</p><p>The line <code class="literal">Debug.Log ("X,Z: " + x.ToString("F2") + ", " + z.ToString("F2"))</code> prints the <code class="literal">x</code> and <code class="literal">z</code> values in the <strong class="userinput"><code>Console</code></strong> panel when the game is running. It'll output something like <code class="literal">X, Z: 2.33, -4.02</code> because <code class="literal">ToString("F2")</code> says round up to two decimal places. Note that we're using plus signs to combine the parts of the output string together.</p><p>We actually move the target to the given location with the line <code class="literal">transform.position = new Vector3 (x, 0.0f, z);</code>. We're setting the transform position of the object that this script is attached to. In Unity, values that have an X, Y, and Z are represented by the <code class="literal">Vector3</code> objects. So, we create a new one with the <code class="literal">x</code> and <code class="literal">z</code> values that we generated. We give <code class="literal">y=0</code> so that it sits on <code class="literal">GroundPlane</code>.</p><p>Each <code class="literal">MonoBehaviour</code> class has a built-in variable called <code class="literal">this</code>, which refers to the object that the script is attached to. That is, when the script is a component of an object and appears in its <strong class="userinput"><code>Inspector</code></strong> panel, the script can refer to its object as <code class="literal">this</code>. In fact, <code class="literal">this</code> is so obvious, if you want to call functions on the <code class="literal">this</code> object, you don't even need to say it. We could have said <code class="literal">this.transform.position = ...</code>, but the <code class="literal">this</code> object is implied and is normally omitted. On the other hand, if you had a variable for some other object (for example, <code class="literal">GameObject</code> that;), then you'd need to say that when you set its position, like <code class="literal">that.transform.position = ...</code>.</p><p>The last mysterious bit is how we handle time delays in Unity, using <span>co-routine</span>s. This is a somewhat advanced coding technique, but very handy. In our case, the transform position should get changed once every five seconds. It's solved in several parts:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <code class="literal">Start()</code> function, there's the line <code class="literal">StartCoroutine (RePositionWithDelay());</code>. A <span class="strong"><strong>co-routine</strong></span> is a <span>piece</span><a id="id325552234" class="indexterm"></a> of code that runs separately from the function from which it was called. So, this line kicks off the <code class="literal">RePositionWithDelay()</code> function in a co-routine.</li><li>Inside that, there's a <code class="literal">while (true)</code> loop, which as you might guess, runs forever (as long as the game is running).</li><li>It calls the <code class="literal">SetRandomPosition()</code> function, which actually repositions the object.</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Then, at the bottom of this loop, we do a <code class="literal">yield return new WaitForSeconds (5);</code> statement, which basically says to Unity, <span class="emphasis"><em>hey, go do what you want for five seconds and then come back here so that I can go through my loop again</em></span>.</li><li>For all of this to work, the <code class="literal">RePositionWithDelay</code> co-routine must be declared as the <code class="literal">IEnumerator</code> type (because the documentation says so).</li></ol></div><p>This co-<span>routine</span>/yield mechanism, although an advanced programming topic, is a common pattern in time-sliced programs such as Unity.</p><p>Our script should be saved to a file named <code class="literal">RandomPosition.cs</code>.</p><p>We are now good to go. In the Unity editor, click on <span class="emphasis"><em><span>Play</span></em></span>. Ethan is running from one place to another like a madman!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec60"></a>"Zombie-ize" Ethan!</h3></div></div></div><p>OK, that's pretty random. Let's adjust the NavMesh steering parameters to <span>slow</span><a id="id325552309" class="indexterm"></a> him down to a nice zombie-like pace. For that, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select <code class="literal">Ethan</code> in the <strong class="userinput"><code>Hierarchy</code></strong> panel</li><li>Navigate to <strong class="userinput"><code>Inspector</code></strong> | <strong class="userinput"><code>Nav Mesh Agent</code></strong> | <strong class="userinput"><code>Steering</code></strong> and set the following:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Speed</code></strong>: <code class="literal">0.3</code></li><li style="list-style-type: disc"><strong class="userinput"><code>Angular Speed</code></strong>: <code class="literal">60</code></li><li style="list-style-type: disc"><strong class="userinput"><code>Acceleration</code></strong>: <code class="literal">2</code></li></ul></div></li></ol></div><p>Play again. He has slowed down. That's better.</p><p>One more finishing touch: let's turn him into a zombie. I have a texture image named <code class="literal">EthanZombie.png</code> that will help (included with this book). Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From the <strong class="userinput"><code>Assets</code></strong> tab on the main menu, select <strong class="userinput"><code>Import New Asset...</code></strong>. Navigate to the files folder with the assets that came with this book.</li><li>Select the <code class="literal">EthanZombie.png</code> file.</li><li>Click on <strong class="userinput"><code>Import</code></strong>. For tidiness, ensure that it resides in the <code class="literal">Assets/Textures</code> folder. (Alternatively, you can just drag and drop the file from Windows Explorer into the <strong class="userinput"><code>Project</code></strong> panel Assets/Textures folder.)</li><li>In the <strong class="userinput"><code>Hierarchy</code></strong> panel, unfold the <code class="literal">Ethan</code> object (click on the triangle) and select <code class="literal">EthanBody</code>.</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>In the <code class="literal">Inspector</code> panel, unfold the <code class="literal">EthanGray</code> shader by clicking on the triangle icon to the left of <strong class="userinput"><code>Shader</code></strong>.</li><li>Select the <code class="literal">EthanZombie</code> texture from the <code class="literal">Project Assets/Textures</code> folder.</li><li>Drag it onto the <strong class="userinput"><code>Albedo</code></strong> texture map. It's a small square just to the left of the <strong class="userinput"><code>Albedo</code></strong> label under <strong class="userinput"><code>Main Maps</code></strong>.</li><li>In the <strong class="userinput"><code>Hierarchy</code></strong> panel, select <code class="literal">EthanGlasses</code> and uncheck it to disable glasses in the <strong class="userinput"><code>Inspector</code></strong> panel. After all, zombies don't need glasses!</li></ol></div><p>His portrait is featured below. <span class="emphasis"><em>What'd you say? That's not a scary enough zombie??</em></span> Well, maybe he's just recently turned. Go ahead and make a better one yourself. Use Blender, Gimp, or Photoshop and paint your own (or even import a whole different zombie humanoid model to replace <code class="literal">EthanBody</code> itself):</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/fd6b6775-ec82-49b7-aa26-d3aac45585cd.png" /></div><p>Now, build the project and try it in VR.</p><p>We're looking from a third-person perspective. You can look around and watch what's going on. It's kind of fun, and it's pretty interesting. And it's passive. Let's get more active.</p></div></div>