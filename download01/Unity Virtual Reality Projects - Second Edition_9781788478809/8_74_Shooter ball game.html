<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec75"></a>Shooter ball game</h2></div></div><hr /></div><p>For the next iteration of <span>this</span><a id="id325317266" class="indexterm"></a> project, we'll shoot balls at the player and you have to hit them at a target on a wall. There's not a lot of innovation in this version, but it shows how you can take an existing mechanic and turn it on its side (both literally and figuratively).</p><p>To begin, lets make a wall and put the target on it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Hierarchy</code></strong> root, create an <strong class="userinput"><code>Empty</code></strong> game object named <code class="literal">TargetWall</code> and </li><li><strong class="userinput"><code>Position</code></strong> it at (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">5</code>)</li><li>Create a child <strong class="userinput"><code>Cube</code></strong> and name it <code class="literal">Wall</code></li><li>Set the Wall <strong class="userinput"><code>Scale</code></strong> to (<code class="literal">10</code>, <code class="literal">5</code>, <code class="literal">0.1</code>) and <strong class="userinput"><code>Position</code></strong> (<code class="literal">0</code>, <code class="literal">2.5</code>, <code class="literal">0</code>)</li><li>Create a new Material named <code class="literal">Wall Material</code></li><li>Set its <strong class="userinput"><code>Rendering Mode</code></strong> to <strong class="userinput"><code>Transparent</code></strong>, and its <strong class="userinput"><code>Albedo</code></strong> color to (<code class="literal">85</code>, <code class="literal">60</code>, <code class="literal">20</code>, <code class="literal">75</code>) so it's a translucent glassy color</li><li>Move the <strong class="userinput"><code>Target</code></strong> to a child of <code class="literal">TargetWall</code></li><li>Modify the Target <strong class="userinput"><code>Transform</code></strong> <strong class="userinput"><code>Scale</code></strong> to (<code class="literal">1.5</code>, <code class="literal">0.1</code>, <code class="literal">1.5</code>), <strong class="userinput"><code>Rotation</code></strong> (<code class="literal">90</code>, <code class="literal">0</code>, <code class="literal">0</code>), and <strong class="userinput"><code>Position</code></strong> (<code class="literal">0</code>, <code class="literal">2.5</code>, <code class="literal">-0.25</code>) so it's smaller and just in front of the wall itself</li></ol></div><p>Next, instead of serving balls by dropping them out of the sky and relying on gravity, we'll shoot balls at you from a source on the wall:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a <strong class="userinput"><code>Sphere</code></strong> game object as a child of <code class="literal">TargetWall</code>, named <code class="literal">Shooter</code></li><li>Set its <strong class="userinput"><code>Scale</code></strong> to (<code class="literal">0.5</code>, <code class="literal">0.5</code>, <code class="literal">0.5</code>) and <strong class="userinput"><code>Position</code></strong> (<code class="literal">4</code>, <code class="literal">2.5</code>, <code class="literal">-0.25</code>)</li><li>Disable or remove its <strong class="userinput"><code>Sphere Collider</code></strong> component</li><li>Create a new Material named <code class="literal">Shooter Material</code>, with <strong class="userinput"><code>Albedo</code></strong> color (<code class="literal">45</code>, <code class="literal">22</code>, <code class="literal">12</code>, <code class="literal">255</code>)</li></ol></div><p>We'll add a gun barrel to the shooter:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create another <strong class="userinput"><code>Sphere</code></strong> object as a child of Shooter, named <code class="literal">Barrel</code></li><li>Set its <strong class="userinput"><code>Scale</code></strong> (<code class="literal">0.1</code>, <code class="literal">0.1</code>, <code class="literal">0.1</code>), <strong class="userinput"><code>Rotation</code></strong> (<code class="literal">90</code>, <code class="literal">0</code>, <code class="literal">0</code>), and <strong class="userinput"><code>Position</code></strong> (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">-0.25</code>)</li></ol></div><p>Duplicate the Shooter and set the second one's <strong class="userinput"><code>Position</code></strong> to (<code class="literal">-4</code>, <code class="literal">2.5</code>, <code class="literal">-0.25</code>) so there's one on either side of the Target. Here is a capture of the Scene view of the <code class="literal">TargetWall</code> with its sexy shooters:</p><div class="mediaobject"><img src="/graphics/9781788478809/graphics/103bc463-4bc4-456d-8ac3-9f01e87754ee.png" /></div><p>The game controller script is similar to the BallGame one we have, but sufficiently different we should create a new one:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In <strong class="userinput"><code>Hierarchy</code></strong>, select <code class="literal">GameController</code> and disable or remove the <code class="literal">BallGame</code> component</li><li>Create a new C# script named <code class="literal">ShooterBallGame</code> and open it for editing</li></ol></div><p>Write the <code class="literal">ShooterBallGame</code> script as follows. We give it two shooters and the script alternates between them to shoot balls in the direction of a <code class="literal">shootAt</code> location. We <span>play</span><a id="id325586493" class="indexterm"></a> a sound effect each time a ball is shot. First, let's define the public and private variable we will need:</p><pre class="programlisting">using UnityEngine;

[RequireComponent(typeof(ObjectPooler))]
public class ShooterBallGame : MonoBehaviour
{
    public Transform shootAt;
    public Transform shooter0;
    public Transform shooter1;
    public float speed = 5.0f;
    public float interval = 3f;

    private float nextBallTime = 0f;
    private ObjectPooler pool;
    private GameObject activeBall;
    private int shooterId = 0;
    private Transform shooter;

    private AudioSource soundEffect;
}</pre><p>The <code class="literal">Start</code> function initializes the variable we get at runtime:</p><pre class="programlisting">   void Start()
    {
        if (shootAt == null)
        {
            shootAt = Camera.main.transform;
        }
        soundEffect = GetComponent&lt;AudioSource&gt;();
        pool = GetComponent&lt;ObjectPooler&gt;();
        if (pool == null)
        {
            Debug.LogError("BallGame requires ObjectPooler component");
        }
    }</pre><p>And the <code class="literal">Update</code> function shoots the balls at specified intervals, alternating between the two shooter locations:</p><pre class="programlisting">    void Update()
    {
        if (Time.time &gt; nextBallTime)
        {
            if (shooterId == 0)
            {
                shooterId = 1;
                shooter = shooter1;
            }
            else
            {
                shooterId = 0;
                shooter = shooter0;
            }

            nextBallTime = Time.time + interval;
            ShootBall();
        } 
    }</pre><p>Finally, here's the <code class="literal">ShootBall()</code> code we extracted into its own function:</p><pre class="programlisting">    private void ShootBall()
    {
        soundEffect.Play();
        activeBall = pool.GetPooledObject();
        activeBall.transform.position = shooter.position;
        activeBall.transform.rotation = Quaternion.identity;
        shooter.transform.LookAt(shootAt);
        activeBall.GetComponent&lt;Rigidbody&gt;().velocity = shooter.forward * speed;
        activeBall.GetComponent&lt;Rigidbody&gt;().angularVelocity = Vector3.zero;
        activeBall.SetActive(true);
    }</pre><p><code class="literal">ShootBall</code> grabs a new ball from the object pool and initializes its position based on the shooter position. It then rotates the shooter to be pointing at the <code class="literal">shootAt</code> position (using <code class="literal">transform.LookAt</code>) and uses its forward vector to define the ball's RigidBody velocity vector.</p><p>Back in Unity, we need to populate the public variable slots:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag the <code class="literal">Shooter</code> object (child of <code class="literal">TargetWall</code>) on to the <strong class="userinput"><code>Shooter 0</code></strong> slot</li><li>Drag the other <code class="literal">Shooter</code> object on to the <strong class="userinput"><code>Shooter 1</code></strong> slot</li></ol></div><p>Leave the <strong class="userinput"><code>Shoot At</code></strong> slot empty for now, so it will default to the player's live head position.</p><p>Press <strong class="userinput"><code>Play</code></strong>. <span class="emphasis"><em>Not bad</em></span>. The balls are too big and heavy. Let's create new ball prefabs with different properties:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag the <code class="literal">BouncyBall</code> prefab from <code class="literal">Project</code> folder into the <strong class="userinput"><code>Hierarchy</code></strong></li><li>Rename it <code class="literal">ShooterBall</code></li><li>Set its <strong class="userinput"><code>Scale</code></strong> to (<code class="literal">0.25</code>, <code class="literal">0.25</code>, <code class="literal">0.25</code>)</li><li>Uncheck the <strong class="userinput"><code>Use Gravity</code></strong> checkbox (alternatively, you could play with its RigidBody <strong class="userinput"><code>Mass</code></strong> property)</li><li>Drag the <strong class="userinput"><code>ShooterBall</code></strong> from <strong class="userinput"><code>Hierarchy</code></strong> into your <code class="literal">Prefabs</code> folder, creating a new prefab for it</li><li>Delete the <strong class="userinput"><code>ShooterBall</code></strong> from the <strong class="userinput"><code>Hierarchy</code></strong></li><li>Select <code class="literal">GameController</code> in Hierarchy, and drag the <strong class="userinput"><code>ShooterBall</code></strong> onto its <strong class="userinput"><code>Object Pooler Prefab</code></strong> slot</li></ol></div><p>Now, the object pool will instantiate a collection of the new prefab objects.</p><p>Press <strong class="userinput"><code>Play</code></strong>. <span class="emphasis"><em>Oh yeah!</em></span> The game is now much more challenging. Also, try modifying the <strong class="userinput"><code>Interval</code></strong> and <strong class="userinput"><code>Speed</code></strong> settings.</p><p>It may be awkward that the ball is always shooting towards your head, especially on Daydream where you have limited hand control. You can adjust the scene, for example, positioning the <strong class="userinput"><code>ShootAt</code></strong> empty game object, as child of <code class="literal">MeMyselfEye</code>, at <strong class="userinput"><code>Position</code></strong> (<code class="literal">0</code>, <code class="literal">0.9</code>, <code class="literal">0.6</code>), and setting it into the <code class="literal">GameController</code>'s <strong class="userinput"><code>ShootAt</code></strong> slot.</p><p>Some obvious gameplay improvement ideas should come to mind. You could make a moving target, perhaps in a predictable oscillating motion, or completely random. You could introduce some random variation in the ball velocity direction and speed or the intervals between shots. You could keep score, using <code class="literal">OnTriggerEnter</code> on the Target. You could disqualify bank shots that bounce first on the floor (using <code class="literal">OnTriggerEnter</code> on the ground plane). </p></div>