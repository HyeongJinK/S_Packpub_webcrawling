<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec14"></a>Academy, Agent, and Brain</h2></div></div><hr /></div><p>In order to demonstrate the concepts of each of <span>the</span><a id="id324673373" class="indexterm"></a> main components (Academy, Agent, and Brain/Decision), we will construct a simple example based on <span>the</span><a id="id324673382" class="indexterm"></a> classic multi-armed bandit problem.  The bandit problem is so named because of its similarity to the slot machine that is colloquially known in Vegas as <span>the</span><a id="id324673390" class="indexterm"></a> one armed bandit. It is named as such because the machines are notorious for taking the poor tourist's money who play them. While a traditional slot machine has only one arm, our example will feature four arms or actions a player can take, with each action providing the player with a given reward. Open up Unity to the <span class="strong"><strong>Simple</strong></span> project we started in the last section:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From the menu, select <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>3D Object</code></strong> | <strong class="userinput"><code>Cube</code></strong> and rename the new object <code class="literal">Bandit</code>. </li><li>Click the Gear icon beside the <strong class="userinput"><code>Transform</code></strong> component and select <strong class="userinput"><code>Reset</code></strong> from the context menu. This will reset our object to <code class="literal">(0,0,0)</code>, which works well since it is the center of our scene.</li><li>Expand the <strong class="userinput"><code><span class="strong"><strong>Materials</strong></span></code></strong> section on the <span class="strong"><strong><strong class="userinput"><code>Mesh Renderer</code></strong></strong></span> component and click the Target icon. Select the <strong class="userinput"><code><span class="strong"><strong>NetMat</strong></span></code></strong> material, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/4aa43b40-7774-4f95-81d0-b3bedd3d7c1b.png" /></div><p>Selecting the NetMat material for the Bandit</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Open the <code class="literal">Assets/Simple/Scripts</code> folder in <span>the</span><a id="id325397686" class="indexterm"></a><strong class="userinput"><code>Project</code></strong> window.</li><li>Right-click (<span class="emphasis"><em>Command</em></span> Click on macOS) in a blank area of the window and from the <span class="strong"><strong>Context</strong></span> menu, select <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>C# Script</code></strong>. Name <span>the</span><a id="id325397713" class="indexterm"></a> script <code class="literal">Bandit</code> and replace <span>the</span><a id="id325397724" class="indexterm"></a> code with the following:</li></ol></div><pre class="programlisting">      public class Bandit : MonoBehaviour
      {
        public Material Gold;
        public Material Silver;
        public Material Bronze;
        private MeshRenderer mesh;
        private Material reset;

        // Use this for initialization
        void Start () {
        mesh = GetComponent&lt;MeshRenderer&gt;();
        reset = mesh.material;
        } 

        public int PullArm(int arm)
        {
         var reward = 0;
         switch (arm)
          {
           case 1:
             mesh.material = Gold;
             reward = 3;
             break;
            case 2:
              mesh.material = Bronze;
              reward = 1;
              break;
            case 3:
             mesh.material = Bronze;
             reward = 1;
             break;
           case 4:
             mesh.material = Silver;
             reward = 2;
             break;
          }
          return reward;
        }

        public void Reset()
        {
          mesh.material = reset;
        }
      }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>This code just simply implements our four armed bandit. The first part declares the class as <span class="strong"><strong>Bandit</strong></span> extended from <code class="literal">MonoBehaviour</code>. All <span class="strong"><strong>GameObjects</strong></span> in Unity are extended from <code class="literal">MonoBehaviour</code>. Next, we define some <span class="strong"><strong>public</strong></span> properties that define the material we will use to display the reward value back to us. Then, we have a couple of <span class="strong"><strong>private</strong></span> fields that are placeholders for the <code class="literal">MeshRenderer</code> called <span class="strong"><strong>mesh</strong></span> and the original <span class="strong"><strong>Material</strong></span> we call <span class="strong"><strong>reset</strong></span>.
We will implement the <span class="strong"><strong>Start</strong></span> method next, which is a default Unity method that runs when the object starts up. This is where we will set our two private fields based on the object's <code class="literal">MeshRenderer</code>.  Next comes the <span class="strong"><strong>PullArm</strong></span> method which is just a simple switch statement that sets the appropriate material and reward. Finally, we will finish up with the <span class="strong"><strong>Reset</strong></span> method where we just reset the original property. </li><li>When you are done entering the code, be sure to save the file and return to Unity.</li><li>Drag and drop the <strong class="userinput"><code><span class="strong"><strong>Bandit</strong></span></code></strong> script from the <code class="literal">Assets/Simple/Scripts</code> folder in the <span class="strong"><strong>Project</strong></span> window and drop it on the <code class="literal">Bandit</code> object in the <span class="strong"><strong>Hierarchy</strong></span> window. This will add the <span class="strong"><strong>Bandit</strong></span> component to the object.</li><li>Select the <span class="strong"><strong>Bandit</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> window and then in the <span class="strong"><strong>Inspector</strong></span> window click the <span class="strong"><strong>Target</strong></span> icon and select each of the material slots (<span class="strong"><strong>Gold, Silver, Bronze</strong></span>), as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/05e7ac8d-8652-4a2f-8d77-5d65cbc59802.png" /></div><p>Setting the Gold, Silver and Bronze materials on the Bandit</p><p>This will set up our <strong class="userinput"><code><span class="strong"><strong>Bandit</strong></span></code></strong> object as a visual placeholder. You could, of course, add the arms and make it look more visually like a multi-armed slot machine, but for our purposes, the current object will work fine. Remember that our <strong class="userinput"><code><span class="strong"><strong>Bandit</strong></span></code></strong> has 4 arms, each with a different reward.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec9"></a>Setting up the Academy</h3></div></div></div><p>An <span class="strong"><strong>Academy</strong></span> object and component represents <span>the</span><a id="id325398124" class="indexterm"></a> training environment where we define the training configuration for our agents. You can think of an Academy as the school or classroom in which our agents will be trained. Open up the Unity editor and select the <span class="strong"><strong>Academy</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> window. Then, follow these steps to configure the <span class="strong"><strong>Academy</strong></span> component:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Set the properties for the <strong class="userinput"><code><span class="strong"><strong>Academy</strong></span></code></strong> component, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/76d686d7-91bf-4f84-b7d3-291bed8d9dba.png" /></div><p>Setting the properties on the Academy component of the Academy object</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>The following is a quick summary of the initial <span class="strong"><strong>Academy</strong></span> properties we will cover:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>Max Steps</code></strong>: This limits <span>the</span><a id="id325398188" class="indexterm"></a> number of actions your <span class="strong"><strong>Academy</strong></span> will let each <span class="strong"><strong>Agent</strong></span> execute before resetting itself. In our current example, we can leave this at 0, because we are only doing a single step. By setting it to zero, our agent will continue forever until <span class="strong"><strong>Done</strong></span> is called.</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Training Configuration</code></strong></strong></span>: In any ML problem, we often break the problem into a training and test set.  This allows us to build an ML or agent model on a training environment or dataset. Then, we can take the trained ML and exercise it on a real dataset using inference.  The <span class="emphasis"><em>Training configuration</em></span> section is where we will configure the environment for training.</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Infrerence Configuration</code></strong></strong></span>: Inference is where we infer or exercise our model against a previously unseen environment or dataset. This configuration area is where we set parameters when our ML is running in this type of environment.</li></ul></div></li></ol></div><p>The <strong class="userinput"><code><span class="strong"><strong>Academy</strong></span></code></strong> setup is quite straightforward for this simple example. We will get to the more complex options in later chapters, but do feel free to expand the options and look at the properties.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec10"></a>Setting up the Agent</h3></div></div></div><p>Agents represents <span>the</span><a id="id325398275" class="indexterm"></a> actors that we are training to learn to perform some task or set of task-based commands on some reward. We will cover more about actors, actions, state, and rewards when we talk more about Reinforcement Learning in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>The Bandit and Reinforcement Learning</em></span>. For now, all we need to do is set the <span class="strong"><strong>Brain</strong></span> the agent will be using. Open up the editor and follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Locate the <span class="strong"><strong>Agent</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> window and select it.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Click the <span class="strong"><strong>Target</strong></span> icon beside the <strong class="userinput"><code><span class="strong"><strong>Brain</strong></span></code></strong> property on the <span class="strong"><strong>Simple Agent</strong></span> component and select the Brain object in the scene, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/b5faf3f8-95c1-440a-9a1f-4f36fafa7957.png" /></div><p>Setting the Agent Brain</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Click the <span class="strong"><strong>Target</strong></span> icon on the <span class="strong"><strong><strong class="userinput"><code>Simple Agent</code></strong></strong></span> component and from the context menu select <span class="strong"><strong>Edit Script</strong></span>. The agent script is what we use to observe the environment and collect observations. In our current example, we always assume that there is no previous observation.</li><li>Enter the highlighted code in the <code class="literal">CollectObservations</code> method as follows:</li></ol></div><pre class="programlisting">      public override void CollectObservations()
      {
        AddVectorObs(0);
      }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li><code class="literal">CollectObservations</code> is <span>the</span><a id="id325398385" class="indexterm"></a> method called to set what the <span class="strong"><strong>Agent</strong></span> observes about the environment. This method will be called on every agent step or action. We use <code class="literal">AddVectorObs</code> to add a single float value of <span class="strong"><strong>0</strong></span> to the agent's observation collection. At this point, we are not currently using any observations and will assume our bandit provides no visual clues as to what arm to pull. 
 The agent will also need to evaluate the rewards and when they are collected. We will need to add four slots, one for each arm to our agent, in order to represent the reward when that arm is pulled.
</li><li>Enter the following code in the <code class="literal">SimpleAgent</code> class:</li></ol></div><pre class="programlisting">      public Bandit bandit;
      public override void AgentAction(float[] vectorAction, 
      string textAction)
      {
        var action = (int)vectorAction[0];
        AddReward(bandit.PullArm(action));
        Done();
      }

      public override void AgentReset()
      {
        bandit.Reset();
      }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>The code in our <code class="literal">AgentStep</code> method just takes the current action and applies that to the <span class="strong"><strong>Bandit</strong></span> with the <code class="literal">PullArm</code> method, passing in the arm to pull. The reward returned from the bandit is added using <code class="literal">AddReward</code>. After that, we implement some code in the <code class="literal">AgentReset</code> method. This code just resets the Bandit back to its starting state. <code class="literal">AgentReset</code> is called when the agent is done, complete, or runs out of steps. Notice how we call the method <span class="strong"><strong>Done</strong></span> after each step; this is because our bandit is only a single state or action.</li><li>Add the following code just below the last section:</li></ol></div><pre class="programlisting">      public Academy academy;
      public float timeBetweenDecisionsAtInference;
      private float timeSinceDecision;

      public void FixedUpdate()
      {
        WaitTimeInference();
      }

      private void WaitTimeInference()
      {
        if (!academy.GetIsInference())
        {
          RequestDecision();
        }
        else
        {
          if (timeSinceDecision &gt;= timeBetweenDecisionsAtInference)
          {
            timeSinceDecision = 0f;
            RequestDecision();
          }
          else
          {
            timeSinceDecision += Time.fixedDeltaTime;
          }
        }
      }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>We need to add the preceding code in order for our brain to wait long enough for it to accept Player decisions. Our first example that we will build will use player input. Don't worry too much about this code, as we only need it to allow for player input. When we develop our Agent Brains, we won't need to put a delay in.</li><li>Save the script when you are done editing.</li><li>Return to the editor and set the properties on the Simple Agent, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/5db33222-9848-4003-9d53-661f09afb11e.png" /></div><p>Setting the Simple Agent properties</p><p>We are almost done. The agent is now able to interpret our actions and execute them on the <span class="strong"><strong>Bandit</strong></span>. Actions are sent to the agent from the <span class="strong"><strong>Brain</strong></span>. The <span class="strong"><strong>Brain</strong></span> is responsible for making decisions and we will cover its setup in <span>the</span><a id="id324673533" class="indexterm"></a> next section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec11"></a>Setting up the Brain</h3></div></div></div><p>We have seen <span>the</span><a id="id324673548" class="indexterm"></a> basics of how a <code class="literal">Brain</code> functions when we looked at the earlier Unity example. There are a number of different types of brains from <span class="strong"><strong>Player</strong></span>, <span class="strong"><strong>Heuristic</strong></span>, <span class="strong"><strong>Internal</strong></span>, and <span class="strong"><strong>External</strong></span>. For our simple example, we are going to set up a <code class="literal">Player</code> brain. Follow these steps to configure the <span class="strong"><strong>Brain</strong></span> object to accept input from the player:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Locate the <code class="literal">Brain</code> object in the <code class="literal">Hierarchy</code> window; it is a child of the <code class="literal">Academy</code>.</li><li>Select the <code class="literal">Brain</code> object and set the <code class="literal">Player</code> inputs, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/e0a0082e-91dc-45db-b044-670f4d47ad2b.png" /></div><p>Setting the Player inputs on the Brain</p><p></p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Save your scene and project.</li><li>Press Play to run the scene. Type any of the keys <span class="emphasis"><em>A</em></span>, <span class="emphasis"><em>S</em></span>, <span class="emphasis"><em>D</em></span>, or <span class="emphasis"><em>F</em></span> to pull each of the arms from <code class="literal">1</code> to <code class="literal">4</code>. As you pull the arm, the <span class="strong"><strong>Bandit</strong></span> will change color based on the reward. This is a very simple game and a human pulling the right arm each time should be a fairly simple exercise.</li></ol></div><p>Now, we have a simple <span class="strong"><strong>Player</strong></span> brain that lets us test our simple four armed bandit. We could take this a step further and implement a <span class="strong"><strong>Heuristic</strong></span> brain, but we will leave that as an exercise to the reader. For now though, until we get to the next chapter, you should have enough to run with to get comfortable with some of <span>the</span><a id="id324673703" class="indexterm"></a> basic concepts of ML-Agents.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec12"></a>Exercises</h3></div></div></div><p> Complete these exercises on your own for additional learning:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Change the materials the agent uses to signal a reward – bonus points if you create a new material.</li><li>Add an additional arm to the Bandit.</li><li>In our earlier cannon example, we used a Linear Regression ML algorithm to predict the velocity needed for a specific distance. As we saw, our cannon problem could be better fit with another algorithm. Can you pick a better method to do this regression? </li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Note</h3><p>Access to <span class="strong"><strong>Excel</strong></span> can make this fairly simple.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Implement a <code class="literal">SimpleDecision</code> script that uses a <span class="strong"><strong>Heuristic</strong></span> algorithm to always pick the best solution.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip13"></a>Note</h3><p>You can look at the <span class="strong"><strong>3DBall</strong></span> example we looked at earlier.  You will need to add the <code class="literal">SimpleDecision</code> script to the <span class="strong"><strong>Brain</strong></span> in order to set a Heuristics brain.</p></div></div></div>