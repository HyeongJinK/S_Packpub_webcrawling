<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec24"></a>ML-Agents external brains</h2></div></div><hr /></div><p>Until now, all of our experiments have been with the heuristics brain using an internal RL algorithm called Q-learning. Now that we realize that C# scripts will only go so far, we can look at using ML-Agent external brains developed with Python. The preferred method for Unity is to run a <span>Jupyter</span><a id="id324673344" class="indexterm"></a> Python notebook externally to control the Unity training environment. This requires us to build a special Unity environment. Go through the following steps to learn how to configure the 3D ball environment for external training:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the Unity editor and load the ML-Agents demo <code class="literal">unityenvironment</code> project. If you still have it open from the last chapter, then that will work as well.</li><li>Open the <code class="literal">3DBall.scene</code> in the <code class="literal">ML-Agents/Examples/3DBall</code> folder.</li><li>Locate the <code class="literal">Brain3DBrain</code> object in the <strong class="userinput"><code>Hierarchy</code></strong> window and select it. In the <strong class="userinput"><code>Inspector</code></strong> window set the Brain Type to External.</li><li>From the menu, select <strong class="userinput"><code>Edit</code></strong> | <strong class="userinput"><code>Project Settings</code></strong> | <strong class="userinput"><code>Player</code></strong>. From the <strong class="userinput"><code>Inspector</code></strong> window, set the properties as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/ca5e2c11-b291-436e-8416-41c50494995a.png" /></div><p></p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li><p>Setting the <strong class="userinput"><code>Player</code></strong> resolution properties</p></li><li><p>From the menu, select <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>Build Settings</code></strong>. Click on the <span>Add</span><a id="id324988439" class="indexterm"></a> Open Scene button and make sure that only the <strong class="userinput"><code>3DBall</code></strong> scene is active, as shown in the following dialog:</p></li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/29208061-b5df-4a58-9527-029353f8ade7.png" /></div><p>Setting the Build Settings for the Unity environment</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Set the Target Platform to your chosen desktop OS (Windows, in this example) and click the Build button at the bottom of the dialog.</li><li>You will be prompted to choose a folder to <span>build</span><a id="id324988616" class="indexterm"></a> into. Select the python folder in the base of the ml-agents folder.</li><li>If you are prompted to enter a name for the file, enter 3DBall. On newer versions of Unity, from 2018 onward, the name of the folder will be set by the name of the Unity environment build folder, which will be python.
<p>Be sure that you know where Unity is placing the build, and be sure that the file is in the python folder. At the time of writing, on Windows, Unity will name the executable <code class="literal">python.exe</code> and not <code class="literal">3DBall.exe</code>. This is important to remember when we get to setting up the Python notebook.</p></li></ol></div><p>With the environment built, we can move on to running the Basics notebook against the app. In the next section, we will walk through running the Jupyter notebook to control the environment.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec21"></a>Running the environment</h3></div></div></div><p>Open up the Basics Jupyter notebook again; remember that we <span>wanted</span><a id="id324988644" class="indexterm"></a> to leave it open after testing the Python install. If you have experience with Python and Jupyter, you may just want to read through the notebook on your own. For those of you that want a little more help, go through the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Ensure that you update the first code block with your environment name, like so:</li></ol></div><pre class="programlisting">      env_name = "python" # Name of the Unity environment binary to launch
      train_mode = True # Whether to run the environment in training or 
      inference mode</pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>We have the environment name set to <code class="literal">'python'</code> here because that is the name of the executable that gets built into the python folder. You can include the file extension, but you don't have to. If you are not sure what the filename is, check the folder; it really will save you some frustration.</li><li>Go inside the first code block and then click the Run button on the toolbar. Clicking Run will run the block of code you currently have your cursor in. This is a really powerful feature of a notebook; being able to move back and forth between code blocks and execute what you need is very useful when building complex algorithms.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Click inside the second code block and click Run. The second code block is responsible for loading code dependencies. Note the following line in the second code block:</li></ol></div><pre class="programlisting">      from unityagents import UnityEnvironment</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>This line is where we import the <code class="literal">unityagents</code> UnityEnvironment class. This class is our controller for running the environment.</li><li>Run the third code block. Note how a Unity <span>window</span><a id="id325397632" class="indexterm"></a> will launch, showing the environment. You should also notice an output showing a successful startup and the brain stats. If you encounter an error at this point, go back and ensure you have the <code class="literal">env_name</code> variable set with the correct filename.</li><li>Run the fourth code block. You should again see some more output, but unfortunately, with this control method you don't see interactive activity. We will try to resolve this issue in a later chapter.</li><li>Run the fifth code block. This will run through some random actions in order to generate some random output.</li><li>Finally, run the sixth code block. This will close the Unity environment.</li></ol></div><p>Feel free to review the Basics notebook and play with the code. Take advantage of the ability to modify the code or make minor changes and quickly rerun code blocks. Don't concern yourself too much if the code looks complicated; there are plenty of good examples and we have plenty more chapters to go through.</p><p>At this point, you may still be scratching your head and asking "why Python?". Indeed, we could have just as easily written the same example quite cleanly in C#. Python provides us with an advanced set of algorithms developed explicitly for solving complex ML problems. One such algorithm or tool that we use is known as a neural network, and we will explore how we use it in the next section.</p></div></div>