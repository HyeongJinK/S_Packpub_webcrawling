<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec44"></a>What was/is Terrarium?</h2></div></div><hr /></div><p>Terrarium was a concept that was probably ahead of its time. While the game did allow developers to transfer some form of state between parents and offspring, it was a feature that was <span>never</span><a id="id324673274" class="indexterm"></a> used in successful agents. Instead, developers just optimized their code for a particular set of fixed strategies, which in many cases turned out to be a lot of code. The following is an example screenshot of a Terrarium client running in ecosystem mode:</p><div class="mediaobject"><img src="/graphics/9781789138139/graphics/4ab88301-d846-4f9a-b27f-6fbc9d9a69b7.jpg" /></div><p>
Original Microsoft Terrarium</p><p>Now, the bottom line is that we are not going to be able to replicate the entire Terrarium connected ecosystem concept in one chapter. The elegance that was the Terrarium network ecosystem infrastructure could possibly take several chapters to explain. Instead, our goal is going to build a multi-agent multi-brain ecosystem that is designed to teach you more about building an ML-Agents environment and Deep Reinforcement Learning. Perhaps someone like Microsoft or Unity will take the connected ecosystem concept further – who knows.</p><p>The Terrarium game rules were fairly simple and one of the <span>basic</span><a id="id324673772" class="indexterm"></a> rules was that your code had to run in x amount of time without failure or the creature died. There were other aspects that allowed you to apply points into a creature's abilities like size, speed, toughness, and so on that we will focus on. Developers had 100 points that they could apply to various categories for creatures of type carnivore and herbivore, as shown in the following sample tables:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Attributes</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Herbivore</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Carnivore</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Description</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Max Energy</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">20</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">10</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Determines the amount of energy the creature can store for actions. Carnivores consume energy by eating other creatures. Herbivores eat plants.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Eating Speed</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">2</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">6</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Determines how fast the creature can consume energy from another creature.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Attack Damage</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">0</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">14</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Amount of damage another creature causes in an attack.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Defend Damage</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">10</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">10</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Determines how effective a creature defends from an attack. A creature with a higher defense will inflict damage back on the attacker.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Max Speed</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">8</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">10</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Determines how fast a creature moves.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Camouflage</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">25</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">5</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>How difficult it is to see the creature.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Eyesight</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">5</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">20</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>How far away a creature can detect other creatures.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><strong class="userinput"><code>Mature Size</code></strong></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">30</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">20</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>We are adding Mature Size to the original parameters in order to hopefully make the game more balanced.</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p><strong class="userinput"><code>Growth Rate</code></strong></p></td><td style="border-right: 0.5pt solid ; "><p><code class="literal">5</code></p></td><td style="border-right: 0.5pt solid ; "><p><code class="literal">5</code></p></td><td style=""><p>This is another parameter that has been added to manage creature growth a little cleaner. The original game handled creature growth a bit like a black box.</p></td></tr></tbody></table></div><p> </p><p>On top of this, all creatures have a Mature Size attribute that can vary from <code class="literal">24</code> to <code class="literal">48</code>, which corresponded to the icon's image size in the original game. We will map all of these attributes to various game mechanics when we build the example, but for us to perform reinforcement learning, we are going to need to apply some form of reward structure as well.</p><p>Previously, all of our rewards have been goal orientated; get to the goal and get a reward. With Terrarium however, the goal was and still is to make our agents live as long as possible and reproduce. Therefore, we want to introduce a reward system that also mimics this. We will do this by giving rewards based on the following events:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Event</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Reward</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Description</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Die of old age</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">+1</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Our goal will be for the creature agents to survive as long as possible.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Reproduce</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">+1</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>We want to encourage reproduction; more agents means more learning and food for others.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Eat</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">+energy eaten/100</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>We give this micro reward in order to encourage creatures to eat. Without it, they may realize they don't need to do this and just continually die of starvation. Besides, everyone enjoys eating, right?</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Die of sickness</p></td><td style="border-right: 0.5pt solid ; "><p><code class="literal">-1</code></p></td><td style=""><p>In the original game, a creature died of sickness if the code crashed or the agent was unable to move. Adding this as a negative reward should hopefully reduce overcrowding.</p></td></tr></tbody></table></div><p>The original game was run in real-time, but was essentially turn-based, where during each turn the agents would run through a series of events or functions based on its current state, as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Event</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Function</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">BornEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires after a creature is born.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">LoadEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires after a creature has been loaded into the environment.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">IdleEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires when the agent needs to make a decision, we can essentially convert that to use on-demand decisions.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">ReproduceCompletedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires after an agent reproduces; this will be a reward event for our purposes.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">EatCompletedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires after an agent eats. Again, another opportunity to give rewards.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">DefendCompletedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Agents need to explicitly perform a defensive action. This event will fire after an agent defends itself.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">AttackCompletedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires when an agent finishes attacking.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">AttackedEvent</code></p></td><td style="border-bottom: 0.5pt solid ; "><p>Fires after a creature is attacked.</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p><code class="literal">MoveCompletedEvent</code></p></td><td style=""><p>Fires after an agent moves.</p></td></tr></tbody></table></div><p> </p><p>Now, in the original game, it was the job of the developer to <span>implement</span><a id="id324673577" class="indexterm"></a> their own code in each of the preceding events in order to control the agent. For our purposes, we will use a real-time physics-based system that will activate these events based on agent timing. Each action an agent performs will take some amount of time determined by the creature's speed or eating speed. This is why it is critical that an agent can move and consume resources (other creatures) quickly.</p><p>During a turn, an agent can perform the following actions:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Action</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Description</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Wait</p></td><td style="border-bottom: 0.5pt solid ; "><p>A creature can wait and stay idle, thus conserving energy.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Move</p></td><td style="border-bottom: 0.5pt solid ; "><p>Movement consumes <code class="literal">.01 x</code> creature's current size in energy per movement action.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Attack</p></td><td style="border-bottom: 0.5pt solid ; "><p>Attacking consumes <code class="literal">.01 x</code> creature's size in energy. An attack scores damage equal to the attack strength multiplied by the creature size, subtracting any defending creatures defense <code class="literal">x</code> creature size. If a herbivore is not defending, the attacker strikes at full damage.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Defend</p></td><td style="border-bottom: 0.5pt solid ; "><p>Defending consumes <code class="literal">.005 x</code> creature's size in energy. A creature must explicitly defend itself in order to block an attack.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Eat</p></td><td style="border-bottom: 0.5pt solid ; "><p>Eating consumes energy at the rate of its eating speed per time scale. A creature cannot eat an active herbivore or carnivore, but may eat living plants.</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Reproduce</p></td><td style=""><p>Reproduction consumes 1/2 the creature's energy. In order to reproduce, the creature must have greater than 50% of its maximum energy and be of mature size.</p></td></tr></tbody></table></div><p> </p><p>In addition to the preceding actions, a creature will also undergo various transformations as it grows and dies, as shown in the following table:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Lifetime Event</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Description</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Born</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p>Spawning a new creature will happen whenever a grown creature has reached its maximum size and has an energy surplus, <code class="literal">energy &gt; max energy + 1</code>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Grow</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p>A creature will grow any time its energy level has increased by 50%. A growth spurt will immediately reduce a creature's current energy by 25%. If you want, you could also add a micro reward here to encourage creature growth.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Die of old age</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p>The creature has lived as long as its lifespan allows. A creature's lifespan is set by its size, so larger creatures live longer.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Die of starvation or sickness</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p>The creature exhausts all of its <code class="literal">energy &lt; 0</code> and dies. A creature with 0 energy could live idle into old age, but if it tries to move, defend, or attack, it will die. It is conceivable that another creature could bring it food, but we shall see how that plays out.</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p><span class="strong"><strong>Killed</strong></span></p></td><td style=""><p>When a creature is killed by another creature, it dies but is not destroyed. The dead creature is left with max energy for carnivore creatures to consume.</p></td></tr></tbody></table></div><p> </p><p><span>The preceding</span> lifetime events will occur automatically as the <span>agent</span><a id="id325397943" class="indexterm"></a> lives and will be controlled by the Academy object that we will develop to control the training scenario. With all of those rules out of the way, we can continue to build an agent Terrarium in the next section.</p></div>