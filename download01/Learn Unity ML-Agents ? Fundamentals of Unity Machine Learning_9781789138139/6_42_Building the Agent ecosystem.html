<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec45"></a>Building the Agent ecosystem</h2></div></div><hr /></div><p>Now that we have a core set of rules, we can <span>start</span><a id="id324673124" class="indexterm"></a> to build our multi-agent ecosystem from scratch in Unity.  Previously, we spent a considerable amount of time looking at the Unity canned samples, but that was essential in order to cover all the material to get to this point in such a short time. With all the core understanding out of the way, we can now build a more complex example by following this exercise:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From the <span class="strong"><strong>Project</strong></span> window, create a new folder called <code class="literal">Terrarium</code> under <code class="literal">Assets</code>.</li><li>Create five new folders called <code class="literal">Materials</code>, <code class="literal">Prefabs</code>, <code class="literal">Scenes</code>, <code class="literal">Scripts</code>, and <code class="literal">TFModels</code><span class="strong"><strong>.</strong></span></li><li>Create a new scene called <code class="literal">Terrarium</code> in the <code class="literal">Scenes</code> folder.</li><li>Open the new <span class="strong"><strong>Terrarium</strong></span> scene and from the menu, select <code class="literal">GameObject -&gt; Create Empty</code>. Rename the object to <code class="literal">Academy</code>.</li><li>Open the <code class="literal">Scripts</code> folder in the <span class="strong"><strong>Project</strong></span> window. Create a new C# script called <code class="literal">TerrariumAcademy</code>. Edit the script so that it contains the following code:</li></ol></div><pre class="programlisting">      using UnityEngine;
        public class TerrariumAcademy : <span class="strong"><strong>Academy</strong></span> {
          public override void AcademyReset() {
          }
          public override void AcademyStep() {
          }
        }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>We won't need much code because we are extending from the standard ML-Agents <span class="strong"><strong>Academy</strong></span> script. Save the script when you're done editing it and return to Unity. Wait for the scripts to compile with no errors.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Drag the <span class="strong"><strong>TerrariumAcademy</strong></span> script <span>onto</span><a id="id324673752" class="indexterm"></a> the <span class="strong"><strong>Academy</strong></span> object to attach it as a component. Set the <span class="strong"><strong>Terrarium Academy</strong></span> component parameters as follows:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/852786cc-b624-4f47-abd9-fff72dfc5409.png" /></div><p>Setting the Academy training configuration parameters</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Setting these parameters will make sure that we can run the training session using the trainer parameter <code class="literal">--slow</code> and see the simulation run.</li></ol></div><p>This sets up the first part of our project, but we have several more steps to do. In the next section, we will import some colorful assets to make our Terrarium a little more fun.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec37"></a>Importing Unity assets</h3></div></div></div><p>One of the most compelling aspects of Unity is <span>the</span><a id="id325394027" class="indexterm"></a> Asset Store. There resides so much quality content on the store that you could literally develop an entire game without any code. Of course, we won't have that luxury, but we will take advantage of the many free assets to spice up our Terrarium. Open Unity back upand follow along to import the project assets:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From the menu, select <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Asset Store</strong></span>. The <span class="strong"><strong>Asset Store</strong></span> is currently in transition at the time of writing and some screenshots may look quite different or the assets will be gone. Either way, any low polygon creature or animal pack will do.</li><li>Enter the search text <code class="literal">gloomy animal</code> in the search bar and click search or hit enter. You will see a few search results appear. Select the asset called the <code class="literal">Free Low_Polygon Animal</code> pack, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/39f159dc-5c8d-4d06-9b4c-2a3df433ced1.png" /></div><p>Importing the low polygon animal pack</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Click <span class="strong"><strong>Download</strong></span> and then the <strong class="userinput"><code>Import</code></strong> button, as shown in the preceding screenshot. This will import the asset into the project. You will be prompted to select which assets to import. Make sure that all of the items are selected, and then click <span class="strong"><strong>Import</strong></span> on the import dialog.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Go back to <span>the</span><a id="id325400259" class="indexterm"></a><span class="strong"><strong>Asset Store</strong></span> window and search for <code class="literal">low poly toon</code><span class="strong"><strong>.</strong></span> Select the asset, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/8a9240e3-f34b-47a8-9328-f47d859b6978.png" /></div><p>Importing the low poly toon asset into the project</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Download and import the asset into the project.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip31"></a>Note</h3><p>Unity has a broad and varied selection of excellent and not so excellent assets. Be careful because not all paid assets may be what they seem and may often cause you more grief. Likewise, there are a number of excellent free assets, like the ones we are using, but there are also plenty of not so good free assets. If you are investing any time or money on an asset, be sure it works for you and your project. Many a project has suffered from asset bloat because it seemed like a good idea at the time. Remember, even free assets have a price: time.</p></div><p>With our new assets imported, we can work towards adding the environment to our project in the next section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec38"></a>Building the environment</h3></div></div></div><p>The original Terrarium game was in 2D, because that was easier at the time, but now it's actually easier for us to make our version in 3D. Aside from that improvement, we will be using <span>the</span><a id="id325402865" class="indexterm"></a> poly animals and plants instead of 2D icons. First, we will need to build our world by following this exercise:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Load up the <strong class="userinput"><code>Terrarium</code></strong> scene.</li><li>From the menu, select <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span>. Rename the new object <span class="strong"><strong>Environment</strong></span>.</li><li>Right-click (<span class="emphasis"><em>Command</em></span> click on macOS) the new <span class="strong"><strong>Environment</strong></span> object and from the context menu, select <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span>. Reset the plane's position to <code class="literal">0,0,0</code> if need be. Set the <span class="strong"><strong>Transform</strong></span> | <span class="strong"><strong>Scale</strong></span> to <code class="literal">(5,1,5)</code>.</li><li>Select the new <span class="strong"><strong>Plane</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> window and then change the <span class="strong"><strong>Material</strong></span> property of the <span class="strong"><strong>Mesh Renderer</strong></span> component to <code class="literal">brown_01</code>, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/ed2aaa2a-8da4-4ece-8f2c-212ccebd1279.png" /></div><p>Changing the plane's render material</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Create a new script called <code class="literal">LookCamera</code> in <span>the</span><a id="id325406066" class="indexterm"></a> Scripts folder and edit the contents to look as follows:</li></ol></div><pre class="programlisting">      using UnityEngine;
      using System.Collections;

      public class LookCamera : MonoBehaviour 
      { 
        public float mouseSensitivityX = 5.0f;
        public float mouseSensitivityY = 5.0f;

        float rotY = 0.0f;

        void Start()
        {
          if (GetComponent&lt;Rigidbody&gt;())
            GetComponent&lt;Rigidbody&gt;().freezeRotation = true;
        }
        void Update()
        { 
          if (Input.GetMouseButton(1)) 
          {
            float rotX = transform.localEulerAngles.y + 
            Input.GetAxis("Mouse X") * 
             mouseSensitivityX;
            rotY += Input.GetAxis("Mouse Y") * mouseSensitivityY;
            rotY = Mathf.Clamp(rotY, -89.5f, 89.5f);
            transform.localEulerAngles = new Vector3(-rotY, rotX, 0.0f);
          }
          if (Input.GetKey(KeyCode.W) || Input.GetKey(KeyCode.UpArrow))
          {
            transform.position += transform.forward * .1f;
          }
          else if (Input.GetKey(KeyCode.S) || 
          Input.GetKey(KeyCode.DownArrow))
          {
            transform.position -= transform.forward * .1f;
          }
          if (Input.GetKey(KeyCode.U))
          {
            gameObject.transform.localPosition = new Vector3(0.0f, 50.0f, 
            0.0f);
            transform.localEulerAngles = new Vector3(90f, 0.0f, 0.0f);
          }
        }
      }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>This is a basic <span class="strong"><strong>LookCamera</strong></span> script that allows you to freely move and rotate the camera through the scene. There are plenty of variations of this script free online if you want additional features. Read the script in order to figure out the controls and the special reset key.</li><li>Attach the <span class="strong"><strong>LookCamera</strong></span> script to <span>the</span><a id="id325408521" class="indexterm"></a> scene's <span class="strong"><strong>Main Camera</strong></span> and modify the objects properties in the <span class="strong"><strong>Inspector</strong></span> as follows:</li></ol></div><div class="mediaobject"><img src="/graphics/9781789138139/graphics/49e4b91f-8dc9-44ce-8462-b2f70a3c9751.png" /></div><p>Setting up the Main Camera properties and scripts</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Press the play button to run the scene. Use the <span class="strong"><strong>LookCamera</strong></span> script input controls to move the camera around the scene. Try pressing the special key to see what happens; read the script again if you're not sure what keys do what. The current version of this script is unbounded, meaning you can go anywhere. Feel free to add your own bounding box that restricts <span>the</span><a id="id325408606" class="indexterm"></a> camera.</li></ol></div><p>Now that we have our basic agent environment set up, we want to jump in and tackle adding plants and animals in the next section.</p></div></div>