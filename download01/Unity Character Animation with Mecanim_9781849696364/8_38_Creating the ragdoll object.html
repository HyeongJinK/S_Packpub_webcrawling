<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec39"></a>Creating the ragdoll object</h2></div></div><hr /></div><p>We will create the<a id="id484" class="indexterm"></a> ragdoll prefab using our female zombie character. We need to make a few changes to the scene before we add the character model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Delete the <code class="literal">Sphere</code> and <code class="literal">Cube</code> objects.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">groundPlane</code> game object.</p></li><li><p>In <span class="strong"><strong>the Inspector panel</strong></span>, set the <code class="literal">groundPlane</code> object's <span class="strong"><strong>Transform Scale</strong></span> field's <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Z</strong></span> values to <code class="literal">0.5</code>.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">FBX_Imports</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, locate <code class="literal">zombie_f</code> and drag it into the <span class="strong"><strong>Hierarchy</strong></span> panel, instancing<a id="id485" class="indexterm"></a> it in your scene.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"></a>Note</h3><p>In previous chapters, we have already created an enemy character prefab from this model, but for the ragdoll prefab we do not need the character controller, animator controller, or behavior script, so it saves time to just create the ragdoll from the source model.</p></div><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_05.jpg" /></div></li></ol></div><p>The female zombie model will load in the scene with the default material. We can add the correct material next.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec68"></a>Assigning the material</h3></div></div></div><p>Adding the right material will make it easier for us to notice any stretching on the surface of the mesh and <a id="id486" class="indexterm"></a>correct the joint limits:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <a id="id487" class="indexterm"></a><span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, locate <code class="literal">zombie_f</code> and drag it onto the character model in the <span class="strong"><strong>Scene</strong></span> view:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_06.jpg" /></div></li></ol></div><p>The correct material will appear on the model.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec67"></a>Generating the initial ragdoll</h4></div></div></div><p>The <span class="strong"><strong>Ragdoll Wizard</strong></span> is a<a id="id488" class="indexterm"></a> tool within <a id="id489" class="indexterm"></a>Unity designed to<a id="id490" class="indexterm"></a> create a basic ragdoll from a jointed and skinned character model. It works by creating a relationship between each of the major bones in the skeleton:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">zombie_f</code> game object.</p></li><li><p>From the menu bar, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Ragdoll</strong></span>.</p></li></ol></div><p>The <span class="strong"><strong>Create Ragdoll</strong></span><a id="id491" class="indexterm"></a> window will appear in the interface prompting you to assign the bones to the ragdoll hierarchy.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec18"></a>Assigning bones to the ragdoll list</h5></div></div></div><p>The <span class="strong"><strong>Create Ragdoll</strong></span> window<a id="id492" class="indexterm"></a> consists of a number of fields in which we must specify the hierarchy of the character model by dragging bones into the appropriate slots:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, <span class="emphasis"><em>Alt</em></span> + click the small arrow next to <code class="literal">zombie_f</code> to fully expand its hierarchy.</p></li><li><p>Drag <code class="literal">zombie_f_Pelvis</code> onto the <span class="strong"><strong>Pelvis</strong></span> slot in the <span class="strong"><strong>Create Ragdoll</strong></span> window.</p></li><li><p>Drag the appropriate bones into the fields in the <span class="strong"><strong>Create Ragdoll</strong></span> window:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>For the hips fields, use the thigh bones</p></li><li style="list-style-type: disc"><p>For the knee fields, use calf bones</p></li><li style="list-style-type: disc"><p>For the <span class="strong"><strong>Middle Spine</strong></span> field, use spine2</p></li><li style="list-style-type: disc"><p>Complete the list by dragging the rest of the bones to fill the positions in the window</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"></a>Note</h3><p>Note that not all bones in the hierarchy have their own fields in the listâ€”just the major joints that are expected to articulate during the ragdoll animation.</p></div><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_07.jpg" /></div></li></ol></div><p>When all the<a id="id493" class="indexterm"></a> fields are full, the warning message at the bottom of the window will disappear.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec19"></a>Assigning mass</h5></div></div></div><p>For the different <a id="id494" class="indexterm"></a>bones in the ragdoll to fall and collide realistically, we need to assign mass. Unity will then calculate the mass of each individual bone and assign these values to the appropriate <span class="strong"><strong>Rigidbody</strong></span> component:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the field for <span class="strong"><strong>Total Mass</strong></span>, enter <code class="literal">52</code>. This is the weight in kilos of the character.</p></li><li><p>Leave <span class="strong"><strong>Strength</strong></span> at its default setting of <code class="literal">0</code> and the <span class="strong"><strong>Flip Forward</strong></span> checkbox unchecked.</p><p>We will be applying force in our script.</p><p>The <span class="strong"><strong>Create</strong></span> button at the bottom of the window should now be active.</p></li><li><p>Click on the <span class="strong"><strong>Create</strong></span> button to set up the ragdoll.</p></li></ol></div><p>An arrangement of collision objects and gizmos will be added to the character game object:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_08.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec20"></a>Previewing the default ragdoll</h5></div></div></div><p>The character now<a id="id495" class="indexterm"></a> has a series of collision objects, rigidbodies, and joints added to its bones. We can now see the ragdoll functioning. To preview the ragdoll click on the <span class="strong"><strong>Play</strong></span> button in the top center of the Unity interface.</p><p>The character should drop to the ground:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_09.jpg" /></div><p>The result is not exactly what we want, but this is actually a good start. We can get better results with a few adjustments.</p><p>Each collision <a id="id496" class="indexterm"></a>object has a default size and each joint has its own default rotation limits, which have been set up to approximate the normal rotation of human joints. In the next step, we will adjust these.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec68"></a>Adjusting collision objects</h4></div></div></div><p>In video games, collision objects<a id="id497" class="indexterm"></a> are usually simple objects, which are used to approximate the physical boundaries of more complex forms.</p><p>In the humanoid <a id="id498" class="indexterm"></a>figure, these take the form of boxes, cylinders, and spheres.</p><p>When the ragdoll is switched on (by pressing the <span class="strong"><strong>Play</strong></span> to run the game), gravity is applied to the character and each connected joint will drop down until its own collision object hits another.</p><p>From looking at the results, we can see that there are some problems:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Firstly, the leg joints get stuck leaving the character arched over with her legs still placed on the ground</p></li><li style="list-style-type: disc"><p>Secondly, the head intersects with the ground</p></li></ul></div><p>We will take a closer look at the collision object settings to solve these problems.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec21"></a>Adjusting the radius of the capsule collider to fit the leg</h5></div></div></div><p>When the ragdoll is created, Unity assigns collision objects to different joints to approximate their <a id="id499" class="indexterm"></a>physical volume. Often the default settings for each collider need to be adjusted to ensure that this volume is correct for the part of the character model that it is applied to.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">zombie_f_L_Thigh</code> object.</p><p>The object's parameters will become visible in the <span class="strong"><strong>Inspector</strong></span> panel. Its components are a <span class="strong"><strong>Rigidbody</strong></span>, <span class="strong"><strong>Character Joint</strong></span>, and <span class="strong"><strong>Capsule Collider</strong></span>.</p><p>We will adjust the capsule collider's parameters in the next step.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, scroll down until you can see the <span class="strong"><strong>Capsule Collider</strong></span> properties.</p></li><li><p>Decrease the <span class="strong"><strong>Radius</strong></span> until the capsule is the same size as the widest part of the character's thigh. A setting of <code class="literal">3.09</code> should be pretty close.</p><p>Leave the remaining properties at their default settings:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_10.jpg" /></div></li><li><p>Repeat this process for the right thigh.</p></li><li><p>Change the <span class="strong"><strong>Radius</strong></span> value of the <span class="strong"><strong>Capsule Collider</strong></span> attached to each of the calves to <code class="literal">2.29</code>.</p><p>The objective is to make the collision objects match the size of the body part as close as possible, ensuring that this part of the character model does not appear to float above or intersect with the ground or any other object.</p></li><li><p>Preview the ragdoll a second time.</p></li></ol></div><p>The results should<a id="id500" class="indexterm"></a> show a big improvementâ€”the character will drop all the way to the ground and the legs will collapse naturalistically.</p><p>Our next step is to fix the head.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec22"></a>Adjusting the head's collider</h5></div></div></div><p>By default, the head <a id="id501" class="indexterm"></a>will have a sphere collider component to define its volume. With the default settings, the sphere collider's small size is causing the head to intersect with the ground plane. </p><p>In this step, we will adjust the collider to fit the character's head:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, click on <code class="literal">zombie_f_Head</code>.</p><p>In the <span class="strong"><strong>Inspector</strong></span> panel, we can see that the head has <span class="strong"><strong>Rigidbody</strong></span>, <span class="strong"><strong>Character Joint</strong></span>, and <span class="strong"><strong>Sphere Collider</strong></span> components.</p><p>By default, the <span class="strong"><strong>Radius</strong></span> value of the sphere collider is too low for it to adequately collide with the ground object. It is also positioned too low and far back to completely surround the skull.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, rescale the sphere collider's <span class="strong"><strong>Radius</strong></span> to around <code class="literal">3.26</code>.</p></li><li><p>Align the collider within the head by adjusting the <span class="strong"><strong>Center</strong></span> values in the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> fields until the collider fits just around the head in the side view.</p></li><li><p>The <span class="strong"><strong>Center Z</strong></span> value actually controls the horizontal position of the collider, so this can be left at <code class="literal">0</code>.</p><p>The sphere collider will not be a perfect fit because the head is not round, but try to fit the top half of the head as this part will most likely be colliding with other objects in the game.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip11"></a>Tip</h3><p>If you are working with a model that has a particularly long head, you can also replace the sphere with a capsule collider such as those used in the limbs.</p></div><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_11.jpg" /></div><p>We need<a id="id502" class="indexterm"></a> to scale down the box collider attached to the <code class="literal">Spine2</code> object so that the arms can fall more closely to the torso.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">zombie_f_Spine2</code>.</p></li><li><p>Change the scale and position of the box to better approximate the hard, bony areas of the torso:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_12.jpg" /></div><p>Reducing the width of the box will allow the arms to fall across the body more naturally.</p></li><li><p>Preview the ragdoll once more, by clicking on the <span class="strong"><strong>Play</strong></span> button.</p></li></ol></div><p>The results should show<a id="id503" class="indexterm"></a> improvement, but there are some issues with the arms of the character intersecting with the torso when the zombie falls to the ground.</p><p>This problem is not just due to the scale of the colliders but rather the rotational limits of the character joints, which we will adjust next:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_13.jpg" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec69"></a>Fine-tuning the character joints</h4></div></div></div><p>
<span class="strong"><strong>Character joints</strong></span> are fully adjustable<a id="id504" class="indexterm"></a> joints that can be adjusted to suit various situations. They can be set up to limit the range of motion on all three axes.</p><p>Rotational limits <a id="id505" class="indexterm"></a>were applied to all of the joints when the ragdoll object was created. We will need to adjust these settings in order to correct the range of rotation for the arm.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec23"></a>Adjusting the rotational limits of the upper arm</h5></div></div></div><p>Limiting the range <a id="id506" class="indexterm"></a>of movement in the arm joints will help us prevent the arms intersecting with the torso when the character drops to the ground:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">zombie_f_R_UpperArm</code>.</p></li><li><p>The game object's components and their values will become visible in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>We can begin to adjust the settings of the character joint starting at the top of the list of properties.</p></li><li><p>
<span class="strong"><strong>Connected Body</strong></span> is the parent object that the joint (in this case the right arm) is connected to. The object must have a <span class="strong"><strong>Rigidbody</strong></span> component attached in order to complete the chain of bones and for the ragdoll to function correctly.</p></li><li><p>
<span class="strong"><strong>Anchor</strong></span> is the point of origin of the joint. Values of <code class="literal">0, 0, 0</code> inherit the exact position of the joint's game object parentâ€”in this case, the <code class="literal">zombie_f_Spine2</code> bone, to which the joint is attached. Change the value in the <span class="strong"><strong>X</strong></span> field to <code class="literal">-1.5</code>, moving the anchor further from the center of the character.</p></li><li><p>
<span class="strong"><strong>Axis</strong></span> allows<a id="id507" class="indexterm"></a> you to set the direction in which the joint is allowed to twist. Basically, an offset from the orientation of the parent object. By default, the joint is set up to twist negatively on the <span class="strong"><strong>Z</strong></span> axis.</p></li><li><p>
<span class="strong"><strong>Swing Axis</strong></span> allows you to set the direction which the joint is allowed to rotate. By default, the joint is set up to swing negatively on the <span class="strong"><strong>Y</strong></span> axis.</p></li><li><p>
<span class="strong"><strong>Low Twist Limit</strong></span> is the value in degrees that the joint can twist negatively on the specified axis. By default, this is set to <code class="literal">-70</code>. Change this to <code class="literal">-50</code>.</p></li><li><p>
<span class="strong"><strong>High Twist Limit</strong></span> is the value in degrees that the joint can twist positively on the specified axis. By default, set to <code class="literal">10</code>. Change this to <code class="literal">40</code>.</p></li><li><p>
<span class="strong"><strong>Swing 1 Limit</strong></span> is the value in degrees that the joint can swing negatively on the specified axis. By default, set to <code class="literal">50</code>. Change this to <code class="literal">70</code>.</p></li><li><p>
<span class="strong"><strong>Swing 2 Limit</strong></span> is the value in degrees that the joint can swing positively on the specified axis. By default, set to <code class="literal">0</code>. Change this to <code class="literal">50</code>.</p></li><li><p>
<span class="strong"><strong>Break Force</strong></span> is the amount of force that needs to be applied in order to break the joint, separating the two bones.</p></li><li><p>
<span class="strong"><strong>Break Torque</strong></span> is the amount of torque that needs to be applied in order to break the joint.</p><p>These last two properties are set to <code class="literal">Infinity</code> by default ensuring that no amount of force will separate the joints.</p><p>Before moving on to the lower arm joint:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Scale down the <span class="strong"><strong>Radius</strong></span> of the <span class="strong"><strong>Capsule Collider</strong></span> component in the <code class="literal">zombie_f_R_UpperArm</code> object. A radius of 1.45 should work well.</p></li><li><p>Adjust the left-upper arm with similar settings to definite its limits and collider size.</p></li></ol></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec24"></a>Adjusting the rotational limits of the forearm</h5></div></div></div><p>We will carry on<a id="id508" class="indexterm"></a> and adjust the forearm joint to complete the right arm.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">zombie_f_R_Forearm</code>. Its properties will become visible in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Character Joint</strong></span> component, expand and look at the settings for <span class="strong"><strong>Axis</strong></span>, <span class="strong"><strong>Swing Axis</strong></span>, and all <span class="strong"><strong>Limits</strong></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="strong"><strong>Axis</strong></span> is set up to twist the joint negatively on the <span class="strong"><strong>Y</strong></span> axis.</p></li><li style="list-style-type: disc"><p>The <span class="strong"><strong>Swing Axis</strong></span> is set up to swing on the <span class="strong"><strong>Z</strong></span> axis. This will rotate the forearm forward.</p></li><li style="list-style-type: disc"><p>The <span class="strong"><strong>Low Twist Limit</strong></span> has been set to <code class="literal">-90</code>, which twists the elbow. Decrease this to <code class="literal">0</code>.</p></li><li style="list-style-type: disc"><p>The<a id="id509" class="indexterm"></a> <span class="strong"><strong>High Twist Limit</strong></span> has been set by default to <code class="literal">0</code>, which is appropriate for an elbow joint which only rotates in one direction.</p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Swing 1 Limit</strong></span> value to <code class="literal">30</code> to allow the forearm to swing backwards slightly.</p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Swing 2 Limit</strong></span> value to <code class="literal">100</code> to allow the forearm to swing forward.</p></li></ul></div><p>We can leave the remaining <span class="strong"><strong>Character Joint</strong></span> settings with their default values.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, scale down the capsule collider's <span class="strong"><strong>Radius</strong></span> to an appropriate value. A setting of <code class="literal">1.6</code> should ensure that it tightly fits around the forearm.</p></li><li><p>Repeat these adjustments to the <span class="strong"><strong>Character Joints</strong></span> and <span class="strong"><strong>Capsule Colliders</strong></span> of the left arm before moving on to the head.</p></li></ol></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec70"></a>Adjusting the rotational limits of the head</h4></div></div></div><p>Earlier in this chapter, we adjusted<a id="id510" class="indexterm"></a> the <span class="strong"><strong>Radius</strong></span> and <span class="strong"><strong>Center</strong></span> fields of the head's sphere collider to better approximate the<a id="id511" class="indexterm"></a> proportions of the character mesh.</p><p>Now, we need to adjust its rotational limits in the head's character joint:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">zombie_f_Head</code>. Its parameters and components will become visible in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>For the head, the <span class="strong"><strong>Axis</strong></span> value represents the forward and back movement of the head.</p></li><li><p>The <span class="strong"><strong>Swing Axis</strong></span> value represents the side-to-side movement. Set the <span class="strong"><strong>Swing1 Limit</strong></span> to <code class="literal">40</code>.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec25"></a>Previewing the adjusted ragdoll</h5></div></div></div><p>Press the<a id="id512" class="indexterm"></a> <span class="strong"><strong>Play</strong></span> button again to view the result of the adjustments we made to the character joints and colliders:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_14.jpg" /></div><p>Once again, the results of the ragdoll have been improved, but now that we adjusted the components in the head, it becomes obvious that the ponytail is pointing upward, not hanging down toward the ground as we would expect it to.</p><p>When we initially ran the Ragdoll Wizard, there were no joints assigned to the ponytail. We will fix this by adding our own character joint to this part of the character.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec71"></a>Adding a custom joint to the ragdoll</h4></div></div></div><p>Any bone can <a id="id513" class="indexterm"></a>have a character joint attached to it and be<a id="id514" class="indexterm"></a> added to the ragdoll animation, but it is important to respect the hierarchy of joints. In this case, it means maintaining the connection between the ponytail and the head.</p><p>After following through the previous sections in this chapter, you may have noticed that a body part requires three components to be included in a ragdoll: <span class="strong"><strong>Collider</strong></span>, <span class="strong"><strong>Rigidbody</strong></span>, and <span class="strong"><strong>Joint</strong></span>.</p><p>We will add these<a id="id515" class="indexterm"></a> one at a time and adjust the settings to make the ponytail react in a realistic way.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec26"></a>Adding a capsule collider to the ponytail</h5></div></div></div><p>Next, we will add<a id="id516" class="indexterm"></a> the necessary components to make the ponytail work with our ragdoll:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">zombie_f_Ponytail1</code>.</p></li><li><p>From the menu bar, navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Capsule Collider</strong></span> to add the collider component to the selected game object.</p><p>For organic or cylindrical organic forms, the capsule collider is a good choice because it has a rounded cross-section and a rounded end. This type of collider has already been used in the arms and legs of the character ragdoll.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, set the value in the <span class="strong"><strong>Center X</strong></span> field to <code class="literal">-0.91</code>, <span class="strong"><strong>Y</strong></span> to <code class="literal">-2.63</code>, and leave <span class="strong"><strong>Z</strong></span> at its default <code class="literal">0</code>.</p></li><li><p>Increase the radius to <code class="literal">1.03</code>.</p></li><li><p>Increase the height to <code class="literal">6.58</code>.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_15.jpg" /></div></li></ol></div><p>The new capsule<a id="id517" class="indexterm"></a> collider should fit neatly around the character's ponytail.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec27"></a>Adding a Rigidbody component</h5></div></div></div><p>The capsule collider defines<a id="id518" class="indexterm"></a> the physical volume of the ponytail, but we need to add a <span class="strong"><strong>Rigidbody</strong></span> component for it to respond to physics:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the menu bar, navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Rigidbody</strong></span>.</p><p>When we initially created the ragdoll, we specified <span class="strong"><strong>Total Mass</strong></span> of <code class="literal">52</code> kilos for the whole character. The Ragdoll Wizard divided up this weight proportionately among the various rigidbodies attached to the bones.</p><p>Here, we must manually add a mass for the ponytail.</p></li><li><p>In <span class="strong"><strong>Inspector</strong></span>, enter the value <code class="literal">0.125</code> in the <span class="strong"><strong>Mass</strong></span> field of the ponytail1 object's <span class="strong"><strong>Rigidbody</strong></span> component.</p></li><li><p>Leave the remaining properties at their default values.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec28"></a>Adding the character joint</h5></div></div></div><p>At this point, the<a id="id519" class="indexterm"></a> ponytail will be affected by physics in our Unity scene, but it needs to be properly connected to the head using a <span class="strong"><strong>Joint</strong></span> component:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the menu bar, navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Character Joint</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <code class="literal">zombie_f_Head</code> onto the <span class="strong"><strong>Connected Body</strong></span> field in the <span class="strong"><strong>Inspector </strong></span>panel.</p><p>This will ensure that the ponytail follows the rotation of the head.</p></li><li><p>In the <span class="strong"><strong>Anchor</strong></span> group, decrease the <span class="strong"><strong>X</strong></span> value to <code class="literal">-0.48</code> and increase the <span class="strong"><strong>Y</strong></span> value to <code class="literal">0.08</code>. Leave <span class="strong"><strong>Z</strong></span> at its default <code class="literal">0</code>.</p></li><li><p>Leave the remaining settings at their default values.</p></li></ol></div><p>When the animation is previewed, the ponytail will now respond to fall and collide along with the other jointed body parts:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_08_16.jpg" /></div><p>Unity's Ragdoll <a id="id520" class="indexterm"></a>Wizard is a very fast way to set up a basic humanoid ragdoll, but when we need to accommodate extra character features such as a ponytail, large nose, or an extra limb, the necessary components can be quickly added to really make the ragdoll fit the character model.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec72"></a>Saving the ragdoll as a prefab</h4></div></div></div><p>To be able to instantiate the<a id="id521" class="indexterm"></a> ragdoll during our game with a script it needs to be saved as a prefab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">zombie_f</code> game object.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, rename the game object <code class="literal">zombie_f _ragdoll</code>.</p></li><li><p>Select and delete the animator component.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Prefabs</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Drag the game object into an empty area of the <span class="strong"><strong>Assets</strong></span> panel to create the prefab.</p></li></ol></div><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, the game object will turn blue, indicating that it is an instance of a prefab. We can instantiate the ragdoll in a number of scenes.</p></div></div></div>