<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec19"></a>Importing the project assets package</h2></div></div><hr /></div><p>The asset <a id="id202" class="indexterm"></a>package that you need to follow the chapters of this book is included in the project file. If you have not already downloaded this, you will need to get it from the Packt website.</p><p>Once unzipped, you will find the <code class="literal">PACKT_CAWM.unitypackage</code> which contains the project hierarchy and sample content and code. After that follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Launch Unity.</p></li><li><p>Open your Unity project if it does not launch by default, or create a new one if you have not already done so.</p></li><li><p>Import the package by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Custom Package...</strong></span>.</p></li><li><p>In the window that appears, navigate to the location where you unzipped the project files and choose <span class="strong"><strong>PACKT_CAWM.unitypackage</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Importing Package</strong></span> dialog that appears over the main interface, make sure that all assets are checked before pressing the <span class="strong"><strong>Import</strong></span> button.</p></li></ol></div><p>It may take a short time for all of the assets to finish loading.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec24"></a>Setting up the player character</h3></div></div></div><p>Just like the<a id="id203" class="indexterm"></a> enemy characters from the previous chapters, the player character has been exported from external software as an FBX file. This file contains the rigged model. The player's material is already set up and will be applied to the model in this section.</p><p>The import settings will need to be adjusted and components added before we save the game object as a prefab. From that point, the player character can be instanced in any number of game levels.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec25"></a>Creating a new scene</h3></div></div></div><p>We will start <a id="id204" class="indexterm"></a>with a fresh scene so we can set up the character without the distractions of scenery. This can be done by creating a blank scene, using the menu bar and navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Scene</strong></span>.</p><p>In the next step we will be adding the player model.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec26"></a>Adding the player character model to the scene</h3></div></div></div><p>The player character model has been stored as a <span class="strong"><strong>Prefab</strong></span>, enabling it to be instantiated quickly in any level. The<a id="id205" class="indexterm"></a> player model's material has already been set up:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, navigate to the <code class="literal">PACKT_Prefabs</code> folder.</p></li><li><p>Locate <code class="literal">player_m</code> and drag it into the <span class="strong"><strong>Hierarchy</strong></span> panel to instance it.</p><p>The model only extends as far as the player can see in the first-person camera, though it has a full skeletal rig, allowing us to maintain compatibility with the animation sequences we are using for the zombie characters.</p><p>Our player character is Wayne, the janitor in the office building where the zombie outbreak has taken place. It is his responsibility to "clean up" the mess.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_01.jpg" /></div></li><li><p>Double-click <code class="literal">player_m</code> within the <span class="strong"><strong>Hierarchy</strong></span> panel to zoom in on the game object.</p></li></ol></div><p>The next step will<a id="id206" class="indexterm"></a> get the player character model moving.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec27"></a>Adding the character controller</h3></div></div></div><p>Unity comes<a id="id207" class="indexterm"></a> with a prefabricated <a id="id208" class="indexterm"></a><span class="strong"><strong>First-Person Shooter</strong></span> (<span class="strong"><strong>FPS</strong></span>) Controller, which will help us get up and running with our player. The FPS Controller is included in the character's controller assets package, which we need to import:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the character's asset package by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Characters</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Importing Package</strong></span> dialogue which appears over the main Unity interface. Check the <span class="strong"><strong>None</strong></span> button at the bottom.</p></li><li><p>Then check the checkboxes next to <code class="literal">Editor</code>, <code class="literal">FirstPersonCharacter CrossPlatFormInput</code>, and <code class="literal">Utility</code>.</p><p>All of the associated components will also become checked.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_02.jpg" /></div></li><li><p>Click the <span class="strong"><strong>Import</strong></span> button.</p><p>You may have to wait for a short time while the assets are loaded.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, expand the <code class="literal">Standard Assets</code> folder and then the <code class="literal">Character Controllers</code> subfolder and then finally the <code class="literal">Prefabs</code> subfolder.</p></li><li><p>Drag the <code class="literal">FPSController.prefab</code> into the <span class="strong"><strong>Scene</strong></span> view or <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, zero out the prefab's <span class="strong"><strong>Position</strong></span> coordinates, so it is centered within the world. Do this by typing <code class="literal">0</code> into the <span class="strong"><strong>Position</strong></span> fields for <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span>.</p><p>The controller <a id="id209" class="indexterm"></a>should appear as a capsule shape, with a number of gizmos and a camera icon.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel select and delete the <span class="strong"><strong>Main Camera</strong></span> object.</p><p>The <span class="strong"><strong>Main Camera</strong></span> is added with a default scene in Unity, and as <code class="literal">FPSController</code> contains a camera, we no longer need this.</p></li><li><p>If you cannot see the controller within your <span class="strong"><strong>Scene</strong></span> view, click the <code class="literal">FPSController</code> object twice within the <span class="strong"><strong>Hierarchy</strong></span> panel to zoom in on it.</p></li><li><p>Click the small arrow next to its name to expand its hierarchy.</p></li><li><p>Drag the <code class="literal">player_m</code> game object onto <code class="literal">FirstPersonCharacter</code>, making the camera the model's parent.</p></li></ol></div><p>Next, we will add some basic geometry for the floor so we can test the controller:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a plane game object by navigating to <span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span>.</p></li><li><p>Rename the plane <code class="literal">floorObject</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, zero out <code class="literal">floorObject</code> plane's position by entering <code class="literal">0</code> in the <span class="strong"><strong>Position</strong></span> fields for <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span>.</p></li><li><p>Set its scale to <code class="literal">5</code> in the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Z</strong></span> fields.</p><p>At this point if we select the <code class="literal">FPSController</code> game object, we should see its capsule collider intersecting with the <code class="literal">floorObject</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, enter <code class="literal">1</code> in the <span class="strong"><strong>Position Y</strong></span> field to move the <code class="literal">FPSController</code> up so that it sits on top of the <code class="literal">floorObject</code>.</p></li></ol></div><p>We will get the following output:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_03.jpg" /></div><p>At this point, the <code class="literal">FPSController</code> with its attached camera and player model can be navigated around the empty scene. However, the default pose will not allow us to see any part of the model<a id="id210" class="indexterm"></a> from the camera view, so we will need to import an animation clip to fine tune the player's position. Before we do this, we will adjust the camera settings a little to better suit our player.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec30"></a>Adjusting the camera height</h4></div></div></div><p>The <code class="literal">FPSController</code> object's child object <code class="literal">FirstPersonCharacter</code> contains the camera component that defines the first-person view. By default, this object is positioned around 0.8 meters up from the <a id="id211" class="indexterm"></a>center of the character controller, which is 1.8 meters high. We want to move this down to eye level, which is more natural and consistent with the height of the enemies and scenery within the game.</p><p>We will use a height of 1.67 meters, which is 5'6", a good average eye level for a human. We need to take into account that our camera is already 1 meter off the ground as it is parented to the character controller. In the <span class="strong"><strong>Inspector</strong></span> panel, set <code class="literal">FirstPersonCharacter</code> object's <span class="strong"><strong>Position Y</strong></span> value to <code class="literal">0.67</code> to correct the height.</p><p>You should see the<a id="id212" class="indexterm"></a> object move within the <span class="strong"><strong>Scene</strong></span> view. To finalize the adjustment of the <code class="literal">FirstPersonCharacter</code>, we will add an animation sequence for our character.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec28"></a>Adding the shoot idle animation</h3></div></div></div><p>The <span class="strong"><strong>shoot idle</strong></span> sequence <a id="id213" class="indexterm"></a>will show the<a id="id214" class="indexterm"></a> character in a typical shooting stance, ready to fire.</p><p>At the moment, our player does not have an animator controller, which is necessary to preview animation. We will add a temporary controller so we can view the player character model in its <code class="literal">ShootIdle</code> pose and conclude the camera adjustment:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click the <code class="literal">PACKT_Controllers</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Drag <code class="literal">ch3_1</code> into <code class="literal">player_m</code> object's empty <span class="strong"><strong>Controller</strong></span> slot, located within the <span class="strong"><strong>Animator</strong></span> component in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>The <code class="literal">ch3_1</code> animator controller will become active in the <span class="strong"><strong>Animator</strong></span> panel.</p></li><li><p>If the <span class="strong"><strong>Animator</strong></span> tab is not visible at the top of the main view panel, activate it from the main menu by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_04.jpg" /></div><p>Aside from the defaults <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>Entry</strong></span> the controller only contains a single state: <span class="strong"><strong>ShootIdle</strong></span>. This is displayed in orange, indicating that it is the default state and will become active when the scene starts:</p></li><li><p>In the <span class="strong"><strong>Animator</strong></span> panel, click the <span class="strong"><strong>ShootIdle</strong></span> state to view its parameters in the <span class="strong"><strong>Inspector</strong></span> panel. It does not currently contain an animation clip.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, locate the <code class="literal">PACKT_Animations</code> folder.</p></li><li><p>Click it to <a id="id215" class="indexterm"></a>view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Click the <code class="literal">pistol_idle</code> animation folder to view the animation clips contained within it.</p></li><li><p>Drag the <code class="literal">pistol_idle</code> animation into the <span class="strong"><strong>ShootIdle</strong></span> state's motion field to add it.</p></li><li><p>Test the game by pressing the <span class="strong"><strong>Play</strong></span> button in the top center of the Unity interface.</p><p>The default camera settings will clip the first-person model a little too much. We can fix this by adjusting the <span class="strong"><strong>Clipping Planes</strong></span> value.</p></li><li><p>Select <code class="literal">FirstPersonCharacter</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, locate the <span class="strong"><strong>Clipping Planes</strong></span> values under the <span class="strong"><strong>Camera</strong></span> component.</p></li><li><p>Set the <span class="strong"><strong>Near</strong></span> value to <code class="literal">0.05</code>.</p><p>The player's arms should now extend all the way under the camera without a gap.</p></li></ol></div><p>Next, we will add the player's gun and fine tune the position coordinates of the player character mesh.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec31"></a>Adding and parenting the gun</h4></div></div></div><p>The player<a id="id216" class="indexterm"></a> character's gun has been saved as a <span class="strong"><strong>Prefab</strong></span>. Adding it to the player will allow us to fine tune the<a id="id217" class="indexterm"></a> model's position in the first-person view:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, <span class="emphasis"><em>Alt</em></span> + click the small arrow next to <code class="literal">player_m</code> to fully expand its hierarchy.</p></li><li><p>Locate the <code class="literal">zombie_m_HandR</code> bone:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_05.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>You can also type the bone's name into the search field at the top of the <span class="strong"><strong>Hierarchy</strong></span> panel and then select it when it appears in the search list.</p></div></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click the <code class="literal">PACKT_Prefabs</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">Gun</code> prefab and drag it into the <span class="strong"><strong>Hierarchy</strong></span> panel to create an instance of it in the scene.</p></li><li><p>Drag it<a id="id218" class="indexterm"></a> onto the <code class="literal">zombie_m_HandR</code> bone<a id="id219" class="indexterm"></a> in the <span class="strong"><strong>Inspector</strong></span> panel to make it a child of that object.</p></li></ol></div><p>Because the gun has been parented to the character's right hand, we now need to offset it slightly so that it lines up correctly:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, set the transform <span class="strong"><strong>Position</strong></span> values to <code class="literal">-5.35</code>, <code class="literal">-1.08</code>, and <code class="literal">-2</code> in the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> fields.</p></li><li><p>Set the <span class="strong"><strong>Rotation</strong></span> values to <code class="literal">355</code>, <code class="literal">180</code>, and <code class="literal">74</code> in the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> fields.</p></li><li><p>Click the <span class="strong"><strong>Play</strong></span> button.</p></li><li><p>Move the controller with the <span class="emphasis"><em>W</em></span>, <span class="emphasis"><em>A</em></span>, <span class="emphasis"><em>S</em></span>, <span class="emphasis"><em>D</em></span>, or the cursor keys.</p></li></ol></div><p>You should see the hands and the gun move with the camera.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec32"></a>Saving the first-person rig as a prefab</h4></div></div></div><p>We have a few<a id="id220" class="indexterm"></a> more changes to make to our first-person rig, but before we get too far ahead it would be useful to be able to see the level that the player will interact with.</p><p>To use our first-person controller in a new scene we need to save it as a prefab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click the <code class="literal">PACKT_Prefabs</code> folder. Its contents should become visible in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Select the <code class="literal">FPSController</code> parent game object in the <span class="strong"><strong>Hierarchy</strong></span> panel and drag it into an empty space in the <span class="strong"><strong>Assets</strong></span> panel.</p></li></ol></div><p>This will store it as a prefab, allowing us to use it again and again.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip07"></a>Tip</h3><p>Dragging a game object onto another prefab in the <span class="strong"><strong>Assets</strong></span> panel will replace the prefab, so be careful about where you drag. A dialog will pop up to warn you if you are in danger of doing this.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec33"></a>Adding the office-level scene</h4></div></div></div><p>The level geometry<a id="id221" class="indexterm"></a> that we will add has been saved as a prefab.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, locate the <code class="literal">PACKT_Prefabs</code> folder and click it to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, locate <code class="literal">LevelGeometry</code> and drag it into the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li></ol></div><p>The level geometry will appear in the scene. It contains lights and colliders:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_06.jpg" /></div><p>We can now<a id="id222" class="indexterm"></a> delete the temporary floor object used to test the <code class="literal">FPSController</code>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">floorObject</code>.</p></li><li><p>Press <span class="emphasis"><em>Delete</em></span> on the keyboard (<span class="emphasis"><em>Cmd</em></span> + <span class="emphasis"><em>Delete</em></span> if you are working on a Mac).</p></li><li><p>Select and deactivate the default <span class="strong"><strong>Directional Light</strong></span> object by selecting it in the <span class="strong"><strong>Hierarchy</strong></span> panel and then unchecking the checkbox next to its name in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li></ol></div><p>Next, we need to move the <code class="literal">FPSController</code> to a convenient position so we can see the level geometry:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">FPSController</code> game object.</p></li><li><p>Use the <span class="strong"><strong>Move</strong></span> tool to position the <code class="literal">FPSController</code> so that it is near the entrance to the office.</p></li><li><p>Switch to the <span class="strong"><strong>Rotate</strong></span> tool and turn the <code class="literal">FPSController</code> so that it faces towards the space between the rows of office cubes:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_07.jpg" /></div></li></ol></div><p>If we switch to <a id="id223" class="indexterm"></a><span class="strong"><strong>Play</strong></span> mode at this point, we should be able to clearly see the level and move around it using the <span class="emphasis"><em>W</em></span>, <span class="emphasis"><em>A</em></span>, <span class="emphasis"><em>S</em></span>, and <span class="emphasis"><em>D</em></span> keys.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_08.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec34"></a>Completing the camera setup</h4></div></div></div><p>We still need to<a id="id224" class="indexterm"></a> complete our camera setup before we do anything else:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">FirstPersonCharacter</code>. If this is not visible, expand the hierarchy of its parent object <code class="literal">FPSController</code> by clicking the small arrow next to its name.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, change the <span class="strong"><strong>Field of View</strong></span> to <code class="literal">45</code> degrees under the <span class="strong"><strong>Camera</strong></span> component parameters.</p></li></ol></div><p>Based on this setup, we can move the <code class="literal">player_m</code> game object forward, along the <span class="emphasis"><em>z</em></span> axis, until we can see enough of the arms within the view.</p><p>The exact position is personal preference, but your limitations are also based on where the arm model ends:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <code class="literal">player_m</code> game object in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>Set the <span class="strong"><strong>Z</strong></span> position to <code class="literal">0.25</code>.</p></li></ol></div><p>Now we need to save our prefab so that our changes are stored:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select <code class="literal">FPSController</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, click the <span class="strong"><strong>Apply</strong></span> button near the top of the panel.</p></li></ol></div><p>The prefab has been saved.</p><p>Our next task is to create an additional state for the character to allow us to shoot.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec35"></a>Modifying the animator controller</h4></div></div></div><p>When we started the section, we used an existing animator controller setup with an idle animation so <a id="id225" class="indexterm"></a>we could see our character's arms move.</p><p>Now we will add an additional animation sequence so we can get some action into the game:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, click the <code class="literal">player_m</code> game object.</p></li><li><p>Click the <span class="strong"><strong>Animator</strong></span> tab in the main Unity interface.</p><p>The animator controller named <code class="literal">ch3_1</code> should be visible in the window. Its name should be visible in the bottom right of the interface.</p></li><li><p>Create a new state in the animator graph by right-clicking and selecting <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span> from the dropdown list.</p></li><li><p>Click the new state and rename it <code class="literal">Shoot</code> in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>The shoot animation has already been prepared.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, select the <code class="literal">PACKT_Animations</code> folder and locate <code class="literal">shoot</code>.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, click the <code class="literal">shoot</code> subfolder to expand its contents.</p></li><li><p>Drag the <code class="literal">shoot</code> animation file into the <span class="strong"><strong>Shoot</strong></span> state's motion field in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li></ol></div><p>Having added<a id="id226" class="indexterm"></a> the motion clip, we still need to create and set the transition.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec36"></a>Setting the transition</h4></div></div></div><p>The transition will <a id="id227" class="indexterm"></a>connect our two states and determine when to switch between them:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right-click the <span class="strong"><strong>Shoot Idle</strong></span> state and choose <span class="strong"><strong>Make Transition</strong></span>.</p><p>An arrow will appear.</p></li><li><p>Drag the transition line to the <span class="strong"><strong>Idle</strong></span> state and click it to complete the transition.</p></li></ol></div><p>Next we need to choose a parameter that the transition will operate with.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec08"></a>Creating a trigger parameter for the Shoot state</h5></div></div></div><p>For this transition we<a id="id228" class="indexterm"></a> will use a <span class="strong"><strong>Trigger</strong></span> parameter, which we previously used in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>The Zombie Attacks!</em></span>, when we set up the zombie's attack:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click the <span class="strong"><strong>Parameters</strong></span> tab in the upper-right of the <span class="strong"><strong>Animator</strong></span> window if it is not already active.</p></li><li><p>Click the <span class="strong"><strong>+</strong></span> symbol to create a new parameter and choose <span class="strong"><strong>Trigger</strong></span>.</p></li><li><p>Name this parameter <code class="literal">Shooting</code>.</p></li><li><p>Select the transition between <code class="literal">ShootIdle</code> and <code class="literal">Shoot</code> by clicking on the arrow connecting them in the <span class="strong"><strong>Animator</strong></span> panel.</p><p>This will bring up the transition's settings within the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Select the <code class="literal">Shooting</code> parameter from the <span class="strong"><strong>Conditions</strong></span> group near the bottom of the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Check that the <span class="strong"><strong>Has Exit Time</strong></span> checkbox is checked.</p></li></ol></div><p>This will ensure that the player character will return to its <span class="strong"><strong>ShootIdle</strong></span> state after <span class="strong"><strong>Shoot</strong></span> has been triggered at this point, our animator controller has got two complete states, linked together with a transition:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_03_09.jpg" /></div><p>Preview the game, by pressing the <span class="strong"><strong>Play</strong></span> button.</p><p>In the <span class="strong"><strong>Scene</strong></span> view you should see the <span class="strong"><strong>Shoot</strong></span> state looping constantly. In the <span class="strong"><strong>Animator</strong></span> window this <a id="id229" class="indexterm"></a>will be visualized as a blue progress bar. Pressing the <span class="strong"><strong>Fire1</strong></span> button will not activate the <span class="strong"><strong>Shooting</strong></span> state until we define this in a script.</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec29"></a>Writing and implementing the character animation script</h3></div></div></div><p>At this point, we<a id="id230" class="indexterm"></a> have our basic state machine ready to go, but we still need to send a message to the animator controller to<a id="id231" class="indexterm"></a> trigger the <span class="strong"><strong>Shoot</strong></span> state.</p><p>We will do this in a short script. I am using Javascript here, but you will also find the completed code in C# in the project files:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, locate the <code class="literal">PACKT_Scripts</code> folder and click it to select it.</p></li><li><p>Create a new Javascript file in the folder by navigating to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Javascript.</strong></span>
</p></li><li><p>When the file appears in the folder, click on it twice and rename it <code class="literal">FPSAnimation</code>.</p></li><li><p>Double-click on the file to open it in MonoDevelop.</p></li></ol></div><p>This time we will build the code step-by-step, resulting in an animation state switch affected by the fire button.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec30"></a>Adding the initial code to the FPSAnimation script</h3></div></div></div><p>The player animation<a id="id232" class="indexterm"></a> script is only used in the player game object. It will connect directly with the animator controller that we just set up:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>At the top of the script, add the following line code:</p><div class="informalexample"><pre class="programlisting">var thisAnimator : Animator;</pre></div><p>The variable <code class="literal">thisAnimator</code> is defined as a type animator. This will keep track of the animator controller that this script will use.</p></li><li><p>Between the opening and closing brackets of the <code class="literal">Start</code> function, add the following code:</p><div class="informalexample"><pre class="programlisting">thisAnimator = GetComponent(Animator);</pre></div><p>Here we define the <code class="literal">thisAnimator</code> variable as the animator component attached to the same game object as this script.</p></li><li><p>Add the following code to the <code class="literal">Update</code> function so it matches the following code:</p><div class="informalexample"><pre class="programlisting">function Update()
{
    if(Input.GetButton("Fire1"))
    {
        thisAnimator.SetBool("Shooting",true);
        Shoot();
    }
}</pre></div></li><li><p>Save the script</p></li></ol></div><p>Once it has been defined, the animator controller's parameters can be set and returned.</p><p>The <code class="literal">if</code> statement checks for the player input. In this case, the <span class="strong"><strong>Fire1</strong></span> button. This is defined as the left-mouse button in the<a id="id233" class="indexterm"></a> <span class="strong"><strong>Unity Input Manager</strong></span> by default.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip08"></a>Tip</h3><p>Player input such as this is often checked inside of the <code class="literal">Update</code> function, mainly because <code class="literal">Update</code> runs every frame, making it highly responsive to input.</p></div><p>Inside the <code class="literal">if</code> statement, we use the variable <code class="literal">thisAnimator</code>, which we set up at the start of the function, setting the <span class="strong"><strong>Trigger</strong></span> parameter <code class="literal">Shooting</code> (inside of the animator controller ) to <code class="literal">true</code>. This is the operative part of the script, which will allow our shoot animation to run.</p><p>The <code class="literal">Shoot</code> function will then run, we will add this next:</p><p>At the bottom of the script, add the following code:</p><div class="informalexample"><pre class="programlisting">function Shoot()
{
    yield WaitForSeconds(0.5);
    thisAnimator.SetBool("Shooting", false);
}</pre></div><p>We will<a id="id234" class="indexterm"></a> leave this blank for now, but this is where we will define what happens other than the animation when the fire button is pressed.</p><p>Now that we have written our script, we need to add it to the <code class="literal">player_m</code> game object.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec31"></a>Adding the script to the player character game object</h3></div></div></div><p>As a component, our<a id="id235" class="indexterm"></a> script needs to be attached to the game object to work:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">player_m</code> game object.</p></li><li><p>In the <code class="literal">PACKT_Scripts</code> folder, drag <code class="literal">FPSAnimation</code> onto <code class="literal">player_m</code> to add the script as a component.</p><p>It is important that we are adding the script to the game object with the animator component attached.</p></li><li><p>Test the game again by clicking the <span class="strong"><strong>Play</strong></span> button in the top center of the Unity interface.</p></li></ol></div><p>Now when the left mouse button is pressed, the <code class="literal">Shoot</code> animation will play.</p><p>In this example we are checking to see whether the mouse button is being pressed, and if so, we are setting the <code class="literal">Shooting</code> trigger to <code class="literal">true</code>, which initiates the <span class="strong"><strong>Shoot</strong></span> state in the animator controller.</p><p>Keep your <span class="strong"><strong>Animator</strong></span> window visible (and undocked) when you press the <span class="strong"><strong>Play</strong></span> button and you will see a blue progress bar in the <span class="strong"><strong>Idle</strong></span> state, and then in the <span class="strong"><strong>Shoot</strong></span> state as you press the button.</p><p>Next we will save our changes to the <code class="literal">FPSController</code> prefab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">FPSController</code> game object by clicking it once.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel click the <span class="strong"><strong>Apply</strong></span> button near the top right.</p></li></ol></div><p>This will save the prefab and all its components and children.</p><p>This extra set of buttons in the <span class="strong"><strong>Inspector</strong></span> panel is only available for prefab objects, it allows us to make changes and either keep or discard them.</p><p>In the next step <a id="id236" class="indexterm"></a>we will allow the player to collect items.</p></div></div>