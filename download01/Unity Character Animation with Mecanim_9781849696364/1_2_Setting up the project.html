<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec10"></a>Setting up the project</h2></div></div><hr /></div><p>Before we start exploring<a id="id0" class="indexterm"></a> the animation workflow with Mecanim's tools, we need to set up the Unity project:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new project within Unity by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Project...</strong></span>.</p></li><li><p>When prompted, choose an appropriate name and location for the project.</p></li><li><p>In the <span class="strong"><strong>Unity - Project Wizard</strong></span> dialog that appears, check the relevant boxes for the <span class="strong"><strong>Character Controller.unityPackage</strong></span> and <span class="strong"><strong>Scripts.unityPackage</strong></span> packages.</p></li><li><p>Click on the <span class="strong"><strong>Create</strong></span> button. It may take a few minutes for Unity to initialize.</p></li><li><p>Download the project ZIP file for this book from the Packt website. The file contains a Unity <a id="id1" class="indexterm"></a>assets package with the content necessary for the projects in this book.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"></a>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com" target="_blank">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support" target="_blank">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></li><li><p>When the Unity interface appears, import the <code class="literal">PACKT_CAWM</code> package by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Custom Package...</strong></span>.</p></li><li><p>The <span class="strong"><strong>Import package...</strong></span> window will appear.</p></li><li><p>Navigate to the location where you unzipped the project files, select the unity package, and click on <span class="strong"><strong>Open</strong></span>.</p><p>The assets package will take a little time to decompress.</p></li><li><p>When the <span class="strong"><strong>Importing Package</strong></span> checklist appears, click on the <span class="strong"><strong>Import</strong></span> button in the bottom-right of the window.</p></li></ol></div><p>Once the assets have finished importing, you will start with a default blank scene.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec08"></a>Importing our enemy</h3></div></div></div><p>Now, it is time to import <a id="id2" class="indexterm"></a>our character model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Minimize Unity.</p></li><li><p>Navigate to the location<a id="id3" class="indexterm"></a> where you unzipped the project files.</p></li><li><p>Double-click on the <span class="strong"><strong>Models</strong></span> folder to view its contents.</p></li><li><p>Double-click on the <code class="literal">zombie_m</code> subfolder to view its contents.</p><p>The folder contains an FBX file containing the rigged male zombie model and a separate subfolder containing the associated textures.</p></li><li><p>Open Unity and resize the window so that both Unity and the <code class="literal">zombie_m</code> folder contents are visible.</p></li><li><p>In Unity, click on the <span class="strong"><strong>Assets</strong></span> folder in the <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>Drag the <code class="literal">zombie_m</code> FBX asset into the <span class="strong"><strong>Assets</strong></span> panel to import it.</p><p>Because the FBX file contains a normal map, a window will pop up asking if you want to set this file's import settings to read it correctly.</p></li><li><p>Click on the <span class="strong"><strong>Fix Now</strong></span><a id="id4" class="indexterm"></a> button.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note02"></a>Note</h3><p>FBX files can contain <a id="id5" class="indexterm"></a>embedded bitmap textures, which can be imported with the model. This will create subfolders containing the materials and textures within the folder where the model has been imported. Leaving the materials and textures as subfolders of the model will make them difficult to find within the project.</p></div></li></ol></div><p>The zombie model and two folders should now be visible in the <code class="literal">FBX_Imports</code> folder in the <span class="strong"><strong>Assets</strong></span> panel.</p><p>In the next step, we will move the imported material and texture assets into the appropriate folders in the Unity project.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec01"></a>Organizing the material and textures</h4></div></div></div><p>The material and textures <a id="id6" class="indexterm"></a>associated with the <code class="literal">zombie_m</code> model are currently located within the <code class="literal">FBX_Imports</code> folder. We will move these into different folders to<a id="id7" class="indexterm"></a> organize them within the hierarchy of our project:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Double-click on the <code class="literal">Materials</code> folder and drag the material asset contained within it into the <code class="literal">PACKT_Materials</code> folder in the <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>Return to the <code class="literal">FBX_Imports</code> folder by clicking on its title at the top of the <span class="strong"><strong>Assets</strong></span> panel interface.</p></li><li><p>Double-click on the textures folder. This will be named to be consistent with the model.</p></li><li><p>Drag the two bitmap textures into the <code class="literal">PACKT_Textures</code> folder in the <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>Return to the <code class="literal">FBX_Imports</code> folder and delete the two empty subfolders.</p><p>The moved material and textures will still be linked to the model. We will make sure of this by instancing it in the current empty scene.</p></li><li><p>Drag the <code class="literal">zombie_m</code> asset into the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li></ol></div><p>It may not be immediately visible within the <span class="strong"><strong>Scene</strong></span> view due to the default import scale settings.</p><p>We will take care of this in the next step.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec02"></a>Adjusting the import scale</h4></div></div></div><p>Unity's import settings can be adjusted to account for the different tools commonly used to create 2D and 3D <a id="id8" class="indexterm"></a>assets. Import settings are adjusted in the <span class="strong"><strong>Inspector</strong></span> panel, which will appear on the right of the unity interface by default:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <code class="literal">zombie_m</code> game object within the <span class="strong"><strong>Hierarchy</strong></span> panel.</p><p>This will bring up the file's import settings in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Click on the <span class="strong"><strong>Model</strong></span> tab.</p></li><li><p>In the <span class="strong"><strong>Scale Factor</strong></span> field, highlight the current number and type <code class="literal">1</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note03"></a>Note</h3><p>The character model has been modeled to scale in <span class="emphasis"><em>meters</em></span> to make it compatible with Unity's units. All 3D software applications have their own native scale. Unity does a pretty good job at accommodating all of them, but it often helps to know which software was used to create them.</p></div></li><li><p>Scroll down until the <span class="strong"><strong>Materials</strong></span> settings are visible.</p></li><li><p>Uncheck the <span class="strong"><strong>Import Materials</strong></span> checkbox.</p><p>Now that we have got our textures and materials organized within the project, we want to make sure they are not continuously imported into the same folder as the model.</p></li><li><p>Leave the remaining <span class="strong"><strong>Model Import</strong></span> settings at their default values.</p><p>We will be discussing these later on in the book, when we demonstrate the animation import.</p></li><li><p>Click on the <span class="strong"><strong>Apply</strong></span> button. You may need to scroll down within the <span class="strong"><strong>Inspector</strong></span> panel to see this:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_01.jpg" /></div></li></ol></div><p>The <code class="literal">zombie_m</code> character <a id="id9" class="indexterm"></a>should now be visible in the <span class="strong"><strong>Scene</strong></span> view:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_02.jpg" /></div><p>This character model is a medium resolution modelâ€”4410 triangles and has a single 1024 x 1024 albedo texture and separate 1024 x 1024 specular and normal maps.</p><p>The character has been<a id="id10" class="indexterm"></a> rigged with a basic skeleton. Creating a skeletal rig will be discussed in detail in the next chapter. The rigging process is essential if the model is to be animated.</p><p>We need to save our progress, before we get any further:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Save the scene by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save Scene as...</strong></span>.</p></li><li><p>Choose an appropriate filename for the scene, such as <code class="literal">Chapter1_1</code>.</p></li><li><p>Click on the <span class="strong"><strong>Apply</strong></span> button.</p></li></ol></div><p>Despite the fact that we have only added a single game object to the default scene, there are more steps that we will need to take to set up the character and it will be convenient for us to save the current set up in case anything goes wrong.</p><p>In the character animation, there are looping and single-shot animation sequences. Some animation sequences such as walk, run, idle are usually seamless loops designed to play back-to-back without the<a id="id11" class="indexterm"></a> player being aware of where they start and end.</p><p>Other sequences, typically, shooting, hitting, being injured or dying are often single-shot animations, which do not need to loop. We will start with this kind, and discuss looping animation sequences later in the book.</p><p>In order to use Mecanim's animation tools, we need to set up the character's Avatar so that the character's hierarchy of bones is recognized and can be used correctly within Unity.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec03"></a>Adjusting the rig import settings and creating the Avatar</h4></div></div></div><p>Now that we have<a id="id12" class="indexterm"></a> imported the model, we will need to adjust the<a id="id13" class="indexterm"></a> import settings so that the character functions<a id="id14" class="indexterm"></a> correctly within our scene:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select <code class="literal">zombie_m</code> in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>The asset's import settings<a id="id15" class="indexterm"></a> should become visible within the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>This settings rollout contains three tabs: <span class="strong"><strong>Model</strong></span>, <span class="strong"><strong>Rig</strong></span>, and <span class="strong"><strong>Animations</strong></span>.</p></li><li><p>Since we have already adjusted the <span class="strong"><strong>Scale Factor</strong></span> within the <span class="strong"><strong>Model Import</strong></span> settings, we will move on to the <span class="strong"><strong>Rig</strong></span> import settings where we can define what kind of skeleton our character has.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch01lvl4sec01"></a>Choosing the appropriate rig import settings</h5></div></div></div><p>Mecanim has three<a id="id16" class="indexterm"></a> options for importing rigged <a id="id17" class="indexterm"></a>models: <span class="strong"><strong>Legacy</strong></span>, <span class="strong"><strong>Generic</strong></span>, and <span class="strong"><strong>Humanoid</strong></span>. It <a id="id18" class="indexterm"></a>also has a <span class="emphasis"><em>none</em></span> option that should be applied to models that<a id="id19" class="indexterm"></a> are not intended to<a id="id20" class="indexterm"></a> be animated.</p><p>Legacy format was <a id="id21" class="indexterm"></a>previously the only option for importing skeletal animation in Unity. It is not possible to retarget animation sequences between models using Legacy, and setting up functioning state machines requires quite a bit of scripting. It is still a useful tool for importing models with fewer animation sequences and for simple mechanical animations. Legacy format animations are not compatible with Mecanim.</p><p>Generic is one of the new animation formats that are compatible with Mecanim's animator controllers. It does not have the full functionality of Mecanim's character animation tools. Animations sequences imported with the generic format cannot be retargeted and are<a id="id22" class="indexterm"></a> best used for quadrupeds, mechanical devices, pretty much anything except a character with two arms and two legs.</p><p>The <span class="strong"><strong>Humanoid</strong></span> animation type<a id="id23" class="indexterm"></a> allows the full use of Mecanim's powerful toolset. It requires a minimum of 15 bones, and assumes that your rig is roughly human shaped with a pair of arms and legs. It can accommodate many more intermediary joints and some basic facial animation.</p><p>One of the greatest benefits of using the <span class="strong"><strong>Humanoid</strong></span> type is that it allows animation sequences to be<a id="id24" class="indexterm"></a> retargeted or adapted to work with different rigs. For instance, you may have a detailed player character model with a full skeletal rig (including fingers and toes joints), maybe you want to reuse this character's idle sequence with a background character that is much less detailed, and has a simpler arrangement of bones.</p><p>Mecanim makes it possible<a id="id25" class="indexterm"></a> reuse purpose built motion sequences and even create useable sequences from motion capture data.</p><p>Now that we have introduced these three rig types, we need to choose the appropriate setting for our imported zombie character, which in this case is <span class="strong"><strong>Humanoid</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, click on the <span class="strong"><strong>Rig</strong></span> tab.</p></li><li><p>Set the <span class="strong"><strong>Animation Type</strong></span> field to <code class="literal">Humanoid</code> to suit our character skeleton type.</p></li><li><p>Leave <span class="strong"><strong>Avatar Definition</strong></span> set to <span class="strong"><strong>Create From This Model</strong></span>.</p></li><li><p>
<span class="strong"><strong>Optimize Game Objects</strong></span> can be left checked.</p></li><li><p>Click on the <span class="strong"><strong>Apply</strong></span> button to save the settings and transfer all of the changes that you have made to the instance in the scene.</p></li></ol></div><p>This is how the screenshot will look like:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_03.jpg" /></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip03"></a>Tip</h3><p>The <span class="strong"><strong>Humanoid</strong></span> animation type<a id="id26" class="indexterm"></a> is the only one that supports retargeting. So if you are importing animations that are not unique and will be used for multiple characters, it is a good idea to use this setting.</p></div><p>In the next step, we will <a id="id27" class="indexterm"></a>define the hierarchy of the joints in the Avatar.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch01lvl4sec02"></a>Creating the Avatar</h5></div></div></div><p>The <span class="strong"><strong>Avatar Mapping</strong></span> settings allow you to specify how the bones relate to the model. You can think of the Avatar as an intermediary device that translates between the character model and the<a id="id28" class="indexterm"></a> animations. It will dictate how motion will be transferred to the model, so it is important that all of the models bones are correctly identified within the hierarchy.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, click on the <span class="strong"><strong>Configure...</strong></span> button to bring up the <span class="strong"><strong>Avatar Mapping</strong></span> settings.</p><p>Unity will prompt you to save your scene, which is necessary because the Avatar definition is actually done in a separate, temporary scene.</p></li><li><p>Click on the <span class="strong"><strong>Save Scene</strong></span> button.</p><p>The <span class="strong"><strong>Avatar Definition</strong></span> panel will become active in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>The <span class="strong"><strong>Mapping</strong></span> tab should be active by default. This shows a simplified diagram of a humanoid bone hierarchy. Beneath the diagram is a list where bones are selected.</p></li><li><p>Choose the <span class="strong"><strong>Mapping</strong></span> rollout in the bottom left of the panel.</p></li><li><p>Click on <span class="strong"><strong>Automap</strong></span>, Unity will attempt to assign the bones to the slots in the <span class="strong"><strong>Avatar</strong></span> based on their names and position within the hierarchy.</p></li></ol></div><p>Because our <a id="id29" class="indexterm"></a>character's skeleton uses recognized naming conventions, Unity should have automatically put each bone into the right slot within the mapping definition. Any unidentified positions will show up in <span class="emphasis"><em>red</em></span>, and any non-essential or optional bones that have not been identified will be displayed in <span class="emphasis"><em>gray</em></span>.</p><p>Above the actual bone definition slots, there are alternate tabs for the body, head, left hand, and right hand, where more joints can be defined for more detailed rigs. With the exception of the head and neck, the bones covered under the <span class="strong"><strong>Head</strong></span> tab are not that important right now. Facial animation will be covered later, in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Talking Heads</em></span>.</p><p>The rest of the bones in the list for body, left hand, and right hand will need to be allocated. You can scroll down in the panel to see the names of the bones from your hierarchy and which position they have been placed in within the Avatar.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip04"></a>Tip</h3><p>Note that the Avatar mapping definition only has two positions available for spine bones, if the character you are mapping has more than two bones in its spine (like this example), you can decide which of them to use.</p><p>I usually leave out the upper-spine bone, as it typically contains very little data in animation sequences, and because of its proximity to the neck and shoulders, which usually have more influence on the vertices of the model.</p></div><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_04.jpg" /></div><p>A common occurrence<a id="id30" class="indexterm"></a> at this point of the process is a red warning display in your <span class="strong"><strong>Scene</strong></span> view notifying you that the character is not in T-pose:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_05.jpg" /></div><p>This is a simple fix, as <a id="id31" class="indexterm"></a>we will demonstrate in the next step.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h6 class="title"><a id="ch01lvl5sec01"></a>Adjusting the character's pose</h6></div></div></div><p>Mecanim requires<a id="id32" class="indexterm"></a> character models to be in a T-pose for them to be properly processed. The true T-pose is not a universal default pose for character models, and luckily Mecanim has a way to accommodate this:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <span class="strong"><strong>Pose</strong></span> rollout at the bottom of the <span class="strong"><strong>Avatar Mapping</strong></span> tab within the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Choose <span class="strong"><strong>Enforce T-pose</strong></span>. This will force your characters arms into a true T-pose so that they are Mecanim compatible.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note04"></a>Note</h3><p>You may wonder why we don't just model a character in a T-pose rather than something more like an <span class="emphasis"><em>M</em></span>. The main reason is that, while it is on the screen, the character's arms will usually be down by its side, modeling the arms at 45 degrees rather than 90 will minimize the amount of stretching of the mesh and textures.</p></div></li></ol></div><p>Dedicated motion editing packages, such as Autodesk MotionBuilder, also require a true T-pose, so the <span class="strong"><strong>Enforce T-Pose</strong></span> option within Mecanim is a good compromise and a nice touch, which saves us<a id="id33" class="indexterm"></a> having to remodel or rerig a character in order to use these tools.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_06.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h6 class="title"><a id="ch01lvl5sec02"></a>Checking the bone hierarchy in the Avatar</h6></div></div></div><p>Mecanim's Avatar definition tools are responsive to bone hierarchy and naming conventions. If you are <a id="id34" class="indexterm"></a>working with several character rigs that have the same bone names, it is likely you will only need to tweak the settings the first time.</p><p>The tool sometimes goes wrong. When this is the case, make sure you follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Once you initiate the mapping process, the skeleton in your <span class="strong"><strong>Hierarchy</strong></span> panel is expanded to make it easy to drag and drop. All you have to do is drag the bones from the <span class="strong"><strong>Hierarchy</strong></span> panel into the appropriate slot in the list.</p></li><li><p>Take the time to check the bones in the list to make sure that there are no mistakes.</p></li><li><p>Optional bones, such as the neck and toes, are quite often left out by the automatic mapping, so it is a good idea to add them (in the appropriate definition slots), at this stage, before you apply the settings.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note05"></a>Note</h3><p>If you make a mistake, just drag the correct bone onto the field in the list to replace it.</p></div></li><li><p>When you are finished, click on <span class="strong"><strong>Done</strong></span>. This will save the settings of the Avatar and apply them to the instance of the model in the scene.</p></li></ol></div><p>The Avatar asset will now be referenced in the <span class="strong"><strong>Animator</strong></span> component of the character game object, which can be viewed in the <span class="strong"><strong>Inspector</strong></span> panel:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_07.jpg" /></div><p>At this point, our Avatar is configured, creating a link to our character's skeleton hierarchy that Unity can use.</p><p>Next, we will lay the ground <a id="id35" class="indexterm"></a>work to add a simple animation that will run in the game.</p></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec09"></a>Setting up the animator controller</h3></div></div></div><p>Mecanim requires an animator<a id="id36" class="indexterm"></a> controller to connect compatible animation clips with the character model. This is displayed as a node-based interface, which shows the relationships between different animation clips and the <a id="id37" class="indexterm"></a>parameters that trigger them.</p><p>We can continue with the scene, or if you have closed Unity since working on the last section, re-open the scene that you saved. You can open the scene by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open Scene</strong></span> | <span class="strong"><strong>PACKT_Scenes</strong></span> | <span class="strong"><strong>Chapter1_1</strong></span>.</p><p>Assets imported <a id="id38" class="indexterm"></a>with animation will have space for an animator controller to be added to them. Follow these steps to create the controller:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <code class="literal">PACKT_Controllers</code> folder in the <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>Navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Animator Controller</strong></span>.</p></li><li><p>The <span class="strong"><strong>Animator Controller</strong></span> icon will appear in the <span class="strong"><strong>Assets</strong></span> panel in the lower-center of the interface.</p></li><li><p>Rename this <code class="literal">zombieControl</code>.</p></li><li><p>Click on the <span class="strong"><strong>Animator</strong></span> tab to open the <span class="strong"><strong>Animator</strong></span> panel. If this is not visible, add it in the menu bar by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span>.</p></li><li><p>Drag the <span class="strong"><strong>Animator</strong></span> tab above its current position to undock it as a window.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note06"></a>Note</h3><p>Undocking the <span class="strong"><strong>Animator</strong></span> panel is not strictly necessary, especially if you are working with on a large monitor, but it will give you more space to view the whole state machine as it is created.</p></div></li></ol></div><p>In the newly created animator controller, there are two visible states, labeled <span class="strong"><strong>Entry</strong></span> and <span class="strong"><strong>Any State</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_08.jpg" /></div><p>The <span class="strong"><strong>Entry</strong></span> state will usually be the starting point when the game starts or when the character is instantiated. We can use <span class="strong"><strong>Any State</strong></span> to override states, which are currently running if we want<a id="id39" class="indexterm"></a> something else to take priority.</p><p>Setting up a number of states for animation clips will enable greater control over the implementation of the animated sequences. We will add more states in the next step.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec04"></a>Creating states</h4></div></div></div><p>States are the building <a id="id40" class="indexterm"></a>blocks of the animator controller. Each state includes one or more motion clip. States are linked using <span class="strong"><strong>Transitions</strong></span>, visually <a id="id41" class="indexterm"></a>presenting the order in which states will become active:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new state by right-clicking on the empty part of the animator graph.</p></li><li><p>Navigate to <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span>.</p></li><li><p>Select the state by clicking on it. Rename it <code class="literal">Idle</code> in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Create a second state in the same way. Name this <code class="literal">Hit</code> in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li></ol></div><p>Next, we will add the appropriate animation clips to the states:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <code class="literal">PACKT_Animations</code> folder within the <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, expand both the <code class="literal">zombie_idle</code> and <code class="literal">zombie_attack</code> animation assets by clicking on the small arrow on the right side of their icons.</p></li><li><p>Select the <span class="strong"><strong>Idle</strong></span> state in the <span class="strong"><strong>Animator</strong></span> window.</p></li><li><p>Drag the <code class="literal">zombie_idle</code> animation to the <span class="strong"><strong>Motion</strong></span> slot in the <span class="strong"><strong>Inspector</strong></span> panel:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_09.jpg" /></div></li><li><p>Select the <span class="strong"><strong>Hit</strong></span> state and <a id="id42" class="indexterm"></a>drag the <code class="literal">hit</code> animation from the expanded <code class="literal">zombie_attack</code> asset into the <span class="strong"><strong>Motion</strong></span> slot in the <span class="strong"><strong>Inspector</strong></span> panel:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_10.jpg" /></div></li></ol></div><p>These animations are now tied to the states that we have set up.</p><p>At the moment, the states are unconnected. To connect them, you need to create a parameter that will<a id="id43" class="indexterm"></a> define the conditions that cause the character to switch to another state.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec05"></a>Creating a parameter</h4></div></div></div><p>In the <span class="strong"><strong>Animator</strong></span> interface, parameters<a id="id44" class="indexterm"></a> are used to specify when states will run. They are similar to variables in Unity scripts and can take the form of integers, floats, and booleans. To create a parameter follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the upper-left of the <span class="strong"><strong>Animator</strong></span> window, click on the <span class="strong"><strong>Parameters</strong></span> tab and the <code class="literal">+</code> symbol to create a new parameter.</p></li><li><p>Choose <span class="strong"><strong>Trigger</strong></span> from the list.</p><p>In Mecanim, a trigger parameter allows you to allow a quick action. It is ideal for attack states because it is reset each time it is fired off.</p></li><li><p>Name the parameter <code class="literal">Hits</code>
</p></li></ol></div><p>This trigger parameter will determine when the zombie's attack animation will play.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec06"></a>Adding transitions</h4></div></div></div><p>The next stage is to create<a id="id45" class="indexterm"></a> transitions between your two states. Transitions show how states are connected in the <span class="strong"><strong>Animator</strong></span> window:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right click on the <span class="strong"><strong>Idle</strong></span> state in the <span class="strong"><strong>Animator</strong></span> window.</p></li><li><p>Select <span class="strong"><strong>Make Transition</strong></span>.</p></li><li><p>Click once on the <span class="strong"><strong>Hit</strong></span> state.</p></li></ol></div><p>The transition is displayed as a white line with an arrow indicating its direction:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_11.jpg" /></div><p>We also need to create a transition from <span class="strong"><strong>Hit</strong></span> back to <span class="strong"><strong>Idle</strong></span>, so the character will stop playing this<a id="id46" class="indexterm"></a> animation:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right click on <span class="strong"><strong>Hit</strong></span> and click once on <span class="strong"><strong>Idle</strong></span> to create the return transition.</p><p>In the animator controller, it is the transitions that contain the parameters.</p></li><li><p>Click once on the transition pointing from <span class="strong"><strong>Idle</strong></span> to <span class="strong"><strong>Hit</strong></span>. Its setting will appear in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>The only change that needs to be made to the default settings, at this stage, is to change the drop down in the <span class="strong"><strong>Conditions</strong></span> box at the bottom of the panel.</p></li><li><p>Click on the arrow and select the <code class="literal">Hits</code> parameter from the list.</p></li></ol></div><p>As we want the full attack animation to play out, we will leave the <span class="strong"><strong>Conditions</strong></span> box in the return transition with its default setting <span class="strong"><strong>Exit Time</strong></span>. This will set the state to transition out once the animation has played through:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_12.jpg" /></div><p>The <span class="strong"><strong>Animation</strong></span><a id="id47" class="indexterm"></a> controller is now complete. We will add it to the male zombie character in the next step:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_13.jpg" /></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <code class="literal">zombie_m</code> game object in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>Drag the <code class="literal">zombie_control</code> animator controller onto the <span class="strong"><strong>Controller</strong></span> slot in the character's <span class="strong"><strong>Animator</strong></span> component.</p></li></ol></div><p>At this stage, when we test the <a id="id48" class="indexterm"></a>game, the zombie will run its idle animation, as its <span class="strong"><strong>Idle</strong></span> state is currently specified as the default state (marked in orange in the <span class="strong"><strong>Animator</strong></span> window).</p><p>In order to enable the <span class="strong"><strong>Hit</strong></span> state to take over, we will need to do a little scripting.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec07"></a>Writing the script</h4></div></div></div><p>The character requires a small <a id="id49" class="indexterm"></a>amount of code to enable it to switch to its <span class="strong"><strong>Hit</strong></span> state and play the <code class="literal">zombie_hit</code> animation:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <code class="literal">PACKT_Scripts</code> folder in the <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>Create a new Javascript file by navigating to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Javascript</strong></span>.</p></li><li><p>Rename the file <code class="literal">zombie_attack</code>.</p></li><li><p>Double-click on the file to open it in MonoDevelop.</p></li><li><p>At the top of the script, add the following code:</p><div class="informalexample"><pre class="programlisting">var thisAnimator : Animator;</pre></div><p>This is a variable, which is used to keep track of the character's animator controller that is attached as a component to the same game object that we will attach this script to.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note07"></a>Note</h3><p>If you are coding in C#, rather than Javascript, the syntax is a little different. Functions are defined with the prefix <code class="literal">void</code> rather than function and variables are defined without the <code class="literal">var</code> prefix and with their type before their name, without the separating colon, such as this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Animator thisAnimator;</strong></span>
</pre></div><p>You will find the completed code (in both languages), in the project files.</p></div><p>By default, unity-created Javascript files contain two functions: <code class="literal">Start</code> and <code class="literal">Update</code>. We will initialize the connection to the zombie's animator controller in the <span class="strong"><strong>Start</strong></span> function.</p></li><li><p>Within the curly brackets of the <code class="literal">Start</code> function, add the following line of code:</p><div class="informalexample"><pre class="programlisting">thisAnimator = GetComponent(Animator);</pre></div><p>Because this code is in <code class="literal">Start</code>, as soon as the script runs, it will gain access to the animator component and store this in the <code class="literal">thisAnimator</code> variable for future use.</p><p>Next, we will add some code to the <a id="id50" class="indexterm"></a><code class="literal">Update</code> function. Unlike <code class="literal">Start</code>, which runs only once, when the script is first activated, <code class="literal">Update</code> runs every frame, so it is usually the best place to check for input.</p></li><li><p>Add the following <a id="id51" class="indexterm"></a>code within the curly brackets of the <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">if(Input.GetButton("Fire1"))
{
    thisAnimator.SetTrigger("Hits");
}</pre></div><p>In the first line of code, we check for input from the <code class="literal">Fire1</code> button (set up by default for the left-mouse button). When this condition is met, we trigger the <code class="literal">Hits</code> parameter inside the animator controller, enabling the transition to the <span class="strong"><strong>Hit</strong></span> state and playing the <code class="literal">zombie_hit</code> animation.</p></li><li><p>Save the script in MonoDevelop by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save</strong></span>.</p></li></ol></div><p>If any errors appear in the console, be careful that you have not left out any semicolons (that should end all operations and variables) or curly brackets (that should start and end all functions and statements).</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>If you are including any comments for your own references, make sure that single-line comments are preceded with two forward slashes <code class="literal">//</code> and block comments are encapsulated by <code class="literal">/*</code> and <code class="literal">*/</code>.</p></div><p>This is a pretty short, simple script. We will be elaborating on this later in the book.</p><p>We need to add the script to the zombie character. This can be done by dragging the script from the <span class="strong"><strong>Project</strong></span> panel onto the <code class="literal">zombie_m</code> game object in the <span class="strong"><strong>Hierarchy</strong></span> panel to attach it as a component.</p><p>Next, we will make a few <a id="id52" class="indexterm"></a>small adjustments to the scene, to make it easier to view our animation.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec10"></a>Adjusting the scene elements to preview the animation</h3></div></div></div><p>Changing the<a id="id53" class="indexterm"></a> position and orientation of the<a id="id54" class="indexterm"></a> camera will make it easier to<a id="id55" class="indexterm"></a> view the zombie's animation:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the default <span class="strong"><strong>Main Camera</strong></span> and move it to a position where it is pointing at the zombie.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note09"></a>Note</h3><p>A quick way to set the position of the camera in the scene is by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Navigate the <span class="strong"><strong>Scene</strong></span> view so that a chosen object is framed.</p></li><li><p>Select the <span class="strong"><strong>Main Camera</strong></span> game object by clicking on it in the Hierarchy panel.</p></li><li><p>In the menu bar, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Align with View</strong></span>.</p></li></ol></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>The camera will be repositioned to match the current <span class="strong"><strong>Scene</strong></span> view navigation.</p></div></li><li><p>Add a plane to represent the ground in the scene by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>Plane</strong></span>.</p><p>The plane should be centered to the scene by default.</p><p>The directional light that is already in the scene should be sufficient to light the character.</p></li><li><p>If necessary rotate the light so that the character is clearly lit.</p></li></ol></div><p>The light should clearly illuminate the character's face in the scene.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec08"></a>Previewing the hit animation in the game view</h4></div></div></div><p>Now that we can<a id="id56" class="indexterm"></a> clearly see the character within the view, we can test the animation:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Press the <span class="strong"><strong>Play</strong></span> button in the top-center of the Unity interface.</p><p>The zombie will cycle through its <code class="literal">idle</code> animation.</p></li><li><p>Click on the left-mouse<a id="id57" class="indexterm"></a> button.</p></li></ol></div><p>This will cause the <code class="literal">hit</code> animation to play once before transitioning back to the <span class="strong"><strong>Idle</strong></span> state.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_01_14.jpg" /></div></div></div></div>