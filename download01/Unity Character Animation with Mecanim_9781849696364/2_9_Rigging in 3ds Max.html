<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec16"></a>Rigging in 3ds Max</h2></div></div><hr /></div><p>In this section, we <a id="id71" class="indexterm"></a>will demonstrate the rigging process in 3ds Max using Biped.</p><p>Biped is a set of tools <a id="id72" class="indexterm"></a> developed as part of the character studio in 3ds Max and is basically a prefabricated skeleton that can be fully adjusted to fit most bipedal (and also some quadrupedal characters). The main advantage of using this is speed. It will<a id="id73" class="indexterm"></a> enable you to create a usable character <a id="id74" class="indexterm"></a>skeleton in a very short span of time. Biped also has <span class="strong"><strong>inverse kinematics</strong></span> (<span class="strong"><strong>IK</strong></span>) by default. IK can be set up from scratch using the max bones system, but it takes quite a bit more time.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec11"></a>Setting up the scene</h3></div></div></div><p>Before we get to<a id="id75" class="indexterm"></a> work, there are a few things we need to do to prepare for rigging:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Download the project files from the Packt website if you have not already done so.</p></li><li><p>Start 3ds Max.</p></li><li><p>Set the units to meters by navigating to <span class="strong"><strong>Customize</strong></span> | <span class="strong"><strong>Units Setup</strong></span>.</p></li><li><p>When the <span class="strong"><strong>Units Setup</strong></span> window appears in the max interface, click on the <span class="strong"><strong>Metric</strong></span> radio button near the top of the <span class="strong"><strong>Display Unit Scale</strong></span> group.</p></li><li><p>Choose <span class="strong"><strong>Meters</strong></span> from the drop-down list.</p></li><li><p>Click on <span class="strong"><strong>OK</strong></span> to save the changes and close the window.</p><p>Next, we will adjust the <span class="strong"><strong>Home Grid</strong></span> size to show meters, which is the unit used in Unity.</p></li><li><p>Right-click on <span class="strong"><strong>Snaps Toggle</strong></span>. This is the button in the top center of the 3ds Max interface, which contains the image of a magnet with the number <span class="strong"><strong>2</strong></span>, <span class="strong"><strong>2.5</strong></span>, or <span class="strong"><strong>3</strong></span>. This will open up the <span class="strong"><strong>Grid</strong></span> and <span class="strong"><strong>Snap Settings</strong></span> window.</p></li><li><p>Click on the <span class="strong"><strong>Home Grid</strong></span> tab.</p></li><li><p>In the <span class="strong"><strong>Grid Spacing</strong></span> field, within the <span class="strong"><strong>Grid Dimensions</strong></span> group, type <code class="literal">1.0</code> m. This will create major grid lines at one meter intervals.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_01.jpg" /></div></li><li><p>Close the <span class="strong"><strong>Grid</strong></span> and <span class="strong"><strong>Snap Settings</strong></span> window.</p></li></ol></div><p>Now that we have<a id="id76" class="indexterm"></a> prepared 3ds Max, we can import the character model into the scene.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec12"></a>Importing the character model</h3></div></div></div><p>The character model is a<a id="id77" class="indexterm"></a> female counterpart to the zombie character we animated in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>The Zombie Attacks!.</em></span> It has been saved in the <a id="id78" class="indexterm"></a><span class="strong"><strong>Wavefront OBJ</strong></span> format, one of the more widely used 3D mesh formats. Our next step is to import the model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the 3ds Max icon in the top-left corner of the 3ds Max interface.</p></li><li><p>Click on<span class="strong"><strong> Import</strong></span> from the drop-down command list.</p></li><li><p>In the <span class="strong"><strong>Select File to Import</strong></span> dialog that appears, navigate to the project files and double-click on the <code class="literal">Rigging_Assets</code> folder.</p></li><li><p>Double-click on the <code class="literal">Models</code> subfolder, and then the <code class="literal">zombie_f</code> subfolder to view its contents.</p></li><li><p>Select the <code class="literal">zombie_f.obj</code> file and click on<span class="strong"><strong> Open</strong></span> to close the import dialog.</p></li><li><p>The <span class="strong"><strong>OBJ File Import Options</strong></span> window will appear.</p></li><li><p>Near the bottom of the window, choose <span class="strong"><strong>None</strong></span> as the Preset. Leave all of the other settings at their default values.</p></li><li><p>Click on<span class="strong"><strong> Import</strong></span> to close the window and import the model.</p></li></ol></div><p>The female zombie character model should appear in your quad viewports. The character is approximately the <a id="id79" class="indexterm"></a>same polycount the male zombie. It has textures applied and is ready to be rigged:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_02.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec13"></a>Creating the Biped system</h3></div></div></div><p>
<span class="strong"><strong>Biped</strong></span> is a <a id="id80" class="indexterm"></a>customizable character skeleton that can accommodate most two-legged and two-armed characters. It is often used as a quick method for getting character models ready to animate. In this section, we will add and configure the Biped system for use with our character model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Maximize the <span class="strong"><strong>Perspective</strong></span> viewport by right-clicking within the viewport to select it, and then clicking on the <span class="strong"><strong>Maximize Viewport Toggle</strong></span> in the lower-right corner of the max interface.</p></li><li><p>Click on the <span class="strong"><strong>Create</strong></span> tab on the command panel (located on the right side of the interface).</p></li><li><p>From the sub menu, select the <span class="strong"><strong>Systems</strong></span> tab on the far right.</p></li><li><p>Click on the <span class="strong"><strong>Biped</strong></span> button and drag out the Biped rig onto the grid.</p></li></ol></div><p>Rather than trying to match the full height of the character, try to line up the shoulder joints with the shoulders <a id="id81" class="indexterm"></a>of the character mesh.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec14"></a>Adjusting the Biped's parameters</h3></div></div></div><p>Before deselecting<a id="id82" class="indexterm"></a> the Biped system, adjust the parameters in the <span class="strong"><strong>Modify</strong></span> panel (the icon next to that for the <span class="strong"><strong>Create</strong></span> panel), we need to<a id="id83" class="indexterm"></a> change a few more parameters in command panel:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change <span class="strong"><strong>Body Type</strong></span> to <span class="strong"><strong>Female</strong></span>. This will change the skeleton to one that better matches the female physiology.</p></li><li><p>Change <span class="strong"><strong>Root Name</strong></span> to <code class="literal">zombie_f_</code>, this name will add this as a prefix to all of the bones in the new skeleton, making them easier to identify.</p></li><li><p>Adjust the bone parameters to match the following illustration:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_03.jpg" /></div></li></ol></div><p>This will give you the right number of bones for the character rig.</p><p>Do not worry about the <span class="strong"><strong>Twist Links</strong></span> and <span class="strong"><strong>Xtras</strong></span> parameters at the bottom—these are advanced options that are not necessary for this character.</p><p>Next, we will <a id="id84" class="indexterm"></a>adjust the size and rotation<a id="id85" class="indexterm"></a> of the individual bones to better match our female zombie.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec09"></a>Adjusting the Biped to fit the character</h4></div></div></div><p>As a prefabricated <a id="id86" class="indexterm"></a>rig, Biped is designed to be adapted to various character types. We can scale and rotate all of the bones to fit our character's design:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <span class="strong"><strong>Motion</strong></span> tab in command panel and then activate <span class="strong"><strong>Figure Mode</strong></span> by clicking on the figure icon under the <span class="strong"><strong>Biped</strong></span> rollout. This will allow you to edit the scale and rotation of individual bones:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_04.jpg" /></div><p>Importantly, we need to make sure that the root bone is centered to the world.</p></li><li><p>Click on the <span class="strong"><strong>Select By Name</strong></span> icon in the main tool bar or use the <span class="emphasis"><em>H</em></span> key.</p></li><li><p>Select the <code class="literal">zombie_f_</code> bone from the list and click on<span class="strong"><strong> OK</strong></span> to close the <span class="strong"><strong>Select By Name</strong></span> window.</p></li><li><p>In command panel, rename the bone <code class="literal">zombie_f_root</code> by typing this in the <span class="strong"><strong>Name</strong></span> field.</p></li><li><p>Activate the <span class="strong"><strong>Select and Move</strong></span> tool (or press <span class="emphasis"><em>W</em></span> key) and zero out the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Z</strong></span> fields in the bottom center of the screen by selecting the number in the field and typing <code class="literal">0</code>.</p></li></ol></div><p>This will ensure that the skeleton is lined up accurately with the model and help you rig the character effectively using the symmetry shortcuts that Biped offers.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec10"></a>Switching to X-ray mode and freezing the character mesh</h4></div></div></div><p>To make it easier to <a id="id87" class="indexterm"></a>see the bones underneath your<a id="id88" class="indexterm"></a> model, you can use X-ray mode:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With the <span class="strong"><strong>Select Object</strong></span> tool active, click on the <code class="literal">zombie_f</code> mesh in the viewport.</p></li><li><p>Press <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>X</em></span> to display the current selection in X-ray, making it semi-transparent.</p><p>If you now freeze the selection, you can make sure the character mesh does not accidentally get selected during the rigging process.</p></li><li><p>Right-click on anywhere in the viewport and choose <span class="strong"><strong>Freeze Selection</strong></span> from the <span class="strong"><strong>Display</strong></span> menu:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_05.jpg" /></div></li></ol></div><p>The selected character mesh will become grayed-out, indicating that it is now frozen, though you should still be able to see the Biped bones clearly through the mesh because it is set to X-ray.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p>You can unfreeze<a id="id89" class="indexterm"></a> frozen objects at any time by right-clicking on and choosing <span class="strong"><strong>Unfreeze All</strong></span> from the<a id="id90" class="indexterm"></a> <span class="strong"><strong>Selection</strong></span> menu.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec03"></a>Changing bone display colors</h5></div></div></div><p>By default, all three of the spine bones that were created are displayed in the same color. To make it easier to<a id="id91" class="indexterm"></a> differentiate them, the colors should be changed:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the perspective viewport, select <code class="literal">zombie_f_Spine1</code>.</p></li><li><p>Change the display color by clicking on the colored square in the right of command panel (it will be displayed if you have the <span class="strong"><strong>Modify</strong></span>, <span class="strong"><strong>Hierarchy</strong></span>, or <span class="strong"><strong>Motion</strong></span> tabs active).</p></li><li><p>Choose a different color from the swatch that appears.</p></li><li><p>Repeat this process for <code class="literal">zombie_f_Spine2</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note12"></a>Note</h3><p>The colors that you assign to individual bones will help you to differentiate them in the viewport—the skeleton will never be visible in the game.</p></div><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_06.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec04"></a>Scaling and orienting the bones to match the character model</h5></div></div></div><p>The next part<a id="id92" class="indexterm"></a> of the process will be unique to the character that you are rigging. Follow these steps to adjust the bones to align <a id="id93" class="indexterm"></a>with the character:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Activate the <span class="strong"><strong>Select and Scale</strong></span> tool (or press the <span class="emphasis"><em>R</em></span> key).</p></li><li><p>Set <span class="strong"><strong>Reference Coordinate System</strong></span>, the <a id="id94" class="indexterm"></a>white drop-down list in the top, center-middle of the interface, from <code class="literal">View</code> to <code class="literal">Local</code>. This will ensure that the rotation and scale gizmos used to modify the bone are aligned to the bone. This will make it easier to adjust them:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_07.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>The Reference Coordinate System is specific to the tool that you are using, so you will have to set it to <code class="literal">Local</code> for the <span class="strong"><strong>Select</strong></span> and <span class="strong"><strong>Rotate</strong></span> tool as well.</p></div></li></ol></div><p>Scale each of the <a id="id95" class="indexterm"></a>spine bones to better approximate the proportions of the character's torso:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start <a id="id96" class="indexterm"></a>by scaling <code class="literal">zombie_f_Spine</code>.</p></li><li><p>Continue with the next two spine bones.</p></li><li><p>Scale and rotate the <code class="literal">zombie_f_Neck</code> joint.</p></li><li><p>Repeat this process for the head. Try to scale the head bone so that the approximate eye position indicated by the Biped head joint line up with that of the character mesh.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>When you are scaling and rotating bones, try to follow the hierarchical order of the skeleton, so that the bones closest to the root are adjusted first. This will reduce the possibility of changing the size and orientation of bones that you previously adjusted.</p></div></li></ol></div><p>The core of the character skeleton should be a pretty good fit before we move on to the peripheral joints and the limbs.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h6 class="title"><a id="ch02lvl5sec03"></a>Repositioning the joints for the ponytail and jaw</h6></div></div></div><p>We created the <a id="id97" class="indexterm"></a>Biped with two chains of ponytail links. The first set will be used for the character's hair, and the second, which is a <a id="id98" class="indexterm"></a>single joint, will be used for the character's jaw animation:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Activate the <span class="strong"><strong>Select and Move</strong></span> tool (or press the <span class="emphasis"><em>W</em></span> key).</p></li><li><p>Select <code class="literal">zombie_f_Ponytail1</code> and move it to the area in the back of the character's head where the ponytail starts.</p></li><li><p>Switch to the <span class="strong"><strong>Select and Scale</strong></span> tool (or press the <span class="emphasis"><em>R</em></span> key), scale the joint down so it fits neatly inside of the mesh.</p></li><li><p>Select the next joint in the chain and rotate and scale the joint down until it terminates at the widest part of the ponytail.</p></li><li><p>The last joint should be rotated and scaled so that it reaches the end of the ponytail portion of the character mesh.</p></li><li><p>For the jaw, select a single-joint ponytail chain in the viewport or from the <span class="strong"><strong>Select by Name</strong></span> list.</p></li><li><p>Rename it <code class="literal">zombie_f_Jaw</code>.</p></li><li><p>Reposition<a id="id99" class="indexterm"></a> the joint so that it starts just beneath the ear in the <span class="strong"><strong>Right</strong></span> or <span class="strong"><strong>Left</strong></span> viewport.</p></li><li><p>Rotate and <a id="id100" class="indexterm"></a>scale the joint so that it reaches the character's chin.</p></li></ol></div><p>The result should appear similar to the following illustration:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_08.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>Ponytail links can be moved to any position on the head and used to support anything else that needs to animate such as a nose, hat, jaw, or antennae.</p></div><p>Do not worry about scaling the bones to exactly fit the character mesh, if they poke through the surface in places this is fine. It is more important that you place the joints correctly within the mesh, as individual vertices will be influenced by the bones' respective rotations.</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec11"></a>Adjusting limb positions</h4></div></div></div><p>Assuming that <a id="id101" class="indexterm"></a>your character is symmetrical like this one, you will only need to rotate and scale the bones on one side of the character.</p><p>Bones are color coded. The character's right-side bones are displayed in green and the left-side bones are displayed in blue.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Adjust the bones of the left arm, starting with <code class="literal">zombie_f_L_UpperArm</code>.</p></li><li><p>Move down through the hierarchy to correct the scale and rotation of the lower arm, hand, and finger bones making sure that the joints fit appropriately within the mesh.</p></li><li><p>Repeat this process for the bones of the left leg, starting with <code class="literal">zombie_f_L_Thigh</code>.</p><p>In the Biped system, certain bones such as the neck and finger roots can also be moved allowing greater flexibility.</p></li><li><p>Switch to the <span class="strong"><strong>Select and Move</strong></span> tool and drag the finger root joints into the correct positions indicated by the character model.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"></a>Note</h3><p>Lining up the finger and toe bones can be tricky. Hopefully you will be working with a character in which these joints will be suggested in the modeling. Often, characters are created with this in mind—knee, elbow, and finger joints will be slightly bent to facilitate faster and more accurate rigging.</p></div></li></ol></div><p>Rather than having to repeat this process for the character's right side, we will be making use of some of Biped's additional features to copy and paste scale and rotation data from one side to the other. First, we need to take care of a few issues with the bone names.</p><p>As you are rotating and scaling the finger joints, it should become evident that these joints are identified by number only. It would be more useful if they were given unique names before we get too much further with the rigging process.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec12"></a>Renaming bones</h4></div></div></div><p>Renaming<a id="id102" class="indexterm"></a> bones will allow them to be selected more easily in a list, for situations when it is difficult to select them in a viewport. We will assign the finger bones unique names:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the viewport, select the first bone in the left index finger.</p></li><li><p>In the <span class="strong"><strong>Modify</strong></span> panel, rename it <code class="literal">zombie_f_L Index1</code>.</p></li><li><p>Select the second bone in the index finger, and name it <code class="literal">zombie_f_L Index2</code>.</p></li><li><p>Continue<a id="id103" class="indexterm"></a> this process to rename the remaining joint and assign the appropriate names to the bones of the <span class="strong"><strong>Middle</strong></span>, <span class="strong"><strong>Ring</strong></span>, <span class="strong"><strong>Little</strong></span>, and <span class="strong"><strong>Thumb</strong></span> of both hand.</p></li><li><p>Select the left toe bone <code class="literal">zombie_f_L Toe0</code> and remove the number <code class="literal">0</code> from the end of the name. Repeat this with the right toe bone.</p></li></ol></div><p>Now that we made our bone names consistent, we will copy the rotation and scale data from the left side to the right.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec13"></a>Copying and pasting the position, rotation, and scale data from one side to the other</h4></div></div></div><p>One of the benefits <a id="id104" class="indexterm"></a>of using the Biped system is that it includes various shortcuts to speed up the rigging process, especially when working with a symmetrical character:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Activate the <span class="strong"><strong>Select Object tool</strong></span> (or press the <span class="emphasis"><em>Q</em></span> key) and reselect all of the left side limb bones by dragging a marquee around them within the viewport. Alternatively, you can use the <span class="strong"><strong>Select By Name</strong></span> tool (or press the <span class="emphasis"><em>H</em></span> key).</p></li><li><p>In the command panel, select the <span class="strong"><strong>Motion</strong></span> tab.</p></li><li><p>Scroll down to locate the <span class="strong"><strong>Copy/Paste</strong></span> rollout and make sure that the <span class="strong"><strong>Posture</strong></span> button is activated:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_09.jpg" /></div></li><li><p>Click on the <span class="strong"><strong>Create Collection</strong></span> button. This stores the group of the bones that you selected.</p></li><li><p>Click on<a id="id105" class="indexterm"></a> the <span class="strong"><strong>Copy Posture</strong></span> button.</p></li><li><p>Click on the <span class="strong"><strong>Paste Posture Opposite</strong></span> button.</p></li></ol></div><p>The scaling and rotation of the limb should be transferred correctly to the other side.</p><p>If there is any offset resulting in the bones not fitting within the mesh on the pasted side, check that the root bone and the character mesh have both been centered to the world and try again:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_10.jpg" /></div><p>Once the<a id="id106" class="indexterm"></a> individual bone orientations have been set, the next stage of the rigging process will involve creating a relationship between the character mesh and its skeleton. This is referred to as the <a id="id107" class="indexterm"></a><span class="strong"><strong>skinning</strong></span> process.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec15"></a>Skinning the character using the skin modifier</h3></div></div></div><p>At<a id="id108" class="indexterm"></a> the<a id="id109" class="indexterm"></a> time <a id="id110" class="indexterm"></a>of writing, the<a id="id111" class="indexterm"></a> best tool to set up the relationship between the character model and the skeleton in 3ds Max is the <span class="strong"><strong>Skin</strong></span> modifier. We will be adding this to the modifier stack and configuring it to work with our skeleton in this step:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the character model in the viewport.</p></li><li><p>In the <span class="strong"><strong>Modify</strong></span> panel, click on the small arrow next to <span class="strong"><strong>Modifier List</strong></span> to expand the list.</p></li><li><p>Navigate to the <span class="strong"><strong>Object</strong></span> | <span class="strong"><strong>Space Modifiers</strong></span> section and choose <span class="strong"><strong>Skin</strong></span>.</p><p>The <span class="strong"><strong>Skin</strong></span> <a id="id112" class="indexterm"></a>modifier will be added to the character model's modifier stack. The modifier's <span class="strong"><strong>Parameters</strong></span> rollout will appear lower down in the <span class="strong"><strong>Modify</strong></span> panel.</p><p>Within the <span class="strong"><strong>Parameters</strong></span> rollout, the <span class="strong"><strong>Bones</strong></span> group contains a list of the bones currently used in the <span class="strong"><strong>Skin</strong></span> modifier. This is empty by default.</p></li><li><p>Click on<a id="id113" class="indexterm"></a> the <span class="strong"><strong>Add</strong></span> button.</p><p>The <span class="strong"><strong>Select Bones</strong></span> window will appear. This is essentially the same as the <span class="strong"><strong>Select by Name</strong></span> tool that we used previously.</p></li><li><p>In the <span class="strong"><strong>Selection Set</strong></span> <a id="id114" class="indexterm"></a>option, at the top of the window, click on the arrow and select <code class="literal">zombie_skeleton</code> from the drop-down list.</p></li><li><p>Holding <span class="emphasis"><em>Ctrl</em></span>, click on<code class="literal"> zombie_f_Root</code> and <code class="literal">zombie_f_Footsteps</code> at the top of the list to deselect them.</p><p>We are<a id="id115" class="indexterm"></a> deselecting these two items. The root bone is used to move the whole rig around and does not directly influence any vertices. The footsteps object is used in the creation of walk cycles and is not really a bone.</p></li><li><p>Click on the <span class="strong"><strong>Select</strong></span> button at the bottom of the <span class="strong"><strong>Select Bones</strong></span> window.</p><p>The window will close, and the selected bones will be displayed in the skin modifier's <span class="strong"><strong>Bones</strong></span> list:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_11.jpg" /></div><p>The scrollbar on the right of the list will allow you to view all of the selected bones.</p></li><li><p>We need to <a id="id116" class="indexterm"></a>see the bones to animate them, so if you have hidden them, you can unhide them by right-clicking on and selecting <span class="strong"><strong>Unhide by Name</strong></span> from the <span class="strong"><strong>Display</strong></span> <a id="id117" class="indexterm"></a>menu.</p></li></ol></div><p>Before we <a id="id118" class="indexterm"></a>start rotating the bones, we will make a selection set, which will help us to quickly reselect the<a id="id119" class="indexterm"></a> bones that make up the skeleton.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec14"></a>Creating a selection set</h4></div></div></div><p>In 3ds Max, a <span class="strong"><strong>selection set</strong></span> is a<a id="id120" class="indexterm"></a> stored group of objects or subobjects that can be stored and then quickly <a id="id121" class="indexterm"></a>accessed via the <span class="strong"><strong>Named Selection Sets</strong></span> box. Using selection sets during animation can save you a lot of time, because you will not have to manually select all of the bones, which make up the skeleton repetitively:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select all the bones in the skeleton using the <span class="strong"><strong>Select By Name</strong></span> tool.</p></li><li><p>Locate the <span class="strong"><strong>Named Selection Sets</strong></span> box just below the main toolbar in the top center of the max interface.</p></li><li><p>Click on once in the field and type <code class="literal">zombie_skeleton</code> to name the set.</p></li><li><p>Tap <span class="emphasis"><em>Enter</em></span> to confirm the creation of the new selection set.</p></li></ol></div><p>The selection set is now stored.</p><p>You can now<a id="id122" class="indexterm"></a> quickly select all of the bones at once by<a id="id123" class="indexterm"></a> choosing <code class="literal">zombie_skeleton</code> from the drop-down list accessed by the small arrow.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>When you choose a selection set containing items which are hidden or frozen, you will be given the option to unhide and unfreeze. This is quicker than having to select all of the objects from the <span class="strong"><strong>Unhide by Name</strong></span> dialog.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec15"></a>Saving the default pose</h4></div></div></div><p>Before we<a id="id124" class="indexterm"></a> start rotating any bones, we will save the default bone orientation and position, to make it easier to return to if we accidentally overwrite the initial pose:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Reselect the root bone <code class="literal">zombie_f_Root</code>.</p></li><li><p>Exit the figure mode by clicking on the <span class="strong"><strong>Figure</strong></span> icon in the <span class="strong"><strong>Motion</strong></span> panel.</p></li><li><p>Click on to select the <span class="strong"><strong>Pose</strong></span> tab in the <span class="strong"><strong>Copy/Paste</strong></span> rollout.</p></li><li><p>Click on the <span class="strong"><strong>Copy Pose</strong></span> icon, and in the <span class="strong"><strong>Copied Poses</strong></span> field, rename it as <code class="literal">default</code>.</p></li></ol></div><p>You should see a thumbnail image of the pose appear in the <span class="strong"><strong>Copied Poses</strong></span> preview panel:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_12.jpg" /></div><p>The default pose will <a id="id125" class="indexterm"></a>now be saved to the collection.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec16"></a>Creating the test pose</h4></div></div></div><p>The test pose that we create is used to check the quality of the joint deformations. Rather than spending a great deal of time creating an interesting or balanced pose, we are primarily testing the character skinning.</p><p>As the character <a id="id126" class="indexterm"></a>will be required to use a number of different animation sequences in a game, it makes sense to try out different joint rotations. Therefore, the most appropriate kind of pose to test with is an asymmetrical pose such as a walking stance.</p><p>We can start by hiding the character model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the character in the viewport by clicking on it.</p></li><li><p>Right-click on and choose <span class="strong"><strong>Hide Selected</strong></span> from the <span class="strong"><strong>Display</strong></span> menu.</p><p>This will make it easier to select and adjust individual bones.</p></li><li><p>At the bottom of the main interface, drag the <span class="strong"><strong>Track Bar</strong></span> to frame <span class="strong"><strong>30</strong></span>. This is where we will key the pose.</p></li><li><p>Back in the <span class="strong"><strong>Motion</strong></span> panel, expand the <span class="strong"><strong>Key Info</strong></span> rollout.</p></li><li><p>Start rotating the bones to create the pose. Start with the spine bones.</p></li><li><p>Each time you pose a bone, click on the red <span class="strong"><strong>Set Key</strong></span> button.</p><p>When you set a key, a dark square will appear in the frames position on the track bar to indicate that there is animation data associated with the currently selected joint.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>If you make a mistake, you can click on the <span class="strong"><strong>Delete Key</strong></span> button which will reset the rotation or position of the currently selected bone. The square defining the frame on the track bar will also disappear.</p></div><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_13.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note19"></a>Note</h3><p>If you forget to set the key when you have rotated a bone, your changes will be lost when you move the track bar or deselect the bone.</p><p>You can reset all of the bones by choosing the <span class="strong"><strong>zombie skeleton</strong></span> selection set from the drop-down at the top of the interface, and then clicking on<span class="strong"><strong> Delete Key</strong></span>.</p></div><p>The Biped skeleton is set up with<a id="id127" class="indexterm"></a> <span class="strong"><strong>Inverse Kinematics</strong></span> (<span class="strong"><strong>IK</strong></span>), so rather than having<a id="id128" class="indexterm"></a> to adjust each of the bones down through the hierarchy, you can select the hands and feet and move them to a precise position.</p><p>Creating a test pose is much quicker and easier using this method. It is also useful for creating interactions, such as foot contacts.</p><p>In some situations, you will also want to use<a id="id129" class="indexterm"></a> <span class="strong"><strong>Forward Kinematics</strong></span> (<span class="strong"><strong>FK</strong></span>), which is the strictly hierarchical positioning of joints. Parent joints, such as the clavicle, upper arm, and forearm are rotated in order to position the hand.</p><p>With Biped, you can use a mixture of IK and FK to create your test pose:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Make sure not to forget the extra bones we added for the ponytail and jaw</p></li><li style="list-style-type: disc"><p>The bones for at least one of the hands should also be posed</p></li></ul></div><p>When all <a id="id130" class="indexterm"></a>of the bones have been posed and keyframed, we will store the test pose as we did with the <code class="literal">default</code> pose:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_14.jpg" /></div></li><li><p>Copy the pose and rename it in the same way you did for the <code class="literal">default</code> pose. Name it <code class="literal">testPose01</code>.</p><p>The pose has now been saved to the <span class="strong"><strong>Collection</strong></span>, and can be applied to the character whenever it is needed.</p></li><li><p>Unhide the character by right-clicking on and selecting <span class="strong"><strong>Unhide By Name</strong></span> from the <span class="strong"><strong>Display</strong></span> menu.</p></li><li><p>Choose the <code class="literal">female_zombie</code> object from the list.</p></li><li><p>If X-ray <a id="id131" class="indexterm"></a>mode is active, switch it off by pressing <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>X</em></span>.</p></li><li><p>Look closely at the joints—shoulders, elbows, hips, and knees—to make sure that the surface of the mesh deforms smoothly.</p></li></ol></div><p>Hiding the Biped bones will make it easier to see the deformation of the model:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_15.jpg" /></div><p>There should be<a id="id132" class="indexterm"></a> some smooth deformation in these areas, probably a few problems too. We can correct these when we adjust the envelopes in the next step.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec17"></a>Making adjustments to the Skin modifier</h4></div></div></div><p>The <span class="strong"><strong>Skin</strong></span> modifier<a id="id133" class="indexterm"></a> does a reasonably good job at setting up smooth deformations between most of the bones. There are some areas such as the head, torso, and feet, which need further adjustment.</p><p>When initiated, the <span class="strong"><strong>Skin</strong></span> modifier creates envelopes for each of the bones added to the list. These envelopes can be adjusted by changing their size and position relative to the bones. We can also adjust the influence on individual vertices.</p><p>We will start by taking a look at the envelope adjustment.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec05"></a>Adjusting envelopes</h5></div></div></div><p>In the <span class="strong"><strong>Skin</strong></span> modifier, the <span class="strong"><strong>Envelope</strong></span> is a grouping of vertices influenced by a specific bone. Adjustments to <a id="id134" class="indexterm"></a>a character's skinning should usually start with these. Envelopes enable broad changes to be quickly made to the skin by adjusting a gizmo capsule rather than adjusting vertices one at a time:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Under the <span class="strong"><strong>Modify</strong></span> panel, click on the <span class="strong"><strong>+</strong></span> symbol next to the <span class="strong"><strong>Skin</strong></span> modifier to expand its sub-object levels.</p></li><li><p>Select <span class="strong"><strong>Envelope</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Bones</strong></span> list, lower down in the panel and select <code class="literal">zombie_f_Spine2</code>.</p><p>The bone's envelope gizmos will appear and a color gradient will be projected on top of the character's texture:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_16.jpg" /></div><p>The selected <a id="id135" class="indexterm"></a>bone's influence is displayed in color temperature, with the strongest influence displayed in red, the least influence is displayed in blue.</p><p>The two capsule shaped gizmos define this influence on the vertices. The distance between these two capsules defines how smooth the deformation is.</p><p>With the default settings, the character's upper arms appear to be squeezed and pushed too far from the torso.</p></li><li><p>Activate the <span class="strong"><strong>Select and Move</strong></span> tool and drag on one of the control points of the larger capsule.</p><p>The gizmo will rescale as the control point is dragged, resulting in a change in the vertices which are influenced. You will see the gradient change to reflect this.</p><p>The rings that define the<a id="id136" class="indexterm"></a> size of the envelopes are called <span class="strong"><strong>cross sections</strong></span>. There are two of these for each outer and inner envelope.</p></li><li><p>Reduce the size of the outer envelope to include only the vertices in the upper part of the torso:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_17.jpg" /></div><p>Dragging<a id="id137" class="indexterm"></a> the control points of the cross sections only allows the rescaling of envelope on one axis. The envelopes can also be shortened and lengthened by moving the two control points connected by the yellow line in the center of the envelope.</p><p>These control points can also be moved around to change the actual position of the envelope and therefore the influence of the bone can be offset from the bone's actual position.</p><p>Select the core control points one at a time, and move them in toward the center of the character until the shoulders of the character are no longer contained within the inner envelope:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_18.jpg" /></div><p>The character's arms should appear fuller and more cylindrical, as they are receiving less influence from the upper spine bone.</p></li><li><p>Select other <a id="id138" class="indexterm"></a>spine, arm, and leg bones from the list and adjust the envelopes to include just the vertices that you wish the selected bone to influence.</p></li></ol></div><p>Sometimes the character model's form is complex enough to demand a closer level of adjustment. We will demonstrate this with the head.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec06"></a>Adjusting influence on the head vertices</h5></div></div></div><p>The vertices in the head are currently influenced by the head, neck, jaw, and ponytail bones, so the results will be pretty messy. Most of the vertices in the head should not deform, so this <a id="id139" class="indexterm"></a>area requires a different technique to skin successfully:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Maximize the <span class="strong"><strong>Left</strong></span> viewport.</p></li><li><p>Return the <span class="strong"><strong>Track Bar</strong></span> to <span class="strong"><strong>Frame 0</strong></span>.</p></li><li><p>Select the <code class="literal">zombie_f_Head</code> bone from the list in the <span class="strong"><strong>Modify</strong></span> panel:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_19.jpg" /></div><p>The head envelope is displayed as a capsule gizmo arranged horizontally from front to back. The inner envelope currently includes most of the upper face. The outer envelope includes the whole head and some of the upper torso.</p><p>We will start by reorienting and rescaling the envelope to better fit the head and reduce the influence on the vertices of the torso.</p></li><li><p>Select one of the core control points within the head envelope and position it at the top of the ear and level with the eye.</p></li><li><p>Select the other core control point and move it below the ear and level with the lower lip.</p></li><li><p>Drag the inner envelope control points to rescale the envelope to include all of the vertices of the head.</p><p>Make sure to include the nose, but do not try to include the ponytail or chin as these will fall under the influence of other bones.</p></li><li><p>Rescale the head's outer envelope by dragging the control points.</p><p>The outer<a id="id140" class="indexterm"></a> envelope should be only slightly bigger than the inner envelope resulting in a very steep blend between the bone influences:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_20.jpg" /></div><p>At this point, we removed the head's influence from the adjacent areas of the character. We need to do some finer work with the jaw to get it to influence the right vertices.</p></li><li><p>Select <code class="literal">zombie_f_Jaw</code> from the <span class="strong"><strong>Bones</strong></span> list in the <span class="strong"><strong>Modify</strong></span> panel.</p></li><li><p>Use the control points to rescale the jaw's envelope to influence only the vertices in the lower jaw area.</p><p>This time, we want to leave some space between the outer and inner envelopes so that the deformation is smooth.</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_21.jpg" /></div></li><li><p>Maximize the<a id="id141" class="indexterm"></a> <span class="strong"><strong>Perspective</strong></span> viewport and slide the track bar to frame <code class="literal">30</code> to view the results:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_22.jpg" /></div></li></ol></div><p>The deformation<a id="id142" class="indexterm"></a> in the cheeks is smooth as we would expect, but the jaw bone's envelope is influencing too many of the vertices in the upper lip causing it to be stretched.</p><p>Beneath the chin, not enough vertices are being influenced as the envelope falls off too sharply. We can fix these problems by painting the skin weights manually.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec07"></a>Painting skin weights for the jaw bone</h5></div></div></div><p>There are certain<a id="id143" class="indexterm"></a> situations for a character where we have a mixture of hard (rigid) and soft (deformable) surfaces exceed what we can achieve with skin envelopes on their own. The <span class="strong"><strong>Paint Weights</strong></span> tool in Max allows us to paint bone influence directly onto the mesh:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <code class="literal">zombie_f_Jaw</code> still selected in the <span class="strong"><strong>Bones</strong></span> list, scroll down to the <span class="strong"><strong>Weight Properties</strong></span> group in the <span class="strong"><strong>Modify</strong></span> panel.</p></li><li><p>Click on the <span class="strong"><strong>Painter Options</strong></span> button:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_23.jpg" /></div><p>The <span class="strong"><strong>Painter Options</strong></span> window will appear over the main interface. This is where we will set the size and strength of the weighting brush.</p></li><li><p>In the<a id="id144" class="indexterm"></a> viewport, make sure you have a clear view of the character's jaw area.</p></li><li><p>Back in the <span class="strong"><strong>Modify</strong></span> panel, uncheck the <span class="strong"><strong>Paint Blend Weights</strong></span> checkbox. </p></li><li><p>Click on the <span class="strong"><strong>Paint Weights</strong></span> button.</p><p>A gizmo will appear when you move the cursor over the character mesh showing the size of the brush.</p></li><li><p>In the <span class="strong"><strong>Painter Options</strong></span> window, set the <span class="strong"><strong>Max. Size</strong></span> to <code class="literal">0.03m</code>.</p><p>The painting gizmo will change size to reflect this.</p></li><li><p>Set the <span class="strong"><strong>Max. Strength</strong></span> to <code class="literal">-1.0</code>.</p></li><li><p>Paint over the character's top lip to remove the influence from the jaw bone.</p><p>The color will disappear from the mesh.</p></li><li><p>Set the <span class="strong"><strong>Max. Strength</strong></span> to <code class="literal">0.25</code>.</p></li><li><p>Paint the area under the chin to add influence from the jaw bone:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_24.jpg" /></div></li><li><p>Continue painting the skin weights for the back of the neck, hands, feet, and any other<a id="id145" class="indexterm"></a> areas where the deformation of the mesh needs a tighter definition.</p></li></ol></div><p>The <span class="strong"><strong>Paint Weights</strong></span> tool will allow you to fine tune each bone's influence on the vertices of the mesh. When the skinning has been completed, we can export the character for use in Unity.</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec16"></a>Exporting the rigged character</h3></div></div></div><p>The final step to complete in 3ds Max is the character export. We will use FBX format, which supports<a id="id146" class="indexterm"></a> skeletal animation and is recognized <a id="id147" class="indexterm"></a>by a broad range of software applications including Unity:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Uncheck the <span class="strong"><strong>Hide Attached Nodes</strong></span> checkbox to unhide the Biped.</p></li><li><p>Make sure to save your max scene by clicking on the 3ds Max icon in the top-left corner of the interface and choosing <span class="strong"><strong>Save As..</strong></span>.</p></li><li><p>Specify a filename and location, and then click on<span class="strong"><strong> Save</strong></span>.</p></li><li><p>Select the skeleton and the character mesh and export it.</p></li><li><p>Click on the <span class="strong"><strong>Max</strong></span> icon and navigate to <span class="strong"><strong>Export</strong></span> | <span class="strong"><strong>Export Selected</strong></span>.</p><p>In the <span class="strong"><strong>FBX Export</strong></span> window, which appears, there are a few settings that we need to make sure are enabled.</p></li><li><p>In the <span class="strong"><strong>Geometry</strong></span> group, check the boxes next to <span class="strong"><strong>Smoothing Groups</strong></span> and <span class="strong"><strong>Triangulate</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_25.jpg" /></div></li><li><p>We can leave<a id="id148" class="indexterm"></a> the <span class="strong"><strong>Animation</strong></span> box unchecked, as we no longer need our test pose. The rest of the settings<a id="id149" class="indexterm"></a> can be left with their default values.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note20"></a>Note</h3><p>In the <span class="strong"><strong>Embed Media</strong></span> group, checking the <span class="strong"><strong>Embed Media</strong></span> checkbox is optional, as importing an FBX file with embedded textures will create a textures subfolder within the folder that the model is imported to. You can keep your project more organized by creating your own <code class="literal">Textures</code> folder directly within the <code class="literal">Assets</code> folder in Unity.</p></div></li><li><p>Click on to expand the <span class="strong"><strong>Advanced Options</strong></span> rollout.</p></li><li><p>Click on to expand <span class="strong"><strong>Units</strong></span>.</p><p>Our model has been built to scale, but we need to make sure that it is not rescaled in the FBX settings.</p></li><li><p>Uncheck the <span class="strong"><strong>Automatic</strong></span> checkbox.</p></li><li><p>From the <span class="strong"><strong>Scene units converted to</strong></span> drop-down list, select <span class="strong"><strong>Meters</strong></span>. This is the unit of measurement used in Unity: </p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_02_26.jpg" /></div></li><li><p>Save the FBX file as <code class="literal">zombie_female.FBX</code>.</p></li></ol></div><p>The character <a id="id150" class="indexterm"></a>can now be imported into Unity as detailed in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>The Zombie Attacks!</em></span>
</p><p>The next section<a id="id151" class="indexterm"></a> details the process of rigging a character model in Maya.</p></div></div>