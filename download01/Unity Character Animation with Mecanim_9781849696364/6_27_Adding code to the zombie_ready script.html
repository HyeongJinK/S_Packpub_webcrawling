<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec30"></a>Adding code to the zombie_ready script</h2></div></div><hr /></div><p>The script currently<a id="id362" class="indexterm"></a> attached to the female zombie, adequately handles its current states: <span class="strong"><strong>Idle</strong></span> and <span class="strong"><strong>Walk</strong></span>. We need to add a few lines of code to the script to trigger the face animation:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, scroll down until the <code class="literal">PACKT_Scripts</code> folder is visible.</p></li><li><p>Double-click on it to make its contents visible in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate <code class="literal">zombie_ready</code> and double-click on it to open the script in MonoDevelop.</p></li></ol></div><p>We will start by adding a few variables. At the top of the script, add the following lines of code:</p><div class="informalexample"><pre class="programlisting">var target : Transform;
var alerted : boolean = false;
var snarlSound : AudioClip;
var soundReady : boolean = true;</pre></div><p>The <code class="literal">target</code> variable will store the player character's position. The next variable, alerted is a boolean. It is basically an on/off switch that will allow the zombie to go into a new routine.</p><p>The next two variables deal with the sound that we will be using to make it clear that the zombie has been alerted.</p><p>The <code class="literal">snarlSound</code> variable<a id="id363" class="indexterm"></a> is an audio clip that will store the actual sound, and <code class="literal">soundReady</code> is a boolean that will be used to prevent the sound playing more than once.</p><p>By default <code class="literal">alerted</code> is set to <code class="literal">false</code>, but we will switch it to <code class="literal">true</code> in the next few lines of code.</p><p>Add the following code within the <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">if(Input.GetButton("Fire1") &amp;&amp; alerted == false)
{
    alerted = true;
}

if(alerted)
{
    TurnToPlayer();
}</pre></div><p>Here, we use the player input (in this case, the <span class="strong"><strong>Fire1</strong></span> button) to trigger the boolean switch. This is a temporary measure—triggers and ranges are covered fully in <a class="link" href="#" linkend="ch09">Chapter 9</a>, <span class="emphasis"><em>Controlling Enemy Animation with AI and Triggers</em></span>.</p><p>The advantage in testing the boolean switch with player input, at this stage, is that it allows us to make sure that the boolean is working before we further complicate the script.</p><p>We also have an <code class="literal">if</code> statement to check whether the boolean has been switched on, this in turn runs the <code class="literal">TurnToPlayer</code> function, which we will look at next.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec43"></a>Adding the TurnToPlayer function</h3></div></div></div><p>Instead of <a id="id364" class="indexterm"></a>continuing to add code in the<a id="id365" class="indexterm"></a> <code class="literal">Update</code> function, we separate out the actual behavior into a new custom function named <code class="literal">TurnToPlayer</code>.</p><p>Separating these commands makes our script easier to read, it also allows for a variety of ways to call the function—imagine that our player character has triggered an alarm, which causes all of the enemies in the level to become aware of him and turn toward him.</p><p>Add the following code to the bottom of the script:</p><div class="informalexample"><pre class="programlisting">function TurnToPlayer()
{
    transform.LookAt(target);
    yield WaitForSeconds(2);
    
    if(soundReady)
    {
        GetComponent.&lt;AudioSource&gt;().PlayOneShot(snarlSound);
        soundReady = false;
    }    
    Walks();
}</pre></div><p>The first command<a id="id366" class="indexterm"></a> makes the zombie turn to face the player. We create a short pause with the <code class="literal">yield WaitForSeconds</code> method, we<a id="id367" class="indexterm"></a> then check to see if the <code class="literal">soundReady</code> boolean variable is true and then play our audio. The zombie will then go into the <code class="literal">Walks</code> function, which has already been<a id="id368" class="indexterm"></a> defined in the script.</p><p>Save the script and minimize MonoDevelop. If you preview the scene in the <span class="strong"><strong>Game</strong></span> view, there will not be any noticeable change to the zombie's behavior.</p><p>Despite the fact that you can switch the <code class="literal">alerted</code> boolean on (it will be visible in the <span class="strong"><strong>Inspector</strong></span> panel) by pressing the <span class="strong"><strong>Fire1</strong></span> button (set by default to the left mouse button), the zombie will not turn toward the player as the player's <span class="strong"><strong>Transform</strong></span> has not yet been defined as the target.</p><p>We can take care of that next.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec44"></a>Connecting the variables in the Inspector panel</h3></div></div></div><p>Variables can often be<a id="id369" class="indexterm"></a> defined completely within the script, but Unity's drag-and-drop functionality makes connecting variables extremely quick and easy.</p><p>First, we will define the player as the target:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Make sure that the <code class="literal">zombie_f</code> game object is selected in the <span class="strong"><strong>Hierarchy</strong></span> panel—its components should appear in the <span class="strong"><strong>Inspector</strong></span> panel. If necessary, scroll down until all of the <code class="literal">zombie_ready</code> script's variables are visible.</p></li><li><p>Drag the <code class="literal">FPSController</code> game object from the <span class="strong"><strong>Hierarchy</strong></span> panel into the target variable slot.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Sounds</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Drag <code class="literal">zombie_growl</code> into the <span class="strong"><strong>snarlSound</strong></span> slot in the <span class="strong"><strong>Inspector</strong></span> panel.</p><p>In order to play sound, game objects need to have an audio source component attached to them.</p></li><li><p>Add the <span class="strong"><strong>Audio Source</strong></span> component from the <span class="strong"><strong>Component</strong></span> tab in the menu bar at the top of the Unity interface by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span>.</p></li></ol></div><p>It is not necessary<a id="id370" class="indexterm"></a> to specify the file within the <span class="strong"><strong>Audio Source</strong></span> component, as we have already taken care of that in the script.</p><p>Additionally, when game objects have more than one sound to play, it is preferable to define the audio clip in the script rather than the component.</p><p>Both the target and sound variables have now been defined, and there should be some noticeable changes when the game is previewed:</p><div class="mediaobject"><img src="/graphics/9781849696364/graphics/6364OT_06_01.jpg" /></div><p>The zombie will idle for a short time before starting her walk cycle as before. This time, when the fire<a id="id371" class="indexterm"></a> button is pressed, she will walk toward the player and the snarl sound should play.</p><p>Now that we have set up some basic behavior, we just need to make a few changes to the animator controller in order to see our face animation in the game.</p></div></div>