<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec83"></a>Creating health bars</h2></div></div><hr /></div><p>One of the advantages that the new <a id="id692" class="indexterm"></a>UI system has over the previous one is the fact that you can place UI elements in either 2D or 3D as an overlay to the screen, just as we did before or as part of the game world itself. With that in mind, I thought a good first thing to implement would be health bars above our enemy's heads from our shooter project that we worked on in <a class="link" href="#" linkend="ch04">Chapter 4</a>, <span class="emphasis"><em>First Person Shooter Part 1 – Creating Exterior Environments</em></span>, <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>First Person Shooter Part 2 – Creating Interior Environments</em></span>, and <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>First Person Shooter Part 3 – Implementing Gameplay and AI</em></span>. We perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We are going to first <a id="id693" class="indexterm"></a>open our first person shooter project we created back in <a class="link" href="#" linkend="ch04">Chapter 4</a>, <span class="emphasis"><em>First Person Shooter Part 1 – Creating Exterior Environments</em></span>, <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>First Person Shooter Part 2 – Creating Interior Environments</em></span>, and <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>First Person Shooter Part 3 – Implementing Gameplay and AI</em></span>. Open up your exterior scene (in the example code, saved as <code class="literal">Chapter4_Exterior</code>). Once loaded, double-click on the <span class="strong"><strong>Ghost</strong></span> object in order to center it on the screen. For visibility's sake, toggle the lighting off by clicking on the sun icon to the right of the 2D option under the <span class="strong"><strong>Scene</strong></span> tab. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_01.jpg" /></div></li><li><p>The first thing we need to do to add UI elements using the new UI system is create a canvas. To do that, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Canvas</strong></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_02.jpg" /></div><p>You can think of the <a id="id694" class="indexterm"></a>canvas as a holder for how a group of UI elements will be rendered. It's possible to have more than one canvas in a scene but to have an element of the new UI, you will have to place it onto a canvas.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note92"></a>Note</h3><p>If you try to create a UI element, one doesn't already exist, one will be created for you automatically, and the element will be placed as a child.</p></div><p>When we create a <span class="strong"><strong>Canvas</strong></span> object, we are given a new module called <span class="strong"><strong>Rect</strong></span> that replaces the <span class="strong"><strong>Transform</strong></span> module we've been used to. This allows us to scale, rotate, and modify the UI using one tool, which is the newly created one on the right-hand side, next to the scaling tool in the top-left corner.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note93"></a>Note</h3><p>For more information on the <span class="strong"><strong>Rect</strong></span> component, check out the <a id="id695" class="indexterm"></a>tutorial video at <a class="ulink" href="http://unity3d.com/learn/tutorials/modules/beginner/ui/rect-transform" target="_blank">http://unity3d.com/learn/tutorials/modules/beginner/ui/rect-transform</a>.</p></div></li><li><p>Double-click on the <span class="strong"><strong>Canvas</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> tab so that we can see the whole object. Now, one of the first things you'll probably notice is that the canvas is really, really big. That's because the size of the canvas is based on the size of what's displayed on the <span class="strong"><strong>Game</strong></span> tab, because the <span class="strong"><strong>Render Mode</strong></span> property is set to <span class="strong"><strong>Screen Space – Overlay</strong></span> by default.</p></li><li><p>Change the <span class="strong"><strong>Render Mode</strong></span> property<a id="id696" class="indexterm"></a> to <span class="strong"><strong>World Space</strong></span>, because we want it to be in the game world. You should notice now that the <span class="strong"><strong>Rect Transform</strong></span> properties are no longer greyed out, showing us that now we are allowed to modify them. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_03.jpg" /></div><p>Instead of just being placed in front of everything, this mode changes our canvas to be an actual object in the world, which we can place wherever we want but can still interact with. It's like a television or computer monitor in our game world, onto which the elements we place in the canvas will be printed.</p></li><li><p>Since it's in the world now, we're going to want to adjust the size of our <span class="strong"><strong>Rect</strong></span> module to handle just the content that we want in the world. In this instance, change the <span class="strong"><strong>Width</strong></span> property to <code class="literal">130</code> and the <span class="strong"><strong>Height</strong></span> property to <code class="literal">20</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note94"></a>Note</h3><p>You should change the width and height to fit everything in your UI. In this instance, we are just going to have a scrollbar and some text, so I know the size of it is 130 x 20. This value can be modified at anytime as long as the <span class="strong"><strong>Render Mode</strong></span> property is set to <span class="strong"><strong>World Space</strong></span>.</p></div></li><li><p>We want to place the health bar above our enemies' heads, so we should make this canvas a child of the <span class="strong"><strong>Ghost</strong></span> object. To do that, click and hold the <span class="strong"><strong>Canvas</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> tab, and drop it on top of the <span class="strong"><strong>Ghost</strong></span> object.</p></li><li><p>As we already know, children <a id="id697" class="indexterm"></a>of an object have a position that is based on the parent. So, with that in mind, we're going to use a trick to place the canvas directly on the enemy. To do that, right-click on the <span class="strong"><strong>Rect Transform</strong></span> component on the <span class="strong"><strong>Canvas</strong></span> object, and then select <span class="strong"><strong>Reset Position</strong></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_04.jpg" /></div></li><li><p>We're getting there, but the object is still way too big for what we want to do. But we don't want to modify the width and height. In this instance, making use of the <span class="strong"><strong>Scale</strong></span> property would be a great solution. Change the <span class="strong"><strong>Scale</strong></span> property to <code class="literal">.010</code> in all of the axes. If you <a id="id698" class="indexterm"></a>double-click, you'll see that the object is now placed at the bottom of our enemy. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_05.jpg" /></div></li><li><p>Now that we have this, let's use the translate tool and move the canvas so that it's over our enemy's head, or you can just change the <span class="strong"><strong>Pos Y</strong></span> property to <code class="literal">2.5</code>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_06.jpg" /></div></li><li><p>This looks pretty nice, but let's add in something so that we can actually see it. For our purposes, we are going to use a slider as the basis of our lifebar. To do that, with the <span class="strong"><strong>Canvas</strong></span> object selected, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Slider</strong></span>, as shown in the following screenshot.</p><p>A <span class="strong"><strong>slider</strong></span> is a graphic<a id="id699" class="indexterm"></a> with a handle that the user can drag to change a value between a minimum value and a maximum value. In this instance, we are using a slider for its display purpose rather than the interaction that it offers, but let's first see what it does. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_07.jpg" /></div><p>Now, if you play<a id="id700" class="indexterm"></a> the game, you'll notice that we can jump into the game and actually change the slider. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_08.jpg" /></div><p>Now, this is<a id="id701" class="indexterm"></a> really cool if you want to actually create menus in your world like in the Dead Space series, but we don't really want the player to change that, as we'll be setting it in the code.</p></li><li><p>Expand the <span class="strong"><strong>Slider</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> tab to see the <span class="strong"><strong>Fill Area</strong></span> and <span class="strong"><strong>Handle Slide Area</strong></span> objects. Delete the <span class="strong"><strong>Handle Slide Area</strong></span> object, as we won't need it.</p></li><li><p>After that, expand the <span class="strong"><strong>Fill Area</strong></span> object, and select the <span class="strong"><strong>Fill</strong></span> object. From there, set the <span class="strong"><strong>Color</strong></span> property on the <span class="strong"><strong>Image</strong></span> component to a green color to make it look more like a health bar:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_09.jpg" /></div></li><li><p>Now, back in the <span class="strong"><strong>Slider</strong></span> object in the <span class="strong"><strong>Slider</strong></span> component, uncheck the <span class="strong"><strong>Interactable</strong></span> <a id="id702" class="indexterm"></a>property. Now, the object will not be able to receive the mouse clicks to change its value.</p></li><li><p>We now have the objects created, but there's no interaction as of yet. With that in mind, we're going to need to jump into some code, specifically in our <code class="literal">EnemyBehaviour</code> script. Open it in <code class="literal">MonoDevelop</code>.</p></li><li><p>From there, the first thing we're going to need to do is add a new item to the top of the code in our <code class="literal">using</code> section, as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine.UI;</pre></div></li><li><p>After this, we also need to add a new variable, as follows:</p><div class="informalexample"><pre class="programlisting">// Reference for drawing the healthbar
public Slider healthBar;</pre></div></li><li><p>Now, we need to add a new function, which we will call whenever this needs to be updated:</p><div class="informalexample"><pre class="programlisting">  private void UpdateHealthbar()
  {
    healthBar.value = currentHealth/health;
  }</pre></div><p>In this example, the <code class="literal">value</code> property of the health bar is a value from <code class="literal">0</code> to <code class="literal">1</code>, which is how much of the slider should be filled in.</p></li><li><p>Now, we need to add a call to this function in both the <code class="literal">Start</code> and <code class="literal">TakeDamage</code> functions:</p><div class="informalexample"><pre class="programlisting">UpdateHealthbar();</pre></div></li><li><p>Next, save your file, move<a id="id703" class="indexterm"></a> back to Unity, and assign the <span class="strong"><strong>Slider</strong></span> object to the <span class="strong"><strong>Health Bar</strong></span> property. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_10.jpg" /></div></li><li><p>After this, save your scene, and click on the play icon! The following screenshot comes up:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_09_11.jpg" /></div></li></ol></div><p>The health bar works, and <a id="id704" class="indexterm"></a>we now have an easy way to tell how well our shots are damaging enemies!</p></div>