<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec63"></a>Using controller input</h2></div></div><hr /></div><p>One of the biggest <a id="id514" class="indexterm"></a>advantages of using Unity as a<a id="id515" class="indexterm"></a> game engine is the fact that you can support multiple platforms with minimal changes to your base game. In fact, right now, if you plug in an Xbox 360 Controller into your computer, restart Unity, and then try to play the game, you'll notice that the left-hand side joystick already moves the player, and if you press the <span class="emphasis"><em>Y</em></span> button, you will jump into the air. However, some of the aspects don't work, so let's get them implemented.</p><p>Let's get started by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing that we're going to need to do is let Unity know that we want to work with some new input. So, to do that, we will need to navigate to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Input</strong></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_14.jpg" /></div></li><li><p>Once there, we need to add four new axes to our project, the first being a new horizontal axis; so right-click on the <span class="strong"><strong>Mouse X</strong></span> axis, and select <span class="strong"><strong>Duplicate Array Element</strong></span>.</p></li><li><p>Extend the newly created <span class="strong"><strong>Mouse X</strong></span> axes, and rename it to <code class="literal">360 Right Horizontal</code>. The controller output is never 100-percent correct, so we want to change the <span class="strong"><strong>Dead</strong></span> value to <code class="literal">.05</code> so that any value between <code class="literal">-.05</code> and <code class="literal">.05</code> won't be counted.</p></li><li><p>Change the <a id="id516" class="indexterm"></a>
<span class="strong"><strong>Type</strong></span> value to <span class="strong"><strong>Joystick </strong></span><a id="id517" class="indexterm"></a>
<span class="strong"><strong>Axis</strong></span> and the <span class="strong"><strong>Axis</strong></span> value to <span class="strong"><strong>4th axis (Joysticks)</strong></span>.</p></li><li><p>Do the same for the <span class="strong"><strong>Mouse Y</strong></span> axis with the name <code class="literal">360 Right Vertical</code> using the <span class="strong"><strong>5th axis (Joysticks)</strong></span> option. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_15.jpg" /></div></li><li><p>Now, we will <a id="id518" class="indexterm"></a>need to alter the <a id="id519" class="indexterm"></a>character controller's <code class="literal">MouseLook</code> script file, so double-click on it to open MonoDevelop. Once opened, add the following highlighted code to its <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">  void Update ()
  {
    if (axes == RotationAxes.MouseXAndY)
    {
      float rotationX = transform.localEulerAngles.y +
                            Input.GetAxis("Mouse X") * sensitivityX;
      
      rotationY += Input.GetAxis("Mouse Y") * sensitivityY;
      rotationY = Mathf.Clamp (rotationY, minimumY, maximumY);
      
      transform.localEulerAngles = new Vector3(-rotationY, rotationX, 0);
    }
    else if (axes == RotationAxes.MouseX)
    {
      transform.Rotate(0, Input.GetAxis("Mouse X") * 
                          sensitivityX, 0);
    }
    else
    {
      rotationY += Input.GetAxis("Mouse Y") * sensitivityY;
      rotationY = Mathf.Clamp (rotationY, minimumY, maximumY);
      
      transform.localEulerAngles = new Vector3(-rotationY, 
                                       transform.localEulerAngles.y, 0);
    }

<span class="strong"><strong>    float rotationX360 = transform.localEulerAngles.y + </strong></span>
<span class="strong"><strong>                            Input.GetAxis("360 Right Horizontal") * </strong></span>
<span class="strong"><strong>                            sensitivityX;</strong></span>
<span class="strong"><strong>    </strong></span>
<span class="strong"><strong>    rotationY -= Input.GetAxis("360 Right Vertical") * sensitivityY;</strong></span>
<span class="strong"><strong>    rotationY = Mathf.Clamp (rotationY, minimumY, maximumY);</strong></span>
<span class="strong"><strong>    </strong></span>
<span class="strong"><strong>    transform.localEulerAngles = new Vector3(-rotationY, </strong></span>
<span class="strong"><strong>                                            rotationX360, 0);</strong></span>
  }</pre></div><p>This code will make the right joystick rotate the player's camera.</p></li><li><p>Now that<a id="id520" class="indexterm"></a> we have that done, let's get <a id="id521" class="indexterm"></a>the camera and shoot to work. To do that, we need to now open the <code class="literal">PhoneBehaviour</code> script. First of all, we're going to need to introduce a new variable to account for the fact that we want the player to have to release the right trigger before they can shoot again:</p><div class="informalexample"><pre class="programlisting">bool shotStarted = false;</pre></div></li><li><p>Now, we will update the <code class="literal">Update</code> function to the following code. Note the changes in bold:</p><div class="informalexample"><pre class="programlisting">void Update () 
{
<span class="strong"><strong>    if ((Input.GetMouseButton(1) || </strong></span>
<span class="strong"><strong>           Input.GetAxis("360 Left Trigger") &gt; 0) </strong></span>
<span class="strong"><strong>           &amp;&amp; (Input.GetMouseButtonDown(0) || </strong></span>
<span class="strong"><strong>           (Input.GetAxis("360 Right Trigger") &gt; 0 </strong></span>
<span class="strong"><strong>           &amp;&amp; !shotStarted)))</strong></span>
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>      shotStarted = true;</strong></span>
      StartCoroutine(CameraFlash());

      GameObject[] enemyList = 
                      GameObject.FindGameObjectsWithTag("Enemy");

      foreach (GameObject enemy in enemyList)
      {
        if(enemy.renderer.isVisible)
        {
          EnemyBehaviour behaviour = 
        enemy.transform.parent.gameObject.GetComponent&lt;EnemyBehaviour&gt;();
          behaviour.TakeDamage();
        }
      }
    }
<span class="strong"><strong>    else if(Input.GetAxis("360 Right Trigger") == 0)</strong></span>
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>      shotStarted = false;</strong></span>
<span class="strong"><strong>    }</strong></span>

    if (Input.GetMouseButton(1)<span class="strong"><strong> || Input.GetAxis("360 Left Trigger") &gt; 0)</strong></span>
    {
      this.camera.enabled = true;
      border.enabled = true;
    }
    else
    {
      this.camera.enabled = false;
      border.enabled = false;
    }
  
  }</pre></div></li><li><p>Save your scripts, and start the game. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_16.jpg" /></div></li></ol></div><p>At this point, you<a id="id522" class="indexterm"></a> should be able to play the project <a id="id523" class="indexterm"></a>using an Xbox 360 Controller!</p><p>Now, depending on what platform you're running Unity on, there may be special things to take into consideration. For more information about using the <a id="id524" class="indexterm"></a>Xbox 360 Controller, please visit <a class="ulink" href="http://wiki.unity3d.com/index.php?title=Xbox360Controller" target="_blank">http://wiki.unity3d.com/index.php?title=Xbox360Controller</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note76"></a>Note</h3><p>For those that don't want to deal with input too much and just want something that will standardize your input for common controllers, I hear good things about Gallant Games' InControl input manager, which<a id="id525" class="indexterm"></a> you can find out more about from <a class="ulink" href="http://www.gallantgames.com/incontrol" target="_blank">http://www.gallantgames.com/incontrol</a>.</p><p>While not all the features are included, they<a id="id526" class="indexterm"></a> have an open source version of most of the content at <a class="ulink" href="http://github.com/pbhogan/InControl" target="_blank">http://github.com/pbhogan/InControl</a>; but if you use their tool, I recommend that you buy it to support further development.</p></div></div>