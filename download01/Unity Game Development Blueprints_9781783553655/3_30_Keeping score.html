<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec34"></a>Keeping score</h2></div></div><hr /></div><p>We now <a id="id225" class="indexterm"></a>want to make it so that when we collect all of the orbs in the level, the goal will appear, and then you will win the game when you touch it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Go back into <code class="literal">MonoDevelop</code>, and select the <code class="literal">GameController</code> class. Once there, add the following variables:</p><div class="informalexample"><pre class="programlisting">public static GameController _instance;
private int orbsCollected;
private int orbsTotal;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note42"></a>Note</h3><p>While it may make more sense English-wise to use <code class="literal">totalOrbs</code> and <code class="literal">collectedOrbs</code>, programming-wise, putting the common word first means that when you start typing orbs, it will show both options for you when working with code completion in your own projects.</p></div></li><li><p>As normal, we will need to set these variables as well in the <code class="literal">Start</code> function after the <code class="literal">BuildLevel</code> function call,  otherwise the <code class="literal">Orb</code> objects will not exist:</p><div class="informalexample"><pre class="programlisting">GameObject[] orbs;
orbs = GameObject.FindGameObjectsWithTag("Orb");

orbsCollected = 0;
orbsTotal = orbs.Length;</pre></div></li><li><p>We will also want to initialize the <code class="literal">_instance</code> variable, but instead of using <code class="literal">Start</code>, we will use <code class="literal">Awake</code>, as follows:</p><div class="informalexample"><pre class="programlisting">void Awake()
{
  _instance = this;
}</pre></div></li></ol></div><p>
<code class="literal">Awake</code> gets called before <code class="literal">Start</code>, which is important, because you have to initialize the <code class="literal">_instance</code> variable before you use it. This is known as a lazy singleton.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec21"></a>Singletons</h3></div></div></div><p>As you work in Unity, you may find that you <a id="id226" class="indexterm"></a>have certain managers, such as <code class="literal">GameController</code>, that we will only have one of. Rather than having to have other objects, store them as variables, or find them at runtime, we can use a design pattern called the <a id="id227" class="indexterm"></a>
<span class="strong"><strong>singleton pattern</strong></span>. The gist of this is that there is one, and only one, object of this class that can be created. The version that I am using is the quickest way to get singleton-like behavior going.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note43"></a>Note</h3><p>Never use the <code class="literal">GameController._instance</code> variable inside another <code class="literal">Awake</code> function, as you are not guaranteed the order in which they'll be called. However, if you use it in <code class="literal">Start</code> or any of the other functions we talked about, you'll be okay because <code class="literal">Start</code> is guaranteed to be called after <code class="literal">Awake</code>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>As we collect<a id="id228" class="indexterm"></a> orbs, we want to increase the value of our <code class="literal">orbsCollected</code> variable. Rather than just giving other things access to the variable, let's wrap this around a function so that we can do other things, such as updating the GUI later on. Have a look at the following code snippet, which will increment our <code class="literal">orbsCollected</code> variable by <code class="literal">1</code>:</p><div class="informalexample"><pre class="programlisting">public void CollectedOrb()
{
  orbsCollected++;
}</pre></div><p>In our <code class="literal">OrbBehaviour</code> script we call the function:</p><div class="informalexample"><pre class="programlisting">void OnTriggerEnter(Collider other) 
{
<span class="strong"><strong>  GameController._instance.CollectedOrb();</strong></span>
  Destroy(this.gameObject);
}</pre></div><p>When you access the <code class="literal">_instance</code> variable, you get access to the public functions and variables that exist in the class.</p></li><li><p>With that completed, save the file and go back to the Unity Editor. Now that we have this data stored, let's display it on the screen so that players can see. Go to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>GUIText</strong></span>. Place it in the top-left corner of the screen (a position of <code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">0</code> with an anchor of upper-left and alignment of left), and give the object the name <code class="literal">GUI â€“ Score</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note44"></a>Note</h3><p>If you are using the Unity 4.6 beta or higher, simply create an empty game object, and add a <code class="literal">GUIText</code> component from <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Rendering</strong></span> | <span class="strong"><strong>GUIText</strong></span>.</p></div></li><li><p>Add one last variable to add to <code class="literal">GameController</code>, as follows:</p><div class="informalexample"><pre class="programlisting">public GUIText scoreText;</pre></div></li><li><p>We need to initialize it in the <code class="literal">Start</code> function, as follows:</p><div class="informalexample"><pre class="programlisting">void Start() 
{
  BuildLevel();

  GameObject[] orbs;
  orbs = GameObject.FindGameObjectsWithTag("Orb");
  
  orbsCollected = 0;
  orbsTotal = orbs.Length;

<span class="strong"><strong>  scoreText.text = "Orbs: " + orbsCollected + "/" + orbsTotal;</strong></span>
}</pre></div></li><li><p>And now, because we have text displaying the orbs, we can now update our text accordingly. Have a look at the following screenshot:</p><div class="informalexample"><pre class="programlisting">public void CollectedOrb()
{
  orbsCollected++;
<span class="strong"><strong>  scoreText.text = "Orbs: " + orbsCollected + "/" + orbsTotal;</strong></span>
}</pre></div></li><li><p>With that, save the<a id="id229" class="indexterm"></a> script, and then go back into the Unity editor. Once there, set our newly created variable with the GUI text object we created, and then click on the play button, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_03_15.jpg" /></div></li></ol></div><p>At this point, you <a id="id230" class="indexterm"></a>can move around the level, and when you collect the orbs, they will now update the GUI, letting us know how many coins you collected and how many there are in total in the level. We're making great progress, and we almost have a full game; we just need one last thing, a way to win!</p></div></div>