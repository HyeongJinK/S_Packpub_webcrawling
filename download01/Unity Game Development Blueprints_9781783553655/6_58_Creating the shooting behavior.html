<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec59"></a>Creating the shooting behavior</h2></div></div><hr /></div><p>Now, with a traditional first<a id="id438" class="indexterm"></a> person shooter, we <a id="id439" class="indexterm"></a>shoot a bullet from a gun to damage enemies. However, we will create a camera that will shoot pictures to damage enemies. To show how easy it is to do, let's get started! Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing we need to do is go to the <span class="strong"><strong>FlashlightController</strong></span> object we created earlier. So, with it selected, double-click on it to center the camera on it.</p></li><li><p>Our camera weapon is going to be another object, which will be a child of the <span class="strong"><strong>Main Camera</strong></span> object. To do this, first select the <span class="strong"><strong>Main Camera</strong></span> object that is located on our <span class="strong"><strong>FlashlightController</strong></span> object and then navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty Child</strong></span>. Also, in the <span class="strong"><strong>Inspector</strong></span> section for this newly created object, confirm whether the object's position is <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>. If it isn't, set it. Finally, name the object <code class="literal">Photo Camera</code>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_1.jpg" /></div></li><li><p>Next, add a <a id="id440" class="indexterm"></a>camera component<a id="id441" class="indexterm"></a> by clicking on the <span class="strong"><strong>Add Component</strong></span> button at the bottom of the <span class="strong"><strong>Inspector</strong></span> tab and then putting in the text <code class="literal">Camera</code> in the search bar before selecting it. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note70"></a>Note</h3><p>Alternatively, you can just navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Addâ€¦</strong></span> from the top bar to bring up the menu.</p></div></li><li><p>This camera will be zoomed in from the normal camera, so I'm going to change the <span class="strong"><strong>Field of View</strong></span> value to <code class="literal">30</code>.</p></li><li><p>We also want this camera to be on top of the previously created one, so we are going to change the <span class="strong"><strong>Depth</strong></span> value to <code class="literal">1</code> (higher numbers put things in front of the other cameras).</p></li><li><p>That being said, we still want to see our previous camera as well in the background, so we're going to set the <span class="strong"><strong>Viewport Rect</strong></span> values to put our new camera in the <a id="id442" class="indexterm"></a>center of the <a id="id443" class="indexterm"></a>screen at 75 percent of the size of the previous one. To do that, set the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> properties in the <span class="strong"><strong>Viewport Rect</strong></span> option to <code class="literal">.125</code> and the <span class="strong"><strong>W</strong></span> and <span class="strong"><strong>H</strong></span> properties to <code class="literal">.75</code>. To see the results of our work, check out the <span class="strong"><strong>Game</strong></span> tab. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_2.jpg" /></div></li><li><p>Now, in our game, this camera isn't just going to be a camera; it's also going to have a border around it. In this case, it'll be a cell phone. From the <code class="literal">Chapter 6/Assets</code> location, grab the <code class="literal">phone.png</code> file, and move it into the <code class="literal">Materials</code> folder inside your project browser.</p></li><li><p>Once it's imported, select it to bring up the properties in the <span class="strong"><strong>Inspector</strong></span> tab. By default, in a 3D project, <code class="literal">.png</code> files will be imported with a <span class="strong"><strong>Texture Type</strong></span> value of <code class="literal">Texture</code>. We want to change it to <code class="literal">GUI (Editor \ Legacy)</code>, so click on <span class="strong"><strong>Apply</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note71"></a>Note</h3><p>Depending on the version of Unity you are using, you will most likely see different things. In 4.3, you'll just see GUI. In 4.5, it'll look like the preceding screenshot. In 4.6, it will be Editor GUI and Legacy GUI.</p></div></li><li><p>Next, we need to add this texture to a custom GUI Skin to replace the default <span class="strong"><strong>Box</strong></span> background, so let's go into the <span class="strong"><strong>Project</strong></span> tab and navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>GUI Skin</strong></span> and name it <code class="literal">PhoneSkin</code>.</p></li><li><p>With the new <a id="id444" class="indexterm"></a>GUI Skin selected, in<a id="id445" class="indexterm"></a> the <span class="strong"><strong>Inspector</strong></span> section, expand the <span class="strong"><strong>Box</strong></span> property and, from there, expand the <span class="strong"><strong>Normal</strong></span> selection, and change the <span class="strong"><strong>Background</strong></span> property to the phone image, as you can see in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_3.jpg" /></div></li><li><p>Finally, we need to add this border to our <span class="strong"><strong>Photo Camera</strong></span> object, so let's create a new C# script called <code class="literal">PhoneBorder</code>. Open the newly created script in MonoDevelop and put the following code in it. Have a look at the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

// Code will run even if the game isn't playing
// so we can see it all the time in the Game tab.
[ExecuteInEditMode]  
public class PhoneBorder : MonoBehaviour {
  public GUISkin phoneSkin;

  // How far to shift the image from the top left (in // pixels)
  public int xOffset = -30;
  public int yOffset = 0;

  // How far to extend the image from the bottom right (in // pixels)
  public int xExtend = 80;
  public int yExtend = 20;
  
  void OnGUI()
  {
    if(phoneSkin)
      GUI.skin = phoneSkin ;
    Camera cam = transform.camera;

    // Will create a box which will fill the screen above // our camera
    GUI.Box(new Rect(cam.pixelRect.x + xOffset, 
                     (Screen.height - cam.pixelRect.yMax) + yOffset, 
                     cam.pixelWidth + xExtend, 
                     cam.pixelHeight + yExtend), "") ;
  }
}</pre></div></li><li><p>Now, save the<a id="id446" class="indexterm"></a> script and exit back<a id="id447" class="indexterm"></a> into the Unity Editor. Then, attach the <code class="literal">PhoneBorder</code> script to the phone camera object, and assign the phone skin variable to the GUI Skin we made in Step 10. You should now see the phone pop up, as shown in the following screenshot:</p><p>What this code basically does is render a box onto the screen that is positioned in the top-left corner of the camera, and is as large as the camera. The variables that we created for the offset  extend and alter the image so that the camera we created is inside the phone. Take some time to modify the variables to see how each of them modifies the image. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_4.jpg" /></div></li><li><p>Right now, I <a id="id448" class="indexterm"></a>have the aspect ratio<a id="id449" class="indexterm"></a> set to <span class="strong"><strong>4:3</strong></span>, which we can see in the <span class="strong"><strong>Game</strong></span> tab in the top-left corner just below the tab. This ratio is of the same size as old television sets and monitors, but the code we just created also works with widescreen monitors and makes the camera look much better. So, let's make the game use an aspect ratio of <span class="strong"><strong>16:9</strong></span>. We can do that by clicking on the drop-down list beside <span class="strong"><strong>4:3</strong></span> and then selecting <span class="strong"><strong>16:9</strong></span>.</p><p>If you play the game at this point, the game should look something like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_5.jpg" /></div><p>Looks<a id="id450" class="indexterm"></a> pretty good! But <a id="id451" class="indexterm"></a>right now, the camera is always up there, and I only want to see it if the player right-clicks to zoom in.</p></li><li><p>So, with that in mind, let's create another C# script called <code class="literal">PhoneBehaviour</code> and open it inside MonoDevelop.</p></li><li><p>Place the following code into the <code class="literal">PhoneBehaviour</code> class as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PhoneBehaviour : MonoBehaviour {

  private PhoneBorder border;

  // Use this for initialization
  void Start () 
   {
    border = GetComponent&lt;PhoneBorder&gt; ();
  }
  
  // Update is called once per frame
  void Update () 
   {
    if (Input.GetMouseButton(1))
    {
      this.camera.enabled = true;
      border.enabled = true;
    }
    else
    {
      this.camera.enabled = false;
      border.enabled = false;
    }
  
  }
}</pre></div></li></ol></div><p>Now, the camera<a id="id452" class="indexterm"></a> will only come up whenever <a id="id453" class="indexterm"></a>we hold down the right mouse button! Awesome! It's just like a sniper rifle in most FPS games.</p><p>Next, we want to add the ability to shoot our weapon and flash it on the screen whenever the camera is shot. To simulate this behavior, we will first create an image to be placed over our entire screen. We perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Just to make it easier to see things, let's first go to the <span class="strong"><strong>Photo Camera</strong></span> object and disable the <span class="strong"><strong>Camera</strong></span> and <span class="strong"><strong>Phone Border</strong></span> scripts by unchecking their components from the <span class="strong"><strong>Inspector</strong></span> menu.</p></li><li><p>Next, we will add a new GUI texture object by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>GUITexture</strong></span>. Let's rename this object <code class="literal">Phone Flash</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note72"></a>Note</h3><p>If you are using version 4.6 or later, you can create a GUI texture by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create General</strong></span> | <span class="strong"><strong>GUITexture</strong></span> or create an empty game object and add a GUITexture component.</p></div></li><li><p>Bring in the <code class="literal">Flash.png</code> image from our chapter's <code class="literal">Assets</code> folder into the <code class="literal">Materials</code> folder of our project browser, and change the GUI texture's <span class="strong"><strong>Texture</strong></span> value to that.</p></li><li><p>Now, we need to set the image's width (<span class="strong"><strong>W</strong></span>) and height (<span class="strong"><strong>H</strong></span>) to the biggest resolution that you want to support; I'm using a value of <code class="literal">4000</code>. Next, set the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> positions to negative; halve the value (<code class="literal">-2000</code>) to center the image to your screen.</p></li><li><p>Click on the box beside the <span class="strong"><strong>Color</strong></span> property, and change the <span class="strong"><strong>A</strong></span> option (alpha) to <code class="literal">0</code>, so we can still see the rest of the world.</p></li><li><p>Next, go back into the <code class="literal">PhoneBehaviour</code> file, and add in the following variable:</p><div class="informalexample"><pre class="programlisting">public GameObject cameraFlash;</pre></div></li><li><p>Now, a flash contains two parts: fading to white and then fading to a transparent color. The pieces of code doing both of these things are very similar, so we will create a helper function to do this for us, called <code class="literal">Fade</code>. Have a look <a id="id454" class="indexterm"></a>at the following <a id="id455" class="indexterm"></a>code:</p><div class="informalexample"><pre class="programlisting">    IEnumerator Fade (float start, float end, float length, 
                      GameObject currentObject) 
  { 
    if (currentObject.guiTexture.color.a == start)
    {
      Color curColor;
      for (float i = 0.0f; i &lt; 1.0f; i += Time.deltaTime*(1/length)) 
      { 
        // Cannot modify the color property directly, so we 
        // need to create a copy
        curColor = currentObject.guiTexture.color;

        // Do a linear interpolation of the value of the
        // transparency from the start 
        // value to the end value in equal increments
        curColor.a = Mathf.Lerp(start, end, i); 

        // Then we assign the copy to the original object
        currentObject.guiTexture.color = curColor;

        yield return null;
      }
      curColor = currentObject.guiTexture.color;

      // ensure the fade is completely finished (because 
      // lerp doesn't always end on the exact value due to 
      // rounding errors)
      curColor.a = end;
      currentObject.guiTexture.color = curColor;
    }
  }</pre></div><p>As you may recall from <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>2D Twin-stick Shooter</em></span>, we can use coroutines to pause functionality, yielding for a time and then resuming functionality. The <code class="literal">IEnumerator</code> class holds the current state of the program and tells us where to continue. The yield return here is asking us to stop the function now and resume after a period.</p><p>Since coroutines are just functions, we can also have parameters in them, just as in the preceding function. With this in mind, we can also nest them together in order to have complex interactions and use our abstracted functions in multiple ways to create interesting behaviors.</p></li><li><p>And then, we <a id="id456" class="indexterm"></a>will call this<a id="id457" class="indexterm"></a> function twice with our main function, <code class="literal">CameraFlash</code>, as follows:</p><div class="informalexample"><pre class="programlisting">IEnumerator CameraFlash()
{
    yield return StartCoroutine(Fade(0.0f, 0.8f, 0.2f, cameraFlash));
    yield return StartCoroutine(Fade(0.8f, 0.0f, 0.2f, cameraFlash));
    StopCoroutine ("CameraFlash");
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note73"></a>Note</h3><p>For more examples on how coroutines can be used, check out <a class="ulink" href="http://unitypatterns.com/introduction-to-coroutines/" target="_blank">http://unitypatterns.com/introduction-to-coroutines/</a> and <a class="ulink" href="http://unitypatterns.com/scripting-with-coroutines/" target="_blank">http://unitypatterns.com/scripting-with-coroutines/</a>.</p></div></li><li><p>Finally, this function will never be called if we don't call it, so add the following highlighted code to our <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">void Update () 
  {

    if (Input.GetMouseButton(1))
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>      // Flash the camera if I am aiming and I click</strong></span>
<span class="strong"><strong>      if(Input.GetMouseButtonDown(0))</strong></span>
<span class="strong"><strong>      {</strong></span>
<span class="strong"><strong>        StartCoroutine(CameraFlash());</strong></span>
<span class="strong"><strong>      }</strong></span>

      this.camera.enabled = true;
      border.enabled = true;
    }
    else
    {
      this.camera.enabled = false;
      border.enabled = false;
    }
  
  }</pre></div></li><li><p>Save the file<a id="id458" class="indexterm"></a> and go back into<a id="id459" class="indexterm"></a> the Unity Editor. Finally, back at the <code class="literal">Photo Camera</code> object, assign the <code class="literal">Phone Flash</code> object to the <code class="literal">Camera Flash</code> variable, and add a <code class="literal">GUILayer</code> component to the <code class="literal">Photo Camera</code> object by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Rendering</strong></span> | <span class="strong"><strong>GUILayer</strong></span> (otherwise the flash won't show up on the actual camera).</p></li><li><p>Save the scene (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>S</em></span>), and then click on the <span class="strong"><strong>Play</strong></span> button and try out your new camera. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_6.jpg" /></div></li></ol></div><p>Looks like <a id="id460" class="indexterm"></a>everything is in working order! We<a id="id461" class="indexterm"></a> can look around with our camera, zoom in and out, and shoot pictures.</p></div>