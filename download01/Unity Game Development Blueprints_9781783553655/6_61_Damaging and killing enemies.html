<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec62"></a>Damaging and killing enemies</h2></div></div><hr /></div><p>Now that we have <a id="id498" class="indexterm"></a>enemies moving towards us, we <a id="id499" class="indexterm"></a>need some way for them to be damaged <a id="id500" class="indexterm"></a>and killed! Let's do that now by<a id="id501" class="indexterm"></a> performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing we need to do is make it easy to get a reference to all of our enemies, so let's add a tag by going to the <span class="strong"><strong>Inspector</strong></span> tab and navigating to <span class="strong"><strong>Tag</strong></span> | <span class="strong"><strong>Add Tagâ€¦</strong></span>. Once the <span class="strong"><strong>Tag</strong></span> &amp; <span class="strong"><strong>Layer</strong></span> menus come up, type in <code class="literal">Enemy</code> into <span class="strong"><strong>Element 0</strong></span>. Then go back into the <span class="strong"><strong>Ghost_mesh</strong></span> child object, add the <span class="strong"><strong>Enemy</strong></span> tag to it, and rename the parent object to <code class="literal">Ghost</code>:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_12.jpg" /></div></li><li><p>Next, let's dive back into MonoDevelop, edit our <code class="literal">PhoneBehaviour</code> script, and add the following code in bold to its <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">  // Update is called once per frame
  void Update () {
    if (Input.GetMouseButtonDown(0) &amp;&amp; Input.GetMouseButton(1))
    {
      StartCoroutine(CameraFlash());

<span class="strong"><strong>      GameObject[] enemyList = GameObject.FindGameObjectsWithTag("Enemy");</strong></span>

<span class="strong"><strong>      foreach (GameObject enemy in enemyList)</strong></span>
<span class="strong"><strong>      {</strong></span>
<span class="strong"><strong>        if(enemy.renderer.isVisible)</strong></span>
<span class="strong"><strong>        {</strong></span>
<span class="strong"><strong>          EnemyBehaviour behaviour = enemy.transform.parent.gameObject.GetComponent&lt;EnemyBehaviour&gt;();</strong></span>
<span class="strong"><strong>          behaviour.TakeDamage();</strong></span>
<span class="strong"><strong>        }</strong></span>
<span class="strong"><strong>      }</strong></span>
    }

    if (Input.GetMouseButton(1))
    {
      this.camera.enabled = true;
      border.enabled = true;
    }
    else
    {
      this.camera.enabled = false;
      border.enabled = false;
    }
  
  }</pre></div></li><li><p>Now that we <a id="id502" class="indexterm"></a>say there is a <code class="literal">TakeDamage</code> function<a id="id503" class="indexterm"></a> in our <code class="literal">EnemyBehaviour</code> class, we need to add that in. Open the <code class="literal">EnemyBehaviour</code> class, and<a id="id504" class="indexterm"></a> first, we<a id="id505" class="indexterm"></a> need to create some variables as follows:</p><div class="informalexample"><pre class="programlisting">public float health = 100.0f;
private float currentHealth;</pre></div></li><li><p>Next, we need to initialize <code class="literal">currentHealth</code>, so add the following code in bold to the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">void Start () 
{
  GoToNextState();
<span class="strong"><strong>  currentHealth = health;</strong></span>
}</pre></div></li><li><p>Now, let's <a id="id506" class="indexterm"></a>add in the <code class="literal">TakeDamage</code> function, as<a id="id507" class="indexterm"></a> follows:</p><div class="informalexample"><pre class="programlisting">public void TakeDamage()
  {
    // The closer I am, the more damage I do
    float damageToDo = 100.0f - (GetDistance () * 5);

    if (damageToDo &lt; 0)
      damageToDo = 0;
    if (damageToDo &gt; health)
      damageToDo = health;

    currentHealth -= damageToDo;

    if(currentHealth &lt;= 0)
    {
      state = State.Die;
    }
    else
    {
      // If we're not dead, now that we took a picture the // enemy knows where we are
      followRange = Mathf.Max(GetDistance(), followRange);
      state = State.Follow;
    }

    print ("Ow! - Current Health: " + currentHealth.ToString());

  }</pre></div></li><li><p>Now, save your scene<a id="id508" class="indexterm"></a> and all the script files, and<a id="id509" class="indexterm"></a> play the game! The following screenshot depicts the game screen:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_06_13.jpg" /></div></li></ol></div><p>Now, the enemy<a id="id510" class="indexterm"></a> will follow you when you take its picture<a id="id511" class="indexterm"></a> and the closer you are to it, the more<a id="id512" class="indexterm"></a> it will get damaged, which you can<a id="id513" class="indexterm"></a> see by looking at the console!</p></div>