<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec68"></a>Saving a high score</h2></div></div><hr /></div><p>To begin with, let's look at one of<a id="id538" class="indexterm"></a> the simplest ways to save/load data for individual pieces of simple data using the <code class="literal">PlayerPrefs</code> class.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec31"></a>The PlayerPrefs class</h3></div></div></div><p>The <code class="literal">PlayerPrefs</code> class<a id="id539" class="indexterm"></a> allows us to store small amounts of data on the end user's machine. Using <code class="literal">PlayerPrefs</code> is a great way to save data for user levels, the coordinates of where enemies are, or a high score so that when the user comes back to the game, it shows the highest score achieved over the course of all games played.</p><p>When I say small amounts of data, on the WebPlayer you can store only 1 MB of data, but this is the only limitation aside from hard drive space as of this writing.</p><p>The <code class="literal">PlayerPrefs</code> class can store the following types: <code class="literal">float</code>, <code class="literal">int</code>, and <code class="literal">string</code>. There are two key functions for each of the types <code class="literal">Get</code> and <code class="literal">Set</code> with the type added afterward (<code class="literal">GetFloat</code>, <code class="literal">SetString</code>, and so on).</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec07"></a>The Set functions</h4></div></div></div><p>The <code class="literal">Set</code> functions<a id="id540" class="indexterm"></a> take in two parameters: the first being a string and the second of the<a id="id541" class="indexterm"></a> type you're trying to set. This will save the value in the second parameter to the registry on your computer with the string as a reference for you to get the data back with the <code class="literal">Get</code> function. For example, creating a string and storing it will be somewhat like the following code:</p><div class="informalexample"><pre class="programlisting">void Start() 
{
  string authorName = "John Doran";
  PlayerPrefs.SetString ("Author Name", authorName);
}</pre></div><p>If there was a value previously saved with that variable, its name will be overwritten with the new value.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note77"></a>Note</h3><p>To be sure that your variables do not get overwritten by other projects, it's important to make sure that you set <span class="strong"><strong>Product Name</strong></span> and <span class="strong"><strong>Company Name</strong></span> in <span class="strong"><strong>Project Settings</strong></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec08"></a>The Get functions</h4></div></div></div><p>The <code class="literal">Get</code> functions<a id="id542" class="indexterm"></a> will retrieve<a id="id543" class="indexterm"></a> the value that it currently has set if there is one. If it cannot find a value (that variable doesn't exist yet), it will return <code class="literal">0</code> (for the <code class="literal">int</code> and <code class="literal">float</code> datatypes) or <code class="literal">""</code> (for strings), or whatever you put in as the second parameter. So, as an example, I could write something like the following code:</p><div class="informalexample"><pre class="programlisting">void Start() 
{
  // If the above code was ran, it would return "John Doran" 
  // or whatever else was stored there. Otherwise, it will 
  // return "Bob"
  print(PlayerPrefs.GetString("Author Name", "Bob"));
}</pre></div><p>Then, if there already is a value assigned for <code class="literal">Author Name</code>, it will print out that, but otherwise, it will give you the value of <code class="literal">Bob</code>. This is great if you want to have a default value other than <code class="literal">0</code> or an empty string <code class="literal">""</code>.</p><p>Depending on what operating system you're currently using for this project or are porting to, the location of where the values are saved to are different. </p><p>Depending on <a id="id544" class="indexterm"></a>what platform your game is running, the location of these values may be different. <a id="id545" class="indexterm"></a>For those locations, or for more information <a id="id546" class="indexterm"></a>on the <code class="literal">PlayerPrefs</code> class, check out <a class="ulink" href="http://docs.unity3d.com/ScriptReference/PlayerPrefs.html" target="_blank">http://docs.unity3d.com/ScriptReference/PlayerPrefs.html</a>.</p><p>Now that we know how to use PlayerPrefs, let's see it in action by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We are going to first open our <span class="strong"><strong>TwinstickShooter</strong></span> project we created back in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>2D Twin-stick Shooter</em></span>, and <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Creating GUIs</em></span>. Open your gameplay scene (in the example code, saved as <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Creating GUIs</em></span>). Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_07_01.jpg" /></div></li><li><p>Since we<a id="id547" class="indexterm"></a> want to add a high score, we'll need to add in a new GUI text<a id="id548" class="indexterm"></a> object to display it. Switch to the <span class="strong"><strong>Game</strong></span> tab so that we can see our GUI elements.</p></li><li><p>Go to the <span class="strong"><strong>Scene</strong></span> tab if not there already, select <span class="strong"><strong>Waves Counter</strong></span> that we created earlier, and duplicate it by pressing <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>. Rename this newly created object to <code class="literal">High Score Counter</code>. After that, change the <span class="strong"><strong>Position</strong></span> property of <span class="strong"><strong>X</strong></span> to <code class="literal">.5</code> to center it. After this, change <span class="strong"><strong>Anchor</strong></span> to <code class="literal">Upper Center</code>. Finally, just to have it look correct, change <span class="strong"><strong>Text</strong></span> to <code class="literal">High Score: 0</code>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_07_02.jpg" /></div><p>Again, while the text here is shown to us now, just like the score and lives, it is merely for our reference, as we will need to update the text via code.</p></li><li><p>Now, we<a id="id549" class="indexterm"></a> will need to access our <code class="literal">GameController</code> class to make <a id="id550" class="indexterm"></a>some modifications! From <span class="strong"><strong>Project </strong></span>tab, open the <code class="literal">Scripts</code> folder, and double-click on the <code class="literal">GameController</code> file to open <code class="literal">MonoDevelop</code>.</p></li><li><p>The first thing we will do is add a new variable for our new text object, as follows:</p><div class="informalexample"><pre class="programlisting">public GUIText highScoreText;</pre></div></li><li><p>The first thing we'll need to do is initialize the value in the text inside our <code class="literal">Start</code> function, so add in the following bolded code:</p><div class="informalexample"><pre class="programlisting">void Start ()
{
  StartCoroutine(SpawnEnemies());
<span class="strong"><strong>  // Retrieves stored data if it exists from the </strong></span>
<span class="strong"><strong>  // PlayerPrefs, otherwise 0</strong></span>
<span class="strong"><strong>highScoreText.text = "High Score: " + </strong></span>
<span class="strong"><strong>                      PlayerPrefs.GetInt("highScore").ToString();</strong></span>
}</pre></div></li><li><p>Now, we need to update that value whenever we increase our score, so let's add the following bolded code to your <code class="literal">IncreaseScore</code> function:</p><div class="informalexample"><pre class="programlisting">public void IncreaseScore(int increase)
{
  score += increase;
  scoreText.text = "Score: " + score;

<span class="strong"><strong>  if( score &gt; PlayerPrefs.GetInt ("highScore"))</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>    // Now we are saving the value to the disk for </strong></span>
<span class="strong"><strong>    // retrieval later</strong></span>
<span class="strong"><strong>    PlayerPrefs.SetInt ("highScore", score);</strong></span>
<span class="strong"><strong>    highScoreText.text = "High Score: " + score.ToString();</strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div></li><li><p>Next, go <a id="id551" class="indexterm"></a>back to the Unity editor, and then select the <span class="strong"><strong>GameController</strong></span> object in<a id="id552" class="indexterm"></a> <span class="strong"><strong>Hierarchy</strong></span>. Make sure that <span class="strong"><strong>Wave Text</strong></span> is set to <code class="literal">Waves Counter</code> and <span class="strong"><strong>High Score Text</strong></span> is set to <code class="literal">High Score Counter</code>. After that, play the game and gain some points, and then close the game. After that, play it again. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_07_03.jpg" /></div></li></ol></div><p>If all goes well, we should <a id="id553" class="indexterm"></a>be able to notice that the high score has been saved and will stay even when <a id="id554" class="indexterm"></a>we restart the game!</p></div></div></div>