<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec31"></a>Tile-based level creation</h2></div></div><hr /></div><p>While our previous <a id="id166" class="indexterm"></a>game worked by only needing to spawn <a id="id167" class="indexterm"></a>enemies in the world, for most games with content, you'll typically have levels, each with its own environment. When building levels in games, there are some advantages to placing everything by hand, but if you're creating a game with many levels, that work will decrease your productivity. It's also important to note that the more assets you create for your game, the higher the cost.</p><p>With that in mind, it's a much better idea to create parts that can be reused to create games. If you've played older 2D games in the past, such as an adventure, RPG, or platforming games, you may have realized that there were a lot of places in the worlds that looked similar to each other, such as the trees, a wall, a chest, door, and so forth.</p><p>The reason they looked similar is due to the fact that they were using the same sprites. This is because they were truly tile-based games. A tile-based game is where the playing area consists of small rectangular, square, or hexagonal graphic images, referred to as tiles. Imagine a grid of blocks where every block is given a number or ID. Based on the ID, the game will determine how that grid is drawn and behaves when a player interacts with it.</p><p>An important thing to mention is that tile-based games are not a distinct genre; rather, the term refers to the technology a game engine uses for its visual representation. For example, most of the <span class="emphasis"><em>Pok√©mon</em></span> series of games are top-down, role-playing video games, and the traditional <span class="emphasis"><em>Mario</em></span> series of games are side-scrolling platformers, but both use a tile-based system for graphics. Tile-based engines allow developers to create large levels quickly with relatively few art assets, which is great as a programmer.</p><p>To show how easy it is to build, we will code a tile-based system for this project:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing that <a id="id168" class="indexterm"></a>we're <a id="id169" class="indexterm"></a>going to want to do is actually create the blocks we'll be placing for the world. Let's first create a cube by selecting <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>Cube</strong></span>.</p></li><li><p>We want this cube to have a collision so that our player can collide against it, but this time we will use a box collider. Check <span class="strong"><strong>Inspector</strong></span> to confirm that it is there. If not, add this component by selecting <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Box Collider</strong></span>.</p><p>The box collider is the 3D equivalent of the box collider 2D component for 3D space.</p></li><li><p>Rename the cube to <code class="literal">Wall</code> by selecting the top bar in <span class="strong"><strong>Inspector</strong></span>, renaming it, and pressing <span class="emphasis"><em>Enter</em></span>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_03_1.jpg" /></div></li><li><p>In the <span class="strong"><strong>Project</strong></span> tab, go to the <span class="strong"><strong>Prefabs</strong></span> folder, and drag-and-drop the <span class="strong"><strong>Wall</strong></span> object from <span class="strong"><strong>Hierarchy</strong></span> into it. Once that is finished, select <span class="strong"><strong>Wall</strong></span> in <span class="strong"><strong>Hierachy</strong></span>, and then delete it by pressing the <span class="emphasis"><em>Delete</em></span> key.</p></li><li><p>Now, we will be<a id="id170" class="indexterm"></a> spawning <a id="id171" class="indexterm"></a>a large amount of objects into our world. It would be a good idea to have a parent object to store all of these objects to avoid cluttering our <span class="strong"><strong>Hierarchy</strong></span>. To do this, let's create an empty game object by going to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span>. From there, with the object selected, go to <span class="strong"><strong>Inspector</strong></span>, set its name to <code class="literal">DynamicObjects</code>, and optionally, for neatness sake, set its <span class="strong"><strong>Position</strong></span> to (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>).</p></li><li><p>The next thing we will do is create a game controller to hold the behavior to create our blocks. Create an empty game object with the name <code class="literal">_GameController</code>, and reset its <span class="strong"><strong>Position</strong></span> to (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"></a>Note</h3><p>I put the <code class="literal">_</code> before the actual name of the object in my projects, so it's always at the top of my hierarchy, and hence I have easy access to it. If this does not work, you can also drag-and-drop objects to change their place in the hierarchy.</p></div></li><li><p>Underneath the name, you'll see the <span class="strong"><strong>Tag</strong></span> property. Change it from <span class="strong"><strong>Untagged</strong></span> to <span class="strong"><strong>GameController</strong></span>.</p></li><li><p>Next, with the game controller selected, go to the Inspector tab and then select <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>. Once brought to the next menu, change the language to C#, and set the name of the script to <code class="literal">GameController</code>.</p></li><li><p>Select the newly <a id="id172" class="indexterm"></a>created script, and move it to the <code class="literal">Assets\Scripts</code> folder. Go to <code class="literal">MonoDevelop</code> by double-clicking on the script file.</p></li><li><p>Inside the newly created code, we <a id="id173" class="indexterm"></a>will first need to add two new variables for us to use: <code class="literal">level</code>, which will contain the data needed to create our level and <code class="literal">wall</code>, which will contain the block we want to spawn:</p><div class="informalexample"><pre class="programlisting">private int[][] level = new int[][]
{
  new int[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  new int[]{1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1} 
};
public Transform wall;</pre></div></li></ol></div><p>The <code class="literal">wall</code> variable looks <a id="id174" class="indexterm"></a>similar to things we've created <a id="id175" class="indexterm"></a>before, but the <code class="literal">level</code> variable looks a bit different.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec20"></a>Working with arrays</h3></div></div></div><p>The level variable is an <a id="id176" class="indexterm"></a>array. We could create an integer for each place inside of our level, detailing what type is there; however, this is quite tedious, and we would have to remember each element's identifier. An array is a holder of multiple elements of the same type. To access an individual element of the array, we simply need to specify an index of where it is placed in between square brackets (the <code class="literal">[</code> and <code class="literal">]</code> characters). Arrays are played sequentially in memory, which means it's really easy to move between elements of them, and it's a very fast operation to access an individual element.</p><p>The level variable is actually a multidirectional array, which can be thought of as an array of an array of integers. We will use a multidirectional array, because it allows us to draw with numbers like a grid to place each of the elements in our level.</p><p>That being said, now we actually need to build the level. To do that, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's create a function called <code class="literal">BuildLevel</code>:</p><div class="informalexample"><pre class="programlisting">void BuildLevel() 
{
  // Get the DynamicObjects object that we created already in the 
// scene so we can make it our newly created objects' parent
  GameObject dynamicParent = GameObject.Find ("DynamicObjects");

  //Go through each element inside our level variable
  for (int yPos = 0; yPos &lt; level.Length; yPos++) 
  {
    for (int xPos = 0; xPos &lt; (level[yPos]).Length; xPos++) 
    {
      // Do nothing if the value is 0

      // If the value is 1, we want a wall
      if (level[yPos][xPos] == 1) 
      {
        // Create the wall
        Transform newObject = Instantiate (wall, new Vector3(xPos, (level.Length - yPos), 0), Quaternion.identity) as Transform;

        // Set the object's parent to the DynamicObjects
        // variable so it doesn't clutter our Hierachy
        newObject.parent = dynamicParent.transform;
      }
    }
  }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"></a>Note</h3><p>The <a id="id177" class="indexterm"></a>quaternion class<a id="id178" class="indexterm"></a> is what is used for rotations inside of Unity. In this instance, <code class="literal">Quaternion.identity</code> stands for a matrix on rotation. For more information on<a id="id179" class="indexterm"></a> quaternions, please check out <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Quaternion.html" target="_blank">http://docs.unity3d.com/ScriptReference/Quaternion.html</a>.</p></div><p>As you can see, we access each of the arrays stored in the level by using <code class="literal">array[index]</code>, and for an index inside of that array, we use <code class="literal">array[index1][index2]</code>.</p></li><li><p>Next, we need to actually call this function. Do so in your <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">void Start () 
{
  BuildLevel ();
}</pre></div></li><li><p>Save the script, and exit out to the Unity editor. When you get back, you should see under the <code class="literal">GameController</code> script that is there in the <code class="literal">wall</code> variable, which still needs a value for its variable. In order to assign the prefab we created<a id="id180" class="indexterm"></a> previously, we'll need to go to the folder, and then drag-and-drop it into the box for the variable and then release the mouse. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_03_2.jpg" /></div></li><li><p>After this, click on the <span class="strong"><strong>Start</strong></span> button to see the code execute:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_03_3.jpg" /></div></li></ol></div><p>You may see a bit<a id="id181" class="indexterm"></a> of the result in the <span class="strong"><strong>Game</strong></span> screen that pops up, but if you click on the <span class="strong"><strong>Scene</strong></span> tab, you'll see the level has been built for us!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"></a>Note</h3><p>You can drag-and-drop the <span class="strong"><strong>Scene</strong></span> tab to share space with the <span class="strong"><strong>Game</strong></span> tab if you want, as you can see in the preceding screenshot.</p><p>There are a number of other ways that you can use to modify your layout as well. Some of them are provided and will help your workflow.</p><p>To view them, you can either go to the <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Layouts</strong></span> menu or select the right-most drop-down menu on the toolbar.</p><p>I personally use the <span class="strong"><strong>Default</strong></span> layout for this book, but when I have two monitors, I like to spread things out with the <span class="strong"><strong>Game</strong></span> tab on one monitor and everything else.</p><p>One of our technical editors prefers the 2 by 3 layout with a one-column Project tab (right-click the <span class="strong"><strong>Project</strong></span> tab, and then select <span class="strong"><strong>One Column Layout</strong></span>.</p></div></div></div>