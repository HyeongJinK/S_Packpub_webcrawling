<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec35"></a>Winning the game</h2></div></div><hr /></div><p>Now that we have the <a id="id231" class="indexterm"></a>goals showing, we now need some way in <a id="id232" class="indexterm"></a>order to complete the project. With that in mind, let's create our goal:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new particle system by going into <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>Particle System</strong></span> (in case of Unity 4.6, go to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Particle System</strong></span>). Change the name of the object to <code class="literal">Goal</code>.</p></li><li><p>Under the <span class="strong"><strong>Shape</strong></span> section, change the <span class="strong"><strong>Shape </strong></span>variable to <code class="literal">Box</code>, and change <span class="strong"><strong>Box X</strong></span> to <code class="literal">1</code> and <span class="strong"><strong>Box Y</strong></span> and <span class="strong"><strong>Box Z</strong></span> to <code class="literal">0</code>.</p></li><li><p>Click on the arrow on the right-hand side of <span class="strong"><strong>Start Lifetime</strong></span>, and change the values to <span class="strong"><strong>Random Between Two Constants</strong></span>. Change those values to <code class="literal">0</code> and <code class="literal">1</code>. Do the same with <span class="strong"><strong>Start Speed</strong></span> between <code class="literal">2</code> and <code class="literal">4</code>. Make <span class="strong"><strong>Start Size</strong></span> use random values between <code class="literal">0</code> and <code class="literal">0.5</code>. Change <span class="strong"><strong>Start Color</strong></span> to <span class="strong"><strong>Random Between Two Colors</strong></span> using a green and purple color. Finally, uncheck the <span class="strong"><strong>Play On Awake</strong></span> variable. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_03_16.jpg" /></div><p>With that, you<a id="id233" class="indexterm"></a> should have a nice stream <a id="id234" class="indexterm"></a>of particles coming in for your new goal object!</p></li><li><p>Add in a box collider by selecting <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Box Collider</strong></span>. Toggle the <span class="strong"><strong>Is Trigger</strong></span> option to <code class="literal">true</code>, set <span class="strong"><strong>Center</strong></span> to (<code class="literal">0,</code> <code class="literal">0,</code> <code class="literal">0</code>), and <span class="strong"><strong>Size</strong></span> to (<code class="literal">1,</code> <code class="literal">1,</code> <code class="literal">1</code>).</p></li><li><p>Now that we have completed the goal's object, let's now have it spawn within our <code class="literal">BuildLevel</code> function in <code class="literal">GameController</code>. So, just as we did before, we drag-and-drop the object to our <code class="literal">Prefabs</code> folder and delete the original object. Then, we need to add two new variables for us to use, which are as follows:</p><div class="informalexample"><pre class="programlisting">public Transform goal;
private ParticleSystem goalPS;</pre></div></li><li><p>After we add<a id="id235" class="indexterm"></a> the new variables, add in the<a id="id236" class="indexterm"></a> following in bold to <code class="literal">BuildLevel</code>:</p><div class="informalexample"><pre class="programlisting">void BuildLevel() 
{
  // Get the DynamicObjects object so we can make it our newly
  // created objects' parent
  GameObject dynamicParent = GameObject.Find("DynamicObjects");


  //Go through each element inside our level variable
  for (int yPos = 0; yPos &lt; level.Length; yPos++) 
  {
    for (int xPos = 0; xPos &lt; (level[yPos]).Length; xPos++) 
    {
      Transform toCreate = null;
      switch(level[yPos][xPos])
      {
        case 0:
          //Do nothing because we don't want anything there.
          break;
        case 1:
          toCreate = wall;
          break;
        case 2:
          toCreate = player;
          break;
        case 3:
          toCreate = orb;
          break;
<span class="strong"><strong>        case 4:</strong></span>
<span class="strong"><strong>         toCreate = goal;</strong></span>
<span class="strong"><strong>         break;</strong></span>
        default:
          print("Invalid number: " + (level[yPos][xPos]).ToString());
          break;
        }

        if(toCreate != null)
        {
          Transform newObject = Instantiate(toCreate, new Vector3(xPos, (level.Length - yPos), 0), Quaternion.identity) as Transform;

          if(toCreate == goal)
          {
            goalPS = newObject.gameObject.GetComponent&lt;ParticleSystem&gt;();
          }
          // Set the object's parent to the DynamicObjects
          // variable so it doesn't clutter our Hierachy
          newObject.parent = dynamicParent.transform;

        }
      

    }
  }
}</pre></div></li><li><p>We also need to<a id="id237" class="indexterm"></a> add in a 4 somewhere inside our<a id="id238" class="indexterm"></a> level array, as follows:</p><div class="informalexample"><pre class="programlisting">private int[][] level = new int[][]
{
  new int[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 0, <span class="strong"><strong>4</strong></span>, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
  new int[]{1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 3, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 3, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 0, 2, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1},
  new int[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}
};</pre></div></li><li><p>Next, in <code class="literal">UnityIinspector</code>, go in and assign the <code class="literal">Goal</code> object with your prefab of the game name.</p></li><li><p>With that done, we<a id="id239" class="indexterm"></a> now need to go in and add in the ability to win. Go to the <code class="literal">CollectedOrb</code> function, and start our particle system when we get all of the orbs. Have a<a id="id240" class="indexterm"></a> look at the following code:</p><div class="informalexample"><pre class="programlisting">public void CollectedOrb()
{
  orbsCollected++;
  scoreText.text = "Orbs: " + orbsCollected + "/" + orbsTotal;

<span class="strong"><strong>  if(orbsCollected &gt;= orbsTotal)</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>    goalPS.Play();</strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div></li><li><p>After that, we need to create the script for our goal. Create a new script in our <span class="strong"><strong>Scripts</strong></span> folder, which we will name <code class="literal">GoalBehaviour</code>. Open it in <code class="literal">MonoDevelop</code>, and fill it in with the following:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class GoalBehaviour : MonoBehaviour 
{
  ParticleSystem ps;
  void Start()
  {
    ps = GetComponent&lt;ParticleSystem&gt;();
  }

  void OnTriggerEnter(Collider other) 
  {
    if(ps.isPlaying)
    {
      print("You Win!");
    }
  }
}</pre></div></li><li><p>Save the file, and<a id="id241" class="indexterm"></a> attach it to the <code class="literal">Goal</code> prefab. With<a id="id242" class="indexterm"></a> that all done, save the scene and hit the play button. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_03_17.jpg" /></div></li></ol></div><p>And with that, whenever <a id="id243" class="indexterm"></a>we collect all of the coins we've placed in <a id="id244" class="indexterm"></a>our level, the goal will appear, and then, when we touch it, the <span class="strong"><strong>Console</strong></span> window will tell us that we've won!</p></div>