<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec11"></a>Implementing player movement</h2></div></div><hr /></div><p>Now, at<a id="id20" class="indexterm"></a> this point, we have a great-looking game, but nothing at all happens. Let's change that now using our player. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right-click on the <span class="strong"><strong>Scripts</strong></span> folder you created earlier, click on <span class="strong"><strong>Create</strong></span>, and select the <span class="strong"><strong>C# Script</strong></span> label. Once you click on it, a script will appear in the <span class="strong"><strong>Scripts</strong></span> folder, and it should already have focus and should be asking you to type a name for the scriptâ€”call it <code class="literal">PlayerBehaviour</code>.</p></li><li><p>Double-click on the script in Unity, and it will open <a id="id21" class="indexterm"></a>
<span class="strong"><strong>MonoDevelop</strong></span>, which is an open source integrated development environment (IDE) that is included with your Unity installation.</p></li></ol></div><p>After MonoDevelop has loaded, you will be presented with the C# stub code that was created automatically for you by Unity when you created the C# script.</p><p>Let's break down what's currently there before we replace some of it with new code. At the top, you will see two lines:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"></a>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt Publishing books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com" target="_blank">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support" target="_blank">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div><p>The engine knows that if we refer to a class that isn't located inside this file, then it has to reference the files within these namespaces for the referenced class before giving an error. We are currently using two namespaces.</p><p>The <code class="literal">UnityEngine</code> namespace<a id="id22" class="indexterm"></a> contains interfaces and class definitions that let MonoDevelop know about all the addressable objects inside Unity.</p><p>The <code class="literal">System.Collections</code> namespace<a id="id23" class="indexterm"></a> contains interfaces and classes that define various collections of objects, such as lists, queues, bit arrays, hash tables, and dictionaries.</p><p>We will be using a list, so we will change the line to the following:</p><div class="informalexample"><pre class="programlisting">using System.Collections<span class="strong"><strong>.Generic;</strong></span>
</pre></div><p>The next line you'll see is:</p><div class="informalexample"><pre class="programlisting">public class PlayerBehaviour : MonoBehaviour {</pre></div><p>You can<a id="id24" class="indexterm"></a> think of a class as a kind of blueprint for creating a new component type that can be attached to <code class="literal">GameObjects</code>, the objects inside our scenes that start out with just a <code class="literal">Transform</code> and then have components added to them. When Unity created our C# stub code, it took care of that; we can see the result, as our file is called <code class="literal">PlayerBehaviour</code> and the class is also called <code class="literal">PlayerBehaviour</code>. Make sure that your <code class="literal">.cs</code> file and the name of the class match, as they must be the same to enable the script component to be attached to a game object. Next up is the<code class="literal">: MonoBehaviour</code> section of the code. The <code class="literal">:</code> symbol signifies that we inherit from a particular class; in this case, we'll use <code class="literal">MonoBehaviour</code>. All behavior scripts must inherit from <code class="literal">MonoBehaviour</code> directly or indirectly by being derived from it.</p><p>
<span class="strong"><strong>Inheritance</strong></span> is the idea of having an object to be based on another object or class using the same implementation. With this in mind, all the functions and variables that existed inside the <code class="literal">MonoBehaviour</code> class will also exist in the<a id="id25" class="indexterm"></a> <code class="literal">PlayerBehaviour</code> class, because <code class="literal">PlayerBehaviour</code> is <code class="literal">MonoBehaviour</code>.</p><p>For more information on the <a id="id26" class="indexterm"></a>
<code class="literal">MonoBehaviour</code> class and all the functions<a id="id27" class="indexterm"></a> and properties it has, check out <a class="ulink" href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.html" target="_blank">http://docs.unity3d.com/ScriptReference/MonoBehaviour.html</a>. Directly after this line, we will want to add some variables to help us with the project. Variables are pieces of data that we wish to hold on to for one reason or another, typically because they will change over the course of a program, and we will do different things based on their values.</p><p>Add the following code under the class definition:</p><div class="informalexample"><pre class="programlisting">// Movement modifier applied to directional movement.
public float playerSpeed = 2.0f;

// What the current speed of our player is
private float currentSpeed = 0.0f;

/*
 * Allows us to have multiple inputs and supports keyboard, 
 * joystick, etc.
 */
public List&lt;KeyCode&gt; upButton;
public List&lt;KeyCode&gt; downButton;
public List&lt;KeyCode&gt; leftButton;
public List&lt;KeyCode&gt; rightButton;

// The last movement that we've made
private Vector3 lastMovement = new Vector3();</pre></div><p>Between the<a id="id28" class="indexterm"></a> variable definitions, you will notice comments to explain what each variable is and how we'll use it. To write a comment, you can simply add a <code class="literal">//</code> to the beginning of a line and everything after that is commented upon so that the compiler/interpreter won't see it. If you want to write something that is longer than one line, you can use <code class="literal">/*</code> to start a comment, and everything inside will be commented until you write <code class="literal">*/</code> to close it. It's always a good idea to do this in your own coding endeavors for anything that doesn't make sense at first glance.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note09"></a>Note</h3><p>For those of you working on your own projects in teams, there is an additional form of commenting that Unity supports, which may make your life much nicer: XML comments. They take up more space than the comments we are using, but also document your code for you. For a nice tutorial about that, check out <a class="ulink" href="http://unitypatterns.com/xml-comments/" target="_blank">http://unitypatterns.com/xml-comments/</a>.</p></div><p> In our game, the player may want to move up using either the arrow keys or the <span class="emphasis"><em>W</em></span> key. You may even want to use something else. Rather than restricting the player to just having one button, we will store all the possible ways to go up, down, left, or right in their own container. To do this, we are going to use a list, which is a holder for multiple objects that we can add or remove while the game is being played.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>For more information on lists, check out <a class="ulink" href="http://msdn.microsoft.com/en-us/library/6sh2ey19(v=vs.110).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/6sh2ey19(v=vs.110).aspx</a>
</p></div><p>One of the things you'll notice is the <code class="literal">public</code> and <code class="literal">private</code> keywords before the variable type. These are access modifiers that dictate who can and cannot use these variables. The <code class="literal">public</code> keyword means that any other class can access that property, while <code class="literal">private</code> means that only this class will be able to access this variable. Here, <code class="literal">currentSpeed</code> is private because we want our current speed not to be modified or set anywhere else. But, you'll notice something interesting with the <code class="literal">public</code> variables that we've created. Save your script by pressing <span class="strong"><strong>Ctrl</strong></span> + <span class="strong"><strong>S</strong></span> and then go back into the Unity project and drag-and-drop the <code class="literal">PlayerBehaviour</code> script onto the <code class="literal">playerShip</code> object. Before going back to the Unity project though, make sure that you save your <code class="literal">PlayerBehaviour</code> script. Not saving is a very common mistake made by people working with <code class="literal">MonoDevelop</code>. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_01_11.jpg" /></div><p>You'll notice now that the <code class="literal">public</code> variables that we created are located inside <span class="strong"><strong>Inspector</strong></span> for the component. This means that we can actually set those variables inside <span class="strong"><strong>Inspector</strong></span> without having to<a id="id29" class="indexterm"></a> modify the code, allowing us to tweak values in our code very easily, which is a godsend for many game designers. You may also notice that the names have changed to be more readable. This is because of the naming convention that we are using with each word starting with a capital letter. This convention is called CamelCase (more specifically headlessCamelCase).</p><p>Now change the <span class="strong"><strong>Size</strong></span> of each of the <span class="strong"><strong>Button</strong></span> variables to <code class="literal">2</code>, and fill in the <span class="strong"><strong>Element 0</strong></span> value with the appropriate arrow and <span class="strong"><strong>Element 1</strong></span> with <code class="literal">W</code> for up, <code class="literal">A</code> for left, <code class="literal">S</code> for down, and <code class="literal">D</code> for right. When this is done, it should look something like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_01_12.jpg" /></div><p>Now that we have our variables set, go back to <code class="literal">MonoDevelop</code> for us to work on the script some more.</p><p>The line after <a id="id30" class="indexterm"></a>that is a function definition for a method called <code class="literal">Start</code>; it isn't a user method but one that belongs to <code class="literal">MonoBehaviour</code>. Where variables are data, functions are the things that modify and/or use that data. Functions are self-contained modules of code (enclosed within braces, <code class="literal">{</code> and <code class="literal">}</code>) that accomplish a certain task. The nice thing about using a function is that once a function is written, it can be used over and over again. Functions can be called from inside other functions:</p><div class="informalexample"><pre class="programlisting">void Start () {
    
}</pre></div><p>
<code class="literal">Start</code> is only called once in the lifetime of the behavior when the game starts and is typically used to initialize data.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p>If you're used to other programming languages, you may be surprised that initialization of an object is not done using a constructor function. This is because the construction of objects is handled by the editor and does not take place at the start of gameplay as you might expect. If you attempt to define a constructor for a script component, it will interfere with the normal operation of Unity and can cause major problems with the project.</p></div><p>However, for<a id="id31" class="indexterm"></a> this behavior, we will not need to use the <code class="literal">Start</code> function. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Delete the <code class="literal">Start</code> function and its contents.</p><p>The next function that we see included is the <code class="literal">Update</code> function. Also inherited from <code class="literal">MonoBehaviour</code>, this function is called for every frame that the component exists in and for each object that it's attached to. We want to update our player ship's rotation and movement every turn.</p></li><li><p>Inside the <code class="literal">Update</code> function (between <code class="literal">{</code> and <code class="literal">}</code>), put the following lines of code:</p><div class="informalexample"><pre class="programlisting">// Rotate player to face mouse
Rotation();
// Move the player's body
Movement();</pre></div><p>Here, I called two functions, but these functions do not exist, because we haven't created them yet, which is why the text shows up as Red inside of MonoDevelop. Let's do that now!</p></li><li><p>Below the <code class="literal">Update</code> function and before <code class="literal">}</code> that closes the class at the end of the file, put the following function to close the class:</p><div class="informalexample"><pre class="programlisting">// Will rotate the ship to face the mouse.
void Rotation()
{
  // We need to tell where the mouse is relative to the 
  // player
  Vector3 worldPos = Input.mousePosition;
  worldPos = Camera.main.ScreenToWorldPoint(worldPos);

  /*
   * Get the differences from each axis (stands for 
   * deltaX and deltaY)
   */
  float dx = this.transform.position.x - worldPos.x;
  float dy = this.transform.position.y - worldPos.y;

  // Get the angle between the two objects
  float angle = Mathf.Atan2(dy, dx) * Mathf.Rad2Deg;

  /* 
    * The transform's rotation property uses a Quaternion, 
    * so we need to convert the angle in a Vector 
    * (The Z axis is for rotation for 2D).
  */
  Quaternion rot = Quaternion.Euler(new Vector3(0, 0, angle + 90));

  // Assign the ship's rotation
  this.transform.rotation = rot;
}</pre></div><p>Now if <a id="id32" class="indexterm"></a>you comment out the <code class="literal">Movement</code> line and run the game, you'll notice that the ship will rotate in the direction in which the mouse is. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_01_13.jpg" /></div></li><li><p>Below the <code class="literal">Rotation</code> function, we now need to add in our <code class="literal">Movement</code> function the following code. Uncomment the <code class="literal">Movement</code> function call if you commented it out earlier:</p><div class="informalexample"><pre class="programlisting">// Will move the player based off of keys pressed
void Movement()
{
  // The movement that needs to occur this frame
  Vector3 movement = new Vector3();

  // Check for input
  movement += MoveIfPressed(upButton, Vector3.up);
  movement += MoveIfPressed(downButton, Vector3.down);
  movement += MoveIfPressed(leftButton, Vector3.left);
  movement += MoveIfPressed(rightButton, Vector3.right);

  /* 
    * If we pressed multiple buttons, make sure we're only 
    * moving the same length.
  */
  movement.Normalize ();

  // Check if we pressed anything
  if(movement.magnitude &gt; 0)
  {
    // If we did, move in that direction
    currentSpeed = playerSpeed;
    this.transform.Translate(movement * Time.deltaTime * playerSpeed, Space.World);
    lastMovement = movement;
  }
  else
  {
    // Otherwise, move in the direction we were going
    this.transform.Translate(lastMovement * Time.deltaTime * currentSpeed, Space.World);
    // Slow down over time
    currentSpeed *= .9f;
  }
}</pre></div><p>Now inside this function I've created another function called <code class="literal">MoveIfPressed</code>, so we'll need to add that in as well.</p></li><li><p>Below this<a id="id33" class="indexterm"></a> function, add in the following function as well:</p><div class="informalexample"><pre class="programlisting">/* 
  * Will return the movement if any of the keys are pressed,
  * otherwise it will return (0,0,0)
*/
Vector3 MoveIfPressed( List&lt;KeyCode&gt; keyList, Vector3 Movement)
{
  // Check each key in our list
  foreach (KeyCode element in keyList)
  {
    if(Input.GetKey(element))
    {
      /*
        * It was pressed so we leave the function 
        * with the movement applied.
      */
      return Movement;
    }
  }

  // None of the keys were pressed, so don't need to move
  return Vector3.zero;
}</pre></div></li><li><p>Now, save <a id="id34" class="indexterm"></a>your file and move back into Unity. Save your current scene as <code class="literal">Chapter_1.unity</code> by going to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save Scene</strong></span>. Make sure to save the scene to our <code class="literal">Scenes</code> folder we created earlier.</p></li><li><p>Run the game by pressing the play button. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553655/graphics/3655OT_01_14.jpg" /></div></li></ol></div><p>Now you'll see that we can move using the arrow keys or the <span class="emphasis"><em>W</em></span> <span class="emphasis"><em>A</em></span> <span class="emphasis"><em>S</em></span> <span class="emphasis"><em>D</em></span> keys, and our ship will rotate to face the mouse. Great!</p></div>