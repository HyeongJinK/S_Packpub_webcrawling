<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec18"></a>Layers and Collision Matrix</h2></div></div><hr /></div><p>By default, if multiple game <a id="id142" class="indexterm"></a>objects are on the default layer, they will all<a id="id143" class="indexterm"></a> collide with each other. In that case, we can say everything will collide with everything. In game development, often we need to decide which object will collide with which one. For this, we need to define a layer-specific division of game objects. We put each type of object in different layers. In Collision Matrix, for each new layer, a new column and row are added. Matrix defines the interaction between the layers. By default, a new layer collides with all the other layers. A developer needs to set up the interaction between the layers. Using a correct setup, we can avoid unwanted collision.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec16"></a>An example of a layer-based Collision Matrix</h3></div></div></div><p>Let's take a look at an example <a id="id144" class="indexterm"></a>of setting Collision Matrix for layers:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new scene and name it <code class="literal">Layer Collision</code>.</p></li><li><p>Create a box container game object, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_06.jpg" /></div><p>By default, all <a id="id145" class="indexterm"></a>the objects will appear on the default layer, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_07.jpg" /></div></li><li><p>Add and set up the<a id="id146" class="indexterm"></a> Box layer for floor and wall game objects. As shown in the following screenshot, by clicking on <span class="strong"><strong>Layer</strong></span>, we will see a drop-down list of existing layers. We can add a new layer by clicking on <span class="strong"><strong>Add Layer</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_08.jpg" /></div></li><li><p>As shown in the<a id="id147" class="indexterm"></a> following screenshot, we have created a new layer <span class="strong"><strong>Box</strong></span>. By selecting <span class="strong"><strong>Box</strong></span>, we can specify the layer for all the box game objects.</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_09.jpg" /></div></li><li><p>Inside the box container, add a red ball, green ball, and blue ball.</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_10.jpg" /></div></li><li><p>Similar to step 3, we<a id="id148" class="indexterm"></a> add and set up different layers for the balls. As shown in the following screenshot, we have created layers for the red ball, green ball, and blue ball:</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_11.jpg" /></div></li><li><p>To set up collision rules for game objects, let's open <span class="strong"><strong>Matrix</strong></span>. As shown in the following screenshot, navigate to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> and select <span class="strong"><strong>Physics</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_12.jpg" /></div></li><li><p>As shown in the <a id="id149" class="indexterm"></a>following screenshot, a collision table will be shown in the <span class="strong"><strong>Inspector</strong></span> panel. By default, every object will collide with every another object.</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_13.jpg" /></div></li><li><p>Check and uncheck the checkboxes of matrix to set up rules, as shown in the following screenshot. We have set up Collision Matrix for a green ball, red ball, blue ball, and a box.</p><div class="mediaobject"><img src="/graphics/9781783553693/graphics/3693OT_03_14.jpg" /></div></li></ol></div><p>Using the preceding <a id="id150" class="indexterm"></a>steps, we can set up a layer-based Collision Matrix.</p><p>Create a new JavaScript and attach it to the main camera and run the test.</p><p>Write the following code inside this JavaScript file:</p><div class="informalexample"><pre class="programlisting">  #pragma strict
  function Start () {
  }
  function Update () {
  }


function OnCollisionEnter(Collision collisionInfo)
{
  Debug.Log("Detected collision between " + gameObject.name + " and " + collisionInfo.collider.name);

}

function OnCollisionStay(Collision collisionInfo)
{
  Debug.Log(gameObject.name + " and " + collisionInfo.collider.name + " are still colliding");
}

function OnCollisionExit(Collision collisionInfo)
{
  Debug.Log(gameObject.name + " and " + collisionInfo.collider.name + " are no longer colliding");
}</pre></div><p>Using the preceding script, you can <a id="id151" class="indexterm"></a>check which objects are colliding with one another and for how long.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec17"></a>Collision Matrix and a script</h3></div></div></div><p>Let's see how we can <a id="id152" class="indexterm"></a>ignore collision for specific objects using a script. Often, in interactive development, we need to set up rules for collision between objects. For example, we need to set up a rule where projectiles should not collide with the objects shooting them. Although, using custom layer-based collision on GUI, we can define a layer-based game objects collision rule, we also can handle it using a script. We can use <code class="literal">IgnoreCollision</code> Physics of Unity3D for creating Collision Matrix.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>
<span class="strong"><strong>Limitation of IgnoreCollision</strong></span>
</p><p>Collision Matrix does not store the<a id="id153" class="indexterm"></a> state when saving the scene and we can apply only on active game objects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec22"></a>An example of a script-based Collision Matrix</h4></div></div></div><p>The following is the <a id="id154" class="indexterm"></a>example of a script-based Collision Matrix:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new scene and name it <code class="literal">Script-Collision-Matrix</code>.</p></li><li><p>Create a wall using <span class="strong"><strong>Plane</strong></span>.</p></li><li><p>Create a <span class="strong"><strong>Bullet</strong></span> game object.</p></li><li><p>Create a shooting object. Now, we need to set up a rule that a bullet should not collide with the shooting object.</p></li><li><p>Create a script and attach it to the main camera object. Add the following code to the script:</p><div class="informalexample"><pre class="programlisting">var bulletPrefab : Transform;
function Start () {
    var bullet = Instantiate(bulletPrefab) as Transform;
    Physics.IgnoreCollision(bullet.collider, collider);
}</pre></div></li></ol></div><p>Run and test the script, you <a id="id155" class="indexterm"></a>will see that a bullet is ignoring collision with the shooting object.</p></div></div></div>