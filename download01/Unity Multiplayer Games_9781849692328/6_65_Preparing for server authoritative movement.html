<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec67"></a>Preparing for server authoritative movement</h2></div></div><hr /></div><p>Before we get<a id="id293" class="indexterm"></a> started, we'll need to restructure our scripts. We're going to change the <code class="literal">Update</code> function so that it isn't called automatically, and instead will be called by our networking scripts. We need to do this so that we have direct control over the exact order in which the simulation is stepped, otherwise we can easily end up with desyncs and rubber banding.</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class Player : MonoBehaviour
{
  public float MoveSpeed = 5f;

  [System.NonSerialized]
  public float horizAxis = 0f;
  [System.NonSerialized]
  public float vertAxis = 0f;

<span class="strong"><strong>  void Update()</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>    if( networkView.isMine )</strong></span>
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>      horizAxis = Input.GetAxis( "Horizontal" );</strong></span>
<span class="strong"><strong>      vertAxis = Input.GetAxis( "Vertical" );</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>  }</strong></span>

<span class="strong"><strong>  public void Simulate()</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>    transform.Translate( new Vector3( horizAxis, 0, vertAxis ) * MoveSpeed * Time.fixedDeltaTime );</strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div><p>A few things to take note of: instead of using <code class="literal">Update</code>, we've moved our movement code into a <code class="literal">Simulate</code> function (which later will be called from <code class="literal">FixedUpdate</code>). We've also changed our <code class="literal">Update</code> function to store input in temporary variables. This is for two reasons: we'll be gathering input data on every frame. If we sent input with every instance of <code class="literal">Update</code>, that would make things heavily frame rate dependent—a game that runs at 200 FPS will have 200 frames of input to send to the server, whereas a game that runs at 30 FPS will have 30 frames to send to the server for the exact same time period. However, <code class="literal">FixedUpdate</code> runs a fixed number of times per second—by default, 50. Our client will have 50 frames of input to send to the server regardless of frame rate. Additionally, <code class="literal">FixedUpdate</code> utilizes a fixed delta time which does not vary regardless of frame rate. This reduces the chance of getting hacked—if we used <code class="literal">Update</code>, we would have to send the frame<a id="id294" class="indexterm"></a> delta to the server in order for the server to properly reproduce the same motion, making it possible for clients to teleport by specifying a sufficiently high delta value.</p><p>This is why we store the input values in <code class="literal">Update</code> and act on them in our <code class="literal">Simulate</code> function—the <code class="literal">Input</code> class does not work properly when called directly from <code class="literal">FixedUpdate</code>, and in many cases button presses will be skipped.</p></div>