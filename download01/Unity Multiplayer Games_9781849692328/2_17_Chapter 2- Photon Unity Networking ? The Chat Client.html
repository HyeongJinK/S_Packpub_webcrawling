<div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="ch02"></a>Chapter 2. Photon Unity Networking – The Chat Client</h2></div></div></div><p>In the last chapter, we reviewed the Unity Networking API provided with the Unity game engine. In this chapter, we will review an alternative to Unity Networking, called <span class="strong"><strong>Photon Unity Networking</strong></span> (<span class="strong"><strong>PUN</strong></span>).</p><p>In this chapter, we will cover:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>How PUN works</p></li><li style="list-style-type: disc"><p>The differences and similarities between PUN and Unity Networking</p></li><li style="list-style-type: disc"><p>Setting up PUN with Photon Cloud</p></li><li style="list-style-type: disc"><p>Using PhotonViews</p></li><li style="list-style-type: disc"><p>Connecting to Photon</p></li><li style="list-style-type: disc"><p>Getting a list of rooms</p></li><li style="list-style-type: disc"><p>Creating and joining rooms</p></li><li style="list-style-type: disc"><p>Filtering lobby results by preference</p></li><li style="list-style-type: disc"><p>Automatic matchmaking</p></li><li style="list-style-type: disc"><p>Using FindFriends</p></li><li style="list-style-type: disc"><p>Syncing a level between players</p></li><li style="list-style-type: disc"><p>At the end of the chapter, we will create a chat client built on top of PUN</p></li></ul></div><p>Photon Unity Networking is provided by ExitGames. It aims to provide an API consistent with Unity Networking, while at the same time solving many of the issues with Unity Networking, such as the dreaded NAT punch-through problem (players behind NAT are often unable to host games).</p><p>Photon Unity Networking works with another service known as <span class="strong"><strong>Photon Cloud</strong></span>.
<a id="id75" class="indexterm"></a> Just like Unity Networking, Photon Unity Networking uses UDP for communication, but the key difference is that players don't directly host servers. Instead, clients connect to a server cluster (known as the "cloud") and request a room. A room will be created on one of the servers in the cluster, and clients connect to this room.</p><p>This, in almost all cases, solves the aforementioned NAT issues with Unity, as all the players connect to a public server (with the ideal network configuration) instead of connecting directly to each other. Rather than making players do port-forwarding and other workarounds to get their private, self-hosted server visible to the public, servers are hosted externally and all of the work is done already. Players don't connect to each other anymore, they simply connect to a server which acts as a middleman for communication.</p><p>Additionally, rather than having a "host" (which would normally be the player who hosts the server), Photon Unity Networking defines a "master client". The player to create a room is, by default, the master client. However, if that player leaves, another player will be chosen to be the master client. Contrast this to Unity Networking, where if a host leaves, the game is simply ended or must be migrated, in PUN the game can seamlessly continue.</p></div>