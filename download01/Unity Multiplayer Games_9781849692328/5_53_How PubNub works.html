<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec56"></a>How PubNub works</h2></div></div><hr /></div><p>As mentioned earlier,<a id="id249" class="indexterm"></a> PubNub works over HTTP rather than TCP or UDP sockets. This means, the PubNub service is entirely interacted with via a web service. How does this work?</p><p>There are two URLs which form all interactions with PubNub. One is used for publishing. You request this URL and pass all information such as Publish key, Subscribe key, the channel to publish on, and the message to publish, and so on.</p><p>The other URL is used for subscribing. For the best latency, you make a request to this URL, and as soon as it returns something you make another request, and so on. Unlike most web requests, this URL has an especially long time out, and won't return anything until somebody else publishes a message on that channel. That means you generally only make requests after you receive a message.</p><p>When you request the subscribe URL, you pass a few bits of information just as with publishing, with the addition of a "time token". The first time you request it, you pass a time token of 0. <a id="id250" class="indexterm"></a>This tells PubNub to give you the current time token. Every time you get a response from the subscribed URL, you store the time token and use that for the next request. This ensures that you don't get old messages.</p><p>PubNub's subscribed URL will return JSON, so before we write our wrapper around PubNub we'll need a way to parse JSON.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>
<span class="strong"><strong>JSON</strong></span> (<span class="strong"><strong>JavaScript Object Notation</strong></span>)<a id="id251" class="indexterm"></a> is a format for storing structured data stored as key/value pairs. For instance, a simple JSON object might look like this:</p></div><div class="informalexample"><pre class="programlisting">{"key1":value1, "key2":value2, ... "key n":value n}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>Values can be of several types such as Booleans, integers, floats, and so on. They can also be arrays, or nested objects.</p><p>For more information, check out<a id="id252" class="indexterm"></a> the following resource on the JSON format:</p><p>
<a class="ulink" href="http://www.json.org/" target="_blank">http://www.json.org/</a>
</p></div><p>This method of communication, using a request/response system, can have a big impact on any networking built on top of it. Keep in mind, this request/response system of HTTP is designed for browsers to request web pages from a server, not necessarily for real-time communication. In addition, while HTTP is implemented with TCP, it is not the same thing as TCP. It carries lots of information designed to fetch resources from a web server, rather than sending/receiving general purpose messages. In particular, the browser URL or the POST parameters are the only methods available to the client to pass any data to the server. Additionally, a whole host of other information will be sent as part of the request, such as user agent (what browser is requesting the data), the content type the client expects, language, content length, and more. This could potentially lead to fairly large messages being passed around. In general, while PubNub can be invaluable for some things that don't need to be instant such as lobby room chat, it does not make a good candidate for real-time multiplayers. Additionally, one benefit of using HTTP is that firewalls are generally configured to allow most web traffic throughâ€”there is significantly less danger of the firewall blocking game network traffic (such as on corporate networks).</p></div>