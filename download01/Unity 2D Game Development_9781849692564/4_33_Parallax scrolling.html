<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec36"></a>Parallax scrolling</h2></div></div><hr /></div><p>OK. Breathe. We're about to explain <span class="strong"><strong>parallax scrolling</strong></span>, which is an effect where objects further in the distance move slower than objects closer to the camera. From what I understand, many of you may now need to take a moment to stop hyperventilating. Go for it, I'll wait.</p><p>As a <a id="id133" class="indexterm"></a>developer, we have been asked numerous times about how to implement parallax scrolling in a 2D game. Cerulean Games, my game studio, has even had the elements of parallax scrolling as the "do or die" requirement to close a project deal with a client. In reality, this is incredibly easy to accomplish, and there are a number of ways to do this.</p><p>In <span class="emphasis"><em>Power Rangers Samurai SMASH!</em></span> (developed by Cerulean Games for Curious Brain; you can find it in the iOS App Store), we implemented a simple check that would see what the linear velocity of the player is and then move the background objects in the opposite direction. The sprites were layered on the Z plane, and each was given a speed multiplier based on its distance from the camera. So, as the player moved to the right, all parallax scrolling objects would move to the left based on their multiplier value. That technique worked, and it fared us and our client quite well for the production of the game. This is also a common and quick way to manage parallax scrolling, and it's also pretty much how we're going to manage it in this game as well.</p><p>OK, enough talk! Have at you! Well, have at the code:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script called <code class="literal">ParallaxController</code> and make it look like the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ParallaxController : MonoBehaviour
{
    public GameObject[] clouds;
    public GameObject[] nearHills;
    public GameObject[] farHills;

    public float cloudLayerSpeedModifier;
    public float nearHillLayerSpeedModifier;
    public float farHillLayerSpeedModifier;

    public Camera myCamera;

    private Vector3 lastCamPos;

    void Start()
    {
        lastCamPos = myCamera.transform.position;
    }

    void Update()
    {
        Vector3 currCamPos = myCamera.transform.position;
        float xPosDiff = lastCamPos.x - currCamPos.x;

        adjustParallaxPositionsForArray(clouds, cloudLayerSpeedModifier, xPosDiff);
        adjustParallaxPositionsForArray(nearHills, nearHillLayerSpeedModifier, xPosDiff);
        adjustParallaxPositionsForArray(farHills, farHillLayerSpeedModifier, xPosDiff);

        lastCamPos = myCamera.transform.position;
    }

    void adjustParallaxPositionsForArray(GameObject[] layerArray, float layerSpeedModifier, float xPosDiff)
    {
        for(int i = 0; i &lt; layerArray.Length; i++)
        {
            Vector3 objPos = layerArray[i].transform.position;
            objPos.x += xPosDiff * layerSpeedModifier;
            layerArray[i].transform.position = objPos;
        }
    }
}</pre></div></li><li><p>Create a <a id="id134" class="indexterm"></a>new GameObject in your scene and call it <code class="literal">_ParallaxLayers</code>. This will act as the container for all the parallax layers.</p></li><li><p>Create three more GameObjects and call them <code class="literal">_CloudLayer</code>, <code class="literal">_NearHillsLayer</code>, and <code class="literal">_FarHillsLayer</code>, respectively.</p></li><li><p>Place these three objects inside the <span class="strong"><strong>_ParallaxLayers</strong></span> object, and place the <span class="strong"><strong>Parallax Controller</strong></span> component onto the <span class="strong"><strong>_ParallaxLayers</strong></span> object.</p></li></ol></div><p>Done? Good. Now we can move some sprites. Import the sprites from <code class="literal">Sprites\ParallaxScenery</code>. Start placing sprites in the three layer containers you created earlier. For the hills you want to be closer, place the sprites in the <span class="strong"><strong>_NearHillsLayer</strong></span> container; for the hills you want to be further away, place the sprites in <span class="strong"><strong>_FarHillsLayer</strong></span>; and place the clouds in the <span class="strong"><strong>_CloudLayer</strong></span> container. The following screenshot shows an example of what the layers will now look like in the scene:</p><div class="mediaobject"><img src="/graphics/9781849692564/graphics/2564OT_04_05.jpg" /></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip14"></a>Tip</h3><p>
<span class="strong"><strong>Pro tip</strong></span>
</p><p>Is this the absolute, most efficient way of doing parallax? Somewhat; however, it's a bit hardcoded to only really fit the needs of this game. Challenge yourself to extend it to be flexible and work for any scenario!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec09"></a>Parallax layer ordering</h3></div></div></div><p>Wait, you say that the objects are <a id="id135" class="indexterm"></a>layered in the wrong order? Your hills are all mixed up with your platforms and your platforms are all mixed up with your hills? OK, don't panic, we've got this.</p><p>What you need to do here is change the <span class="strong"><strong>Order in Layer</strong></span> option for each of the parallax sprites. You can find this property in the <span class="strong"><strong>Sprite Renderer</strong></span> component. Click on one of the sprites in your scene, such as one of the clouds, and you can see it in the <span class="strong"><strong>Inspector</strong></span> panel. Here's a screenshot to show you where to look:</p><div class="mediaobject"><img src="/graphics/9781849692564/graphics/2564OT_04_06.jpg" /></div><p>Rather than changing each sprite individually, we can easily adjust the sprites in bulk by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select all of your cloud layer sprites, and under their <span class="strong"><strong>Sprite Renderer</strong></span> components, set their <span class="strong"><strong>Order in Layer</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set the <span class="strong"><strong>Order in Layer</strong></span> property of the <span class="strong"><strong>_NearHillsLayer</strong></span> sprites to <code class="literal">1</code> and that of the <span class="strong"><strong>_FarHillsLayer</strong></span> sprites to <code class="literal">0</code>.</p></li><li><p>Select the Prefab named <span class="strong"><strong>Platform</strong></span> and set its <span class="strong"><strong>Order in Layer</strong></span> to <code class="literal">2</code>; you should see all of your <code class="literal">Platform</code> sprites instantly update in the scene.</p></li><li><p>Set the <span class="strong"><strong>Order in Layer</strong></span> values of the Prefabs for <span class="strong"><strong>Enemy</strong></span> and <span class="strong"><strong>Player Bullet</strong></span> to <code class="literal">2</code>.</p></li><li><p>Set the sprite on the <span class="strong"><strong>Player</strong></span> object in the scene to <code class="literal">2</code> as well.</p></li><li><p>Finally, set the <span class="strong"><strong>Wall</strong></span> objects to <code class="literal">3</code> and you're good to go.</p></li></ol></div><p>With the layers all <a id="id136" class="indexterm"></a>set up, let's finish setting up the parallax layers. First, finish placing any additional parallax sprites; I'll wait. Brilliant! Now, go to the <span class="strong"><strong>_ParallaxLayers</strong></span> object and let's play around with that <span class="strong"><strong>Parallax Controller</strong></span> component. We're going to want to add all of those sprites to <span class="strong"><strong>Parallax Controller</strong></span>. To make this easy, look at the top-right corner of the <span class="strong"><strong>Inspector</strong></span> panel. See the little lock icon? Click on it. Now, regardless of what you do, the <span class="strong"><strong>Parallax Controller</strong></span> component will not be deselected. Since it can't be deselected, you can now easily drag-and-drop all of the <code class="literal">Cloud</code> sprites into the <code class="literal">Clouds</code> array in the ParallaxController component, and all of the <span class="strong"><strong>_FarHillsLayer</strong></span> child objects into the <code class="literal">Far Hills</code> array—you see where this is going.</p><p>Set the <span class="strong"><strong>My Camera</strong></span> field to use the <span class="strong"><strong>Main Camera</strong></span> object. Finally, let's set some values in those <span class="strong"><strong>Layer Speed Modifier</strong></span> fields. The higher the number, the faster the object will move as the camera moves. As an example, we set the <span class="strong"><strong>Cloud</strong></span> layer to <code class="literal">0.05</code>, the <span class="strong"><strong>Near</strong></span> layer to <code class="literal">0.2</code>, and the <span class="strong"><strong>Far</strong></span> layer to <code class="literal">0.1</code>. Feel free though to play with the values and see what you like!</p><p>Go ahead and play the game. Click on the play button and watch those layers move! But, what's this? The particles that burst when an enemy is defeated render behind the sprites in the background—actually, they render behind all the sprites! To fix this, we need to tell Unity to render the particles on a layer in front of the sprites. By default, the sprites render after the particles. Let's change that.</p><p>First, we need to create a new sorting layer. These are special types of layers that tell Unity the order to render things in. Go to the <span class="strong"><strong>Tags &amp; Layers</strong></span> window and look out for the drop-down menu called <span class="strong"><strong>Sorting Layers</strong></span>. Add a new layer called <code class="literal">ParticleLayer</code> on <span class="strong"><strong>Layer 1</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849692564/graphics/2564OT_04_02.jpg" /></div><p>With this in place, it <a id="id137" class="indexterm"></a>means anything with the <span class="strong"><strong>Sorting Layers</strong></span> menu of <span class="strong"><strong>ParticleLayer</strong></span> will render after the <span class="strong"><strong>Default</strong></span> layer. Now, we need a way to assign this <span class="strong"><strong>Sorting Layer</strong></span> to the particle system used when enemies are defeated. Create a new script called <code class="literal">ParticleLayering</code> and make it look like the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ParticleLayering : MonoBehaviour
{
    public string sortLayerString = "";

    void Start ()
    {
        particleSystem.renderer.sortingLayerName = sortLayerString;
    }
}</pre></div><p>Add this script to the <span class="strong"><strong>EnemyDeathFX</strong></span> Prefab and set the <span class="strong"><strong>Sort Layer String</strong></span> field to <code class="literal">ParticleLayer</code>. Go ahead and play the game again now to watch those particles fly in front of the other objects.</p><p>Finally, if you want a solid color background to your scene, you don't need to worry about adding a colored plane or anything. Simply select the <span class="strong"><strong>Main Camera</strong></span> object, and in the <span class="strong"><strong>Inspector</strong></span> panel, look for the <span class="strong"><strong>Background</strong></span> field in the <span class="strong"><strong>Camera</strong></span> component. Adjust the color there as per your need. For the example game, we made this color a nice sky blue with the following values: <code class="literal">R: 128</code>, <code class="literal">G: 197</code>, <code class="literal">B: 232</code>, and <code class="literal">A: 0</code>.</p><p>The one thing you may notice we're missing is something at the bottom of the scene. Here's a nice little challenge for you. We've given you a <span class="strong"><strong>Lava</strong></span> sprite. Now, add in a lava layer of parallax sprites in the foreground using all the info you've read in this chapter. You can do this!</p></div></div>