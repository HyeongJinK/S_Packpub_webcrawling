<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec15"></a>Make 'em run!</h2></div></div><hr /></div><p>Ready for a challenge?</p><p>This is where we take a bunch of the things that were taught through this first part of the book and combine them into a culmination of events. We'll call this: <code class="literal">CHALLENGE 1</code>. If you just heard a thunderclap and electric guitars after reading this, it's perfectly fine—you're not alone.</p><p>When you look at the <a id="id59" class="indexterm"></a>player, you may notice one very major issue. When it runs, its orientation doesn't change. The player stays facing one direction and never plays its run animation.</p><p>This is where we fix that.</p><p>Let's update the state code to change the <span class="strong"><strong>Boolean Walking</strong></span> state of the player's animator component. Open <code class="literal">PlayerStateListener.cs</code> and access the state in <code class="literal">onStateChange(newState)</code>. Let's add the ability to play the run animation. Change the entries for <code class="literal">idle</code>, <code class="literal">left</code>, and <code class="literal">right</code> of the state code to look like the following:</p><div class="informalexample"><pre class="programlisting">case PlayerStateController.playerStates.idle:
playerAnimator.SetBool("Walking", false);
break;

case PlayerStateController.playerStates.left:
playerAnimator.SetBool("Walking", true);
break;

case PlayerStateController.playerStates.right:
playerAnimator.SetBool("Walking", true);
break;</pre></div><p>With that one small change, you can now switch between the run and idle animations. Play the game again, and you will see the player running while moving and idling when not moving!</p><p>OK, this covers half of<a id="id60" class="indexterm"></a> our current problem. Next, we need to solve that little <span class="emphasis"><em>always faces the same direction</em></span> issue. There are quite a number of ways to solve this. The easiest, however, will be to flip the horizontal scale of the player object. Sounds crazy? Think of it this way, if you scale something from 1.0 to -1.0, it's now facing the opposite direction. This works even with us using a one-sided plane because we do not actually flip the plane to its other side—all we are doing is reversing the order in which its vertexes are rendered, causing it to render as if it were mirrored. This couldn't really get much easier, could it?</p><p>Go ahead, give it a try, and trust me, you'll like the results! Open up the same switch statement as the previous one and add some code so it now looks like the following code. Note that we are adding a new <code class="literal">Vector3</code> object at the top to grab and store the <code class="literal">localScale</code> of the object.</p><div class="informalexample"><pre class="programlisting">// Grab the current localScale of the object so we have 
// access to it in the following code
Vector3 localScale = transform.localScale;

switch(newState)
{
case PlayerStateController.playerStates.idle:
animation.Play("idleAnimation");
break;
         
case PlayerStateController.playerStates.left:
// Play the Run Animation when the player is moving <code class="literal">Left animation</code>.Play("runAnimation");
                   
if(localScale.x &gt; 0.0f)
{
localScale.x *= -1.0f;
transform.localScale  = localScale;
}
break;
              
case PlayerStateController.playerStates.right:
// Play the Run Animation when the player is moving Right
animation.Play("runAnimation");

if(localScale.x &lt; 0.0f)
{
localScale.x *= -1.0f;
transform.localScale = localScale;              
}
break;</pre></div><p>It really is as easy as<a id="id61" class="indexterm"></a> that. Now play the game and you'll see the player object facing the correct direction while moving. You now have an animated player capable of moving left and right, updating its orientation and its animations, and doing all of this along a platform!</p></div>