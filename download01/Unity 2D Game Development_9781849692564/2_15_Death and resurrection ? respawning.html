<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec20"></a>Death and resurrection â€“ respawning</h2></div></div><hr /></div><p>With the state system now set up properly, we need to add some logic to the <code class="literal">PlayerStateListener</code> script so that it knows how to handle player death<a id="id81" class="indexterm"></a> and <a id="id82" class="indexterm"></a>respawn. What we want to happen is this: when the player dies, they respawn at a point in the level and the camera snaps back to this point. So, let's <a id="id83" class="indexterm"></a>start by adding another empty <a id="id84" class="indexterm"></a>GameObject. Name this one <code class="literal">Player Respawn Point</code> and set the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> position of it to <code class="literal">X: 0</code>, <code class="literal">Y: 1.5</code>. It should now be hovering above the same place that the player is at in the level.</p><p>This will give the game a way to find a spawn point in the level and allow us to move it around if we need to. Next, let's tell the player's state scripts to use this object. Open the <code class="literal">PlayerStateListener</code> script and add the following code near its beginning, where the properties are defined:</p><div class="informalexample"><pre class="programlisting">public GameObject playerRespawnPoint = null;</pre></div><p>As you may have guessed, we need to place the new respawn point object in the <span class="strong"><strong>Player Respawn Point</strong></span> field in the <span class="strong"><strong>Inspector</strong></span> panel. Go back to the Unity editor and add the <code class="literal">playerRespawnPoint</code> object to this newly created field on the <code class="literal">Player</code> object's <code class="literal">PlayerStateListener</code> component.</p><p>Scroll down a little bit in <code class="literal">PlayerStateListener</code>; let's modify the <code class="literal">resurrect</code> state inside the <code class="literal">onStateChange</code> method. Set the code to look like the following:</p><div class="informalexample"><pre class="programlisting">case PlayerStateController.playerStates.resurrect:
    transform.position = playerRespawnPoint.transform.position;
    transform.rotation = Quaternion.identity;
    rigidbody2D.velocity = Vector2.zero;
break;</pre></div><p>This will now <a id="id85" class="indexterm"></a>cause the player object to move to the appropriate respawn <a id="id86" class="indexterm"></a>point in the scene when the <code class="literal">resurrect</code> state is<a id="id87" class="indexterm"></a> toggled. As the camera is already tracking the <a id="id88" class="indexterm"></a>player based on its states, the <span class="strong"><strong>Main Camera</strong></span> object will automatically keep up. Currently, we don't need much else to happen except for the player to resurrect as soon as they die, so let's temporarily modify the <code class="literal">kill</code> and <code class="literal">resurrect</code> cases in the <code class="literal">onStateCycle</code> method to quickly jump to the next state.</p><div class="informalexample"><pre class="programlisting">case PlayerStateController.playerStates.kill: 
onStateChange(PlayerStateController.playerStates.resurrect);
break;
case PlayerStateController.playerStates.resurrect:
onStateChange(PlayerStateController.playerStates.idle);break;</pre></div><p>Now give that game a play and run off the platform. The player should now die when it hits the death trigger and then respawn wherever the player respawn point exists. Also, the camera should move as well, keeping its existing distance! Run off those platforms all you want; you're going to come back every time. See? We keep our promises.</p></div>