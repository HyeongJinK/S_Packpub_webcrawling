<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec23"></a>Creating a circle around your terrain</h2></div></div><hr /></div><p>Many RTS <a id="id150" class="indexterm"></a>games display distances (range attack, moving <a id="id151" class="indexterm"></a>distance, sight, and so on) by drawing a circle around the selected unit. If the terrain is flat, this can be done simply by stretching a quad with the texture of a circle. If that's not the case, the quad will most likely be clipped behind a hill or another piece of geometry. This recipe will show you how to create a shader that allows you to draw circles around an object of arbitrary complexity. If you want to be able to move or animate your circle, we will need both a shader and C# script. The following image shows an example of drawing a circle in a hilly region using a shader:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_02_13.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec56"></a>Getting ready</h3></div></div></div><p>Despite working with every piece of geometry, this technique is oriented to terrains. Hence, the first step is setting up a terrain in Unity.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's start by creating a new shader called <code class="literal">RadiusShader</code> and the respective material, <code class="literal">Radius</code>.</p></li><li><p>Have the character for your object ready; we will draw a circle around it.</p></li><li><p>From the menu, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Terrain</strong></span> to create a new terrain.</p></li><li><p>Create the <a id="id152" class="indexterm"></a>geometry for your terrain. You can <a id="id153" class="indexterm"></a>either import an existing one or draw your own using the tools available (<span class="strong"><strong>Raise/Lower Terrain</strong></span>, <span class="strong"><strong>Paint Height</strong></span>, <span class="strong"><strong>Smooth Height</strong></span>).</p></li><li><p>Terrains are special objects in Unity, and the way texture mapping works on them is different from traditional 3D models. You cannot provide <code class="literal">_MainTex</code> from a shader as it needs to be provided directly from the terrain itself. To do this, select <span class="strong"><strong>Paint Texture</strong></span> and then click on <span class="strong"><strong>Add Texture…</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_02_14.jpg" /></div></li><li><p>Now that the texture is set, you have to change the material of the terrain so that a custom shader can be provided. From <span class="strong"><strong>Terrain Settings</strong></span>, change the <span class="strong"><strong>Material</strong></span> property to <span class="strong"><strong>Custom</strong></span>, and then drag the <span class="strong"><strong>Radius</strong></span> material to the <span class="strong"><strong>Custom Material</strong></span> box.</p></li></ol></div><p>You are now <a id="id154" class="indexterm"></a>ready to create your shader.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec57"></a>How to do it…</h3></div></div></div><p>Let's start by <a id="id155" class="indexterm"></a>editing the <code class="literal">RadiusShader</code> file:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the new shader, add these four properties:</p><div class="informalexample"><pre class="programlisting">_Center("Center", Vector) = (0,0,0,0)
_Radius("Radius", Float) = 0.5
_RadiusColor("Radius Color", Color) = (1,0,0,1)
_RadiusWidth("Radius Width", Float) = 2</pre></div></li><li><p>Add their respective variables to the <code class="literal">CGPROGRAM</code> section:</p><div class="informalexample"><pre class="programlisting">float3 _Center;
float _Radius;
fixed4 _RadiusColor;
float _RadiusWidth;</pre></div></li><li><p>
<code class="literal">Input</code> to our surface function requires not only the UV of the texture, but also the position (in world coordinates) of every point of the terrain. We can retrieve this parameter by changing the <code class="literal">Input</code> struct as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>struct</strong></span> Input
{
  <span class="strong"><strong>float2</strong></span> uv_MainTex; // The UV of the terrain texture
  <span class="strong"><strong>float3</strong></span> worldPos;   // The in-world position
};</pre></div></li><li><p>Lastly, we use this surface function:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>void</strong></span> surf(Input IN, inout SurfaceOutputStandard o)
{
  float d = distance(_Center, IN.worldPos);
  if (d &gt; _Radius &amp;&amp; d &lt; _Radius + _RadiusWidth)
    o.Albedo = _RadiusColor;
  else
    o.Albedo = tex2D(_MainTex, IN.uv_MainTex).rgb;
}</pre></div></li></ol></div><p>These steps are all it takes to draw a circle on your terrain. You can use the material's <span class="strong"><strong>Inspector</strong></span> tab to change the position, radius, and color of the circle.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec05"></a>Moving the circle</h4></div></div></div><p>If you want the <a id="id156" class="indexterm"></a>circle to follow your character, other steps are necessary:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new C# script called <code class="literal">Radius</code>.</p></li><li><p>Add these properties to the script:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>public Material</strong></span> radiusMaterial;
public float radius = 1;
public Color color = Color.white;</pre></div></li><li><p>In the <code class="literal">Update()</code> method, add these lines of code:</p><div class="informalexample"><pre class="programlisting">radiusMaterial.SetVector(<span class="strong"><strong>"_Center"</strong></span>, transform.position);
radiusMaterial.SetFloat(<span class="strong"><strong>"_Radius"</strong></span>, radius);
radiusMaterial.SetColor(<span class="strong"><strong>"_RadiusColor"</strong></span>, color);</pre></div></li><li><p>Attach the script to your character.</p></li><li><p>Finally, drag the <code class="literal">Radius</code> material to the <span class="strong"><strong>Radius Material</strong></span> slot of the script.</p></li></ol></div><p>You can now move your character around and this will create a nice circle around it. Changing the properties of the <code class="literal">Radius</code> script will change the radius as well.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec58"></a>How it works…</h3></div></div></div><p>The relevant parameters to draw a circle are its center, radius, and color. They are all available in the shader with the names <code class="literal">_Center</code>, <code class="literal">_Radius</code>, and <code class="literal">_RadiusColor</code>. By adding the <code class="literal">worldPos</code> variable to the <code class="literal">Input</code> structure, we are asking Unity to provide us with the position of the pixel that we are drawing expressed in world coordinates. This is the actual position of an object in the editor.</p><p>The <code class="literal">surf()</code> function is where the circle is actually drawn. It calculates the distance from the point being drawn and center of the radius, then it checks whether it is between <code class="literal">_Radius</code> and <code class="literal">_Radius + _RadiusWidth</code>; if this is the case, it uses the chosen color. In the other case, it just samples the texture map like all the other shaders seen so far.</p></div></div>