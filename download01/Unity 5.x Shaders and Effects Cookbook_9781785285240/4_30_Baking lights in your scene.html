<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec34"></a>Baking lights in your scene</h2></div></div><hr /></div><p>Rendering <a id="id238" class="indexterm"></a>lighting is a very expensive process. Even with state-of-the-art GPUs, accurately calculating the <span class="strong"><strong>light transport</strong></span> (which is how light bounces between <a id="id239" class="indexterm"></a>surfaces) can take hours. In order to make this process feasible for games, real-time rendering is essential. Modern engines compromise between realism and efficiency; most of the computation is done beforehand in a process called <span class="strong"><strong>light baking</strong></span>. This <a id="id240" class="indexterm"></a>recipe will explain how light baking works and how you <a id="id241" class="indexterm"></a>can get the most out of it.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec87"></a>Getting ready</h3></div></div></div><p>Light baking requires you to have a scene ready. It should have geometries and, obviously, lights. For this recipe, we will rely on Unity's standard features so there is no need to create additional shaders or materials. For a better control, you might want to access the <span class="strong"><strong>Lighting</strong></span> window. If you don't see it, select <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Lighting</strong></span> from the menu and dock it where it is more convenient for you.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec88"></a>How to do it…</h3></div></div></div><p>Light baking requires some manual configuration. There are three essential, yet independent, steps that you need to take.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec09"></a>Configuring the static geometry</h4></div></div></div><p>These steps <a id="id242" class="indexterm"></a>must be followed for the configuration:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Identify all the <a id="id243" class="indexterm"></a>objects in your scene that do not change position, size, and material. Possible candidates are buildings, walls, terrains, props, trees, and others.</p></li><li><p>Select these objects, and check the <span class="strong"><strong>Static</strong></span> box from the <span class="strong"><strong>Inspector</strong></span> tab, as shown in the following image. If any of the selected objects has children, Unity will ask if you want them to be considered static as well. If they meet the requirements (fixed position, size, and material), select <span class="strong"><strong>Yes, change children</strong></span> in the pop-up box:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_04_08.jpg" /></div></li><li><p>If a <a id="id244" class="indexterm"></a>light qualifies as a static object but illuminates <a id="id245" class="indexterm"></a>non-static geometry, make sure that its <span class="strong"><strong>Baking</strong></span> <a id="id246" class="indexterm"></a>property is set to <span class="strong"><strong>Mixed</strong></span>. If it will affect only static objects, set it to <span class="strong"><strong>Baked</strong></span>.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec10"></a>Configuring the light probes</h4></div></div></div><p>There are <a id="id247" class="indexterm"></a>objects in your game that will move, such as the main <a id="id248" class="indexterm"></a>character, enemies, and the other <span class="strong"><strong>non-playable characters</strong></span> (<span class="strong"><strong>NPCs</strong></span>). If they enter a static region that is illuminated, you might want to surround it with light probes. To do this, follow the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the menu, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Light Probe Group</strong></span>. A new object called <a id="id249" class="indexterm"></a>
<span class="strong"><strong>Light Probe Group</strong></span> will appear in <span class="strong"><strong>Hierarchy</strong></span>.</p></li><li><p>Once selected, four interconnected spheres will appear. Click and move them around the scene so that they enclose the static region in which your characters can enter. The following picture shows an example of how light probes can be used to enclose the volume of a static office space:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_04_09.jpg" /></div></li><li><p>Select the <a id="id250" class="indexterm"></a>moving objects that will enter the light probe region.</p></li><li><p>From their <a id="id251" class="indexterm"></a>
<span class="strong"><strong>Inspector</strong></span>, expand their <span class="strong"><strong>renderer component</strong></span> (usually <span class="strong"><strong>Mesh Renderer</strong></span>) and make sure that <span class="strong"><strong>Use Light Probes</strong></span> is checked (see the <a id="id252" class="indexterm"></a>following image):</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_04_10.jpg" /></div></li></ol></div><p>Deciding where and when to <a id="id253" class="indexterm"></a>use light probes is a critical problem; more <a id="id254" class="indexterm"></a>information about this can be found in the <span class="emphasis"><em>How it works…</em></span>section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec11"></a>Baking the lights</h4></div></div></div><p>To bake the <a id="id255" class="indexterm"></a>lights, follow the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To finally bake the lights, open the <span class="strong"><strong>Lighting</strong></span> window and select its <span class="strong"><strong>Lightmaps</strong></span> tab.</p></li><li><p>If the <span class="strong"><strong>Auto</strong></span> checkbox is enabled, Unity will automatically execute the baking process in the background. If not, click on <span class="strong"><strong>Build</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note21"></a>Note</h3><p>Light baking can take several hours even for a relatively small scene. If you are constantly moving static objects or lights, Unity will restart the process from scratch causing a severe slowdown in the editor. You can uncheck the <span class="strong"><strong>Auto</strong></span> checkbox from the <span class="strong"><strong>Lighting</strong></span> | <span class="strong"><strong>Lightmaps</strong></span> tab to prevent this so that you can decide when to start the process manually.</p></div></li></ol></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec89"></a>How it works…</h3></div></div></div><p>The most complicated part of the rendering is the light transport. During this phase, the GPU calculates how the rays of light bounce between objects. If an object and its lights don't move, this calculation can be done only once as it will never change during the game. Flagging an object as <span class="strong"><strong>Static</strong></span> is how you are telling Unity that such an optimization can be made.</p><p>Loosely speaking, light baking refers to the process of calculating the global illumination of a static object and <a id="id256" class="indexterm"></a>saving it in what is called a <span class="strong"><strong>lightmap</strong></span>. Once baking is completed, lightmaps can be seen in the <span class="strong"><strong>Lightmaps</strong></span> tab of the <span class="strong"><strong>Lighting</strong></span> window:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_04_11.jpg" /></div><p>Light baking comes at a great expense: memory. Every static surface is, in fact, retextured so that it already includes its lighting condition. Let's imagine that you have a forest of trees, all sharing the same texture. Once they are made static, each tree will have its very own texture. Light baking not only increases the size of your game, but can take a lot of texture memory if used indiscriminately.</p><p>The second aspect <a id="id257" class="indexterm"></a>introduced in this recipe is <span class="strong"><strong>light probing</strong></span>. Light baking produces extremely <a id="id258" class="indexterm"></a>high-quality results for static geometries but does not work on moving objects. If your character is entering in a static region, it can look somehow <span class="emphasis"><em>detached</em></span> from the environment. Its shading will not match the surrounding, resulting in an aesthetically unpleasant result. Other objects, such as <span class="strong"><strong>skinned mesh renderers</strong></span>, will not <a id="id259" class="indexterm"></a>receive global illumination even if made static. Baking lights in real time is not possible, although light probes offer an effective alternative. Every light probe samples the global illumination at a specific point in space. A light probe group can sample several points in space, allowing to interpolate global illumination within a specific volume. This allows us to cast a better light on moving objects, even despite the fact that global illumination has been calculated only for a few points. It is important to remember that light probes need to enclose a volume in order to work. It is best to place light probes in regions where there is a sudden change in the light condition. Similar to lightmaps, probes consume memory and should be placed wisely; remember that they exist only for non-static geometry.</p><p>Even while using light <a id="id260" class="indexterm"></a>probes, there are a few aspects that Unity's global illumination cannot capture. Non-static objects, for instance, cannot reflect light on other objects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec90"></a>See also</h3></div></div></div><p>You can read <a id="id261" class="indexterm"></a>more about light probes at <a class="ulink" href="http://docs.unity3d.com/Manual/LightProbes.html" target="_blank">http://docs.unity3d.com/Manual/LightProbes.html</a>.</p></div></div>