<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec10"></a>Creating a basic Standard Shader</h2></div></div><hr /></div><p>Every Unity <a id="id1" class="indexterm"></a>game developer should be familiar with the concept of <a id="id2" class="indexterm"></a>
<span class="strong"><strong>components</strong></span>. All the objects that are part of a game contain a number of components that affect their look and behavior. While <span class="strong"><strong>scripts</strong></span> determine how <a id="id3" class="indexterm"></a>objects should behave, <span class="strong"><strong>renderers</strong></span> decide how they should appear on the screen. Unity <a id="id4" class="indexterm"></a>comes with several renderers, depending on the type of object that we are trying to visualise; every 3D model typically has <code class="literal">MeshRenderer</code>. An object should have only one renderer, but the renderer itself can contain several <span class="strong"><strong>materials</strong></span>. Each <a id="id5" class="indexterm"></a>material is a wrapper for a single shader, the final ring in the food chain of 3D graphics. The relationships between these components <a id="id6" class="indexterm"></a>can be seen in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_01_01.jpg" /></div><p>Understanding the difference between these components is essential to understand how shaders work.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec12"></a>Getting ready</h3></div></div></div><p>To get started with this recipe, you will need to have Unity 5 running and must have created a new project. There will also be a Unity project included with this cookbook, so you can use that one as well and simply add your own custom shaders to it as you step through each recipe. With this completed, you are now ready to step into the wonderful world of real-time shading!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec13"></a>How to do it…</h3></div></div></div><p>Before getting into <a id="id7" class="indexterm"></a>our first shader, let's create a small scene for us to work with. This can be done by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span> in the Unity editor. From here, you can create a plane to act as a ground, a couple of spheres to which we will apply our shader, and a directional light to give the scene some light. With our scene generated, we can move on to the shader writing steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> tab in your Unity editor, right-click on the <span class="strong"><strong>Assets</strong></span> folder and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Folder</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note02"></a>Note</h3><p>If you are using the Unity project that came with the cookbook, you can skip to step 4.</p></div></li><li><p>Rename the folder that you created to <code class="literal">Shaders</code> by right-clicking on it and selecting <span class="strong"><strong>Rename</strong></span> from the drop-down list or selecting the folder and hitting <span class="emphasis"><em>F2</em></span> on the keyboard.</p></li><li><p>Create another folder and rename it to <code class="literal">Materials</code>.</p></li><li><p>Right-click on the <code class="literal">Shaders</code> folder and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Shader</strong></span>. Then right-click on the <code class="literal">Materials</code> folder and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Material</strong></span>.</p></li><li><p>Rename both the shader and material to <code class="literal">StandardDiffuse</code>.</p></li><li><p>Launch the <code class="literal">StandardDiffuse</code> <a id="id8" class="indexterm"></a>shader in <span class="strong"><strong>MonoDevelop</strong></span> (the default script editor for Unity) by double-clicking on it. This will automatically launch the editor for you and display the shader code.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note03"></a>Note</h3><p>You will see that Unity has already populated our shader with some basic code. This, by default, will get you a basic Diffuse shader that accepts one texture. We will be modifying this base code so that you can learn how to quickly start developing your own custom shaders.</p></div></li><li><p>Now let's give our shader a custom folder from which it's selected. The very first line of code in the shader is the custom description that we have to give the shader so that Unity can make it available in the shader drop-down list when assigning to materials. We have renamed our path to <code class="literal">Shader "CookbookShaders/StandardDiffuse"</code>, but you can name it to whatever you want and rename it at any time. So don't worry about any dependencies at this point. Save the shader in MonoDevelop and return to the Unity editor. Unity will <a id="id9" class="indexterm"></a>automatically compile the shader when it recognizes that the file has been updated. This is what your shader should look like at this point:</p><div class="informalexample"><pre class="programlisting">Shader "CookbookShaders/StandardDiffuse" {
  <span class="strong"><strong>Properties</strong></span> {
    _Color ("Color", Color) = (1,1,1,1)
    _MainTex ("Albedo (RGB)", 2D) = "white" {}
    _Glossiness ("Smoothness", Range(0,1)) = 0.5
    _Metallic ("Metallic", Range(0,1)) = 0.0
  }
  SubShader {
    <span class="strong"><strong>Tags</strong></span> { "RenderType"="Opaque" }
    LOD 200
    
    CGPROGRAM
    // Physically based Standard lighting model, and enable shadows on all light types
    #pragma surface surf Standard fullforwardshadows

    // Use shader model 3.0 target, to get nicer looking lighting
    #pragma target 3.0

    sampler2D _MainTex;

    <span class="strong"><strong>struct</strong></span> Input {
      float2 uv_MainTex;
    };

    half _Glossiness;
    half _Metallic;
    fixed4 _Color;

    <span class="strong"><strong>void</strong></span> surf (Input IN, inout SurfaceOutputStandard o) {
      // Albedo comes from a texture tinted by color
      fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color;
      o.Albedo = c.rgb;
      // Metallic and smoothness come from slider variables
      o.Metallic = _Metallic;
      o.Smoothness = _Glossiness;
      o.Alpha = c.a;
    }
<span class="strong"><strong>    ENDCG</strong></span>
  } 
  FallBack "Diffuse"
}</pre></div></li><li><p>Technically speaking, this is a <span class="strong"><strong>Surface Shader</strong></span> based on <span class="strong"><strong>physically-based rendering</strong></span>, which <a id="id10" class="indexterm"></a>Unity 5 has adopted as its new standard. As the <a id="id11" class="indexterm"></a>name suggests, this type of shader achieves realism by simulating how light physically behaves when hitting objects. If you are using a previous version of Unity (such as Unity 4), your code will look very different. Prior to the introduction of physically-based shaders, Unity 4 used less sophisticated techniques. All these different types of shader will be further explored in the next chapters of this book.</p></li><li><p>After your shader is created, we need to connect it to a material. Select the material called <a id="id12" class="indexterm"></a>
<code class="literal">StandardDiffuse</code> that we created <a id="id13" class="indexterm"></a>in step 4 and look at the <span class="strong"><strong>Inspector</strong></span> tab. From the <span class="strong"><strong>Shader</strong></span> drop-down list, select <span class="strong"><strong>CookbookShaders</strong></span> | <span class="strong"><strong>StandardDiffuse</strong></span>. (Your shader path might be different if you chose to use a different path name.) This will assign your shader to your material and make it ready for you to assign to an object.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note04"></a>Note</h3><p>To assign a material to an object, you can simply click and drag your material from the <span class="strong"><strong>Project</strong></span> tab to the object in your scene. You can also drag a material on to the <span class="strong"><strong>Inspector</strong></span> tab of an object in the Unity editor to assign a material.</p></div></li></ol></div><p>The screenshot of an example is as follows:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_01_02.jpg" /></div><p>Not much to look at at this point, but our shader development environment is set up and we can now start to modify the shader to suit our needs.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec14"></a>How it works…</h3></div></div></div><p>Unity has made the <a id="id14" class="indexterm"></a>task of getting your shader environment up and running, which is very easy for you. It is simply a matter of a few clicks and you are good to go. There are a lot of elements working in the background with regard to the Surface Shader itself. Unity has taken the Cg shader language and made it more efficient to write by doing a lot of the heavy Cg code lifting for you. The Surface Shader language is a more component-based way of writing shaders. Tasks such as processing your own texture coordinates and transformation matrices have already been done for you, so you don't have to start from scratch any more. In the past, we would have to start a new shader and rewrite a lot of code over and over again. As you gain more experience with Surface Shaders, you will naturally want to explore more of the underlying functions of the Cg language and how Unity is processing all of the low-level <span class="strong"><strong>graphics </strong></span>
<a id="id15" class="indexterm"></a>
<span class="strong"><strong>processing unit</strong></span> (<span class="strong"><strong>GPU</strong></span>) tasks for you.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note05"></a>Note</h3><p>All the files in a Unity project are referenced independently from the folder that they are in. We can move shaders and materials from within the editor without the risk of breaking any connection. Files, however, should never be moved from outside the editor as Unity will not be able to update their references.</p></div><p>So, by simply changing the shader's path name to a name of our choice, we have got our basic Diffuse shader working in the Unity environment, with lights and shadows and all that by just changing one line of code!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec15"></a>See also</h3></div></div></div><p>The source code of the built-in shaders is typically hidden in Unity 5. You cannot open this from the editor like you do with your own shaders.</p><p>For more information on where to find a large portion of the built-in Cg functions for Unity, go to your Unity install directory and navigate to <code class="literal">Unity45\Editor\Data\CGIncludes</code>. In this folder, you can find the source code of the shaders shipped with <a id="id16" class="indexterm"></a>Unity. Over time, they have changed a lot; <span class="strong"><strong>UNITY DOWNLOAD ARCHIVE</strong></span> (<a class="ulink" href="https://unity3d.com/get-unity/download/archive" target="_blank">https://unity3d.com/get-unity/download/archive</a>) is the place to go if you need to access the source codes of a shader used in a <a id="id17" class="indexterm"></a>different version of Unity. After choosing the right version, select <span class="strong"><strong>Built in shaders</strong></span> from the drop-down list, as shown in the following image. There are three files that are of note at this point—<code class="literal">UnityCG.cginc</code>, <code class="literal">Lighting.cginc</code>, and <code class="literal">UnityShaderVariables.cginc</code>. Our current shader is making use of all these files at the moment:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_01_03.jpg" /></div><p>
<a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>Advanced Shading Techniques</em></span>, will explore in-depth how to use GcInclude for a modular approach to shader coding.</p></div></div>