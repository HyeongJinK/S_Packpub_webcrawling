<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec59"></a>Using CgInclude files that are built into Unity</h2></div></div><hr /></div><p>Our first step <a id="id473" class="indexterm"></a>in writing our own CgInclude files is to understand what Unity is already providing us with for shaders. By writing Surface Shaders, there is a lot happening under the hood, which makes the process of writing Surface Shaders so efficient. We can see this code in the included CgInclude files found in your Unity install folder at <code class="literal">Editor</code> | <code class="literal">Data</code> | <code class="literal">CGIncludes</code>. All the files contained within this folder do their part to render our objects with our shaders to the screen. Some of these files take care of shadows and lighting, some take care of helper functions, and some manage platform dependencies. Without them, our shader writing experience would be much more laborious.</p><p>You can find a list of <a id="id474" class="indexterm"></a>information that Unity has provided us with at the following link: <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/SL-BuiltinIncludes.html" target="_blank">http://docs.unity3d.com/Documentation/Components/SL-BuiltinIncludes.html</a>
</p><p>Let's begin the process of understanding these built-in CgInclude files, using some of the built-in helper functions from the <code class="literal">UnityCG.cginc</code> file.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec159"></a>Getting ready</h3></div></div></div><p>Before we start <a id="id475" class="indexterm"></a>diving into the meat of writing the shader, we need to get a few items set up in our scene. Let's create the following and then open the shader in MonoDevelop:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new scene and fill it with a simple sphere model.</p></li><li><p>Create a new shader and material.</p></li><li><p>Attach the new shader to the new material and assign the material to the sphere.</p></li><li><p>Then, let's create a directional light and position it above our sphere.</p></li><li><p>Finally, we are going to want to open the <code class="literal">UnityCG.cginc</code> file from Unity's <code class="literal">CgInclude</code> folder located in Unity's install directory. This will let us analyze some of the helper function's code so that we can understand better what is happening when we use them.</p></li><li><p>You should have a simple scene set up to work on the shader. Refer to the following screenshot as an example:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_10_07.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec160"></a>How to do it…</h3></div></div></div><p>With the scene prepared, we can now begin the process of experimenting with some of the built-in helper functions included with the <code class="literal">UnityCG.cginc</code> file. Double-click on the shader that was <a id="id476" class="indexterm"></a>created for this scene in order to open it in MonoDevelop and insert the code given in the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add the following code to the <code class="literal">Properties</code> block of the new shader file. We will need a single texture and slide for our example shader:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Properties</strong></span>
{
    _MainTex ("Base (RGB)", 2D) = "white" {}
    _DesatValue ("Desaturate", Range(0,1)) = 0.5
}</pre></div></li><li><p>We then need to make sure that we create the data connection between our <code class="literal">Properties</code> and <code class="literal">CGPROGRAM</code> blocks, with the following code placed after the <code class="literal">CGPROGRAM</code> declaration and <code class="literal">#pragma</code> directives:</p><div class="informalexample"><pre class="programlisting">sampler2D _MainTex;
fixed _DesatValue;</pre></div></li><li><p>Finally, we just have to update our <code class="literal">surf()</code> function to include the following code. We introduce a new function that we haven't seen yet, which is built into Unity's <code class="literal">UnityCG.cginc</code> file:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>void</strong></span> surf (Input IN, inout SurfaceOutput o)
{
    half4 c = tex2D (_MainTex, IV.uv_MainTex);
    c.rgb = lerp(c.rgb, Luminance(r.rgb), _DesatValue);

    o.Albedo = c.rgb;
    o.Alpha = c.a;
}</pre></div></li></ol></div><p>With the shader code modified, you should see something similar to the following screenshot. We have simply used a helper function, built into Unity's CgInclude file, to give us an effect of desaturating the main texture of our shader:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_10_08.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec161"></a>How it works…</h3></div></div></div><p>Using the built-in helper function named <code class="literal">Luminance()</code>, we are able to quickly get a desaturation or grayscale effect on our shaders. This is all possible because the <code class="literal">UnityCG.cginc</code> file is brought automatically to our shader as we are using a Surface shader.</p><p>If you search <a id="id477" class="indexterm"></a>through the <code class="literal">UnityCG.cginc</code> file, opened in MonoDevelop, you will find the implementation of this function at line 276. The following snippet is taken from the file:</p><div class="informalexample"><pre class="programlisting">inline fixed Luminance (fixed3 c)
{
    return dot(c, fixed3(0.22, 0.707, 0.071));
}</pre></div><p>As this function is included in the file and Unity automatically compiles with this file, we can use the function in our code as well, thereby reducing the amount of code that we have to write over and over again.</p><p>If you notice there is also a <code class="literal">Lighting.cginc</code> file that Unity comes with. This file houses all the lighting <a id="id478" class="indexterm"></a>models that we use when we declare something like <code class="literal">#pragma Surface surf Lambert</code>. Sifting through this file reveals that all the built-in lighting models are defined here for reuse and modularity.</p></div></div>