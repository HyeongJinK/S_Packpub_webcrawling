<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec53"></a>Using basic Photoshop-like Blend modes with screen effects</h2></div></div><hr /></div><p>The screen effects <a id="id430" class="indexterm"></a>aren't just limited to adjusting the colors of a rendered image from our game. We can also use them to combine other images with our Render Texture. This technique is no different than creating a new layer in Photoshop and choosing a blend mode to blend two images together or, in our case, a texture with a Render Texture. This becomes a very powerful technique as it gives the artists in a production environment a way to simulate their blending modes in the game rather than just in Photoshop.</p><p>For this particular recipe, we are going to take a look at some of the more common blend modes, such as <span class="strong"><strong>Multiply</strong></span>, <span class="strong"><strong>Add</strong></span>, and <span class="strong"><strong>Overlay</strong></span>. You will see how simple it is to have the power of Photoshop Blend modes in your game.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec144"></a>Getting ready</h3></div></div></div><p>To begin, we have to get our assets ready. So let's follow the next few steps to get our screen effects system up and running for our new Blend mode screen effect:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script and call it <code class="literal">BlendMode_ImageEffect</code>.</p></li><li><p>Create a new shader called <code class="literal">BlendMode_Effect</code>.</p></li><li><p>Now we simply need to copy the code we had from the C# script in the first recipe of this chapter to our new C# script. This will allow us to focus on just the mathematics for the brightness, saturation, and contrast effect.</p></li><li><p>Copy the code from the shader in the first recipe in this chapter to our new shader.</p></li><li><p>Finally, we will need another texture to perform our blend mode effect. In this recipe, we will use a grunge type texture. This will make the effect very obvious when we are testing it out.</p></li></ol></div><p>The following image is the grunge map used in the making of this effect. Finding a texture with enough detail and a nice range of grayscale values will make for a nice texture to test our new effect:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_24.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec145"></a>How to do it…</h3></div></div></div><p>Our first <a id="id431" class="indexterm"></a>blend mode that we will implement is the <span class="strong"><strong>Multiply</strong></span> blend mode as seen in Photoshop. Let's begin by modifying the code in our shader first.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Launch the shader in <span class="strong"><strong>MonoDevelop</strong></span> by double-clicking on it in Unity's project view.</p></li><li><p>We need to add some new properties so that we have a texture to blend with and a slider for an opacity value. Enter the following code in your new shader:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_25.jpg" /></div></li><li><p>Enter the corresponding variables in our <code class="literal">CGPROGRAM</code> so that we can access the data from our <code class="literal">Properties</code> block:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_26.jpg" /></div></li><li><p>Finally, we <a id="id432" class="indexterm"></a>modify our <code class="literal">frag()</code> function so that it performs the multiply operation on our two textures:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_27.jpg" /></div></li><li><p>Save the shader and return to the Unity editor to let the new shader code compile and check for errors. If no errors occurred, then double-click on the C# script file to launch it in the MonoDevelop editor.</p></li><li><p>In our script file as well, we need to create the corresponding variables. So we will need a texture so that we can assign one to the shader and a slider to adjust the final amount of the blend mode we want to use:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_28.jpg" /></div></li><li><p>We then <a id="id433" class="indexterm"></a>need to send our variable data to the shader through the <code class="literal">OnRenderImage()</code> function:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_29.jpg" /></div></li><li><p>To complete the script, we simply fill in our <code class="literal">Update()</code> function so that we can clamp the value of the <code class="literal">blendOpacity</code> variable between a value of <code class="literal">0.0</code> and <code class="literal">1.0</code>:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_30.jpg" /></div></li></ol></div><p>With this complete, we assign the screen effect script to our main camera and our screen effect shader to our script so that it has a shader to use for the per-pixel operations. Finally, in order for the effect to be fully functional, the script and shader is looking for a texture. You can assign any texture to the texture field in the <span class="strong"><strong>Inspector</strong></span> for the screen effect script. Once this texture is in place, you will see the effect of multiplying this texture over <a id="id434" class="indexterm"></a>the game's rendered image. The following image demonstrates the screen effect:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_31.jpg" /></div><p>The following image demonstrates a higher intensity of opacity, making the multiplied image much more apparent over our render image:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_32.jpg" /></div><p>With our first blend mode set up, we can begin to add a couple of simpler blend modes to get a better understanding of how easy it is to add more effects and really fine-tune the final result in your game. However, first let's break down what is happening here.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec146"></a>How it works…</h3></div></div></div><p>Now we are starting to gain a ton of power and flexibility in our Screen Effects programming. I am sure that you are now starting to understand how much one can do with this simple system in Unity. We can literally replicate the effects of Photoshop layer blending modes in our game to give artists the flexibility they need to achieve high-quality graphics in a short amount of time.</p><p>With this <a id="id435" class="indexterm"></a>particular recipe, we looked at how to multiply two images together, add two images together, and perform a screen blending mode, using just a little bit of mathematics. When working with blend modes, one has to think on a per-pixel level. For instance, when we are using a multiply blend mode, we literally take each pixel from the original render texture and multiply them with each pixel of the blend texture. The same goes for the add blend mode. It is just a simple mathematical operation of adding each pixel from the source texture, or render texture, to the blend texture.</p><p>The screen blend mode is definitely a bit more involved, but it is actually doing the same thing. It takes each image, render texture, and blend texture, inverts them, then multiplies them together, and inverts them again to achieve the final look. Just like Photoshop blends its textures together using blend modes, we can do the same with screen effects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec147"></a>There's more…</h3></div></div></div><p>Let's continue this recipe by adding a couple of more blend modes to our screen effect.</p><p>In the screen effect shader, let's add the following code to our <code class="literal">frag()</code> function and change the value we are returning to our script. We will also need to comment out the multiply blend so that we don't return that as well:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_33.jpg" /></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Save <a id="id436" class="indexterm"></a>the shader file in MonoDevelop and return to the Unity editor to let the shader compile. If no errors occurred, you should see a result similar to the following image. This is a simple add blending mode:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_34.jpg" /></div><p>As you can see, this has the opposite effect of multiply because we are adding the two images together.</p></li><li><p>Finally, let's add one more blend mode called a Screen Blend. This one is a little bit <a id="id437" class="indexterm"></a>more involved, from a mathematical standpoint, but still simple to implement. Enter the following code in the <code class="literal">frag()</code> function of our shader:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_35.jpg" /></div></li></ol></div><p>The following image demonstrates the results of using a Screen type blend mode to blend two images together in a screen effect:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_36.jpg" /></div></div></div>