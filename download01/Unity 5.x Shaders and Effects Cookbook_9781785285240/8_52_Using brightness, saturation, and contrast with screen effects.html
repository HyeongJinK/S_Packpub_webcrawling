<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec52"></a>Using brightness, saturation, and contrast with screen effects</h2></div></div><hr /></div><p>Now that <a id="id409" class="indexterm"></a>we have our screen effects system up and running, we <a id="id410" class="indexterm"></a>can explore how to create more involved pixel operations to perform some of the more common Screen Effects found in games today.</p><p>To begin, using <a id="id411" class="indexterm"></a>a screen effect to adjust the overall final colors of your game is crucial in giving artists a global control over the final look of the game. Techniques such as color adjustment sliders to adjust the intensity for the reds, blues, and greens of the final rendered game or techniques like putting a certain tone of color over the whole screen as seen in something like a sepia film effect.</p><p>For this particular recipe, we are going to cover some of the more core color adjustment operations we can perform on an image. These are brightness, saturation, and contrast. Learning how to code these color adjustments gives us a nice base to learn the art of screen effects.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec141"></a>Getting ready</h3></div></div></div><p>We will need to create a couple of new assets. We can utilize the same scene as our test scene, but we will need a new script and shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script and call it <code class="literal">BSC_ImageEffect</code>.</p></li><li><p>Create a new shader called <code class="literal">BSC_Effect</code>.</p></li><li><p>Now we simply need to copy the code we had from the C# script in the previous recipe to our new C# script. This will allow us to focus just on the mathematics for the brightness, saturation, and contrast effect.</p></li><li><p>Copy the code from the shader in the previous recipe to our new shader.</p></li><li><p>Create a couple of new objects in the scene, set up some different colored diffuse materials, and randomly assign them to the new objects in the scene. This will give us a good range of colors to test with our new screen effect.</p></li></ol></div><p>When completed, you should have a scene similar to the following image:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_14.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec142"></a>How to do it…</h3></div></div></div><p>Now that we have completed our scene setup and created our new script and shader, we can begin to fill <a id="id412" class="indexterm"></a>in the code necessary to achieve the brightness, saturation, and contrast Screen Effect. We will be focusing on just the pixel operation and <a id="id413" class="indexterm"></a>variable setup for our script and shader, as getting a Screen <a id="id414" class="indexterm"></a>Effect system up and running is described in the <span class="emphasis"><em>Setting up the screen effects script system</em></span> recipe:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's begin by launching our new shader and script in MonoDevelop. Simply double-click on the two files in the project view to perform this action.</p></li><li><p>Editing the shader first makes more sense so that we know what kind of variables we will need for our C# script. Let's begin this by entering the appropriate properties for our brightness, saturation, and contrast effect. Remember, we need to keep the <code class="literal">_MainTex</code> property in our shader as this is the property that the RenderTexture targets when creating Screen Effects:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_15.jpg" /></div></li><li><p>As usual, in <a id="id415" class="indexterm"></a>order for us to access the data coming in <a id="id416" class="indexterm"></a>from our properties in our <code class="literal">CGPROGRAM</code>, we <a id="id417" class="indexterm"></a>need to create the corresponding variables in the <code class="literal">CGPROGRAM</code>:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_16.jpg" /></div></li><li><p>Now we need to create the operations that will perform the brightness, saturation, and contrast effects. Enter the following new function in our shader, just above the <code class="literal">frag()</code> function. Don't worry if it doesn't make sense just yet; all the code will be explained in the next recipe:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_17.jpg" /></div></li><li><p>Finally, we <a id="id418" class="indexterm"></a>just need to update our <code class="literal">frag()</code> function to <a id="id419" class="indexterm"></a>actually use the <code class="literal">ContrastSaturationBrightness() </code>function. This will process all the pixels of our <a id="id420" class="indexterm"></a>Render Texture and pass it back to our script:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_18.jpg" /></div></li></ol></div><p>With the code entered in the shader, return to the Unity editor to let the new shader compile. If there are no errors, we can return to MonoDevelop to work on our script. Let's begin this by creating a couple of new lines of code that will send the proper data to our shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Our first step in modifying our script is to add the proper variables that will drive the <a id="id421" class="indexterm"></a>values of our Screen Effect. In this case, we <a id="id422" class="indexterm"></a>will need a slider for brightness, a <a id="id423" class="indexterm"></a>slider for saturation, and a slider for contrast:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_19.jpg" /></div></li><li><p>With our variables set up, we now need to tell the script to pass their data to the shader. We do this in the <code class="literal">OnRenderImage()</code> function:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_20.jpg" /></div></li><li><p>Finally, all we need to do is clamp the values of the variables within a range that is reasonable. These clamp values are entirely preferential, so you can use whichever values you see fit:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_21.jpg" /></div></li></ol></div><p>With the script <a id="id424" class="indexterm"></a>completed and shader finished, we simply assign our <a id="id425" class="indexterm"></a>script to our main camera and our shader to the script, and <a id="id426" class="indexterm"></a>you should see the effects of brightness, saturation, and contrast by manipulating the slider values. The following image shows a result you can achieve with this screen effect:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_22.jpg" /></div><p>The following image shows another example of what can be done by adjusting the colors of the render image:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/5084_10_23.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec143"></a>How it works…</h3></div></div></div><p>Since we now know how the basic Screen Effects system works, let's just cover the per-pixel operations we created in the <code class="literal">ContrastSaturationBrightness()</code> function.</p><p>The function starts by taking a few arguments. The first and most important is the current render texture. The <a id="id427" class="indexterm"></a>other arguments simply adjust the overall effect of the <a id="id428" class="indexterm"></a>screen effect and are represented by sliders in the screen <a id="id429" class="indexterm"></a>effects' <span class="strong"><strong>Inspector</strong></span> tab. Once the function receives the render texture and the adjustment values, it declares a few constant values that we use to modify and compare against the original render texture.</p><p>The <code class="literal">luminanceCoeff</code> variable stores the values that will give us the overall brightness of the current image. These coefficients are based on the CIE color matching functions and are pretty standard throughout the industry. We can find the overall brightness of the image by getting the dot product of the current image dotted with these luminance coefficients. Once we have the brightness, we simply use a couple of <code class="literal">lerp</code> functions to blend from the grayscale version of the brightness operation and the original image multiplied by the brightness value, being passed into the function.</p><p>The screen effects, like this one, are crucial to achieve high-quality graphics for your games as it lets you tweak the final look of your game without having to edit each material in your current game scene.</p></div></div>