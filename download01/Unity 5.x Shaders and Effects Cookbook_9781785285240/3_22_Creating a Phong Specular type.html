<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec27"></a>Creating a Phong Specular type</h2></div></div><hr /></div><p>The specularity of an <a id="id177" class="indexterm"></a>object surface simply describes how shiny it is. These types of effects are often referred to as view-dependent effects in the shader world. This is because in order to achieve a realistic Specular effect in your shaders, you need to include the direction that the camera or user is facing the object's surface. The most basic and performance-friendly Specular type is the <span class="strong"><strong>Phong Specular</strong></span> effect. It is the calculation of the light direction reflecting off of the surface compared to the user's view direction. It is a very common Specular model used in many applications, from games to movies. While it isn't the most realistic in terms of accurately modeling the reflected Specular, it gives a great approximation that performs well in most situations. Additionally, if your object is further away from the camera and there is no need for a very accurate Specular, this is a great way to provide a Specular effect to your shaders.</p><p>In this recipe, we will be covering how to implement the per-vertex version of the shader and also the per-pixel version using some new parameters in the Surface Shader's <code class="literal">Input</code> struct. We will see the difference and discuss when and why to use these two different implementations for different situations.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec66"></a>Getting ready</h3></div></div></div><p>To start with this recipe, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new shader, material, and object, and give them appropriate names so that you can find them later.</p></li><li><p>Attach the shader to the material and the material to the object. To finish off your new scene, create a new directional light so that we can see our Specular effect as we code it.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec67"></a>How to do it…</h3></div></div></div><p>Follow the following <a id="id178" class="indexterm"></a>steps to create a Phong lighting model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>You might be seeing a pattern at this point, but we always like to start out with our most basic part of the shader writing process: the creation of properties. So, let's add the following properties to the shader:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Properties</strong></span>
{
  _MainTint ("Diffuse Tint", Color) = (1,1,1,1)
  _MainTex ("Base (RGB)", 2D) = "white" {}
  _SpecularColor ("Specular Color", Color) = (1,1,1,1)
  _SpecPower ("Specular Power", Range(0,30)) = 1
}</pre></div></li><li><p>We then have to make sure to add the corresponding variables to our <code class="literal">CGPROGRAM</code> block in our <code class="literal">SubShader{}</code> block:</p><div class="informalexample"><pre class="programlisting">float4 _SpecularColor;
sampler2D _MainTex;
float4 _MainTint;
float _SpecPower;</pre></div></li><li><p>Now we have to add our custom lighting model so that we can compute our own Phong Specular. Don't worry if it doesn't make sense at this point; we will cover each line of code in the <span class="emphasis"><em>How it works…</em></span> section. Add the following code to the shader's <code class="literal">SubShader{}</code> function:</p><div class="informalexample"><pre class="programlisting">fixed4 LightingPhong (SurfaceOutput s, fixed3 lightDir, half3 viewDir, fixed atten)
{
  // Reflection
  float NdotL = dot(s.Normal, lightDir);
  float3 reflectionVector = normalize(2.0 * s.Normal * NdotL - lightDir);

  // Specular
  float spec = pow(max(0, dot(reflectionVector, viewDir)), _SpecPower);
  float3 finalSpec = _SpecularColor.rgb * spec;

  // Final effect
  fixed4 c;
  c.rgb = (s.Albedo * _LightColor0.rgb * max(0,NdotL) * atten) + (_LightColor0.rgb * finalSpec);
  c.a = s.Alpha;
  return c;
}</pre></div></li><li><p>Finally, we have to tell the <code class="literal">CGPROGRAM</code> block that it needs to use our custom lighting function <a id="id179" class="indexterm"></a>instead of one of the built-in ones. We do this by changing the <code class="literal">#pragma</code> statement to the following:</p><div class="informalexample"><pre class="programlisting">CPROGRAM
<span class="strong"><strong>#pragma</strong></span> surface surf Phong</pre></div></li></ol></div><p>The following screenshot demonstrates the result of our custom Phong lighting model using our own custom reflection vector:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_07.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec68"></a>How it works…</h3></div></div></div><p>Let's break down the lighting function by itself, as the rest of the shader should be pretty familiar to you at this point.</p><p>In the previous recipes, we <a id="id180" class="indexterm"></a>have used a lighting function that provided only the light direction, <code class="literal">lightDir</code>. Unity comes with a set of lighting functions that you can use, including one that provides the view direction, <code class="literal">viewDir</code>. Refer to the <a id="id181" class="indexterm"></a>following table or go to <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/SL-SurfaceShaderLighting.html" target="_blank">http://docs.unity3d.com/Documentation/Components/SL-SurfaceShaderLighting.html</a>:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /></colgroup><tbody><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Not view-dependent</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">half4 Lighting Name You choose (SurfaceOutput s, half3 lightDir, half atten);</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>View-dependent</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">half4 Lighting Name You choose (SurfaceOutput s, half3 lightDir, half3 viewDir, half atten);</code>
</p>
</td></tr></tbody></table></div><p>In our case, we are doing a Specular shader, so we need to have the view-dependent lighting function structure. So, we have to write the following:</p><div class="informalexample"><pre class="programlisting">CPROGRAM
<span class="strong"><strong>#pragma</strong></span> surface surf Pong
fixed4 LightingPhong (SurfaceOutput s, fixed3 lightDir, half3 viewDir, fixed atten)
{
  // ...
}</pre></div><p>This will tell the shader that we want to create our own view-dependent shader. Always make sure that your lighting function name is the same in your lighting function declaration and the <code class="literal">#pragma</code> statement, or Unity will not be able to find your lighting model.</p><p>The components that play a role in the Phong model are described in the following image. We have the light <a id="id182" class="indexterm"></a>direction <span class="strong"><strong>L</strong></span> (coupled with its perfect reflection <span class="strong"><strong>R</strong></span>) and normal direction <span class="strong"><strong>N</strong></span>. They have all been encountered before in the Lambertian model, with the exception of <span class="strong"><strong>V</strong></span>, which is the <span class="emphasis"><em>view direction</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_08.jpg" /></div><p>The Phong model assumes that the final light intensity of a reflective surface is given by two components: its diffuse color and Specular value, as follows:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_18.jpg" /></div><p>The diffuse component <span class="emphasis"><em>D</em></span> remains unchanged from the Lambertian model:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_19.jpg" /></div><p>The Specular component <span class="emphasis"><em>S</em></span> is defined as follows:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_20.jpg" /></div><p>Here, <span class="emphasis"><em>p</em></span> is the Specular <a id="id183" class="indexterm"></a>power defined as <code class="literal">_SpecPower</code> in the shader. The only unknown parameter is <span class="emphasis"><em>R</em></span>, which is the reflection of <span class="emphasis"><em>L</em></span> according to <span class="emphasis"><em>N</em></span>. In vector algebra, this can be calculated as follows:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_21.jpg" /></div><p>This is exactly what is calculated in the following:</p><div class="informalexample"><pre class="programlisting">float3 reflectionVector = normalize(2.0 * s.Normal * NdotL - lightDir);</pre></div><p>This has the effect of bending the normal towards the light; as a vertex normal is pointing away from the light, it is forced to look at the light. Refer to the following screenshot for a more visual representation. The script that produces this debug effect is included in the book's support page at <a class="ulink" href="https://www.packtpub.com/books/content/support" target="_blank">https://www.packtpub.com/books/content/support</a>:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_09.jpg" /></div><p>The following <a id="id184" class="indexterm"></a>screenshot displays the final result of our Phong Specular calculation isolated in the shader:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_10.jpg" /></div></div></div>