<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec28"></a>Creating a BlinnPhong Specular type</h2></div></div><hr /></div><p>
<span class="strong"><strong>Blinn</strong></span> is another <a id="id185" class="indexterm"></a>more efficient way of calculating and <a id="id186" class="indexterm"></a>estimating specularity. It is done by getting the half vector from the view direction and light direction. It was brought into the world of Cg by Jim Blinn. He found that it was much more efficient to just get the half vector instead of calculating our own reflection vectors. It cut down on the code and processing time. If you actually look at the built-in BlinnPhong lighting model included in the <code class="literal">UnityCG.cginc</code> file, you will notice that it is using the half vector as well, hence it is named <span class="strong"><strong>BlinnPhong</strong></span>. It is just a simpler version of the full Phong calculation.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec69"></a>Getting ready</h3></div></div></div><p>To start with this recipe, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>This time, instead of creating a whole new scene, let's just use the objects and scene that we have, and create a new shader and material and name them <code class="literal">BlinnPhong</code>.</p></li><li><p>Once you have a new shader, double-click on it to launch MonoDevelop so that we can start editing our shader.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec70"></a>How to do it…</h3></div></div></div><p>Perform the following steps to create a BlinnPhong lighting model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, we need to add our own properties to the <code class="literal">Properties</code> block so that we can control the look of the Specular highlight:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>Properties</strong></span>
{
  _MainTint ("Diffuse Tint", Color) = (1,1,1,1)
  _MainTex ("Base (RGB)", 2D) = "white" {}
  _SpecularColor ("Specular Color", Color) = (1,1,1,1)
  _SpecPower ("Specular Power", Range(0.1,60)) = 3
}</pre></div></li><li><p>Then, we need to make sure that we have created the corresponding variables in our <code class="literal">CGPROGRAM</code> block so that we can access the data from our <code class="literal">Properties</code> block, in our subshader:</p><div class="informalexample"><pre class="programlisting">sampler2D _MainTex;
float4 _MainTint;
float4 _SpecularColor;
float _SpecPower;</pre></div></li><li><p>Now it's time to create our custom lighting model that will process our Diffuse and Specular calculations. The code is as follows:</p><div class="informalexample"><pre class="programlisting">fixed4 LightingCustomBlinnPhong (SurfaceOutput s, fixed3 lightDir, half3 viewDir, fixed atten)
{
  float NdotL = max(0,dot(s.Normal, lightDir));

  float3 halfVector = normalize(lightDir + viewDir);
  float NdotH = max(0, dot(s.Normal, halfVector));
  float spec = pow(NdotH, _SpecPower) * _SpecularColor;

  float4 c;
  c.rgb = (s.Albedo * _LightColor0.rgb * NdotL) + (_LightColor0.rgb * _SpecularColor.rgb * spec) * atten;
  c.a = s.Alpha;
  return c;
}</pre></div></li><li><p>To complete <a id="id187" class="indexterm"></a>our shader, we will need to tell our <code class="literal">CGPROGRAM</code> block to use our custom lighting model rather than a built-in one by modifying the <code class="literal">#pragma</code> statement with the following code:</p><div class="informalexample"><pre class="programlisting">CPROGRAM
<span class="strong"><strong>#pragma</strong></span> surface surf CustomBlinnPhong</pre></div></li></ol></div><p>The following screenshot demonstrates the results of our BlinnPhong lighting model:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_11.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec71"></a>How it works…</h3></div></div></div><p>The <a id="id188" class="indexterm"></a>BlinnPhong Specular is almost exactly like the Phong Specular, except that it is more efficient because it uses less code to achieve almost the same effect. Before the introduction of physically-based rendering, this approach was the default choice for Specular reflection in Unity 4.</p><p>Calculating the reflection vector <span class="strong"><strong>R</strong></span> is generally expensive. The BlinnPhong Specular replaces it with the half vector <span class="strong"><strong>H</strong></span> between the view direction <span class="strong"><strong>V</strong></span> and light direction <span class="strong"><strong>L</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_12.jpg" /></div><p>Instead of calculating our own reflection vector, we are simply going to get the vector halfway between the view direction and light direction, basically simulating the reflection vector. It has <a id="id189" class="indexterm"></a>actually been found that this approach is more physically accurate than the last approach, but we thought it necessary to show you all the possibilities:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_22.jpg" /></div><p>According to vector algebra, the half vector can be calculated as follows:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_23.jpg" /></div><p>Here, <span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_24.jpg" /></span> is the length of the vector <span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_25.jpg" /></span>. In Cg, we simply need to add the view direction and light direction together and then normalize the result to a unity vector:</p><div class="informalexample"><pre class="programlisting">float3 halfVector = normalize(lightDir + viewDir);</pre></div><p>Then, we simply need to dot the vertex normal with this new half vector to get our main Specular value. After this, we just take it to a power of <code class="literal">_SpecPower</code> and multiply it by the Specular color variable. It's much lighter on the code and math, but still gives us a nice Specular highlight that will work for a lot of real-time situations.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec72"></a>See also</h3></div></div></div><p>The light models <a id="id190" class="indexterm"></a>seen in this chapter are extremely simple; no real material is perfectly matte or perfectly specular. Moreover, it is not uncommon for complex materials such as clothing, wood, and skin to require knowledge of how light scatters in the layers beneath the surface.</p><p>Use the following table to recap the different lighting models encountered so far:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /><col align="left" /><col align="left" /></colgroup><thead><tr><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Technique</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Type</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Unity 5 shader</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Light Intensity (I)</p>
</th></tr></thead><tbody><tr><td style="" align="left" valign="top">
<p>Lambertian</p>
</td><td style="" align="left" valign="top">
<p>Diffuse</p>
</td><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Legacy Shaders</strong></span> | <span class="strong"><strong>Diffuse</strong></span>
</p>
</td><td style="" align="left" valign="top">
<span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_26.jpg" /></span>
</td></tr><tr><td style="" align="left" valign="top">
<p>Phong</p>
</td><td style="" align="left" valign="top">
<p>Specular</p>
</td><td style="" align="left" valign="top"> </td><td style="" align="left" valign="top">
<span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_27.jpg" /></span>
<span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_28.jpg" /></span>
</td></tr><tr><td style="" align="left" valign="top">
<p>BlinnPhong</p>
</td><td style="" align="left" valign="top">
<p>Specular</p>
</td><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Legacy Shaders</strong></span> | <span class="strong"><strong>Specular</strong></span>
</p>
</td><td style="" align="left" valign="top">
<span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_29.jpg" /></span>
<span class="inlinemediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_03_30.jpg" /></span>
</td></tr></tbody></table></div><p>There are other <a id="id191" class="indexterm"></a>interesting models such as the Oren-Nayar lighting model for rough surfaces: <a class="ulink" href="https://en.wikipedia.org/wiki/Oren%E2%80%93Nayar_reflectance_model" target="_blank">https://en.wikipedia.org/wiki/Oren%E2%80%93Nayar_reflectance_model</a>
</p></div></div>