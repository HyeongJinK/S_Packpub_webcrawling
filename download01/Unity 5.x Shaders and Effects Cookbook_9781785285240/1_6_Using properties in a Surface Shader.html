<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec13"></a>Using properties in a Surface Shader</h2></div></div><hr /></div><p>Now that <a id="id48" class="indexterm"></a>we have created some properties, let's actually hook <a id="id49" class="indexterm"></a>them up to the shader so that we can use them as tweaks to our shader and make the material process much more interactive.</p><p>We can use the properties' values from the material's <span class="strong"><strong>Inspector</strong></span> tab because we have attached a variable name to the property itself, but in the shader code, you have to set up a couple of things before you can start calling the value by its variable name.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec24"></a>How to do it…</h3></div></div></div><p>The following steps show you how to use the properties in a Surface Shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, let's remove the following lines of code, as we deleted the property called <code class="literal">_MainTex</code> in the <span class="emphasis"><em>Creating a basic Standard Shader </em></span>recipe of this chapter:</p><div class="informalexample"><pre class="programlisting">_MainTex ("Albedo (RGB)", 2D) = "white" {}
sampler2D _MainTex;
fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color;</pre></div></li><li><p>Next, add the following lines of code to the shader, below the <code class="literal">CGPROGRAM</code> line:</p><div class="informalexample"><pre class="programlisting">float4 _AmbientColor;
float _MySliderValue;</pre></div></li><li><p>With step 2 complete, we can now use the values from the properties in our shader. Let's do this by adding the value from the <code class="literal">_Color</code> property to the <code class="literal">_AmbientColor</code> property and giving the result of this to the <code class="literal">o.Albedo</code> line of code. So, let's add the following code to the shader in the <code class="literal">surf()</code> function:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>void</strong></span> surf (Input IN, inout SurfaceOutputStandard o) {
  fixed4 c = pow((_Color + _AmbientColor), _MySliderValue);
  o.Albedo = c.rgb;
  o.Metallic = _Metallic;
  o.Smoothness = _Glossiness;
  o.Alpha = c.a;
}</pre></div></li><li><p>Finally, your <a id="id50" class="indexterm"></a>shader should look like the <a id="id51" class="indexterm"></a>following shader code. If you save your shader in MonoDevelop and re-enter Unity, your shader will compile. If there were no errors, you will now have the ability to change the ambient and emissive colors of the material as well as increase the saturation of the final color using the slider value. Pretty neat, huh!</p><div class="informalexample"><pre class="programlisting">Shader "CookbookShaders/StandardDiffuse3" {
  // We define Properties in the properties block
  <span class="strong"><strong>Properties</strong></span> {
    _Color ("Color", Color) = (1,1,1,1)
    _AmbientColor("Ambient Color", Color) = (1,1,1,1)
    _MySliderValue("This is a Slider", Range(0,10)) = 2.5
  }
  SubShader {
    <span class="strong"><strong>Tags</strong></span> { "RenderType"="Opaque" }
    LOD 200
    
    // We need to declare the properties variable type inside of the
    // CGPROGRAM so we can access its value from the properties block.
    CGPROGRAM
    #pragma surface surf Standard fullforwardshadows
    #pragma target 3.0

    <span class="strong"><strong>struct</strong></span> Input {
      float2 uv_MainTex;
    };


    fixed4 _Color;
    float4 _AmbientColor;
    float _MySliderValue;

    <span class="strong"><strong>void</strong></span> surf (Input IN, inout SurfaceOutputStandard o) {
      // We can then use the properties values in our shader 
      fixed4 c = pow((_Color + _AmbientColor), _MySliderValue);
      o.Albedo = c.rgb;
      o.Alpha = c.a;
    }
<span class="strong"><strong>    ENDCG</strong></span>
  } 
  FallBack "Diffuse"
}</pre></div></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"></a>Tip</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com" target="_blank">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support" target="_blank">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>The <code class="literal">pow(arg1, arg2)</code> function is a built-in function that will perform the equivalent math function of power. So, argument 1 is the value that we want to raise to a power and argument 2 is the power that we want to raise it to.</p><p>To find out more about the <code class="literal">pow()</code> function, look at the Cg tutorial. It is a great free resource that you can use to learn more about shading and get a glossary of all the functions <a id="id52" class="indexterm"></a>available to you in the Cg shading language:</p><p>
<a class="ulink" href="http://http.developer.nvidia.com/CgTutorial/cg_tutorial_appendix_e.html" target="_blank">http://http.developer.nvidia.com/CgTutorial/cg_tutorial_appendix_e.html</a>
</p></div><p>The following <a id="id53" class="indexterm"></a>screenshot demonstrates the result obtained <a id="id54" class="indexterm"></a>using our properties to control our material's colors and saturation from within the material's <span class="strong"><strong>Inspector</strong></span> tab:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_01_07.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec25"></a>How it works…</h3></div></div></div><p>When you declare a new property in the <code class="literal">Properties</code> block, you are providing a way for the shader to retrieve the tweaked value from the material's <span class="strong"><strong>Inspector</strong></span> tab. This value is stored in the variable name portion of the property. In this case, <code class="literal">_AmbientColor</code>, <code class="literal">_Color</code>, and <code class="literal">_MySliderValue</code> are the variables in which we are storing the tweaked values. In <a id="id55" class="indexterm"></a>order for you to be able to use the value in the <a id="id56" class="indexterm"></a>
<code class="literal">SubShader{}</code> block, you need to create three new variables with the same names as the property's variable name. This automatically sets up a link between these two so that they know they have to work with the same data. Additionally, it declares the type of data that we want to store in our subshader variables, which will come in handy when we look at optimizing shaders in a later chapter.</p><p>Once you have created the subshader variables, you can then use the values in the <code class="literal">surf()</code> function. In this case, we want to add the <code class="literal">_Color</code> and <code class="literal">_AmbientColor</code> variables together and take it to a power of whatever the <code class="literal">_MySliderValue</code> variable is equal to in the material's <span class="strong"><strong>Inspector</strong></span> tab.</p><p>The vast majority of shaders start out as Standard Shaders and get modified until they match the desired look. We have now created the foundation for any Surface Shader you will create that requires a diffuse component.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p>Materials are <span class="strong"><strong>assets</strong></span>. This <a id="id57" class="indexterm"></a>means that any change made to them while your game is running in the editor are permanent. If you have changed the value of a property by mistake, you can undo it using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Z</em></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec26"></a>There's more…</h3></div></div></div><p>Like any other programming language, Cg does not allow mistakes. As such, your shader will not work if <a id="id58" class="indexterm"></a>you have a typo in your code. When this <a id="id59" class="indexterm"></a>happens, your materials are rendered in unshaded magenta:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_01_08.jpg" /></div><p>When a script does not compile, Unity prevents your game from being exported or even executed. Conversely, errors in shaders do not stop your game from being executed.</p><p>If one of your shaders appears as magenta, it is time to investigate where the problem is. If you select the incriminated shader, you will see a list of errors displayed in its <span class="strong"><strong>Inspector</strong></span> tab:</p><div class="mediaobject"><img src="/graphics/9781785285240/graphics/Image_4850_01_09.jpg" /></div><p>Despite showing the line that raised the error, it rarely means that this is the line that has to be fixed. The error message shown in the previous image is generated by deleting the <code class="literal">sampler2D _MainTex</code> variable from the <code class="literal">SubShader{}</code> block. However, the error is raised by the first line that tries to access such a variable.</p><p>Finding and fixing what's wrong <a id="id60" class="indexterm"></a>with code is a process called <span class="strong"><strong>debugging</strong></span>. The most <a id="id61" class="indexterm"></a>common mistakes that you should check for are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A <a id="id62" class="indexterm"></a>missing bracket. If you forgot to add a curly bracket to close a section, the compiler is likely to raise errors at the end of the document, at the beginning, or a new section.</p></li><li style="list-style-type: disc"><p>A missing semicolon. One of the most common mistakes but luckily one of the easiest to spot and fix. Errors are often raised by the following line.</p></li><li style="list-style-type: disc"><p>A property that has been defined in the <code class="literal">Properties</code> section but has not been coupled with a variable in the <code class="literal">SubShader{}</code> block.</p></li><li style="list-style-type: disc"><p>Conversely to what you might be used to in C# scripts, floating point values in Cg do not need to the followed by an <code class="literal">f</code>: it's <code class="literal">1.0</code>, not <code class="literal">1.0f</code>.</p></li></ul></div><p>The error messages raised by shaders can be very misleading, especially due to their strict syntactic constraints. If you are in doubt about their meaning, it's best to search the Internet. Unity forums are filled with other developers who are likely to have encountered (and fixed) your problem before.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec27"></a>See also</h3></div></div></div><p>More information <a id="id63" class="indexterm"></a>on how to master Surface Shaders and their <a id="id64" class="indexterm"></a>properties can be found in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Surface Shaders and Texture Mapping</em></span>. If you are curious to see what shaders can actually do when used at their full potential, have a look at <a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>Advanced Shading Techniques</em></span>, for some of the most advanced techniques covered in this book.</p></div></div>