<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec79"></a>Animator</h2></div></div><hr /></div><p>Another important topic in this book is how to animate Jake. Certain animations will be played on the character for specific events. You probably noticed Jake's face is sad during the game. Unity has a really clever system already built-in for controlling animation: <span class="strong"><strong>Mecanim</strong></span>. If you haven't <a id="id306" class="indexterm"></a>heard about it yet, I encourage you to dive into Unity's documentation. Anyway, we <a id="id307" class="indexterm"></a>won't go into too much detail about animating stuff in Unity. All I want you to know is that I have prepared the following animation clips for you:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Run</strong></span>: This is played when the player is grounded and alive</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Jump</strong></span>: This is played during the jump</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Hit</strong></span>: This is played when the player hits the obstacle and dies</p></li></ul></div><p>To preview how animation clips are connected, open the <span class="strong"><strong>Animator</strong></span> view by going to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span> and selecting the <span class="strong"><strong>Player</strong></span> game object from the hierarchy:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_09_15.jpg" /></div><p>This is an <span class="strong"><strong>Animator</strong></span> view. As we want to focus on programming in this book, we won't discuss the details here. All I want you to notice is the <span class="strong"><strong>Parameters</strong></span> tab and two <code class="literal">bool</code> type parameters we have already set up. To control animations on Jake, we just need to make sure <code class="literal">IsGrounded</code> and <code class="literal">isAlive</code> bools are set to the correct values. We will do that from our <code class="literal">PlayerController</code> script.</p><p>The first step is to access the <span class="strong"><strong>Animator</strong></span> component in the code. We already learned about the <code class="literal">GetComponent</code> method of Unity. This time, I want to talk about another way to gain easy access to certain components. Add the following line to your code just after the line that declares the <code class="literal">rigidBody</code> variable:</p><div class="informalexample"><pre class="programlisting">public Animator animator;</pre></div><p>Save the script, select the <span class="strong"><strong>Player</strong></span> game object, and look at the <span class="strong"><strong>Inspector</strong></span> panel. We just created a new public member of the <span class="strong"><strong>Animator</strong></span> type and called it <code class="literal">animator</code>. The <span class="strong"><strong>Animator</strong></span> field will appear in the <span class="strong"><strong>Inspector</strong></span> window. The next step is to assign this variable. Have a look at the hierarchy. There is a child object of the <span class="strong"><strong>Player</strong></span> game object called <code class="literal">sprite</code> we have the <span class="strong"><strong>Animator</strong></span> component on. Simply drag the <code class="literal">sprite</code> game object from the hierarchy on top of the <a id="id308" class="indexterm"></a>
<span class="strong"><strong>None (Animator)</strong></span> field. Unity will automatically recognize that you are trying to assign <span class="strong"><strong>Animator</strong></span> from the <code class="literal">sprite</code> game object to the Animator variable:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_09_16.jpg" /></div><p>After a correct assignment, the <span class="strong"><strong>Inspector</strong></span> window will look like the preceding screenshot. Now, we have really easy access to the <span class="strong"><strong>Animator</strong></span> component through the <code class="literal">animator</code> variable within the <code class="literal">PlayerController</code> script. Let's put that to use. First, set the <code class="literal">isAlive</code> animator parameter to <code class="literal">true</code>, as we want Jake to be happy at the start. Add the <code class="literal">Start</code> method in <code class="literal">PlayerController</code> with the following line:</p><div class="informalexample"><pre class="programlisting">void Start() {
  animator.SetBool("isAlive", true);</pre></div><p>At the end of the <code class="literal">Update</code> method, inset this line to set the <code class="literal">IsGrounded</code> animator parameter:</p><div class="informalexample"><pre class="programlisting">animator.SetBool("isGrounded", IsGrounded());</pre></div><p>Save the code and press <a id="id309" class="indexterm"></a>
<span class="strong"><strong>Play</strong></span> in Unity. Jake should be set to the alive state at the start and change his face a little during the jumps. This is cool, isn't it?</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec62"></a>Running</h3></div></div></div><p>Jake is very much alive nowâ€”smiling, jumping, and running... in the same place. The next task is to make <a id="id310" class="indexterm"></a>him run forward. You probably know how we are going to approach this. We can add a constant force forward. Add a <code class="literal">runningSpeed</code> float public variable to the <code class="literal">PlayerController</code> class:</p><div class="informalexample"><pre class="programlisting">publicfloat runningSpeed = 1.5f;</pre></div><p>Also, add the following method to apply the force:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_09_18.jpg" /></div><p>The <code class="literal">FixedUpdate</code> method is called automatically in Unity after a fixed time interval; it is not like the <code class="literal">Update</code> method, which is called every frame.</p><p>
<code class="literal">FixedUpdate</code> is the best place to add constant forces to your physics. If you wish to learn more about the <code class="literal">FixedUpdate</code> method, dive into Unity's documentation. For now, all you need to understand is that this method is called all the time, and you do not need to call this yourself. In line <span class="strong"><strong>34</strong></span>, we are applying a <code class="literal">Vector2</code> velocity to the <code class="literal">rigidbody</code>. The new <code class="literal">Vector2</code> is a simple C# constructor, and we are passing the <code class="literal">x</code> and <code class="literal">y</code> values in brackets. Our character is moving from left to right, so we are applying force with <code class="literal">x</code> equal to the running speed and leaving velocity <code class="literal">y</code> unchanged.</p><p>Line <span class="strong"><strong>31</strong></span> prevents constant acceleration. We are only applying force if the <code class="literal">x</code> velocity is lower than the running speed. In human words, if the character's speed is slower than the running speed, push him forward.</p><p>Go ahead, save your script and press <span class="strong"><strong>Play</strong></span> in Unity. You will see Jake is moving forward now. We have implemented running and jumping functionality. I think we can easily call it our first gameplay! As you probably noticed, Jake will run forward until he falls down from the platform and will be falling forever until you restart. We are missing a game-over event here. In the next chapter, we will write the <code class="literal">GameManager</code> class to help us clamp the whole game functionality together.</p></div></div>