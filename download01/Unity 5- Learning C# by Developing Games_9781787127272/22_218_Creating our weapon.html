<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch22lvl1sec202"></a>Creating our weapon</h2></div></div><hr /></div><p>Now, with a <a id="id1007" class="indexterm"></a>traditional<a id="id1008" class="indexterm"></a> first-person shooter, we shoot a bullet from a gun to damage enemies. However, we will create a camera that will take pictures to damage enemies.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch22lvl2sec121"></a>Creating our camera</h3></div></div></div><p>Now before we can shoot anything, we need to make our camera, and to do this, we are going to create another camera object that is zoomed in and then give it a border to look more realistic. To <a id="id1009" class="indexterm"></a>show how easy it is to do, let's get started! Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing we need to do is go to the flashlight <span class="strong"><strong>Spotlight</strong></span> object we created earlier. So, with it selected, double-click on it to center the camera on it.</p></li><li><p>Our camera weapon is going to be another object, which will be a child of the <span class="strong"><strong>FirstPersonCharacter</strong></span> object. To do this, first select the <span class="strong"><strong>FirstPersonCharacter</strong></span> object that is located on our <span class="strong"><strong>FPSController</strong></span> object and then right-click on it from the <span class="strong"><strong>Hierarchy</strong></span> and then select <span class="strong"><strong>Create Empty</strong></span>. Also, in the <span class="strong"><strong>Inspector</strong></span> section for this newly created object, confirm whether the object's position is <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>. If it isn't, set it at that position. Finally, name the object <code class="literal">Photo Camera</code>. Take a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_08.jpg" /></div></li><li><p>Next, add a camera component by clicking on the <span class="strong"><strong>Add Component</strong></span> button at the bottom of the <span class="strong"><strong>Inspector</strong></span> tab and then putting in the text <code class="literal">Camera</code> in the search bar before selecting it.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note107"></a>Note</h3><p>Alternatively, you can just navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Addâ€¦</strong></span> from the top bar to bring up the menu.</p></div></li><li><p>This camera will be <a id="id1010" class="indexterm"></a>zoomed in from the normal camera, so I'm going to change the <span class="strong"><strong>Field of View</strong></span> value to <code class="literal">30</code>. Now, switch the <span class="strong"><strong>Scene</strong></span> tab over the <span class="strong"><strong>Game</strong></span> tab so you can see what we will be doing. This will aid in understanding what each of these properties do.</p></li><li><p>We also want this camera to be on top of the previously created one, so we are going to change the <span class="strong"><strong>Depth</strong></span> value to <code class="literal">1</code> (higher numbers put things in front of the other cameras).</p></li><li><p>This being said, we still want to see our previous camera as well in the background, so we're going to set the <span class="strong"><strong>Viewport Rect</strong></span> values to put our new camera in the center of the screen at 75% of the size of the previous one. To do this, set the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> properties in the <span class="strong"><strong>Viewport Rect</strong></span> option to <code class="literal">.125</code> and the <span class="strong"><strong>W</strong></span> and <span class="strong"><strong>H</strong></span> properties to <code class="literal">.75</code>.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_09.jpg" /></div></li><li><p>Now, in our game, this camera isn't just going to be a camera; it's also going to have a border around it. In this case, it'll be a cell phone. From the <code class="literal">Chapter 9/Art Assets</code> folder included in the example code, grab the <code class="literal">phone.png</code> file and move it into the <code class="literal">Materials</code> folder inside your project browser.</p></li><li><p>Once it's imported, select it to bring up the properties in the <span class="strong"><strong>Inspector</strong></span> tab. By default, in a 3D project, <code class="literal">.png</code> files will be imported with a <span class="strong"><strong>Texture Type</strong></span> value of <code class="literal">Texture</code>. We <a id="id1011" class="indexterm"></a>want to change it to <code class="literal">Sprite (2D and UI)</code>, so click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>Next, we need to add this texture to our inner camera. To do this, let's create a <span class="strong"><strong>Panel</strong></span> object by going to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>. As you recall, panels resize themselves to fit their canvas.</p></li><li><p>Next go to the <span class="strong"><strong>Panel</strong></span> object and then drag and drop our phone image into the <span class="strong"><strong>Source Image</strong></span> slot. The image shows up, but it's semi-transparent. To fix this, go to the <span class="strong"><strong>Color</strong></span> property and change the color to be fully white.</p></li><li><p>The phone is not sized really well and doesn't match a phone's normal size, so let's check <span class="strong"><strong>Preserve Aspect</strong></span> and you'll see the image now looks correct, but is also somewhat zoomed in. Let's click on <span class="strong"><strong>Set Native Size</strong></span> next and you'll see the image resize it once more. Then, go to the <span class="strong"><strong>Anchors Preset </strong></span>menu, hold down <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>Alt</em></span> and then <span class="emphasis"><em>click</em></span> on the middle-middle option to center the camera to the world.</p></li><li><p>One of the things you may note now is that the camera stays the same size, no matter where the screen is. To fix this, select the <span class="strong"><strong>Canvas</strong></span> object and then under the <span class="strong"><strong>Canvas Scaler</strong></span> component, change the <span class="strong"><strong>UI Scale Mode</strong></span> to <span class="strong"><strong>Scale</strong></span> with <span class="strong"><strong>Screen Size</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_10.jpg" /></div></li><li><p>Right now, I have<a id="id1012" class="indexterm"></a> the aspect ratio set to <span class="strong"><strong>4:3</strong></span>, which we can see in the <span class="strong"><strong>Game</strong></span> tab in the top-left corner just below the tab. This ratio is of the same size as old television sets and monitors, but the code we just created also works with widescreen monitors and makes the camera look much better. So, let's make the game use an aspect ratio of <span class="strong"><strong>16:9</strong></span>. We can do this by clicking on the drop-down list beside <span class="strong"><strong>4:3</strong></span> and then selecting <span class="strong"><strong>16:9</strong></span>.</p><p>If you play the game at this point, the game should look something like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_11.jpg" /></div><p>Looks pretty <a id="id1013" class="indexterm"></a>good! But right now, the camera is always up there, and I only want to see it if the player right-clicks to zoom in.</p></li><li><p>So, with this in mind, let's create another C# script named <code class="literal">PhoneBehaviour</code> and open it inside of your IDE.</p></li><li><p>Place the following code into the <code class="literal">PhoneBehaviour</code> class as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections.Generic; // List

public class PhoneBehaviour : MonoBehaviour
{

    public List&lt;GameObject&gt; phoneObjects;

    private bool cameraActive = false;

    void Start()
    {
        SetCameraActive(false);
    }

    // Update is called once per frame
    void Update () {
        // Are we holding down the right mouse button
        if (Input.GetMouseButton(1) &amp;&amp; !cameraActive)
        {
            SetCameraActive(true);
        }
        else if(cameraActive &amp;&amp; !Input.GetMouseButton(1))
        {
            SetCameraActive(false);
        }

    }

    void SetCameraActive(bool active)
    {
        cameraActive = active;

        foreach (var obj in phoneObjects)
        {
            obj.SetActive(active);
        }
    }
}</pre></div></li></ol></div><p>This script basically <a id="id1014" class="indexterm"></a>makes it so when the player holds down the right mouse button, we will turn on all of the objects that we placed in <code class="literal">phoneObjects</code> and then when we release, we turn them off. We only want to do this on frames when it changes from one state to another (turning it on every frame would be inefficient), so we added in a Boolean to keep track where we were in the last frame.</p><p>Go in and add the <span class="strong"><strong>PhoneBehaviour</strong></span> component to the <span class="strong"><strong>FirstPersonCharacter</strong></span> object. From there change the <span class="strong"><strong>Size</strong></span> of <span class="strong"><strong>Phone Objects</strong></span> to <code class="literal">2</code> and assign <span class="strong"><strong>Photo Camera</strong></span> and our <span class="strong"><strong>Canvas' Panel</strong></span> to the<a id="id1015" class="indexterm"></a> property.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_12.jpg" /></div><p>Save our project, level, and play the game!</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_13.jpg" /></div><p>Now, the camera<a id="id1016" class="indexterm"></a> will only come up whenever we hold down the right mouse button! Awesome! It's just like a sniper rifle in most FPS games.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch22lvl2sec122"></a>Shooting our camera</h3></div></div></div><p>Next, we want to add the ability to shoot our weapon and flash it on the screen whenever the <a id="id1017" class="indexterm"></a>camera is shot. To simulate this behavior, we will first create an image to be placed over our entire screen. We perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Just to make it easier to see things, let's first go to the <span class="strong"><strong>Photo Camera</strong></span> object and disable it by unchecking the checkbox by the object's name from the <span class="strong"><strong>Inspector</strong></span> menu. Afterwards, do the same thing for the <span class="strong"><strong>Panel</strong></span> object, and while we are here, let's rename it to <code class="literal">Phone Border</code>.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_14.jpg" /></div></li><li><p>Now that we are back to a normal screen, let's add in a panel to act as our flash. To do this, go to the <span class="strong"><strong>Hierarchy</strong></span> tab and right-click on our <span class="strong"><strong>Canvas</strong></span> object. From there, select <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>. Rename our panel's name to <span class="strong"><strong>Camera Flash</strong></span> and change the color to be fully transparent because we will be changing its color via code.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_15.jpg" /></div></li><li><p>Next, go back <a id="id1018" class="indexterm"></a>to the <code class="literal">PhoneBehaviour</code> file, and add in the following <code class="literal">using</code> statement:</p><div class="informalexample"><pre class="programlisting">using UnityEngine.UI; // Image</pre></div></li><li><p>Then, add the following variable:</p><div class="informalexample"><pre class="programlisting">public Image cameraFlash;</pre></div></li><li><p>Now, a flash contains two parts: fading to white and then fading to a transparent color. The pieces of code doing both of these things are very similar, so we will create a helper function to do this for us, named <code class="literal">Fade</code>. </p></li><li><p>To do this, first, we will need to add in the following <code class="literal">using</code> statement:</p><div class="informalexample"><pre class="programlisting">using System.Collections; // IEnumerator</pre></div></li><li><p>Take a look <a id="id1019" class="indexterm"></a>at the following code:</p><div class="informalexample"><pre class="programlisting">    IEnumerator Fade(float start, float end, float length,
                  Image currentObject)
    {
        if (currentObject.color.a == start)
        {
            Color curColor;
            for (float i = 0.0f; i &lt; 1.0f; 
                 i += Time.deltaTime * (1 / length))
            {
/* 
Cannot modify the color property
directly, so we need to create a copy 
*/
                curColor = currentObject.color;

/*
Do a linear interpolation of the value
of the transparency from the start value to the end value in equal
increments
*/
                curColor.a = Mathf.Lerp(start, end, i);

                // Then we assign the copy to the original 
                // object
                currentObject.color = curColor;

                yield return null;
            }
            curColor = currentObject.color;

/*
ensure the fade is completely finished
(because lerp doesn't always end on the exact value due to rounding errors)
*/
            curColor.a = end;
            currentObject.color = curColor;
        }
    }</pre></div><p>As you may recall from <a class="link" href="#" linkend="ch14">Chapter 1</a>, <span class="emphasis"><em>2D Twin-stick Shooter</em></span>, we can use coroutines to pause functionality, yielding for a time and then resuming functionality. The <code class="literal">IEnumerator</code> class holds the current state of the program and tells us where to continue. The yield return here is asking us to stop the function now and resume after a period.</p><p>Because coroutines are just functions, we can also have parameters in them, just as in the preceding function. With this in mind, we can also nest them together in order to have complex interactions and use our abstracted functions in multiple ways to create interesting behaviors.</p></li><li><p>Then, we will <a id="id1020" class="indexterm"></a>call this function twice with our main function, <code class="literal">CameraFlash</code>, as follows:</p><div class="informalexample"><pre class="programlisting">IEnumerator CameraFlash()
{
    yield return StartCoroutine(Fade(0.0f, 0.8f, 0.2f, cameraFlash));
    yield return StartCoroutine(Fade(0.8f, 0.0f, 0.2f, cameraFlash));
    StopCoroutine ("CameraFlash");
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note108"></a>Note</h3><p>For more examples on how coroutines can be used, check out <a class="ulink" href="http://unitypatterns.com/introduction-to-coroutines/" target="_blank">http://unitypatterns.com/introduction-to-coroutines/</a> and <a class="ulink" href="http://unitypatterns.com/scripting-with-coroutines/" target="_blank">http://unitypatterns.com/scripting-with-coroutines/</a>.</p></div></li><li><p>Finally, this function will never be called if we don't call it, so add the following code to the end of the <code class="literal">PhoneBehaviour</code> scripts' <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">        if (cameraActive &amp;&amp; Input.GetMouseButton(0))
        {
            StartCoroutine(CameraFlash());
        
  }</pre></div></li><li><p>Save the file and go back to the Unity Editor. Finally, back at the <code class="literal">Photo Camera</code> object, assign the <code class="literal">Camera Flash</code> object to the <code class="literal">Camera Flash</code> variable.</p></li><li><p>Save the scene (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>S</em></span>), click on the <span class="strong"><strong>Play</strong></span> button, and try out your new camera. Take a <a id="id1021" class="indexterm"></a>look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_16.jpg" /></div></li></ol></div><p>Looks like everything is in working order! We can look around with our camera, zoom in and out, and shoot pictures.</p></div></div>