<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec82"></a>Gameplay loops</h2></div></div><hr /></div><p>Well done so far. You <a id="id314" class="indexterm"></a>have added basic functionality like jumping, physics, and running to the <code class="literal">PlayerController</code> object. We are definitely going in the right direction here. The next important step is writing a neat <code class="literal">GameManager</code> class to help us control the game events like:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">StartGame</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">GameOver</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">Restart</code>
</p></li></ul></div><p>For basic games like <span class="emphasis"><em>Jake on the mysterious planet</em></span>, it is a good practice to have one instance of the <code class="literal">GameManager</code> running and controlling all main events in the game. The <code class="literal">gameplay</code> loop is simply a journey from the gameplay start to the gameplay phase and the game over phase. Time to write some code!</p><p>Let's create a new C# script and call it <code class="literal">GameManager</code>, and write the following code:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_10_1.jpg" /></div><p>As you can see, nothing is <a id="id315" class="indexterm"></a>very complicated. We wrote very simple methods to help us control the main game events. This script does nothing yet; however, please add it to the Unity <span class="strong"><strong>Scene</strong></span>. Create a new game object call it <code class="literal">GameManager</code>, and add the <code class="literal">GameManager</code> component to it. We will use it in the future.</p><p>We won't test this code in Unity yet. Let's think what can be improved. Would it be nice to have only one method to control the main events in the game? Let's edit the code a little to have something like that.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_10_2.jpg" /></div><p>We have an <code class="literal">enum GameState</code> declaration in lines <span class="strong"><strong>4</strong></span> to <span class="strong"><strong>8</strong></span>. What is <code class="literal">enum</code>? If you check on Google, you will be probably be directed to the Microsoft documentation. From the C# documentation:</p><div class="blockquote"><blockquote class="blockquote"><p>"The enum keyword is used to declare an enumeration, a distinct type that consists of a set of named constants called the enumerator list".</p></blockquote></div><p>Yes, this is a massively overcomplicated definition. Let's forget it and make our own, simple one by defining what we can use <code class="literal">enum</code> for.</p><p>
<code class="literal">Enum</code> is a set of magic constants you can control your code with. We can define few states stored in <code class="literal">enum</code> and use it without risk of typos like with using the string. Lines <span class="strong"><strong>4</strong></span> to <span class="strong"><strong>8</strong></span> simply create a new <code class="literal">enum</code>, which works like an object and can be passed to the method as a parameter. The rest of the code should be well easy for you to understand. <code class="literal">SetGameState</code> is called with a certain <code class="literal">GameState enum</code> value. Note that we are also storing the <code class="literal">currentGameState</code> value for the future.</p><p>We have more code that <a id="id316" class="indexterm"></a>allows us to control events in the game. Now, we need to make some real use of it. If you press <span class="strong"><strong>Play</strong></span> in Unity, you will see that nothing has really changed. Jake still runs the same way he did before <code class="literal">GameManager</code> was added. This is because nothing actually changed in the <code class="literal">PlayerController</code> class. <code class="literal">PlayerController</code> and <code class="literal">GameManager</code> are two separate instances of two different classes. They won't affect each other's behavior until we write some additional code.</p><p>We have already seen how to access components from different scripts by creating public member variable and dragging the game object to the field in <span class="strong"><strong>Inspector</strong></span>. It is a good approach for this situation. However, I want to show you something better. If there is only one instance of the object required in the project, we can use the singleton approach.</p></div>