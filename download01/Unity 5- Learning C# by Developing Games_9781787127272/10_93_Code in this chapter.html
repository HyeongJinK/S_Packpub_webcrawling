<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec89"></a>Code in this chapter</h2></div></div><hr /></div><p>Code for <a id="id340" class="indexterm"></a>
<code class="literal">GameManager.cs</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public enum GameState {
  menu,
  inGame,
  gameOver
}

public class GameManager : MonoBehaviour {

  public static GameManager instance;
  public GameState currentGameState = GameState.menu;


  void Awake() {
    instance = this;
  }

  void Start() {
    currentGameState = GameState.menu;
  }
  
  //called to start the game
  public void StartGame() {
    PlayerController.instance.StartGame();
    SetGameState(GameState.inGame);
  }
  
  //called when player die
  public void GameOver() {
    SetGameState(GameState.gameOver);
  }

  //called when player decide to go back to the menu
  public void BackToMenu() {
    SetGameState(GameState.menu);
  }

  void SetGameState (GameState newGameState) {
    
    if (newGameState == GameState.menu) {
      //setup Unity scene for menu state
    }
    else if (newGameState == GameState.inGame) {
      //setup Unity scene for inGame state
    }
    else if (newGameState == GameState.gameOver) {
      //setup Unity scene for gameOver state
    }
    
    currentGameState = newGameState;
  }


  void Update() {

    if (Input.GetButtonDown("s")) {
      StartGame();
    }
  }

}</pre></div><p>Code for <a id="id341" class="indexterm"></a>
<code class="literal">PlayerController.cs</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PlayerController : MonoBehaviour {

  public static PlayerController instance;

  public float jumpForce = 6f;
  public float runningSpeed = 1.5f;
  public Animator animator;

  private Vector3 startingPosition;
  private Rigidbody2D rigidBody;

  void Awake() {
    instance = this;
    rigidBody = GetComponent&lt;Rigidbody2D&gt;();
    startingPosition = this.transform.position;
  }


  public void StartGame() {
    animator.SetBool("isAlive", true);
    this.transform.position = startingPosition;
  }
  
  void Update () {

    if (GameManager.instance.currentGameState == GameState.inGame) 
    {
      if (Input.GetMouseButtonDown(0)) {
        Jump();
      }
      animator.SetBool("isGrounded", isGrounded());
    }
  }


  void FixedUpdate() {

    if (GameManager.instance.currentGameState == GameState.inGame) 
    {
      if (rigidBody.velocity.x &lt; runningSpeed) {
        rigidBody.velocity = new Vector2(runningSpeed, rigidBody.velocity.y);
      }
    }
  }



  void Jump() {
    if (isGrounded()) {
      rigidBody.AddForce(Vector2.up * jumpForce, ForceMode2D.Impulse);
    }
  }

  public LayerMask groundLayer;

  bool isGrounded() {

    if (Physics2D.Raycast(this.transform.position, Vector2.down, 0.2f, groundLayer.value)) {
      return true;
    }
    else {
      return false;
    }
  }



  public void Kill() {

    GameManager.instance.GameOver();
    animator.SetBool("isAlive", false);
  }

}</pre></div><p>Code for <a id="id342" class="indexterm"></a>
<code class="literal">KillTrigger.cs</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class KillTrigger : MonoBehaviour {
  
  void OnTriggerEnter2D(Collider2D other) {

    if (other.tag == "Player") {
      PlayerController.instance.Kill();
    }
  }

}</pre></div></div>