<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch17lvl1sec151"></a>Creating our player behaviour</h2></div></div><hr /></div><p>Now <a id="id655" class="indexterm"></a>that we have the basic world created, let's add in the ability for our plane to actually move and interact with our world. To start off with, let's make it actually move:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> tab, select the <code class="literal">Plane</code> object. Then, add a <span class="strong"><strong>Rigid Body 2D</strong></span> component to it by selecting <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Rigidbody 2D</strong></span>.</p></li><li><p>We want the object to always check for collision, so from the <span class="strong"><strong>Inspector </strong></span>tab, change the <span class="strong"><strong>Collision Detection</strong></span> property to <span class="strong"><strong>Continuous</strong></span>.</p><p>Now the plane will fall but it falls directly off screen. We want it to react to being hit on the ground, so let's add collision data to it. Generally, we want to use whatever collider is simple enough to get the job done without adding complexity, but in this case, I really want to get realistic looking colliders, so we will add in the most detailed collider for 2D, the <a id="id656" class="indexterm"></a>
<span class="strong"><strong>Polygon Collider 2D</strong></span>.</p></li><li><p>Next, add a <span class="strong"><strong>Polygon Collider 2D</strong></span> component by selecting <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Polygon Collider 2D</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_04_09.jpg" /></div><p>You <a id="id657" class="indexterm"></a>may note the light green lines around the object. These are the parts of the object that will collide with other objects (if they have collision data as well).</p></li><li><p>With that in mind, select the two <code class="literal">groundGrass</code> objects and add a <span class="strong"><strong>Polygon Collider 2D</strong></span> to it as well:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_04_10.jpg" /></div><p>The plane will now react and stop falling once it hits the ground. Now of course the plane still moves at this point, which we'll fix later on, but for right now, we will add in the ability for the plane to "jump."</p></li><li><p>Now go<a id="id658" class="indexterm"></a> to the <span class="strong"><strong>Project</strong></span> tab and open up the <code class="literal">Assets/Scripts</code> folder and create a new C# Script to <code class="literal">PlayerBehaviour</code>.</p></li><li><p>Double-click on the newly created script and use the following code for it:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

[RequireComponent(typeof(Rigidbody2D))]
public class PlayerBehaviour : MonoBehaviour
{

    [Tooltip("The force which is added when the player jumps")]
    public Vector2 jumpForce = new Vector2(0, 300);

    /// &lt;summary&gt;
    /// If we've been hit, we can no longer jump
    /// &lt;/summary&gt;
    private bool beenHit;

    private Rigidbody2D rigidbody2D;

    // Use this for initialization
    void Start ()
    {
        beenHit = false;
        rigidbody2D = GetComponent&lt;Rigidbody2D&gt;();
    }
    
    // Will be called after all of the Update functions
    void LateUpdate ()
    {
        // Check if we should jump as long as we haven't been hit yet
        if ((Input.GetKeyUp("space") || Input.GetMouseButtonDown(0)) 
           &amp;&amp; !beenHit)
        {
            // Reset velocity and then jump up
            rigidbody2D.velocity = Vector2.zero;
            rigidbody2D.AddForce(jumpForce);
        }
    }

    /// &lt;summary&gt;
    /// If we collide with any of the polygon colliders 
    /// then we crash
    /// &lt;/summary&gt;
    /// &lt;param name="other"&gt;Who we collided with&lt;/param&gt;
    void OnCollisionEnter2D(Collision2D other)
    {
        // We have now been hit
        beenHit = true;

        // The animation should no longer play, so we can
        // set the speed to 0 or destroy it
        GetComponent&lt;Animator&gt;().speed = 0.0f;
    }
}</pre></div></li><li><p>Save the script and go back to the Editor. Then, attach the <span class="strong"><strong>PlayerBehaviour</strong></span> component <a id="id659" class="indexterm"></a>to the <code class="literal">Plane</code> object:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_04_11.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch17lvl2sec95"></a>Stopping the game</h3></div></div></div><p>Our plane <a id="id660" class="indexterm"></a>will now jump up into the air, and upon hitting the ground, the plane will no longer animate. However, it would be better for the game to stop once we hit the ground, so let's add that in next. By using mouse input for jumping, this will also work by tapping on the phone:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Flappy Bird also has its objects falling at a faster rate than normal gravity. To change this, we can go to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> and then from there, change the <span class="strong"><strong>Gravity</strong></span> property's <span class="strong"><strong>Y </strong></span>value to <code class="literal">-20</code>. The higher the number the faster the plane will fall. However, note that this will also affect the player's jump force. Tweak these values until you get something that feels right for you.</p></li><li><p>Create<a id="id661" class="indexterm"></a> a new C# Script named <code class="literal">GameController</code>. In it, use the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class GameController : MonoBehaviour {

    [HideInInspector] // Hides var below
    /// &lt;summary&gt;
    /// Affects how fast objects with the
    /// RepeatingBackground script move.
    /// &lt;/summary&gt;
    public static float speedModifier;

    // Use this for initialization
    void Start ()
    {
        speedModifier = 1.0f;
    }

}</pre></div></li><li><p>Save the script and return to the Unity Editor. Create a new empty game object in the <span class="strong"><strong>Hierarchy</strong></span> by selecting <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span>. Then, name it <code class="literal">GameController </code>and attach the <span class="strong"><strong>GameController</strong></span> component to it. Finally, to make it easy to reference, drag the object to the top of the <span class="strong"><strong>Hierarchy </strong></span>tab.</p></li><li><p>Next, open up the <code class="literal">PlayerBehaviour </code>script and add the following bolded line of code to the <code class="literal">OnCollisionEnter2D</code> function:</p><div class="informalexample"><pre class="programlisting">    void OnCollisionEnter2D(Collision2D other)
    {
        // We have now been hit
        beenHit = true;
<span class="strong"><strong>        GameController.speedModifier = 0;</strong></span>

// The animation should no longer play, so we can set the speed        // to 0 or destroy it
        GetComponent&lt;Animator&gt;().speed = 0.0f;
    }</pre></div></li><li><p>Save that script and now open up the <code class="literal">RepeatingBackground</code> script, and from the <code class="literal">FixedUpdate</code> function, <span class="strong"><strong>add the following change in bold</strong></span>:</p><div class="informalexample"><pre class="programlisting">// Move the object a certain amount to the left (negative in the
// x axis)
   pos.x -= scrollSpeed * Time.deltaTime <span class="strong"><strong>*</strong></span>
<span class="strong"><strong>            GameController.speedModifier;</strong></span>
</pre></div></li><li><p>Save <a id="id662" class="indexterm"></a>that script and return to the Unity editor; save your project and play the game:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_04_12.jpg" /></div></li></ol></div><p>At this point, whenever <a id="id663" class="indexterm"></a>we fall, the game will now stop the background objects! Perfect.</p></div></div>