<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch14lvl1sec117"></a>Implementing player movement</h2></div></div><hr /></div><p>Now, at <a id="id448" class="indexterm"></a>this point, we have a great-looking game, but nothing at all happens. Let's change that now using our player. Perform<a id="id449" class="indexterm"></a> the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right-click on the <span class="strong"><strong>Scripts</strong></span> folder you created earlier, click on <span class="strong"><strong>Create</strong></span>, and select the <span class="strong"><strong>C# Script</strong></span> label. Once you click on it, a script will appear in the <span class="strong"><strong>Scripts</strong></span> folder, and it should already have focus and be asking you to type a name for the script â€“ call it <code class="literal">PlayerBehaviour</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>Note that I'm using Behaviour instead of Behavior. Either is fine to use as long as you're consistent, but since Unity's base script is called MonoBehaviour, I use the same spelling to avoid confusion.</p></div></li><li><p>Double-click on the script in Unity, and it will open <a id="id450" class="indexterm"></a>
<span class="strong"><strong>MonoDevelop</strong></span> or <a id="id451" class="indexterm"></a>
<span class="strong"><strong>Visual Studio Community 2015</strong></span> depending on how you installed Unity and what OS your computer is running.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>While code can be written in any program that can support text (such as Notepad), both of these pieces of software are integrated development environments (IDEs) that are created to make software development easier and more convenient to work with giving users access to useful features. MonoDevelop is open source, multi-platform, and is included with your Unity installation, but Visual Studio is a very popular tool with programmers and has some nice features that are exclusive to it. However, it can only be used for free by individual developers or for education and open source projects. For this book, we will not be doing anything specific to either IDE, so it's up to you which you'd like to use.</p><p>If you'd like to change which piece of software to use to open script files in Unity, you can go to the <span class="strong"><strong>Edit | Preferences</strong></span> menu and then go to <span class="strong"><strong>External Tools</strong></span> and under <span class="strong"><strong>External Script Editor</strong></span>, click on the drop-down menu and select whichever you'd like to use.</p></div></li></ol></div><p>After your IDE has loaded, you will be presented with the C# stub code that was created automatically for you by Unity when you created the C# script.</p><p>Let's break down what's currently there before we replace some of it with new code. At the top, you will see two lines:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip08"></a>Tip</h3><p>Detailed steps to download the code bundle are mentioned in the Preface of this book. Please have a look.</p><p>The code bundle for the book is also hosted on GitHub at <a class="ulink" href="https://github.com/PacktPublishing/Unity-5.x-Game-Development-Blueprints" target="_blank">https://github.com/PacktPublishing/Unity-5.x-Game-Development-Blueprints</a>. We also have other code bundles from our rich catalog of books and videos available at <a class="ulink" href="https://github.com/PacktPublishing/" target="_blank">https://github.com/PacktPublishing/</a>. Check them out!!</p></div><p>The <a id="id452" class="indexterm"></a>engine knows that if we refer to a class that isn't located inside this file, then it has to reference the contents within these namespaces for the referenced class before giving an error. We are currently using two namespaces.</p><p>The <code class="literal">UnityEngine</code> namespace <a id="id453" class="indexterm"></a>contains interfaces and class definitions that let MonoDevelop know about all the addressable objects inside Unity.</p><p>The <code class="literal">System.Collections</code> namespace contains interfaces and classes that define various collections of objects, such as lists, queues, bit arrays, hash tables, and dictionaries. But we will not be using it in this file so you can remove that line.</p><p>The next line you'll see is:</p><div class="informalexample"><pre class="programlisting">public class PlayerBehaviour : MonoBehaviour {</pre></div><p>You can think of a class as a kind of blueprint for creating a new component type that can be attached to <code class="literal">GameObjects</code>, the objects inside our scenes that start out with just <code class="literal">Transform</code> and then have components added to them. When Unity created our C# stub code, it took care of that; we can see the result, as our file is called <code class="literal">PlayerBehaviour</code> and the class <a id="id454" class="indexterm"></a>is also called <code class="literal">PlayerBehaviour</code>. Make sure that your <code class="literal">.cs</code> file and the name of the class match, as they must be the same to enable the script component to be attached to a game object. Next up is the<code class="literal">: MonoBehaviour</code> section of the code. The <code class="literal">:</code> symbol signifies that we inherit from a particular class; in this case, it is set to <code class="literal">MonoBehaviour</code>. All behavior scripts must inherit from <code class="literal">MonoBehaviour</code> directly or indirectly by being derived from it. This idea of having classes inherit behavior is known as <a id="id455" class="indexterm"></a>
<span class="strong"><strong>inheritance</strong></span>. </p><p>Inheritance is<a id="id456" class="indexterm"></a> the idea of having an object to be based on another object or class using the same implementation. With this in mind, all of the functions and variables that exist inside the <code class="literal">MonoBehaviour</code> class will also exist in the <code class="literal">PlayerBehaviour</code> class, because <code class="literal">PlayerBehaviour</code> is a <code class="literal">MonoBehaviour</code> with the ability to add more to it.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip09"></a>Tip</h3><p>Checking Unity's Script Reference can be quite useful when determining what has already been done for you in Unity. For more information on the <code class="literal">MonoBehaviour</code> class and all of the functions and properties it has, check out <a class="ulink" href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.html" target="_blank">http://docs.unity3d.com/ScriptReference/MonoBehaviour.html</a>.</p></div><p>Directly after this line, we will want to add some variables to help us with the project. Variables are pieces of data that we wish to hold on to for one reason or another, typically because they will change over the course of a program, and we will do different things based on their values.</p><p>Add the following code under the class definition:</p><div class="informalexample"><pre class="programlisting">// Movement modifier applied to directional movement.
public float playerSpeed = 4.0f;

// What the current speed of our player is
private float currentSpeed = 0.0f;

// The last movement that we've made
private Vector3 lastMovement = new Vector3();</pre></div><p>Between the variable definitions, you will notice comments to explain what each variable is and how we'll use it. To write a comment, you can simply add a <code class="literal">//</code> to the beginning of a line and everything after that is commented upon so that the compiler/interpreter won't see it. If you want to write something that is longer than one line, you can use <code class="literal">/*</code> to start a comment, and everything inside will be commented until you write <code class="literal">*/</code> to close it. It's always a good idea to do this in your own coding endeavors for anything that doesn't make sense at first glance.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note42"></a>Note</h3><p>For those of you working on your own projects in teams, there is an additional form of commenting that Unity supports, which may make your life much easier: XML comments. They take up more space than the comments we are using, but also document your code for you. For a nice tutorial about that, check out <a class="ulink" href="http://bit.ly/xmlComments" target="_blank">http://bit.ly/xmlComments</a>.</p></div><p>One <a id="id457" class="indexterm"></a>of the things you'll notice is the <code class="literal">public</code> and <code class="literal">private</code> keywords before the variable type. These are access modifiers that dictate who can and cannot use these variables. The <code class="literal">public</code> keyword means that any other class can access that property, whereas <code class="literal">private</code> means that only this class will be able to access this variable. Here, <code class="literal">currentSpeed</code> is private because we want our <a id="id458" class="indexterm"></a>current speed not to be modified or set anywhere else. But, you'll notice something interesting with the <code class="literal">public</code> variable that we've created. Go back into the Unity project and drag and drop the <code class="literal">PlayerBehaviour</code> script onto the <code class="literal">playerShip</code> object. Before going back to the Unity project though, make sure that you save your <code class="literal">PlayerBehaviour</code> script. Not saving is a very common mistake made by people when starting to code. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_01_10.jpg" /></div><p>You'll notice now that the <code class="literal">public</code> variable that we created are located inside <span class="strong"><strong>Inspector</strong></span> for the component. This means that we can actually set those variables inside <span class="strong"><strong>Inspector</strong></span> without having to modify the code, allowing us to tweak values in our code very easily, which is a godsend for many game designers. You may also notice that the name for <span class="strong"><strong>Player Speed</strong></span> has been changed to be more readable. This is because of the naming convention that we are using where each word starts with a capital letter. This convention is called <code class="literal">CamelCase</code> (more specifically <code class="literal">headlessCamelCase</code>).</p><p>Now that we have our variables set, go back to <code class="literal">MonoDevelop</code> for us to work on the script some more.</p><p>The line <a id="id459" class="indexterm"></a>after that is a function definition for a method called <code class="literal">Start</code>; it isn't a user method but one that belongs to <code class="literal">MonoBehaviour</code>. Where variables are data, functions are the things that modify and/or use that data. Functions are self-contained modules of code (enclosed within braces <code class="literal">{</code> and <code class="literal">}</code>) that <a id="id460" class="indexterm"></a>accomplish a certain task. The nice thing about using a function is that once a function is written, it can be used over and over again. Functions can be called from inside of other functions:</p><div class="informalexample"><pre class="programlisting">void Start () {
    
}</pre></div><p>
<code class="literal">Start</code> is only called once in the lifetime of the behavior when the game starts and is typically used to initialize data.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note43"></a>Note</h3><p>If you're used to other programming languages, you may be surprised that initialization of an object is not done using a constructor function. This is because the construction of objects is handled by the editor and does not take place at the start of gameplay as you might expect. If you attempt to define a constructor for a script component, it will interfere with the normal operation of Unity and can cause major problems with the project.</p></div><p>However, for this behavior, we will not need to use the <code class="literal">Start</code> function. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Delete the <code class="literal">Start</code> function and its contents.</p><p>The next function that we see included is the <code class="literal">Update</code> function. Also inherited from <code class="literal">MonoBehaviour</code>, this function is called for every frame that the component exists in and for each object that it's attached to. We want to update our player ship's rotation and movement every turn.</p></li><li><p>Inside the <code class="literal">Update</code> function (between <code class="literal">{</code> and <code class="literal">}</code>), put the following lines of code:</p><div class="informalexample"><pre class="programlisting">// Rotate player to face mouse
Rotation();
// Move the player's body
Movement();</pre></div><p>Here, I called two functions, but these functions do not exist because we haven't created them yet (and will possibly show up as red in your IDE because of that). Let's do that now!</p></li><li><p>Below <a id="id461" class="indexterm"></a>the <code class="literal">Update</code> function <a id="id462" class="indexterm"></a>and before the <code class="literal">}</code> that closes the class, put the following function to close the class:</p><div class="informalexample"><pre class="programlisting">// Will rotate the ship to face the mouse.
void Rotation()
{
  // We need to tell where the mouse is relative to the 
  // player
  Vector3 worldPos = Input.mousePosition;
  worldPos = Camera.main.ScreenToWorldPoint(worldPos);

  /*
    * Get the differences from each axis (stands for 
    * deltaX and deltaY)
  */
  float dx = this.transform.position.x - worldPos.x;
  float dy = this.transform.position.y - worldPos.y;

  // Get the angle between the two objects
  float angle = Mathf.Atan2(dy, dx) * Mathf.Rad2Deg;

  /* 
    * The transform's rotation property uses a Quaternion, 
    * so we need to convert the angle in a Vector 
    * (The Z axis is for rotation for 2D).
  */
  Quaternion rot = Quaternion.Euler(new Vector3(0, 0, angle + 90));

  // Assign the ship's rotation
  this.transform.rotation = rot;
}</pre></div><p>In this code, we are changing the rotation of the object we attached this script to (our player) based on where the player has put the mouse. Now, if you comment out the <code class="literal">Movement</code> line (by putting // in front of it) and run the game, you'll notice that the ship will rotate in the direction in which the mouse is. Have a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_01_13.jpg" /></div><p>If you did comment out the line, be sure to remove the // before continuing.</p></li><li><p>Below<a id="id463" class="indexterm"></a> the <code class="literal">Rotation</code> function, we<a id="id464" class="indexterm"></a> now need to add the following code in our <code class="literal">Movement</code> function:</p><div class="informalexample"><pre class="programlisting">// Will move the player based off of keys pressed
void Movement()
{
  // The movement that needs to occur this frame
  Vector3 movement = new Vector3();

  // Check for input
  movement.x += Input.GetAxis ("Horizontal");
  movement.y += Input.GetAxis ("Vertical");

  /* 
    * If we pressed multiple buttons, make sure we're only 
    * moving the same length.
  */
  movement.Normalize ();

  // Check if we pressed anything
  if(movement.magnitude &gt; 0)
  {
    // If we did, move in that direction
    currentSpeed = playerSpeed;
    this.transform.Translate(movement * Time.deltaTime * playerSpeed, Space.World);
    lastMovement = movement;
  }
  else
  {
    // Otherwise, move in the direction we were going
    this.transform.Translate(lastMovement * Time.deltaTime * currentSpeed, Space.World);
    // Slow down over time
    currentSpeed *= .9f;
  }
}</pre></div><p>Now, inside this function, we use Unity's built in Input properties in order to set the x and y aspect of our movement vector and then move (or Translate) the ship in that direction. <span class="strong"><strong>Edit | Project Settings | Input</strong></span> will open up Unity's<a id="id465" class="indexterm"></a> <span class="strong"><strong>Input Manager</strong></span>, which will have a list of different Axes that can<a id="id466" class="indexterm"></a> be used for input.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_01_14.jpg" /></div><p>As you can see here, <code class="literal">left</code> and <code class="literal">a</code> are used in the <span class="strong"><strong>Negative Button </strong></span>and <span class="strong"><strong>Alt Negative Button </strong></span>properties respectively, so if we press either of those two it will give you a number between -1 and 1, with positive giving you a value between 0 and 1.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note44"></a>Note</h3><p>For more information on the<a id="id467" class="indexterm"></a> Input Manager, check out: <a class="ulink" href="http://docs.unity3d.com/Manual/class-InputManager.html" target="_blank">http://docs.unity3d.com/Manual/class-InputManager.html</a>.</p></div></li><li><p>Now, save <a id="id468" class="indexterm"></a>your file<a id="id469" class="indexterm"></a> and move back into Unity. Save your current scene as <code class="literal">Chapter_1.unity</code> by going to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save Scene</strong></span>. Make sure to save the scene to our <code class="literal">Scenes</code> folder we created earlier.</p></li><li><p>Run the game by pressing the play button on the top toolbar. And you should see something like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_01_15.jpg" /></div></li></ol></div><p>Now, you'll see that we can move using the arrow keys or the <span class="emphasis"><em>W</em></span> <span class="emphasis"><em>A</em></span> <span class="emphasis"><em>S</em></span> <span class="emphasis"><em>D</em></span> keys, and our ship will rotate to face the mouse. Great!</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip10"></a>Tip</h3><p>If you'd like to make your ship move faster and/or slower, increase or decrease the PlayerBehavior component's <span class="strong"><strong>Player Speed</strong></span> variable inside the <span class="strong"><strong>Inspector</strong></span> tab.</p></div></div>