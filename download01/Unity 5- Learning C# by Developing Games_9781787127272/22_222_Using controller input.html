<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch22lvl1sec206"></a>Using controller input</h2></div></div><hr /></div><p>One of the biggest advantages of using Unity as a game engine is the fact that you can support multiple platforms with minimal changes to your base game. In fact, right now, if you plug<a id="id1051" class="indexterm"></a> in an Xbox 360 Controller into your computer, restart Unity, and try to play the game, you'll note that the left-hand side joystick already moves the player, and if you press the <span class="emphasis"><em>Y</em></span> button, you will jump into the air. However, some of the aspects don't <a id="id1052" class="indexterm"></a>work, so let's get them implemented.</p><p>Let's get started by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing that we're going to need to do is let Unity know that we want to work with some new input. So, to do this, we will need to navigate to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Input</strong></span>. </p></li><li><p>Once there, we need to add four new axes to our project, the first being a new horizontal axis, so right-click on the <span class="strong"><strong>Mouse X</strong></span> axis and select <span class="strong"><strong>Duplicate Array Element</strong></span>.</p></li><li><p>Extend the newly created <span class="strong"><strong>Mouse X</strong></span> axes and rename it to <code class="literal">360 Right Horizontal</code>. The controller output is never 100% correct, so we want to change the <span class="strong"><strong>Dead</strong></span> value to <code class="literal">.05</code> so that any value between <code class="literal">-.05</code> and <code class="literal">.05</code> won't be counted.</p></li><li><p>Change the <span class="strong"><strong>Type</strong></span> value to <span class="strong"><strong>Joystick Axis</strong></span> and the <span class="strong"><strong>Axis</strong></span> value to <span class="strong"><strong>4th axis (Joysticks)</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_24.jpg" /></div></li><li><p>Do the same for<a id="id1053" class="indexterm"></a> the <span class="strong"><strong>Mouse Y</strong></span> axis <a id="id1054" class="indexterm"></a>with the name <code class="literal">360 Right Vertical</code> using the <span class="strong"><strong>5th axis (Joysticks)</strong></span> option. Take a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_25.jpg" /></div></li><li><p>We will also want to have triggers work, so add in <code class="literal">360 Left Trigger</code> and <code class="literal">360 Right Trigger </code>by changing the <span class="strong"><strong>Size</strong></span> of the <span class="strong"><strong>Axes</strong></span> to <code class="literal">22</code> and renaming the last 2. Removing the positive and negative buttons. Changing the <span class="strong"><strong>Type</strong></span> to <span class="strong"><strong>Joystick Axis</strong></span> and <a id="id1055" class="indexterm"></a>then<a id="id1056" class="indexterm"></a> the <span class="strong"><strong>Axis</strong></span> to <code class="literal">9</code> and <code class="literal">10</code>, respectively.</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_26.jpg" /></div></li><li><p>Now, we will need to alter the character controller's <code class="literal">MouseLook</code> script file, so double-click on it to open MonoDevelop. Once opened, add the following bolded code to its <code class="literal">LookRotation</code> function:</p><div class="informalexample"><pre class="programlisting">        public void LookRotation(Transform character, Transform camera)
        {
            float yRot = CrossPlatformInputManager.GetAxis("Mouse X") * XSensitivity;
            float xRot = CrossPlatformInputManager.GetAxis("Mouse Y") * YSensitivity;

            
<span class="strong"><strong>            float xRot360 = Input.GetAxis("360 Right Horizontal") * 15 * XSensitivity;</strong></span>
<span class="strong"><strong>            float yRot360 = Input.GetAxis("360 Right Vertical") * 15 * YSensitivity;</strong></span>

<span class="strong"><strong>            yRot += xRot360;</strong></span>
<span class="strong"><strong>            xRot -= yRot360;</strong></span>

            m_CharacterTargetRot *= Quaternion.Euler (0f, yRot, 0f);
            m_CameraTargetRot *= Quaternion.Euler (-xRot, 0f, 0f);

            if(clampVerticalRotation)
                m_CameraTargetRot = ClampRotationAroundXAxis (m_CameraTargetRot);

            if(smooth)
            {
                character.localRotation = Quaternion.Slerp (character.localRotation, m_CharacterTargetRot,
                    smoothTime * Time.deltaTime);
                camera.localRotation = Quaternion.Slerp (camera.localRotation, m_CameraTargetRot,
                    smoothTime * Time.deltaTime);
            }
            else
            {
                character.localRotation = m_CharacterTargetRot;
                camera.localRotation = m_CameraTargetRot;
            }

            UpdateCursorLock();
        }</pre></div><p>This code <a id="id1057" class="indexterm"></a>will make <a id="id1058" class="indexterm"></a>the right joystick rotate the player's camera.</p></li><li><p>Now that we have that done, let's get the camera and shoot to work. To do that, we need to now open the <code class="literal">PhoneBehaviour</code> script. First of all, we're going to need to introduce a new variable to account for the fact that we want the player to<a id="id1059" class="indexterm"></a> have to<a id="id1060" class="indexterm"></a> release the right trigger before they can shoot again:</p><div class="informalexample"><pre class="programlisting">private bool shotStarted = false;</pre></div></li><li><p>Now, we will update the <code class="literal">Update</code> function to the following code. Note the changes set in bold:</p><div class="informalexample"><pre class="programlisting">    void Update () {
        // Are we holding down the right mouse button
        if ((Input.GetMouseButton(1) <span class="strong"><strong>|| (Input.GetAxis("360 Left Trigger") &gt; 0))</strong></span> &amp;&amp; !cameraActive)
        {
            SetCameraActive(true);
        }
        else if(cameraActive &amp;&amp; <span class="strong"><strong>!(Input.GetMouseButton(1) || (Input.GetAxis("360 Left Trigger") &gt; 0)))</strong></span>
        {
<span class="strong"><strong>            SetCameraActive(false);</strong></span>
        }

        if (cameraActive &amp;&amp; (Input.GetMouseButton(0) || (Input.GetAxis("360 Right Trigger") &gt; 0)))
        {
            shotStarted = true;

            StartCoroutine(CameraFlash());

            GameObject[] enemyList = GameObject.FindGameObjectsWithTag("Enemy");

            foreach (GameObject enemy in enemyList)
            {
                if (enemy.activeInHierarchy)
                {
                    EnemyBehaviour behaviour = enemy.GetComponent&lt;EnemyBehaviour&gt;();
                    behaviour.TakeDamage();
                }
            }

        }

<span class="strong"><strong>        if (Input.GetAxis("360 Right Trigger") == 0)</strong></span>
<span class="strong"><strong>        {</strong></span>
<span class="strong"><strong>            shotStarted = false;</strong></span>
<span class="strong"><strong>        }</strong></span>


    }</pre></div></li><li><p>Save your <a id="id1061" class="indexterm"></a>scripts and<a id="id1062" class="indexterm"></a> start the game. Take a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B05212_09_27.jpg" /></div></li></ol></div><p>At this point, you should be able to play the project using an Xbox 360 Controller!</p><p>Now, depending on what platform you're running Unity, there may be special things to take into consideration. For more information about <a id="id1063" class="indexterm"></a>using the Xbox 360 Controller, visit <a class="ulink" href="http://wiki.unity3d.com/index.php?title=Xbox360Controller" target="_blank">http://wiki.unity3d.com/index.php?title=Xbox360Controller</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note111"></a>Note</h3><p>For those<a id="id1064" class="indexterm"></a> who don't want<a id="id1065" class="indexterm"></a> to deal with input too much and just want something that will standardize your input for common controllers, I hear good things about Gallant Games' <a id="id1066" class="indexterm"></a>InControl input manager. You can find out more about from <a class="ulink" href="http://www.gallantgames.com/incontrol" target="_blank">http://www.gallantgames.com/incontrol</a>.</p><p>While not all the features are included, they have an open source version of most of the content at <a class="ulink" href="http://github.com/pbhogan/InControl" target="_blank">http://github.com/pbhogan/InControl</a>, but if you use their tool and find it useful, I recommend that you buy it to support further development.</p></div></div>