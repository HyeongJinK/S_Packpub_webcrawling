<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec91"></a>Generating levels versus designed levels</h2></div></div><hr /></div><p>The next big <a id="id343" class="indexterm"></a>chunk of development in our game is the level. A level is simply the environment that a player is placed in virtually. You are probably a gamer yourself, so I don't really need to explain this much. However, I want to talk about one thing—we need to make a decision on how we want the level to look and behave to keep the player engaged all the time.</p><p>A level can be either randomly generated during the game (for example, in <span class="emphasis"><em>Run)</em></span>, or have static, designed by level designer layout (for example, <span class="emphasis"><em>Super Mario Bros</em></span>.).</p><p>There are pros and cons to both level types. A designed level can be customized very easily and is easier to develop in general. However, the player might not like the repetitiveness of the level at all.</p><p>If we choose the generating-during-gameplay approach, we have slightly more work to do. However, the level can be endless and random every time the player sees it. The player will always be challenged by different level layouts. Let's choose this approach. If you are feeling a bit confused now, I will break it down into a few features of a level, which are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A level is made up of level chunks. Each chunk is simply a part of the level.</p></li><li style="list-style-type: disc"><p>Each level chunk will be predesigned.</p></li><li style="list-style-type: disc"><p>The level will be generated randomly by placing the chunks one by one.</p></li><li style="list-style-type: disc"><p>A chunk will be placed in the front of the <code class="literal">Player</code> game object and destroyed behind the <code class="literal">Player</code> game object.</p></li><li style="list-style-type: disc"><p>Level chunks will be placed seamlessly next to each other so that the player has a <a id="id344" class="indexterm"></a>feeling of continuous gameplay.</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_01.jpg" /></div><p>Individual level chunks in the preceding illustration are represented by rectangles with black edges. The section marked in the center of the image is the viewport visible to the player through Unity's camera.</p><p>So, in simple words, the player is traveling from left to right. At a later stage, we will make the camera follow the player. When the player game object enters the trigger (the green rectangle), the oldest chunk on the left-hand side will be destroyed; at the same time, we will instantiate a new chunk in front of the player.</p><p>Great! So, this approach gives us an endless level that generates itself, and technically the player can play forever.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec64"></a>Creating a level chunk</h3></div></div></div><p>The level chunk is the <a id="id345" class="indexterm"></a>most important part of the level. It's like a Lego piece. A single piece can't bring about much fun for the player. However, when you take a lot of Lego pieces and fix them together, you can build a structure that's really entertaining. Our level will work exactly the same way. Level chunks right next to each other will create a nice gaming experience (and fun) for the player.</p><p>Before we talk about coding the level chunks, we need to make sure that we understand the fundamental parts of each chunk:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_02.jpg" /></div><p>This is a level <a id="id346" class="indexterm"></a>chunk. It can contain whatever you wish to add to it. It's up to you to design the chunks. You need to remember, however, that every chunk must have the following features to fit your game:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>exitPoint—red dot</strong></span>: This is the point in 3D space where the next chunk will be placed to match this chunk</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>startPoint—greenDot</strong></span>: This is the pivot point of the parent chunk that is plugged into the exit point of the previous chunk</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>exit trigger—green trigger on the right-hand side</strong></span>: This detects when the player went through the chunk to tell LevelGenerator to destroy the old piece and instantiate a new piece</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>kill trigger—red box</strong></span>: This is an optional trigger that kills the player on contact</p></li></ul></div><p>So, this is it! A very simple part of a level that we call a level chunk. Let's do something exciting now <a id="id347" class="indexterm"></a>and write a -procedural level generation.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec65"></a>Planning the LevelGenerator class</h3></div></div></div><p>Remember <a id="id348" class="indexterm"></a>that we are not writing any code without quick planning. Let's quickly think about the <code class="literal">LevelGenerator</code> script and the functionality.</p><p>We will definitely need to write methods for:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">AddPiece</code>, which is the level chunk right behind the last level chunk that is already generated</p></li><li style="list-style-type: disc"><p>
<code class="literal">RemoveOldestPiece</code>, to keep Unity clean of already used level chunks</p></li><li style="list-style-type: disc"><p>
<code class="literal">RemoveAllPieces</code>, to cleanse the level of all chunks</p></li><li style="list-style-type: disc"><p>
<code class="literal">GenerateInitialPieces</code>, to generate a few pieces straightaway when the game starts</p></li></ul></div><p>Don't panic! I promise to go <a id="id349" class="indexterm"></a>through this gradually. In fact, most of the statements that we will use in these four basic methods are already well known to you. I have used the term <span class="emphasis"><em>piece</em></span> instead of <span class="emphasis"><em>chunk</em></span>, but these are the same things. Let's stick to <span class="emphasis"><em>piece</em></span> instead of <span class="emphasis"><em>chunk</em></span> in our code.</p><p>Before we get to coding, let's prepare some assets.</p><p>Download and import <code class="literal">LevelPieceBasic.unitypackage</code> into your project. You will notice that the <code class="literal">PlayerPieceBasic</code> prefab has been imported into the <code class="literal">prefabs</code> folder. Drag this prefab into the <span class="strong"><strong>Hierarchy</strong></span> window. Make sure that the entire <code class="literal">PlayerPieceBasic</code> game object in the <span class="strong"><strong>Scene</strong></span> is placed on <code class="literal">GroundLayer</code>. Otherwise, the <code class="literal">Player</code> script won't detect that the player is on the ground. If we get this wrong, the player won't be able to jump.</p><p>At this stage, we will have quite an unorganized project hierarchy. It might be worth giving it a little cleanup. We won't use the <code class="literal">FloorShort</code> and <code class="literal">KillTrigger</code> game objects for a while, so let's delete them. Our <span class="strong"><strong>Hierarchy</strong></span> and <span class="strong"><strong>Scene</strong></span> windows should look more or less like this now:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_03.jpg" /></div><p>Let's take a look at the prefab we just imported. As you can see, there is nothing fancy here. It's just a straight floor piece without any obstacles or holes. It's perfect for a start.</p><p>If you look closely at what's inside <code class="literal">LevelPieceBasic</code>, you will notice a very simple structure, as <a id="id350" class="indexterm"></a>we have mentioned <a id="id351" class="indexterm"></a>before. There are lots of individual floor pieces, <code class="literal">ExitPoint</code>, and <code class="literal">LeaveTrigger</code>. At the moment, we don't have any scripts attached to them.</p><p>The key element for generating the level is knowing the position where the elements will appear. We will use the <code class="literal">ExitPoint</code> world space position for this. I understand that this might sound a bit confusing again. Let's write a very simple piece of code that we will use to manage the <code class="literal">LevelPiece</code> and hold the reference to the <code class="literal">ExitPoint</code> game object.</p><p>Create a new <a id="id352" class="indexterm"></a>C# script, call it <code class="literal">LevelPiece</code>, and add the <code class="literal">exitPoint</code> public member, as shown here:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_04.jpg" /></div><p>That's it! No complicated code here! We are using the <code class="literal">LevelPiece</code> component just to hold the <code class="literal">ExitPoint</code> transform reference.</p><p>Add the <code class="literal">LevelPiece</code> component to the <code class="literal">LevelPieceBasic</code> game object, and assign <code class="literal">ExitPoint</code> by <a id="id353" class="indexterm"></a>dragging and dropping the <code class="literal">ExitPoint</code> game object on top of the slot, as shown in this screenshot:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_05.jpg" /></div><p>You are probably asking yourself, "Why do we need this stuff right now?" Good question! We are just about to build the <code class="literal">LevelGenerator</code> class that will spawn level pieces in the level. The <code class="literal">LevelPiece</code> class will help us manage the pieces that are already in the game and will massively speed up their positioning correctly through the <code class="literal">ExitPoint</code> <a id="id354" class="indexterm"></a>reference. Please <a id="id355" class="indexterm"></a>be patient; everything will become clear to you soon.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec66"></a>Writing LevelGenerator</h3></div></div></div><p>We are ready to <a id="id356" class="indexterm"></a>start writing the level generator. Woohoo! But before we proceed, let's have a recap of what functionality we have <a id="id357" class="indexterm"></a>planned to include.</p><p>We will definitely need to write methods for:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">AddPiece</code>, the level chunk right behind the last level chunk that is already generated</p></li><li style="list-style-type: disc"><p>
<code class="literal">RemoveOldestPiece</code>, to keep Unity free of already used level chunks</p></li><li style="list-style-type: disc"><p>
<code class="literal">RemoveAllPieces</code>, to clean up the level of all chunks</p></li><li style="list-style-type: disc"><p>
<code class="literal">GenerateInitialPieces</code>, to generate few pieces on the game start straightaway</p></li></ul></div><p>Let's create a new script and call it <code class="literal">LevelGenerator</code>. Let's also change the way we talk about new code here. As <code class="literal">LevelGenerator</code> is quite an important class, I want you to understand it fully. That's why we will talk about variables as of now. Later, we will move on to methods.</p><p>Now add the following code to <code class="literal">LevelGenerator</code>:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_06.jpg" /></div><p>I believe you are quite confident with reading this code and have probably spotted that... this code doesn't do anything? Yes, that's correct. The first part of the <code class="literal">LevelGenerator</code> class will store some crucial variables.</p><p>As you can see in <a id="id358" class="indexterm"></a>line <span class="strong"><strong>7</strong></span>, we are declaring a static variable. You already know that we need this static variable for easy access using the <a id="id359" class="indexterm"></a>singleton approach.</p><p>Lines <span class="strong"><strong>8</strong></span>, <span class="strong"><strong>9</strong></span>, and <span class="strong"><strong>10</strong></span> declare some useful variables:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">levelPrefabs</code>: This is the list of all already prepared level pieces. We will store all different level pieces that we want the generator to copy from.</p></li><li style="list-style-type: disc"><p>
<code class="literal">levelStartPoint</code>: This is a transform. We will plug in a game object in the scene that we will use to describe where the level is starting. In simple words, this is the position of the very first level piece in the level.</p></li><li style="list-style-type: disc"><p>
<code class="literal">pieces</code>: This is another list of level pieces. We will use this variable to store all level pieces that are in the game at the time.</p></li></ul></div><p>What is the difference between the <code class="literal">levelPrefabs</code> and <code class="literal">pieces</code> variables? Basically the <code class="literal">levelPrefabs</code> elements are our blueprints. Every time we ask the generator to add a new piece to the level, the generator will randomly pick one prefab (<code class="literal">blueprint</code>), make a copy of it, place it in the scene, and add this copied level piece at the end of the <code class="literal">pieces</code> list. So, remember that the <code class="literal">levelPrefabs</code> list won't change during the gameplay. The <code class="literal">pieces</code> list, however, will constantly change as the player progress through the level.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"></a>Note</h3><p>Remember to use the <code class="literal">System.Collections.Generic</code> namespace if you want to use the C# List&lt;T&gt;.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec67"></a>Commenting on your code</h3></div></div></div><p>We just mentioned <a id="id360" class="indexterm"></a>some very useful information about variables. Right now, it's really easy to come back to the code, look at the lines, and know what line is doing what. In the near future, however, you will notice how easy it is to get lost in the code. We are all human, and we do forget stuff very often. That's why it is a very good practice to comment on your code.</p><p>Comments are fragments of code that the compiler skips. The computer isn't really interested in anything written there; the comments are for the developer. In other words, comments are for you and other developers reading your code.</p><p>To add the simplest comment into your code in C#, you simply have to add two forward-facing slashes, followed by the comment text.</p><p>Let's add some comments into <code class="literal">LevelGenerator</code> now to make our life easier in the future, as follows:</p><div class="mediaobject"><img src="/graphics/9781787127272/graphics/B04245_11_07.jpg" /></div><p>This looks much <a id="id361" class="indexterm"></a>better. It's much easier to look at this code now and know exactly what we are planning to do.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"></a>Note</h3><p>From now on, we will try to comment on code as much as possible.</p></div></div></div>