<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec59"></a>Animation using iTween</h2></div></div><hr /></div><p>Currently, our game's menus are completely static. This is functional, but does not make players excited about playing our game. To make the game seem more alive, we should animate our menus. <span>Being</span> able to use Unity's built-in animation system is great, and it can be quite useful if you want to modify many different properties at once. If you don't need precise control, if you're only modifying a single property, or if you want to animate something purely via code you can also make use of a tweening library. If it is given a start and an end, the library will take care of all the work in the middle to get that property to that end within the time and speed you specify.</p><p>One of my favorite tweening libraries is PixelPlacement's iTween,  which is open source and usable for free in commercial and noncommercial projects.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec18"></a>iTween setup</h3></div></div></div><p>Now that we know we want to add tweens to our project, let's start off by actually adding it to our project:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the <strong class="userinput"><code>Asset Store</code></strong> tab by going to <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Asset Store</code></strong>. Type in <code class="literal">iTween</code> in the search bar at the top and then press <strong class="userinput"><code>Enter</code></strong>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/a54b5c51-8fab-4aca-9954-93b829727ca2.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>If the <strong class="userinput"><code>Asset Store</code></strong> tab is too small for you, like it is here, feel free to drag it out of the middle section and resize until it looks nice for you.</li><li>From there, you'll be brought to a list of items with the first one being iTween; select it, and you will be brought to iTween's product page. Click on the <strong class="userinput"><code>Download</code></strong> button:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/040704a1-ca51-4c5b-8ebd-611893ff285a.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li><p>From there, you'll be asked to log in to your Unity account, which you created when you installed Unity. If you don't have one, feel free to click on <strong class="userinput"><code>Create Account</code></strong> and do so. Once logged in, click on <strong class="userinput"><code>Download</code></strong> once again, and if it doesn't happen automatically, click on the <strong class="userinput"><code>Import</code></strong> button.</p></li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>You should see an <strong class="userinput"><code>Import Unity Package</code></strong> window pop up; from there, you can check or uncheck whatever files you want to keep. We will just use <code class="literal">iTween.cs</code> here; however, the others may be useful to you, should you wish to use them on your own. Once you're finished selecting what you want, click on the <strong class="userinput"><code>Import</code></strong> button:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/5ce49b62-d0d7-409d-a849-5e7ddceb604c.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li><p>We don't need the <strong class="userinput"><code>Asset Store</code></strong> tab anymore, so go ahead and close it. You'll notice that now we have the files we have selected inside our <strong class="userinput"><code>Project</code></strong> tab in the <code class="literal">Assets/Plugins/Pixelplacement/iTween</code> folder:</p></li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/c70dbd53-90f5-4f8f-beae-5611e1bf1ee8.png" /></div><p>With that, we now have iTween set up.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec19"></a>Creating a Simple Tween</h3></div></div></div><p>Now that we have iTween included in our project, we can use it inside of our code; to do that, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From the Unity Editor, open the <strong class="userinput"><code>MainMenu</code></strong> level by going to the <strong class="userinput"><code>Project</code></strong> window and double-clicking on the <strong class="userinput"><code>MainMenu</code></strong> scene.</li><li>Now, move to the <code class="literal">Scripts</code> folder and open the <code class="literal">MainMenuBehaviour</code> by double-clicking on it.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Firstly, we will add the following new function, which we will use:</li></ol></div><pre class="programlisting">/// &lt;summary&gt; 
/// Will move an object from the left side of the screen 
/// to the center 
/// &lt;/summary&gt; 
/// &lt;param name="obj"&gt;The UI element we would like to 
/// move&lt;/param&gt; 

public void SlideMenuIn(GameObject obj) 
{ 
   obj.SetActive(true);
   var rt = obj.GetComponent&lt;RectTransform&gt;(); 

   // Set the object's position offscreen 
   var pos = rt.position; pos.x = -rt.rect.width; rt.position = pos; 

   // Move the object to the center of the screen 
   iTween.MoveTo(obj, iTween.Hash("x", Screen.width / 2, 
                                  "easeType", "easeInOutExpo", 
                                  "time", 1.5f )); 
}</pre><p>Before we move anything using iTween, we will first set the position of our object (the <code class="literal">obj</code> parameter) off-screen by setting the <code class="literal">x</code> position. It's important to note that when dealing with UI elements in Unity, by default, we are dealing with Screen space, which as you can recall from <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Mobile Input/Touch Controls</em></span>, means means that the position (0,0) is the bottom left of the screen and (<code class="literal">Screen.width</code>, <code class="literal">Screen.height</code>) is the top right.
From here, we'll see that we are calling the <code class="literal">MoveTo</code> function from iTween. This takes in two parameters, the first being the object we wish to move and the second being a <code class="literal">Hash</code> or hash table, which is a data structure that creates an associative array such that certain keys will be mapped to certain values. In iTween, their implementation takes in sets of twos with the first being a property and the second being the value we want it to be.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note85"></a>Note</h3><p>For more information on hash tables, check out <span><a class="ulink" href="http://en.wikipedia.org/wiki/Hash_table" target="_blank">http://en.wikipedia.org/wiki/Hash_table</a>.</span>
For more information on getting started with iTween, check out <a class="ulink" href="http://itween.pixelplacement.com/gettingstarted.php" target="_blank"><span>http://itween.pixelplacement.com/gettingstarted.php</span></a>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now that we have this function, let's actually call it. In the <code class="literal">Start</code> function of the <code class="literal">MainMenuBehaviour</code> script, change it so that it now looks as follows:</li></ol></div><pre class="programlisting">virtual protected void Start()
{
    // Initialize the showAds variable
    UnityAdController.showAds = (PlayerPrefs.GetInt("Show Ads", 1) 
                                == 1);

<span class="strong"><strong>if (facebookLogin != null)</strong></span>
<span class="strong"><strong>    {</strong></span>
<span class="strong"><strong>       SlideMenuIn(facebookLogin);</strong></span>
<span class="strong"><strong>    }</strong></span>

<span class="strong"><strong>    // Unpause the game if needed</strong></span>
<span class="strong"><strong>    Time.timeScale = 1;</strong></span>
 }</pre><p>The first thing we do is bring in the Facebook login menu to the screen by calling the <code class="literal">SlideMenuIn</code> function, which in turn will tween the menu to the center of the screen. iTween, by default, makes use of the game's <code class="literal">Time.timeScale</code> property to scale movement. When we leave the game from the pause menu and go back to the main menu, the game will still be paused. This ensures that the game will be unpaused by the time we want to slide this menu in. When we start building the pause menu, we'll see how we can make our Tweens work even when the game is paused.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>While the code should work fine without this, iTween suggests that you call the <code class="literal">Init</code> function on all of the objects you'd like to move in the <code class="literal">Awake</code> function before it is used, so we can do that as well. Add the following to the end of the <code class="literal">Awake</code> function:</li></ol></div><pre class="programlisting"> if(facebookLogin != null)
 {
      iTween.Init(facebookLogin);
 }

 if(mainMenu != null)
 {
      iTween.Init(mainMenu);
 }</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Finally, we will next add the ability so that when we select a button to go to another menu we will have the current menu slide out:</li></ol></div><pre class="programlisting">/// &lt;summary&gt; 
/// Will move an object from the center of the screen 
/// to the right 
/// &lt;/summary&gt; 
/// &lt;param name="obj"&gt;The UI element we would like to 
/// move &lt;/param&gt; 

public void SlideMenuOut(GameObject obj) 
{ 
   var rt = obj.GetComponent&lt;RectTransform&gt;(); 

   // Set the object's position offscreen 
   var pos = rt.position; pos.x = Screen.width / 2; rt.position = pos; 

   // Move the object to the center of the screen 
   iTween.MoveTo(obj, iTween.Hash("x", Screen.width + (rt.rect.width), 
                                  "easeType", "easeOutQuad", 
                                  "time", 1.5, 
                                  "oncomplete", "OnHidden", 
                                  "oncompletetarget", gameObject, 
                                  "oncompleteparams", obj )); 
}</pre><p>Note that this is similar to the previously written function, except now we are also using some new parameters; let's also add in the <code class="literal">OnHidden</code> function that we are using in the preceding script to be called when the tween finishes:</p><pre class="programlisting">void OnHidden(object obj) 
{
   GameObject go = obj as GameObject; 
   if(go != null) 
   {
      go.SetActive(false); 
   }
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Then, we will need to update the <code class="literal">ShowMainMenu</code> function to actually display the menus:</li></ol></div><pre class="programlisting">public void ShowMainMenu()
{
  if (facebookLogin != null &amp;&amp; mainMenu != null)
  {
<span class="strong"><strong>mainMenu.SetActive(true);</strong></span>
<span class="strong"><strong>     SlideMenuIn(mainMenu);</strong></span>
<span class="strong"><strong>     SlideMenuOut(facebookLogin);</strong></span>

<span class="strong"><strong>     // No longer needed as menus will be animating</strong></span>
<span class="strong"><strong>     //facebookLogin.SetActive(false);</strong></span>
<span class="strong"><strong>     //mainMenu.SetActive(true);</strong></span>

    if (FB.IsLoggedIn)
    {
       // Get information from Facebook profile
       FB.API("/me?fields=name", HttpMethod.GET, SetName);
       FB.API("/me/picture?width=256&amp;height=256", 
              HttpMethod.GET,   SetProfilePic);
    }
  }
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Save the script and dive back into the game:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/d17056ca-de43-4a85-a732-fb758490dec0.png" /></div><p>As you can see, the menus will not fly in and out when in the main menu.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note86"></a>Note</h3><p>You can find a list of all of the possible parameters you can pass in to these functions at <span><a class="ulink" href="http://www.pixelplacement.com/itween/documentation.php" target="_blank">http://www.pixelplacement.com/itween/documentation.php</a>.</span></p></div></div></div>