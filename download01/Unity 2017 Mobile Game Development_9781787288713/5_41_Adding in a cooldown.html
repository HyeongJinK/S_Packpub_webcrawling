<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec37"></a>Adding in a cooldown</h2></div></div><hr /></div><p>Ads are great for developers; however, according to Unity's Monetization FAQs, each user is only able to view 25 ads per day. With that in mind, we will likely want to make it so that players can only trigger ads every once in a while. This also has the benefit of making players want to come back to our game after a period of time.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note55"></a>Note</h3><p>For more information on Unity's Monetization FAQs, check out <a class="ulink" href="https://unityads.unity3d.com/help/faq/monetization" target="_blank"><span>https://unityads.unity3d.com/help/faq/monetization</span></a>.</p></div><p>We will now program it so that our Continue option will only work once in awhile, perhaps with a short delay that we can easily customize if we'd like:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>To get started, let's dive into our <code class="literal">UnityAdController</code> script. We need to add a new variable to it, as you can see in the following highlighted code:</li></ol></div><pre class="programlisting"><span class="strong"><strong>using System; // DateTime</strong></span>
using UnityEngine;

#if UNITY_ADS // Can only compile ad code on support platforms 

using UnityEngine.Advertisements; // Advertisement 

#endif

public class UnityAdController : MonoBehaviour
{

<span class="strong"><strong>    // Nullable type </strong></span>
<span class="strong"><strong>    public static DateTime? nextRewardTime = null;</strong></span>


    public static void ShowAd()
    {
        // Rest of function below....</pre><p>The <code class="literal">nextRewardTime</code> variable is of the <code class="literal">DateTime</code>  type, which we haven't talked about previously. Basically, it's a structure that represents a point in time where we can compare it to other times and it's built into the .NET framework. We'll use this to store the time (if any) that needs to pass before the player is able to play another ad. Note that <code class="literal">DateTime</code> is part of the System namespace. That is why we added the <code class="literal">using System;</code>  line in the preceding code as well.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note56"></a>Note</h3><p>For more information on the <code class="literal">DateTime</code> class check out: <a class="ulink" href="https://msdn.microsoft.com/en-us/library/system.datetime(v=vs.110).aspx" target="_blank"><span>https://msdn.microsoft.com/en-us/library/system.datetime(v=vs.110).aspx</span></a>.</p></div><p>You may notice the <code class="literal">?</code> next to the type of this variable. When we do this, we create what's called a nullable type. The advantage of using them is that they can be null in addition to having normal values. We do this so that we don't have to fill in a default value just for the sake of having one.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note57"></a>Note</h3><p>For more information on nullable types, check out <span><a class="ulink" href="https://www.tutorialspoint.com/csharp/csharp_nullables.htm" target="_blank">https://www.tutorialspoint.com/csharp/csharp_nullables.htm</a></span>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>We also need to update the <code class="literal">ShowRewardAd()</code> function as follows:</li></ol></div><pre class="programlisting">public static void ShowRewardAd() 
{ 
    #if UNITY_ADS 
 
<span class="strong"><strong>    nextRewardTime = DateTime.Now.AddSeconds(15);</strong></span> 
 
    if (Advertisement.IsReady()) 
    { 
        // Pause game while ad is shown 
        PauseMenuBehaviour.paused = true; 
        Time.timeScale = 0f; 
 
        var options = new ShowOptions { resultCallback =   
        HandleShowResult }; 
        Advertisement.Show(options); 
    } 
 
    #endif 
} </pre><p>Now when we show a reward ad, we set <code class="literal">nextRewardTime</code> to 15 seconds from when the function is called. Of course, we can just as easily set this to minutes or hours using the <code class="literal">AddMinutes</code> and <code class="literal">AddHours</code> functions.</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Save your script and then open up the <code class="literal">ObstacleBehaviour</code> script. To start off with, we'll use two new types, so we will need to add the following new using statements to our script:</li></ol></div><pre class="programlisting">using System; // DateTime
using System.Collections; // IEnumerator</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Afterward, <span>we will need to modify</span> the bottom part of the  <code class="literal">RestartGame()</code> function to have the following bolded changes:</li></ol></div><pre class="programlisting">        // Rest of RestartGame above...

        if (continueButton)
        {
            #if UNITY_ADS
            // If player clicks on button we want to play ad and
            // then continue
<span class="strong"><strong>            StartCoroutine(ShowContinue(continueButton));</strong></span>
            #else
            // If can't play an ad, no need for continue button
            continueButton.gameObject.SetActive(false);
            #endif
        }
}</pre><p>Now, instead of just adding a listener to this button, we have replaced it with calling a <code class="literal">StartCoroutine</code> function, which takes in a function that we haven't written yet, but will get to in a second. I think it's probably a good idea to talk a little bit about coroutines first.</p><p>A coroutine is like a function that has the ability to pause execution and continue where it left off after a period of time. By default, a coroutine is resumed on the frame after we start to <code class="literal">yield</code>, but it is also possible to introduce a time delay using the <code class="literal">WaitForSeconds</code> function for how long you want to wait before it's called again.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>In there, use the following script for the <code class="literal">ShowContinue</code> function:</li></ol></div><pre class="programlisting">public IEnumerator ShowContinue(UnityEngine.UI.Button contButton) 
{ 
    while (true) 
    { 
        var btnText = contButton.GetComponentInChildren&lt;Text&gt;(); 
 
        // Check if we haven't reached the next reward time yet  
        // (if one exists) 
        if (UnityAdController.nextRewardTime.HasValue &amp;&amp;  
            (DateTime.Now &lt;  
                UnityAdController.nextRewardTime.Value)) 
        { 
            // Unable to click on the button 
            contButton.interactable = false; 
 
            // Get the time remaining until we get to the next  
            // reward time 
            TimeSpan remaining = UnityAdController.nextRewardTime.Value 
                            - DateTime.Now; 
 
            // Get the time left in the following format 99:99 
            var countdownText = string.Format("{0:D2}:{1:D2}",  
                                remaining.Minutes,  
                                remaining.Seconds); 
 
            // Set our button's text to reflect the new time 
            btnText.text = countdownText; 
 
            // Come back after 1 second and check again 
            yield return new WaitForSeconds(1f); 
        } 
        else 
        { 
            // It's valid to click the button now 
            contButton.interactable = true; 
 
            // If player clicks on button we want to play ad and  
            // then continue 
        contButton.onClick.AddListener(UnityAdController.ShowRewardAd); 
            UnityAdController.obstacle = this; 
 
            // Change text to its original version 
            btnText.text = "Continue (Play Ad)"; 
 
            // We can now leave the coroutine 
            break; 
        } 
    } 
         
} </pre><p>This coroutine will do a number of things, starting off by entering a <code class="literal">while (true)</code> loop. Now, usually, this is a very bad thing, as it would cause an infinite loop, but we break out of the loop if we have no reward time set or if we've passed the time set in the <code class="literal">nextRewardTime</code> variable. If not, we will figure out how much time is left before that time has passed and will change the button's text to display it. We then use the <code class="literal">WaitForSeconds</code> function to pause execution and come back after 1 second has passed.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note58"></a>Note</h3><p>If you're interested in learning more about the behind the scenes aspects of how coroutines work, <span class="emphasis"><em>Cyrill Nadezhdin</em></span> has written a neat article on it at <a class="ulink" href="http://blog.nadezhdin.org//articles/Unity-coroutines-demystified" target="_blank"><span>http://blog.nadezhdin.org//articles/Unity-coroutines-demystified</span></a>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Save all of our scripts and dive back into Unity and play the game:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/5507dab7-aa99-4bf8-9013-76c505edd87d.png" /></div><p>Upon restarting the game once, you'll see that if we try to do so again we are brought to a delay screen. After the time gets down to 0, the player will then be able to continue once again.</p></div>