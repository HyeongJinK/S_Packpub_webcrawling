<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec54"></a>Tracking custom events</h2></div></div><hr /></div><p>Unity Analytics does a number of different things automatically to make it easy to work with; however, as a game designer, you may often want to check whether certain aspects of the game are being used or whether players are reaching certain pieces of content. To keep a track on this, we can make use of the <span class="strong"><strong>Custom Events</strong></span> system.</p><p>Custom Events are pieces of data that users send to the cloud as they play the game. Each custom event can have its own parameters, which will allow us to filter the data that we send when it occurs.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec15"></a>Using the AnalyticsTracker component</h3></div></div></div><p>Now, one of the simplest ways to track when something occurs is through the editor itself, making use of the <strong class="userinput"><code>Analytics Tracker (Script)</code></strong> component. For example, perform the following steps when you want to track whether players are using the Pause menu.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the Gameplay scene by going to the <strong class="userinput"><code>Project</code></strong> window and then to the <code class="literal">Assets\Scenes</code> folder. From there, double-click on the <strong class="userinput"><code>Gameplay</code></strong> scene.</li><li>From the <strong class="userinput"><code>Hierarchy</code></strong> window, expand the <strong class="userinput"><code>Canvas</code></strong> object. From there, select <strong class="userinput"><code>Pause Menu</code></strong>.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>From the top bar, select <strong class="userinput"><code>Component</code></strong> | <strong class="userinput"><code>Analytics</code></strong> | <strong class="userinput"><code>AnalyticsTracker</code></strong> to add the component to our selected game object:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/467f2987-a320-4111-b533-c20ec193a3b1.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Next, we will need to come up with an <strong class="userinput"><code>Event Name</code></strong> to use. In this case, I used <code class="literal">Paused</code>. Then, under <strong class="userinput"><code>Trigger</code></strong>, select the dropdown and the <strong class="userinput"><code>On Enable</code></strong> option.</li></ol></div><p>This means that if we turn on the pause menu (or rather when it is enabled), an event will be sent. Note that this is different from the <code class="literal">On Start</code> event due to that event only happening once when it is initially turned on.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Now, start the game and then pause the game. If you go to the <strong class="userinput"><code>Services</code></strong> tab and open up <strong class="userinput"><code>Analytics</code></strong>, you should note from the <strong class="userinput"><code>Validator</code></strong> that a new event has been added:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/9b919dc2-4459-494d-bf80-c978b3bbb95d.png" /></div><p>In addition to seeing this data in the <strong class="userinput"><code>Services</code></strong> tab, we can also see it in the dashboard.</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Go ahead and scroll up in the <strong class="userinput"><code>Services</code></strong> tab and select the <strong class="userinput"><code>Go to Dashboard</code></strong> button on the top-right portion of the tab. From there, click on the <strong class="userinput"><code>Data Explorer</code></strong> option.</li><li>From the <strong class="userinput"><code>Data Explorer</code></strong> tab, you'll see a section for <strong class="userinput"><code>Metrics and Custom Events</code></strong>. You'll also see a chart that shows the <strong class="userinput"><code>DAU</code></strong> (<strong class="userinput"><code>Daily Active Users</code></strong>) that have been playing your project. We can use this menu to observe whenever the <strong class="userinput"><code>Paused</code></strong> event is called.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip77"></a>Note</h3><p>If you have just created the event, it may take up to 12 hours for the information to be received. Go ahead and check back later whether that's the case.</p></div><p></p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Click on the + button to the left of <strong class="userinput"><code>Custom Even</code></strong><strong class="userinput"><code>t</code></strong> to add a Custom Event to this graph. Then, select the <strong class="userinput"><code>Custom Event</code></strong> dropdown and select <strong class="userinput"><code>Paused</code></strong>. Since we have just made the event, we won't see it in previous dates in Analytics, but we can see it a little easier if we click on the <strong class="userinput"><code>Column Chart</code></strong> button to change how the data is displayed:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/239f1c52-1250-4c09-a9ed-497022493b78.png" /></div><p><span>Notice that when we scroll down we can see that the </span><strong class="userinput"><code>Data Explorer</code></strong> now shows that the Paused event has been called!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note78"></a>Note</h3><p>In addition to the calling event, you can also add parameters to the events in a similar manner to how Unity's UI system works. For more information on that and the Analytics Tracker component, check out <a class="ulink" href="https://docs.unity3d.com/Manual/UnityAnalyticsAnalyticsTracker.html" target="_blank"><span>https://docs.unity3d.com/Manual/UnityAnalyticsAnalyticsTracker.html</span></a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec16"></a>Customizing events through code</h3></div></div></div><p>It's great to have a way to do the events through the editor, but for those who are more comfortable working with code, it's also just as easy to do so.</p><p>One additional thing that we may want to track is how far players get before they lose. Let's take a look at how to do that now:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, we will need to open up the <code class="literal">ObstacleBehaviour</code> script to modify what happens when the game ends.</li><li>To utilize Unity Analytics at the top of the file, we will add the following using declarations:</li></ol></div><pre class="programlisting">using UnityEngine.Analytics; // Analytics
using System.Collections.Generic; // Dictionary</pre><p>The top option is obvious, but we are also adding <code class="literal">System.Collections.Generic</code> in order to get access to the <code class="literal">Dictionary</code> class, which we will use in the next piece of code.</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Next, we will update the <code class="literal">OnCollisionEnter</code> function to the following:</li></ol></div><pre class="programlisting">    void OnCollisionEnter(Collision collision)
    {
        var playerBehaviour = 
        collision.gameObject.GetComponent&lt;PlayerBehaviour&gt;();

        // First check if we collided with the player 
        if (playerBehaviour != null)
        {
            // Destroy the player 
            collision.gameObject.SetActive(false);

            player = collision.gameObject;

            var eventData = new Dictionary&lt;string, object&gt;
            {
                { "score", playerBehaviour.Score }
            };

            Analytics.CustomEvent("Game Over", eventData);

            // Call the function ResetGame after waitTime has passed 
            Invoke("ResetGame", waitTime);
        }
    }</pre><p>We've done a number of things within this script. To start off with, we have rewritten our check for the player to use the component as a variable now so that we don't have to call <code class="literal">GetComponent</code> again for the same thing.</p><p>Aside from that, the main addition is the calling of the <code class="literal">Analytics.SendEvent</code> function. This function takes in two parameters. The first is a string, which is the name that you wish for the event to have. The second parameter (which is optional) is a dictionary, which we haven't discussed yet.</p><p>A <span class="strong"><strong>dictionary</strong></span> is a class that represents a pair of keys and values. The key is an identifier of some sort, which allows us to have a reference to obtain the value. This is most often used with strings as the key so that you can refer to some other data type.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note79"></a>Note</h3><p>For more information on dictionaries, check out <span><a class="ulink" href="http://csharp.net-informations.com/collection/dictionary.htm" target="_blank">http://csharp.net-informations.com/collection/dictionary.htm</a>.</span></p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Save the script and return to the Unity Editor.</li><li>Play the game and lose it. You will note in the <strong class="userinput"><code>Validator</code></strong> that now you are sending a Game Over event with your score value:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/f0293246-4397-4639-99dc-d2fcba1df066.png" /></div><p>You may also dive into the Dashboard to see the information as well, but it may take up to <span>6 hours</span> before it will be visible. Events typically take a few hours to cycle. You will see them instantly on the <strong class="userinput"><code>Validator</code></strong> (to help you confirm that your code is working), but they don't populate into analytics until backend calculations have been processed on Unity's end due to all of the events they recieve.</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>After you've waited, go ahead to the <strong class="userinput"><code>Analytics</code></strong> tab and click on the <strong class="userinput"><code>Go to Dashboard</code></strong> button once again.</li></ol></div><p>We can use the <strong class="userinput"><code>Data Explorer</code></strong> like previously, but, in our case, we may just want to see all of the data from times it was called. For that, we can make use of the <strong class="userinput"><code>Event Manager</code></strong>.</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Once there, go to the <strong class="userinput"><code>More</code></strong> tab and click on it. From the dropdown that pops up, click on <strong class="userinput"><code>Event Manager</code></strong>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/11c9dacc-ef62-42a2-a568-1d5d3315407d.png" /></div><p>The <strong class="userinput"><code>Event Manager</code></strong> is the location where users can see the custom events that were received from users playing the game as well as the parameters that were passed to them.</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Scroll down to the <strong class="userinput"><code>Custom Events</code></strong> header--you'll see a list of all of them under it, with the <strong class="userinput"><code>Paused</code></strong> option and the <strong class="userinput"><code>Game Over</code></strong> event created in this section:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787288713/graphics/6e6c74d7-079e-4139-ba0b-6cf65468f5d5.png" /></div><p>If you click on the dropdown, you should be able to see the score property, and clicking on that will show all the values received whenever it was called.</p><p>Instead of a single value, we can pass up to 10 parameters into the dictionary. However, the value must be one of the following types:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">bool</code></li><li style="list-style-type: disc"><code class="literal">string</code></li><li style="list-style-type: disc"><code class="literal">int</code></li><li style="list-style-type: disc"><code class="literal">float</code></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip80"></a>Note</h3><p>Remember that you can always convert an object to a string in C# using the <code class="literal"><span>ToString</span></code> function.</p></div><p>You can only send 100 custom events per hour per user, so you should not be doing too many custom events in the game. I suggest that you create custom events for whenever a user reaches an important milestone, for example, when they level up or if they make an  <span class="strong"><strong>In-App Purchase</strong></span> (<span class="strong"><strong>IAP</strong></span>).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note81"></a>Note</h3><p>For more information on <code class="literal">Analytics.CustomEvent</code> and other ways it can be called, check out <span><a class="ulink" href="https://docs.unity3d.com/ScriptReference/Analytics.Analytics.CustomEvent.html" target="_blank">https://docs.unity3d.com/ScriptReference/Analytics.Analytics.CustomEvent.html</a>.</span></p></div></div></div>