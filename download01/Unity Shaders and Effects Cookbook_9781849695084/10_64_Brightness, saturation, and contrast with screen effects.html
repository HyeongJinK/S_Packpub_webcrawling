<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec61"></a>Brightness, saturation, and contrast with screen effects</h2></div></div><hr /></div><p>Now that we have our screen effects system up and running, we can begin to learn how to create more involved pixel operations to perform some of the more common screen effects found in games today.</p><p>Using a screen effect to adjust the overall final colors of your game is crucial in giving artists a final global control over the final look of the game. Techniques such as color adjustment sliders to adjust the intensity for the reds, blues, and greens of the final rendered game, or techniques such as putting a certain tone of color over the whole screen as seen in something like a sepia film effect.</p><p>For this<a id="id562" class="indexterm"></a> particular<a id="id563" class="indexterm"></a> recipe we are <a id="id564" class="indexterm"></a>going to cover some of the more core color adjustment operations we can perform on an image. These are brightness, saturation, and contrast. Learning how to code these color adjustments gives us a good base for learning the art of screen effects.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec159"></a>Getting ready</h3></div></div></div><p>To begin we are going to need to create a couple of new assets. We can utilize the same scene as our test scene, but we will need a new script and a new Shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script and call it <code class="literal">BSC_ImageEffect</code>.</p></li><li><p>Create a new Shader called <code class="literal">BSC_Effect</code>.</p></li><li><p>Now we simply need to copy the code we had from the C# script, in the previous recipe, into our new C# script. This will allow us to just focus on the math for the brightness, saturation, and contrast effects.</p></li><li><p>Copy the code from the Shader in the previous recipe into our new Shader.</p></li><li><p>Create a couple of new objects in the scene and set up some different colored diffuse materials and randomly assign them to the new objects in the scene. This will give us a good range of colors to test our new screen effect.</p></li></ol></div><p>When completed, you should have a scene similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_14.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec160"></a>How to do it…</h3></div></div></div><p>Now that we <a id="id565" class="indexterm"></a>have completed our scene setup and have created our<a id="id566" class="indexterm"></a> new script and Shader. We can begin to fill in the<a id="id567" class="indexterm"></a> code necessary to achieve brightness, saturation, and a contrast screen effect. We will be focusing on just the pixel operation and variable setup for our script and Shader, as getting a screen effect system up and running is described in the previous recipe:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's begin by launching our new Shader and new script into MonoDevelop. Simply double-click on the two files in the project view to perform this action.</p></li><li><p>Editing the Shader first makes more sense so that we know what kinds of variables we will need for our C# script. Let's begin this by entering in the appropriate properties for our brightness, saturation, and contrast effect. Remember, we need to keep the <code class="literal">_MainTex</code> property in our Shader as that is the property the render texture targets when creating screen effects.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_15.jpg" /></div></li><li><p>As <a id="id568" class="indexterm"></a>usual, in order for us to access the data<a id="id569" class="indexterm"></a> coming in from our properties into our <code class="literal">CGPROGRAM</code> statement, we need to<a id="id570" class="indexterm"></a> create the corresponding variables in the <code class="literal">CGPROGRAM</code> statement:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_16.jpg" /></div></li><li><p>Now we need to create the operations that will perform the brightness, saturation, and contrast effects. Enter the following new function into our Shader just above the <code class="literal">frag()</code> function. Don't worry if it doesn't make sense just yet; all the code will be explained in the next section:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_17.jpg" /></div></li><li><p>Finally, we<a id="id571" class="indexterm"></a> just need to update our <code class="literal">frag()</code> function to actually use the <code class="literal">ContrastSaturationBrightness()</code> function. This will process all the pixels of our render texture and pass it back to our script:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_18.jpg" /></div></li></ol></div><p>With the code<a id="id572" class="indexterm"></a> entered into the Shader, return to the Unity editor to <a id="id573" class="indexterm"></a>let the new Shader compile. If there are no errors, we can return to MonoDevelop to work on our script. Let's begin this by creating a couple new lines of code that will send the proper data to our Shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Our first step in modifying our script is to add the proper variables that will drive the values of our screen effect. In this case we will need a slider for brightness, a <a id="id574" class="indexterm"></a>slider for saturation, and a slider for contrast:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_19.jpg" /></div></li><li><p>With our <a id="id575" class="indexterm"></a>variables set up, we now need to tell the <a id="id576" class="indexterm"></a>script to pass their data to the Shader. We do this in the<a id="id577" class="indexterm"></a> <code class="literal">OnRenderImage()</code> function:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_20.jpg" /></div></li><li><p>Finally, all we need to do is clamp the values of the variables within a range that is reasonable. These clamp values are entirely by preference, so you can use whichever values you see fit:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_21.jpg" /></div></li></ol></div><p>With the script completed and the Shader finished up, we simply assign our script to our main camera and our Shader to the script, and you should see the effects of brightness, saturation, and <a id="id578" class="indexterm"></a>contrast by manipulating the slider values. The <a id="id579" class="indexterm"></a>following image shows a result you can <a id="id580" class="indexterm"></a>achieve with this screen effect:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_22.jpg" /></div><p>The following image shows another example of what can be done by adjusting the colors of the render image:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_23.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec161"></a>How it works…</h3></div></div></div><p>Since<a id="id581" class="indexterm"></a> we now know how the basic screen effects system works, let's just cover the per-pixel operations we created in the<a id="id582" class="indexterm"></a> <code class="literal">ContrastSaturationBrightness()</code> function.</p><p>The<a id="id583" class="indexterm"></a> function starts by taking in a few arguments. The <a id="id584" class="indexterm"></a>first and most important is the current render texture. The other arguments simply adjust the overall effect of the screen effect, and are represented by sliders in the screen effects section in the <span class="strong"><strong>Inspector</strong></span> tab. Once the function receives the render texture and the adjustments values, it declares a few constant values that we use to modify and compare against the original render texture.</p><p>The <code class="literal">luminanceCoeff</code> variable<a id="id585" class="indexterm"></a> is storing the values that will give us the overall brightness of the current image. These coefficients are based on the CIE color matching functions and are pretty standard throughout the industry. We can find the overall brightness of the image by getting the dot product of the current image dotted with these luminance coefficients. Once we have the brightness, we simply use a couple of <code class="literal">lerp</code> functions to blend from the grayscale version of the brightness operation, and have the original image multiplied by the brightness value being passed into the function.</p><p>Screen effects like this one are crucial to achieving high quality graphics for your games, as they let lets you tweak the final look of your game without having to edit each Material in your current game scene.</p></div></div>