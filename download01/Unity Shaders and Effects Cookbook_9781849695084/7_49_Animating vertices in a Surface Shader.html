<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec49"></a>Animating vertices in a Surface Shader</h2></div></div><hr /></div><p>Now that we know <a id="id459" class="indexterm"></a>how to access data on a per-vertex basis, let's<a id="id460" class="indexterm"></a> expand our knowledge set to include other types of data, and the position of a vertex.</p><p>Using a vertex function, we can access the position of each vertex in a mesh. This allows us to actually modify each individual vertex, while the Shader does the processing.</p><p>In this recipe we will create a Shader that will allow us to modify the positions of each vertex on a mesh with a sine wave. This technique can be used to create animations for objects such as flags or the waves on an ocean.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec131"></a>Getting ready</h3></div></div></div><p>Let's gather our assets together so we can create the code for our vertex shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new scene and place a plane mesh in the center of the scene.</p></li><li><p>Then create a new Shader and Material.</p></li><li><p>Finally, assign the Shader to the Material, and the Material to the plane mesh.</p></li></ol></div><p>Your scene should look similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_09.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec132"></a>How to do it…</h3></div></div></div><p>With our scene ready to go, let's double-click on our newly created Shader to open it up in MonoDevelop:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's begin with our Shader by populating the <code class="literal">Properties</code> block:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_10.jpg" /></div></li><li><p>We now need to tell Unity that we are going to be using a vertex function by adding to the <code class="literal">#pragma</code> statement:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_11.jpg" /></div></li><li><p>In <a id="id461" class="indexterm"></a>order to access the values that have been given to <a id="id462" class="indexterm"></a>us by our properties, we need to declare a corresponding variable in our <code class="literal">CGPROGRAM</code> block:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_12.jpg" /></div></li><li><p>We are going to be using the vertex position modification as a <code class="literal">vert</code> color as well. This will allow us to tint our object:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_13.jpg" /></div></li><li><p>At this point, we can perform our vertex modification using a sine wave and the vertex function. Enter the following code after the <code class="literal">Input</code> struct:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_14.jpg" /></div></li><li><p>Finally, we <a id="id463" class="indexterm"></a>complete our Shader by <a id="id464" class="indexterm"></a>performing a <code class="literal">lerp</code> function between two colors, so we can tint the peaks and valleys of our new mesh, modified by our vertex function:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_15.jpg" /></div></li></ol></div><p>After completing the code for your Shader, switch back to Unity and let the Shader compile. Once compiled, you should see something similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_07_16.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec133"></a>How it works…</h3></div></div></div><p>This <a id="id465" class="indexterm"></a>particular Shader uses the same <a id="id466" class="indexterm"></a>concept from the last recipe except this time we are modifying the positions of the vertices in the mesh. This is really useful if you don't want to rig up simple objects, such as a flag, and then animate them using a skeleton structure or a hierarchy of transforms.</p><p>We simply create a sine wave value using the<a id="id467" class="indexterm"></a> <code class="literal">sin()</code> function that is built into the Cg language. After calculating that value, we add it onto the <code class="literal">y</code> value of each vertex position, creating a wave-like effect.</p><p>We also did a little bit of modification to the normal on the mesh, just to give it more realistic shading, based on the sine wave value.</p><p>You will start to see how easy it is to perform more complex vertex effects by utilizing the built-in vertex parameters that Surface Shaders give us.</p></div></div>