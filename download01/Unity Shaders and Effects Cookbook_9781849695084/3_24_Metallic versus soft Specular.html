<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec28"></a>Metallic versus soft Specular</h2></div></div><hr /></div><p>In this section, we are going to explore a way to create a Shader that gives us the versatility to have a soft <a id="id198" class="indexterm"></a>Specular as well as a hard Specular. You <a id="id199" class="indexterm"></a>will find in most productions that you will need to create a nice set of Shaders to perform many tasks. As managing too many Shaders can become overwhelming, it is common for Shader programmers to create a set of Shaders that can both be used for cloth and for metal in one Shader file. It's all about how the end user sets the properties on their model. Our goal in this recipe is to achieve this modularity with Specular, so that an end user can get a soft, shiny material and then using the same Shader, achieve a very hard metallic Shader.</p><p>To accomplish this flexibility, we are going to create a similar Specular lighting model to the Cook Torrance Shader, but we will give it our own touch so that it is a bit friendlier for the artist or end user using this Shader.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec67"></a>Getting ready</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a fresh Unity scene and set up a simple sphere, plane, and directional light in the new scene. Make sure to save the scene with a name of your choice.</p></li><li><p>Create a new Shader and Material, and give them names that you decide on.</p></li><li><p>Finally, attach the Shader to the Material and attach the Material to the sphere object in your new scene.</p></li><li><p>We are also going to need to get some textures together that will allow an artist to refine the roughness of the Specular by defining how blurry and how sharp the Specular should be. Refer to the following screenshot for examples on how these textures look.</p></li></ol></div><p>The following<a id="id200" class="indexterm"></a> screenshot visually shows examples of<a id="id201" class="indexterm"></a> different roughness textures used in this recipe:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_48.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec68"></a>How to do it…</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First and foremost, we need to set up the properties we will need for our Shader. Enter the following code into the <code class="literal">Properties</code> block of your Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_49.jpg" /></div></li><li><p>We then need to make sure that the property data is available to our <code class="literal">SubShader</code> block. Enter the following code just after the <code class="literal">#pragma</code> statement in your Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_50.jpg" /></div></li><li><p>We now<a id="id202" class="indexterm"></a> need to declare our <a id="id203" class="indexterm"></a>new lighting model and tell the <code class="literal">#pragma</code> statement to look for it:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_51.jpg" /></div></li><li><p>At this point we are ready to fill in our custom lighting model function with our lighting calculations. We are first going to want to generate all of our diffuse and view dependent vectors, as this lighting model is going to make use of them all.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_52.jpg" /></div></li><li><p>The next section of code in the Shader takes care of producing the roughness values for our Specular, by using a texture to define the Specular shape and to procedurally simulate micro bumps in the surface of the object. Enter the following code:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_53.jpg" /></div></li><li><p>The last<a id="id204" class="indexterm"></a> element we need for <a id="id205" class="indexterm"></a>our Specular calculation is a <span class="strong"><strong>Fresnel</strong></span>
<a id="id206" class="indexterm"></a> term. This will help us mask off the Specular when your view becomes very glancing to the object's surface.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_54.jpg" /></div></li><li><p>Now that we have all the components ready for our Specular, we just need to combine them together to generate our final Specular value.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_55.jpg" /></div></li><li><p>To complete the lighting model, we simply need to add our <code class="literal">Diffuse</code> terms and our <code class="literal">Specular</code> terms together:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_56.jpg" /></div></li></ol></div><p>With all the code entered into your Shader, return to the Unity editor to let the Shader compile. If no errors were reported, you should have a result similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_26.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec69"></a>How it works…</h3></div></div></div><p>Alright…that <a id="id207" class="indexterm"></a>might seem like a lot of stuff going on <a id="id208" class="indexterm"></a>there, but actually it is all pretty simple to understand. You can even debug each step of the Shader's code by assigning <code class="literal">c.rgb</code> with a <code class="literal">float3</code> value. Once you do that, you will see, in the editor view, that the Shader is now displaying the step of whichever calculation you are feeding it; always a good tip to keep in mind when debugging Shaders.</p><p>If we actually debug the first block of code, where we are calculating all of our Diffuse and view dependent vectors, you would see something very similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_57.jpg" /></div><p>Once we have all of this data we need to start to work with it, almost like layers in Photoshop. We start this process by generating a procedural value that simulates small micro bumps in the surface of the object, to fake the effect of light bouncing around and distributing the light.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_58.jpg" /></div><p>One of the <a id="id209" class="indexterm"></a>more key aspects of this <a id="id210" class="indexterm"></a>lighting model is the fact that we control the width of the Specular, or its roughness, by looking up a texture that has a baked-in Specular function. This will allow us to procedurally generate some UVs and pick a spot on the texture to use for our Specular. For this we want to use the <code class="literal">NdotH</code> or the dot product of the half vector and the vertex normal, and feed that into a <code class="literal">float2()</code> variable for the <code class="literal">tex2D()</code> function. This <code class="literal">float2()</code> variable will become our UV that we use to look up our texture. The second value is a property that we exposed in the <span class="strong"><strong>Inspector</strong></span> tab. This allows the user to expand or contract the Specular highlight.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_59.jpg" /></div><p>We then need to create our Fresnel effect, so that when we look in the opposite direction the light is pointing we get an increase in Specular intensity.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_60.jpg" /></div><p>With all of these components completed, we simply want to multiply them together to achieve our final Specular value. In this case, we have also multiplied another property called <code class="literal">_SpecPower</code> to give one more level of intensity control over the final Specular value.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_61.jpg" /></div><p>The last step <a id="id211" class="indexterm"></a>is to combine our Specular <a id="id212" class="indexterm"></a>with the <code class="literal">Diffuse</code> component and return the final color to the Surface Shader. Hopefully, you can see the level of modifications you can make to a simple system just by using other types of vectors and textures.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec70"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>To find out more about the Cook Torrance Specular model, refer to the following links:</p><p>
<a class="ulink" href="http://en.wikipedia.org/wiki/Specular_highlight#Cook.E2.80.93Torrance_model" target="_blank">http://en.wikipedia.org/wiki/Specular_highlight#Cook.E2.80.93Torrance_model</a>
</p><p>
<a class="ulink" href="http://content.gpwiki.org/index.php/D3DBook:%28Lighting%29_Cook-Torrance" target="_blank">http://content.gpwiki.org/index.php/D3DBook:%28Lighting%29_Cook-Torrance</a>
</p><p>
<a class="ulink" href="http://forum.unity3d.com/threads/158589-Cook-Torrance" target="_blank">http://forum.unity3d.com/threads/158589-Cook-Torrance</a>
</p></li></ul></div></div></div>