<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec20"></a>Normal mapping</h2></div></div><hr /></div><p>One of the most common texture techniques used in today's game development pipelines is the use of <a id="id119" class="indexterm"></a>
<span class="strong"><strong>normal maps</strong></span>. These give us the ability to fake the effect of high-resolution geometry on a low-resolution model. This is because instead of performing lighting calculations on a per-vertex level, we are using each pixel in the normal map as a normal on the model, giving us much more resolution on how the lighting should be, while still maintaining the low polygon count of our object.</p><div class="blockquote"><blockquote class="blockquote"><p>In 3D computer graphics, normal mapping, or <a id="id120" class="indexterm"></a>"Dot3 bump mapping", is a technique used for faking the lighting of bumps and dents – an implementation of Bump mapping<a id="id121" class="indexterm"></a>. It is used to add details without using more polygons. A common use of this technique is to greatly enhance the appearance and details of a low polygon model by generating a normal map from a high polygon model or height map.</p><p>Normal maps are commonly stored as regular RGB images where the RGB components corresponds to the X, Y, and Z coordinates, respectively, of the surface normal.</p></blockquote></div><p>The previous text is a quote from Wikipedia (<a class="ulink" href="http://en.wikipedia.org/wiki/Normal_mapping" target="_blank">http://en.wikipedia.org/wiki/Normal_mapping</a>).</p><p>There are many ways to create normal maps these days. Some applications such as <span class="strong"><strong>CrazyBump</strong></span>
<a id="id122" class="indexterm"></a> (<a class="ulink" href="http://www.crazybump.com/" target="_blank">http://www.crazybump.com/</a>) and <span class="strong"><strong>N2DO</strong></span>
<a id="id123" class="indexterm"></a>
<a id="id124" class="indexterm"></a> (<a class="ulink" href="http://quixel.se/ndo/" target="_blank">http://quixel.se/ndo/</a>) will take in 2D data and convert it to normal data for you. Other applications, such as<a id="id125" class="indexterm"></a> <span class="strong"><strong>Zbrush</strong></span> (<a class="ulink" href="http://www.pixologic.com/" target="_blank">http://www.pixologic.com/</a>) and <a id="id126" class="indexterm"></a>
<span class="strong"><strong>Mudbox</strong></span> (<a class="ulink" href="http://usa.autodesk.com" target="_blank">http://usa.autodesk.com</a>), will take 3D sculpted data and create normal maps for you. The actual process of creating normal maps is definitely out of the scope of this book, but the links in the previous text should help you get started.</p><p>Unity makes the process of adding normals to your Shaders quite an easy process within the Surface Shader realm, using the <code class="literal">UnpackNormals()</code> function<a id="id127" class="indexterm"></a>. Let's see how this is done.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec42"></a>Getting ready</h3></div></div></div><p>Create a new Material and Shader and set them up on a new object in the Scene view. This will give us a clean workspace in which we can look at just the normal mapping technique.</p><p>You will need a normal map for this recipe, but there is also one included in the Unity project that is included with this book.</p><p>An example normal map included with this book's contents is shown here:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_22.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec43"></a>How to do it…</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's get <a id="id128" class="indexterm"></a>our <code class="literal">Properties</code> block set up to have a color tint and a texture:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_23.jpg" /></div></li><li><p>Link the properties to the Cg program by declaring them inside the subshader below the <code class="literal">CGPROGRAM</code> statement:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_24.jpg" /></div></li><li><p>We need to make sure that we update the <code class="literal">Input</code> struct with the proper variable name, so that we can use the model's UVs for the normal map texture.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_25.jpg" /></div></li><li><p>Finally, we extract the normal information from the normal map texture by using the built-in <code class="literal">UnpackNormal()</code> function. Then you only have to apply those new normals to the output of the Surface Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_26.jpg" /></div></li></ol></div><p>The following <a id="id129" class="indexterm"></a>image demonstrates the result of our normal map Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_27.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec44"></a>How it works…</h3></div></div></div><p>The actual <a id="id130" class="indexterm"></a>math to perform the normal mapping effect is definitely beyond the scope of this chapter, but Unity has done it all for us already anyway. They have created the functions for us, so that we don't have to keep doing it over and over again. This another reason why Surface Shaders are a really efficient way to write Shaders.</p><p>If you look inside the<a id="id131" class="indexterm"></a> <code class="literal">UnityCG.cginc</code> file, found in the <code class="literal">Data</code> folder in your Unity install directory, you will find the definitions for the <code class="literal">UnpackNormal()</code> function. When you declare this function inside your Surface Shader, Unity takes the provided normal map and processes it for you, and gives you the correct type of data back to you so that you can use it in your per-pixel lighting function. It's a huge time saver!</p><p>Once you have processed the normal map with the <code class="literal">UnpackNormal()</code> function, you send it back to your <code class="literal">SurfaceOutput</code> struct, so that it can be used in the lighting function. This is done by the line <code class="literal">o.Normal = normalMap.rgb;</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec45"></a>There's more…</h3></div></div></div><p>You can also add some controls to your normal map Shader that lets a user adjust the intensity of the normal map. This is easily done by modifying the <code class="literal">x</code> and <code class="literal">y</code> components of the normal map variable, and then adding it all back together.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add another property to the properties block and name it <code class="literal">_NormalMapIntensity</code>, as shown in the following code:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_30.jpg" /></div></li><li><p>Make sure to declare that property inside the <code class="literal">SubShader</code> function:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_31.jpg" /></div></li><li><p>Multiply the <code class="literal">x</code> and <code class="literal">y</code> components of the unpacked normal map and re-apply that value back to the normal map variable. Now you can let a user adjust the intensity of the normal map in the Material <span class="strong"><strong>Inspector</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_32.jpg" /></div></li></ol></div><p>The following image shows the result of modifying the normal map with our scalar values:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_02_29.jpg" /></div></div></div>