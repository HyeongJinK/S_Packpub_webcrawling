<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec30"></a>Creating Cubemaps in Unity3D</h2></div></div><hr /></div><p>In order for us to start to learn how to create reflection effects for our Shaders, we are going to have to learn how to create our own <a id="id229" class="indexterm"></a>
<span class="strong"><strong>Cubemaps</strong></span>. You can find Cubemaps online, but you will quickly find out that you will want to produce your own, as the ones found online don't actually reflect your own game world. Any Cubemap found online is great for testing purposes only. Once you get into production, creating your own <a id="id230" class="indexterm"></a>Cubemaps, which reflect your game world, is<a id="id231" class="indexterm"></a> key to creating realistic reflection effects. We are going to cover a couple of ways in which you can do this directly in the Unity editor. In addition, we will take a look at standalone applications that will let you create your own Cubemaps. This will arm you with the knowledge to move onto the next chapters, as the generation of Cubemaps and understating them is crucial to this entire chapter.</p><p>So, this first recipe is going to arm us with a few different techniques for creating Cubemaps for your Shaders.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec74"></a>Getting ready</h3></div></div></div><p>Unity has <a id="id232" class="indexterm"></a>provided us with the code in JavaScript to be able to create a Cubemap from the environment we have created. So let's take a look at that. Here is the link to the script reference for it: <a class="ulink" href="http://www.packtpub.com/support" target="_blank">www.packtpub.com/support</a>. This will serve as a basis for our script. We are going to translate this to C#. In the last recipe in this chapter, we will cover how to create a simple system for <a id="id233" class="indexterm"></a>generating Cubemaps at multiple positions and use that data to swap between these reflection maps as a character moves through an environment, ultimately giving us a semi-real-time reflection system.</p><p>For this recipe we will just learn how the creation of a single Cubemap works, which will prepare us for a dynamic reflection system that can be used for your game.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We will need to create some elements for our scene that will act as lights in our reflection Cubemap. So, we need to create some geometric planes in our scene. You can do this either in a modeling application, like Maya or Max, or you can use the default Unity plane. Either way, it doesn't really matter. Your scene should look similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_45.jpg" /></div></li><li><p>Now, we need to create some textures that will simulate the effect of different types of lights. So, we need to create some textures that will simulate the falloff and intensity of lights in our environment. Refer to the <a id="id234" class="indexterm"></a>following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_46.jpg" /></div></li><li><p>Now, we<a id="id235" class="indexterm"></a> need to use one of the built-in Shaders Unity has provided us so that we can use our plane geometry and textures as lights in our Cubemap. It is suggested that we use the unlit/transparent shader, so that we get the full intensity of the textures that are simulating the lights. Once completed, your scene should look similar to the following:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_47.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec75"></a>How to do it…</h3></div></div></div><p>Let's begin <a id="id236" class="indexterm"></a>writing our Shader by following the next few steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We first<a id="id237" class="indexterm"></a> need to create a new script, but since this is going to be a pop-up editor window, we must put this script in a folder called <code class="literal">Editor</code>. Create that folder now in your <code class="literal">Project</code> panel, and then create a C# script in that folder called <code class="literal">GenerateStaticCubemap</code>. Once it is created, double-click on the new script to launch it in MonoDevelop.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_09.jpg" /></div></li><li><p>With the script open in MonoDevelop, we need to start to edit our script to perform the functions we need. To start with, we need to make a new <code class="literal">using</code> directive so that we are using the <code class="literal">UnityEditor</code> namespace.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_10.jpg" /></div></li><li><p>In order for this script to be considered a pop-up type editor window, we need to make the <code class="literal">GenerateStaticCubemap</code> script inherit from the <code class="literal">ScriptableWizard</code> class. <a id="id238" class="indexterm"></a>This will provide us with some nice low-level functions we can use in our script.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_11.jpg" /></div></li><li><p>We then need to add a few public variables so that we can store our new Cubemap and the position of our Cubemap. Add the following code to the start of the class:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_12.jpg" /></div></li><li><p>Our <a id="id239" class="indexterm"></a>first function in this script is a built-in <a id="id240" class="indexterm"></a>function<a id="id241" class="indexterm"></a> called <code class="literal">OnWizardUpdate()</code>. This function is called when the wizard is first opened, or whenever the GUI is changed by the user. So, this is a good place to check and to make sure that the user has supplied the wizard some assets to work with. If we don't have a Cubemap or a transform in the variables, we need to set the <code class="literal">isValid</code> Boolean to <code class="literal">false</code> and not allow the future functions.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_13.jpg" /></div></li><li><p>If the <code class="literal">isValid</code> Boolean is equal to <code class="literal">true</code>, the wizard will call the <code class="literal">OnWizardCreate()</code> function<a id="id242" class="indexterm"></a>. This will produce a new camera for us; then position it using our provided transform, and use the <code class="literal">RenderToCubemap()</code> function<a id="id243" class="indexterm"></a> to return a Cubemap.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_14.jpg" /></div></li><li><p>Finally, we need to call this wizard to activate it from a menu option in the Unity editor menu. Enter the following code to your <code class="literal">GenerateStaticCubemap</code> class:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_04_15.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec76"></a>How it works…</h3></div></div></div><p>We <a id="id244" class="indexterm"></a>begin by creating a new script and declaring its class as <a id="id245" class="indexterm"></a>inheriting from a scriptable wizard. This tells Unity3D that we intend to make a new pop-up window type custom editor for Unity. This is why we have to put this script into a folder named <code class="literal">Editor</code>. If we don't, Unity won't recognize it as a custom editor type script.</p><p>The variables that we declare in the next step give us a way to store the position we want to create the Cubemap from, and a way to store a new Cubemap <code class="literal">GameObject</code> constructor created in the <span class="strong"><strong>Project</strong></span> tab. Having these variables will let us generate our new Cubemap.</p><p>We then have the <code class="literal">OnWizardUpdate()</code> function<a id="id246" class="indexterm"></a> that is a function provided to us by the <code class="literal">ScriptableWizard</code> class<a id="id247" class="indexterm"></a>. It is called when the wizard is first opened and when any of the wizard's GUI elements change. So, we can use it to do some verification that the user has in fact entered a transform and a new Cubemap. If they have, we set the <code class="literal">isValid</code> variable to <code class="literal">true</code>; if they haven't, we set <code class="literal">isValid</code> to <code class="literal">false</code>. The <code class="literal">isValid</code> variable is a built-in variable, which is given to us by the <code class="literal">ScriptableWizard</code> class. It simply lets you turn on and off the <span class="strong"><strong>Create</strong></span> button found at the bottom of the wizard. This prevents anyone from running the next function with an empty transform or Cubemap.</p><p>Once we have made sure that the user has given us the right data to work with, we can then move on to the<a id="id248" class="indexterm"></a> <code class="literal">OnWizardCreate()</code> function. This is where<a id="id249" class="indexterm"></a> the guts of the Cubemap creation happens. It starts by creating a new <code class="literal">GameObject</code> constructor and making sure that it is created as a <code class="literal">Camera</code> type. We then position it using the provided transform's position.</p><p>At this <a id="id250" class="indexterm"></a>point, we have a new camera and have positioned it. All that needs to be done is to call the <code class="literal">RenderToCubeMap()</code> function<a id="id251" class="indexterm"></a> and pass to it the user-provided Cubemap. Once this function runs, the six images for our Cubemap will be created and assembled into the Cubemap object the user has provided.</p><p>Finally, we create a menu option for our wizard, so that we can let users access this tool from Unity's top menu bar. With that menu item, we call upon the wizard's <code class="literal">Static</code> function, which actually displays the menu. This completes the process of creating a small tool to generate Cubemaps directly in the Unity editor.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec77"></a>See also</h3></div></div></div><p>Let's take a look at other applications that can generate Cubemaps as well. This will give you a nice list of resources that you can use to create your own reflection pipeline or workflow:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>ATI </strong></span>
<a id="id252" class="indexterm"></a>
<span class="strong"><strong>CubeMapGen</strong></span>: <a class="ulink" href="http://developer.amd.com/resources/archive/archived-tools/gpu-tools-archive/cubemapgen/" target="_blank">http://developer.amd.com/resources/archive/archived-tools/gpu-tools-archive/cubemapgen/</a>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>HDR Light Studio</strong></span>
<a id="id253" class="indexterm"></a>
<span class="strong"><strong> Pro</strong></span>: <a class="ulink" href="http://www.hdrlightstudio.com/" target="_blank">http://www.hdrlightstudio.com/</a>
</p></li></ul></div></div></div>