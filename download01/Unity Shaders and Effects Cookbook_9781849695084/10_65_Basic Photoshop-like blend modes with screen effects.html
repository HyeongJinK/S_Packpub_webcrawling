<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec62"></a>Basic Photoshop-like blend modes with screen effects</h2></div></div><hr /></div><p>Screen effects aren't <a id="id586" class="indexterm"></a>just limited to adjusting the colors of a rendered <a id="id587" class="indexterm"></a>image from our game. We can also use them to combine other images with our render texture. This technique is no different than creating a new layer in Photoshop and choosing a blend mode to blend two images together, or in our case, a render texture. This becomes a very powerful technique, since it gives the artists in a production environment, a way to simulate their blending modes in game, rather than just in Photoshop.</p><p>For this particular recipe, we are going to take a look at some of the more common blend modes, such as <span class="strong"><strong>Multiply</strong></span>, <span class="strong"><strong>Add</strong></span>, and <span class="strong"><strong>Overlay</strong></span>. You will see how simple it is to have the power of Photoshop blend modes inside your game.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec162"></a>Getting ready</h3></div></div></div><p>To begin we have to get our assets ready again. So let's follow the next few steps to get our screen effects system up and running for our new blend mode screen effect:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script and call it <code class="literal">BlendMode_ImageEffect</code>.</p></li><li><p>Create a new Shader and call it <code class="literal">BlendMode_Effect</code>.</p></li><li><p>Now we simply need to copy the code we had from the C# script in the <span class="emphasis"><em>Setting up the screen effects script system</em></span> recipe of this chapter, into our new C# script. This will allow us to just focus on the math for the brightness, saturation, and contrast effect.</p></li><li><p>Copy the code from the Shader in the same recipe of this chapter, into our new Shader.</p></li><li><p>Finally, we will need another texture with which we will perform our blend mode effect. In this recipe we are going to use a grunge type texture. This will make the effect very obvious when we are testing it out.</p></li></ol></div><p>The following image is the grunge map used in the making of this effect. We'll need to find a texture with enough detail and a nice range of grayscale values to test our new effect.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_24.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec163"></a>How to do it…</h3></div></div></div><p>The first blend<a id="id588" class="indexterm"></a> mode we will implement is the Multiply blend <a id="id589" class="indexterm"></a>mode as seen in Photoshop. Let's begin by modifying the code in our Shader first. So, launch the Shader into MonoDevelop by double-clicking on it in Unity's project view.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We need to add in some new properties so that we have a texture to blend with and a slider for an opacity value. Enter the code from the following image into your new Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_25.jpg" /></div></li><li><p>Enter the corresponding variables into our <code class="literal">CGPROGRAM</code> statement, so that we can access the data from our <code class="literal">Properties</code> block:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_26.jpg" /></div></li><li><p>Finally, <a id="id590" class="indexterm"></a>we modify our <code class="literal">frag()</code> function so that it <a id="id591" class="indexterm"></a>performs the multiply operation on our two textures:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_27.jpg" /></div></li><li><p>Save the Shader and return to the Unity editor to let the new Shader code compile and check for errors. If no errors occurred, double-click on the C# script file to launch it into the MonoDevelop editor.</p></li><li><p>In our script file we need to create the corresponding variables as well. So we will need a texture, so we can assign one to the Shader, and a slider to adjust the final amount of the blend mode we want to use:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_28.jpg" /></div></li><li><p>We then need to send our variable data to the Shader through the <code class="literal">OnRenderImage()</code> function:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_29.jpg" /></div></li><li><p>To<a id="id592" class="indexterm"></a> complete the script, we simply fill in<a id="id593" class="indexterm"></a> our <code class="literal">Update()</code> function<a id="id594" class="indexterm"></a> so that we can clamp the value of the <code class="literal">blendOpacity</code> variable between a value of 0.0 and 1.0:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_30.jpg" /></div></li></ol></div><p>With that completed, we assign the screen effect script to our main camera and our screen effect shader to our script so that it has a Shader to use for the per-pixel operations. Finally, in order for the effect to be fully functional, the script and Shader starts looking for a texture. You can assign any texture to the texture field in the <span class="strong"><strong>Inspector</strong></span> tab for the screen effect script. Once that texture is in place, you will see the effect of multiplying this texture over the games rendered image. The following image demonstrates the screen effect:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_31.jpg" /></div><p>The <a id="id595" class="indexterm"></a>following image demonstrates a higher intensity of Opacity, <a id="id596" class="indexterm"></a>making the multiplied image much more apparent over our render image:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_32.jpg" /></div><p>With our first blend mode set up we can begin to add a couple of simpler blend modes to get a better understanding of how easy it is to add more effects and really fine-tune the final result in your game. But first let's break down what is happening here.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec164"></a>How it works…</h3></div></div></div><p>Now <a id="id597" class="indexterm"></a>we are starting to gain a lot of power and flexibility in our<a id="id598" class="indexterm"></a> screen effects programming. I am sure you can start to understand how much one can do with this simple system in Unity. We can literally replicate the effects of Photoshop layer blending modes in our game to give artists the flexibility they need to achieve high quality graphics in a short amount of time.</p><p>With this particular recipe we looked at how to multiply two images together, add two images together, and perform a screen-blending mode, using just a little bit of math. When working with blend modes, one has to think on a per-pixel level. For instance, when we are using a Multiply blend mode, we literally take each pixel from the original render texture and multiply them with each pixel of the blend texture. The same goes for the Add blend mode. It is just a simple math operation of adding each pixel from the source texture, or render texture, to the blend texture.</p><p>The screen blend mode is definitely a bit more involved, but it is doing the same thing. It takes each image, the render texture and the blend texture, inverts them both, then multiplies them together, and then inverts them again to achieve the final look. Just like Photoshop blends its textures together, using blend modes, we can do the same with screen effects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec165"></a>There's more…</h3></div></div></div><p>Let's continue this recipe by adding a couple more blend modes to our screen effect:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the screen effect shader, let's add the following code to our <code class="literal">frag()</code> function and change the value we are returning to our script. We will also need to comment out the Multiply blend so that we don't return that as well:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_33.jpg" /></div></li><li><p>Save the<a id="id599" class="indexterm"></a> Shader file in MonoDevelop<a id="id600" class="indexterm"></a> and return to the Unity editor to let the Shader compile. If no errors occurred, you should see a result similar to the following image. This is a simple Add blending mode:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_34.jpg" /></div><p>As you can see, this has the opposite effect of the Multiply because we are adding the two images together.</p></li><li><p>Finally, let's add one more blend mode, called a <code class="literal">Screen Blend</code>. This one is a little bit more involved from a math standpoint, but still simple to implement. Enter the following code into the <code class="literal">frag()</code> function of our Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_35.jpg" /></div></li></ol></div><p>The following <a id="id601" class="indexterm"></a>image demonstrates the results of using a Screen type <a id="id602" class="indexterm"></a>blend mode to blend two images together in a screen effect:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084_10_36.jpg" /></div></div></div>