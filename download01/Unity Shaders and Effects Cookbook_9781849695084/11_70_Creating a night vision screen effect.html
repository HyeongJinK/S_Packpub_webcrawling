<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec66"></a>Creating a night vision screen effect</h2></div></div><hr /></div><p>Our next screen effect is <a id="id633" class="indexterm"></a>definitely a more popular one. The night vision screen effect is seen in Call of Duty Modern Warfare, Halo, and just about any first-person shooter out in the market today. It is the effect of brightening the whole image using that very distinct lime green color.</p><p>In order to achieve our night vision effect, we need to break our effect down using Photoshop. It is a simple process of finding some reference images online and composing a layered image to see what kinds of Blending modes you will need, or in which order we will need to combine our layers. The following image shows the result of performing just this process in Photoshop:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_16.jpg" /></div><p>Let's begin to break down our rough Photoshop-composite image into its component parts so that we can better understand the assets we will have to gather. In the next section, we will cover the process of doing just that.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec172"></a>Getting ready</h3></div></div></div><p>Let's begin this screen <a id="id634" class="indexterm"></a>effect by again breaking down our effect into its component layers. Using Photoshop, we can construct a layered image to better illustrate how we can go about capturing the effect of night vision.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Tinted green</strong></span>: Our first <a id="id635" class="indexterm"></a>layer in our screen <a id="id636" class="indexterm"></a>effect is the iconic green color, found in just about every night vision image. This will give our effect that signature night vision look.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_17.jpg" /></div></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Scan lines</strong></span>: To increase <a id="id637" class="indexterm"></a>the effect of this being a new<a id="id638" class="indexterm"></a> type of display for the<a id="id639" class="indexterm"></a> player, we include scan lines over the top of our tinted layer. For this, we will use a texture created in Photoshop and let the user tile it so that the scan lines can be bigger or smaller.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_18.jpg" /></div></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Noise</strong></span>: Our <a id="id640" class="indexterm"></a>next layer is a simple noise<a id="id641" class="indexterm"></a> texture that we tile over the tinted image and the scan lines, to break up the image and to add even more detail to our effect. This layer simply emphasizes that digital read out look.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_20.jpg" /></div></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Vignette</strong></span>: The last <a id="id642" class="indexterm"></a>layer in our night vision effect is the <a id="id643" class="indexterm"></a>vignette. If you look at the night vision effect in Call of Duty Modern Warfare, you will notice that it uses a vignette that fakes the effect of looking down a scope. We will do that for this screen effect.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_19.jpg" /></div></li></ul></div><p>Let's create a <a id="id644" class="indexterm"></a>screen effect system by gathering our textures. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Gather up a vignette texture, a noise texture, and a scan line texture, like the ones we just saw.</p></li><li><p>Create a new script called <code class="literal">NightVisionEffect.cs</code> and a new Shader called <code class="literal">NightVisionEffectShader.shader</code>.</p></li><li><p>With our new files created, fill in the code necessary to get the screen effect system up and running. For instructions on how to do that, refer to <a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>Screen Effects with Unity Render Textures</em></span>.</p></li></ol></div><p>Finally, with our Screen Effect system up and running and our textures gathered, we can begin the process of recreating this old film effect.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec173"></a>How to do it…</h3></div></div></div><p>With all of our <a id="id645" class="indexterm"></a>assets gathered and our screen effect system running smoothly, let's begin to add the code necessary to both the script and the Shader. We will begin our coding with the <code class="literal">NightVisionEffect.cs</code> script; so double-click on that file now to open it up in MonoDevelop.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We need to create a few variables that will allow the user of this effect to adjust it in the script's <span class="strong"><strong>Inspector</strong></span>. Enter the following code into the <code class="literal">NightVisionEffect.cs</code> script:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_21.jpg" /></div></li><li><p>Next, we need to complete our <code class="literal">OnRenderImage()</code> function so that we are passing the right data to the Shader, in order for the Shader to process the screen effect properly. Complete the <code class="literal">OnRenderImage()</code> function with the following code:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_22.jpg" /></div></li><li><p>To<a id="id646" class="indexterm"></a> complete the <code class="literal">NightVisionEffect.cs</code> script, we simply need to make sure that we clamp certain variables so that they stay within a range. These ranges are arbitrary and can be changed at a later time. These are just values that worked well.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_23.jpg" /></div></li><li><p>We can now<a id="id647" class="indexterm"></a> turn our attention over to the Shader portion of this screen effect. Open the Shader, if you haven't already, and begin by entering the following properties in the <code class="literal">Properties</code> block:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_24.jpg" /></div></li><li><p>To make sure that we are passing the data from our <code class="literal">Properties</code> block into our <code class="literal">CGPROGRAM</code> block, we need to make sure to declare them with the same name inside the <code class="literal">CGPROGRAM</code> block.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_25.jpg" /></div></li><li><p>Our effect <a id="id648" class="indexterm"></a>is also going to include a lens distortion to further convey the effect that we are looking through a lens and the edges of the image are being distorted by the angle of the lens. Enter the following function just after the variable decelerations in the <code class="literal">CGPROGRAM</code> block:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_26.jpg" /></div></li><li><p>We can now concentrate on the meat of our <code class="literal">NightVisionEffect</code> shader. Let's start this by entering the code that is necessary to get the render texture and the vignette texture. Enter the following code into the <code class="literal">frag()</code> function of our Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_27.jpg" /></div></li><li><p>The next <a id="id649" class="indexterm"></a>step in our <code class="literal">frag()</code> function is to process the scan lines and noise textures and apply the proper animated UVs to them:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_28.jpg" /></div></li><li><p>To complete all of our layers in the screen effect, we simply need to process the luminance value of our render texture, and then apply the night vision color to it to achieve that iconic night vision look:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_29.jpg" /></div></li><li><p>Lastly, we will combine all the layers together and return the final color of our night vision effect:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_30.jpg" /></div></li></ol></div><p>When you have finished entering the code, return to the Unity editor to let the script and the Shader to compile. If there are no errors, hit <span class="strong"><strong>Play</strong></span> in the editor to see the results. You should see something similar to the following image:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_15.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec174"></a>How it works…</h3></div></div></div><p>The<a id="id650" class="indexterm"></a> night vision effect is actually very similar to the old film screen effect, which shows us just how modular we can make these components. Just by simply swapping out the textures we are using for overlays and changing the speed at which our tiling rates are being calculated, we can achieve very different results using the same code.</p><p>The only difference with this effect is the fact that we are including a lens distortion to our screen effect. So let's break this down, so that we can get a better understanding of how it works.</p><p>The following code snippet illustrates the code used in processing our lens distortion. It is a snippet of code provided to us by the makers of SynthEyes, and the code is freely available to use in your own effects:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_11_26.jpg" /></div><p>When breaking <a id="id651" class="indexterm"></a>down the<a id="id652" class="indexterm"></a> <code class="literal">barrelDistortion()</code> function, the first line of code finds the center of the render texture image. Once we have the center of the image, we can then apply a stretching to the pixels as they get further away from the center of the image. So, we fake the effect of the main render texture being distorted by the angle of a lens. Quite a nice effect when applied to screen effects like the night vision effect.</p><p>Once the UVs have been processed to compute the fake stretching, we can continue with the Shader just like we have before, applying UV animation and pixel operations to achieve our final night vision effect.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec175"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The following<a id="id653" class="indexterm"></a> link takes you to the page which describes the lens distortion effect:</p><p>
<span class="strong"><strong>Lens Distortion</strong></span>: <a class="ulink" href="http://www.ssontech.com/content/lensalg.htm" target="_blank">http://www.ssontech.com/content/lensalg.htm</a>
</p></li></ul></div></div></div>