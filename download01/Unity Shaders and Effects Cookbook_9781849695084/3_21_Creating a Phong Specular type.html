<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec25"></a>Creating a Phong Specular type</h2></div></div><hr /></div><p>The most basic and <a id="id163" class="indexterm"></a>performance-friendly Specular type is the<a id="id164" class="indexterm"></a> <span class="strong"><strong>Phong</strong></span> Specular effect. It is the calculation of the light direction reflecting off of the surface compared to the user's view direction. It is a very common Specular model used in many applications, from games to movies. While it isn't the most realistic in terms of accurately modeling the reflected Specular, it gives a great approximation that performs well in most situations. Plus, if your object is further away from the camera and the need for a very accurate Specular isn't needed, this is a great way to provide a Specular effect on your Shaders.</p><p>In this recipe, we will be covering how to implement the per vertex version of the and also see how to implement the per pixel version using some new parameters in the surface Shader's <code class="literal">Input</code> struct. We will see the difference and discuss when and why to use these two different implementations for different situations.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec58"></a>Getting ready</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <a id="id165" class="indexterm"></a>Shader, Material, and object, and give them appropriate names so that you can find them later.</p></li><li><p>Finally, attach the<a id="id166" class="indexterm"></a> Shader to the Material and the Material to the object. To finish off your new scene, create a new directional light so that we can see our Specular effect as we code it.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec59"></a>How to do it…</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>You might be seeing a pattern at this point, but we always like to start out with our most basic part of the Shader writing process: the creation of properties. So, let's add the following properties to the Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_08.jpg" /></div></li><li><p>We then have to make sure to add the corresponding variables to our <code class="literal">CGPROGRAM</code> block inside our <code class="literal">SubShader</code> block.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_09.jpg" /></div></li><li><p>Now we have to add our custom lighting model so that we can compute our own Phong Specular. Add the following code to the Shader's <code class="literal">SubShader()</code> function. Don't worry if it doesn't make sense at this point; we will cover each line of code in the next section:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_10.jpg" /></div></li><li><p>Finally, we<a id="id167" class="indexterm"></a> have to tell the <code class="literal">CGPROGRAM</code> block that it<a id="id168" class="indexterm"></a> needs to use our custom lighting function instead of one of the built-in ones. We do this by changing the <code class="literal">#pragma</code> statement to the following:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_11.jpg" /></div></li></ol></div><p>The following screenshot demonstrates the result of our custom Phong lighting model using our own custom reflection vector:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_07.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec60"></a>How it works…</h3></div></div></div><p>Let's break<a id="id169" class="indexterm"></a> down the lighting function by itself, as the rest of the Shader should be pretty familiar to you at this point.</p><p>We simply<a id="id170" class="indexterm"></a> start by using the lighting function that gives us the view direction. Remember that Unity has given you a set of lighting functions that you can use, but in order to use them correctly you have to have the same arguments they provide. Refer to the following table, or go to <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/SL-SurfaceShaderLighting.html" target="_blank">http://docs.unity3d.com/Documentation/Components/SL-SurfaceShaderLighting.html</a>:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /></colgroup><tbody><tr><td style="" align="left" valign="top">
<p>Not view Dependent</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">half4 Lighting  Name You choose (SurfaceOutput s, half3 lightDir, half atten);</code>
</p>
</td></tr><tr><td style="" align="left" valign="bottom">
<p>View Dependent</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">half4 Lighting Name You choose (SurfaceOutput s, half3 lightDir, half3 viewDir, half atten);</code>
</p>
</td></tr></tbody></table></div><p>In our case, we are doing a Specular Shader, so we need to have the view-dependent lighting function structure. So, we have to write:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_41.jpg" /></div><p>This will <a id="id171" class="indexterm"></a>tell the Shader that we want to create our own view-dependent Shader. Always make sure that your lighting function name is the same in your lighting function declaration and the <code class="literal">#pragma</code> statement, or Unity will not be able to find your lighting model.</p><p>The lighting function then begins by declaring the usual <code class="literal">Diffuse</code> component by dotting the vertex normal with the light direction or vector. This will give us a value of <code class="literal">1</code> when a normal on the model is facing towards the light, and a value of <code class="literal">-1</code> when facing away from the light direction.</p><p>We then calculate <a id="id172" class="indexterm"></a>the reflection vector taking the vertex normal, scaling it by 2.0 and by the diff value, then subtracting the light direction from it. This has the effect of bending the normal towards the light; so as a vertex normal is pointing away from the light, it is forced to look at the light. Refer to the following screenshot for a more visual representation. The script that produces this debug effect is included at the book's support page at <a class="ulink" href="http://www.packtpub.com/support" target="_blank">www.packtpub.com/support</a>.</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_42.jpg" /></div><p>Then all we have left to do is to create the final spec's value and color. To do this, we dot the reflection vector with the view direction and take it to a power of <code class="literal">_SpecPower</code>. Finally, we just multiply the <code class="literal">_SpecularColor.rgb</code> value over the spec value to get our final Specular highlight.</p><p>The following screenshot displays the final result of our Phong Specular <a id="id173" class="indexterm"></a>calculation<a id="id174" class="indexterm"></a> isolated out in the Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_03_43.jpg" /></div></div></div>