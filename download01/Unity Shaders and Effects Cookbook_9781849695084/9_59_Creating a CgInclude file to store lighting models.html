<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec57"></a>Creating a CgInclude file to store lighting models</h2></div></div><hr /></div><p>Knowing about the<a id="id519" class="indexterm"></a> built-in CgInclude files is great, but what if we wanted to build our own CgInclude files to store our own lighting models and helper functions? We can in fact create our own CgInclude files, but we need to learn a little more code syntax before we can start to use them efficiently in our Shader writing pipelines. Let's take a look at the process of creating a new CgInclude file from scratch.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec150"></a>Getting ready</h3></div></div></div><p>Using the same scene, Shader, and Material, let's walk through the process of generating a new item for this recipe.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Begin by<a id="id520" class="indexterm"></a> creating a new text file and call it something like <code class="literal">MyCgInclude.txt</code>.</p></li><li><p>Then change its file extension to <code class="literal">.cginc</code>. Windows will give you a warning message saying that the file may become unusable, but it will still work.</p></li><li><p>Import that new <code class="literal">.cginc</code> file into your Unity project and let it compile. If all goes well, you will see that Unity knew to compile it to a CgInclude file.</p></li></ol></div><p>We are now ready to begin creating our own custom CgInclude code. Simply double-click on the CgInclude file you created to open in MonoDevelop.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec151"></a>How to do it…</h3></div></div></div><p>With our CgInclude file open, we can begin to enter the code that will get it working with our Surface Shaders. The following code will get our CgInclude file ready for use within our Surface Shaders and allow us to continually add more code to it as we develop more Shaders:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We begin <a id="id521" class="indexterm"></a>our CgInclude file with what is called a preprocessor directive. These are statements like <code class="literal">#pragma</code> and <code class="literal">#include</code>. In this case, we want to define a new set of code that will be executed if our Shader includes this file in its compiler directives. Enter the following code at the top of your CgInclude file:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_07.jpg" /></div></li><li><p>We then always need to make sure we close our <code class="literal">#ifndef</code> or <code class="literal">#ifdef</code> with an <code class="literal">#endif</code> to close the definition check, just like an <code class="literal">if</code> statement needs to be closed with two brackets in C#. Enter the following code just after the <code class="literal">#define</code> directive:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_08.jpg" /></div></li><li><p>At this point we just need to fill in the guts of the CgInclude file. So we finish off our CgInclude file by entering in the following code:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_09.jpg" /></div></li><li><p>With that<a id="id522" class="indexterm"></a> completed, you now have your very first CgInclude file. With just this little bit of code we can greatly reduce the amount of code we have to re-write, and we can begin to store lighting models we use all the time here so that we never lose them. Your CgInclude file should look similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_10.jpg" /></div><p>There are a couple more steps we need to complete before we can fully utilize this CgInclude file. We simply need to tell the current Shader we are working with to use this file and its code. To complete the process of creating and using CgInclude files, let's complete the next set of steps.</p></li><li><p>If we turn our attention to our Shader we need to tell our <code class="literal">CGPROGRAM</code> block to include our new CgInclude file, so we can access the code it contains. Modify the directives of our <code class="literal">CGPROGRAM</code> block to include the following code:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_11.jpg" /></div></li><li><p>Our <a id="id523" class="indexterm"></a>current Shader is currently using the built-in Lambert lighting model, but we want to use the Half Lambert lighting model we created in our CgInclude. Since we include the code from our CgInclude file, we can use the Half Lambert lighting model with the following code:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_12.jpg" /></div></li><li><p>Finally, we have also declared a custom variable in our CgInclude file to show that we can set up default variables for our Shaders to use. To see this in action, enter the following code into the <code class="literal">Properties</code> block of your Shader:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_13.jpg" /></div></li></ol></div><p>When we return to Unity, the Shader and CgInclude file will compile, and if you do not see any errors, <a id="id524" class="indexterm"></a>you will notice that in fact we are using our new Half Lambert lighting model and a new color swatch appeared in our Materials <span class="strong"><strong>Inspector</strong></span>. The following screenshot shows the result of using our CgInclude file:</p><div class="mediaobject"><img src="/graphics/9781849695084/graphics/5084OT_09_14.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec152"></a>How it works…</h3></div></div></div><p>When using Shaders, we can include other sets of code by using the <code class="literal">#include</code> preprocessor directive. This tells Unity that we want to let the current Shader use the code from within the included file in the Shader, that's the reason why these files are called CgInclude files. We are including snippets of Cg code using the <code class="literal">#include</code> directive.</p><p>Once we declare the <code class="literal">#include</code> directive and Unity is able to find the file in the project, Unity will then look for code snippets that have been defined. This is where we start to use the <code class="literal">#ifndef</code> directive and <code class="literal">#endif</code> directive. When we declare the <code class="literal">#ifndef</code> directive we are simply saying, <span class="emphasis"><em>if not defined, define something with a name</em></span>. In this recipe's case, we said we wanted to <code class="literal">#define MY_CG_INCLUDE</code>. So if Unity doesn't find a definition called <code class="literal">MY_CG_INCLUDE</code>, it goes and creates it when the CgInclude file is compiled, thereby giving us access to the code that follows. The <code class="literal">#endif</code> simply says that this is the end of this definition, so stop looking for more code.</p><p>You can now see how powerful this becomes, since we can now store all of our lighting models and custom variables in one file, and greatly reduce the amount of code we have to write. The real power is when you can begin to give your Shaders the flexibility by defining multiple states of functions within the CgInclude files.</p></div></div>