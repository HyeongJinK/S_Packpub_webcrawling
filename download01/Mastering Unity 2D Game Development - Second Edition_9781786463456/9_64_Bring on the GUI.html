<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec62"></a>Bring on the GUI</h2></div></div><hr /></div><p>Before we can start acting on the state machine, we first need to add something for the player to interact with, namely the buttons to select the attacks, items, and so on.</p><p>To do this, we will add a HUD that will hold the player's health and have buttons for the various actions. The following is a general example of the layout we will be placing the items:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_018.jpg" /></div><p>
</p><p>In the preceding image, the last button will not be visible if there is not action tied to it, and the arrow button will only be visible in submenus. The UI elements are all provided on a sprite sheet, and we will need to do some work with the layout to get them to display, as shown in the preceding screenshot. Import the sprite sheet <code class="literal">BattleGUI</code> to the <code class="literal">Assets/Sprites/UI</code> folder. Import it in <span class="strong"><strong>MultipleSprite Mode</strong></span> and automatically slice it.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec115"></a>Laying out the HUD</h3></div></div></div><p>Right now we have two Canvases, one holding our introduction animation and one holding the <span class="strong"><strong>Run Away</strong></span> button. Eventually, we will delete the Canvas holding the current button. So, let's create a new Canvas and name it <code class="literal">HUDCanvas</code>. Right-click on it and create a new <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>. Rename it <code class="literal">Background</code>. Change its properties so that you have the blue-stripped rectangle as the background and it is anchored at the top of the screen, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_019.jpg" /></div><p>
</p><p>To get the other pieces to line up correctly, we will actually use two more Panels that will be children of this larger Panel. Right-click on the <code class="literal">Background</code> Panel and create two new Panels. Name the first Panel <code class="literal">HP</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_020.jpg" /></div><p>
</p><p>And name the second Panel <code class="literal">Bottom</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_021.jpg" /></div><p>
</p><p>We're using these two Panels to help keep all of the items that will be within these areas contained together, as well as we use these as the holders in which we have to set our position and pivot points.</p><p>Now let's set up the top Panel that will hold our HP information. Start by setting the background of the <code class="literal">HP</code> Panel to the <code class="literal">BattleGUI_1</code> image and settings its <span class="strong"><strong>Alpha</strong></span> value to <code class="literal">256</code> so that it is fully opaque:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_022.jpg" /></div><p>
</p><p>Now add, as a child of the <span class="strong"><strong>HP</strong></span> Panel, a <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span> object. Left align it, but also give it a little padding so it is not right up against the edge:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_023.jpg" /></div><p>
</p><p>Add another <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span> object, but put it on the right side. Later, we will get this text to update so that it appropriately displays the player's current health and total possible health:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_024.jpg" /></div><p>
</p><p>Now add, as a child of the <code class="literal">HP</code> Panel, a<span class="strong"><strong> UI</strong></span> | <span class="strong"><strong>Slider</strong></span>. Sliders are great for representing health bars. Position as shown in the following screenshot and set the <span class="strong"><strong>Value</strong></span> to <code class="literal">1</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_025.jpg" /></div><p>
</p><p>When you expand the <span class="strong"><strong>Slider</strong></span> in the hierarchy, you will see that there are a few child elements of the <span class="strong"><strong>Slider</strong></span>. Go ahead and delete the <span class="strong"><strong>Handle</strong></span> that is a child of the <span class="strong"><strong>Handle Slide Area</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_026.jpg" /></div><p>
</p><p>Now select the <code class="literal">Background</code> child and set its image to the <code class="literal">BattleGUI_2</code> image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_027.jpg" /></div><p>
</p><p>Now, for the <span class="strong"><strong>Fill</strong></span>, which is a child of the <span class="strong"><strong>Fill Area</strong></span>, set the image to the <code class="literal">BattleGUI_2</code> image and align it appropriately:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_028.jpg" /></div><p>
</p><p>Now if you change the value on the <code class="literal">Slider</code> component, you can watch the fill image increase and decrease.</p><p>Let's work on the <code class="literal">Bottom</code> Panel. We'll use a few Panels inside this to hold various buttons. Add a <span class="strong"><strong>Panel</strong></span> as a child and name it <code class="literal">Buttons</code>. Align and position it as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_029.jpg" /></div><p>
</p><p>This Panel is simply going to hold two other Panels of the exact same size. Create another Panel and call it <code class="literal">Button Menu</code>. Set its anchor and position so that it stretches both horizontally and vertically:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_030.jpg" /></div><p>
</p><p>Add a <span class="strong"><strong>Layout</strong></span> | <span class="strong"><strong>Horizontal Layout Group</strong></span> component to the <code class="literal">Buttons Menu</code> Panel with the <span class="strong"><strong>Child Alignment</strong></span> set to <span class="strong"><strong>Middle Left</strong></span>. Add five buttons as children to this Panel and delete the text component from the last one:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_031.jpg" /></div><p>
</p><p>Now place the <code class="literal">BattleGUI_5</code> image as the background image for the first four buttons and the <code class="literal">BattleGUI_4</code> image as the background image for the last button. Also, set the text color for the buttons to white:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_032.jpg" /></div><p>
</p><p>We added the layout component so that it would perfectly space all of our buttons, but we don't want it to be a component on our object anymore. The reason is if we try to delete a button, it will try to disburse the buttons, but we want them to be in the exact same place even if we only have less buttons. So, remove the layout component. Now save this Panel as a prefab in the <code class="literal">Assets/Prefabs/UI</code> folder so that we can easily reuse it.</p><p>Rename the Panel <code class="literal">Main Buttons</code>, delete the last two buttons, and change the text and button names as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/B05553_09_31.jpg" /></div><p>
</p><p>Drag the <code class="literal">Button Menu</code> prefab in the Hierarchy so that it is also a child of the <code class="literal">Buttons</code> Panel and rename it <code class="literal">Attack Buttons</code>. Also, change the buttons' text and names as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_034.jpg" /></div><p>
</p><p>The last thing we want to do to set up the layout is get the status bar that will convey directions to the player at the bottom. Create a new Panel as a child of <code class="literal">Bottom</code> named <code class="literal">Text Holder</code> and give it the following properties:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_035.jpg" /></div><p>
</p><p>Now add a text component as a child of the <code class="literal">Text Holder</code> Panel with the following properties:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_036.jpg" /></div><p>
</p><p>Now select all the Panels that have the whitish background displaying behind them and change their <span class="strong"><strong>Alpha</strong></span> level to 0. After you are done, you should see the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_037.jpg" /></div><p>
</p><p>Now that the buttons are all laid out correctly, we can start making them display at the correct time within battle.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec116"></a>Displaying the correct buttons</h3></div></div></div><p>The goal of this chapter is to have the <code class="literal">Attack</code>, <code class="literal">Item</code>, and <code class="literal">Run</code> buttons visible when it is the player's move and if the <code class="literal">Attack</code> button is selected, have the various <code class="literal">Attack Buttons</code> display on the screen. We'll also have the <span class="strong"><strong>Run</strong></span> button perform appropriately.</p><p>In future chapters, we will make an item menu appear when the item button is selected, we will have the HP display correctly, have something actually happen when you hit the various attacks, and have information display in the status bar.</p><p>Right now, the <code class="literal">Attack Buttons</code> are displaying initially, but we actually want the <code class="literal">Main Buttons</code> displaying. Select the <code class="literal">Attack Buttons</code> Panel and add a <span class="strong"><strong>Canvas Group</strong></span> component to it. Set the <span class="strong"><strong>Alpha</strong></span> to 0 and deselect <span class="strong"><strong>Interactable</strong></span> and <span class="strong"><strong>Blocks Raycasts</strong></span>. Your gameplay scene should now appear as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_038.jpg" /></div><p>
</p><p>We want the Panel to display at all times, but we only want the buttons to display when it is the player's turn to move. So, we want these buttons to behave similar to the way the <code class="literal">Run Away</code> button is performing currently.</p><p>Instead of writing all new code for this, we will simply replace the Canvas holding the <code class="literal">Run Away</code> button with the Panel holding all of the buttons in the <code class="literal">BattleManager</code> script. Before we can do so, however, we need to add a <span class="strong"><strong>Canvas Group</strong></span> component to the <code class="literal">Buttons</code> Panel. Set the <span class="strong"><strong>Alpha</strong></span> to 0 and deselect <span class="strong"><strong>Interactable</strong></span> and <span class="strong"><strong>Blocks Raycasts</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/B05553_09_39.jpg" /></div><p>
</p><p>Now select the <code class="literal">BattleManager</code> object and drag the <code class="literal">Buttons</code> Panel to the the <span class="strong"><strong>Buttons</strong></span> variable in the <code class="literal">BattleManager</code> script. Now you can delete the old canvas that held the <span class="strong"><strong>Run Away</strong></span> button.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip113"></a>Tip</h3><p>If you have the <code class="literal">EventSystem</code> GameObject as a child of the canvas that holds the <code class="literal">Run Away</code> button, be sure to move it before deleting the canvas.</p></div><p>We don't have anything that lets the <code class="literal">Attack</code> button access the <code class="literal">Attack Buttons</code> Panel, so let's write some code that will allow that to happen. Instead of putting this code in the <code class="literal">BattleManager</code> script, we are going to create a new script to hold this information. The reason for this is we can actually reuse this code with other menus that we make throughout the game and it will be easier to reuse it if we just make it its own script.</p><p>Create a new C# script and call it <code class="literal">PopUpMenu</code>. We'll write a pretty simple script that will have one function that turns on all the <span class="strong"><strong>Canvas Group</strong></span> values and another that turns them all off:</p><pre class="programlisting">using UnityEngine; &#13;
using System.Collections; &#13;
using UnityEngine.UI; &#13;
 &#13;
public class PopUpMenu : MonoBehaviour { &#13;
    public CanvasGroup popUp; &#13;
 &#13;
    void Awake(){ &#13;
        popUp=GetComponent&lt;CanvasGroup&gt;(); &#13;
    } &#13;
     &#13;
    // Use this for initialization &#13;
    public void EnableTheMenu () { &#13;
     &#13;
        popUp.alpha=1; &#13;
        popUp.interactable=true; &#13;
        popUp.blocksRaycasts=true; &#13;
         &#13;
    } &#13;
     &#13;
    public void DisableTheMenu () { &#13;
        popUp.alpha=0; &#13;
        popUp.interactable=false; &#13;
        popUp.blocksRaycasts=false; &#13;
    } &#13;
     &#13;
}  &#13;
</pre><p>Attach this script to the <code class="literal">Attack Buttons</code> Panel and drag the <code class="literal">Attack Buttons</code> Panel to the <span class="strong"><strong>Pop Up</strong></span> slot, as shown in the following screenshot:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note114"></a>Note</h3><p>We could have written this code to grab the <span class="strong"><strong>Canvas Group</strong></span> off of the object that it was attached to, but I felt this was more versatile for future uses.</p></div><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_040.jpg" /></div><p>
</p><p>Now we just need to link all of the buttons up to the appropriate functions. Let's start with the <code class="literal">Attack</code> button. With the <code class="literal">Attack</code> button (in the <code class="literal">Main Buttons</code> Panel) selected in the Hierarchy, hit the <span class="strong"><strong>+</strong></span> symbol in the <span class="strong"><strong>On Click()</strong></span> event. Set it up so that the <code class="literal">EnableTheMenu</code> function from the <code class="literal">PopUpMenu</code> script that is attached to the <code class="literal">Attack Buttons</code> Panel will run:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_041.jpg" /></div><p>
</p><p>Now let's set up the <code class="literal">Back</code> button to hide this Panel. With the <code class="literal">Back</code> button (in the <code class="literal">Attack Buttons</code> Panel) selected in the Hierarchy, hit the <span class="strong"><strong>+</strong></span> symbol in the <span class="strong"><strong>On Click()</strong></span> event. Set it up so that the <code class="literal">DisableTheMenu</code> function from the <code class="literal">PopUpMenu</code> script that is attached to the <code class="literal">Attack Buttons</code> Panel will run:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_042.jpg" /></div><p>
</p><p>Now when you run the game, the buttons do not appear until it is the player's turn. Once it is the player's turn, if you select the <code class="literal">Attack</code> button, the list of attacks are displayed (they don't actually do anything yet, though) and when you hit the arrow button, the original menu is redisplayed.</p><p>The last thing we need to do is get the new <code class="literal">Run</code> button to perform the way the old <code class="literal">Run Away</code> button did. With the <code class="literal">Run</code> button (in the <code class="literal">Main Buttons</code> Panel) selected in the Hierarchy, hit the <span class="emphasis"><em>+</em></span> symbol in the <span class="strong"><strong>On Click()</strong></span> event. Set it up so that the <code class="literal">RunAway</code> function from the <code class="literal">BattleMananger</code> script that is attached to the <code class="literal">BattleMananger</code> GameObject will run:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_09_043.jpg" /></div><p>
</p><p>Now we can run away again.</p><p>Now that we have our UI and state machine set up, we have prepared the backbone for our battle system. Our poor hero still can't actually attack. However, we will implement her attacks and the enemies' attacks in the next chapter, <a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>The Battle Begins</em></span>. We'll also give the player some items to use in battle in <a class="link" href="#" linkend="ch11">Chapter 11</a>, <span class="emphasis"><em>Shopping for Items</em></span>.</p></div></div>