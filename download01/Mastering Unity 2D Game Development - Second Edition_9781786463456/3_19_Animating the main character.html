<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec23"></a>Animating the main character</h2></div></div><hr /></div><p>Right now, our hero can move around the screen, but she is always facing toward the camera and she isn't animated. Her sprite sheet came with her walk cycle from three angles, so let's put that into action to liven up her movement.</p><p>We will accomplish this movement by creating some Animation clips and linking them up in an Animation controller. As described earlier, in order to get the animation running, we will need the following prerequisites:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>An <span class="strong"><strong>Animator component</strong></span> on our GameObject</p></li><li style="list-style-type: disc"><p>An <span class="strong"><strong>Animator Controller</strong></span> to manage our animation that is bound to the animator</p></li><li style="list-style-type: disc"><p>At least one <span class="strong"><strong>Animation clip</strong></span> to play in the controller</p></li></ul></div><p>When you create a new animation clip for a GameObject, the other items are automatically created for you.</p><p>Before you get started with animation, you want to make sure you can view the <span class="strong"><strong>Animation</strong></span> and <span class="strong"><strong>Animator</strong></span> windows. If you do not already have the two windows open, click <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span> from the menu bar and then <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"></a>Note</h3><p>You may want to rearrange your windows at this point. I recommend docking the <span class="strong"><strong>Animation</strong></span> and <span class="strong"><strong>Animator</strong></span> windows next to the <span class="strong"><strong>Game</strong></span> window so you can see the <code class="literal">Project</code> folder while creating animations, as shown in the following screenshot:
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_007.jpg" /></div><p>
</p><p>This is easily done by dragging the tabs for the windows to the desired point. When it gets near a point in the editor where it can dock, it will do so automatically.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec32"></a>Adding your first Animation Clip</h3></div></div></div><p>The animation we will create first will be that of our character walking downward. To create your first animation clip, select the <span class="strong"><strong>Player</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> (or from the <span class="strong"><strong>Scene</strong></span> view) and then open the <span class="strong"><strong>Animation</strong></span> tab. You should see the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_008.jpg" /><div class="caption"><p>Prompt to create Animator and Animation Clip</p></div></div><p>
</p><p>Select <span class="strong"><strong>Create</strong></span> and then save the animation as <code class="literal">PlayerWalkDown.anim</code> within your <code class="literal">Assets/Animation/Clips</code> folder, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_009.jpg" /><div class="caption"><p>Animation file save menu</p></div></div><p>
</p><p>By selecting <span class="strong"><strong>Create</strong></span>, Unity will automatically create an Animator for your <span class="strong"><strong>Player</strong></span> and will automatically assign it within an Animator component on the Player. However, it has saved the new Animator in the <code class="literal">Clips</code> folder, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_010.jpg" /></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"></a>Note</h3><p>Notice that the generated Animator Controller is called <code class="literal">Player.controller</code>. Any Animator that is automatically created in the way will always be named after the GameObject that was selected when it was created.</p></div><p>Go ahead and drag and drop that Animator into the <code class="literal">Assets/Animation/Controllers</code> folder so that we maintain the integrity of the folder structure we created.</p><p>Within the <span class="strong"><strong>Animation</strong></span> window, you should now see <span class="strong"><strong>PlayerWalkDown</strong></span> within the drop-down menu, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_011.jpg" /></div><p>
</p><p>Within the <span class="strong"><strong>Project</strong></span> view, navigate to the <code class="literal">Assets/Sprites/Characters</code> folder to find the character's sprite sheet and click on the arrow on the right of the sprite sheet to view all of the character's walk cycle sprites. The first three images represent the character's downward walk cycle:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_012.jpg" /><div class="caption"><p>Character sprite sheet for downward walk cycle</p></div></div><p>
</p><p>Select all three of these images by clicking on the first image, holding down <span class="emphasis"><em>Shift</em></span>, and then clicking on the third image. Now drag and drop these three images into the <span class="strong"><strong>Animation</strong></span> window's <span class="strong"><strong>Dope Sheet</strong></span>. You should now see the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_013.jpg" /></div><p>
</p><p>Currently, this animation is way too fast. Clicking on the play button to play the game will demonstrate this. We will slow this character's animation by reducing the frame rate to 6 fps, by changing <span class="strong"><strong>Samples </strong></span>from <span class="strong"><strong>60</strong></span> to <span class="strong"><strong>6</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_014.jpg" /></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"></a>Note</h3><p>You can slow an animation in two ways: by adjusting the frame rate or by spacing the images further apart along the timeline. To move the images further apart, simply click and drag them to the frame you wish to place them.</p><p>Remember that 1:00 represents 1 second, not 1 minute.</p></div><p>Press <span class="strong"><strong>Play</strong></span> to play the game. You will now see that the animation is running much more naturally.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"></a>Note</h3><p>You can view the animation without running the game by pressing the play button within the Animation Window. However, to see this animation run, you will need to have both the animation and <span class="strong"><strong>Scene</strong></span> windows open, and the window tab configuration we discussed earlier does not allow that. You can adjust the location of your various windows so that you can have both the animation and scene window present. I recommend experimenting with moving the various tabs around to see where they can be placed.</p></div><p>While the animation has a better speed, it is not complete. Even though only three frames are given for her downward walk cycle, you actually have to use the center image twice to make the walk animation loop perfectly. The following figure demonstrates the logic behind a three-frame walk cycle:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_016.jpg" /></div><p>
</p><p>To make her animation complete, you must also have the second frame repeated at the end of the animation. So, place the <code class="literal">Protagonist_1</code> sprite as the fourth frame in the animation, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_017.jpg" /></div><p>
</p><p>Your animation should now appear as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_018.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec33"></a>Setting up the Animator and default state</h3></div></div></div><p>Remember, when we created the <code class="literal">PlayerWalkDown.anim</code> animation, an Animator Controller named <code class="literal">Playercontroller</code> was automatically made for us. We moved it into the <code class="literal">Assets/Animation/Controllers</code> folder. It was also automatically assigned to an Animator component in the Player's <span class="strong"><strong>Inspector</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_019.jpg" /><div class="caption"><p>Animator component in Player's Inspector</p></div></div><p>
</p><p>We are going the leave all of the default settings in the Animator component, but we will rename the Animator to make it easier to recognize later on. Let's rename our Animator as <code class="literal">PlayerWalking.controller</code> (note that you do not have to type the <code class="literal">.controller</code> extension). You can accomplish this by clicking on it twice slowly or pressing <span class="emphasis"><em>F2</em></span> on a keyboard:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_020.jpg" /><div class="caption"><p>Renaming Animator component</p></div></div><p>
</p><p>You will see that this name has been updated in the Player's <span class="strong"><strong>Inspector</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_021.jpg" /></div><p>
</p><p>When you open the Animator window, you should see the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_022.jpg" /></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note37"></a>Note</h3><p>Depending on how large your Animator window is, you may also see the red <span class="strong"><strong>Exit</strong></span> state. Do not worry about that state at this time, as we will not be using it. Sometimes, when you have more than one animation controller, it can be difficult to tell which animator you are working on. Notice that it tells you that name of the controller you are working with at the bottom right-hand side of the Animator window.</p></div><p>The <code class="literal">PlayerWalkDown.anim</code> animation has already been added to the Animator, and since it was the first animation we created, it has been designated the default state (as demonstrated by the fact that the animation is colored orange). When we begin our game, our character automatically starts walking downward, even when she is standing still. However, we want her to just face downward until we make her start walking. The reason she is animating initially is her default state is set to <code class="literal">PlayerWalkDown.anim</code>.</p><p>Let's fix this by creating an empty default state. Right-click anywhere within the Animator Window and select <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_023.jpg" /></div><p>
</p><p>Rename this from <code class="literal">New State</code> to <code class="literal">PlayerStandDown</code>. Then <span class="strong"><strong>right-click</strong></span> on it and select <span class="strong"><strong>Set as Layer Default State</strong></span> to make this Empty State be the new default state, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_024.jpg" /></div><p>
</p><p>You should now have an Animator that looks something like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_025.jpg" /><div class="caption"><p>Animator window</p></div></div><p>
</p><p>Run your game and you will see that the player now no longer automatically animates. In fact, she no longer animates at all! To get her to animate only when she's walking, we're going to have to tell the controller how and when her animation needs to run. Before we do that, however, let's set up the other animations the character will need.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec34"></a>Adding the other Animation Clips</h3></div></div></div><p>The character's sprite sheet had two other animations within it that we will need to set up to let our character convincingly walk around the screen: walking to the right and walking upward.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note38"></a>Note</h3><p>If you're wondering why we do not have a left walking animation, we will use the walking to the right frames to animate our character going both left and right.</p></div><p>Navigate back to the Animation window for the player. Now we will select <span class="strong"><strong>Create New Clip</strong></span> from the animation selection drop-down menu, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_026.jpg" /></div><p>
</p><p>Name the new clip <code class="literal">PlayerWalkUp.anim</code> and make sure you save it in the correct folder. Create this animation, as you did the downward walking one, by dragging the three appropriate images into the <span class="strong"><strong>Dope Sheet</strong></span>. Change the frame rate to <code class="literal">6</code>, as done previously. You should see the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_027.jpg" /><div class="caption"><p>Dope Sheet in Animator window</p></div></div><p>
</p><p>Do the same thing for the right walking images. Name this animation <code class="literal">PlayerWalkHorizontal.anim</code>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_028.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec35"></a>Planning the animation transitions</h3></div></div></div><p>Before we begin linking up the animations, let's discuss how we plan the character to move so that the logic we use will flow naturally when we start working with the animator and start programming her movement.</p><p>The character can currently move all around the screen in an up, down, left, right, or even diagonally. The first decision that needs to be made is which animation should be used when she is walking diagonally. Do we use the side view animation or the upward and downward facing animations? I personally like the second option, as demonstrated with the following figure:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_029.jpg" /></div><p>
</p><p>So, using the preceding image and the code we wrote in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Building your Project and Character</em></span> look at what is happening to make her move in these ways as well as what needs to happen, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_030.jpg" /><div class="caption"><p>Character transition</p></div></div><p>
</p><p>The important facts to garner from the diagram are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Only when <code class="literal">movePlayerVertical</code> is equal to 0, will the <code class="literal">PlayerWalkHorizontal</code> play</p></li><li style="list-style-type: disc"><p>If <code class="literal">movePlayerHorizontal</code> is less than 0, the <code class="literal">PlayerWalkHorizontal</code> animation must be flipped along the <code class="literal">x-axis</code>
</p></li><li style="list-style-type: disc"><p>If <code class="literal">movePlayerVertical</code> is greater than 0, <code class="literal">PlayerWalkUp</code> will play</p></li><li style="list-style-type: disc"><p>If <code class="literal">movePlayerVertical</code> is less than 0, <code class="literal">PlayerWalkDown</code> will play</p></li></ul></div><p>Also, when the character stops moving, she will need to stand still, with legs together facing the same direction she was moving previously. So, now that we have a general idea of how we want her to behave based on the code, we can start working on setting up the animation.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec36"></a>Connecting the animation states</h3></div></div></div><p>At the moment, our two states are not connected. So when we run the project, the hero is always standing still and facing downward; let's change that.</p><p>To tell the controller to move between the two states, we need the following prerequisites:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A transition link between the two states</p></li><li style="list-style-type: disc"><p>A parameter or event to activate the transition</p></li><li style="list-style-type: disc"><p>Something to change the value of that parameter, usually in a script</p></li></ul></div><p>Since we last viewed our Animator, we added two new walking animations. Return to your <span class="strong"><strong>Animator</strong></span> window and adjust the position of your animations so that they look something like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_031.jpg" /></div><p>
</p><p>To allow our character to move between the animations, we need to set up <span class="strong"><strong>Transitions </strong></span>between animations. She will be able to walk downward, upward, or horizontally, regardless of what her last animation was. So, this means that we want to transition from <span class="strong"><strong>Any State </strong></span>to these three animations.</p><p>So, first, we create the transition between the <span class="strong"><strong>Any State </strong></span>and the downward walking state by right-clicking on <span class="strong"><strong>Any State</strong></span> and selecting <span class="strong"><strong>Make Transition</strong></span>. This will change the mouse cursor to an arrow. Then, click on the state we want to transition to, which in this case is the <span class="strong"><strong>PlayerWalkDown</strong></span> state. Do this from <span class="strong"><strong>Any State</strong></span> to <span class="strong"><strong>PlayerWalkUp</strong></span> and <span class="strong"><strong>Any State</strong></span> to <span class="strong"><strong>PlayerWalkHorizontal</strong></span> as well. When you are done, you should have something that looks like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_032.jpg" /><div class="caption"><p>State machine for character transition</p></div></div><p>
</p><p>Setting up the transitions in this way tells the Animator that the character can be standing in the default state, and can go to any of the three animations and then from those animations can transition to any other animation.</p><p>Now that we have told the Animator what states can transition to these animations, we need to tell it when these transitions will occur. We will do this by setting up Parameters and Transition Conditions.</p><p>Clicking on the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkDown</strong></span> shows you the properties of that transition in the Inspector, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_033.jpg" /><div class="caption"><p>PlayerWalkDown transition properties</p></div></div><p>
</p><p>Clicking on the arrow next to <span class="strong"><strong>Settings</strong></span> will show further information, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_034.jpg" /><div class="caption"><p>More PlayerWalkDown transition properties</p></div></div><p>
</p><p>As shown in the <span class="strong"><strong>Inspector</strong></span> pane, by default, the new transitions are controlled by a single parameter called <span class="strong"><strong>Exit Time</strong></span>, which simply means that when the first animation ends, it will transition to the second. We don't want that here as we want a specific event to control when the <span class="strong"><strong>PlayerWalkDown</strong></span> animation is activated.</p><p>Change the <span class="strong"><strong>Settings</strong></span> so that they appear as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_035.jpg" /><div class="caption"><p>Changed settings for PlayerWalkDown</p></div></div><p>
</p><p>Change the settings for the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkUp</strong></span> and the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkHorizontal</strong></span> in the same way.</p><p>When you deselect <span class="strong"><strong>Exit Time</strong></span>, you will see the following warning stating that a transition needs at least one condition:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_036.jpg" /><div class="caption"><p>Deselect Exit Time warning</p></div></div><p>
</p><p>We will give it a condition by creating a <span class="strong"><strong>transition parameter</strong></span>. To add a new parameter, select the <span class="strong"><strong>Parameters </strong></span>tab, click on the <span class="emphasis"><em>+</em></span> symbol in the parameter section, and then select <span class="strong"><strong>Int</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_037.jpg" /></div><p>
</p><p>Name this parameter <code class="literal">yMove</code>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_038.jpg" /></div><p>
</p><p>We will use this <code class="literal">yMove</code> parameter to tell the animator when to transition to the <span class="strong"><strong>PlayerWalkDown</strong></span> and <span class="strong"><strong>PlayerWalkUp</strong></span> animations, as shown in the following figure:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_039.jpg" /></div><p>
</p><p>Select the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkDown</strong></span>. Select the <span class="emphasis"><em>+</em></span> symbol in the <span class="strong"><strong>Conditions</strong></span> section. Since <code class="literal">yMove</code> is our only parameter, it will automatically be placed as the condition parameter. Select <span class="strong"><strong>Less</strong></span> from the drop-down menu, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_040.jpg" /><div class="caption"><p>Selecting Less in Condition parameter</p></div></div><p>
</p><p>It is now stating that whenever the <code class="literal">yMove</code> parameter is less than 0, the Player will run her <span class="strong"><strong>PlayerWalkDown</strong></span> animation.</p><p>We will do the same thing for the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkUp</strong></span>, but we will leave <span class="strong"><strong>Greater</strong></span> in the drop-down menu, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_041.jpg" /><div class="caption"><p>Selecting Greater in Condition parameter</p></div></div><p>
</p><p>Now we can set up a parameter for the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkHorizontal</strong></span>. For this, we will create a Boolean parameter by selecting Bool from the new parameter menu and naming it <code class="literal">xMove</code>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_042.jpg" /></div><p>
</p><p>We will use this <code class="literal">xMove</code> parameter to tell the animator when to transition to the <span class="strong"><strong>PlayerWalkHorizontal</strong></span> animation, as shown in the following figure:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_043.jpg" /></div><p>
</p><p>Now select the transition between <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>PlayerWalkHorizontal</strong></span>. Change the <span class="strong"><strong>Condition</strong></span> to <code class="literal">xMove</code> to <code class="literal">true,</code> as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_044.jpg" /><div class="caption"><p>Selecting true in condition parameter</p></div></div><p>
</p><p>If you run the game at this point, the character still doesn't walk when she moves. We've told the Animator when the transitions need to occur, but we haven't actually done anything to make these parameter values change. For this, we need to update our <code class="literal">CharacterMovement</code> script.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec37"></a>Accessing controllers from a script</h3></div></div></div><p>Now that we have an animator attached to our Player GameObject, we can adjust its parameters using scripts. To do so, we are going to update our <code class="literal">CharacterMovement.cs</code> script with the following two things:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a variable for the Animator so that we can reference it in the script.</p></li><li><p>Use <code class="literal">GetComponent</code> to find the Animator component attached to the Player.</p></li></ol></div><p>Let's first create a variable for the Animator. Add the following code to your variable declarations:</p><pre class="programlisting">// Animator component for the player &#13;
private Animator playerAnim; &#13;
</pre><p>Now let's reference the animator component and assign it to the new variable <code class="literal">playerAnim</code>. Add the following code to your <code class="literal">Awake()</code> function:</p><pre class="programlisting">playerAnim=(Animator)GetComponent(typeof(Animator)); &#13;
</pre><p>Now we can reference the player's animator within our script.</p><p>We also need to be able to access the player's sprite renderer from within the script. The <code class="literal">SpriteRender</code> now has the ability to easily flip a sprite in the <span class="emphasis"><em>x</em></span> or <span class="emphasis"><em>y</em></span> direction, and we will use this property to make the character face left when walking left. We will access the sprite rendered in the same way we accessed the animator, that is, by declaring a variable and then referencing it.</p><p>Let's first create a variable for the sprite renderer. Add the following code to your variable declarations:</p><pre class="programlisting">//Sprite renderer for the player &#13;
private SpriteRenderer playerSpriteImage; &#13;
</pre><p>Now let's reference the sprite renderer component and assign it to the new <code class="literal">playerSpriteImage</code> variable. Add the following code to your <code class="literal">Awake()</code> function:</p><pre class="programlisting">playerSpriteImage =(SpriteRenderer)GetComponent(typeof(SpriteRenderer)); &#13;
</pre><p>Now we can reference the player's animator within our script.</p><p>Recall the values the parameters need to hold for the transitions to occur, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_045.jpg" /><div class="caption"><p>Parameter values for state transition</p></div></div><p>
</p><p>And recall the conditions that will make the parameters change, as shown in the following figure:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_046.jpg" /></div><p>
</p><p>To reflect these conditions in the code, add the following lines of code to your <code class="literal">Update()</code> function:</p><pre class="programlisting">if(movePlayerVertical!=0){ &#13;
   playerAnim.SetBool("xMove",false); &#13;
   playerSpriteImage.flipX=false; &#13;
 &#13;
   if(movePlayerVertical&gt;0){ &#13;
       playerAnim.SetInteger("yMove",1); &#13;
 &#13;
   }else if(movePlayerVertical&lt;0){ &#13;
         playerAnim.SetInteger("yMove",-1); &#13;
 &#13;
   } &#13;
}else { &#13;
   playerAnim.SetInteger("yMove",0); &#13;
 &#13;
   if(movePlayerHorizontal&gt;0){ &#13;
       playerAnim.SetBool("xMove",true); &#13;
         playerSpriteImage.flipX=false; &#13;
             &#13;
   }else if(movePlayerHorizontal&lt;0){ &#13;
          playerAnim.SetBool("xMove",true); &#13;
          playerSpriteImage.flipX=true; &#13;
 &#13;
   }else{ &#13;
          playerAnim.SetBool("xMove",false); &#13;
   } &#13;
}  &#13;
</pre><p>Your character should now walk around the screen in all the appropriate directions. However, she won't stop walking when she stops moving! We're going to have to create a few more animations and another transition parameter to make this work appropriately.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec38"></a>Making her stop animating and face the correct direction</h3></div></div></div><p>We are almost done with our character's animation. We only need to do a little more so that she will stop animating when she stops moving. To accomplish this, we will first make three idle animations, one for each of her directions. The easiest way to do this is to duplicate her walking animations and then edit them appropriately.</p><p>Select the <code class="literal">PlayerWalkDown.anim</code> animation from the <span class="strong"><strong>Project</strong></span> view and type <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span> to duplicate the animation. Rename the new animation as <code class="literal">PlayerIdleDown.anim</code>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_047.jpg" /></div><p>
</p><p>Drag and drop the new <span class="strong"><strong>PlayerIdleDown </strong></span>animation to the Player's Animator, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_048.jpg" /><div class="caption"><p>PlayerIdleDown animation</p></div></div><p>
</p><p>Open the Animation window and select the new <span class="strong"><strong>PlayerIdleDown</strong></span> animation from the drop-down menu. The animation will only show up in this drop-down menu if you have already added it to the animator, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_049.jpg" /></div><p>
</p><p>Delete the first, third, and fourth images and then drag the remaining image so that it is in the <code class="literal">0:0</code> position. You should now have an animation with only a single image, the image in which the character is standing still and facing downward, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_050.jpg" /></div><p>
</p><p>Repeat this process to create <code class="literal">PlayerIdleUp</code> and <code class="literal">PlayerIdleHorizontal</code> animations. The following screenshot shows <code class="literal">PlayerIdleUp</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_051.jpg" /></div><p>
</p><p>The following screenshot shows <code class="literal">PlayerIdleHorizontal</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_052.jpg" /></div><p>
</p><p>Now we need to set up our transitions in the <span class="strong"><strong>Animator</strong></span>. Set up transitions from your walking animations to idle animations, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_053.jpg" /></div><p>
</p><p>Change the settings on each of these transitions to the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_054.jpg" /></div><p>
</p><p>Now we will use a Boolean parameter to transition to these idle animations. Create a <span class="strong"><strong>Bool</strong></span> parameter called <code class="literal">moving</code>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/image_03_055.jpg" /></div><p>
</p><p>Now, set the conditions of each of the new transitions so that they run when <code class="literal">moving</code> is <span class="strong"><strong>false</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463456/graphics/B05553_03_54.jpg" /></div><p>
</p><p>The only thing we have to do now is adjust the code to tell <code class="literal">moving</code> to change from <code class="literal">true</code> to <code class="literal">false</code>. This is actually simpler than the preceding animation code and can be accomplished by adding the following code to the <code class="literal">Update()</code> function:</p><pre class="programlisting">if(movePlayerVertical==0 &amp;&amp; movePlayerHorizontal==0){ &#13;
            playerAnim.SetBool("moving",false); &#13;
}else{ &#13;
            playerAnim.SetBool("moving",true); &#13;
} &#13;
</pre><p>Add the preceding code to the <code class="literal">Update()</code> function before the <code class="literal">if</code> statement that triggered the animations and after the statement that assigns the player's velocity.</p><p>Now your character should be able to walk around and stand around while facing the correct direction!</p></div></div>