<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch13lvl1sec94"></a>Working with settings</h2></div></div><hr /></div><p>Saving data is always important, especially in games where you need to keep track of the player's progress or at the very least maintain a track record of scores, plays, and other important data.</p><p>Within Unity, there is only one method of storing data natively, and that is <code class="literal">PlayerPrefs</code>. It is very simple to use and very flexible, although it does have a hard limit of 1 MB of storage for the web player. It is possible to serialize data into <code class="literal">PlayerPrefs</code> (and some developers do this), but generally if you need to serialize, most developers build their own system.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec159"></a>Using PlayerPrefs</h3></div></div></div><p>
<code class="literal">PlayerPrefs</code> is simply a key dictionary to store individual variables as a key in the Unity runtime data store. On its own, it has to read each and every scene at runtime, which is why most games use a static class to keep the state stored in <code class="literal">PlayerPrefs</code> and only use it between scenes for scene-specific configuration.</p><p>Using <code class="literal">PlayerPrefs</code> is very easy and simple. The process is the same as any other dictionary to save a setting for your call:</p><pre class="programlisting">PlayerPrefs.SetInt("PlayerScore", currentScore); &#13;
PlayerPrefs.SetFloat("PlayerDamage", currentDamage); &#13;
PlayerPrefs.SetString("PlayerName", currentPlayerName); &#13;
</pre><p>Loading it back again when you need it again involves the following code:</p><pre class="programlisting">currentScore = PlayerPrefs.GetInt("PlayerScore"); &#13;
currentDamage = PlayerPrefs.GetFloat("PlayerDamage"); &#13;
currentPlayerName = PlayerPrefs.GetString("PlayerName"); &#13;
</pre><p>You can also supply defaults to values with a second parameter if the setting does not yet exist, as follows:</p><pre class="programlisting">currentScore = PlayerPrefs.GetInt("PlayerScore", 0); &#13;
currentDamage = PlayerPrefs.GetFloat("PlayerDamage", 0); &#13;
currentPlayerName = PlayerPrefs.GetString("PlayerName", "New Player"); &#13;
</pre><p>By default, Unity will save the settings to disk when the application is closed. However, it's recommended that you save them intermittently when possible by calling the following:</p><pre class="programlisting">PlayerPrefs.Save() &#13;
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note152"></a>Note</h3><p>Saving settings in Unity isn't necessarily a given and should not be treated as safe. The settings file has a hard limit of 1 MB of storage on the web player. If this is exceeded, it will throw an exception. This limit is for each application.</p><p>So, you can either drastically limit what settings you store (recommended) or wrap your <code class="literal">SET PlayerPrefs</code> calls in a <code class="literal">try</code>/<code class="literal">catch</code> statement to be safe if you plan to deploy to the web player.</p><p>Other platforms do not have this limitation.</p></div><p>There are also <code class="literal">delete</code> functions to remove either a single key or to clear the cache completely.</p><p>For more information about <code class="literal">PlayerPrefs</code>, see the Unity reference guide at <a class="ulink" href="https://docs.unity3d.com/Documentation/ScriptReference/PlayerPrefs.html" target="_blank">https://docs.unity3d.com/Documentation/ScriptReference/PlayerPrefs.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec160"></a>Serializing your data</h3></div></div></div><p>To store any kind of complicated data or structure, you need to serialize it into a concatenated format. The result can then be stored in <code class="literal">PlayerPref</code> as mentioned previously or saved on a disk or the web.</p><p>There are several types of serializer you can use, including the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Binary serialization</strong></span>: This is binary-formatted output and is non-human-readable</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>XML serialization</strong></span>: This is the basic text output formatted into XML and is human-readable</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>JSON serialization</strong></span>: This is a compressed standalone output in XML format; it is human-readable and allows you to have a manual implementation</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Custom serialization</strong></span>: This is DIY and is used to build your own serialized output</p></li></ul></div><p>Each serializer has performance or security gains. There isn't a one-size-fits-all; just choose the serializer that fits your purposes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note153"></a>Note</h3><p>To learn more about generics (a fairly advanced topic), check out the MSDN documentation at <a class="ulink" href="http://msdn.microsoft.com/en-gb/library/512aeb7t.aspx" target="_blank">http://msdn.microsoft.com/en-gb/library/512aeb7t.aspx</a>.</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip154"></a>Tip</h3><p>Not all platforms support all serializers; also, some classes (such as <code class="literal">MemoryStream</code>) are not available on all platforms. You will sometimes have to tailor the approach you use to work with other platforms. If you do, however, make sure you do it within the helper classes so that all the platform-variant code is in one place and does not clutter up your game.</p></div><p>Serialization is important as it can be used anywhere you need to package data to be saved or even transmitted over the wire for a cloud backup or even network play.</p><p>For more information about serialization, see the MSDN .NET reference guide at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/ms172360(v=vs.110).aspx" target="_blank">http://msdn.microsoft.com/en-us/library/ms172360(v=vs.110).aspx</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec161"></a>Saving data to disk</h3></div></div></div><p>Another way to manage the way your games save data is to serialize it to disk; there is a method you will use to determine how fast and secure this is.</p><p>Instead of using <code class="literal">PlayerPrefs</code>, it is better to manage the saving and loading of your player data to a disk (or the Web; see the following sections). Thankfully, <span class="strong"><strong>MonoDevelop</strong></span> (the C# engine behind Unity3D) provide common functions to access the disk across all the platforms that Unity supports.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note155"></a>Note</h3><p>There are exceptions, however, due to platform limitations or specializations in some platforms. In these cases, Unity provides special classes to access platform components, for example, the <code class="literal">UnityEngine.Windows</code> namespace.</p></div><p>You can also write disk access routines that are more platform-specific if you wish to make them more performant, but this requires you to write an interface and your platform-specific code for each routine.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch13lvl2sec162"></a>Backing up to the Web</h3></div></div></div><p>As an alternative to the basic way of saving data to a disk, a lot of games now (especially if they are targeting multiple platforms) support a web backend to store a player's data. It doesn't need to be heavy; just use a player name/ID key and store the serialized data.</p><p>The benefit of this approach is that the player can continue playing on any device, regardless of which device they were last playing on.</p><p>Implementing this approach depends on the backend service you use for your data.</p><p>The simplest approach is to use the serialization methods described previously and post your data to a backend web service using the Unity <code class="literal">WWW</code> class. As a full example would be too complex to demonstrate; what follows is just some code snippets of the available Unity functions.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note156"></a>Note</h3><p>To back up on the Web, you will have to write your web service on a server to accept this data, which is beyond the scope of this book, but if you search on <a class="ulink" href="http://www.codeproject.com/" target="_blank">www.codeproject.com</a> or <a class="ulink" href="http://stackoverflow.com/" target="_blank">stackoverflow.com</a>, you will find many good examples of such implementations.</p></div><p>For more information about the <code class="literal">WWW</code> class, see the Unity scripting reference guide at <a class="ulink" href="https://docs.unity3d.com/Documentation/ScriptReference/WWW.html" target="_blank">https://docs.unity3d.com/Documentation/ScriptReference/WWW.html</a>.</p></div></div>