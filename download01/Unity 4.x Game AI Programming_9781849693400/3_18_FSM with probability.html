<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec22"></a>FSM with probability</h2></div></div><hr /></div><p>We discussed Finite <a id="id133" class="indexterm"></a>State Machines (FSM) in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Finite State Machines</em></span>, using both simple switch statements as well as using the FSM framework. The decision to <a id="id134" class="indexterm"></a>choose which state to execute was purely based on true or false value of a given condition. Remember the following FSM of our AI controlled tank entity?</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_03_02.jpg" /><div class="caption"><p>Tank AI FSM</p></div></div><p>To make the AI more interesting, and a little bit unpredictable, we can give our tank entity some options with probabilities to choose from, instead of doing the same thing whenever a certain condition is met. <a id="id135" class="indexterm"></a>For example, in our earlier FSM, our AI tank will chase the player tank once the player is in its line of sight. Instead we can give our AI another state, such as flee with some <a id="id136" class="indexterm"></a>probability such as 50 percent as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_03_03.jpg" /><div class="caption"><p>FSM using probability</p></div></div><p>Now instead of chasing every time, the AI tank spots the player; there's a 50 percent chance that it'll flee, and maybe report to the headquarters or something. We can implement this mechanic the same way we did with our previous dice example. First we need to generate a random value between one and 100, and see if the value lies between one and 50 or 51 and 100. (Or we could randomly choose between zero and one.) Then choose a state accordingly. The other way to implement this is to fill an array with these options in proportion to their respective probabilities. Then pick a random state from this pool as if you were drawing a lottery winner. Let's see how to use this technique as shown in the following <code class="literal">FSM.cs</code> file:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class FSM : MonoBehaviour {
  public enum FSMState {
    Chase,
    Flee
  }

  public int chaseProbabiilty = 50;
  public int fleeProbabiilty = 50;

  //a poll to store the states according to their
    //probabilities
  public ArrayList statesPoll = new ArrayList();
  void Start () {
    //fill the array
      for (int i = 0; i &lt; chaseProbabiilty; i++) {
        statesPoll.Add(FSMState.Chase);
      }
      for (int i = 0; i &lt; fleeProbabiilty; i++) {
        statesPoll.Add(FSMState.Flee);
      }
    }

  void OnGUI() {
      if (GUI.Button(new Rect(10,10,150,40),
        "Player on sight")) {
         int randomState = Random.Range(0, statesPoll.Count);
         Debug.Log(statesPoll[randomState].ToString());
      }
    }
}</pre></div><p>In our <code class="literal">OnGUI()</code> method, <a id="id137" class="indexterm"></a>when you click on the mouse button, we just choose one random item from our <a id="id138" class="indexterm"></a>
<code class="literal">statesPoll</code> array. <a id="id139" class="indexterm"></a>Obviously, the one with more entries in the poll will have a higher chance to be selected. Try it out.</p></div>