<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec44"></a>Setting up the map</h2></div></div><hr /></div><p>To get started, we'll build a simple scene, as <a id="id357" class="indexterm"></a>shown in the following figure. This is the first scene in our sample project called <code class="literal">NavMesh01-Simple.scene</code>. You can use a plane as a ground object and several cube entities as the wall objects. Later, we'll put in some AI agents (of course, our all time favorite tanks) to go to the mouse-clicked position, as in an RTS game.</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_08_01.jpg" /><div class="caption"><p>Scene with obstaclesâ€”NavMesh01-Simple.scene</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec50"></a>Navigation Static</h3></div></div></div><p>Once we've added the walls and ground, it's <a id="id358" class="indexterm"></a>important to mark them as <span class="strong"><strong>Navigation Static</strong></span>, so that the navmesh generator knows those are the static obstacle objects to avoid. To do this, select all those objects, click on the <span class="strong"><strong>Static</strong></span> button, and choose <span class="strong"><strong>Navigation Static</strong></span>, as shown in the following figure.</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_08_02.jpg" /><div class="caption"><p>The Navigation Static property</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec51"></a>Baking the navigation mesh</h3></div></div></div><p>Now we're done with our scene. Let's <a id="id359" class="indexterm"></a>bake the navmesh. Firstly, we need to open the navigation window. Navigate to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Navigation</strong></span>, and you should be able to see a window like this:</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_08_03.jpg" /><div class="caption"><p>Navigation window</p></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note07"></a>Note</h3><p>All these properties are pretty much self-explanatory and you can check out the following Unity reference <a id="id360" class="indexterm"></a>documentation to learn more:</p><p><a class="ulink" href="http://docs.unity3d.com/Documentation/Manual/Navmeshbaking.html" target="_blank">http://docs.unity3d.com/Documentation/Manual/Navmeshbaking.html</a></p></div><p>For now, we'll leave with the default <a id="id361" class="indexterm"></a>values and just click on <span class="strong"><strong>Bake</strong></span>. You should see a progress bar baking the navmesh for your scene, and after a while you'll see your navmesh in your scene, as shown in following diagram.</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_08_04.jpg" /><div class="caption"><p>Navigation mesh baked</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec52"></a>Nav Mesh Agent</h3></div></div></div><p>We're pretty much done with <a id="id362" class="indexterm"></a>setting up our super simple scene. Now, let's add some AI agents to see if it works. We'll use our tank model here. But if you're working with your own scene and don't have this model, you can just put a cube or a sphere entity as an agent. It'll work the same way.</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_08_05.jpg" /><div class="caption"><p>Tank entity</p></div></div><p>The next step is to add the <span class="strong"><strong>Nav Mesh Agent</strong></span> component to our tank entity. This component makes path finding really easy. We don't need to deal with path finding algorithms like A* anymore. By just <a id="id363" class="indexterm"></a>setting the <code class="literal">destination</code> property of the component during runtime, our AI agent will automatically find the path itself.</p><p>Navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Navigation</strong></span> | <span class="strong"><strong>Nav Mesh Agent</strong></span> to add this component.</p><div class="mediaobject"><img src="/graphics/9781849693400/graphics/3400_08_06.jpg" /><div class="caption"><p>Nav Mesh Agent properties</p></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>Unity reference for Nav Mesh Agent <a id="id364" class="indexterm"></a>component can be found at <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/class-NavMeshAgent.html" target="_blank">http://docs.unity3d.com/Documentation/Components/class-NavMeshAgent.html</a></p></div><p>One property to note is the <code class="literal">NavMesh Walkable</code> property. This specifies the navmesh layers that this navmesh agent can walk. We'll talk about navigation layers in the <span class="emphasis"><em>NavMeshLayers</em></span> section.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec10"></a>Updating agents' destinations</h4></div></div></div><p>Now we've set up our AI agent, <a id="id365" class="indexterm"></a>we need a way to tell this agent where to go and update the destination of our tanks to the mouse-click position.</p><p>So, let's add a sphere entity to be used as a marker object, and then attach the following <code class="literal">Target.cs</code> script to an empty game object. Drag-and-drop this sphere entity onto this script's <code class="literal">targetMarker</code> transform property in the inspector.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch08lvl4sec01"></a>The Target.cs class</h5></div></div></div><p>This is a simple class <a id="id366" class="indexterm"></a>that does three things:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Gets the mouse-click position using a ray</p></li><li style="list-style-type: disc"><p>Updates the marker position</p></li><li style="list-style-type: disc"><p>Updates the destination <a id="id367" class="indexterm"></a>property of all the navmesh agents</p></li></ul></div><p>The following lines show the <a id="id368" class="indexterm"></a>code present in this class:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class Target : MonoBehaviour {
  private NavMeshAgent[] navAgents;
  public Transform targetMarker;

  void Start() {
    navAgents = FindObjectsOfType(typeof(NavMeshAgent)) as 
        NavMeshAgent[];
  }

  void UpdateTargets(Vector3 targetPosition) {
    foreach (NavMeshAgent agent in navAgents) {
      agent.destination = targetPosition;
    }
  }

  void Update() {
    int button = 0;

    //Get the point of the hit position when the mouse is 
    //being clicked
    if(Input.GetMouseButtonDown(button)) {
      Ray ray = Camera.main.ScreenPointToRay(
          Input.mousePosition);

      RaycastHit hitInfo;

      if (Physics.Raycast(ray.origin, ray.direction, 
          out hitInfo)) {
        Vector3 targetPosition = hitInfo.point;
        UpdateTargets(targetPosition);
        targetMarker.position = targetPosition + 
            new Vector3(0,5,0);
      }
    }
  }
}</pre></div><p>At the start of the game, we look for all the <code class="literal">NavMeshAgent</code> type entities in our game and store them in our reference <a id="id369" class="indexterm"></a>
<code class="literal">NavMeshAgent</code> array. Whenever there's a mouse-click event, we do a simple raycast to determine the first objects that collide with our ray. If the ray hits any object, we update the position of our marker and update each navmesh agent's destination by setting the destination property with the new position. We'll be using this script throughout this chapter to tell the destination position for our AI agents.</p><p>Now, test run the scene, and click on a <a id="id370" class="indexterm"></a>point where you want your tanks to go. The tanks should come as close as possible to that point while avoiding the static obstacles like walls.</p></div></div></div></div>