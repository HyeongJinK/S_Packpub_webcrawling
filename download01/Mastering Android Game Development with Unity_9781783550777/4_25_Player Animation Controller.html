<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec27"></a>Player Animation Controller</h2></div></div><hr /></div><p>To create a new Animation Controller right-click on the <code class="literal">Assets</code> folder in the project, select the <strong class="userinput"><code>Create</code></strong> option, and then select <strong class="userinput"><code>Animation Controller</code></strong> from the list:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_008.png" /></div><p>Rename the file to <strong class="userinput"><code>dudeAC</code></strong> and double-click on it:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_009.png" /></div><p>When you double-click on it, a new panel will open up called <strong class="userinput"><code>Animation</code></strong>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_010.png" /></div><p>The Animation Controller basically controls the flow of the animation. There are three states that are added in by default; these are <strong class="userinput"><code>Entry</code></strong>, <strong class="userinput"><code>Any State</code></strong>, and <strong class="userinput"><code>Exit</code></strong>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The <strong class="userinput"><code>Entry</code></strong> state specifies which animation will be played at the start of the scene. So, in most cases the first animation that gets played is the idle animation.</li><li style="list-style-type: disc">The <strong class="userinput"><code>Any State</code></strong> specifies which animation needs to be executed irrespective of the previous animation that is being played.</li><li style="list-style-type: disc">The <strong class="userinput"><code>Exit</code></strong> state is the animation that is played at the exit of the scene.</li></ul></div><p>Let's set up the states for the player, which will be the same setup for the enemy as well.</p><p>First, we will create the default animation so that, when the scene starts, the idle animation gets played. In the <strong class="userinput"><code>Animator</code></strong> panel, right-click anywhere, select <strong class="userinput"><code>Create </code></strong>State option from the list, and then select the <strong class="userinput"><code>Empty</code></strong> option, as depicted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_011.png" /></div><p>Select the <strong class="userinput"><code>New State</code></strong> created and open the <strong class="userinput"><code>Inspector</code></strong> panel.</p><p>Next, we need to create a transition from the <strong class="userinput"><code>Entry</code></strong> state. Right-click on it, a <strong class="userinput"><code>Make transition</code></strong> option will open, so click on this option. An arrow will start from the clicked state. Now click on the state that we need to transition. This will create a transition to that new state as depicted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_012.png" /></div><p>Next, rename the new state to <strong class="userinput"><code>idle</code></strong>. Click on the new state and rename the state to <strong class="userinput"><code>Idle </code></strong>and change the <strong class="userinput"><code>Motion</code></strong> field to <strong class="userinput"><code>idle</code></strong> by selecting the small circle next to it:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_013.png" /></div><p>To test if the controller works, drag and drop <code class="literal">theDude</code> character on to the hierarchy and place him perpendicular to the camera as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_014.png" /></div><p>Select the<strong class="userinput"><code> Dude</code></strong> character in the scene and in the <strong class="userinput"><code>Inspector</code></strong> panel, then drag and drop the Animation Controller on the <strong class="userinput"><code>Controller</code></strong> field in the <strong class="userinput"><code>Animator</code></strong> component as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_015.png" /></div><p>Click the play button up top and you should see the character with the idle animation playing. Now that we are sure that it is working properly, we can go into the Animation Controller and add states that are required for the game.</p><p>In <strong class="userinput"><code>Any State</code></strong> state, we should be able to have the <strong class="userinput"><code>defend</code></strong>, <strong class="userinput"><code>Punch</code></strong> and also <strong class="userinput"><code>GetHit</code></strong> animations. If the player is not in any of these states then he should revert to <strong class="userinput"><code>idle</code></strong> state.</p><p>So, in the Animation Controller, add the three states, attach the respective animations in the motion, and change the name of each state accordingly. After creating the three states, we also need to transition between the <strong class="userinput"><code>Any State</code></strong> state and each of these states, and when each of the states has finished, it needs to transition back to the idle state.</p><p>To create a transition from a given state, right-click on it: a <strong class="userinput"><code>Make Transition</code></strong> option will open. Click on it, and an arrow will start from the clicked state. Next, click on the state that we want to transition to. This will create a transition to that state. The transitions are shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_016.png" /></div><p>Each of these transitions will be controlled through a script. To trigger each of the states, we will use either Booleans or triggers to enable these state changes.</p><p>To create these parameters, click on the <strong class="userinput"><code>Parameters</code></strong> tab at the side of the <strong class="userinput"><code>Animator</code></strong> panel.</p><p>To create a new parameter, click on the + sign next to the search bar. You can either create a float, integer, Boolean, or a trigger parameter.</p><p>For our purpose, we created a Boolean parameter, called <strong class="userinput"><code>bIsDefending</code></strong>, and two trigger parameters, called <strong class="userinput"><code>tGotHit</code></strong> and <strong class="userinput"><code>tIsPunching</code></strong>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_017.png" /></div><p>The difference between a Boolean and a trigger is that a trigger will set itself to false once it has been activated where as a Boolean has to have <code class="literal">true</code> and <code class="literal">false</code> set programmatically.</p><p>Let us see how it is implemented in the current game. First, we'll set the transitions for <strong class="userinput"><code>Punch</code></strong> and <strong class="userinput"><code>GetHit</code></strong> animations; we will then look at defend after. Select the transition arrow from <strong class="userinput"><code>Any State</code></strong> to <strong class="userinput"><code>Punch</code></strong>.</p><p>You know the transition has been selected when the arrow turns blue. The screenshot shows how the default state looks. We are going to make some changes here:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_018.png" /></div><p>First of all, we want this transition to occur only when the player is punching. So in the <strong class="userinput"><code>Conditions</code></strong> tab, press the + sign and add the <strong class="userinput"><code>tInPunching</code></strong> condition.</p><p>Secondly, uncheck the <strong class="userinput"><code>Has Exit Time</code></strong> option. If this is checked then the transition will only occur once the previous animation has completed playing. We don't want that. We want the player to start playing the punching animation as soon as we click the <strong class="userinput"><code>Punch</code></strong> button.</p><p>Thirdly, and most importantly, the animation preview window shows the animation played during the transition. Initially it shows that the animation will start from zero, play the idle animation, and then transition to the punch animation. We actually only want the punch animation to start immediately, and we just want one frame of transition between idle and punch animations.</p><p>So, we bring the <strong class="userinput"><code>Punch</code></strong> back to the start and also make the start and stop really small as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_019.png" /></div><p>Now let's look at the <strong class="userinput"><code>Punch</code></strong> to <strong class="userinput"><code>Idle</code></strong> animation:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_020.png" /></div><p>Here, we keep the <strong class="userinput"><code>Has Exit Time</code></strong> option checked as we want the animation to finish and then play the idle animation. Also, the idle animation is pulled back to the start and the animation play time is also reduced to one frame.</p><p>The same is done for the transition from <strong class="userinput"><code>Any State</code></strong> to <strong class="userinput"><code>GetHit</code></strong> as shown in the following screenshot. But here the condition is changed to <strong class="userinput"><code>tGotHit</code></strong> instead:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_021.png" /></div><p>Similarly, from <strong class="userinput"><code>GetHit</code></strong> to <strong class="userinput"><code>idle</code></strong> state:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_022.png" /></div><p>Let's look at how to create transitions from <strong class="userinput"><code>Any State</code></strong> to the <strong class="userinput"><code>defend</code></strong> state, and then from <strong class="userinput"><code>defend</code></strong> to the <strong class="userinput"><code>idle</code></strong> state. The transition from <strong class="userinput"><code>Any State</code></strong> to the <strong class="userinput"><code>defend</code></strong> state should be changed to as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_023.png" /></div><p>Here, once again, we move the defend animation back and change the play to one frame. The <strong class="userinput"><code>Has Exit Time</code></strong> option is checked and now the condition is changed to <strong class="userinput"><code>bIsDefending</code></strong>, which is set to <strong class="userinput"><code>true</code></strong>. For the transition from <strong class="userinput"><code>defend</code></strong> to <strong class="userinput"><code>idle</code></strong> animation, we set the <strong class="userinput"><code>bIsDefending</code></strong> to <strong class="userinput"><code>false</code></strong> and change the animation width as usual:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_024.png" /></div><p>For the transition from <strong class="userinput"><code>idle</code></strong> to <strong class="userinput"><code>defend</code></strong>, we do it similarly to how we did for <strong class="userinput"><code>Any State</code></strong> to <strong class="userinput"><code>defend</code></strong>, except we uncheck the <strong class="userinput"><code>Has Exit Time</code></strong> checkbox, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_025.png" /></div><p>With that we are through the Animation Controllers.</p></div>