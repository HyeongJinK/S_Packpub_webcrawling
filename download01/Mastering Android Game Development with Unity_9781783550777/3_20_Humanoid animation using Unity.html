<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec23"></a>Humanoid animation using Unity</h2></div></div><hr /></div><p>Animations are the core component of any game. Without them, a game is just a sequence of pictures and the user will have no idea of what's going on in the game. We learned about animations in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Finishing the Perky Penguin 2D Game</em></span>, for our 2D game, Perky Penguin, to control the animations of a penguin and lasers using state machines and controllers. But, when it comes to 3D, things get a lot more complicated to manage and handle. The reasons for this complexity varies depending on what kind of animations we want to create and manage in Unity, but generally creating character animations such as walk cycle or running cycle takes a lot of effort and cannot be made in Unity. These animations need more details and are developed in advanced tools such as Autodesk Maya, 3D Studio Max, and so on. In this section, we will not discuss how these animations are created, as it is beyond the scope of this book, but we will discuss how these animations are imported in Unity and managed further with programming and state machine controllers to achieve our game requirements of animating a player character for the fighting game.</p><p>Unity's animation system allows you to create amazingly animated characters by the support of animation blending, mixing, additive animations, loop animations, time synchronization such as walk cycle, layered animations, animation control playback on factors like speed, time, and so on, and the support of physically-based rag dolls. Unity provides extended graphical user interfaces to make things much easier as compared to previous animation tools such as Adobe Flash.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec40"></a>Legacy Animation System</h3></div></div></div><p>Before the release of Unity 4.x versions, Unity provided a simpler animation system, now called the <span class="strong"><strong>Legacy Animation System</strong></span>. For backwards compatibility, this system is still available. You can use the legacy system in older projects without updating it to the new system. But, it is not recommended to use the legacy system in any new projects.</p><p>We will not go into the details of how the legacy animation system works as it is not a good choice in games in Unity, but we will discuss a basic overview of how it is used in Unity. The Legacy Animation System is based on the following steps to create and manage animations in Unity:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>You prepare the game object that you want to animate. For example, let's take a fighter character. Now, in order to animate this in Unity, you have to create a model, rig it, texture it, and then import it in Unity. This step is done by artists or 3D modelers and animators.</li><li>After importing the model, you have to set its <strong class="userinput"><code>Animation Type</code></strong> field to <strong class="userinput"><code>Legacy</code></strong> manually, as Unity doesn't do it automatically, from the <strong class="userinput"><code>Rig</code></strong> tab in the <strong class="userinput"><code>Inspector</code></strong> settings of the model. This is shown in the following figure:</li></ol></div><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_029.png" /></div><p>Figure 3.28 Setting Animation Type field to Legacy</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Now, you set all the animation clips such as walk forward, walk backward, run, jump, and so on, and set the times and speeds of those clips in the <strong class="userinput"><code>Animations</code></strong> tab. You can customize and edit clips here with features such as cropping and cutting frames from animation clips, modifying speed, creating loop or Ping-Pong sequences, and so on.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note37"></a>Note</h3><p>Animation clips can also be embedded in the model file with tools such as Autodesk Maya or 3D Studio Max. Also, animations can be separate files from the model file itself. Unity3D shows embedded animations in the Animations tab of the model file settings here.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Once all animation clips are set and ready, it's time to create a controller. The legacy animation system allows you to create a controller in C# or JavaScript, which will tell Unity about which clip to play at what time and for how long, and so on. This controller is basically managed by the game input, for example, on pressing the space key, the character should jump.</li></ol></div><p>Although these four steps don't explain the whole process in detail as to use the legacy animation system, it's enough to get an idea of how the legacy system is used in Unity. The legacy system relies heavily on the scripting part to manage animations and its controller is fully programmed and coded by the developer himself. This makes the legacy system more complex when compared to the new Mecanim animation system, which we will discuss in the next section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec41"></a>Mecanim animation system</h3></div></div></div><p>Although Unity had an animation system in place and developers were utilizing it, Unity3D released a whole new system created from scratch for creating and managing more complex animations with a lot more ease. That system became known as the Mecanim animation system. Here are some features of the Mecanim animation system:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Easy workflow and set up of animations</li><li style="list-style-type: disc">Supports animation clips created within Unity or imported externally</li><li style="list-style-type: disc">Retargets humanoid animations from one character model to another</li><li style="list-style-type: disc">A visual programming tool for managing and previewing animation clips</li><li style="list-style-type: disc">Layering and masking features</li></ul></div><p>It is possible that you might not have clearly understood some of these features . However, it's nothing to worry about, as we will discuss these features and the system in a lot of detail in this section.</p><p>We will start by discussing the Mecanim in our humanoid character project from the previous section.</p><p>In the previous section, we imported a free character alongside a lots of animation clips. We discussed the model file and its materials folder, and then we also configured a humanoid avatar for it. Now, we will continue from that humanoid avoid setting and use the Mecanim animation system to animate the character. To do this, first we have to see what kind of animations we have got from the <strong class="userinput"><code>Raw Mocap Animation Data</code></strong> asset. Expand the <strong class="userinput"><code>Animations</code></strong> folder in the <strong class="userinput"><code>Project Explorer</code></strong> panel, then expand the <strong class="userinput"><code>Walking </code></strong>folder again to view some of the walk animations.</p><p>Now, select any random animation clip from that folder, and in the <strong class="userinput"><code>Inspector</code></strong> panel you will see a small preview window with a little <strong class="userinput"><code>Play</code></strong> button which will pause/play the animation clip. This whole process is shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_030.png" /></div><p>Figure 3.29 Preview any animation clip from the Walking folder</p><p>This preview window shows you the animation clip to give you better idea as to which animation is more suitable for your game requirements. You can play more animations from other folders as well.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note38"></a>Note</h3><p>This preview system of the animations was only available in Mecanim after Unity 4.0 was introduced.</p></div><p>The Unity's Mecanim animation system is based on the concept of <span class="strong"><strong>animation clips</strong></span>, which contain information about how different objects should be moved, rotated, or transformed over time. Each clip can be a different, separate recording of the same object. These animation clips are mostly created by 3D animation artists using third-party tools such as Autodesk Maya, 3D Studio Max, or any other source. Then these clips can be exported using those tools as separate clips or can also be embedded into the model file itself. To understand this better, select the <strong class="userinput"><code>DefaultAvatar.fbx</code></strong> from the <strong class="userinput"><code>Raw Mocap Data</code></strong> directory in the <strong class="userinput"><code>Project </code></strong>panel, and select the <strong class="userinput"><code>Animations</code></strong> tab in the <strong class="userinput"><code>Inspector</code></strong> panel. You will observe that the <strong class="userinput"><code>Import Animations </code></strong>check is already selected, and below that there is an information box telling you that the model file doesn't contain any animation data. That means there is not a single animation clip embedded in the model file itself. This whole process is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_031.png" /></div><p>Figure 3.30 Viewing embedded animation data in the model</p><p>Whether you get embedded animation clips in the model, or you import animation clips separately (as in this case), these animation clips are then organized into a structure flowchart-like system called the <span class="strong"><strong>Animation Controller</strong></span>. This animation controller plays the role of a state-machine which keeps track of which animation clip should be playing, when the animation clip should stop, and so on. This is one of the most important features of the Mecanim system, which differentiates it from the legacy animation system and provides a lot of ease and control to the developers. In the legacy systems, the developers used to write the whole animation controller using C# or JavaScript programming, but in Mecanim, Unity3D offers a visual interface to create a whole controller without a single line of code with lots of built-in functionality.</p><p>Any simple animation controller must contain at least one or two animation clips. These animation clips can be as simple as opening and closing animations of any door or walking forward and backward animations of any humanoid character. A more advanced animation controller can contain dozens of humanoid animations for all the character's main actions such as walking, running, jumping, fighting, and so on. Our game project contains the characters with the abilities to walk, run, jump, fight with hands, legs, and super moves. So, our animation controller for a single character is quite detailed and advanced. In the next section, we will discuss about how an animation controller is created and we will create a simple controller for our player character for the fighting game.</p></div></div>