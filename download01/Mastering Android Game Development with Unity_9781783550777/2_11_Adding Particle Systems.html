<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec15"></a>Adding Particle Systems</h2></div></div><hr /></div><p>Before we delve into the details of particle systems, let's discuss what exactly these systems are and how they are used. Let's start with a discussion of what particle systems are.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec18"></a>What is a Particle System?</h3></div></div></div><p>In any 3D complex game, characters, props, and environment elements are mostly created as 3D meshes and models, while in 2D games, sprites and images are used for these same purposes. Now, whether these objects are meshes or sprites, they mostly represent solid objects which contain a well-defined shape. But any game contains other entities such as fluids, liquids, smokes, clouds, flames, magic balls, and so on. These are some sort of special kinds of animations and objects, and are handled also with a special type of properties and behaviors, called particle systems in Unity.</p><p>The screenshot below shows some interesting magic spell particle systems created in Unity:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_002.jpg" /></div><p>Figure 2.2: Different Particle Effects or magic spells created in Unity</p><p>Particles are small and simple images, or even meshes, that are displayed and animated in a huge number by a full-fledged system known as a Particle System. In any particle system, each small particle contributes a minor role and, overall, it looks like some highly polished animation or effect. For example, a snowfall effect can be treated as a particle system. A single particle of snow doesn't represent any snowfall if it is animated singularly, but if those same single snow particles are animated in a huge quantity with random speed, random direction, and random size, all these particles will not look like some image animation; rather, they will look like a system of snowfall in the game. That's the main key power of using a Particle System in Unity--it allows batch operations of heavy code in a very light and optimized way, resulting in very beautiful effects for games.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec19"></a>Basics of Particle System</h3></div></div></div><p>In Unity, a Particle System consists of all of the particles. Developers are only expected to manage the particles and the rest will be handled by Unity. Each particle has a predetermined lifetime through various changes, such as fading away for any snowfall effect, or getting scaled up and fading for any smoke effect, and so on. Like all other physical game objects, these particles have velocity to change the speed and direction throughout their lifetime duration, and these particles can be affected by forces and gravity applied by the environment's physics kinematics.</p><p>The developers' end is to manage and control the particle's lifetime and its behavior, such as how many seconds will a particle last? How it will grow throughout its lifetime duration? Will it scale up or not? Will it fade away throughout its lifetime? All these questions are answered by developers and Unity will award them an amazing particle system in the form of an effect.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>The particles can be as simple as a sphere of white color or can be as complex as any mesh with high-resolution texture and normal maps.</p></div><p>The particle system's job is to manage all these particles from an abstract view. This system tells when to generate the next particle and where it should be, with what position, rotation, and scale. What should be the emission shape of the system, for example, hemisphere, code, or simple box? What should be the emission rate of the particles and how long should any particle effect take to execute one complete cycle of the system?</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec20"></a>Creating a rocket fire Particle Effect for a game</h3></div></div></div><p>So, after getting to grips with some basic knowledge of particle effects and particle systems in Unity, let's put this knowledge into action by creating the first particle system for our Perky Penguin game. As we know, the penguin wears a rocket tied to its back which lets it fly and boost when tapped on screen by the player. Now, this rocket will create a small fire-like effect when it becomes active. The following screenshot shows the rocket with its fire effect of boost as the final result of this small particle system exercise:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_003.png" /></div><p>Figure 2.3: Rocket's fire effect final result</p><p>As shown in the preceding screenshot, you can observe how the fire starts from the edge of the rocket and how it disappears slowly with a fading effect, similar to real life. Now, let's create this simple particle effect for our penguin's rocket in our last created <code class="literal">PerkyPenguin_PenguinMovement</code> project from <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Introduction to Android Game Development with Unity 3D</em></span>.</p><p>Let's start creating a particle system object by selecting <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Particle System</code></strong> as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_004.png" /></div><p>Figure 2.4 Creating Particle System GameObject</p><p>This will add a game object with the name <strong class="userinput"><code>Particle System</code></strong> in the <strong class="userinput"><code>Hierarchy</code></strong> panel immediately. But you might notice a strange thing here of the white spheres moving outward in the <strong class="userinput"><code>Scene View</code></strong> as soon the object is created and selected. The screenshot below shows a simple example of those white spheres in the Scene view below:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_005.png" /></div><p>Figure 2.5 A Particle System GameObject selected in Unity</p><p>You can see that, as we created a Particle System object, a simple white sphere particle system started playing in the scene. A small control panel is shown in the scene, consisting of controls such as pause, stop, playback speed, and playback time. As you select any other game object or deselect the Particle System game object, the Particle System will stop automatically.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>One of feature of the interface of Unity is that developers don't need to play the game in order to test their particle systems. These can be checked directly within the scene view.</p></div><p>Also, you should notice the <strong class="userinput"><code>Inspector</code></strong> panel of the selected Particle System and see how lots of different properties are shown in the <strong class="userinput"><code>Particle System</code></strong> component of the object, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_006.png" /></div><p>Figure 2.6 Particle System component in Inspector panel</p><p>It would be good to know that almost everything about the Unity's Particle System is provided in this <strong class="userinput"><code>Particle System</code></strong> component, which is a set of a huge number of properties. On tweaking and changing the values of these properties, a snowfall can be converted into burning fire, or it can be converted into an explosion for any airplane games, or it can be converted in a magic ball or magic spell for any dungeon role-playing games, and so on. To learn about it, let's continue our rocket fire particle system by following the steps given below:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">In order to put the particle system always below the rocket, it should be a child of the <strong class="userinput"><code>penguin</code></strong> object. So drag the <strong class="userinput"><code>Particle System</code></strong> object onto the <strong class="userinput"><code>penguin</code></strong> game object in the <strong class="userinput"><code>Hierarchy panel</code></strong> and you will see something like the following screenshot:</li></ul></div><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_007.png" /></div><p>Figure 2.7 Particle System GameObject as child of penguin object</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Rename the <strong class="userinput"><code>Particle System</code></strong> to <strong class="userinput"><code>rocketFire</code></strong>.</li><li style="list-style-type: disc">Set its <strong class="userinput"><code>Position</code></strong> to (-0.62, -0.33, 0) to move it to the nozzle of the rocket.</li><li style="list-style-type: disc">Set its <strong class="userinput"><code>Rotation</code></strong> to (65, 270, 270) to set the direction of the particles in orientation with the rocket.</li></ul></div><p>The following screenshot highlights all the changes provided in the above steps of the <strong class="userinput"><code>Inspector</code></strong> panel:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_008.png" /></div><p>Figure 2.8 The rocketFire Transform in Inspector panel</p><p>Still in the <strong class="userinput"><code>Inspector</code></strong> panel with the <strong class="userinput"><code>rocketFire</code></strong> particle system object selected, let's alter the values of the <strong class="userinput"><code>Particle System</code></strong> component to create a beautiful type of fire for our penguin's rocket to boost. Here are the steps to follow:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Set <strong class="userinput"><code>Start Lifetime</code></strong> to 0.5</li><li style="list-style-type: disc">Set <strong class="userinput"><code>Start Size</code></strong> to 0.3</li><li style="list-style-type: disc">Click on <strong class="userinput"><code>Start Color</code></strong> and set <strong class="userinput"><code>Red</code></strong> to 255, <strong class="userinput"><code>Green</code></strong> to 135, <strong class="userinput"><code>Blue</code></strong> to 40 and <strong class="userinput"><code>Alpha</code></strong> to 255, this will turn our white particles into orange ones</li><li style="list-style-type: disc">Expand the <strong class="userinput"><code>Emission</code></strong> section and set <strong class="userinput"><code>Rate</code></strong> to 300</li><li style="list-style-type: disc">Expand the <strong class="userinput"><code>Shape</code></strong> section and set <strong class="userinput"><code>Shape</code></strong> to <strong class="userinput"><code>Cone</code></strong>, <strong class="userinput"><code>Angle</code></strong> to 12 and <strong class="userinput"><code>Radius</code></strong> to 0.1</li><li style="list-style-type: disc">Set the <strong class="userinput"><code>Random Direction</code></strong> checkbox to checked state to create randomness in fire particles</li></ul></div><p>The following screenshot shows the <strong class="userinput"><code>Particle System</code></strong> component's previously set along with its result of rocket fire below the penguin in the <strong class="userinput"><code>Scene view</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_009.png" /></div><p>Figure 2.9 The rocketFire Particle System</p><p>You can observe how the random white spheres being generated and moving in random directions have changed into a cone-shaped fire emission from a rocket tied on the back of the penguin. What we have done is to alter some values in the Particle System component in the Inspector panel. Let's briefly look at what these properties actually do:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Start Lifetime</code></strong></strong></span> is the total lifetime in seconds that particles will have when emitted</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Start Size</code></strong></strong></span> is the initial size of particles when emitted</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Start Color</code></strong></strong></span> is the initial color of particles when emitted</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Emission Rate</code></strong></strong></span> is the number of particles emitted per unit of time or distance moved</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Shape</code></strong></strong></span> is the shape of the emission volume: the options are <span class="emphasis"><em>Sphere</em></span>, <span class="emphasis"><em>Hemisphere</em></span>, <span class="emphasis"><em>Cone</em></span>, <span class="emphasis"><em>Box</em></span>, <span class="emphasis"><em>Mesh</em></span>, <span class="emphasis"><em>Circle</em></span> and <span class="emphasis"><em>Edge</em></span></li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Angle</code></strong></strong></span> is the angle of the cone at its point (for cones only)</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Radius</code></strong></strong></span> is the radius of the circular aspect of the shape</li><li style="list-style-type: disc"><span class="strong"><strong><strong class="userinput"><code>Random Direction</code></strong></strong></span> enabled means that the particles' initial direction will be chosen randomly</li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note19"></a>Note</h3><p>You can see more of these properties and their purposes on Unity's manual or documentation website at <a class="ulink" href="http://docs.unity3d.com/Manual/ParticleSystemModules.html" target="_blank">http://docs.unity3d.com/Manual/ParticleSystemModules.html</a>.</p></div><p>So, our rocket fire Particle System is ready. But, in real life, fire never ends instantly, it always ends by getting faded over time. We can also add this property into our fire by enabling the <strong class="userinput"><code>Start Color</code></strong> property in the <strong class="userinput"><code>Particle System</code></strong> component. Then click on the <strong class="userinput"><code>Color</code></strong> box and select the top slider on the right, which is for alpha of the end color, and set its value to 0.</p><p>The whole setting is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_010.png" /></div><p>Figure 2.10 Adding fade effect in fire using Color over Lifetime</p><p>If you are not sure of what exactly <strong class="userinput"><code>Color over Lifetime</code></strong> changed in the fire effect, the following screenshot shows the difference in the fire particle system with and without the fading effect:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_011.png" /></div><p>Figure 2.11 The fire effects with and without fade effects</p><p>So far, we have a penguin which flies on a tap of the screen and its rocket is exploding fire all the time. Now it's time to put some environment in the game to make the theme of the game. This environment will be for the penguin to move forward through and our game needs an endless room for the background. But, in order to test the penguin walking, we will only add background without any endless moving functionality.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec21"></a>Adding game-level backgrounds</h3></div></div></div><p>A game with no background or theme is no game at all. So far, the penguin has got no reason to walk through the game, fly, or use its rocket to boost because it is in a void space of blue color. Let's bring this penguin into the snowy and hilly world where it actually belongs. And in order to survive melting ice due to global warming, it can also use its rocket to fly a little. In this section, we will learn how to add backgrounds and how the order of these backgrounds and sprites is managed in any 2D game where z-order is not used at all.</p><p>We will start by creating backgrounds for the levels of the game. These backgrounds can be created in your favorite graphics tools, such as Adobe Photoshop and so on. The following screenshot shows the background we created for the Perky Penguin game:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_012.png" /></div><p>Fig 2.12 Background of the Penguin Perky Game</p><p>We have already learned about how the images are imported as sprites in Unity. For backgrounds, we have to do exactly the same procedure again. We have prepared two repeatable images with the names <code class="literal">bg_snow1.png</code> and <code class="literal">bg_snow2.png</code> and imported these images into the <strong class="userinput"><code>Graphics</code></strong> folder of the <strong class="userinput"><code>Assets</code></strong> directory in the <strong class="userinput"><code>Project Browser</code></strong> panel. The following screenshot shows the <strong class="userinput"><code>Project Browser</code></strong> panel with background images in it:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_013.png" /></div><p>Figure 2.13 Backgrounds in the Project browser panel</p><p>It must be noted that the backgrounds should be repeatable so that when these images are put together, they should merge and avoid players recognizing the repeating order. The following screenshot shows both the background images we have designed for the Penguin Perky game:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_014.png" /></div><p>Figure 2.14 Backgrounds of Penguin Perky game</p><p>You can see in the images that if we keep these two images repeating beside each other, it will create a very smooth background which will forever be repeating over and over again. We will do that with some scripting later in this chapter. For now, let's set up the scene background of the game.</p><p>After importing the background images in the <strong class="userinput"><code>Graphics</code></strong> folder of <strong class="userinput"><code>Assets</code></strong>, place two objects of <code class="literal">bg_snow1.png</code> and one object of <code class="literal">bg_snow2.png</code> in the <strong class="userinput"><code>Hierarchy</code></strong> panel. Set the first <code class="literal">bg_snow1.png</code> position to (0, 0, 0), then the <code class="literal">bg_snow2.png</code> position to (4.8, 0, 0), and finally another <code class="literal">bg_snow1.png</code> position to (9.6, 0, 0), and you will get a small background in the scene. So, now you will observe that the penguin is hidden behind these backgrounds. As this is a 2D game, so there is no concept of a z-axis here. We can set the z-axis position and bring forward and backward the sprites and images but for 2D games it is not a good approach. Unity provides developers with an ordering mechanism for placing 2D images front and backward optimized for 2D games especially. This is done through the sorting layers. Select the <code class="literal">bg_snow1</code> object in the <strong class="userinput"><code>Hierarchy</code></strong> panel and look at the Inspector in the <strong class="userinput"><code>SpriteRenderer</code></strong> component, and you will see an option of <strong class="userinput"><code>Sorting Layer</code></strong> as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_015.png" /></div><p>Figure 2.15 Sorting Layer in SpriteRenderer in Inspector panel</p><p>Initially, all the sprites you import in Unity have a default sorting layer. Click on the drop-down menu and you will see the list of all sorting layers in the project. At the moment, we only have one layer called <strong class="userinput"><code>Default</code></strong> and there is another option, <strong class="userinput"><code>Add Sorting Layer...</code></strong>, to add a new layer. Click on the <strong class="userinput"><code>Add Sorting Layer...</code></strong> option as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_016.png" /></div><p>Figure 2.16 Add Sorting Layer... option</p><p>This will open a new <strong class="userinput"><code>Tags &amp; Layers</code></strong> panel in place of the Inspector panel. Add four layers, namely Background, Surroundings, Objects, and Player in the order as explained. This is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_017.png" /></div><p>Figure 2.17 Sorting Layers panel</p><p>You can drag these layers up or down by pressing and dragging the two lines icon to the left of each layer row. Moving these layers up or down describes the order of layers. For example, currently the Default layer is the lowest layer and it will be behind everything, and the Player layer will be in front of everything that uses layers except the Player layer.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note20"></a>Note</h3><p>There is a huge difference between <strong class="userinput"><code>Sorting Layers</code></strong> and <strong class="userinput"><code>Layers</code></strong>. <strong class="userinput"><code>Sorting Layers</code></strong> are only used to arrange 2D sprites for 2D games but the <strong class="userinput"><code>Layers</code></strong> are not for arranging purposes. It's totally a different concept and you must be careful when using layers in order to avoid any conflict between layers and sorting layers.</p></div><p>Right now, we only need Player and Background sorting layers; we will use other layers later in this chapter. Now, select the penguin game object in the Hierarchy panel and choose the Player layer from the Sorting Layer option in Sprite Renderer, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_02_018.png" /></div><p>Figure 2.18 Selecting Penguin's Sorting Layer</p><p>Similarly, select the Background layer for all the snow background objects in the scene. And now you will observe that the penguin will be in front of these snow backgrounds.</p></div></div>