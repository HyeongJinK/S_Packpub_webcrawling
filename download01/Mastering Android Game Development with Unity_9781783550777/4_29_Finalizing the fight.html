<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec31"></a>Finalizing the fight</h2></div></div><hr /></div><p>Let us make the player react to the enemy's attacks by changing the behavior of the player. In the <code class="literal">playerScript</code>, add the following line of code. At the top of the class, create a new <code class="literal">public</code> variable of type <code class="literal">GameObject</code> and call it <code class="literal">enemy</code>:</p><pre class="programlisting">    public GameObject enemy; </pre><p>Next, at the start of the <code class="literal">Update</code> function, get the <code class="literal">Animator</code> component of the enemy:</p><pre class="programlisting">    Animator eAnim = enemy.GetComponent&lt;Animator&gt;(); </pre><p>Next, after the attacking function in the update, add the following:</p><pre class="programlisting">    // Getting Hit 
    if (eAnim.GetBool("tIsPunching")){ 
        if (anim.GetBool("bIsDefending") == false){ 
            //Debug.Log("I got hit"); 
            anim.SetTrigger("tGotHit"); 
        } 
    }  </pre><p>Here, we check if the enemy is punching. If the enemy is punching and the player is not defending, then we set the <code class="literal">gotHit</code> trigger to be <code class="literal">true</code>.</p><p>Drag <code class="literal">theDude</code> character to the enemy script component as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_033.png" /></div><p>Similarly, in the enemy script add a public GameObject variable called player.</p><pre class="programlisting">    public GameObject player; </pre><p>Just before the end of the <code class="literal">Update</code> function, add the following.</p><pre class="programlisting">    Animator pAnim = player.GetComponent&lt;Animator&gt;(); 

    // Getting Hit 
    if (pAnim.GetBool("tIsPunching")) { 
        if (anim.GetBool("bIsDefending") == false) { 
            //Debug.Log("I got hit"); 
            anim.SetTrigger("tGotHit"); 
        } 
    } </pre><p>Drag and drop the player in the <code class="literal">GameObject</code> in the enemy script take a hit when he is not defending:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_04_034.png" /></div><p>Now play the game and you will see that the enemy will take a hit when he is not defending:</p><p>Also, as of now the player can keep left-clicking and the hero character can keep punching. To limit the number of punches the player can do, add the following code.</p><p>Add the following at the top:</p><pre class="programlisting">    float totalTime = 0.0f; 
    float timeSinceLastHit = 0.0f; 
    float hitTimeInterval = 30.0f * .016f; </pre><p>At the start of the <code class="literal">Update</code> function, increment the time:</p><pre class="programlisting">    totalTime += Time.deltaTime; </pre><p>The attack code needs to be changed to:</p><pre class="programlisting">    // Attacking 
    if (totalTime&gt;= timeSinceLastHit + hitTimeInterval){ 
        if (Input.GetButtonDown("Fire1")){ 
            anim.SetBool("bIsDefending", false); 
            anim.SetTrigger("tIsPunching"); 

            timeSinceLastHit = totalTime; 
            //Debug.Log("Fire pressed"); 
        } 
    } </pre></div>