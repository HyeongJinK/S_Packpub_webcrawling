<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec22"></a>Generic and humanoid rigs</h2></div></div><hr /></div><p>Although we have discussed the models and how to import these models in Unity3D, we have not talked about what those models should be or which types of models are preferred by the game engine. A model can include anything from a simple cube with texture to furniture and homes to life characters and aliens to space orbits and planets. In most cases, games are more about the interactive storyline, which involves lots of characters (mostly humans) with many kinds of emotions and expressions. Unity3D, being a very easy to learn and use platform for game development, took this task of providing characters and humans support and offers a highly flexible and fully featured set of tools to handle, animate, and manage character models in a very easy way.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec37"></a>What are humanoid characters?</h3></div></div></div><p>As it is clear in the word <span class="emphasis"><em>humanoid</em></span> itself, humanoid characters are the characters based on humans. It is not necessary to be a human, but it should be based on the physical shape of humans. The monkey model is a great example of a humanoid model. It could be a two-legged alien and so on. Since most games contain humanoid models, to make things easier, Unity3D provides good feature set for working with humanoid models.</p><p>There are a lot of free and paid resources to get humanoid models from the Internet. Or you can create your own humanoid models using tools such as Poser, MakeHuman, or Mixamo. Some of these tools also provide features for rigging and adding skin on the model as well.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"></a>Note</h3><p>Rigging, in simple words, is the process of adding a skeleton and joining bones in any 3D model.</p></div><p>You can also get many free and paid humanoid models of various varieties such as males, females, old characters, warriors, fighters, force characters, and so on, from the Asset Store. Humanoid characters mostly possess bone structure, skin muscles, and textures for costumes or clothing. The bone structure or skeleton, as it is called in real life, is the important thing in any humanoid character. It allows us to repose and animate other humanoid characters with the same skeleton or, as it's called <span class="strong"><strong>rigging</strong></span>. The following figure shows a simple human character with its skin, rigging, and muscles:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_019.png" /></div><p>Figure 3.18 A simple humanoid character with skin mesh (left), rigging (middle), and muscles (right)</p><p>It should be noted that any humanoid character will have the rigging structure as shown in the previous figure. We will discuss about rigging in the later sections in more detail. Now, we will discuss about what kind of tools are offered by Unity3D for humanoid character models and how they are used. We will learn this by importing a freely available character model from the Unity Asset store.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"></a>Note</h3><p>The Unity Asset store (<a class="ulink" href="http://assetstore.unity3d.com" target="_blank"><span>http://assetstore.unity3d.com</span></a>) is an online marketplace from Unity3D for the assets and ready-made toolkits, add-ons, extensions, and code for usage in Unity games, and is available in free and paid versions.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec38"></a>Importing humanoid models</h3></div></div></div><p>Let's start learning how to import humanoid models into Unity. We will start from creating an empty project called <strong class="userinput"><code>Humanoid Character</code></strong>. As the project is built and compiled successfully, we have an empty project with an empty scene opened as always.</p><p>Now, there is nothing different about humanoid models when it comes to modeling formats. A humanoid model is a simple model of file types we discussed in previous sections, such as FBX, MB, 3DS, and so on. We can import those by dragging and dropping the file from the File Explorer into Unity or by manually importing it with the menu option of <strong class="userinput"><code>Import New Asset...</code></strong> as well. In this example, we will use a freely available model from the Unity Asset Store. The asset name is Raw Mocap Data for Mecanim and it includes a character developed by Unity3D and a huge collection of animations such as moving forward, backward, jump, crawl, and so on. This can be found at: <a class="ulink" href="https://www.assetstore.unity3d.com/en/#!/content/5330" target="_blank"><span>https://www.assetstore.unity3d.com/en/#!/content/5330</span></a>. Paste this URL into your browser, and click on the <strong class="userinput"><code>Open in Unity</code></strong> button, and it will open Unity3D and show the Asset Store panel with the asset on it, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_020.png" /></div><p>Figure 3.19 Unity Asset Store panel in Unity3D</p><p>Now, if you have already downloaded this asset into your local computer, then it will show you the <strong class="userinput"><code>Import</code></strong> button; otherwise, it will show you the <strong class="userinput"><code>Download</code></strong> button. Download and then import this asset into your Unity project and it will show you a dialog panel with the list of all the files to be imported. This is to let developers know which files are new and which files will get replaced with this asset package. This is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_021.png" /></div><p>Figure 3.20 Raw Mocap data files before importing</p><p>We have an empty project, so it is showing the <strong class="userinput"><code>NEW</code></strong> tab in front of all the files. For now, click on the <strong class="userinput"><code>All</code></strong> button on the bottom left section of the panel and then click on the <strong class="userinput"><code>Import</code></strong> button. This will take a little time to import, decompress, and import all the assets into the project. Once it is done, you will notice a new directory called <strong class="userinput"><code>Raw Mocap Data</code></strong> in your <code class="literal">Assets</code> folder. This is where all the files and asset data have been placed. This is shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_022.png" /></div><p>Figure 3.21 Raw Mocap data files into Assets after importing</p><p>Since this section is all about the model and its settings, we will ignore the <strong class="userinput"><code>Animations</code></strong> directory for now. In the <strong class="userinput"><code>Raw Mocap Data</code></strong> directory, you will observe a model called the <strong class="userinput"><code>DefaultAvatar</code></strong> file. This is technically an FBX file, if you see it in File Explorer and FBX files are the most preferred model files in Unity3D. When you select it, you will see the <strong class="userinput"><code>Rig</code></strong> tab of settings selected in the <strong class="userinput"><code>Inspector</code></strong> panel along with some predefined import options as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_023.png" /></div><p>Figure 3.22 Default avatar model import settings in the Inspector</p><p>This model comes with many materials placed in the <strong class="userinput"><code>Materials</code></strong> directory, which are assigned on the character and show its skin and clothing, as we can see in the small preview section in the preceding figure. There is also the <strong class="userinput"><code>Animations</code></strong> directory with a text file containing the animations list. We will talk about those animations in later sections.</p><p>So, let's select the <strong class="userinput"><code>Rig</code></strong> tab, if it is not already selected from the <strong class="userinput"><code>Inspector</code></strong> panel, and discuss the different options there. You will notice that <strong class="userinput"><code>Animation Type</code></strong> is already selected as the <strong class="userinput"><code>Humanoid </code></strong>option. When any model file is imported in Unity, it automatically tries to detect the type of the model by comparing its rigging structure with a predefined humanoid structure and create an automatic avatar for it. We will discuss this predefined humanoid skeleton structure in the later sections. If it is matched successfully, Unity associates the <strong class="userinput"><code>Animation Type</code></strong> to <strong class="userinput"><code>Humanoid;</code></strong> otherwise it sets it to <strong class="userinput"><code>Generic</code></strong>. There are also two more options, namely <strong class="userinput"><code>None</code></strong> and <strong class="userinput"><code>Legacy</code></strong>. The <strong class="userinput"><code>None</code></strong> option allows Unity to ignore the whole rigging and let the humanoid be without any bones and animations. The <strong class="userinput"><code>Legacy</code></strong> option is the older method for handling humanoid characters and it is now deprecated and not recommended to use. You can also manually change the <strong class="userinput"><code>Animation Type</code></strong> option of the model. The <strong class="userinput"><code>Generic</code></strong> type option is used to tell Unity that a character is not humanoid. For example, it can be some six-legged alien or any horse model, or any strange kind of spider, or any static tree, and so on.</p><p>Below the <strong class="userinput"><code>Animation Type</code></strong>, you will see the <strong class="userinput"><code>Avatar Definition </code></strong>option. Basically, when any humanoid model is imported in Unity, it starts looking for the avatar of the model. An avatar in Unity is a simple skeleton that provides a way to control the mesh, skin, and materials of the model to animate, move, and so on. If the model is already rigged properly and is humanoid, Unity will automatically create an avatar from this model file. We can also copy an avatar from any other model file as well using the <strong class="userinput"><code>Copy From Other Avatar</code></strong> option. The copying option will ask for the source avatar, and put the new skeleton in the current model. It is like putting one character's rigging into another's body mesh. It is a very powerful feature of Unity3D and makes character handling a lot easier.</p><p>The next option is the <strong class="userinput"><code>Configure</code></strong> button with a small tick icon. This icon informs us whether our model is okay to use or not. In simple words, Unity tries to create an avatar automatically from the model and this icon shows whether Unity has been able to do it or not. Select the <strong class="userinput"><code>None</code></strong> option from the <strong class="userinput"><code>Animation Type</code></strong> and then again select the <strong class="userinput"><code>Humanoid</code></strong> option. Now you will see the three dots symbol before the <strong class="userinput"><code>Configure</code></strong> button. This tells that the model is not configured yet and the avatar is not created yet. That means Unity hasn't yet acknowledged whether the model file is humanoid or not. You can click on <strong class="userinput"><code>Apply</code></strong>, and Unity will try to automatically detect its humanoid characteristics and create an automatic avatar. If the model is humanoid, then the icon will be changed to a tick icon; otherwise, it will be changed into a cross icon, indicating that the model is not properly configured and is not humanoid.</p><p>The following figure shows all the different states of configuration of the humanoid model:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_024.png" /></div><p>Figure 3.23 Different states of configuration of the humanoid model</p><p>We have learned that Unity automatically tries to detect whether the model is humanoid or not and tries to configure it properly by creating an automatic avatar with its pre-defined humanoid rigging. But, we still don't know how Unity does that and what kind of benefits and customizations can be made in the process of Unity to achieve the requirements of our own characters of the game. In the next section, we will discuss about how any character is configured to be a humanoid in Unity and how automatic avatar creation works.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec39"></a>Configuring the avatar of humanoid models</h3></div></div></div><p>Since the avatar defines the whole rigging and skeleton structure of humanoid models in Unity, it is very important that it is configured properly for the model. We shouldn't depend on the results of automatic avatar creation of Unity. Whether it is configured properly with the tick icon or not configured with a cross icon, you need to go into the <strong class="userinput"><code>Configure Avatar</code></strong> mode to personally ensure that the avatar is properly set up and is valid for use in the game. This is a very important requirement for the whole character animation called the <span class="strong"><strong>MecAnim System</strong></span>, which we will discuss in the next section.</p><p>Now, as shown in the preceding figure, click on the <strong class="userinput"><code>Configure...</code></strong> button. It will ask you to save the current scene if it's not already saved, and will open a new scene as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_025.png" /></div><p>Figure 3.24 Avatar configuration scene</p><p>You can observe that a new scene is opened with our character model placed at the center of the Scene View. In the <strong class="userinput"><code>Inspector</code></strong> panel, a 2D human character is shown with a lot of green circles within the body of it, as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_026.png" /></div><p>Figure 3.25 View of avatar of humanoid character</p><p>This area consists of two tabs, <strong class="userinput"><code>Mapping</code></strong> and <strong class="userinput"><code>Muscles &amp; Settings,</code></strong> with the first one already selected. In the <strong class="userinput"><code>Mapping</code></strong> tab, there is a human body with green circles of solid strokes and dashed strokes placed inside it. These circles map the bones' game objects with the joints of the human body so that it can behave that way. The circles with solid strokes are required to associate with any bone game object. Even if a single required circle is not mapped correctly, then the avatar will not be configured and show a red circle, as shown in Figure 3.25 on the right side.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"></a>Note</h3><p>To improve your chances of finding a match to an avatar, name your bones in a way that reflects the body parts they represent such as LeftArm, RightForearm, and so on.</p></div><p>In the Inspector view, you can also observe other buttons aligned vertically: <strong class="userinput"><code>Body</code></strong>, <strong class="userinput"><code>Head</code></strong>, <strong class="userinput"><code>Left Hand</code></strong>, and <strong class="userinput"><code>Right Hand</code></strong>. As a body is shown in the Inspector, other buttons show other parts of the human body to map more bones to give the character tiny details for use in animations. These are shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_027.png" /></div><p>Figure 3.26 Avatar mapping of all parts</p><p>You can see that, except the body section, all other sections have only optional bones. And in general, every bone of the human body is covered in Unity. The optional bones are automatically mapped and animated in Unity, but the required bones are to be mapped from the model. And if any one bone is missed while rigging the character, whether it is in Autodesk Maya, or 3D Studio Max, or any other 3D modelling tool, Unity will show a red circle there and it is the developer's job to provide that missing bone by selecting the game object from the <strong class="userinput"><code>Hierarchy</code></strong> panel and placing it below the list of bones in <strong class="userinput"><code>Inspector</code></strong> panel.</p><p>Now, you might also have observed that our character is in the pose of a T shape if you look in the Scene View. If your model is not in the T-Pose, Unity will print the message in the <strong class="userinput"><code>Scene View</code></strong> to enforce the model in the T-Pose. The T-Pose is the origin point of the model for Unity to map the right bones with the right game objects. You can manually rotate bones' game objects to form a T-Pose, or you can automatically do it by selecting <strong class="userinput"><code>Enforce T-Pose</code></strong> from the <strong class="userinput"><code>Pose</code></strong> dropdown in the bottom section of the <strong class="userinput"><code>Inspector</code></strong> panel as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781783550777/graphics/image_03_028.png" /></div><p>Figure 3.27 Enforce T-Pose option in the Inspector panel</p><p>Once the option is selected, the model object will be automatically positioned to the T-Pose if all its bones are correctly rigged and assigned. The other options in this dropdown include <strong class="userinput"><code>Reset</code></strong>, which will reset all the bones and sets the avatar configuration to the initial one, and <strong class="userinput"><code>Sample Bind-Pose</code></strong>, which will enforce the model to set to the same pose it was at the time of importing the model.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"></a>Note</h3><p>You can reset the whole mapping and use Unity's automatic avatar configuration by selecting the Automap option from the Mappings dropdown beside the Pose dropdown in the <strong class="userinput"><code>Inspector</code></strong> panel.</p></div><p>After any changes you make, you can click on <strong class="userinput"><code>Apply</code></strong> or <strong class="userinput"><code>Revert</code></strong> to apply or cancel the changes. Once you are ready with the configuration and avatar, you can click on the <strong class="userinput"><code>Done</code></strong> button to close the avatar scene and navigate back to your original working scene.</p><p>The other tab, <strong class="userinput"><code>Muscles &amp; Settings,</code></strong> is beyond the scope of the book, but you can go ahead and experiment a little. It allows you to verify all the bones with the muscles and you can also put restrictions on the movement of bones, such as the head can't rotate fully, by defining ranges in it.</p><p>Now, our model is imported and is properly configured to the humanoid avatar. It's time to bring it to life and add some locomotion animations such as walking, running, jumping, and so on. In the section, we will discuss how Unity allows us to manage animations and apply them on the humanoid model objects.</p></div></div>