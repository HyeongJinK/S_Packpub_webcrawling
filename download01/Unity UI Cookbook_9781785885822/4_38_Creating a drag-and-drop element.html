<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec42"></a>Creating a drag-and-drop element</h2></div></div><hr /></div><p>Often, UI elements require some kind of interaction with the player. This recipe, along with what we have done in the previous two recipes, will teach you how to create interactive panels. In <a id="id232" class="indexterm"></a>particular, you will learn how to create two panels: one from which we can drag an element (such as a coin or an item) and one on which we can then place it. This is useful when we are developing a system wherein we need to drag objects from one place to another. For instance, it's common to find this system in a shop menu, where the player can decide what to buy and drag what he wants into his inventory. In order to do this, we will use the <span class="strong"><strong>Event Trigger (Script)</strong></span> component and develop a script to handle the interactions.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec114"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, we can create a panel by right-clicking on the <span class="strong"><strong>Hierarchy</strong></span> panel. Then click on <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span> and rename it to <span class="strong"><strong>CoinPanel</strong></span>. We should also resize it in order to see the entire panel on the screen.</p></li><li><p>Next, we need to create a script for <span class="strong"><strong>CoinPanel</strong></span>. Therefore, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <span class="strong"><strong>DragAndDropScript</strong></span>. Then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double-click on<a id="id233" class="indexterm"></a> the script in order to edit it. As usual, we have to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script. This allows us to handle UI elements within our script.</p></li><li><p>Before we add functions, we need two variables. The first one is a public variable and it will store the original <code class="literal">GameObject</code>. We will use this to instantiate new game objects every time the player drags from this panel. The second variable is a private one and is required to keep track of our new <code class="literal">GameObject</code> during the dragging process:</p><div class="informalexample"><pre class="programlisting">private GameObject temp;
public GameObject original;</pre></div></li><li><p>Now, we can add the <code class="literal">onDragBegins()</code> function. This is where we initiate a new <code class="literal">GameObject</code> from the original one and store it inside the <code class="literal">temp</code> variable. Furthermore, in order to display a UI element, it must be a child of <code class="literal">Canvas</code>. Therefore, we need to change its parent to <code class="literal">Canvas</code>:</p><div class="informalexample"><pre class="programlisting">public void onDragBegins(){
  temp = (GameObject) GameObject.Instantiate (original, this.transform.position, Quaternion.identity);
  temp.transform.SetParent (GameObject.Find ("Canvas").transform);
}</pre></div></li><li><p>In the <code class="literal">onDrag()</code> function, we just change the position of <code class="literal">temp</code> with the one on the mouse:</p><div class="informalexample"><pre class="programlisting">public void OnDrag(){
  temp.transform.position = Input.mousePosition;
}</pre></div></li><li><p>In the <code class="literal">onDragEnd()</code> function, we can perform our checks and finally destroy <code class="literal">temp</code>:</p><div class="informalexample"><pre class="programlisting">public void onDragEnd(){
  //Check if temp is dropped as you want and perform what you want
  GameObject.Destroy (temp);
}</pre></div></li><li><p>Let's save the script and add an <span class="strong"><strong>Event Trigger (Script)</strong></span> component to the panel. To do this, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Event</strong></span> | <span class="strong"><strong>Event Trigger</strong></span>.</p></li><li><p>Moreover, we need to add two types of events. To add the first event, click on <span class="strong"><strong>Add New Event Type</strong></span> | <span class="strong"><strong>Drag</strong></span>. As in the previous recipe, a new menu should appear in the <span class="strong"><strong>Inspector</strong></span>. By clicking on the <span class="strong"><strong>+</strong></span> sign in the bottom-right corner of the panel, we can add a new event. Then, we have to drag the <span class="strong"><strong>DragAndDropScript</strong></span> itself into the <span class="strong"><strong>object</strong></span> variable. As result, the drop-down menu should be enabled. Click on it and select <span class="strong"><strong>DragAndDropScript | OnDrag</strong></span>. By doing this, we ensure that, when the player drags, the <code class="literal">OnDrag()</code> function in our script is called.</p></li><li><p>To add the second event, click on <span class="strong"><strong>Add New Event Type</strong></span> | <span class="strong"><strong>Begin Drag</strong></span> and then click on the <span class="strong"><strong>+</strong></span> sign in the bottom-right corner of the panel. Again, we have to drag the <span class="strong"><strong>DragAndDropScript</strong></span> itself into the <span class="strong"><strong>object</strong></span> variable. From the drop-down menu that was just enabled, select <span class="strong"><strong>DragAndDropScript | onDragBegins</strong></span>. By doing this, we ensure that, when the player starts dragging, the <code class="literal">OnDragBegins()</code> function from our script is called.</p></li><li><p>To add the last event, click <a id="id234" class="indexterm"></a>on <span class="strong"><strong>Add New Event Type</strong></span> | <span class="strong"><strong>End Drag</strong></span>. Next, click on the <span class="strong"><strong>+</strong></span> sign in the bottom-right corner of the panel. Again, we have to drag the <span class="strong"><strong>DragAndDropScript</strong></span> itself into the <span class="strong"><strong>object</strong></span> variable. As before, select <span class="strong"><strong>DragAndDropScript</strong></span> | <span class="strong"><strong>onDragEnd</strong></span> from the drop-down menu. As a result, when the player finishes dragging, the <code class="literal">OnDragEnd()</code> function from our script is called.</p></li><li><p>As a final step, we can draw a new image and use it as an <span class="strong"><strong>Icon</strong></span>. Alternatively, we can take the one created in the <span class="emphasis"><em>Creating a modular coin counter</em></span> recipe from <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Implementing Counters and Health Bars</em></span>. After we have created a new prefab, we drag and drop this image into the prefab. Then, we drag and drop the prefab into the original variable of our script.</p></li><li><p>Finally, we can click on the play button and check whether everything works as it should, as shown here:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_04_EXTRA01.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec115"></a>How it works...</h3></div></div></div><p>Every time the player <a id="id235" class="indexterm"></a>starts dragging, drags, or finishes dragging, the <span class="strong"><strong>Event Trigger (Script)</strong></span> will call our script. It creates a new <code class="literal">GameObject</code> and moves it accordingly.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec116"></a>There's more...</h3></div></div></div><p>It is possible to learn how to perform a check for the objects that have been dropped, in the next section.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec31"></a>Checking for dropped objects</h4></div></div></div><p>When the player <a id="id236" class="indexterm"></a>drops the <code class="literal">temp</code> object, we may want to check whether it is inside another panel. In order to do this, we need to add a new variable and some lines of code to our <code class="literal">onDragEnd()</code> function.</p><p>Let's add a variable that stores the reference to the panel where we want to check whether our <code class="literal">temp</code> is dropped. It has to be public so that designers can set it in the <span class="strong"><strong>Inspector</strong></span>. Therefore, we can write this line:</p><div class="informalexample"><pre class="programlisting">public RectTransform dropPanel;</pre></div><p>Now, we need to change the <code class="literal">onDragEnd()</code> function in the following way:</p><div class="informalexample"><pre class="programlisting">public void onDragEnd(){
  Vector3[] worldCorners = new Vector3[4];
  dropPanel.GetWorldCorners(worldCorners);

  if(Input.mousePosition.x&gt;= worldCorners[0].x &amp;&amp;Input.mousePosition.x&lt;worldCorners[2].x 
  &amp;&amp;Input.mousePosition.y&gt;= worldCorners[0].y &amp;&amp;Input.mousePosition.y&lt;worldCorners[2].y) {
    Debug.Log ("Dropped");
  }
  GameObject.Destroy (temp);
}</pre></div><p>We used the <code class="literal">GetWorldCorners()</code> function, which allows us to retrieve the corners of our <code class="literal">dropPanel</code>. Furthermore, along with an <code class="literal">if</code> statement, we have to check whether <code class="literal">temp</code> is inside the boundaries of the <code class="literal">dropPanel</code> when the player drops it. Since we set the <code class="literal">temp</code> position to<a id="id237" class="indexterm"></a> the same position of the mouse in the <code class="literal">onDrag()</code> function, we can use the mouse position to perform the check. Therefore, if this check is <code class="literal">true</code>, it means the item has been dropped inside the <code class="literal">dropPanel</code>, and we print a message through the <code class="literal">Debug.Log()</code> function. Of course, feel free to perform whichever action is adequate for your game.</p></div></div></div>