<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec43"></a>Developing an MP3 player</h2></div></div><hr /></div><p>In this recipe, we will see how to create a simple MP3 player with the <span class="strong"><strong>Play</strong></span>, <span class="strong"><strong>Pause</strong></span>, <span class="strong"><strong>Stop</strong></span>, <span class="strong"><strong>Next</strong></span>, and <span class="strong"><strong>Previous</strong></span> buttons. Here, the focus will be on how to learn the interaction between <span class="strong"><strong>UI</strong></span> and the <span class="strong"><strong>Audio Source (Script)</strong></span> component within a script. Furthermore, we will see how to use<a id="id238" class="indexterm"></a> the <span class="strong"><strong>Event Trigger (Script)</strong></span> component to call all the functions in our script. These will actually implement the logic behind the MP3 player.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec117"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, we can create a panel by right-clicking on the <span class="strong"><strong>Hierarchy</strong></span> panel and then clicking on <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>. Rename it to <span class="strong"><strong>MP3Panel</strong></span>. We should also resize it so that we can see the entire panel on the screen. This is the panel that will contain all the buttons of our player.</p></li><li><p>Next, we need to create five buttons inside the panel. To do this, we can right-click on <span class="strong"><strong>MP3Panel</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> panel and then click on <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Button</strong></span>. We can easily duplicate it four times by pressing <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>. Each time, place the button on the screen as shown in the following screenshot. We should rename them to <span class="strong"><strong>PlayButton</strong></span>, <span class="strong"><strong>PauseButton</strong></span>, <span class="strong"><strong>StopButton</strong></span>, <span class="strong"><strong>PrevButton</strong></span>, and <span class="strong"><strong>NextButton</strong></span>, and also change the text of these buttons respectively to <span class="strong"><strong>Play</strong></span>, <span class="strong"><strong>Pause</strong></span>, <span class="strong"><strong>Stop</strong></span>, <span class="strong"><strong>Prev</strong></span>, and <span class="strong"><strong>Next</strong></span>. Finally, we should have something that looks like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_04_14.jpg" /></div></li><li><p>We also need to add an <span class="strong"><strong>Audio Source (Script)</strong></span> component to <span class="strong"><strong>MP3Panel</strong></span>. To do this, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span>. As a result, our player can now act as an audio source. This means that it is able to reproduce music.</p></li><li><p>Now, we need to create our script on <span class="strong"><strong>MP3Panel</strong></span>. Therefore, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <span class="strong"><strong>MP3PlayerScript</strong></span>. Then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double-click <a id="id239" class="indexterm"></a>on the script in order to edit it. This time, we don't need to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script. But before the class, we add this line: <code class="literal">[RequireComponent(typeof(AudioSource))]</code> (without the semicolon at the end). In this way, we are saying that, to use this script, an <span class="strong"><strong>Audio Source (Script)</strong></span> component attached to the same game object of this script is required. If it is not present, it will be added automatically.</p></li><li><p>Before we add any functions, we need four variables. The first is a private variable for storing <code class="literal">AudioSource</code>, where all the sounds will be reproduced. The second one is an array of <code class="literal">AudioClip</code> for storing our entire playlist, and it is public, so we can set the music from the <span class="strong"><strong>Inspector</strong></span>. The third one is <code class="literal">private int</code>, and it stores the index of the current song. The last one is <code class="literal">private bool</code>, and it stores information on whether the player has stopped the music or not. So, we can write these lines:</p><div class="informalexample"><pre class="programlisting">private AudioSource audioSource;
public AudioClip[] musicList;
private int index=0;
private bool isStopByPlayer;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we assign the <span class="strong"><strong>Audio Source (Script)</strong></span> component that is attached to the same game object of this script to the <code class="literal">audioSource</code> variable:</p><div class="informalexample"><pre class="programlisting">void Start () {
  audioSource = GetComponent&lt;AudioSource&gt; ();
}</pre></div></li><li><p>Now, we have to write one public function for each button, which means five functions in total. The first one is the <code class="literal">Play()</code> function, in which we call the <code class="literal">Play()</code> function <a id="id240" class="indexterm"></a>on <code class="literal">audioSource</code> and set the <code class="literal">isStopByPlayer</code> variable to <code class="literal">false</code>, since the player has just pressed play and not one of the stop buttons. So, we can write the following:</p><div class="informalexample"><pre class="programlisting">public void Play(){
  audioSource.Play ();
  isStopByPlayer = false;
}</pre></div></li><li><p>The second one is the <code class="literal">Pause()</code> function, in which we call the <code class="literal">Pause()</code> function on <code class="literal">audioSource</code>. Also, since the player has just pressed one of the stop buttons, we set the <code class="literal">isStopByPlayer</code> variable to <code class="literal">true</code>:</p><div class="informalexample"><pre class="programlisting">public void Pause(){
  audioSource.Pause ();
  isStopByPlayer = true;
}</pre></div></li><li><p>The <code class="literal">Stop()</code> function is similar to the previous one. It calls the <code class="literal">Stop()</code> function on <code class="literal">audioSource</code> and, since the player has just pressed one of the stop buttons, we set the <code class="literal">isStopByPlayer</code> variable to <code class="literal">true</code>:</p><div class="informalexample"><pre class="programlisting">public void Stop(){
   audioSource.Stop ();
  isStopByPlayer = true;
}</pre></div></li><li><p>In the <code class="literal">Next()</code> function, we need to take care with the index of the playlist and play the next song that is on the list. If the current track is the last one, we play the first one. Therefore, we start increasing <code class="literal">index</code> by <code class="literal">1</code>. Then we check whether <code class="literal">index</code> has reached the last track, and if so, we change <code class="literal">index</code> to <code class="literal">0</code> in order to make it point to the first track. Finally, we assign the track pointed by <code class="literal">index</code> in the music list to the <code class="literal">clip</code> variable of <code class="literal">audioSource</code>. After that, in the final line, we call the <code class="literal">Play()</code> function, which we have written before:</p><div class="informalexample"><pre class="programlisting">public void next(){
  index++;
  if (index == musicList.Length)
    index = 0;
  audioSource.clip = musicList [index];
  Play ();
}</pre></div></li><li><p>As we did in the <a id="id241" class="indexterm"></a>preceding function, in the <code class="literal">previous()</code> function, we have to worry about the index of the playlist and reproduce the previous track of the list. Thus, if the current track is the first one, we need to play the last one. Therefore, we start decreasing <code class="literal">index</code> by <code class="literal">1</code>. Then we check whether <code class="literal">index</code> has reached the first track, and if so, we change <code class="literal">index</code> to make it point to the last track. Finally, we assign the track pointed by <code class="literal">index</code> in the music list to the <code class="literal">clip</code> variable of <code class="literal">audioSource</code>. And in the final line, we call the <code class="literal">Play()</code> function, which we have written before:</p><div class="informalexample"><pre class="programlisting">public void previous(){
  index--;
  if (index == -1)
    index = musicList.Length-1;
  audioSource.clip = musicList [index];
  Play ();
}</pre></div></li><li><p>In the <code class="literal">Update()</code> function, we check whether the track is finished and is not stopped by the player. If so, we call the <code class="literal">next()</code> function that we wrote before. It will play the next track from the music list:</p><div class="informalexample"><pre class="programlisting">void Update () {
  if (!audioSource.isPlaying &amp;&amp; !isStopByPlayer)
    next ();
}</pre></div></li><li><p>Save the script and come back into Unity. Now, we need to set the events. We select all the five buttons so that we can multi-edit them, and click on the <span class="strong"><strong>+</strong></span> sign in the bottom-right corner of the <code class="literal">OnClick</code> event panel in the <span class="strong"><strong>Inspector</strong></span>. Then drag <span class="strong"><strong>MP3Panel</strong></span> into the <code class="literal">object</code> variable.</p></li><li><p>For the next step, we need to set the event differently for each button. So, for each of them, select in the drop-down menu <span class="strong"><strong>MP3PlayerScript</strong></span> and the corresponding function: <span class="strong"><strong>PlayButton</strong></span> with the <code class="literal">Play()</code> function, <span class="strong"><strong>PauseButton</strong></span> with the <code class="literal">Pause()</code> function, <span class="strong"><strong>StopButton</strong></span> with the <code class="literal">Stop()</code> function, <span class="strong"><strong>NextButton</strong></span> with the <code class="literal">next()</code> function, and finally <span class="strong"><strong>PrevButton</strong></span> with the <code class="literal">previous()</code> function.</p></li><li><p>Since we don't want the player to press <span class="strong"><strong>PlayButton</strong></span> while a track is being played, we have to enable and disable it dynamically. To do this, we select <span class="strong"><strong>PlayButton</strong></span>, <span class="strong"><strong>StopButton</strong></span>, and <span class="strong"><strong>PauseButton</strong></span> so that we can multi-edit them. In the <span class="strong"><strong>OnClick</strong></span> event panel, click again on the <span class="strong"><strong>+</strong></span> sign in the bottom-right corner to add a new<a id="id242" class="indexterm"></a> event. Drag <span class="strong"><strong>PlayButton</strong></span> in the <span class="strong"><strong>object</strong></span> variable. Finally, in the drop-down menu, select <span class="strong"><strong>Button</strong></span> | <span class="strong"><strong>Interactable</strong></span>.</p></li><li><p>By default, the boolean value should be <code class="literal">false</code> (not checked), and it is fine for <span class="strong"><strong>PlayButton</strong></span> but not for the other two. Therefore, select <span class="strong"><strong>StopButton</strong></span> and <span class="strong"><strong>PauseButton</strong></span> and check the boolean to make it <code class="literal">true</code>.</p></li><li><p>Since the MP3 player will start at the beginning of the scene, we have to disable <span class="strong"><strong>PlayButton</strong></span> even at the start. Hence, after we have selected it, we can uncheck the <span class="strong"><strong>Interactable</strong></span> variable from the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>The final step is to load some nice tracks into the <span class="strong"><strong>MP3Panel</strong></span> inside the <span class="strong"><strong>Inspector</strong></span>. Click on the play button to test the scene and listen to some nice music.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec118"></a>How it works...</h3></div></div></div><p>Each button has an attached <span class="strong"><strong>Event Trigger (Script)</strong></span> that will call the respective function of our script. In fact, our script contains a function for every component. This last one will control the <span class="strong"><strong>Audio Source (Script)</strong></span> component to create an MP3 player.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec119"></a>There's more...</h3></div></div></div><p>The next section teaches us how to display the name of the song in our MP3 Player, to the player.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec32"></a>Showing the name of the song</h4></div></div></div><p>It would be a <a id="id243" class="indexterm"></a>great improvement for the MP3 player if we displayed the name of the song that is currently being played, providing the player with more information during his experience. We can achieve this by using a <span class="strong"><strong>Text (Script)</strong></span> component and modifying our script a little.</p><p>First, select <span class="strong"><strong>MP3Panel</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> panel. Then select <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span> and rename it to <span class="strong"><strong>MP3Text</strong></span>.</p><p>Before we modify our script, we need to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script. In fact, here we are going to use the <code class="literal">Text</code> class.</p><p>Then, we add a new <code class="literal">public</code> variable to our script:</p><div class="informalexample"><pre class="programlisting">public Text uiText;</pre></div><p>This will store the reference to the <span class="strong"><strong>Text (Script)</strong></span> component of <span class="strong"><strong>MP3Text</strong></span> so that we can keep track of it.</p><p>After this, let's add<a id="id244" class="indexterm"></a> these lines at the end of the <code class="literal">Update()</code> function:</p><div class="informalexample"><pre class="programlisting">uiText.text = audioSource.name;</pre></div><p>By doing this, we display the name of the song (the name of <span class="strong"><strong>AudioClip</strong></span>) in the <span class="strong"><strong>text</strong></span> variable of the <span class="strong"><strong>Text (Script)</strong></span> component on <span class="strong"><strong>uiText</strong></span>.</p><p>Finally, we can click on play to verify that everything works as expected.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip20"></a>Tip</h3><p>Since the name of the song could be longer than the <span class="strong"><strong>text</strong></span> component, ensure that <span class="strong"><strong>MP3Text</strong></span> is long enough. We can stretch it with the <span class="strong"><strong>Rect tool</strong></span>.</p><p>Otherwise, we can implement other solutions. Let's explore three of them. The first is the easiest, and it requires us to use the <span class="strong"><strong>Content Size Fitter</strong></span> to make the text dynamically fit within <span class="strong"><strong>MP3Text</strong></span>. Another solution, which is a bit more effective, is to write a script that truncates the name of the song, if it is too long. For instance, we can add <span class="strong"><strong>...</strong></span> at the end of the name. Finally, if it is important to show the entire name, we can make the name scroll gradually, by programming this behavior within our script.</p></div></div></div></div>