<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec21"></a>Creating a modular coin counter</h2></div></div><hr /></div><p>This recipe teaches us how to use a <span class="strong"><strong>Text (Script)</strong></span> and <span class="strong"><strong>Image (Script)</strong></span> components along with a script to create a<a id="id91" class="indexterm"></a> counter with an icon. It is similar to the counters in the two previous recipes, but, instead, to keep track of the score or lives, here we manage the number of coins possessed by the player. In contrast to the first counter that doesn't have an upper bound, or like the second counter that has a maximum for lives, here, when the player has reached a certain number of coins, something will happen. For example, a life will be added and the counter starts from zero, creating modularity.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec47"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>As for the first step of the previous recipe, we need to create a new UI text to show the number of lives. Hence, right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel and then <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span>. Finally, rename it to <span class="strong"><strong>Modular Coin Counter</strong></span>.</p></li><li><p>Let's adjust the settings to suit our needs, such as <span class="strong"><strong>Font</strong></span>, <span class="strong"><strong>Font Size</strong></span>, and <span class="strong"><strong>Color</strong></span>, and also write in the <span class="strong"><strong>Text</strong></span> variable <code class="literal">0</code> (zero).</p></li><li><p>In order to add an icon to our counter, we need to create an image inside the <span class="strong"><strong>Modular Coin Counter</strong></span>, so right-click on it and select <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>, and then rename it to <span class="strong"><strong>Modular Coin Counter Icon</strong></span>.</p></li><li><p>The next step is to create the icon, so let's open a graphic program and create our icon:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_02_03.jpg" /></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Tip</h3><p>If we are using Photoshop, you can easy create this by using the ellipse tool: ensure that the main color is on yellow, and, then, while keeping <span class="emphasis"><em>Shift</em></span> pressed, click on the upper left corner and drag to the lower right corner. Finally, select the <span class="strong"><strong>Text</strong></span> tool and type a <code class="literal">$</code>, press <span class="emphasis"><em>Ctr</em></span>+<span class="emphasis"><em>T</em></span>, then scale, and place it at the center of the circle. Now we have a simple icon for coins.</p><p>If you don't have a graphic program or you don't want to open a graphic program, you can use the image provided along with the code of this book.</p></div></li><li><p>Right-click <a id="id92" class="indexterm"></a>on the <span class="strong"><strong>Project</strong></span> panel and select <span class="strong"><strong>Import new asset</strong></span>; select the icon that we have just created and import it.</p></li><li><p>If our project is set in 2D, we can skip this step. Otherwise, select the asset just imported in the <span class="strong"><strong>Project</strong></span> panel and, in the <span class="strong"><strong>Inspector</strong></span>, change <span class="strong"><strong>Texture Type</strong></span> into <span class="strong"><strong>Sprite (2D and UI)</strong></span>. Finally, click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>We can now add the icon to the <span class="strong"><strong>Modular Coin Counter Icon</strong></span> in the <span class="strong"><strong>Source Image</strong></span> variable and place it near the <span class="strong"><strong>Modular Coin Counter</strong></span>. We should see something like the following:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_02_04.jpg" /></div></li><li><p>It's time to implement the logic in the script. To begin, let's add it to the <span class="strong"><strong>Modular Coin Counter</strong></span>, select <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>, and then name it <span class="strong"><strong>ModularCoinCounterScript</strong></span>. Finally, press <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>Double-click on the script to edit it. We are going to use some UI classes, so we need to <a id="id93" class="indexterm"></a>add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script.</p></li><li><p>Before we can add functions, we need three variables, two private and one public, so we can set this last one in the <span class="strong"><strong>Inspector</strong></span>. Thus, we can write:</p><div class="informalexample"><pre class="programlisting">  private Text uiText;
  public intmaxCoins = 100;
  private int coins = 0;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we set the <code class="literal">uiText</code> variable and then call our <code class="literal">update</code> function. The following is the <code class="literal">Start()</code> function:</p><div class="informalexample"><pre class="programlisting">  void Start () {
    uiText = this.GetComponent&lt;Text&gt; ();
    updateCoinCounter ();
  }</pre></div></li><li><p>Now, we allow other scripts to add coins through this function:</p><div class="informalexample"><pre class="programlisting">  public void addCoins(int value){
    coins += value;
    while (coins &gt;= maxCoins)
      ApplyModularity ();
    updateCoinCounter ();
  }</pre></div></li><li><p>In the previous<a id="id94" class="indexterm"></a> function, we called the <code class="literal">ApplyModularity()</code> function; let's write it down:</p><div class="informalexample"><pre class="programlisting">  private void ApplyModularity(){
    coins -= maxCoins;
    GameObject.Find ("LivesCounter").GetComponent&lt;LivesCounterScript&gt; ().addLife ();
  }</pre></div></li><li><p>Finally, as usual, our <code class="literal">update</code> function:</p><div class="informalexample"><pre class="programlisting">  private void updateCoinCounter(){
    uiText.text = coins.ToString();
  }</pre></div></li><li><p>As final step, save our work and the job is done.</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_02_05.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec48"></a>How it works...</h3></div></div></div><p>In the script, we have created three variables. The first one is <code class="literal">uiText</code> and, as usual, it stores the reference to the <span class="strong"><strong>Text (Script)</strong></span> component. The <code class="literal">maxCoins</code> variable is the number of coins after which the modularity is applied, and we can set its value in the <span class="strong"><strong>Inspector</strong></span>, but as<a id="id95" class="indexterm"></a> default in our script, it has <code class="literal">100</code> as value. Finally, the <code class="literal">coins</code> variable contains the number of coins currently possessed by the player and its default value is <code class="literal">0</code> (zero).</p><p>In the <code class="literal">Start()</code> function, we assigned the <span class="strong"><strong>Text (Script)</strong></span> component attached in the same game object of this script to the <code class="literal">uiText</code> variable. We did this by calling the <code class="literal">this.GetComponent&lt;Text&gt;()</code> function. Then, we called the <code class="literal">updateCoinCounter ()</code> function in order to update the UI also during the first iteration.</p><p>Furthermore, we have written a function to <code class="literal">addCoins(int value)</code> to the player that takes as an int parameter and it is the number of coins that will be added to the player. In fact, at the beginning, we added value to the coins variable by coins <code class="literal">+=</code> value;. Then, there is a <code class="literal">while</code> loop: until the number of coins are more than the maximum allowed, we call the <code class="literal">ApplyModularity()</code> function. Since we don't know how many coins have been added with the <code class="literal">value</code> parameter, we have to apply the modularity as many times the number of <code class="literal">maxCoins</code> are into the <code class="literal">coins</code> variable. At last, of course, we call our <code class="literal">updateCoinCounter ()</code> function in order to update the UI.</p><p>To better understand how the modularity works, let's consider the example of our <code class="literal">ApplyModularity()</code> function. First of all, this function is private, so only other functions within the same script can call it. Furthermore, it is called only when the number of coins are more than <code class="literal">maxCoins</code>, at most equal. So we can subtract the value of <code class="literal">maxCoins</code> from the <code class="literal">coins</code> variable, without obtaining a negative number of coins, and we do this in the first line of code. Then we can choose the reward for the player since he has reached the <code class="literal">maxCoins</code> number. In this example, if we have done this in <span class="emphasis"><em>Implementing a lives counter</em></span> recipe, we can add a life to the player. So, let's find the lives counter through <code class="literal">GameObject.Find ("LivesCounter")</code> and then the script with <code class="literal">GetComponent&lt;LivesCounterScript&gt; ()</code>. Finally, we can call the <code class="literal">addLife ()</code> function.</p><p>At the end, we have <code class="literal">updateCoinCounter()</code>, in which we put the value of coins, converted in string through the <code class="literal">ToString()</code> function, into the <span class="strong"><strong>Text</strong></span> variable contained into <span class="strong"><strong>Text (Script)</strong></span> component in the <span class="strong"><strong>Modular Coin Counter</strong></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec49"></a>There's more...</h3></div></div></div><p>Some improvements of the modular coin counter can be found in the following sections.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec12"></a>Removing coins</h4></div></div></div><p>If in our game there is the possibility of losing coins, we can easily implement this feature by adding another function to our script:</p><div class="informalexample"><pre class="programlisting">  public void removeCoins(int value){
    coins -= value;
    if (coins &lt; 0)
      coins = 0;
    updateCoinCounter ();
  }</pre></div><p>The first line<a id="id96" class="indexterm"></a> subtracted the value to the <code class="literal">coins</code> variable; then the <code class="literal">if</code> statement checks whether we have a negative coin number and, if so, set the coins variable to zero. Finally, we called our <code class="literal">update</code> function.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec13"></a>Adding score if the number of lives has reached the maximum</h4></div></div></div><p>It may happen<a id="id97" class="indexterm"></a> that the player has reached the maximum amount of lives that he is able to have, and if he reaches 100 coins, it would be unkind not give him a reward. In this case, we can reward him in another way. If we also did the score counter, we can give him some score points so that he doesn't lose the coins gained. Therefore, we need to change the <code class="literal">ApplyModularity()</code> function in the following way:</p><div class="informalexample"><pre class="programlisting">  private void ApplyModularity(){
    coins -= maxCoins;
    if (!GameObject.Find ("LivesCounter").GetComponent&lt;LivesCounterScript&gt; ().addLife ())
      GameObject.Find ("ScoreCounter").GetComponent&lt;ScoreCounterScript&gt; ().addPoints (230);
  }</pre></div><p>Since the <code class="literal">addLife()</code> function returns <code class="literal">true</code> if a life is added or <code class="literal">false</code> if it is not, we can put it inside an <code class="literal">if</code> statement with a negation. Therefore, if the life is not added, the next line of code is executed. In fact, this adds 230 score points to the player, in the same way we have added a life, but instead of the <code class="literal">LivesCounter</code>, we search for <code class="literal">ScoreCounter</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec14"></a>Getting the number of coins</h4></div></div></div><p>If we need to retrieve<a id="id98" class="indexterm"></a> the value of the <code class="literal">coins</code> variable for any reason, such as displaying them in a virtual shop, we will need to add a <code class="literal">get</code> function like the following one:</p><div class="informalexample"><pre class="programlisting">  public intgetCoins(){
    return coins;
  }</pre></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec50"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>We can refer to the two previous recipes about how to implement a lives counter or a score counter.</p></li><li style="list-style-type: disc"><p>In addition, for more <a id="id99" class="indexterm"></a>detail about the <code class="literal">get</code> function, please refer to the <span class="emphasis"><em>Implementing a score counter</em></span> recipe, in the <span class="emphasis"><em>There's more...</em></span> section.</p></li></ul></div></div></div>