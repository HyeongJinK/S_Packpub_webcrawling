<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec77"></a>Creating a minimap</h2></div></div><hr /></div><p>In this recipe, we will create a minimap. An ordinary minimap features the basic points of navigation, typically in the shape of a circle or a square. In some instances, a minimap features a scaled-down real-time<a id="id501" class="indexterm"></a> version of a map. In others, it may be a simplified version of the terrain. Whatever the case may be, minimaps prove to be a useful feature when traversing large landscapes, and they are also a way of indicating to the player the locations of various items. In this recipe, you will start learning how to use render textures and raw images. You will also learn how to set the position of the camera according to the player's position.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec213"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First of all, we need to create the scene in which we can test the minimap.</p></li><li><p>To quickly generate a 3D environment, we can use the <span class="strong"><strong>Terrain</strong></span> object, which we can create by right-clicking on the <span class="strong"><strong>Hierarchy</strong></span> panel and then going to <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Terrain</strong></span>.</p></li><li><p>Now, in the <span class="strong"><strong>Inspector</strong></span>, we can choose different tools to model it. Feel free to consult the official Unity documentation on how to use them. We can find the link in the <span class="emphasis"><em>See also</em></span> section of this recipe. However, what we want to achieve is something like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_10_01.jpg" /></div></li><li><p>Therefore, we need to create some mountains, and maybe mold a valley. Also, to give the terrain some colors, we can use the <span class="strong"><strong>Brush</strong></span> tool to paint the world with some nice textures. Even though this part doesn't directly relate to how we create a<a id="id502" class="indexterm"></a> minimap, it is worthwhile to spend some time on creating a nice 3D environment if we don't have any. In this way, we will have a better scene to test the minimap and ultimately understand how it works. In fact, as we will see in the <span class="emphasis"><em>There's moreâ€¦</em></span> section of the next recipe, a lot of improvements make sense in real game environments only. For instance, we cannot improve shadows if our terrain is completely flat, because we don't have any shadows. Furthermore, we should also add a player object to the scene and attach a script to it to make it move. Now that we have an environment, we can implement the minimap system.</p></li><li><p>To display the minimap, we will use another camera, which is different from <span class="strong"><strong>MainCamera</strong></span>. This camera will display the scene from a top-down view and will be the background that our minimap is based on. Right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel and select <span class="strong"><strong>Camera</strong></span>. Finally, rename it to <span class="strong"><strong>MinimapCamera</strong></span>.</p></li><li><p>By default, a <span class="strong"><strong>Camera</strong></span> comes with <span class="strong"><strong>Audio Listener</strong></span> attached to it. Since we should keep only one <span class="strong"><strong>Audio Listener</strong></span> in the scene at any single point in time, we have to remove this component from <span class="strong"><strong>MinimapCamera</strong></span>. To do this, right-click on <span class="strong"><strong>Audio Listener</strong></span> and select <span class="strong"><strong>Remove Component</strong></span>.</p></li><li><p>Next, we need to create a <span class="strong"><strong>Render Texture</strong></span>. Keep in mind that this feature is available in Unity Pro only. It is a very powerful component because it updates its texture at runtime. This could be useful to create reflections, monitors, and even mirrors in our games. However, here we will use them to render the minimap. In order to create a <span class="strong"><strong>Render Texture</strong></span>, right-click on the <span class="strong"><strong>Project</strong></span> panel and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Render Texture</strong></span>. Let's rename it <span class="strong"><strong>MinimapRenderTexture</strong></span>.</p></li><li><p>Then, we need to<a id="id503" class="indexterm"></a> link the <span class="strong"><strong>RenderTexture</strong></span> to <span class="strong"><strong>MinimapCamera</strong></span>. By doing this, we ensure that everything that is in view of the <span class="strong"><strong>Camera</strong></span> will be shown on <span class="strong"><strong>Render Texture</strong></span>. Select the camera and drag the <span class="strong"><strong>MiniMapRenderTexture</strong></span> into <span class="strong"><strong>Target Texture</strong></span>. Once we have done this, we should have something that looks like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_10_02.jpg" /></div></li><li><p>Now, we are ready to create our UI. We are going to use a UI component that we haven't used previously. This component is called <span class="strong"><strong>Raw Image</strong></span>. The main reason for using a raw image, and not the ones that we have used in all other chapters of this book, is that this one can handle every kind of texture type in Unity, and not <a id="id504" class="indexterm"></a>only sprite textures. Since <span class="strong"><strong>Render Texture</strong></span> isn't a <span class="strong"><strong>Sprite</strong></span>, we have to use <span class="strong"><strong>Raw Image</strong></span>. The way of creating it is similar to other UI elements. First, right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel, and then go to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Raw Image</strong></span>.</p><p>Finally, rename it <span class="strong"><strong>Minimap</strong></span>.</p></li><li><p>Place it in the <span class="strong"><strong>Canvas</strong></span> in the top-right corner, or whichever position best suits your game.</p></li><li><p>Now, we have linked <span class="strong"><strong>MinimapRenderTexture</strong></span> to the camera so that we can receive data from it. However, we also have to link <span class="strong"><strong>Render Texture</strong></span> to the <span class="strong"><strong>Raw Image</strong></span> that we created in the previous step. In this way, <span class="strong"><strong>Minimap</strong></span> can show the frame rendered by the camera on-screen. Let's do it by dragging <span class="strong"><strong>MinimapRenderTexture</strong></span> into the <span class="strong"><strong>Texture</strong></span> of <span class="strong"><strong>Minimap</strong></span>. After we have done this, we should see the following:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_10_03.jpg" /></div></li><li><p>The next step is to make <span class="strong"><strong>MinimapCamera</strong></span> follow the player from a top-down view. This means that <span class="strong"><strong>MinimapCamera</strong></span> should move only along the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>z</em></span> axes, because we don't want it to get closer or further away from the map. To do this, let's create a script on the <span class="strong"><strong>MinimapCamera</strong></span>.</p></li><li><p>Select <span class="strong"><strong>MinimapCamera</strong></span> in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <span class="strong"><strong>MinimapScript</strong></span>.</p></li><li><p>Next, click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Now, double click on the script in order to edit it. To keep the script as general as possible, let's create a new <code class="literal">public</code> variable that stores the player's <code class="literal">Transform</code>, since we will access to the position of this component every frame. In fact, in some games, the player can switch between characters, and this value can change at runtime without us having to modify this script. Keeping this in mind, we will need to add the following to our script:</p><div class="informalexample"><pre class="programlisting">public Transform playerTransform;</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip47"></a>Tip</h3><p>If the player object doesn't change over time, we can automatically set this variable in the <code class="literal">Start()</code> function, by calling the <code class="literal">GameObject.Find("Player").transform</code> function. Of course, if it is necessary, replace <code class="literal">"Player"</code> with the name of the player object in your scene.</p></div></li><li><p>Now, in the <code class="literal">Update()</code> function, we have to assign a new position to our camera. Therefore, we<a id="id505" class="indexterm"></a> will need to assign a new vector to it, where the <code class="literal">x</code> and <code class="literal">z</code> components, are the same as those of the player, while <code class="literal">y</code> is constant, for the reason explained in step 9. By doing this, we ensure that it will not only follow the player but also be centered on him:</p><div class="informalexample"><pre class="programlisting">void Update () {
  transform.position = new Vector3 (playerTransform.position.x, transform.position.y, playerTransform.position.z);
}</pre></div></li><li><p>Save the script and come back to Unity. Finally, we drag the <span class="strong"><strong>Player</strong></span> into the <code class="literal">public</code> variable of our script, and now everything is ready. Let's click on play and test what we have done so far.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec214"></a>How it works...</h3></div></div></div><p>In this recipe, we saw how to use render textures<a id="id506" class="indexterm"></a> and raw images to create a minimap.</p><p>In fact, we linked the<a id="id507" class="indexterm"></a> render texture to the camera by setting its target <code class="literal">texture</code> variable. By doing this, the camera has lost its ability to render on-screen. Thus the output of the camera is then stored in <span class="strong"><strong>Render Texture</strong></span>. When we assign this<a id="id508" class="indexterm"></a> render texture to <span class="strong"><strong>Image Raw</strong></span>, it takes the data<a id="id509" class="indexterm"></a> from the render texture. Finally, it is rendered as a UI element on the screen, which displays what is seen through the camera.</p><p>The process is shown in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_10_04.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec215"></a>There's more...</h3></div></div></div><p>Now that we have seen how to create a minimap, the following section will teach us how to improve it by setting the camera to work orthographically.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl3sec89"></a>Setting an orthographic camera</h4></div></div></div><p>Often, the design <a id="id510" class="indexterm"></a>of a game requires that the minimap is flat. As far as we have a perspective camera, it will never be as perfectly flat as we would like it to be. Therefore, in this case, we have to change <span class="strong"><strong>MinimapCamera</strong></span> in such a way that it renders in an orthographic mode rather than a perspective one.</p><p>To do this, we need to select <span class="strong"><strong>MinimapCamera</strong></span> and then change <span class="strong"><strong>Projection</strong></span> to <span class="strong"><strong>Orthographic</strong></span> in the <span class="strong"><strong>Inspector</strong></span>. Now, since <span class="strong"><strong>Field of View</strong></span> is a parameter that is only for perspective cameras, it disappears. As a result, <span class="strong"><strong>Size</strong></span> takes its place.</p><p>At this moment, the rendering of the camera may appear very close to the terrain. We can try to solve this issue by changing the position value of the <span class="emphasis"><em>y</em></span> axis. Since it is a top-down view (rotation along the <span class="emphasis"><em>x</em></span> axis equals 90 degrees, and it is zero otherwise), this doesn't affect the view. This is because all the view rays that are projected are parallel between them. So, we have to change the <span class="strong"><strong>Size</strong></span> value in order to see more inside our minimap.</p><p>Now, we render orthographically and the camera component should look like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_10_05.jpg" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec216"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>We have used<a id="id511" class="indexterm"></a> some not-so-common features of Unity. As such, it could be helpful to check out the following<a id="id512" class="indexterm"></a> resources from the official documentation:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><a class="ulink" href="http://docs.unity3d.com/Manual/script-RawImage.html" target="_blank">http://docs.unity3d.com/Manual/script-RawImage.html</a></p></li><li style="list-style-type: disc"><p><a class="ulink" href="http://docs.unity3d.com/Manual/class-RenderTexture.html" target="_blank">http://docs.unity3d.com/Manual/class-RenderTexture.html</a></p></li></ul></div></li><li style="list-style-type: disc"><p>If you want to refresh your understanding of how to use the terrain tool in Unity, you can refer to the official manual by visiting<a class="ulink" href="http://docs.unity3d.com/Manual/script-Terrain.html" target="_blank"> http://docs.unity3d.com/Manual/script-Terrain.html</a></p></li></ul></div></div></div>