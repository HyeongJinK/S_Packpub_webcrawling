<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec32"></a>Creating a mixed timer</h2></div></div><hr /></div><p>In this recipe, we are <a id="id162" class="indexterm"></a>going to mix the radial timer with the numeric one. Like in the previous recipe, the time remaining will be displayed as a ring that reduces circularly over time. Furthermore, inside the ring, we will display the time remaining as a number. A mixed timer can serve many different purposes, especially when a number of timers have to be viewed at once. For instance, imagine a strategy game where we have a number of resources that we wish to use. Each <a id="id163" class="indexterm"></a>of these resources takes time to regenerate after it has been used. At a glance, the radial timer can indicate how much time, across a range of different resources, any single resource has left. In addition, incorporating a numeric timer can specify exactly how much time is remaining until that resource is available again. In this way, using both a radial timer and a numeric timer in combination can provide the player with both an overview and a specific indication of time remaining. To create a mixed timer, we will use the <span class="strong"><strong>Image (Script)</strong></span> and <span class="strong"><strong>Text (Script)</strong></span> components and develop a script to manage the length of the circular bar, synchronized with the time shown as a number inside the ring.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec82"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First of all, we need to <a id="id164" class="indexterm"></a>create a circular bar for our timer, so we can open a graphic program and create it, or just use the one we created in the <span class="emphasis"><em>Implementing a radial health bar</em></span> recipe from the previous chapter.</p></li><li><p>Then, we should import it into our project and set its <span class="strong"><strong>Texture Type</strong></span> to <span class="strong"><strong>Sprite (2D and UI)</strong></span> (only if our project is not 2D) so that we can use it within the UI elements. Next, click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>Now, let's create a new UI image. To do this, right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel and then navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>. Rename it to <span class="strong"><strong>Mixed Timer</strong></span>.</p></li><li><p>Inside the <span class="strong"><strong>Image (Script)</strong></span> component, we have to change <span class="strong"><strong>Image Type</strong></span> to <span class="strong"><strong>Filled</strong></span>. The component should change a little in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Ensure that <span class="strong"><strong>Fill Method</strong></span> is set to <span class="strong"><strong>Radial 360</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> to <span class="strong"><strong>Bottom</strong></span>. We have to drag the bar that we previously imported into <span class="strong"><strong>Source Image</strong></span>. Finally, we can place <span class="strong"><strong>Mixed Timer</strong></span> wherever we want, remembering to use <span class="strong"><strong>Rect Tool</strong></span> as we do this or the keyboard shortcut <span class="emphasis"><em>T</em></span>.</p></li><li><p>We may want to keep its original proportions. In this case, we can click on the <span class="strong"><strong>Set Native Size</strong></span> button in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Furthermore, we need to create a new UI text to display the time as a number inside the ring. Right-click on <span class="strong"><strong>Mixed Timer</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> panel, and then navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span>.</p></li><li><p>We can change the <span class="strong"><strong>Font</strong></span> and the <span class="strong"><strong>Font Size</strong></span> fields as we want so that they better suit our needs.</p></li><li><p>We can also adjust <span class="strong"><strong>Color</strong></span>. For this example, we will set it to light gray, but feel free to use a color that better suits your design.</p></li><li><p>Now we can drag <span class="strong"><strong>Text</strong></span> with <span class="strong"><strong>Rect Tool</strong></span> inside our timer, or again use the keyboard shortcut <span class="emphasis"><em>T</em></span>.</p></li><li><p>To see it better in the scene view, we can write something in the <span class="strong"><strong>Text</strong></span> variable â€” for instance, the word <code class="literal">time</code>, even if this value will be replaced by the script.</p></li><li><p>Make sure that the <span class="strong"><strong>Rich Text</strong></span> variable is checked. We do this to ensure that different parts of the text in our timer can have different colors.</p></li><li><p>Now, we have to<a id="id165" class="indexterm"></a> create the script that manages the timer. After selecting <span class="strong"><strong>Mixed Timer</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>, name it <span class="strong"><strong>MixedTimerScript</strong></span>, and then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double click on the script to edit it, and then add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script so that we can use UI elements within the script.</p></li><li><p>Next, we need to add five variables; three are private and two are public. These will be set in the <span class="strong"><strong>Inspector</strong></span>. We write the following:</p><div class="informalexample"><pre class="programlisting">private Text uiText;
private Image barFilling;
public float timeAmount = 18f;
private float time;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we can set the <code class="literal">time</code> variable along with <code class="literal">barFilling</code> and <code class="literal">uiText</code> as well:</p><div class="informalexample"><pre class="programlisting">void Start () {
  barFilling = this.GetComponent&lt;Image&gt; ();
  time = timeAmount;
  uiText = this.GetComponentInChildren&lt;Text&gt; ();
}</pre></div></li><li><p>Finally, in our <code class="literal">Update()</code> function, we need to decrease the time by <code class="literal">Time.deltaTime</code> and then update the <code class="literal">fillAmount</code> variable of the bar accordingly. We can do this by writing the following:</p><div class="informalexample"><pre class="programlisting">void Update () {
  if (time &gt; 0) {
    time -= Time.deltaTime;
    if(time &lt; 0 )
      time = 0;
    barFilling.fillAmount = time / timeAmount;
    uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: " + time.ToString("F2");
  }
}</pre></div></li><li><p>Save the script and test it<a id="id166" class="indexterm"></a> by clicking on the play button. We should see the following result:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_03_04.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec83"></a>How it works...</h3></div></div></div><p>After importing the image, we set it to <span class="strong"><strong>Sprite (2D and UI)</strong></span> (only for 2D projects) so that we could use it in the UI. Then we created a new image and changed its <span class="strong"><strong>Fill Method</strong></span> value to <span class="strong"><strong>Radial 360</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> to <span class="strong"><strong>Bottom</strong></span>. In this way, the image can disappear gradually in an anticlockwise direction starting from the bottom, as the time decreases. Furthermore, we created another game object nested in the <span class="strong"><strong>Mixed Timer</strong></span> object, with a <span class="strong"><strong>Text (Script)</strong></span> component, in order to display the time as a number. Finally, we implemented a script for the logic.</p><p>In the script, we have four variables. The first one is <code class="literal">barFilling</code> and stores the reference to the <span class="strong"><strong>Image (Script)</strong></span> component attached to the same game object of the script. The second one is <code class="literal">uiText</code>, and it stores the reference to the <span class="strong"><strong>Text (Script)</strong></span> component, which is attached to the child game object of the mixed timer. The third variable is <code class="literal">timeAmount</code>, which is the amount of time set at the start, and from which the countdown begins to decrease. Finally, the fourth variable is <code class="literal">time</code> and contains the amount of time remaining.</p><p>In the <code class="literal">Start()</code> function, we began<a id="id167" class="indexterm"></a> by assigning the <span class="strong"><strong>Image (Script)</strong></span> component, which is attached to the same game object of this script, to <code class="literal">barFilling</code>. We did this by calling the <code class="literal">this.GetComponent&lt;Image&gt;()</code> function. We assigned the <span class="strong"><strong>Text (Script)</strong></span> component, which is attached to the child of the game object where this script is, to the <code class="literal">uiText</code> variable by calling the <code class="literal">this.GetComponentInChildren&lt;Text&gt;()</code> function. We did this to get the reference that we need in order to quickly access that component. Finally, we set the time to <code class="literal">timeAmount</code> so that the countdown begins with that specific starting time.</p><p>In <code class="literal">Update()</code>, we check at every frame whether <code class="literal">time</code> is more than zero. If so, we subtract <code class="literal">Time.deltaTime</code> from <code class="literal">time</code>, since the coupon decreases. If <code class="literal">time</code> is less than zero, then we set it to zero. Finally, we put the ratio between <code class="literal">time</code> and <code class="literal">timeAmount</code> into the <span class="strong"><strong>Fill Amount</strong></span> variable, which is contained in the <span class="strong"><strong>Image (Script)</strong></span> component of the mixed timer. In fact, the ratio is the percentage of the time remaining, which also indicates how much longer our linear timer needs to be. In the last line, we also updated the text inside our timer so that it could be displayed correctly inside the ring.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec84"></a>There's more...</h3></div></div></div><p>The following section will teach us how to improve the aesthetic of our timer to better suit our needs.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec19"></a>Changing the number of decimal points shown</h4></div></div></div><p>We can easily change the script so that it displays a certain number of decimal points in the timer. In order to <a id="id168" class="indexterm"></a>do that, let's add a variable called <code class="literal">decimalDigits</code> into our script and set its default value to <code class="literal">2</code>:</p><div class="informalexample"><pre class="programlisting">public int decimalDigits = 2;</pre></div><p>Then we have to look for this line inside the <code class="literal">Update()</code> function:</p><div class="informalexample"><pre class="programlisting">    uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: " + time.ToString("F2");</pre></div><p>And we can replace it with the following:</p><div class="informalexample"><pre class="programlisting">    uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: " + time.ToString("F"+decimalDigits);</pre></div><p>To decide how many decimal points will be shown, we need to set the <code class="literal">decimalDigits</code> variable in the <span class="strong"><strong>Inspector</strong></span>. In fact, by setting this variable in the <span class="strong"><strong>Inspector</strong></span>, we are changing the parameter of the <code class="literal">ToString</code> function. We do this in order to return a string that represents the float as a string, with<a id="id169" class="indexterm"></a> as many decimal points as we have decided in <code class="literal">decimalDigits</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec20"></a>Using a linear timer instead of a radial timer</h4></div></div></div><p>Instead of using a<a id="id170" class="indexterm"></a> radial timer, we can also use a linear timer and put the text inside the bar. In this example, it would be nice to add some borders to the bar. In fact, this helps to better integrate the timer with the rest of the UI. To do this, you can refer to the <span class="emphasis"><em>Implementing a linear health bar</em></span> recipe contained in the previous chapter, inside the <span class="emphasis"><em>There's more...</em></span> section.</p><p>To change the radial timer to a linear one, we have to change the <span class="strong"><strong>Fill Method</strong></span> of the mixed timer to <span class="strong"><strong>Horizontal</strong></span> and change <span class="strong"><strong>Fill Origin</strong></span> to <span class="strong"><strong>Left</strong></span>. Of course, we also have to change the <span class="strong"><strong>Source Image</strong></span> with the linear bar. If needed, we can use the <span class="strong"><strong>Set Native Size</strong></span> function and/or change the size of the text of the timer to better fit the bar. Once we have done all of these steps, we should have something that looks like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_03_05.jpg" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec85"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>For different kinds of timers or <a id="id171" class="indexterm"></a>countdowns, check out the <span class="emphasis"><em>Implementing  a numeric timer</em></span>, <span class="emphasis"><em>Creating a linear timer</em></span>, <span class="emphasis"><em>Implementing a radial timer</em></span>, <span class="emphasis"><em>Creating a well-formatted timer</em></span>, and <span class="emphasis"><em>Developing a well-formatted countdown that changes</em></span> recipes, all contained in this chapter</p></li></ul></div></div></div>