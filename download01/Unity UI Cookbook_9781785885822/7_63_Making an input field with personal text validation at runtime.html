<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec64"></a>Making an input field with personal text validation at runtime</h2></div></div><hr /></div><p>Here, we are <a id="id400" class="indexterm"></a>going to create another kind of customization, different from the previous recipes. In this case, we have an input field that we want to perform checks on, thus not allowing the player (instead of allowing, as in the previous recipes) to do something. Unity already has some of these controls in the <span class="strong"><strong>Input Field (Script)</strong></span> component, but in this recipe, you will learn how you can create your personal filters. In this example, we will develop a simple filter in order for you to understand the concept of how filters work. For instance, we want the player to insert an identifier, maybe for the score database, and we don't want his name to start with a number â€” because in many programming languages, identifiers cannot start with a number. We can perform this check at runtime by developing a script.</p><p>This filter is a basic filter, since it is static and it doesn't check the input in a dynamic way. "Dynamic" in this context means having some parametric constrains in the middle that depend on the sentence itself (for example, every number has to be followed by the letter "a"). In this case, we need to use loops and <code class="literal">for</code> cycles to perform the check, but how this interacts with our UI is the same for the basic filter. Therefore, you can learn here how to implement personal text validation at runtime inside your UI. However, in the <span class="emphasis"><em>There's more...</em></span> section of this recipe, you will see that it is possible to find a way to implement the preceding example of dynamic filtering.</p><p>Furthermore, the same section describes how we can modify the script to give feedback to the player. This is very important since we need to communicate what the constraints are to the player, if we don't want to frustrate him.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec178"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First of all, we need to create our input field by right-clicking on the <span class="strong"><strong>Hierarchy</strong></span> panel and then going to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Input Field</strong></span>. Rename it to <span class="strong"><strong>myInputField</strong></span>. Of course, we can place it wherever we want.</p></li><li><p>Select the input field. Then in the <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>, name it <span class="strong"><strong>PersonalTextValidation</strong></span>, and then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Now, double-click on the script in order to edit it. Just like every other occasion <a id="id401" class="indexterm"></a>when we have dealt with the UI, we have to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script, since we are going to use the <code class="literal">InputField</code> class. Before the beginning of the class, we can add this line: <code class="literal">[RequireComponent(typeof(InputField))]</code> (without the semicolon at the end). Thus, the script requires an <span class="strong"><strong>InputField</strong></span> component that is attached to the same game object of it.</p></li><li><p>We need two <code class="literal">private</code> variables: one to keep track of the <span class="strong"><strong>Input Field (Script)</strong></span> component attached to <span class="strong"><strong>myInputField</strong></span>, and the other to store the old text of the input field, since it could be needed to reverse the player's changes if he violates our validation format. So let's write these lines:</p><div class="informalexample"><pre class="programlisting">private InputField inputField;
private string oldText;</pre></div></li><li><p>As usual, in the <code class="literal">Start()</code> function, we are going to store the initial values for our <code class="literal">private</code> variables. First is a reference in <code class="literal">inputField</code>, by calling <code class="literal">GetComponent&lt;InputField&gt; ()</code> function, which takes the <span class="strong"><strong>Input Field (Script)</strong></span> component attached to the same game object in which this script is placed. Then comes <code class="literal">oldText</code>, with the starting text of our input field. So, we have this code:</p><div class="informalexample"><pre class="programlisting">  inputField = GetComponent&lt;InputField&gt; ();
  oldText = inputField.text;</pre></div></li><li><p>The next step is to create a new function that will be called every time we want a check in the text. This function only takes one parameter, which is the text that needs to be checked. Therefore, we can add this:</p><div class="informalexample"><pre class="programlisting">public void Check (string newText) {
}</pre></div></li><li><p>We have created the <code class="literal">Check()</code> function; now we have to fill in it. So, let's add the first control through an <code class="literal">if</code> statement. We check whether <code class="literal">newText</code> is an empty string, and if so, we just assign this new value to <code class="literal">oldText</code> and return, since there is nothing to check:</p><div class="informalexample"><pre class="programlisting">  if(newText == ""){
    oldText = newText;
    return;
  }</pre></div></li><li><p>The next <code class="literal">if</code> statement is the one that really performs our check: no numbers at the beginning of our string. So, as a condition, we verify that the first character is not a number using a chain of OR operators. We retrieve the first character of <code class="literal">newText</code> by accessing it as an array, and we are sure that here it contains at least one character; this is because in the previous check, we would have returned if the string was empty. So, we can write the following:</p><div class="informalexample"><pre class="programlisting">    if(newText[0] == '1'||
       newText[0] == '2'||
       newText[0] == '3'||
       newText[0] == '4'||
       newText[0] == '5'||
       newText[0] == '6'||
       newText[0] == '7'||
       newText[0] == '8'||
       newText[0] == '9'||
       newText[0] == '0'){</pre></div></li><li><p>Now, if the<a id="id402" class="indexterm"></a> condition is verified, we have to restore <code class="literal">oldText</code> inside the text of <code class="literal">inputField</code>, since this <code class="literal">newText</code> didn't pass our checks. Otherwise, if the condition is not verified, it means that our string has passed the checks. We have to update <code class="literal">oldText</code> with <code class="literal">newText</code> in an <code class="literal">else</code> statement, so let's continue the code of the previous step with this:</p><div class="informalexample"><pre class="programlisting">    inputField.text = oldText;
  }else{
    oldText = newText;
  }</pre></div></li><li><p>Save your script and come back to <code class="literal">Unity</code>. The next step is to pass the <code class="literal">string</code> that the player is writing to our script, so we need an event that sends it every time the text inside the input field is changed. If we select and then look inside the <span class="strong"><strong>Input Field (Script)</strong></span> component, we can notice that there are two events. Let's click on the small <span class="strong"><strong>+</strong></span> sign on the <span class="strong"><strong>On Value Change (String)</strong></span> event tab in the bottom-right corner.</p></li><li><p>Drag the script inside the <span class="strong"><strong>object</strong></span> variable and in the drop-down menu, go to <span class="strong"><strong>PersonalTextValidation</strong></span> | <span class="strong"><strong>Check</strong></span>. We also have to ensure that we have selected <span class="strong"><strong>Check</strong></span> in the first set of functions, called <span class="strong"><strong>Dynamic string</strong></span>, as shown in the following screenshot (and not <span class="strong"><strong>Check (string)</strong></span> in the second set, called <span class="strong"><strong>Static Parameters</strong></span>):</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_07_15.jpg" /></div></li><li><p>The final result should look like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_07_16.jpg" /></div></li><li><p>Now <a id="id403" class="indexterm"></a>everything is ready, so we can click on the play button to check whether everything works. Thus, when the player types something in our input field, it cannot start with a number.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec179"></a>How it works...</h3></div></div></div><p>We started by creating a script in which there is a function that takes the parameter as a string and it checks whether the string starts with a number. If so, it restores the string that was there before to insert the number at the beginning. Otherwise, it doesn't affect the input field. Then, we had to create an event that, every time the string inside the input field changes, it triggers our function by passing to it the <code class="literal">string</code> that the player is typing.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec180"></a>There's more...</h3></div></div></div><p>The following sections help us to improve the text filtering and to understand how the dynamic filtering works so that we can implement our own ones.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec62"></a>Checking the string when the player finished to type</h4></div></div></div><p>Sometimes, the design<a id="id404" class="indexterm"></a> of the game requires that the string checking should happen after the player has finished typing it. In such cases, we don't have to perform the check every time that the string changes, but only when the player completes edit that input field. The easiest way to do this is by changing the event in order to trigger our function, only at the end. We need to change what we did in step 11 Instead of adding an event to the <span class="strong"><strong>On Value Change (String)</strong></span> tab, we have to create a new one on the <span class="strong"><strong>End Edit (String)</strong></span> event tab by clicking on the <span class="strong"><strong>+</strong></span> sign in the bottom-right corner. So finally, we should have something that looks like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_07_17.jpg" /></div><p>Our function is called only when the player finishes editing the input field. However, keep in mind that in this way, if the string typed is invalid, the last valid string will be restored â€” the one that was present before, at the beginning of the last edit session. Giving feedback to the player on why the string he is writing is not acceptable for this input field is important.</p><p>It may be confusing for the player when he cannot insert some characters at certain points, for example, inserting numbers at the beginning. Thus, in some way, we should give feedback to the player to make him understand why he cannot use some strings or to indicate what has gone wrong.</p><p>To do this, we have to use another <span class="strong"><strong>Text (Script)</strong></span> component and handle it inside our script. Thus, let's change our script.</p><p>First, we need three<a id="id405" class="indexterm"></a> <code class="literal">public</code> variables. The first one is for storing the reference to the <span class="strong"><strong>Text (Script)</strong></span> component, and the other two are for customizing it. The second is for the error string to place on it, and the third is for changing its color. We can write the following lines:</p><div class="informalexample"><pre class="programlisting">public Text feedbackText;
public string errorString;
public Color newColor;</pre></div><p>However, we also need two private variables to store the original values of <code class="literal">feedbackText</code>, like this:</p><div class="informalexample"><pre class="programlisting">private string originalFeedbackText;
private Color originalFeedbackColor;</pre></div><p>These variables need to be assigned in the <code class="literal">Start()</code> function by adding the following two lines at the bottom of the function:</p><div class="informalexample"><pre class="programlisting">  originalFeedbackText = feedbackText.text;
  originalFeedbackColor = feedbackText.color;</pre></div><p>Now, we should go through the <code class="literal">Check()</code> function inside the <code class="literal">then</code> branch, which is inside the <code class="literal">if</code> statement. Then we can assign the new parameters, the text and the color, to <code class="literal">feedbackText</code> in this way:</p><div class="informalexample"><pre class="programlisting">    feedbackText.text = errorString;
    feedbackText.color = newColor;</pre></div><p>Next, restore the originals in the <code class="literal">else</code> branch by adding these lines:</p><div class="informalexample"><pre class="programlisting">     feedbackText.text = originalFeedbackText;
    feedbackText.color = originalFeedbackColor;</pre></div><p>After saving the script, we are able to assign a <span class="strong"><strong>Text (Script)</strong></span> to the <span class="strong"><strong>Feedback Text</strong></span> component, along with the text (which can be <span class="strong"><strong>The string cannot start with a number</strong></span>) and a color (which can be red).</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip33"></a>Tip</h3><p>We can create another UI text to assign to <span class="strong"><strong>Feedback Text</strong></span>. In this case, we may create an interesting variation, since this checking is at the beginning of our script. We can assign to it <span class="strong"><strong>Placeholder</strong></span>, which is one of the children of <span class="strong"><strong>myInputField</strong></span>. It is the text that there is inside the input field when it is empty.</p></div><p>So, if the player tries to<a id="id406" class="indexterm"></a> insert a number at the beginning, we should get something like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_07_18.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec63"></a>Using for cycles for dynamic filtering</h4></div></div></div><p>In this section, we <a id="id407" class="indexterm"></a>will present some basic notions on how a dynamic filter can be executed using <code class="literal">for</code> cycles. We will see that the concept is the same as that which we've used so far. In the introduction, we made the following example: every number has to be followed by the letter "a." In this case, what we need is looping over the string, and every time we find a number, it must be followed by the letter "a." Otherwise, the filter will restore the old string that the player was writing.</p><p>The first part of the <code class="literal">check()</code> function is the same:</p><div class="informalexample"><pre class="programlisting">if(newText == ""){
  oldText = newText;
  return;
}</pre></div><p>In fact, we always want to check whether the new string is empty. If it is, we return so that we don't waste time in performing a check on an empty string.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip34"></a>Tip</h3><p>In some cases, the input field may require at least a single character. In this case, we can check whether the string is empty, and if so, we reverse the modifications that are done to the string.</p></div><p>Now we will <a id="id408" class="indexterm"></a>create a <code class="literal">bool</code> variable to determine whether we have a number, from one cycle to the next. To do this, we need to write the following:</p><div class="informalexample"><pre class="programlisting">bool mustFollowA = false;</pre></div><p>Finally, the <code class="literal">for</code> cycle will go through all the characters of the <code class="literal">string</code>. If we find a number, we set our <code class="literal">mustFollowA</code> variable to <code class="literal">true</code>. By doing this, we know that before the next cycle, there was a number. Of course, if we find another number, we can still keep iterating, since the new digit is part of the same number. For example, suppose we have a string <code class="literal">bc12a</code>. When the cycle reaches the number <code class="literal">2</code>, it knows that before <code class="literal">2</code> there was a number, <code class="literal">1</code> in this case. However, the letter <code class="literal">a</code> must follow any number, and <code class="literal">12</code> is a number. Then, if we find an <code class="literal">a</code>, in lowercase or uppercase, we don't need to be concerned with what was there before. So, we can just deactivate the constraint by setting the <code class="literal">mustFollowA</code> variable to <code class="literal">false</code>. Otherwise, if the character is neither a number nor <code class="literal">a</code>, we check whether the <code class="literal">mustFollowA</code> variable is <code class="literal">true</code>. If so, it means that our test has failed. Hence, we restore the old string and return. Then, if the <code class="literal">for</code> cycle terminates, the test doesn't fail. Thus, we can assign the new string to our <code class="literal">oldText</code> variable:</p><div class="informalexample"><pre class="programlisting">  for(int i=0; i &lt; newText.Length; i++){
    if(newText[i] == '1'||
       newText[i] == '2'||
       newText[i] == '3'||
       newText[i] == '4'||
       newText[i] == '5'||
       newText[i] == '6'||
       newText[i] == '7'||
       newText[i] == '8'||
       newText[i] == '9'||
       newText[i] == '0'){
       mustFollowA = true;
      continue;
    }else if(newText[i] == 'a'||
             newText[i] == 'A'){
      mustFollowA = false;
      continue;
    }
    if(mustFollowA = true){ //FAIL: There is a number followed by another letter
      inputField.text = oldText;
      return;
    }
  }
  oldText = newText;</pre></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec181"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If you <a id="id409" class="indexterm"></a>want to put a lower bound limit for characters, it is worthwhile taking a look at the next recipe, <span class="emphasis"><em>Making an input field for password with a lower bound limit for characters</em></span>.</p></li></ul></div></div></div>