<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec34"></a>Developing a well-formatted countdown that changes</h2></div></div><hr /></div><p>In this recipe, we are going to create a countdown that displays the time on the screen as minutes and seconds. However, to take this display a step further, as the time elapses, it will change color. Just as the radial timer graphically represents the time that passes, a colored numeric timer provides a similar function. For example, in moments during gameplay when there<a id="id179" class="indexterm"></a> is intense action, a player may not necessarily have the time to focus on the timer, or he may actually lose track of the time that has elapsed. Whatever the case may be, another good way to indicate to the player the time as it is decreasing is through color. Therefore, as the player is engaged in gameplay, the color of the time can provide a quick indication of how close he is to running out of time. We will use the <span class="strong"><strong>Text (Script)</strong></span> component and develop a script to achieve our goal.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec90"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First of all, we need to create a new UI text to display our timer. To do this, right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel and then navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span>. Rename it to <span class="strong"><strong>Well Formatted Countdown</strong></span>.</p></li><li><p>We can change <span class="strong"><strong>Font</strong></span> and <span class="strong"><strong>Font Size</strong></span> as we wish so that they suit our needs better.</p></li><li><p>Next, we can adjust <span class="strong"><strong>Color</strong></span>. For this example, we will set it to to light gray, but feel free to use another color that better suits your design.</p></li><li><p>Remember that the color will also be changed from our script.</p></li><li><p>Now, we drag <span class="strong"><strong>Well Formatted Countdown</strong></span> with <span class="strong"><strong>Rect Tool</strong></span> to where we want to place it on the <span class="strong"><strong>Canvas</strong></span>.</p></li><li><p>To see it better inside <span class="strong"><strong>Scene View</strong></span>, we can add some text to the <span class="strong"><strong>Text</strong></span> variable. Even though this value will be replaced by the script, it will show us an approximation of how the timer will be displayed during runtime.</p></li><li><p>Furthermore, ensure that the <span class="strong"><strong>Rich Text</strong></span> variable is checked to be able to use different colors in the text.</p></li><li><p>Then, we have to create a script that manages the timer. To do this, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>, name it <span class="strong"><strong>Changing Countdown Script</strong></span>, and then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double click on the script to edit it, and add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script. As a result, we will be able to handle UI elements within our script.</p></li><li><p>Before we start adding any more functions, we need two private variables. So, we can write this:</p><div class="informalexample"><pre class="programlisting">private Text uiText;
private floattime;</pre></div></li><li><p>Now, we need to set the <code class="literal">uiText</code> variable in order to use it. We can do this in the <code class="literal">Start()</code> function:</p><div class="informalexample"><pre class="programlisting">void Start () {
  uiText = this.GetComponent&lt;Text&gt; ();
}</pre></div></li><li><p>Next, we will <a id="id180" class="indexterm"></a>need to write a few lines in the <code class="literal">Update()</code> function in order to update the timer:</p><div class="informalexample"><pre class="programlisting">void Update () {
  time -= Time.deltaTime;
  if (Mathf.Floor (time / 60) &gt;= 1) {
    string minutes = Mathf.Floor (time / 60).ToString ("00");
    string seconds = (time % 60).ToString ("00");
    uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: " + minutes + ":" + seconds;
  } else {
    if(time&gt;=10){
      uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: " + time.ToString("FOR");
    }else{
      uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: &lt;color=red&gt;" + time.ToString("F0")+"&lt;/color&gt;";
    }
  }
}</pre></div></li><li><p>We can save the script, and now our work is done. When the countdown has more than one minute remaining, it should look like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_03_07.jpg" /></div></li><li><p>When the countdown<a id="id181" class="indexterm"></a> has less than 1 minute but more than 10 seconds remaining, it should look like the following:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_03_08.jpg" /></div></li><li><p>When the<a id="id182" class="indexterm"></a> countdown has fewer than 10 seconds remaining, it should look like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_03_09.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec91"></a>How it works...</h3></div></div></div><p>First of all, we created a new UI text and adjusted it to suit our needs. We did this by changing <span class="strong"><strong>Font</strong></span>, <span class="strong"><strong>Font Size</strong></span>, and also <span class="strong"><strong>Color</strong></span>. We even ensured that <span class="strong"><strong>Rich Text</strong></span> was checked. Finally, we wrote a script to handle all of these changes depending on the amount of time<a id="id183" class="indexterm"></a> remaining.</p><p>In the script, there are two private variables, <code class="literal">uiText</code> and <code class="literal">time</code>. The <code class="literal">uiText</code> variable stores the reference to the <span class="strong"><strong>Text (Script)</strong></span> component. The <code class="literal">time</code> variable stores the amount of time that has elapsed since the countdown began.</p><p>In the <code class="literal">Start()</code> function, we assigned the <span class="strong"><strong>Text (Script)</strong></span> component, which is attached to the same object of the script, to the <code class="literal">uiText</code> variable by calling the <code class="literal">this.GetComponent&lt;Text&gt;()</code> function.</p><p>In contrast to what we did with the timers, in this case we subtracted <code class="literal">Time.deltaTime</code> from the <code class="literal">time</code> variable in the <code class="literal">Update()</code> function. This was because we were implementing a countdown. Therefore, we had to decrease the amount of time remaining.</p><p>In the first <code class="literal">if</code> statement, we check the number of minutes that are calculated by <code class="literal">Mathf.Floor (time / 60)</code>. If it is more than <code class="literal">1</code>, we format our countdown like the timer in the previous recipe. Otherwise, we can use the formatting from the first recipe in this chapter. In this last branch, we calculated the minutes by dividing <code class="literal">time</code> by <code class="literal">60</code>, and removing its decimal points with the <code class="literal">Mathf.Floor(float f)</code> function. Consequently, we transformed the number of minutes into a string, which is stored in the <code class="literal">minutes</code> variable. In order to get the seconds, we divided <code class="literal">time</code> again by <code class="literal">60</code>.</p><p>However, this time we took the remainder of the division. Again, we transformed this value into a string and stored its value inside the <code class="literal">seconds</code> variable. Finally, we updated the text variable of the <span class="strong"><strong>Text (Script)</strong></span> component, which is stored in the <code class="literal">uiText</code> variable. We had to set a formatted string where<a id="id184" class="indexterm"></a> minutes are separated from seconds to text. In the <code class="literal">else</code> branch, we check whether the countdown had less than 10 seconds remaining. If so, then the time is displayed in the same format as in the first recipe of this chapter. However, in this case, we changed the color of the text to red. Otherwise, if we do the same as the first recipe, it would have retained its original color.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec92"></a>There's more...</h3></div></div></div><p>The following sections will give us some new concepts that can be applied to our countdown.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec22"></a>Getting the time variable</h4></div></div></div><p>As we have seen before, in <a id="id185" class="indexterm"></a>some cases it's useful to retrieve the value of the <code class="literal">time</code> variable. To do this, we need to add a <code class="literal">get</code> function, like this:</p><div class="informalexample"><pre class="programlisting">public float getTime(){
  return time;
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec23"></a>Running code when the time expires</h4></div></div></div><p>If we place a <a id="id186" class="indexterm"></a>countdown in our game, it's probably because we want to trigger an event when it expires, such as making the player lose the level. Despite the reason, we can achieve this by changing our script slightly. First, we need to add a new variable:</p><div class="informalexample"><pre class="programlisting">private bool isOver;</pre></div><p>Then, we should add this line in the <code class="literal">Update()</code> function:</p><div class="informalexample"><pre class="programlisting">        uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: &lt;color=red&gt;" + time.ToString("F0")+"&lt;/color&gt;";</pre></div><p>Replace it with the following lines:</p><div class="informalexample"><pre class="programlisting">        if(time &lt;= 0){
          uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: &lt;color=red&gt;0&lt;/color&gt;";
          if(!isOver){
            isOver = true;
            //DO SOMETHING
          }
        }else {
          uiText.text = "&lt;color=blue&gt;Time&lt;/color&gt;: &lt;color=red&gt;" + time.ToString("F0")+"&lt;/color&gt;";
        }</pre></div><p>As we can see from the code, the <code class="literal">bool</code> variable is needed to trigger the countdown expired event only once. In fact, now we are able to implement or call a function when the time expires.</p><p>Furthermore, in order to<a id="id187" class="indexterm"></a> test it, we can write something that indicates when the time has expired. For instance, we can do this in the debug console by calling this function:</p><div class="informalexample"><pre class="programlisting">Debug.log("Timer expired!");</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec24"></a>Increasing tension by adding decimal points when the time is close to expiring</h4></div></div></div><p>By combining what we did before with the <span class="emphasis"><em>Creating a mixed timer</em></span> recipe, when the timer has fewer than 10 seconds remaining, the timer could display the number with decimal points to increase<a id="id188" class="indexterm"></a> tension in the player. In this way, as each second draws closer to the time of expiry, the player can see with more precision and at a faster rate how much time is left (in milliseconds). Ultimately, this increases the tension between the current moment and the moment when the timer expires.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec93"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>For more details about the <code class="literal">get</code> function, refer to the <span class="emphasis"><em>Implementing a score counter</em></span> recipe in the previous chapter, inside the <span class="emphasis"><em>There's more...</em></span> section</p></li><li style="list-style-type: disc"><p>However, if you are looking for<a id="id189" class="indexterm"></a> more information about rich text, the official documentation is the best place to get it, at <a class="ulink" href="http://docs.unity3d.com/Manual/StyledText.html" target="_blank">http://docs.unity3d.com/Manual/StyledText.html</a></p></li></ul></div></div></div>