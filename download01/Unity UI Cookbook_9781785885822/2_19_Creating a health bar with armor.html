<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec25"></a>Creating a health bar with armor</h2></div></div><hr /></div><p>In this recipe, we are<a id="id114" class="indexterm"></a> going to create a health bar, similar to the one in <span class="emphasis"><em>Implementing a linear health bar </em></span>recipe, but there is an armor that protects the player. In fact, if the <a id="id115" class="indexterm"></a>player is attacked, he or she will first lose the armor, then the health. To achieve this, we will use multiple <span class="strong"><strong>Image (Script)</strong></span> components, both for the health bar and for the pieces of armor, and develop a script to manage the entire logic.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec62"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, let's create an image, so right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel and then <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>, and rename it <span class="strong"><strong>HealthBar with Armor</strong></span>.</p></li><li><p>Let's change <span class="strong"><strong>Fill Method</strong></span> into <span class="strong"><strong>Horizontal</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> into <span class="strong"><strong>Left</strong></span>. Of course, we need to add the <span class="strong"><strong>Healthbar</strong></span> that we have just created to <span class="strong"><strong>Source Image</strong></span>. Finally, we can place the <span class="strong"><strong>Healthbar with Armor</strong></span> everywhere we want, always using the <span class="strong"><strong>Rect Tool</strong></span>.</p></li><li><p>In order to<a id="id116" class="indexterm"></a> keep its original proportion, you can click on the <span class="strong"><strong>Set Native Size</strong></span> button in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Next, right-click on <span class="strong"><strong>Healthbar with Armor</strong></span> and add a new image by selecting <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>, and again rename the object just created as <span class="strong"><strong>Armor1</strong></span>.</p></li><li><p>Take an icon image<a id="id117" class="indexterm"></a> to represent the pieces of the armor, or create on our own, and import it in our project. If our project is not set to 2D, remember to set the <span class="strong"><strong>Texture Type</strong></span> of the icon to <span class="strong"><strong>Sprite (2D and UI)</strong></span>, and then click on<span class="strong"><strong> Apply</strong></span>.</p></li><li><p>Let's duplicate <span class="strong"><strong>Armor1</strong></span> with <span class="emphasis"><em>Ctrl</em></span>+<span class="emphasis"><em>D</em></span> as many times as lives the player will have. Rename them consecutively, such as <span class="strong"><strong>Armor1</strong></span>, <span class="strong"><strong>Armor2</strong></span>, <span class="strong"><strong>Armor3</strong></span>, and so on.</p></li><li><p>Distribute them in the <span class="strong"><strong>Scene View</strong></span> while also keeping their order. For instance, <span class="strong"><strong>Armor2</strong></span> must be after <span class="strong"><strong>Armor1</strong></span> and before <span class="strong"><strong>Armor3</strong></span>. This order is important because the script that we are going to write uses this order.</p></li><li><p>Now, in the <span class="strong"><strong>Healthbar with Armor</strong></span>, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <span class="strong"><strong>HealthbarWithArmorScript</strong></span>, and then press <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double-click on the script to edit it. Since we are going to use the <code class="literal">Image</code> class, we need to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script.</p></li><li><p>Before to add any functions, we need five variables, three <code class="literal">private</code> and two <code class="literal">public</code>, so that we can set these last ones in the <span class="strong"><strong>Inspector</strong></span>. Therefore, we can write:</p><div class="informalexample"><pre class="programlisting">  public GameObject[] armor;
  private intpiecesOfArmor;
  private Image healthbarFilling;
  public intmaxHealth = 100;
  private int health;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we have to set up our variables, so let's write:</p><div class="informalexample"><pre class="programlisting">  void Start () {
    healthbarFilling = this.GetComponent&lt;Image&gt; ();
    health = maxHealth;
    piecesOfArmor = armor.Length;
  }</pre></div></li><li><p>If the player loses his pieces of armor, there should be a way to regenerate them. We can achieve this by creating the following function:</p><div class="informalexample"><pre class="programlisting">  public void addArmor(){
    if (piecesOfArmor&lt;armor.Length) {
      piecesOfArmor++;
      updateArmor();
    }
  }</pre></div></li><li><p>Next, we need to write the <code class="literal">damage(int value)</code> function that takes how many health <a id="id118" class="indexterm"></a>points are taken away from the damage that is applied to the player as a parameter:</p><div class="informalexample"><pre class="programlisting">  public bool damage(int value){
    if (piecesOfArmor&gt; 0) {
      piecesOfArmor--;
      updateArmor();
      return false;
    }else{
      return damageIgnoringArmor(value);
    }
  }</pre></div></li><li><p>Furthermore, it could be helpful to have also a function to applied damage ignoring the<a id="id119" class="indexterm"></a> armor of the player. This is used in games, for instance, for some magic attacks, which hit the player directly. Thus, we can have the following function:</p><div class="informalexample"><pre class="programlisting">  public booldamageIgnoringArmor(int value){
    health -= value;
    if (health &lt;= 0){  
      health = 0;
      updateHealthbar ();
      return true;
    }
    updateHealthbar ();
    return false;
  }</pre></div></li><li><p>As we have functions to damage the player, we should also have functions to regenerate life to the player. Therefore, we need to write an <code class="literal">addHealth(int value)</code> function, which takes as parameter how many health points will be restored to the player health. The following is the function:</p><div class="informalexample"><pre class="programlisting">  public void addHealth(int value){
    health += value;
    if (health &gt;maxHealth)
      health = maxHealth;
    updateHealthbar ();
  }</pre></div></li><li><p>Instead of the other recipes that we have seen so far, we need two <code class="literal">update</code> function, one<a id="id120" class="indexterm"></a> for the health and one for the armor. The following one is for the health:</p><div class="informalexample"><pre class="programlisting">  public void updateHealthbar(){
    healthbarFilling.fillAmount = health / maxHealth;
  }</pre></div></li><li><p>And this <a id="id121" class="indexterm"></a>other one is for the armor:</p><div class="informalexample"><pre class="programlisting">  public void updateArmor(){
    for (int i=0; i&lt;armor.Length; i++) {
      if(i&lt;piecesOfArmor){
        armor[i].SetActive(true);
      }else{
        armor[i].SetActive(false);
      }
    }
  }</pre></div></li><li><p>To finish, save our work. We only need to assign the pieces of the armor into the entries of the <code class="literal">armor</code> variable, as we did with <span class="emphasis"><em>Implementing a symbolic lives counter</em></span> recipe.</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_02_EXTRA02.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec63"></a>How it works...</h3></div></div></div><p>We have created a<a id="id122" class="indexterm"></a> linear health bar and named <span class="strong"><strong>Healthbar with Armor</strong></span>. Then, we created different pieces of armor. Then, we attached our script to <span class="strong"><strong>Healthbar with Armor</strong></span>.</p><p>In the script, we have created five variables. The first one is <code class="literal">healthbarFilling</code> and it stores the reference<a id="id123" class="indexterm"></a> to the <span class="strong"><strong>Image (Script)</strong></span> component. <code class="literal">maxHealth = 100</code> is the max health that the player can have, and we can set its value in the <span class="strong"><strong>Inspector</strong></span>, but as default in our script, it has a value of <code class="literal">100</code>. Furthermore, the <code class="literal">health</code> variable contains the health currently possessed by the player. The <code class="literal">armor</code> variable is an array of game object and it will store all the pieces of armor contained in the <span class="strong"><strong>Healthbar with Armor</strong></span>. Finally, the <code class="literal">piecesOfArmor</code> variable stores the number of pieces of armor currently possessed by the player.</p><p>In the <code class="literal">Start()</code> function, we set up some variables. In the <code class="literal">healthbarFilling</code> variable, we store the <span class="strong"><strong>Image (Script)</strong></span> component attached in the same game object of this script by calling the <code class="literal">this.GetComponent&lt;Image&gt;()</code> function. Then, we set the health variable equal to <code class="literal">maxHealth</code>. Finally, we haven't created a <code class="literal">public</code> variable that stores the maximum number of pieces of armor directly, so we set the <code class="literal">piecesOfArmor</code> variable equal to the length of the <code class="literal">armor</code> array, and since we will set this array in the <span class="strong"><strong>Inspector</strong></span>, it contains all the pieces of armor in the scene. Therefore, its length represents how many pieces of armor there are on this health bar.</p><p>The <code class="literal">addArmor()</code> function increases the <code class="literal">piecesOfArmor</code> variable by one if it has not reached the maximum amount allowed. Then, it calls the <code class="literal">updateArmor()</code> function.</p><p>The <code class="literal">damage(int value)</code> function includes the parameter of how many health points will be taken away from the player after the damage is applied. In fact, it first checks whether the player has some <code class="literal">piecesOfArmor</code>, and, if so, decreases it by one, independently from the parameter value and, after calling the <code class="literal">updateArmor()</code> function, returns <code class="literal">false</code>; this means that the player is<a id="id124" class="indexterm"></a> still alive. Otherwise, it will call the <code class="literal">damageIgnoringArmor(int value)</code> function passing value as a parameter.</p><p>The <code class="literal">damageIgnoringArmor(int value)</code> function includes the parameter of how many health points will<a id="id125" class="indexterm"></a> remain when the damage applied. Then, it decreases health by value and checks to see whether the player is still alive. If the player is still alive, it will return <code class="literal">false</code>, otherwise return <code class="literal">true</code>. After this, the <code class="literal">updateHealthbar()</code> function is called to update the user interface.</p><p>There is also a function to <code class="literal">addHealth(int value)</code> to the player. It increases health by value, if it exceeds <code class="literal">maxHealth</code>, then it set <code class="literal">health</code> equal to <code class="literal">maxHealth</code>, and, finally, calls the <code class="literal">updateHealthbar()</code> function to update the user interface.</p><p>In the <code class="literal">updateHealthbar()</code> function, we set <code class="literal">healthbarFilling</code> equal to the ratio between <code class="literal">health</code> and <code class="literal">maxHealth</code>.</p><p>Finally, in the <code class="literal">updateArmor()</code> function, we set active or no each pieces of armor according to the <code class="literal">piecesOfArmor</code> variable, through a for-cycle, very similar to the one in <span class="emphasis"><em>Implementing a linear health bar</em></span> recipe.</p><p>As last step, we assigned each pieces of armor we have created to the entries of our armor array.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec64"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If the design of our game doesn't require a health bar with an armor, we should have a look at <span class="emphasis"><em>Implementing a linear health bar</em></span> and <span class="emphasis"><em>Implementing a radial health bar</em></span> recipes.</p></li><li style="list-style-type: disc"><p>For other kind of health bars, see <span class="emphasis"><em>Using multiple bars to make a multibar</em></span> and <span class="emphasis"><em>Developing a kingdom hearts health bar style</em></span>.</p></li></ul></div></div></div>