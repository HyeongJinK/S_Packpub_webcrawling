<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec75"></a>Making an animated 3D UI warning</h2></div></div><hr /></div><p>Warnings in games can be provided in many ways, for doing both the right and wrong things. However, having<a id="id488" class="indexterm"></a> the option of 3D capabilities allows us to create more interesting and dynamic warning messages.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec208"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, let's create our warning in the UI. We can start by adding a panel. Right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel, then go to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span> and rename it as <span class="strong"><strong>3DWarning</strong></span>. We can continue to add other UI elements, so we want a title inside another panel to evidence it and maybe add some text. As best practice, every time you add a component, tweak its anchor points as well so that everything can scale properly. At the end, we should have something that looks like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_09_07.jpg" /></div></li><li><p>Now, we should take advantage of the third dimension and adjust the value of the <span class="emphasis"><em>z</em></span> axis for the components in the foreground. We can adjust it incrementally, similar to <a id="id489" class="indexterm"></a>what we did in the first recipe of this chapter - C<span class="emphasis"><em>reating a 3D menu</em></span>. At the end, we should see something like what is shown here:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_09_08.jpg" /></div></li><li><p>The next step is to animate it. We can animate it as we have previously done in the <span class="emphasis"><em>Creating a pop-up menu</em></span> recipe in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Animating the UI</em></span>. However, instead of having buttons, we have a title along with the warning text. This text needs to be reduced first and then the panel (or vice versa if it has to pop up), keeping<a id="id490" class="indexterm"></a> in mind how they will be animated. After we have followed these steps, we should attach our <span class="strong"><strong>Animator</strong></span> component to <span class="strong"><strong>3DWarning</strong></span>.</p></li><li><p>If we have set all the anchor points properly, we shouldn't have any problems in scaling the UI. Therefore, we are ready to change the <span class="strong"><strong>Render Mode</strong></span> of <span class="strong"><strong>Canvas</strong></span> to <span class="strong"><strong>World Space</strong></span>. Then, we can just follow the previous recipe in order to place it in the space.</p></li><li><p>Now, we have to create a script that triggers the <span class="strong"><strong>3DWarning</strong></span> and when it disappears. Furthermore, the <span class="strong"><strong>3DWarning</strong></span> could be nicer if it always faces the player when it comes up. Therefore, select <span class="strong"><strong>3DWarning</strong></span>. In the <span class="strong"><strong>Inspector</strong></span>, go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <span class="strong"><strong>WarningScript</strong></span>. Finally, click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double-click on the script in order to edit it. Since we want to control the animation, we need to create a <code class="literal">private</code> variable that will store the <span class="strong"><strong>Animator</strong></span> component. To do this, let's write the following line:</p><div class="informalexample"><pre class="programlisting">  private Animator animator;</pre></div></li><li><p>Now, in order to get the player's position, we need a variable to store it in. Also, we need another variable to indicate the distance at which the warning should be triggered. These are both <code class="literal">public</code> variables, since they are supposed to be set in the <span class="strong"><strong>Inspector</strong></span>:</p><div class="informalexample"><pre class="programlisting">public Transform player;
public float activationDistance;</pre></div></li><li><p>Furthermore, we need two more <code class="literal">public</code> variables to set the name of the animation that we created before:</p><div class="informalexample"><pre class="programlisting">public string appearingAnimation;
public string disappearingAnimation;</pre></div></li><li><p>Finally, we also need a <code class="literal">bool</code> variable; it is used to trigger the animation. However, this is done only once and is used to distinguish between whether the warning is enabled or not:</p><div class="informalexample"><pre class="programlisting">private bool isEnable;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we need to assign the value to the <code class="literal">animator</code> variable. We can do this by getting the component:</p><div class="informalexample"><pre class="programlisting">void Start () {
animator = GetComponent&lt;Animator&gt; ();
}</pre></div></li><li><p>Next, in the <code class="literal">Update()</code> function, we have to check whether the distance between the warning and the player is less than <code class="literal">activationDistance</code>. If so, it means that the player is close enough to trigger the warning. Then, we need to see the value of the <code class="literal">isEnable</code> variable to check whether the warning is already activated. In fact, if it is not, then we set the <code class="literal">isEnable</code> variable to <code class="literal">true</code> and trigger <a id="id491" class="indexterm"></a>
<code class="literal">appearingAnimation</code>. Otherwise, we do the opposite of this process. Thus, if the player is far enough, the warning is deactivated. In fact, we can set the <code class="literal">isEnable</code> variable to <code class="literal">false</code> and trigger <code class="literal">disappearingAnimation</code>. Therefore, we can write this code:</p><div class="informalexample"><pre class="programlisting">  void Update () {
    if (Vector3.Distance (player.position, transform.position) &lt; activationDistance) {
      if(!isEnable){
        isEnable = true;
        animator.Play(appearingAnimation);
      }
    } else {
      if(isEnable){
        isEnable = false;
        animator.Play(disappearingAnimation);
      }
    }
  }</pre></div></li><li><p>Now the script is ready and we can save it.</p></li><li><p>We create a test scene, as we have done in the previous chapter. Alternatively, we can directly use our game. Assign all the public variables and check whether everything works as it should.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec209"></a>How it works...</h3></div></div></div><p>After we have created our 3D warning along with its two animations and placed it in the environment, we have to create a script that makes it pop up when the player gets close to it. We need to trigger the animation once, using the <code class="literal">bool</code> variable <code class="literal">isEnable</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec210"></a>There's more...</h3></div></div></div><p>The focus of the next sections is to show us how it is possible to improve our 3D warning message.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec86"></a>Transforming the update function into a coroutine</h4></div></div></div><p>If we want to improve <a id="id492" class="indexterm"></a>computational performance, we can consider transforming the <code class="literal">Update()</code> function into a coroutine. We have discussed coroutines in greater detail in the previous chapter, so you can revisit it again, especially in the <span class="emphasis"><em>There's more...</em></span> section of the first recipe.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec87"></a>Always orienting the warning towards the player</h4></div></div></div><p>Imagine that we are using the<a id="id493" class="indexterm"></a> 3D warning to trigger a pop-up message for a pickup item on the floor. Since the player can reach it from different directions, it's not nice that when it comes up, it has a different orientation. So, until the warning for instance on the wall, the player can see it from only one direction and it doesn't need to face the player. But in other cases, this is necessary. In order to do so, we have to change our script a little.</p><p>Let's add the following line at the end of the <code class="literal">Update()</code> function of our script:</p><div class="informalexample"><pre class="programlisting">transform.LookAt (player.position);</pre></div><p>In this way, we force the warning to always face the player.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec88"></a>Adding a floating effect</h4></div></div></div><p>This UI element is <a id="id494" class="indexterm"></a>supposed to be in the environment. An example of its use may be to indicate to a player an item to pick up. In this example, it is possible to have the UI element floating rather than static in the air. So, we can follow the steps in the <span class="emphasis"><em>Making a floating UI element</em></span> recipe in <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Decorating the UI</em></span>. Contrary to what we did in the <span class="emphasis"><em>Adding a smooth tilt effect</em></span> section, where the floating logic could still be set in just two dimensions, here we might want to extend the floating effect to the third dimension. This should be used with the <span class="emphasis"><em>Rotating along its axis</em></span> section rather than the <span class="emphasis"><em>Always orienting the warning towards the player</em></span> section.</p><p>Therefore, if we decide to implement this extension, we have to change <code class="literal">FloatingUIScript</code> a bit by adding two variables:</p><div class="informalexample"><pre class="programlisting">public float zspeed, zAmplitude;</pre></div><p>Also, change the <code class="literal">Update()</code> function like this:</p><div class="informalexample"><pre class="programlisting">void Update () {
  rectTransform.localPosition = new Vector3(xAmplitude*Mathf.Sin(Time.time*xspeed), yAmplitude*Mathf.Sin(Time.time*yspeed), zAmplitude*Mathf.Sin(Time.time*zspeed));
  }</pre></div><p>In this way, we can change the position and value of the <span class="emphasis"><em>z</em></span> axis as well. As a result, we are utilizing the third<a id="id495" class="indexterm"></a> dimension.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec211"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Throughout this chapter, we discussed how to animate UIs and how various elements such as the warning message can be helpful to a player during the game. In particular, we can see that an ideal way to animate a 3D warning message is as a popup during gameplay. In fact, this kind of animation is very similar to the one that is described in the <span class="emphasis"><em>Creating a pop-up menu</em></span> recipe in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Animating the UI</em></span>.</p></li><li style="list-style-type: disc"><p>Additionally, we deal with not only the animation of various UI elements, but also how to trigger them. This was covered in the <span class="emphasis"><em>Creating a menu with an entrance transition</em></span> recipe, also in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Animating the UI</em></span>. That recipe demonstrated how we can use the <code class="literal">OnClick()</code> event to trigger the animation. This is done by calling the <code class="literal">Play()</code> function on the <span class="strong"><strong>Animator</strong></span> component. In contrast, we called the function directly inside our script, but the way it works is the same. So, refer to these two recipes to handle the animation of the 3D warning.</p></li><li style="list-style-type: disc"><p>As we saw in the <span class="emphasis"><em>There's more...</em></span> section, we are able to implement the 3D warning message with a coroutine. This example refers to the <span class="emphasis"><em>Optimizing the code using a delayed update through coroutines</em></span> section contained in the <span class="emphasis"><em>Creating a distance displayer</em></span> recipe in <a class="link" href="#" linkend="ch08">Chapter 8</a>, <span class="emphasis"><em>Implementing Advanced HUDs</em></span>.</p></li><li style="list-style-type: disc"><p>Finally, the last subsection in <span class="emphasis"><em>There's more…</em></span> explained how we can extend <code class="literal">FloatingUIScript</code>. A good place to refresh our memories about how to do this is the <span class="emphasis"><em>Making a floating UI element</em></span> recipe in <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Decorating the UI</em></span>.</p></li></ul></div></div></div>