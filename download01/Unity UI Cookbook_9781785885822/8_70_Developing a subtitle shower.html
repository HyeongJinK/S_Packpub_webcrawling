<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec70"></a>Developing a subtitle shower</h2></div></div><hr /></div><p>There are many ways of narrating different parts of a game. We may use audio and sometimes visuals, such as text, in order to explain what characters are trying to communicate to <a id="id456" class="indexterm"></a>us. However, one of the easiest ways to explain to a player what a character is saying is through subtitles. Subtitles not only allow players to read what is sometimes also narrated by voice, but can also improve the accessibility of a game for people who may not be able to hear or may have difficulties hearing. Subtitles are always a useful addition to any game when there are things that need to be communicated to the player properly.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec197"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>As we have done previously, the first thing to do is create an UI element. In this example, we will create a panel. To do this, right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel, then go to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>, and rename it <span class="strong"><strong>SubtitleShowerPanel</strong></span>. We should resize it and place it in the bottom part of the screen. It is also possible to change the <span class="strong"><strong>Source Image</strong></span> in order to personalize the UI.</p></li><li><p>The next step is to create the real UI text element that will allow us to show subtitles to the player. To do this, we right-click on <span class="strong"><strong>SubtitleShowerPanel</strong></span> so that we can nest it in our panel. Then we go to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text </strong></span>and rename it <span class="strong"><strong>SubtitleShowerText</strong></span>. Again, we can tweak all its properties to fit our needs, such as <span class="strong"><strong>Font</strong></span>, <span class="strong"><strong>Font Size</strong></span>, <span class="strong"><strong>Alignment</strong></span>, or <span class="strong"><strong>Color</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip42"></a>Tip</h3><p>While setting <span class="strong"><strong>Font Size</strong></span>, keep in mind how much text will be on the subtitle shower. At the same time, this depends on what kind of game we are developing.</p></div></li><li><p>Now it's time to start writing our script. Select <span class="strong"><strong>SubtitleShowerPanel</strong></span>, and in the <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>. Name it <span class="strong"><strong>SubtitleShowerScript</strong></span>, and then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double-click on <span class="strong"><strong>SubtitleShowerScript</strong></span> in order to edit the script. Again, since we are dealing with the UI and we will be using the <code class="literal">Text</code> class, we have to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script.</p></li><li><p>We need a variable to store <span class="strong"><strong>SubtitleShowerText</strong></span>. It's also possible to assign its value in <span class="strong"><strong>SubtitleShowerScript</strong></span> itself. So, we set it to <code class="literal">private</code> and also <code class="literal">static</code>:</p><div class="informalexample"><pre class="programlisting">  private static Text uiText;</pre></div></li><li><p>In fact, we can set it in the <code class="literal">Start()</code> function. By doing this, we can automatize the setting of the variable by searching in the children of <span class="strong"><strong>SubtitleShowerPanel</strong></span>. We also have make sure that we have just one text between all the children:</p><div class="informalexample"><pre class="programlisting">  void Start () {
    uiText = GetComponentInChildren&lt;Text&gt; ();
  }</pre></div></li><li><p>Before we can continue, we also require a constant. Feel free to change its value according to the kind of game that you are intending to develop. If you don't want to specify it when the coroutine is called, it will store the default duration, that is, the duration of that specific line of the subtitle:</p><div class="informalexample"><pre class="programlisting">  const float defaultDuration = 5f;</pre></div></li><li><p>Next, we have<a id="id457" class="indexterm"></a> to create our coroutine, and it has to be public. This is because we want to call it from other scripts. We will also make it static so that we can get access to it without the reference to <span class="strong"><strong>SubtitleShowerPanel</strong></span>. Furthermore, it should take three parameters. The first is the text that our subtitle shower has to show, the second one is how long the duration of the subtitle should be, and finally the third is <code class="literal">AudioClip</code>, in order to play a sound. The <code class="literal">subtitle</code> parameter is not an optional parameter, whereas <code class="literal">duration</code> and <code class="literal">clip</code> have default values. The <code class="literal">defaultDuration</code> constant we have declared before <code class="literal">null</code>. So, the structure of the function is as follows:</p><div class="informalexample"><pre class="programlisting">  public static IEnumerator show (string subtitle, float duration = defaultDuration, AudioClip clip = null){
  }</pre></div></li><li><p>As the first step inside the function, we will set the <code class="literal">text</code> to <code class="literal">uiText</code> so that it is immediately displayed to the player:</p><div class="informalexample"><pre class="programlisting">    uiText.text = subtitle;</pre></div></li><li><p>The next step is to check whether <code class="literal">clip</code> is null or not. If it isn't, we have to play the clip and wait until the audio stops. This means that we wait for a specified amount of time, which is equal to the length of clip. Otherwise, we just wait for the <code class="literal">duration</code> amount of time:</p><div class="informalexample"><pre class="programlisting">    if (clip) {
      AudioSource.PlayClipAtPoint (clip, Input.mousePosition);
      yield return new WaitForSeconds (clip.length);
    } else {
      yield return new WaitForSeconds (duration);
    }</pre></div></li><li><p>Finally, after we have waited for the specified time, we want the subtitle to disappear. To do this, set <code class="literal">uiText.text</code> to an empty string:</p><div class="informalexample"><pre class="programlisting">    uiText.text = "";</pre></div></li><li><p>Save the code, and now everything is ready to be used.</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_08_09.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec198"></a>How it works...</h3></div></div></div><p>In this recipe, we <a id="id458" class="indexterm"></a>created a static coroutine so that it can be called from anywhere in the game with the following function:</p><div class="informalexample"><pre class="programlisting">StartCoroutine(SubtitleShowerScript.show(subtitle,duration, clip);</pre></div><p>But in order to keep it static, we had to set the variable as <code class="literal">static</code>. This is fine, as long as there is only one <span class="strong"><strong>Subtitle Shower</strong></span> in the scene that it is supposed to be in. As a result, when the coroutine begins, it will handle everything. This includes setting the text and removing it after the right amount of time.</p><p>We need to pay attention when we call this coroutine. For instance, we shouldn't create more than one instance at a time, or else the two instances will overlap in controlling the components, especially because all the variables are static. Refer to the first part of the <span class="emphasis"><em>There's more...</em></span> section of this recipe; it demonstrates that every time the coroutine is called, we need to wait until it is finished before it is called again.</p><p>This waiting can be<a id="id459" class="indexterm"></a> done by yielding on the <code class="literal">show()</code> coroutine with the following instruction:</p><div class="informalexample"><pre class="programlisting">yield return StartCoroutine(SubtitleShowerScript.show(subtitle,duration, clip);</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec199"></a>There's more...</h3></div></div></div><p>The subtitle shower created in this recipe does the job, but it could be improved by displaying more information to the player, such as the name of character who is talking along with the avatar picture. Hence, the following sections will guide us through implementing these features.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec76"></a>Testing the script</h4></div></div></div><p>In order to test the script, we need another function that calls our subtitle shower. So, let's create another script<a id="id460" class="indexterm"></a> and add these variables:</p><div class="informalexample"><pre class="programlisting">public string line1, line2, line3;
public AudioClip clip;
public duration;</pre></div><p>Then this line in the <code class="literal">Start()</code> function:</p><div class="informalexample"><pre class="programlisting">StartCoroutine (test ());</pre></div><p>So, we call the following coroutine:</p><div class="informalexample"><pre class="programlisting">IEnumerator test () {
  yield return StartCoroutine(SubtitleShowerScript.show(line1));
  yield return StartCoroutine(SubtitleShowerScript.show(line2,duration));
  yield return StartCoroutine(SubtitleShowerScript.show(line3, 0f, clip));
}</pre></div><p>Here, we have triggered our subtitle shower three times. However, before we trigger the next one, we have to wait until the previous one has finished. Furthermore, we used the <code class="literal">public</code> variables just to show something on the screen. Finally, we attached the script somewhere in the scene and filled the <code class="literal">public</code> variables. By doing this, it is possible to see our subtitle shower in action.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip43"></a>Tip</h3><p>If we look at the last line of the script, we can see that we are passing the audio clip as a parameter. Therefore, the value of the duration doesn't matter. So every value that we pass doesn't affect <span class="strong"><strong>Subtitle Shower</strong></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec77"></a>Adding a picture of the character who is talking</h4></div></div></div><p>When we play games, we have what is known as an avatar. It represents our character within a game. There are many different ways in which our character can be represented during a game, such as the actual itself that we control, or as an image within the HUD. During moments in the game<a id="id461" class="indexterm"></a> when two characters are interacting or even conversing, having a picture of our avatar and the characters that we are engaging with can often make it easier to understand what is happening. This is especially true in moments when there is a lot of text, such as in a conversation. In such moments, a picture of our avatar next to the text that we are saying helps to distinguish between who is saying what.</p><p>If we want to implement this in our subtitle shower, we can do so by adding an <span class="strong"><strong>Image (Script)</strong></span> component to <span class="strong"><strong>SubtitleShowerPanel</strong></span>. Let's rename it <span class="strong"><strong>SubtitleShowerCharacterIcon</strong></span>.</p><p>It is also important to place <span class="strong"><strong>SubtitleShowerCharacterIcon</strong></span> inside <span class="strong"><strong>SubtitleShowerPanel</strong></span> such that it is coherent with the game we are developing.</p><p>Now, we have to add a new variable to store it in our script:</p><div class="informalexample"><pre class="programlisting">private static Image uiImage;</pre></div><p>Then we set the reference in the <code class="literal">Start()</code> function:</p><div class="informalexample"><pre class="programlisting">uiImage = GetComponentInChildren&lt;Image&gt; ();</pre></div><p>Furthermore, the coroutine has to be changed to take a new parameter in this way:</p><div class="informalexample"><pre class="programlisting">public static IEnumerator show(string subtitle, float duration = defaultDuration, AudioClip clip = null, Sprite icon = null)</pre></div><p>Finally, we have to set the picture at the beginning of the coroutine:</p><div class="informalexample"><pre class="programlisting">uiImage.sprite = icon;</pre></div><p>As the last instruction, take it off:</p><div class="informalexample"><pre class="programlisting">uiImage.sprite = null;</pre></div><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_08_10.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec78"></a>Adding the name of the character who is talking</h4></div></div></div><p>Much like our avatars, which<a id="id462" class="indexterm"></a> visually represent who we are in a game, names also add another layer of personalization to our experience. Furthermore, in some games, the quality of the graphics may not be very detailed because of either their resolution or their size, as is the case with a number of mobile games. As a result, it may be hard to distinguish between different avatars, especially when they are able to be customized. Including the names of our character as well as other characters within the game can make it easier to distinguish between different characters, as opposed to visual representations alone.</p><p>We can add this feature into our <span class="strong"><strong>Subtitle Shower</strong></span>. First, we need to create another <span class="strong"><strong>Text (Script)</strong></span> component inside <span class="strong"><strong>SubtitleShowerPanel</strong></span> and rename it <span class="strong"><strong>SubtitleShowerCharactername</strong></span>.</p><p>Again, it is important to place it inside <span class="strong"><strong>SubtitleShowerPanel</strong></span> so that it suits the game that we are developing.</p><p>Next, we have to add a new variable to store it in our script:</p><div class="informalexample"><pre class="programlisting">private static Image uiName;</pre></div><p>Set the reference in the <code class="literal">Start()</code> function. This time, however, we need to change the way in which we refer to the two <code class="literal">Text</code> variables, <code class="literal">uiName</code> and <code class="literal">uiText</code>, since they both are children of <span class="strong"><strong>SubtitleShowerPanel</strong></span>. We need to call the <code class="literal">Find()</code> function to find the game object to which they are attached before we get the actual components:</p><div class="informalexample"><pre class="programlisting">uiName = GameObject.Find("SubtitleShowerCharactername").GetComponent&lt;Text&gt; ();
uiText = GameObject.Find("SubtitleShowerText").GetComponent&lt;Text&gt; ();</pre></div><p>Furthermore, the<a id="id463" class="indexterm"></a> coroutine has to be changed to take a new parameter:</p><div class="informalexample"><pre class="programlisting">public static IEnumerator show(string subtitle, float duration = defaultDuration, AudioClip clip = null, Sprite icon = null, string name = "")</pre></div><p>Finally, we have to show the name at the beginning of the coroutine:</p><div class="informalexample"><pre class="programlisting">uiName.text = name;</pre></div><p>At the end, as the last instruction, take it off:</p><div class="informalexample"><pre class="programlisting">uiName.text = "";</pre></div><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_08_11.jpg" /></div></div></div></div>