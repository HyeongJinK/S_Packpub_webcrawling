<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec30"></a>Creating a linear timer</h2></div></div><hr /></div><p>In this recipe, we are going to create a linear timer. In this instance, the timer is shown as a long bar that shortens over time. An example of this would be when we want a player to make a decision within <a id="id150" class="indexterm"></a>a short period of time, such as during a dialog choice to progress the narrative. In this case, the timer may feature above or even below the choices to indicate the amount of time that the player has left to decide. To achieve this, we will <a id="id151" class="indexterm"></a>use the <span class="strong"><strong>Image (Script)</strong></span> component and develop a script to<a id="id152" class="indexterm"></a> manage the length of the bar according to the time remaining.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec75"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First of all, we need to create a bar for our timer. To do this, we can open a graphics program to create it. Alternatively, we can just use the bar that we created in the <span class="emphasis"><em>Implementing a linear heath bar</em></span> recipe in the previous chapter.</p></li><li><p>Next, we need to import the bar into our project and set <span class="strong"><strong>Texture Type</strong></span> to <span class="strong"><strong>Sprite (2D and UI)</strong></span> so that it can be set as <span class="strong"><strong>Source Image</strong></span> in our UI components. Then click on <span class="strong"><strong>Apply</strong></span>. Of course, this is not needed if our project is set to work in 2D mode.</p></li><li><p>Now, we can create a new UI image inside Unity. To do this, right-click on the <span class="strong"><strong>Hierarchy</strong></span> panel and then navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>. Next, rename it to <span class="strong"><strong>Linear Timer</strong></span>.</p></li><li><p>Inside the <span class="strong"><strong>Image (Script)</strong></span> component, we have to change <span class="strong"><strong>Image Type</strong></span> to <span class="strong"><strong>Filled</strong></span>. As a result, we can decide how much of the image is filled. Furthermore, the component should change a little in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Let's change <span class="strong"><strong>Fill Method</strong></span> to <span class="strong"><strong>Horizontal</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> to <span class="strong"><strong>Left</strong></span>. Of course, we have to add the bar that we previously created to <span class="strong"><strong>Source Image</strong></span>. Finally, we can place <span class="strong"><strong>Linear Timer</strong></span> wherever we want, using <span class="strong"><strong>Rect Tool</strong></span> or the keyboard shortcut <span class="emphasis"><em>T</em></span>.</p></li><li><p>If we want to maintain the original proportion of the bar, we can click on the <span class="strong"><strong>Set Native Size</strong></span> button in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Then, in <span class="strong"><strong>Linear Timer</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> |<span class="strong"><strong> New Script</strong></span>, name it <span class="strong"><strong>BarTimerScript</strong></span>, and then click on <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double-click on the script to edit it and, as always, add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script. This ensures that we are able to manipulate the UI elements within the script.</p></li><li><p>Before we add any functions, we need three variables: two private and one public. We will set the last one in the <span class="strong"><strong>Inspector</strong></span>. To do this, we can write the following code:</p><div class="informalexample"><pre class="programlisting">private Image barFilling;
public float timeAmount;
private float time;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we have to set up the <code class="literal">time</code> variable along with the <code class="literal">barFilling</code> one, by adding these lines:</p><div class="informalexample"><pre class="programlisting">void Start () {
  barFilling = this.GetComponent&lt;Image&gt; ();
  time = timeAmount;
}</pre></div></li><li><p>Finally, in our <code class="literal">Update()</code> function, we have to decrease the <code class="literal">time</code> variable by the time that has<a id="id153" class="indexterm"></a> elapsed from the last frame, and update the filling of the bar so that it can reflect the amount of time that has elapsed. Therefore, we can script the following:</p><div class="informalexample"><pre class="programlisting">void Update () {
  if (time &gt; 0) {
    time -= Time.deltaTime;
    barFilling.fillAmount = time / timeAmount;
  }
}</pre></div></li><li><p>Now, once we have finished the script, we can save our work. If we click on play, we should have something that looks like this:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_03_02.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec76"></a>How it works...</h3></div></div></div><p>After we have imported the image, we can set it to <span class="strong"><strong>Sprite (2D and UI)</strong></span> (this is not needed if the project is in 2D). Next, we can change its <span class="strong"><strong>Fill Method</strong></span> field to <span class="strong"><strong>Horizontal</strong></span> and set <span class="strong"><strong>Fill Origin</strong></span> to <span class="strong"><strong>Left</strong></span> so that the image can disappear gradually as the time decreases, starting from the right-hand side.</p><p>Then, we have created<a id="id154" class="indexterm"></a> three variables in our script. The first variable, <code class="literal">barFilling</code>, stores the reference to the <span class="strong"><strong>Image (Script)</strong></span> component, which is attached in the same game object of this script. The second variable, <code class="literal">timeAmount</code>, is the starting value of time for the countdown, in seconds. Finally, the third variable, which is <code class="literal">time</code>, contains the time that is remaining.</p><p>In the <code class="literal">Start()</code> function, we first assigned the <code class="literal">barFilling</code> variable by calling the <code class="literal">this.GetComponent&lt;Image&gt;()</code> function. Then, we set the time to <code class="literal">timeAmount</code> so that the countdown begins with a specific starting time.</p><p>Finally, in the <code class="literal">Update()</code> function, we set the ratio between <code class="literal">time</code> and <code class="literal">timeAmount</code> to the <code class="literal">fillAmount</code> variable. This is contained in the <span class="strong"><strong>Image (Script)</strong></span> component of <span class="strong"><strong>Linear Timer</strong></span>. In fact, the ratio is the percentage of time left and also how much longer our linear timer should be.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec77"></a>There's more...</h3></div></div></div><p>The first of the next two sections will explain to us how to improve our timer by running some code after the timer expires. The second one, instead, will give us an idea about how to quickly change the design of our timer.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec17"></a>Running code when the timer expires</h4></div></div></div><p>In order for something to<a id="id155" class="indexterm"></a> happen after the time has expired, such as loading the game on the screen, or triggering the sound of a closing door because the player shouldn't be able to reach it after the time limit, we have to add a new variable to our script:</p><div class="informalexample"><pre class="programlisting">private bool isOver;</pre></div><p>Also, add an <code class="literal">else</code> branch inside the <code class="literal">Update()</code> function after the <code class="literal">if</code> statement, in the following way:</p><div class="informalexample"><pre class="programlisting">else{
  if(!isOver){
    isOver = true;
    //DO SOMETHING
  }
}</pre></div><p>We use the <code class="literal">isOver</code> variable to trigger the time elapsed event only once after the time expires. In order to test it, we can write something in the debug console by calling this function:</p><div class="informalexample"><pre class="programlisting">Debug.log("Timer expired!");</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec18"></a>Creating a double-sided timer</h4></div></div></div><p>In some cases, we <a id="id156" class="indexterm"></a>might want a timer that animates on both ends, adding intensity to the game by providing the player with a heightened sense of <a id="id157" class="indexterm"></a>urgency. To achieve this, we can use two linear timers that are synchronized; just make one specular to the other.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec78"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>For different kinds of timers or countdowns, refer to the <span class="emphasis"><em>Implementing a numeric timer</em></span>, <span class="emphasis"><em>Implementing a radial timer</em></span>, <span class="emphasis"><em>Creating a mixed timer</em></span>, <span class="emphasis"><em>Creating a well-formatted timer</em></span>, and <span class="emphasis"><em>Developing a well-formatted countdown that changes</em></span> recipes, which are all contained in this chapter</p></li></ul></div></div></div>