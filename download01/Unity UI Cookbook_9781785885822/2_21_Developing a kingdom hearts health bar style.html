<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec27"></a>Developing a kingdom hearts health bar style</h2></div></div><hr /></div><p>In this recipe, we <a id="id136" class="indexterm"></a>are going to create a very special kind of health bar, since we are combining the linear bar of <span class="emphasis"><em>Implementing a linear health bar</em></span> with the radial one of <span class="emphasis"><em>Implementing a radial health bar</em></span> in order to create a kingdom hearts health bar style. This style is like a typical horizontal health bar that is rounded at the end. To have a better idea, let's have a quick glance at the picture ahead of this recipe.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec68"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, let's create a new empty game object, so right-click on <span class="strong"><strong>Canvas</strong></span> object, since we want it as parent, and then <span class="strong"><strong>Create Empty</strong></span>. Lastly, rename it as <span class="strong"><strong>KHHealthbar</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip15"></a>Tip</h3><p>If there isn't the <span class="strong"><strong>Canvas</strong></span> object in the scene, for example, in new scenes, we can create it by right-clicking on <span class="strong"><strong>Hierarchy</strong></span> panel and then <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Canvas</strong></span>.</p></div></li><li><p>Next, right-click on <span class="strong"><strong>KHHealthbar</strong></span> and add a new image by selecting <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>, and<a id="id137" class="indexterm"></a> again rename the object just created as <span class="strong"><strong>Linear Part</strong></span>.</p></li><li><p>Repeat the previous step and rename the new image to <span class="strong"><strong>Radial Part</strong></span>.</p></li><li><p>Create one image for the linear part of the health bar and another for the radial part.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip16"></a>Tip</h3><p>We can use also the image used in <span class="emphasis"><em>Implementing a linear health bar</em></span> and <span class="emphasis"><em>Implementing a radial health bar</em></span> recipes.</p></div></li><li><p>Then, import them in to our project. If it is not set in 2D, remember to set the <span class="strong"><strong>Texture Type</strong></span> of the images to <span class="strong"><strong>Sprite (2D and UI)</strong></span>, and then click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>For <span class="strong"><strong>Linear Part</strong></span>, let's change <span class="strong"><strong>Fill Method</strong></span> into <span class="strong"><strong>Horizontal</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> into <span class="strong"><strong>Left</strong></span>. Of course, we need to add to <span class="strong"><strong>Source Image</strong></span> the health bar that we have imported.</p></li><li><p>For <span class="strong"><strong>Radial Part</strong></span>, let's change <span class="strong"><strong>Fill Method</strong></span> into <span class="strong"><strong>Radial 360</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> into <span class="strong"><strong>Left</strong></span>. Again, we need to add to <span class="strong"><strong>Source Image</strong></span> the health bar that we have imported. Finally, set <span class="strong"><strong>Fill Amount</strong></span> to <span class="strong"><strong>0.75</strong></span>.</p></li><li><p>Place them in order, and now we should see something that looks like the following:</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_02_12.jpg" /></div></li><li><p>Now, in the <span class="strong"><strong>KHHealthbar</strong></span>, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it as <span class="strong"><strong>KHHealthbarScript</strong></span>, and then press <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double click<a id="id138" class="indexterm"></a> on the script to edit it. Since we are going to use UI classes, we need to add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script.</p></li><li><p>We need four variables, one <code class="literal">private</code> and three <code class="literal">public</code>, so we can set these last ones in the <span class="strong"><strong>Inspector</strong></span>. The following are the variables:</p><div class="informalexample"><pre class="programlisting">  public Image linearBar;
  public Image radialBar;
  public intmaxHealth = 1000;
  private int health;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we need to set up the health so that at the beginning it is equal to the maximum:</p><div class="informalexample"><pre class="programlisting">  void Start () {
    health = maxHealth;
  }</pre></div></li><li><p>Then, we can add a function to <code class="literal">addHealth(int value)</code> to the player, which takes how many health points will be added to the player's health as a parameter. Hence, let's write it:</p><div class="informalexample"><pre class="programlisting">  public void addHealth(int value){
    health += value;
    if (health &gt;maxHealth)
      health = maxHealth;
    updateKHHealthbar ();
  }</pre></div></li><li><p>Since there must be a way to apply a damage, we should add a <code class="literal">removeHealth(int value)</code> function, as the following one:</p><div class="informalexample"><pre class="programlisting">  public boolremoveHealth(int value){
    health -= value;
    if (health &lt;= 0){ 
      health = 0;
      updateKHHealthbar ();
      return true;
    }
    updateKHHealthbar ();
    return false;
  }</pre></div></li><li><p>Now, the most <a id="id139" class="indexterm"></a>difficult part of the script is to design our update function. In fact, we have to be careful to make sure that we properly fill the two health bars. On the contrary of the previous script, our main issue is that the radial part of the bar starts it's filling from <code class="literal">0.75</code> and not from <code class="literal">1</code>, and also it represents 3/5 of the health and not 1/2. But we can face this in the following way:</p><div class="informalexample"><pre class="programlisting">  private void updateKHHealthbar () {
    float ratio = health*1f / maxHealth;
    Debug.Log (ratio);
    if (ratio &gt; 0.6) {
      linearBar.fillAmount = (ratio - 0.6f) * 2.5f;
      radialBar.fillAmount = 0.75f;
    } else {
      linearBar.fillAmount = 0;
      radialBar.fillAmount = 0.75f *ratio * 10f / 6f;
    }
  }</pre></div></li><li><p>Save our work. Then, we need to assign the two health bars to the <code class="literal">linearBar</code> and <code class="literal">radialBar</code> variables in the <span class="strong"><strong>Inspector</strong></span> by dragging the <span class="strong"><strong>Linear Part</strong></span> and the <span class="strong"><strong>Radial Part</strong></span> in their own variables.</p></li><li><p>Finally, the work is done!</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec69"></a>How it works...</h3></div></div></div><p>We started by creating two health bars: one linear and the other one radial. Then, we can parent them to a <span class="strong"><strong>GameObject</strong></span> called <span class="strong"><strong>KHHealthbar</strong></span>. Furthermore, we have set them to look like the kingdom hearts health bar style. Finally, we have implemented our logic within the script.</p><p>Inside the script, we<a id="id140" class="indexterm"></a> have created four variables. The first two are image, called <code class="literal">linearBar</code> and <code class="literal">radialBar</code>, and they will store the <span class="strong"><strong>Image (Script)</strong></span> component attached on <code class="literal">LinearPart</code> and <code class="literal">RadialPart</code>, respectively. <code class="literal">maxHealth = 1000</code> is the max health that the player can have: we can set its value in the <span class="strong"><strong>Inspector</strong></span>, but in our script, <code class="literal">1000</code> is set as the default value. Furthermore, the <code class="literal">health</code> variable contains the health currently possessed by the player.</p><p>In the <code class="literal">Start()</code> function, we have set up <code class="literal">health</code> equal to <code class="literal">maxHealth</code>. This ensure us that at the beginning, whoever (or whatever) will have this health bar will start with full health.</p><p>We have also created a function to <code class="literal">addHealth(int value)</code> to the player. It increases health by value, and if it exceeds <code class="literal">maxHealth</code>, it sets <code class="literal">health</code> equals to <code class="literal">maxHealth</code>. Finally, it calls the <code class="literal">updateKHHealthbar()</code> function to update the user interface.</p><p>Moreover, we also need to have a function to <code class="literal">removeHealth(int value)</code> from the player. The function takes how many health points have to be removed as a parameter. Then, it decreases health by value and checks whether the player is still alive. If he or she is, the function will return <code class="literal">false</code>, otherwise it will return <code class="literal">true</code>. Before a value is returned, in both branches, it calls the <code class="literal">updateKHHealthbar()</code> function to update the user interface.</p><p>Finally, we have written the <code class="literal">updateKHHealthbar()</code> function. All the numbers that we are going to see in the script are set up in order to give to the <span class="strong"><strong>Linear Part</strong></span> the 2/5 of the health of the player, and to the <span class="strong"><strong>Radial Part</strong></span> the 3/5 of the health. We created a ratio variable and store in it the ratio between <code class="literal">health</code> and <code class="literal">maxHealth</code>. Then, check through an <code class="literal">if</code> statement whether the ratio is more than 3/5 for performance in the script <code class="literal">0.6</code>. If so, we set the <code class="literal">fillAmount</code> of <code class="literal">linearBar</code> to the proportion of how long the bar should be, which in this case is <code class="literal">(ratio - 0.6f) * 2.5f</code>, and the <code class="literal">fillAmount</code> of <code class="literal">radialBar</code> to its maximum filling, that is, <code class="literal">0.75</code>. Otherwise, we set the <code class="literal">fillAmount</code> of <code class="literal">linearBar</code> to zero and the <code class="literal">fillAmount</code> of <code class="literal">radialBar</code> to the proportion of how long the bar should be. In this case, <code class="literal">ratio * 10f / 6f</code> and then also multiply for <code class="literal">0.75f</code> since its maximum filling is <code class="literal">0.75</code>.</p><p>As a last step, we assign <code class="literal">linearBar</code> and <code class="literal">radialBar</code> in the <span class="strong"><strong>Inspector</strong></span> with <span class="strong"><strong>Linear Part</strong></span> and <span class="strong"><strong>Radial Part</strong></span>, respectively.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec70"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If the design of <a id="id141" class="indexterm"></a>our game doesn't fit with a kingdom hearts heatlhbar style, we can refer to <span class="emphasis"><em>Implementing a linear heath bar</em></span> and <span class="emphasis"><em>Implementing a radial heath bar</em></span> recipes.</p></li><li style="list-style-type: disc"><p>For other kinds of health bars, see <span class="emphasis"><em>Creating a health bar with armor</em></span> and <span class="emphasis"><em>Using multiple bars to make a multibar</em></span> recipes.</p></li></ul></div></div></div>