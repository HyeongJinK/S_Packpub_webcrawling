<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec26"></a>Using multiple bars to make a multibar</h2></div></div><hr /></div><p>In this recipe, we are<a id="id126" class="indexterm"></a> going to create a very special kind of health bar, since we are combining multiple bars of <span class="emphasis"><em>Implementing a linear health bar</em></span> type together. This may be the case when the player has to face a boss in our game who has <a id="id127" class="indexterm"></a>multiple health bars. Once the player reduced one health bar to zero, there is another one behind .To achieve this, we will use multiple <span class="strong"><strong>Image (Script)</strong></span> components, one for each health bar, along with a script to manage all these bars within only one health points system.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec65"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, let's create a new empty game object. Right-click on <span class="strong"><strong>Canvas</strong></span> object, since we want it as a parent, and then <span class="strong"><strong>Create Empty</strong></span>. Finally, rename it to <span class="strong"><strong>MultiBar</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip14"></a>Tip</h3><p>If there isn't the <span class="strong"><strong>Canvas</strong></span> object in the scene, for example, in new scenes, we can create it by right-clicking on <span class="strong"><strong>Hierarchy</strong></span> panel and then go to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Canvas</strong></span>.</p></div></li><li><p>Now, right-click on <span class="strong"><strong>Multibar</strong></span> and add a new image by selecting <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>, and again rename the object just created as <span class="strong"><strong>HealthBar1</strong></span>.</p></li><li><p>Take an image for a linear health bar; we can use the one created in <span class="emphasis"><em>Implementing a linear health bar</em></span> recipe.</p></li><li><p>Import it in to our project. If this one is not set in 2D, remember to set the <span class="strong"><strong>Texture Type</strong></span> of the image to <span class="strong"><strong>Sprite (2D and UI)</strong></span>, and then click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>Let's change <span class="strong"><strong>Fill Method</strong></span> into <span class="strong"><strong>Horizontal</strong></span> and <span class="strong"><strong>Fill Origin</strong></span> into <span class="strong"><strong>Left</strong></span>. Of course, we have to add to <span class="strong"><strong>Source Image</strong></span> the health bar that we have imported. Finally, we can place the <span class="strong"><strong>HealthBar1</strong></span> everywhere we want, always using the <span class="strong"><strong>Rect Tool</strong></span>.</p></li><li><p>Let's duplicate <span class="strong"><strong>HealthBar1</strong></span> with <span class="emphasis"><em>Ctrl</em></span>+<span class="emphasis"><em>D</em></span> as many times as health bars the player will have. Rename them also in progression, such as <span class="strong"><strong>HealthBar1</strong></span>, <span class="strong"><strong>HealthBar2</strong></span>, <span class="strong"><strong>HealthBar3</strong></span>, and so on.</p></li><li><p>As next step, we need to differentiate them. The easiest way to do this is to change their colors. Otherwise, we can even import different images and assign them to all the health bars.</p></li><li><p>Place them in order to have one above the other in the <span class="strong"><strong>Scene View</strong></span>, keeping their order: <span class="strong"><strong>HealthBar2</strong></span> must be after <span class="strong"><strong>HealthBar1</strong></span> and before <span class="strong"><strong>HealthBar3</strong></span>. This order is important because the script we are going to write will use this order.</p></li><li><p>Now, in the <span class="strong"><strong>Multibar</strong></span>, click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <span class="strong"><strong>MultibarScript</strong></span>, and then press <span class="strong"><strong>Create and Add</strong></span>.</p></li><li><p>Double click on the script to edit it and, as always, add the <code class="literal">using UnityEngine.UI;</code> statement at the beginning of the script. By doing this, we can use UI classes inside our script.</p></li><li><p>Before to add<a id="id128" class="indexterm"></a> functions, we need a couple of variables, one <code class="literal">private</code> and two <code class="literal">public</code>, so we can set these last<a id="id129" class="indexterm"></a> ones in the <span class="strong"><strong>Inspector</strong></span>. Thus, the following are the variables:</p><div class="informalexample"><pre class="programlisting">  public Image[] bars;
  public intmaxHealth = 1000;
  private int health;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we need to set up the <code class="literal">health</code>, therefore:</p><div class="informalexample"><pre class="programlisting">  void Start () {
    health = maxHealth;
  }</pre></div></li><li><p>Our script should include an <code class="literal">addHealth(int value)</code> function that takes how many health points will be added to the player health as a parameter. So we can add the following:</p><div class="informalexample"><pre class="programlisting">  public void addHealth(int value){
    health += value;
    if (health &gt;maxHealth)
      health = maxHealth;
    updateMultibar ();
  }</pre></div></li><li><p>A <code class="literal">removeHealth(int value)</code> function should also be included so that the boss of our game can be damaged:</p><div class="informalexample"><pre class="programlisting">  public boolremoveHealth(int value){
    health -= value;
    if (health &lt;= 0){
      health = 0;
      updateMultibar ();
      return true;
    }
    updateMultibar ();
    return false;
  }</pre></div></li><li><p>Now, the most difficult part of the script is to design our <code class="literal">update</code> function. In fact, we need to pay attention to how we can fill every bar correctly given only one health points system. But we can do it the following way:</p><div class="informalexample"><pre class="programlisting">  private void updateMultibar () {
    float absolute = health*1f/maxHealth;
    float perBars = 1f / bars.Length;
    for (int i=0; i&lt;bars.Length; i++) {
      float minrange = i*perBars;
      float maxrange = (i+1)*perBars;
      if(absolute &gt;minrange){
        if(absolute &lt;maxrange){
          bars[i].fillAmount = (absolute-minrange)*bars.Length;
        }else{
          bars[i].fillAmount = 1;
        }
      }else{
        bars[i].fillAmount = 0;
      }
    }
  }</pre></div></li><li><p>Save our work. Then, we<a id="id130" class="indexterm"></a> have to assign the health bars to the bars array variable in the <span class="strong"><strong>Inspector</strong></span> by dragging each health bar in the entry of the array. Remember to<a id="id131" class="indexterm"></a> maintain the order.</p></li><li><p>Finally, the work is done! During a gameplay session we could get the following scenario, in which the health is slightly reduced and it is therefore possible to see the other bar under the first one.</p><div class="mediaobject"><img src="/graphics/9781785885822/graphics/B04903_02_EXTRA03.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec66"></a>How it works...</h3></div></div></div><p>We have created <a id="id132" class="indexterm"></a>several health bars inside a game object named <span class="strong"><strong>Multibar</strong></span>. Then, we developed a script to handle all of this bars.</p><p>Inside this script, we<a id="id133" class="indexterm"></a> have created three variables. The first one is an array of image called <code class="literal">bars</code>, and it will store all the bars contained in the <span class="strong"><strong>Multibar</strong></span>. The second is <code class="literal">maxHealth = 100</code> and it is the max health that the player can have; we can set its value in the <span class="strong"><strong>Inspector</strong></span>, but as default in our script, it has <code class="literal">1000</code> as value. Furthermore, the third is <code class="literal">health</code> and it contains the amount of health that is currently possessed by the player.</p><p>In the <code class="literal">Start()</code> function, we have made <code class="literal">health</code> equal to <code class="literal">maxHealth</code>. This will ensure that at the beginning, whichever character has this health bar will start with all the health.</p><p>We have also created a function to <code class="literal">addHealth(int value)</code> to the player. It increases health by value, if it exceeds, <code class="literal">maxHealth</code> set <code class="literal">health</code> equals to <code class="literal">maxHealth</code>. This is because we cannot have more health the maximum. Finally, we have called the <code class="literal">updateMultibar()</code> function to update the user interface.</p><p>Then, we developed a function to <code class="literal">removeHealth(int value)</code> that has a parameter, which determines how many health points are removed from the character that has this <span class="strong"><strong>Multibar</strong></span>. This function decreases the health by value and checks whether the player is still alive. If he or she is, it will return <code class="literal">false</code>, otherwise it will return <code class="literal">true</code>. But before we return a value, in both branches, the function calls the <code class="literal">updateMultibar()</code> function in order to update the users interface.</p><p>Finally, we have written the <code class="literal">updateMultibar()</code> function. Here, we had to set every single bar to the right <a id="id134" class="indexterm"></a>proportion. To begin, we created a couple of variables. The absolute stores the ratio between <code class="literal">health</code> and <code class="literal">maxHeath</code>. The <code class="literal">perBars</code> stores how much, in percentage, every bar represents the health. Then, we use a for-cycle to set every bar to the right proportion. For every bar, we set up two variables. One is the <code class="literal">minRange</code> and the other is the <code class="literal">maxRange</code>, displayed as a percentage of where that <a id="id135" class="indexterm"></a>bar is collocated if every bar is concatenated to be only one long bar. Now, if the absolute is more than this range, the <code class="literal">fillAmount</code> of that bar is set to <code class="literal">1</code>. If the absolute is less than that range, the <code class="literal">fillAmount</code> variable of that bar is set to <code class="literal">0</code>. Otherwise, the absolute is inside the range, and we set the <code class="literal">fillAmount</code> variable of that bar to its relative percentage, that is, <code class="literal">(absolute-minrange)*bars.Length</code>.</p><p>Before running the game, we assigned each bar that we have created to the entries of our bars array so that our script can have the right reference to them.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec67"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If the design of our game doesn't fit with a <span class="strong"><strong>Multibar</strong></span>, we can refer to <span class="emphasis"><em>Implementing a linear health bar</em></span> and <span class="emphasis"><em>Implementing a radial health bar</em></span>.</p></li><li style="list-style-type: disc"><p>For other kinds of health bars, see <span class="emphasis"><em>Creating a health bar with armor</em></span> and <span class="emphasis"><em>Developing a kingdom hearts health bar style</em></span> recipes.</p></li></ul></div></div></div>