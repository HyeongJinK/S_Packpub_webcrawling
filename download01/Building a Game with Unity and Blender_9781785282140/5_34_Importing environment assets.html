<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec36"></a>Importing environment assets</h2></div></div><hr /></div><p>After learning <a id="id784" class="indexterm"></a>about Unity's user interface, let's import all the assets we did in the previous chapters into our Unity project! There are several ways in which you can import your assets. The first way is to copy the files into the <code class="literal">Assets</code> folder in your project directory. Unity will detect the files and convert them to its native format automatically.</p><p>Don't worry as Unity practices non-destructive approaches, which means it doesn't actually do anything to your original files. Instead, it places the converted files into temporary folders within the project directory, which are hidden away from the engine users.</p><p>The second method is to drag the source files directly to the <span class="strong"><strong>Project</strong></span> panel in Unity. Your files will be copied to the <code class="literal">Assets</code> folder and get converted to the native format automatically. After this, you will be able to see thumbnails of your assets showing up on the Project Browser. You will also see an additional folder being created named <code class="literal">Materials</code>. This will happen when you import any 3D models to your game project. The folder contains materials that are having the same name and basic properties (usually color and texture) as the 3D models that you just imported. It saves your time for having to create the materials one by one from scratch.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_02.jpg" /></div><p>The first thing I<a id="id785" class="indexterm"></a> always do after importing all the assets to my game project is to tidy up the directory. I categorize the assets and place them into different subfolders, such as <code class="literal">Meshes</code>, <code class="literal">Textures</code>, and so on. It's always a good thing to start arranging your assets properly early on. As your project progresses, there will be more and more assets being added to your project, and it will be much harder to tidy up your project directory by then.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_03.jpg" /></div><p>Before we start placing the meshes to the scene, one important step that we need to do is to ensure that the import settings have been set correctly. Select one of the meshes in the Project Browser and you will see the import settings appearing on the <span class="strong"><strong>Inspector</strong></span> panel. The import settings can be set differently depending on how you use the mesh in your game: whether your mesh has blend shapes or colliders, or require an extra UV map for light map baking, and so on. It really depends on your game's requirement.</p><p>In this case, I need all my rocks and terrain to have collision, as well as a UV map to generate light map; therefore, I enable those options in the import settings.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_20.jpg" /></div><p>I have also enabled <span class="strong"><strong>Optimize Mesh</strong></span> and set the <span class="strong"><strong>Mesh Compression</strong></span> setting to <span class="strong"><strong>Medium</strong></span> so that Unity helps to automatically optimize the meshes without any manual labor work. These options, however, might<a id="id786" class="indexterm"></a> cause visual artifacts to the meshes, so you really have to check it multiple times to avoid such problems. Try to lower down the <span class="strong"><strong>Mesh Compression</strong></span> setting if it causes visual artifacts to your mesh. I applied the same settings to all the rock meshes as well as the terrain. For the grass model, I disabled <span class="strong"><strong>Generate Colliders</strong></span> because we don't want our characters to collide and get stuck within the bushes. Instead, we want them to be able to move through the grass without any obstruction.</p><p>After this, start placing each of the meshes to the scene by dragging them from the Project Browser to the Scene View. Alternatively, you can also drag the meshes to the <span class="strong"><strong>Hierarchy</strong></span> panel, both ways work the same. The reason we do this is to set up the meshes properly. Later on, we will turn them into what we call prefabs.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec14"></a>Introducing prefabs</h3></div></div></div><p>Prefabs are basically<a id="id787" class="indexterm"></a> templates from which you can create new object<a id="id788" class="indexterm"></a> instances in the scene. We only need to set up the asset once—the material, texture, physics settings, and so on—and pack them into prefabs. After this, we only need to place the prefabs around the scene without repeating the same steps (setting up the material, texture, physics settings, and so on) again and again for each identical asset. When we change the properties of a prefab (for example, changing the texture), the same properties in all the instances linked to this particular prefab will also be changed.</p><p>Prefab is something really important, that often saves us from lots of trouble and hassle. For example, say you have finally placed all the 300 palm tree meshes to your game scene without using any prefab. Then, all of a sudden, your art director realized that the size of the trees is <a id="id789" class="indexterm"></a>very big and should be scaled down by 20%. Without<a id="id790" class="indexterm"></a> using any prefab, the only way to do this is to scale all the tree meshes one by one. Likewise, you will only need to set the correct scale in the source prefab, and all the tree instances in the scene will be changed instantly. Work smart!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec15"></a>Setting up the terrain</h3></div></div></div><p>At this stage, place <a id="id791" class="indexterm"></a>only the terrain and rock meshes to the scene<a id="id792" class="indexterm"></a> because they all share the same texture and material. Then, create a new material and rename it to <code class="literal">rock</code>. Click on the small rectangle icon in front of the <span class="strong"><strong>Albedo</strong></span><a id="id793" class="indexterm"></a> property and select the rock texture. </p><p>Now, apply this material to the meshes in the scene by dragging the material from the Project Browser directly to the specific object in the scene.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_04.jpg" /></div><p>Now that we have placed the terrain and all rocks to the scene and applied the material to all of them, it's time to pack them into prefabs! It's extremely easy to achieve this. All you need to do is drag<a id="id794" class="indexterm"></a> the game object from the <span class="strong"><strong>Hierarchy</strong></span> panel back to the Project Browser. When you change the properties of a prefab instance in the<a id="id795" class="indexterm"></a> scene, the properties of the other instances will not be changed. However, if you click on the <span class="strong"><strong>Apply</strong></span> button on the <span class="strong"><strong>Inspector</strong></span> panel, it will then apply the changes to the source prefab, which subsequently changes all the other prefab instances as well.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_05.jpg" /></div><p>After this, place the rock prefabs around the scene to make it look more interesting! The terrain, especially the wall, looks really smooth now, so we need to place some rocks on the wall to make the surface uneven and look more <span class="emphasis"><em>rockier</em></span>. You can do this in Blender as well, but it's very hard to change it later on, and furthermore, the polygon count will be extremely high because each rock is a totally distinct individual mesh with a set of polygon data. </p><p>If you do this in Unity, however, each rock is just an instance of an existing prefab, which shares the polygon data across the entire map; this saves a lot of resources and gain better performance for your game. Besides, since the prefab instances are not combined together as a huge chunk of mesh unlike what happens if you do it in Blender, it can also take advantage of the occlusion culling feature in Unity, which hides any game object, that is not <a id="id796" class="indexterm"></a>within the eyesight of the game camera. We will discuss more about this later.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_06.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec16"></a>Setting up water surfaces</h3></div></div></div><p>After you have done<a id="id797" class="indexterm"></a> placing all the rock prefabs around the scene, we will now proceed to something simpler, but interesting—water<a id="id798" class="indexterm"></a> surfaces. If you refer back to the environment concept, there are basically two areas that have water containment: one is the small area within the terrain and another one is a big volume of water surrounding the terrain.</p><p>Normally in video games, water surfaces are planes with fancy material applied on it to make it look like water. It's the same in our case; let's create a plane by going to <span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span>. Select the plane by using the left mouse button and press <span class="emphasis"><em>W</em></span> to enable transform manipulator. Move the plane to the location you want and scale the plane by switching over to scale manipulator using the <span class="emphasis"><em>R</em></span> key in order to fill the entire pit with the water. It is okay to intersect the plane with the terrain as the player will not be able to see what's underneath the terrain.</p><p>Then, create a new material and apply a texture to the <span class="strong"><strong>Albedo</strong></span> property. I grabbed a free seamless water texture from the Internet, which looks really nice and fits my purpose. In my case, my water texture looks too whitish, so I adjusted the color of the albedo to bright ocean blue. I also adjusted the metallic and smoothness values to give the water surface a little bit of specularity. Do note that if you set the alpha value of the color lower, your water doesn't actually become more transparent. This is because the rendering mode of your material is currently set to <span class="strong"><strong>Opaque</strong></span>. You need to set it to the <span class="strong"><strong>Transparent</strong></span> mode to make use of the alpha value. Depending on the size of your water surface, you might also want to change the tiling value of your texture so that the scale of your texture matches your visual goal.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_07.jpg" /></div><p>Next, create another<a id="id799" class="indexterm"></a> plane. This time, scale it into a massive gigantic plane and place it somewhere below the ground level. Duplicate<a id="id800" class="indexterm"></a> the previous material by selecting the material in the project panel and press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>. Rename the material and set the texture tilling to an even higher value to match the size of the plane. Your level should look something like this by now.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_08.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec17"></a>Setting up foliage</h3></div></div></div><p>Currently, our cave looks really boring with just rocky surfaces everywhere, so let's pull in the grass model and the decal texture that we did in the previous chapter! For the decal, the method is similar to <a id="id801" class="indexterm"></a>what we did to the water surface—create a plane, a material with the decal texture applied to its albedo property, and apply the material to the plane you just created. Then, set the rendering mode to <span class="strong"><strong>Fade</strong></span> and you'll get a nice-looking decal with smooth transparency around the texture. The transparent<a id="id802" class="indexterm"></a> mode is not suitable in this case, as it will create a white halo around the transparent area, which is not the correct visual that we're looking for. After this, pull the game object back to the Project Browser to pack it into a prefab.</p><p>Next, place the grass model into the scene, create a new material for it, and apply the grass texture to the Albedo property. For the grass material, set the rendering mode to <span class="strong"><strong>Cutout</strong></span> instead of any other modes. If you set the rendering mode to <span class="strong"><strong>Fade</strong></span> or <span class="strong"><strong>Transparent</strong></span>, the polygon sorting will not be correct, and hence there will be an odd-looking visual artifact created. After this, drag the grass object to the Project Browser to pack it into a prefab.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_09.jpg" /></div><p>The reason we created the decal is to use it as a <span class="emphasis"><em>carpet</em></span> below the grass models. Without the decal, the grass will look as if it suddenly pops out from the rock and won't look as convincing to viewers. Instead, if we place the grass models on top of the decals, it will look <a id="id803" class="indexterm"></a>more natural and make more sense.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_10.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec18"></a>Setting up environment lighting</h3></div></div></div><p>After you have placed the<a id="id804" class="indexterm"></a> grass around, it's time to set up the lighting. There are several types of lighting, including ambient light, spot light, directional light, point light, and so on. Each type of light serves a different purpose and<a id="id805" class="indexterm"></a> produces different effect, so you have to be really sure what kind of outcome you're looking for before deciding the type of light to use.</p><p>The first thing you need to do is delete all the existing lights in the scene. It's better to start from complete dark and slowly add in different light sources one by one. Next, go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Lighting</strong></span> and open up a new <span class="strong"><strong>Lighting</strong></span> panel. Change <span class="strong"><strong>Ambient Source</strong></span> to <span class="strong"><strong>Gradient</strong></span> and set the three colors below it to something bluish, gradually becoming darker. This will set the overall ambient mood for our scene.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_11.jpg" /></div><p>Since our scene is supposedly located in a dungeon, we shouldn't be seeing the sky at all. So, I went back to Blender and created a huge cave wall surrounding the terrain. This can be easily achieved by<a id="id806" class="indexterm"></a> creating a sphere; squash it a little and adjust some of the vertices to add some irregularity to its appearance. Then, select all the faces and flip the normal's direction by<a id="id807" class="indexterm"></a> going to the Tool Shelf and clicking on <span class="strong"><strong>Shading/UVs</strong></span> tab, click on the <span class="strong"><strong>Flip Direction</strong></span> option under <span class="strong"><strong>Normals</strong></span>. Export the cave from Blender to Unity and viola! If the texture scale seems to be off, you can either change the texture tilling settings in the material or adjust the UV scale of the cave wall in Blender. </p><p>Viola! The scene now looks more like a dungeon.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_12.jpg" /></div><p>Next, we will start adding actual light sources to the scene. If you haven't already deleted all the lights in the scene, especially the default sun light (directional light), do it now. Since our scene is located in a dungeon, no sun light is able to reach here, and it's not logical to use directional light in this case. Besides this, I always turn off the <span class="strong"><strong>Continuous Baking</strong></span> setting on the<a id="id808" class="indexterm"></a> <span class="strong"><strong>Lighting</strong></span> panel because I prefer to manually bake the lighting.</p><p>Create a point light by going to <span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Point Light</strong></span>. Adjust the range and intensity to something<a id="id809" class="indexterm"></a> that you think matches your visual goal and then place more lights to the entire scene by duplicating the first point light. </p><p>Use the light sources to guide the player around the level, because players tend to subconsciously follow the path that has brighter light on the other end and won't go for the dark.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_13.jpg" /></div><p>Once the lighting has been set up, select all the meshes in the scene and tick the <span class="strong"><strong>Static</strong></span> option on the <span class="strong"><strong>Inspector</strong></span> panel. This step is crucial because the light map will only be generated for the static meshes. Then, go to <span class="strong"><strong>Lighting</strong></span> panel and click on the <span class="strong"><strong>Build</strong></span> button. If the lightmap is not baked correctly, check your mesh settings again. Select the meshes in the Project Browser and make sure that the <span class="strong"><strong>Generate lightmap UV into UV2</strong></span> option is enabled.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note21"></a>Note</h3><p>A light map is essentially a<a id="id810" class="indexterm"></a> texture that stores the brightness of the surface of a 3D model the later use. The brightness is precalculated by the game engine based on the surrounding lighting set up by the level designer. The light map allows the game to display sophisticated lighting effects, such as Global Illumination, at a<a id="id811" class="indexterm"></a> relatively low computational cost.</p></div><p>If everything goes<a id="id812" class="indexterm"></a> flawlessly, you should be able to get a nicely lit dungeon that gives players the sense of danger—mysterious and adventurous!</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_14.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec19"></a>Optimizing the scene with Occlusion Culling</h3></div></div></div><p>Next, we will <a id="id813" class="indexterm"></a>optimize the scene by using a method named <span class="strong"><strong>Occlusion Culling</strong></span>. This technique generates partitions in the 3D space and assigns each game object into the partition that<a id="id814" class="indexterm"></a> occupies the same space with the object. During the game mode, Unity will hide all the game objects that are not being seen by the in-game camera by checking which partition is within the camera view frustum and which partition is not.</p><p>Open up the <span class="strong"><strong>Occlusion</strong></span> panel by going to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Occlusion Culling</strong></span>. Click on the <span class="strong"><strong>Bake</strong></span> button to generate the partitions for the first time to check whether the size is correct. Each partition (or occluder) should not be too huge as it will decrease the effectiveness of the culling process. Set the <span class="strong"><strong>Smallest Occluder</strong></span> setting to adjust the size of the partitions. The screenshot that illustrates the different outcome by putting a different value to the <span class="strong"><strong>Smallest Occluder</strong></span> setting is as follows. After the baking process is complete, you<a id="id815" class="indexterm"></a> can check the result by selecting the camera and choose <span class="strong"><strong>Visualize</strong></span> option in the drop-down menu located in the small <span class="strong"><strong>Occlusion Culling</strong></span> window appearing in your scene panel. Do<a id="id816" class="indexterm"></a> note that the more complex your scene is, the longer it will take to bake the light maps.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_15.jpg" /></div></div></div>