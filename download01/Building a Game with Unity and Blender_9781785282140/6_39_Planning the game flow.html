<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec40"></a>Planning the game flow</h2></div></div><hr /></div><p>Let's start creating our game structure by planning the game flow. Game flow is the overall flow of <a id="id839" class="indexterm"></a>our game, from the moment it's launched to finally quitting the game. From the game flow, we will be able to see the big picture of how our game is going to work.</p><p>For example, a typical game flow may look like this:</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_06_01.jpg" /></div><p>A flow chart like this usually starts from the top going downwards. You can also put an indication for the starting node such as a different background color, apply bold text, or put an icon beside the text. After that, arrows will be used to indicate how the game state is being navigated based on given conditions. Diamond shapes will be used when there is more than one condition, and each of them will yield a different result, hence its arrow will be pointing to a different state. Two-way arrows will be used for two-way navigation between two states.</p><p>By looking at the<a id="id840" class="indexterm"></a> preceding chart, we are able to tell that the game contains an introduction cinematic right after the splash screen, as well as a tutorial level that can be entered from the main menu. The flow chart is self-explanatory and requires no extra explanation for the developers to understand the flow of the game, and this automatically makes the communication between different departments easier.</p><p>By looking at the flow chart, game programmers are able to list the features that are required for the game (for example, a full-screen video player is required in order to play the intro cinematic) and start working on them. At this point, however, we shouldn't dive into the details, such as how the main menu works, what the tutorial should look like, and so on. We should first get the overall picture right before going into details. This way, we can avoid design problems that may occur during the production stage. For our game, however, it is much simpler. We do not have any introduction cinematic, game options, as well as a tutorial level, so we will just keep those three out from our chart.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_06_02.jpg" /></div><p>Now that we have the flow chart ready, you can send it to your team members and get them to implement the game flow. If you are the sole developer, however, I will teach you how to implement the flow chart into your game! Since the splash screen is the first state in the flow chart, and also probably the easiest one to make, we will learn how to create our game's <a id="id841" class="indexterm"></a>splash screen in Unity.</p><p>First, open up your Unity project from the previous chapter. Then, create a new scene and name it <code class="literal">SplashScreen</code>. The naming is important because we will be using it for jumping from one scene to another later in this chapter. After that, we will see an empty scene that has a sky box applied by default. We don't want that for our splash screen, so we will create a 2D background to hide the sky box from the player.</p><p>To do that, we need to first of all create a canvas that acts like a container for our user interface objects. Go to <span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Canvas</strong></span> to create the canvas. After that, create an image object by selecting the canvas and going to <span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>. A white rectangle will be created on the screen, but it does not cover the entire screen. To solve that issue, select the image object and open up the <span class="strong"><strong>Inspector</strong></span> panel. In the <span class="strong"><strong>Inspector</strong></span> panel, you will see a box icon under <span class="strong"><strong>Rect Transform</strong></span>. Click on that icon to open up the <span class="strong"><strong>Anchor Presets</strong></span> window.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_06_03.jpg" /></div><p>Select the icon in the bottom-right corner, which will make the image stretch along both axes. After that, make sure "Left", "Top", "Right", and "Bottom" are all set to 0. Now, the white image will cover the entire screen, which covers the 3D scene entirely.</p><p>Next, create another image object and apply your team's logo to it. Make sure the texture type of the image<a id="id842" class="indexterm"></a> is set to "Sprite (2D and UI)", otherwise it cannot be used in the image object.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_06_04B.jpg" /></div><p>Once you're done, you will get this result:</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_06_04.jpg" /></div><p>But we don't want a static splash screen like this as it's kind of boring. Let's learn how to create a splash screen that fades in slowly before jumping over to the main menu. To achieve this, you'll need some scripting.</p><p>Create a new C# script<a id="id843" class="indexterm"></a> in Unity by going to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>C# Script</strong></span>. Name the script as <code class="literal">SplashScreen.cs</code> and double-click on it to open it up with the default script editor, that installed together with Unity, called MonoDevelop. By default, the newly created script is not empty. Unity has already written the class for you, which is named after your script's filename.</p><p>Inside the class, there are two functions: one called <code class="literal">Start()</code> and another called <code class="literal">Update()</code>. Both of these functions are built-in functions of Unity, which will be automatically called by Unity when the game is running. The <code class="literal">Start()</code> function only runs once when the scene has started (or when an object has spawned), as the function name implies. The <code class="literal">Update()</code> function, however, gets called by Unity in every game loop (or every tick). If your game is running at 60 frames per second, the <code class="literal">Update()</code> function will be called 60 times in a second.</p><p>Before you start writing any code, let's add this dependency called <code class="literal">UnityEngine.UI</code> to the top of your script. This is required for later use.</p><div class="informalexample"><pre class="programlisting">using UnityEngine.UI;</pre></div><p>After that, within the <code class="literal">SplashScreen</code> class, we will add three variables: the first is the pointer to the logo object, the second variable is the color of the logo for us to change the opacity later, and the third is the speed of the opacity change. I added <code class="literal">public</code> in front of <code class="literal">Image</code> and <code class="literal">lerp</code> multiplier variables so that the variables will later appear on Unity's <span class="strong"><strong>Inspector</strong></span> panel for us to link the logo object to this script.</p><div class="informalexample"><pre class="programlisting">public Image logo;
Color logoColor;
public lerpMultiplier = 0.02f;</pre></div><p>Next, we will tell Unity what to do when the scene is first loaded, by writing code within the <code class="literal">Start()</code> function. We declare the <code class="literal">logoColor</code> variable in the form of RGBA and set it to transparent. Then, we make our logo transparent by applying <code class="literal">logoColor</code> to its <code class="literal">color</code> variable. After that, we execute <code class="literal">GotoMainMenu()</code> by using the <code class="literal">StartCoroutine()</code> function, which we will declare later.</p><div class="informalexample"><pre class="programlisting">void Start ()
{
  logoColor = new Color (1, 1, 1, 0);
  logo.color = logoColor;

  StartCoroutine (GotoMainMenu());
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>A <span class="strong"><strong>coroutine</strong></span> is a <a id="id844" class="indexterm"></a>special function that can stretch out over many ticks without stopping the rest of the game from going forward.</p></div><p>
<code class="literal">GotoMainMenu</code> is a <a id="id845" class="indexterm"></a>custom function that we wrote ourselves, which means Unity will not bother about it until we execute the function ourselves. In the <code class="literal">GotoMainMenu()</code> function, we ask the function to delay for 4 seconds before executing the next line of the function, which loads the main menu scene.</p><div class="informalexample"><pre class="programlisting">IEnumerator GotoMainMenu()
{
  yield return new WaitForSeconds(4);
  Application.LoadLevel ("MainMenu");
}</pre></div><p>After that, we will write the code that makes the logo fade in over time. To achieve this, we need to write the code inside the <code class="literal">Update()</code> function, because the <code class="literal">Update()</code> function gets called on every tick; therefore, it can alter the transparency value over time.</p><p>We use a function from the <code class="literal">Color</code> class called <code class="literal">Lerp()</code>, which does exactly thisâ€”changing a <code class="literal">color</code> variable to a target color over a period of time. The <code class="literal">Lerp()</code> function requires three input variables: the first one is the original color, which is the color of the logo; the second variable is the target color; and the last variable is the speed at which the color changes over time. After that, we apply the color again to the logo.</p><div class="informalexample"><pre class="programlisting">void Update ()
{
  logoColor = Color.Lerp(logoColor, new Color(1, 1, 1, 1), Time.time * lerpMultiplier);
  logo.color = logoColor;
}</pre></div><p>There you have it; we have completed the splash screen. However, don't forget to apply the <code class="literal">SplashScreen</code> script to an object in the scene; in this case, I applied the script to the camera, and then dragged the logo object to the <code class="literal">logo</code> variable of the script in the <span class="strong"><strong>Inspector</strong></span> panel.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_06_05.jpg" /></div><p>This is an <a id="id846" class="indexterm"></a>overview of the full script:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

using UnityEngine.UI;

public class SplashScreen : MonoBehaviour
{
  public Image logo;
  Color logoColor;
  public lerpMultiplier = 0.02f;

  void Start ()
  {
    logoColor = new Color (1, 1, 1, 0);
    logo.color = logoColor;

    StartCoroutine (GotoMainMenu());
  }

  IEnumerator GotoMainMenu()
  {
    yield return new WaitForSeconds(4);
    Application.LoadLevel ("MainMenu");
  }

  void Update ()
  {
    logoColor = Color.Lerp(logoColor, new Color(1, 1, 1, 1), Time.time * lerpMultiplier);
    logo.color = logoColor;
  }</pre></div></div>