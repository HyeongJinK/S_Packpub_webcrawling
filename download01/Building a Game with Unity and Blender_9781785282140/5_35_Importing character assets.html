<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec37"></a>Importing character assets</h2></div></div><hr /></div><p>We have just <a id="id817" class="indexterm"></a>completed our level's environment. Now, let's import the characters! The process is similar to importing the environment assets—drag the models to the scene, apply a material to it, and we're almost done. One of the most important aspects that makes the characters feel alive is animation. Without any animation, your characters will just look like props and not living things. In previous chapters, you have already learned how to animate the characters in Blender and how to export the animations alongside the 3D models. Even though we are not using the animations in this chapter yet, we need the right settings so that the animations are ready to be used at anytime in the following chapters.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_16.jpg" /></div><p>To set up <a id="id818" class="indexterm"></a>animations for the characters, we need to go back to the Project Browser and select the character's mesh. In the <span class="strong"><strong>Inspector</strong></span> panel, click on the <span class="strong"><strong>Animations</strong></span> button to open up the animation settings interface. Under the <span class="strong"><strong>Clips</strong></span> section, you can add or remove animations by clicking on the <span class="strong"><strong>+</strong></span> and <span class="strong"><strong>−</strong></span> buttons. To edit each of the animations, select the animation from the list and all the properties of the animation will be shown below the list. You can change the name, start frame, end frame as well as other properties. You can also preview the animation at the bottom part of the panel. Once you're done, click on the <span class="strong"><strong>Apply</strong></span> button and you're good to go!</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_17.jpg" /></div><p>Next, you will learn how to call these animations during gameplay. Even though we have set the animations, such <a id="id819" class="indexterm"></a>as idle, run, and attack, the animations are not linked to your character prefab just yet. In order to do so, you need to create something named <a id="id820" class="indexterm"></a><span class="strong"><strong>Animator Controller</strong></span> in Unity, which is part of the animation system in Unity named <a id="id821" class="indexterm"></a><span class="strong"><strong>Mechanim</strong></span>. An Animator Controller allows you to arrange and maintain a set of animations for a character or an object and manages the various animation states and transitions between them using a flow chart system named <a id="id822" class="indexterm"></a><span class="strong"><strong>state machine</strong></span>.</p><p>An Animation controller exists as an asset in Unity, so in order to create one, you can go to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Animator Controller</strong></span>, or just right-click on the Project Browser and then go to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Animator Controller</strong></span> to create one. To edit the controller, double-click on the file you just created, and Unity will automatically open up an <span class="strong"><strong>Animator</strong></span> window.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_21.jpg" /></div><p>Let's take a closer look at the <span class="strong"><strong>Animator</strong></span> window:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Layers</strong></span>: This allows you to manage complex state machines for different body parts. For example, if you have a character who walks around while shooting, you can create two <a id="id823" class="indexterm"></a>different animation layers: one for the upper body and another for the lower body, with each control different state machines of different body part, allowing both running and shooting animations to coexist<a id="id824" class="indexterm"></a> within the same character mesh.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Parameters</strong></span>: This contains the <a id="id825" class="indexterm"></a>variables that are defined within an animator controller that can be accessed and assigned values from scripts. This is how you can control or affect the flow of the state machine through scripting.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Show/Hide side panel</strong></span>: You can<a id="id826" class="indexterm"></a> show or hide the side panel on the animator window by pressing this button.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Node Editor</strong></span>: This is the main <a id="id827" class="indexterm"></a>layout of the <span class="strong"><strong>Animator</strong></span> window where you would edit the flow of the animation states. Each state is represented by a rectangular block, which we refer as a node. Every node can be linked to each other for state transition. Above the <span class="strong"><strong>Editor</strong></span> panel, you can see another panel with the word <span class="strong"><strong>Base Layer.</strong></span> This is the hierarchical <a id="id828" class="indexterm"></a>breadcrumb where you can jump back and forth to the substates of a node or to the parent states of the current state.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Auto Live Link</strong></span>: When <a id="id829" class="indexterm"></a><span class="strong"><strong>Auto Live Link</strong></span> is enabled, Unity will display an animation with a highlight on the <span class="strong"><strong>Animator</strong></span> window to show which state is being played during gameplay.</p></li></ul></div><p>By default, you will see two bars within the <span class="strong"><strong>Animator</strong></span> window: <span class="strong"><strong>Any State</strong></span> and <span class="strong"><strong>Entry</strong></span>. Each of these bars is called an <a id="id830" class="indexterm"></a><span class="strong"><strong>animation state</strong></span>, and they can be navigated to one another based on the conditions you set and the way you link the states together. The <span class="strong"><strong>Entry</strong></span> state is where the state machine starts from. The state that it points to will be the default animation state of the controller. On the other hand, the <span class="strong"><strong>Any State</strong></span> state allows you to make a transition from any one of the animation states to the state it's pointing to.</p><p>Now it's time to add the animations that we have set up previously to the animator controller. It's very easy to<a id="id831" class="indexterm"></a> get this done, all you need to do is click on the little arrow icon besides the character mesh to expand it and search for the animation clips, which you created previously by setting the start frame and end frame. Click and drag the animation clip directly to the animator window and you will see a new animation state being added to the animator window with the name matching the clip you just dragged.</p><p>The first animation clip being added to the animator window will be linked to the entry state and change its color from gray to orange, which indicates that it is the default state. Alternatively, you can also drag the mesh to the <span class="strong"><strong>Animator</strong></span> window without expanding it, and that will directly add all the animation clips contained within the mesh.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_22.jpg" /></div><p>Next, we will make a transition from the <span class="strong"><strong>Idle</strong></span> state to the <span class="strong"><strong>Running state</strong></span> by right-clicking on the <span class="strong"><strong>Idle</strong></span> state and select <span class="strong"><strong>Make Transition</strong></span> from the pop-up menu. A line with an arrow in the middle will appear and follow your cursor around, which indicates that the animation state is now ready to link to the other state. Move your cursor to the animation state, which you want it to navigate to, in this case, the <span class="strong"><strong>Running</strong></span> state, and left-click on it. The line will now connect from the <span class="strong"><strong>Idle</strong></span> state to the <span class="strong"><strong>Running</strong></span> state; this indicates that the <span class="strong"><strong>Running</strong></span> state can be<a id="id832" class="indexterm"></a> navigated from the <span class="strong"><strong>Idle</strong></span> state if the conditions meet, which we will discuss later. Now, let's right-click on the <span class="strong"><strong>Running</strong></span> state, select <span class="strong"><strong>Make Transition</strong></span> and click on the <span class="strong"><strong>Idle</strong></span> state to make a transition back to the <span class="strong"><strong>Idle</strong></span> state. </p><p>This is important because we want to return to idling animation when the character is not running around.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_23.jpg" /></div><p>After this, we need to create a parameter in order to be used as a condition for the animation states to change. The condition to change from idling to running, and vice versa, is obviously the movement speed of the player. Therefore, we need to create a floating point number as a parameter for the condition. To do this, go to the Parameter tab on the side panel of <span class="strong"><strong>Animation</strong></span> window, click on the <span class="strong"><strong>+</strong></span> button, and select <span class="strong"><strong>Float</strong></span> from the pop-out menu. A new parameter will then be added to the <span class="strong"><strong>Parameters</strong></span> tab. Rename the parameter to <code class="literal">runningSpeed</code> and lead the default value as <code class="literal">0.0</code>.</p><p>Now that you have created the parameter, we can use it as the condition to navigate between states. Click on one of the arrows connecting the <span class="strong"><strong>Idle</strong></span> state and <span class="strong"><strong>Running</strong></span> state, the <span class="strong"><strong>Inspector</strong></span> window will now display the properties of that particular transition. Scroll down to the bottom of the <span class="strong"><strong>Inspector</strong></span> window and you will see a section named <span class="strong"><strong>Condition</strong></span>. Click on the <span class="strong"><strong>+</strong></span> button below it to add a new condition and then select the parameter you want from the drop-down box. If you only have one parameter, it will be selected automatically by default. You will see another drop-down box besides the parameter name with two options: <span class="strong"><strong>Greater</strong></span> and <span class="strong"><strong>Less</strong></span>, and a text field besides it. These three options form a condition that allows a state to transition to another state when the requirement is met.</p><p>For example, if we want to navigate from the <span class="strong"><strong>Idle</strong></span> state to the <span class="strong"><strong>Running</strong></span> state, the <code class="literal">runningSpeed</code> should be<a id="id833" class="indexterm"></a> higher than zero because the player will start moving. Therefore, the condition for the transition should be:</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_18.jpg" /></div><p>On the other hand, if we want the animation to return to <span class="strong"><strong>Idle</strong></span> state when player stops moving, the condition will look like so:</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_19.jpg" /></div><p>The number behind varies between different projects due to different scaling factor, so make sure that you check what number is best suited for you.</p><div class="mediaobject"><img src="/graphics/9781785282140/graphics/B04610_05_24.jpg" /></div><p>You can create several<a id="id834" class="indexterm"></a> other conditions for different animations, such as jump, attack, damage, death, and so on. Usually, animations that are related to movements (running, jumping, and so on) use float or integer parameter type for its condition, whereas other types of animations that get played by triggering (attack, damage, death, and so on) usually use Boolean or trigger parameter type for its condition. You can learn more<a id="id835" class="indexterm"></a> about animation parameters from the Unity Manual at <a class="ulink" href="http://docs.unity3d.com/Manual/AnimationParameters.html" target="_blank">http://docs.unity3d.com/Manual/AnimationParameters.html</a>.</p><p>Once you have linked all the animation states together, the animator controller is now ready to be used by the character prefab! Select your character prefab and look for the <span class="strong"><strong>Animator</strong></span> component. By default, the <span class="strong"><strong>Controller</strong></span> option is empty. Drag the animator controller you created previously from the Project Browser directly to the <span class="strong"><strong>Controller</strong></span> option on the <span class="strong"><strong>Inspector</strong></span> window. Then, click on the <span class="strong"><strong>Apply</strong></span> button at the top of the <span class="strong"><strong>Inspector</strong></span> window to save your character prefab and it's now ready to be used! You will learn how you can change the parameters of the animation controllers and make it navigate between different <a id="id836" class="indexterm"></a>animation states in the next chapter because it has to be done via scripting.</p></div>