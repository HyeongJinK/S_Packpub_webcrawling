<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec35"></a>Scripting our game</h2></div></div><hr /></div><p>Before we dive into scripting our game, we <a id="id221" class="indexterm"></a>need to do a little planning. We will look at what we want to script and what events we want to trigger those scripts. We'll also determine what our data needs are. Since our game is relatively simple, this will not be a difficult set of tasks.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec40"></a>Script planning</h3></div></div></div><p>Let's review our game's design to <a id="id222" class="indexterm"></a>determine what needs to be scripted. We know that the primary action a user will take is to navigate the player character in the game environment. As you've already seen, this has been taken care of for us by Unity. This functionality is already in place with no other programming required.</p><p>We'll need to plan for events regarding the player gathering corn and water and feeding the animals.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec07"></a>Gathering corn</h4></div></div></div><p>We've designed our game so that the<a id="id223" class="indexterm"></a> player character can collect corn and feed it to the farm animals. The way we will accomplish this is to detect when the player character and the corn game objects collide. While that collision is taking place, if the player uses the <code class="literal">take</code> command, then corn will be gathered. The following flowchart shows this more clearly:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_10.jpg" /></div><p>So, we know that we have three scripting tasks to complete:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a collider so that we know when the player controller and corn stalk objects are colliding.</p></li><li><p>Give the player the<a id="id224" class="indexterm"></a> ability to evoke the <code class="literal">take</code> command. We'll program this to the <span class="emphasis"><em>T</em></span> keyboard button. If we were making this a game for mobile devices, we would need a non-keyboard solution.</p></li><li><p>Determine whether the player is using the <code class="literal">take</code> command while the collision is occurring.</p></li><li><p>Keep track of how much corn the player has.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec08"></a>Gathering water</h4></div></div></div><p>Gathering<a id="id225" class="indexterm"></a> water is similar to gathering corn. We'll use a listener to detect the collision and determine whether the player has evoked the <code class="literal">take</code> command. Then, we'll need to track how much water the player has.</p><p>Our scripting tasks for gathering water are:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a collider for the collision.</p></li><li><p>Determine whether the player is using the <code class="literal">take</code> command during the collision.</p></li><li><p>Keep track of how much water the player has.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec09"></a>Feeding piglets</h4></div></div></div><p>The game will start with 10<a id="id226" class="indexterm"></a> piglets on Colt's farm. In order for them to grow, they will need water and corn. We will not program any consequences for not feeding the piglets, but will not reward this inaction either. We will set our piglets to grow into adult pigs after they have been given five units of corn and five units of water.</p><p>The following diagram shows how the process will work:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_11.jpg" /></div><p>It might look like a complicated process, but feeding the piglets will be an easy scripting task.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec10"></a>Feeding baby chicks</h4></div></div></div><p>Feeding the baby <a id="id227" class="indexterm"></a>chicks will work exactly as the process works for the piglets. We'll let the baby chicks grow into adult chickens after they have 5 units of water and 5 units of corn.</p><p>For both sets of animals, we will handle the transformation from child to adult in the same manner. When a piglet has been given 5 units of corn and 5 units of water, we will reveal an adult pig at the same X, Y, and Z coordinates of the piglet. Then, we will hide the piglet. This will show a quick change. We'll do the same thing to turn a baby chick into an adult chicken.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec11"></a>Feeding pigs</h4></div></div></div><p>Once a piglet has been<a id="id228" class="indexterm"></a> transformed into an adult pig, the pig will start with a count of zero units of corn and zero units of water. The pig will need 10 units of corn and 10 units of water to become a blue ribbon pig. The pigs can consume water and corn beyond 10 units each, so we will not need to limit them.</p><p>Achieving blue ribbon status for a specific number of pigs and chickens will be the player's goal.</p><p>To script the feeding of the pigs, we'll mimic what we did for the piglets.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec12"></a>Feeding adult chickens</h4></div></div></div><p>Feeding adult chickens will work in the<a id="id229" class="indexterm"></a> same manner as for the adult pigs. Chickens will achieve blue ribbon status once they have been fed 10 units each of water and corn. Again, there will be no limit on their consumption.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec41"></a>Data requirements</h3></div></div></div><p>It is important for us to think about<a id="id230" class="indexterm"></a> what data requirements our game will require before we start programming. We start by conceptualizing at a high level. For example, we know we need to track information about the piglets, pigs, baby chicks, and adult chickens. Mainly, we need to know how much they consume. We also need to keep track of how much water and corn Colt gathers and has.</p><p>We'll take a closer look at our data requirements and decide what to name our variables.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec13"></a>All about the pigs</h4></div></div></div><p>There will be 10 piglets and 10 adult pigs. For each of those animals, we need to track how many units of corn and water they have been provided. The following table shows the ranges for each data element:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /><col align="left" /><col align="left" /></colgroup><thead><tr><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Animal</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Visible</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Corn</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Water</p>
</th></tr></thead><tbody><tr><td style="" align="left" valign="top">
<p>piglet1</p>
</td><td style="" align="left" valign="top">
<p>Y or N</p>
</td><td style="" align="left" valign="top">
<p>0, 1, 2, 3 . . .</p>
</td><td style="" align="left" valign="top">
<p>0, 1, 2, 3 . . .</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>pig1</p>
</td><td style="" align="left" valign="top">
<p>Y or N</p>
</td><td style="" align="left" valign="top">
<p>0, 1, 2, 3 . . .</p>
</td><td style="" align="left" valign="top">
<p>0, 1, 2, 3 . . .</p>
</td></tr></tbody></table></div><p>Based on what you learned earlier in this chapter, you can probably guess what types of data we'll use for each element. The visible element will be Boolean and the corn and water will be integers.</p><p>Since this data lends itself well to table, we will use two arrays. One array will be for piglets and the other for pigs. Because arrays use a single type of data, we'll use 0 and 1 to represent non-visible and visible instead of the Boolean data type. The first column will be the sequential number of the animal, so the values will be 0, 1, 2, 3, 4, 5, 6, 7, 8, and 9.</p><p>The second column will <a id="id231" class="indexterm"></a>indicate whether the piglet is visible. A zero (0) will indicate the piglet is not visible and a one (1) will indicate that the piglet is visible. The third and fourth columns will represent the number of units of corn and water respectively.</p><p>The following is how we will script the creation of the piglet array:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_12.jpg" /></div><p>Line 6 of the <span class="strong"><strong>Arrays</strong></span> script is how we create an array with 10 rows and three columns. Remember, arrays start with zero, so a 10 by 3 array would look as follows:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_13.jpg" /></div><p>In lines 10 through 15, we use a <code class="literal">for</code> loop to populate the array with initial data. We start by looping through each row of the array<a id="id232" class="indexterm"></a> starting with zero and ending with nine. Lines 12, 13, and 14 put values into the array. As you can probably see, the first column is set to one to indicate that the piglet is visible. The next two columns indicate that there is zero corn and zero water units.</p><p>To see this in action, you can add the following line in between the current lines 14 and 15:</p><div class="informalexample"><pre class="programlisting">Debug.Log ("Piglet " + i + "\t" + pigletArray[i,0] + "\t" + pigletArray[i, 1] + "\t" + pigletArray[i, 2]);</pre></div><p>When you save the script, you'll need to drag it to the <span class="strong"><strong>Main Camera</strong></span> option as we did earlier in this chapter. Now, let the game run and watch the output console. You'll notice that there are ten piglets, each with a "1" in the first column, followed by zeros in the remaining two columns:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_14.jpg" /></div><p>Now, let's modify the <span class="strong"><strong>Array</strong></span> script to<a id="id233" class="indexterm"></a> include the adult pigs as well. As you can see with the script in the following screenshot, we essentially replicated what we did for the piglet to take care of the pig-related data needs. We changed <code class="literal">pigletArray</code> to <code class="literal">pigArray</code> and set the second column to zero instead of one because the pigs will not initially be visible.</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_15.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec14"></a>Chicks and chickens</h4></div></div></div><p>Our baby chicks and adult chickens have the <a id="id234" class="indexterm"></a>same data requirements as their <span class="emphasis"><em>Suidae</em></span> farm companions. We'll replicate the lines of code we wrote for the piglets and pigs to take care of our feathered farm animals:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p><span class="emphasis"><em>Suidae</em></span> is the scientific name for the pig family.</p></div><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_16.jpg" /></div><p>We now have four arrays, one for each type of animal.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec15"></a>Corn and water</h4></div></div></div><p>Our game environment has an unlimited<a id="id235" class="indexterm"></a> amount of corn and water. When the player gathers corn, no corn is removed from the field. When the player gathers water, no water is actually removed from the river. In a more complex game, we might take a different approach.</p><p>So, we merely need to create integers for corn and water. Let's create a new script and name it <code class="literal">GameData</code>. You can enter the script based on the next screenshot and then attach it to the <span class="strong"><strong>Main Camera</strong></span> game object:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_17.jpg" /></div><p>On lines 6 and 7 of the script, we created<a id="id236" class="indexterm"></a> public integers of corn and water. We declared the variables and set their initial values with one line of code for each variable. By making these variables public, we can see and change the values in the <span class="strong"><strong>Inspector</strong></span> view:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_18.jpg" /></div><p>You can see that the arrays values are not accessible in the <span class="strong"><strong>Inspector</strong></span> view, but the <span class="strong"><strong>GameData</strong></span> values are. This is because we declared the <span class="strong"><strong>GameData</strong></span> variables of corn and water as public. The variables declared in the <span class="strong"><strong>Arrays</strong></span> script are private.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec16"></a>Initializing our data</h4></div></div></div><p>We have three basic groups of data for our game. The first set is for the piglets and adult pigs. The second set of data is for the baby chicks and adult chickens. Both of these data groups were scripted in the <span class="strong"><strong>Arrays</strong></span> script. Within that script, the data declarations and initial values were in the <code class="literal">Start</code> function, which means that part of the script will be executed when the object it is attached to is first initialized. Since that script is attached to the game's <span class="strong"><strong>Main Camera</strong></span> option, it will be run when the game first loads.</p><p>The corn and water variables, the third group of data, are set in the <code class="literal">Start</code> function of the <span class="strong"><strong>GameData</strong></span> script, which is also attached to the <span class="strong"><strong>Main Camera</strong></span> option.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>The <span class="strong"><strong>Inspector</strong></span> view shows script names differently than the <span class="strong"><strong>Project</strong></span> view. For example, we created a <span class="strong"><strong>GameData</strong></span> script and it is displayed in the <span class="strong"><strong>Project</strong></span> view correctly. In the <span class="strong"><strong>Inspector</strong></span> view, it shows up with a space in between the two words. All variables displayed in the <span class="strong"><strong>Inspector</strong></span> view will also show up with spaces. Do not be alarmed. Instead, just be aware. It has no impact on the game.</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec42"></a>Selective scripts</h3></div></div></div><p>You can download the full <a id="id237" class="indexterm"></a>game from the book's web page and review all of the game's scripts. In this section, I'll share several scripts from the game with some explanatory text to help you read the scripts.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec17"></a>Selective script – global variables</h4></div></div></div><p>The following script is the <code class="literal">GameData </code>script that we <a id="id238" class="indexterm"></a>previously created, but with some important changes. You'll remember that we attached this script to the <span class="strong"><strong>Main Camera</strong></span> option in the <span class="strong"><strong>Hierarchy</strong></span> view. Scripts must be attached to game objects or they will not be run.</p><p>This script sets up the water and corn variables so that they can be used globally. Each variable is first declared as a <code class="literal">private static int</code>, with an underscore preceding the variable name. These are our master variables. We can use <code class="literal">GameData.water</code> and <code class="literal">GameData.corn</code> to retrieve the current value of the variables.</p><p>To make a change to the variables, we can easily increment or decrement them by using a line of code such as <code class="literal">GameData.water = GameData.water +2;</code> or <code class="literal">GameData.water +=2;</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class GameData : MonoBehaviour {

    private static int _water = 0;
    private static int _corn = 0;

    public static int water 
    {
        get { return _water; }
        set { _water = value; }
    }

    public static int corn 
    {
        get { return _corn; }
        set { _corn = value; }
    }

}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec18"></a>Selective script – evoking the take animation</h4></div></div></div><p>Our plan was to enable the player <a id="id239" class="indexterm"></a>to use the <span class="emphasis"><em>T</em></span> (uppercase or lowercase) keyboard key to evoke the <code class="literal">take</code> animation. The following script does a couple of things to include detecting when the user pressed the <span class="emphasis"><em>T</em></span> keyboard key. That is done by using the conditional <code class="literal">if</code> attribute and evaluating <code class="literal">(Input.GetKeyDown (KeyCode.T))</code>.</p><p>If the player did press the <span class="emphasis"><em>T</em></span> key, the <code class="literal">take</code> animation is played. This is accomplished by first declaring the <code class="literal">anim</code> attribute as a variable type of <code class="literal">Animator</code>. Next, we create an integer named <code class="literal">takeHash</code> and set the value to the <code class="literal">take</code> animation with <code class="literal">= Animator.StringToHash ("Take")</code>. Now, we can simply reference the animation with <code class="literal">anim.Play (takeHash);</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class Take : MonoBehaviour {

    Animator anim;
    int takeHash = Animator.StringToHash ("Take");

    void Start () {
        anim = GetComponent&lt;Animator&gt; ();
    }

    void Update () {
        if (Input.GetKeyDown (KeyCode.T)) {
            anim.Play (takeHash);

            GameData.water = GameData.water +1;
            Debug.Log (GameData.water);
        }
    }
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec19"></a>Selective script – feeding the farm animals</h4></div></div></div><p>Our game will detect when the <a id="id240" class="indexterm"></a>player-controlled character, Colt, collides with an animal. To do this, we add a sphere collider to each animal. The following are the steps to accomplish that:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the farm animal in the <span class="strong"><strong>Hierarchy</strong></span> view.</p></li><li><p>From the top menu, navigate and select <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Sphere Collider</strong></span>. This will create a sphere around the animal.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> view, adjust the <span class="strong"><strong>Radius</strong></span> of the <span class="strong"><strong>Sphere Collider</strong></span> so that the animal is contained within the sphere, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_19.jpg" /></div></li><li><p>Next, in the <span class="strong"><strong>Sphere Collider</strong></span> section of the <span class="strong"><strong>Inspector</strong></span> panel, we need to select the <span class="strong"><strong>Is Trigger</strong></span> checkbox:</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_20.jpg" /></div></li><li><p>Now, we'll script the <a id="id241" class="indexterm"></a>collider. Create a new script with the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>C# Script</strong></span> menu selection. Name the script <code class="literal">FeedChicken</code>, or give it a more appropriate name if you have a different farm animal selected.</p></li><li><p>Edit the script so that it matches the following:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class FeedChicken : MonoBehaviour {

    void OnTriggerEnter(Collider other) {
        if (GameData.water &gt; 0) {
            GameData.water = GameData.water - 1;
            // add water to chicken's holdings
        }
        if (GameData.corn &gt; 0) {
            GameData.corn = GameData.corn - 1;
            // add corn to chicken's holdings
        }
    }
}
</pre></div></li><li><p>Our last step is to assign the script to the game object. With the animal object selected in the <span class="strong"><strong>Hierarchy</strong></span> view, navigate and select the <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Scripts</strong></span> | <span class="strong"><strong>Feed Chicken</strong></span> menu choice. This will assign the script to the game object. Previously, you did this by dragging the script from the <span class="strong"><strong>Project</strong></span> view onto the game object in the <a id="id242" class="indexterm"></a>
<span class="strong"><strong>Hierarchy</strong></span> view. Both methods work.</p><div class="mediaobject"><img src="/graphics/9781784398316/graphics/3852_05_21.jpg" /></div></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>You can program one each of the four farm animals and then duplicate them. This will save you a lot of time.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec20"></a>Organizing scripts</h4></div></div></div><p>If you are working on large game <a id="id243" class="indexterm"></a>projects, you might find the number of scripts difficult to manage. There are a couple of tactics you can use to keep your scripts manageable.</p><p>The first, and perhaps the easiest, approach is to simply create a scripts folder in <span class="strong"><strong>Project</strong></span> view and keep all of your scripts there. Of course, if you have several dozen or more scripts, you might want to use a folder structure to keep things even more organized.</p><p>A second approach is to preface each script file with an identifiable string, such as <code class="literal">script_</code>. With this schema, our <code class="literal">FeedChicken.cs</code> script would be named <code class="literal">script_FeedChicken.cs</code>.</p><p>In the <span class="strong"><strong>Project</strong></span> view, there is a list of four <span class="strong"><strong>Favorites</strong></span>, each proceeded with a search icon. Clicking on the <span class="strong"><strong>All Scripts</strong></span> favorites will result in a list of all scripts in the project.</p></div></div></div>