<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec54"></a>Putting it all together</h2></div></div><hr /></div><p>Let's test our<a id="id330" class="indexterm"></a> <code class="literal">DecisionMgr</code> class by integrating these custom conditions and responses into an NPC instance.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Find the NPC instance from earlier, and select the <code class="literal">npcScript</code> class.</p></li><li><p>Note that the <code class="literal">DecisonMgr</code> reference is embedded in the class (instead of waiting for a reference to the GameObject). Click on the triangle, and notice that you can see the public interactions list that this class contains. By setting the size member variable, we can design and tailor the interactions for this NPC's <code class="literal">DecisionMgr</code> to perfectly match our gameplay needs.</p></li><li><p>Click on the size field of the interactions list, and set it to <code class="literal">2</code>. We will have two interactions on this NPC.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_06_03.jpg" /></div></li><li><p>Click on the <span class="strong"><strong>Element 0</strong></span> field. Make sure its active checkbox is set to <code class="literal">true</code>; this ensures that this <a id="id331" class="indexterm"></a>interaction is always evaluated. Note that the <span class="strong"><strong>Condition</strong></span> and <span class="strong"><strong>Response</strong></span> fields are waiting for a reference to be set.</p></li><li><p>Drag-and-drop an instance of <code class="literal">condition_closerthanThresh</code>, and add it to the NPC.</p></li><li><p>Set the <code class="literal">thresh</code> to <code class="literal">15</code> units, the <code class="literal">trackObj</code> to the <code class="literal">npc</code>, and the <code class="literal">baseObj</code> to <code class="literal">Player</code>.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_06_04.jpg" /></div></li><li><p>Drag-and-drop this component from the NPC into the condition field of interaction of <span class="strong"><strong>Element 0</strong></span>. This associates this condition with the required interaction code. Note that if we forget to add the component to the <code class="literal">DecisionMgr</code> as we have done, the condition component will never get evaluated.</p></li><li><p>Drag-and-drop an instance of <code class="literal">response_changeState</code>, and add it to the NPC.</p></li><li><p>Set the NPC reference to the NPC that owns the component, and set the new state to <code class="literal">turnToPlayer</code>.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_06_05.jpg" /></div></li><li><p>Drag-and-drop this component from the NPC into the response field of the interaction of <span class="strong"><strong>Element 0</strong></span>. This associates the response with the required interaction code.</p></li><li><p>Drag-and-drop an instance of <code class="literal">condition_fartherThanThresh</code>, and add it to the NPC.</p></li><li><p>Set the <code class="literal">thresh</code> to <code class="literal">20</code> units, <code class="literal">trackObj</code> to the <code class="literal">npc</code>, and <code class="literal">baseObj</code> to <code class="literal">Player</code>.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_06_06.jpg" /></div></li><li><p>Drag-and-drop this component from the NPC into the condition field of the <span class="strong"><strong>Interaction</strong></span> tab <a id="id332" class="indexterm"></a>of <span class="strong"><strong>Element 1</strong></span>. This associates this condition with the second interactions code.</p></li><li><p>Drag-and drop-another instance of <code class="literal">response_setState</code> onto the NPC. Set the NPC to the parent NPC and the state to <code class="literal">patrol</code>.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_06_07.jpg" /></div></li></ol></div><p>Congratulations, we have configured the NPC <code class="literal">DecisionMgr</code> component to stop when it is close enough and turn to face the player. When the player leaves, the NPC will continue on its way. Adding further interactions to the NPC is as simple as increasing the size of the interactions array and creating the references.</p><p>Programming new interactions is a cinch, too! So long as we inherit from the correct base class, we see that gameplay code programming is now reduced to developing a library of query and interface classes. We no longer need to deal with the interactions and sequencing of logic, just the concrete behaviors themselves. This is a big win!</p></div>