<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec81"></a>Using the setupLevel3 Prefab</h2></div></div><hr /></div><p>The <code class="literal">setupLevel3</code> Prefab <a id="id481" class="indexterm"></a>will be activated when the <a id="id482" class="indexterm"></a>user presses the <code class="literal">popup_Level3Start</code> button. It will initialize the NPCs for the level, place them in random locations in the world, and set up the state tracking logic that determines if the player achieves success. Perform the following steps to use the <code class="literal">setupLevel3</code> Prefab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Locate the Prefab named <code class="literal">setupLevel2</code> beneath <code class="literal">_level2</code>, and rename it <code class="literal">setupLevel3</code>. Duplicate the <code class="literal">SetupMissionTwo</code> script from mission two, and rename the duplicate to <code class="literal">SetupMissionThree</code>. Place the duplicate in the folder named <code class="literal">Chapter9</code> to keep your assets organized.</p></li><li><p>Add an instance <a id="id483" class="indexterm"></a>of this script to the <code class="literal">setupLevel3</code> object.</p></li><li><p>Inside <code class="literal">MonoDevelop</code>, change the class declaration to <code class="literal">SetupMissionThree</code> so that it matches the name of the script as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class SetupMissionThree : MonoBehavior</pre></div></li><li><p>We will <a id="id484" class="indexterm"></a>use the same pattern to choose random NPC locators as we did for the QuizNpc locators in mission two. We will remove the <code class="literal">CorrectPopups</code> list, because each pop up will have a unique, correct pop up already associated with it in the editor.</p></li><li><p>At this point, open up <code class="literal">PopupPanel.cs</code>, and add the following line of code:</p><div class="informalexample"><pre class="programlisting">Public int id;</pre></div></li><li><p>This ID will be used by the pop up to locate the NPC that dispatched it so that its animation can be updated on success.</p></li><li><p>In <code class="literal">LEVEL3</code>, we note the successful pass condition is when 2,500 points have been earned in addition to the points from levels one and two. In order to determine this, we need to remember the score at the beginning of the level so that we can calculate the delta.</p></li><li><p>At the top of <code class="literal">SetupMissionThree</code>, add an <code class="literal">initialScore</code> variable of type <code class="literal">npcCondition</code>. Since the level's complete processing will be handled by <code class="literal">npcDecisionMgr</code>, we need to store the score in a datatype that this system can operate on:</p><div class="informalexample"><pre class="programlisting">public npcCondition initialScore;</pre></div></li><li><p>If a <code class="literal">Player</code> class can be found, extract the score from the <code class="literal">playerData</code> component, and store it in the <code class="literal">initialScore</code> component. Note that we need to cast the <code class="literal">npcComponent</code> base reference to <code class="literal">floatData</code> in order to access the <code class="literal">_floatData</code> member for storage.</p></li><li><p>The body of this method works in a manner similar to <code class="literal">SetupMissionTwo</code>, where it creates backups of the <code class="literal">QuizPrefab</code> and <code class="literal">SpawnPoint</code> lists. It diverges, however, when five random quiz cards are selected from the <code class="literal">QuizPrefab</code> list. We directly associate the <code class="literal">card</code> Prefab with the NPC to be instantiated as shown in the following code:</p><div class="informalexample"><pre class="programlisting">objectInteraction objInteraction = Npc.GetComponent&lt;objectInteraction&gt;();
  if (objInteraction)
    objInteraction.prefab = quizPrefab;</pre></div></li><li><p>We also pass the ID value from the <code class="literal">QuizPrefab</code> card into the ID of <code class="literal">QuizNpcHelper</code>. We use this later when the <code class="literal">CorrectAnswer</code> pop up looks up the NPC that instantiated the card. At that time, we locate the NPC by ID and then pass <code class="literal">doSuccess</code> into its animator to make it dance as done in level two.</p></li></ol></div><p>Congratulations! The <code class="literal">setupLevel3</code> Prefab is complete. We now have a class that will randomly pick a state quiz card and randomly spawn NPCs in the world to interact with the player.</p></div>