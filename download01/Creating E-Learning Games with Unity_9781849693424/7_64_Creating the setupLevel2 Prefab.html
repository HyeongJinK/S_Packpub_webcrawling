<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec64"></a>Creating the setupLevel2 Prefab</h2></div></div><hr /></div><p>The <a id="id382" class="indexterm"></a>
<span class="strong"><strong>setupLevel2</strong></span> Prefab <a id="id383" class="indexterm"></a>will be activated when the user presses the <span class="strong"><strong>start</strong></span> button on <span class="strong"><strong>popup_Level2Start</strong></span>. It will finish the initialization of the mission for the level in the <code class="literal">missionMgr</code> script. Let's perform the following steps to create the <span class="strong"><strong>setupLevel2</strong></span> Prefab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new Prefab named <span class="strong"><strong>setupLevel2</strong></span>. Duplicate the <code class="literal">SetupMissionOne</code> script from mission one, and rename the duplicate <code class="literal">SetupMissionTwo</code>. Add an instance to <span class="strong"><strong>setupLevel2</strong></span>.</p></li><li><p>Inside MonoDevelop, change the class declaration to <code class="literal">SetupMissionTwo</code> as shown in the following line of code:</p><div class="informalexample"><pre class="programlisting">public class SetupMissionTwo : MonoBehavior {</pre></div></li><li><p>We will use the same pattern for choosing random <code class="literal">QuizNpc</code> locators as we did for the flag locators in mission one. In addition to the <span class="strong"><strong>QuizNpc</strong></span> Prefabs and the <span class="strong"><strong>spawnPoints</strong></span> lists, add a list of <code class="literal">CorrectPopups</code> to the class.</p></li><li><p>This class<a id="id384" class="indexterm"></a> will hold the pop ups that are shown to the user when a correct answer is given for a particular quiz question. This will be populated by the user in the editor, and it will hold a number of unique pop ups, which will give the user a mission token when clicked through. We will store these unique pop ups in a list, as declared in the following line of code:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; CorrectPopups</pre></div></li><li><p>Add a public reference to <span class="strong"><strong>QuizNpc</strong></span> Prefab. This is the model (and eventually animations) for the <code class="literal">QuizNpc</code> class on the path giving the questions. Once the locations are randomly chosen, instances of this model will be placed around the track. This can be done with the following line of code:</p><div class="informalexample"><pre class="programlisting">public GameObject QuizNpc;</pre></div></li><li><p>We will also <a id="id385" class="indexterm"></a>keep a reference to the <code class="literal">raceStarterObj</code> so that we can enable it when the <code class="literal">setupLevel2</code> class is enabled.  This will have the effect of starting the racers' movement. This can be done with the following line of code:</p><div class="informalexample"><pre class="programlisting">public GameObject RaceStarterObj;</pre></div><p>This script works largely in the same way as <code class="literal">SetupMissionOne</code>, with some subtle changes due to the different design needs. As five random quiz cards are selected (rather than flags), we instantiate <code class="literal">QuizNpc</code> to stand that location:</p><div class="informalexample"><pre class="programlisting">GameObject QuizNpcInstance = (GameObject)Instantiate(QuizNpc, QuizPos, new Quaternion(0,0,0,1));</pre></div></li><li><p> As we loop over the selected questions, we hand off the correct answer pop up for each NPC question to the <code class="literal">QuizNpc</code> class itself. The NPC will then hand this off when the quiz question is actually activated (when player is close enough to NPC). The NPC stores the reference to the correct answer pop up through a <code class="literal">QuizNpcHelper</code> script attached to it as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">QuizNpcIstance.GetComponent&lt;QuizNpcHelper&gt;().SetPrefabReference( CorrectPopups[k]);
QuizNpcInstance.SetActive(true);</pre></div></li><li><p>We install the QuizCard itself into NPC's <code class="literal">ObjectInteraction</code> inside the Prefab member variable of the <code class="literal">setupLevel2</code> class. This allows <code class="literal">interactiveObject</code> to display the QuizCard when the player is close enough as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">ObjectInteraction oo = QuizNpc.GetComponent&lt;objectInteraction&gt;();
if (oo)
  oo.prefab = quizPrefab;</pre></div></li><li><p>Then we <a id="id386" class="indexterm"></a>add <code class="literal">MissionToken</code> from the current chosen pop up and add it to <code class="literal">missionTokens</code> of the mission for this level. This way, the mission can track the randomly chosen quiz questions from this method as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">mm.missions[0].tokens.Add(CorrectPopups[k].GetComponent&lt;MissionToken&gt;();</pre></div></li><li><p>Congratulations! <code class="literal">SetupMissionTwo</code> is finished. When the <span class="strong"><strong>setupLevel2</strong></span> Prefab is <a id="id387" class="indexterm"></a>enabled (by clicking on <span class="strong"><strong>Okay</strong></span> on <span class="strong"><strong>popup_Level2Start</strong></span>), the <code class="literal">setupMissionTwo</code> script will choose five random quiz locations from a group of ten and five random quiz cards from a group of 50. It will then place instances of <code class="literal">quizNpc</code> at each location for the player to interact with.</p></li></ol></div></div>