<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec26"></a>Implementing the core classes for mission one</h2></div></div><hr /></div><p>In this chapter, we will start<a id="id155" class="indexterm"></a> creating mission one, which presents US geography to the player (state name, flag, and trivia). Let's begin by creating the classes and <code class="literal">GameObject</code> instances for this level. To begin, create a new scene file and name it <code class="literal">TESTBED</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec20"></a>Creating a terrain</h3></div></div></div><p>Let's create a<a id="id156" class="indexterm"></a> nice<a id="id157" class="indexterm"></a> terrain mesh to replace the ground plane from the previous two levels. With this, we can create a nice-looking mesh for the ground that resembles a park with grass, mountains, and trees by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Assets</strong></span> menu, navigate to <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Terrain Assets</strong></span>. Click on the <span class="strong"><strong>Import</strong></span> button on the pop-up window that appears next to bring a library of models and textures into Unity for use with the terrain editor.</p></li><li><p>To create a terrain mesh, let's navigate to <span class="strong"><strong>CreateOther</strong></span> | <span class="strong"><strong>Terrain</strong></span>, from the <span class="strong"><strong>GameObject</strong></span> drop-down list.</p></li><li><p>On<a id="id158" class="indexterm"></a> the <a id="id159" class="indexterm"></a>
<span class="strong"><strong>Set Heightmap resolution</strong></span> pop up that appears, configure the parameters to the following values:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Terrain Width</strong></span>, <span class="strong"><strong>Terrain Length</strong></span>: The horizontal dimensions of the terrain mesh. Set both to <code class="literal">500</code> units.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Terrain Height</strong></span>: The maximum height of the terrain (for mountains and so on). Set this to <code class="literal">500</code> units.</p></li><li style="list-style-type: disc"><p>The remaining parameters control the resolution of the textures that are painted onto the terrain. Keep these at their defaults.</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_02.jpg" /></div></li><li><p>Click on the new terrain GameObject in the <span class="strong"><strong>Hierarchy</strong></span> view, set its position to <code class="literal">-250, 0, -250</code>. This will place the terrain in the 3D world at a convenient location that results in the middle of the terrain at the world origin, which is convenient for development.</p></li><li><p>Clicking on the new terrain, observe the seven unique radio buttons on the terrain component in the inspector tab as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_03.jpg" /></div></li><li><p>The first one from left-hand side will raise or lower terrain depending on if <span class="emphasis"><em>Shift</em></span> or <span class="emphasis"><em>Ctrl</em></span> are held down while clicking and moving the mouse. Zoom out in the scene view; select one of the many interesting brushes; and try creating some mountains. Note the effect that brush size and opacity has on the deformations to the terrain.</p></li><li><p>The <a id="id160" class="indexterm"></a>second<a id="id161" class="indexterm"></a> button allows you to paint to a certain height. This is good for fine control of elevation in a terrain mesh if you want to build very specific configurations of plateaus.</p></li><li><p>The third button is the smooth height button. Use this if you have previously painted some elevations with a brush that has lots of bumps and jagged edges. This brush will average and round out the selected peaks.</p></li><li><p>The fourth button is the paint textures button. If you navigate to <span class="strong"><strong>Edit Textures</strong></span> | <span class="strong"><strong>Add Texture</strong></span>, you can select a texture from any of the imported textures in the project thus far. Click on the texture viewer panel (rather than the normal map panel) to see a dialog box of all available options. After selecting and confirming, you will see your selection as an option back in the terrain previewer. Now, with your favorite brush selected, you can paint the texture onto your terrain. Add a variety of textures to paint grass, roads, and mountain details into your terrain.</p></li><li><p>The next button lets you paint tree models into your scene. Select a tree model from the edit trees button, and once you have confirmed a selection, choose a brush and density to paint the models with. A low-density circle can be used to add foliage to the tops of your mountain ranges. If you find that your game suddenly runs slowly after painting trees, it likely means you have too many tree models on screen. The fix for this is to reduce the density of the trees.</p></li><li><p>The second from the right-hand side button lets you paint the details into your scene. The workflow is similar to painting trees, and they behave similarly as well although this is intended for small details such as grass.</p></li><li><p>The right-most button lets you control the parameters of your terrain component. Things such as wind-speed, draw distances, and grass color let you fine-tune the look of your park.</p></li></ol></div><p>Once you have finished <a id="id162" class="indexterm"></a>making your park, it should look somewhat like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_04.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec21"></a>Creating the FlagLocators GameObject</h3></div></div></div><p>Let's <a id="id163" class="indexterm"></a>create the<a id="id164" class="indexterm"></a> hierarchy for <code class="literal">FlagLocators</code> in the scene as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create 10 <span class="strong"><strong>Cube</strong></span> GameObjects. Place them in a variety of interesting places, well spaced out in the level. Put some of them on the ground, some in the hills, some on the mountains, and so on. Name these <code class="literal">FlagLocator1</code> to <code class="literal">FlagLocator10</code>.</p></li><li><p>Disable all of the mesh renderers to make these objects invisible in the rendered scene. We will leave these components attached for debugging, but we don't want to draw them normally. Should we want to see where these locators are later on, we just need to enable the renderers to show the geometry.</p></li><li><p>Create another empty <code class="literal">GameObject</code>, and name it <code class="literal">FlagLocators</code>. Drag-and-drop all of the locators from step one underneath this object.</p></li></ol></div><p>Congratulations! We now have a data collection of potential places for flags to spawn in mission one. We will select five of these in the <code class="literal">SetupMissionOne</code> script discussed in the following section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec22"></a>Creating the FlagMonument GameObject</h3></div></div></div><p>Let's <a id="id165" class="indexterm"></a>build <a id="id166" class="indexterm"></a>the geometric structure that will be the focal point of the first missionâ€”the monument that needs the flags returned by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <span class="strong"><strong>Cube</strong></span> GameObject. Scale it so that it is a long and narrow rectangle on the ground in a central place. Name this monument.</p></li><li><p>Create five short <span class="strong"><strong>Cylinder</strong></span> GameObjects. Name them <code class="literal">FlagMount1</code> to <code class="literal">FlagMount5</code>, and parent them to the monument so that they are on top of the monument.</p></li><li><p>This should look very similar to the <code class="literal">FlagLocators</code> in the <span class="strong"><strong>Hierarchy</strong></span> pane seen previously, but we will also create a <code class="literal">MonumentMgr</code> class and extend its functionality.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec02"></a>Creating the MonumentMgr Script</h4></div></div></div><p>This script <a id="id167" class="indexterm"></a>provides <a id="id168" class="indexterm"></a>the API for the inventory to attach items to the flag mounts at the conclusion of the level.</p><p>The <code class="literal">InventoryMgr</code> script that we will write in this chapter, will use the methods provided in the <code class="literal">MonumentMgr</code> script to do this work by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script, and name it <code class="literal">MonumentMgr.cs</code>. Attach an instance of it to the monument <code class="literal">GameObject</code>.</p></li><li><p> Inside the script, add <code class="literal">public List&lt;GameObject&gt;</code> to store the mount points as shown in the following code. Don't forget to add <code class="literal">using System.Collections.Generic</code> to the top of the file so that we can declare list properties. Failure to add this line of code will result in compile time errors in your script:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; mountPoints;</pre></div></li><li><p>Drag-and-drop the individual flag mount points from the monument to this list.</p></li><li><p>We add an <code class="literal">attachObjToMountPoint(GameObject obj, int index)</code> public method as shown in the following code. We first create an instance or clone of the object passed in, attach the object to the given <code class="literal">mountpoint</code>, and then zero its local translation and rotation. Doing this forces the object to have the same position and angle as <code class="literal">mountpoint</code> it is attached to, specifically a zero position and rotation offset relative to <code class="literal">mountpoint</code>. But remember, order is the key here!</p><div class="informalexample"><pre class="programlisting">public void attachObjToMountPoint(GameObject go, int index)
{
  GameObject newGo = (GameObject)Instantiate (go, 
    mountPoints[index].transform.position, 
    mountPoints[index].transform.rotation);
  newGo.SetActive(true);
  newGo.transform.parent = mountPoints[index].transform;
  newGo.transform.localPosition = Vector3.zero;
  newGo.transform.localEulerAngles = 
    Vector3.zero;//mount.transform.eulerAngles;
}</pre></div></li></ol></div><p>Congratulations! The <a id="id169" class="indexterm"></a>monument system is now complete. We will interface with this script in a later mission logic.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec23"></a>Creating the InventoryPlaceOnMonument class</h3></div></div></div><p>This class<a id="id170" class="indexterm"></a> loops<a id="id171" class="indexterm"></a> over all the flags in the inventory and places them on the monument. It loops over all the items and then attaches each one to each successive mount point. This can be created by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <code class="literal">InventoryPlaceOnMonument.cs</code> script. This will be attached to a new Prefab for instancing later.</p></li><li><p>This script will cache a copy of the inventory manager by finding the <code class="literal">GameObject</code> named <code class="literal">Player</code> and then by getting and storing a reference to the <code class="literal">inventoryMgr</code> component.</p></li><li><p>This script also caches a copy of monument so that it can interface with the <code class="literal">monumentMgr</code> class defined previously.</p></li><li><p>In the update loop, this script will take an object from the inventory of index <code class="literal">objectIndex</code>, remove it from the inventory, and set it to active so that it will render again as shown in the following code:</p><div class="informalexample"><pre class="programlisting">GameObject go = 
  inventoryMgr.inventoryObjects[objectIndex].item;
go.SetActive (true); </pre></div></li><li><p>If there is a cached monument object in the scene, it will then call <code class="literal">attachObjToMountPoint</code> and attach this <code class="literal">inventoryObject</code> to the flag mount using the following code:</p><div class="informalexample"><pre class="programlisting">_monument.GetComponent&lt;MonumentMgr&gt;().attachObjToMountPoint
  (go, objectIndex);</pre></div></li></ol></div><p>Congratulations! You now have written the system that will be used to move the flags from the inventory to the monument at the end of the mission. This script will be attached to a Prefab that we will instance once the second mission is complete.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec24"></a>Creating the MissionMgrHelper script</h3></div></div></div><p>This<a id="id172" class="indexterm"></a> script<a id="id173" class="indexterm"></a> searches through the mission manager and finds a mission by name. Once it finds it, it updates the visible and enabled flags on the mission. This is used to activate the second half of level one's objectives once the first half of the objectives are completed. This script can be created as shown in the following code:</p><div class="informalexample"><pre class="programlisting">  using UnityEngine;
  using System.Collections;

  public class missionMgrHelper : MonoBehaviour {
public string MissionName;
public bool setActivated;
public bool setVisible;
private MissionMgr _missionMgr;

// Use this for initialization
void Start () {

    _missionMgr = GameObject.Find("Game").GetComponent&lt;MissionMgr&gt;();
}
  
// Update is called once per frame
void Update () {

    for ( int i = 0 ; i &lt; _missionMgr.missions.Count; i++)
    {
      Mission   m = _missionMgr.missions[i];
      if (m.displayName == MissionName)
      {
        m.activated = setActivated;
        m.visible = setVisible;
      }
    }
}

}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec25"></a>Creating the TriviaCardScript script</h3></div></div></div><p>This helper <a id="id174" class="indexterm"></a>script <a id="id175" class="indexterm"></a>will be attached to all GUITexture pop ups used in this level, the <code class="literal">flaginfo</code> cards, and the user pop ups that happen when the mission's complete. It centers a texture on screen and scales it to the given dimensions.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To draw the texture centered on the screen, we start by calculating the center of the screen, and then we offset by half the size of the texture. The reason we do that is because we draw the texture relative to the upper-left corner.</p></li><li><p>The middle of the screen is assigned using the following code:</p><div class="informalexample"><pre class="programlisting">(ScreenWidth/2.0f, ScreenHeight/2.0f) </pre></div></li><li><p>The upper-left corner of the texture, relative to the center of the screen, is assigned using the following code:</p><div class="informalexample"><pre class="programlisting">(((ScreenWidth/2.0f) â€“ (textureWidth/2)), 
  ((ScreenHeight/2.0f) â€“ (textureHeight/2.0f)))</pre></div><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_05.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec26"></a>Creating the SetupMissionOne script</h3></div></div></div><p>This class is <a id="id176" class="indexterm"></a>used on<a id="id177" class="indexterm"></a> level startup to configure the world with a random selection of flags for gameplay. This class picks five flags at random and five locations at random. It instances those five flags at those random locations. It also configures the two missions that this level will<a id="id178" class="indexterm"></a> use to achieve the first learning objective. It is created by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>This script will require six individual lists to accomplish its task. Three of them for picking five flags from 50 potential options and three for picking five locations from a set of 10 options.</p></li><li><p><code class="literal">flagPrefabs</code> holds all 50 flag Prefabs. This is populated once at design time in the editor as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; flagPrefabs;</pre></div></li><li><p><code class="literal">flagPrefabsBackup</code> is a copy of the previous list. This occurs once when the game is run. The backup will be used to restore the <code class="literal">flagPrefabs</code> list if the mission is restarted as shown in the following code:</p><div class="informalexample"><pre class="programlisting">private List&lt;GameObject&gt; flagPrefabsBackup; </pre></div></li><li><p><code class="literal">FlagInstances</code> is the list of five unique, selected <code class="literal">flagPrefabs</code>. This list is populated from the <code class="literal">flagPrefab</code> list by choosing an index at random, removing the <code class="literal">GameObject</code> in the list <code class="literal">flagPrefabs</code> at that slot, and adding it to the <code class="literal">flagInstances</code> list as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; flagInstances; </pre></div></li><li><p><code class="literal">spawnPoints</code> is a list that holds the 10 potential spawn locations for flags in this level as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; spawnPoints; </pre></div></li><li><p><code class="literal">spawnPointsBackup</code> is a copy of the previous list. This occurs once when the game is run. The backup will be used to restore the <code class="literal">spawnPoints</code> list if the mission is restarted as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; spawnPointsBackup; </pre></div></li><li><p><code class="literal">activeSpawnPoints</code> is the list of five unique, selected <code class="literal">SpawnPoints</code>. This list is populated from the <code class="literal">spawnpoints</code> list by choosing an index at random, removing the <code class="literal">GameObject</code> in the <code class="literal">SpawnPoints</code> list, slow, and adding it to the <code class="literal">activeSpawnPoints</code> list as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public List&lt;GameObject&gt; activeSpawnPoints; </pre></div></li><li><p>Once the lists of selected <code class="literal">spawnpoints</code> and <code class="literal">flagprefabs</code> are filled, the script initializes two missions.</p></li><li><p>The first one to be acquired is set to visible and active as shown in the following code:</p><div class="informalexample"><pre class="programlisting">Mission m = missionManager.missions[0];
m.activated = true; 
m.visible = true; 
m.status = mission.missionStatus.MS_Acquired; </pre></div></li><li><p>It is also given a <code class="literal">displayName</code> and <code class="literal">description</code> as shown in the following code:</p><div class="informalexample"><pre class="programlisting">m.displayName = "MissionOne"; 
m.description = "collect the 5 randomly placed flags"; </pre></div></li><li><p>For this mission, <a id="id179" class="indexterm"></a>we instance the five selected flags, place them at the selected <code class="literal">spawnpoint</code>, and add them to the <code class="literal">MissionMgr</code>. Then we add the five <code class="literal">MissionToken</code> script instances (one from each flag Prefab instance) to the mission. This associates picking up each flag instance with the objectives of the first mission as shown in the following code:</p><div class="informalexample"><pre class="programlisting">Vector3 flagPos = activeSpawnPoints[k].transform.position; 
GameObject flagInstance = (GameObject)Instantiate 
  (flagPrefab, flagPos, new Quaternion(0.0f, 0.0f, 0.0f, 
  1.0f)); 
m.tokens.Add (flagInstance.GetComponent&lt;missionToken&gt;()); </pre></div></li><li><p>The second mission is set acquired, visible, and active as shown in the following code:</p><div class="informalexample"><pre class="programlisting">m.activated = false; 
m.visible = false; 
m.status = mission.missionStatus.MS_Acquired; </pre></div></li><li><p>It is also given a <code class="literal">displayName</code> and <code class="literal">description</code> as shown in the following code:</p><div class="informalexample"><pre class="programlisting">m.displayName = "MissionTwo"; 
m.description = "return the flags to the flagstand"; </pre></div></li><li><p>All of the <code class="literal">MissionTokens</code> from mission one are added to mission two as well. Since mission two starts with one <code class="literal">MissionToken (id=10)</code> in the inspector, the total number of tokens for mission two is equal to six. This last token corresponds to the user taking the five flags back to the monument (the monument gives the user this final flag to complete the mission) as shown in the following code:</p><div class="informalexample"><pre class="programlisting">m.tokens.AddRange (missionManager.missions[0].tokens); </pre></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec27"></a>Creating the flag Prefabs</h3></div></div></div><p>As this mission <a id="id180" class="indexterm"></a>revolves <a id="id181" class="indexterm"></a>around finding state flags, let's build a generic Prefab that we can texture with different flag imagery, creating a database of objects to choose from.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To get started, let's create a cylinder and set it's scale to (<code class="literal">0.5</code>, <code class="literal">3.2</code>, <code class="literal">0.5</code>). Create a dark-grey material, and apply it to the cylinder and name it <code class="literal">Pole</code>.</p></li><li><p>Create a sphere, scale it to (<code class="literal">1.5</code>, <code class="literal">0.2</code>, <code class="literal">1.5</code>). Place it on top of the pole and parent it to the cylinder object. Create a yellow material and apply it to the texture as seen in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_06.jpg" /></div></li><li><p>Create an interactive cloth object, and orient it by 270 degrees on the <span class="emphasis"><em>x</em></span> axis. Scale it to (<code class="literal">1, 0.3, 0.08</code>). Parent it to the pole, and set its local position to (<code class="literal">5.8, 0.4, 0</code>). This is a GameObject with script attached that simulates the natural motion of cloth under the influence of external forces. We will use this to build nice-looking flags for the states that respond to gravity, wind, and the player's interactions.</p></li><li><p>Create two <a id="id182" class="indexterm"></a>more spheres, scaled down to (<code class="literal">0.4, 0.07, 0.4</code>). Position these on the pole to act as mount points for the interactive cloth. The cloth will attach at these points to the pole. Disable their mesh renderer so that you cannot see them once they are placed correctly (overlapping the interactive cloth). Make sure that these two spheres have a rigid body component so that they can anchor the interactive cloth properly.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_07.jpg" /></div></li><li><p>Create a new, empty <span class="strong"><strong>GameObject</strong></span>, and name it <code class="literal">MissionMgr</code>. Attach the <code class="literal">MissionMgr</code> script to this object. We purposely detach this script from the player because the lifespan of <code class="literal">MissionMgr</code> may differ from the player object.</p></li></ol></div><p>Now that we have <a id="id183" class="indexterm"></a>added our flag <a id="id184" class="indexterm"></a>geometry, let's create some interactive objects to collect and interact with. As there are 50 states, let's start with Alabama and repeat the following steps for every other state, modifying the textures and state names as appropriate:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a sphere and place it on the ground plane. Name it <code class="literal">Flagpole_Alabama</code>, and disable the mesh renderer component. On the sphere collider, check the <span class="strong"><strong>IsTrigger</strong></span> checkbox so that we can detect when the player enters the object.</p></li><li><p>Add a <code class="literal">CustomGameObject</code> script to this object. Set the display name to <code class="literal">Alabama</code> and the object type to <code class="literal">flag</code>.</p></li><li><p>Add a mission token script to this object. Set <code class="literal">id=501</code>, title to <code class="literal">token</code>, and the description to <code class="literal">mission 1 token</code>.</p></li><li><p>Add an <code class="literal">InteractiveObj</code> script to this object. Set the <span class="strong"><strong>rotAxis</strong></span> to (<code class="literal">0,1,0</code>) to make the object rotate horizontally about the <span class="emphasis"><em>y</em></span> axis. Set the <span class="strong"><strong>rot Speed</strong></span> to <code class="literal">40</code> for a gentle rotation.</p></li><li><p>Add an object interaction script to this object. Set the interaction to <code class="literal">putInInventory</code>. Set the interaction type to <code class="literal">Unique</code>. Point the text to the Alabama state flag texture.</p></li><li><p>Drag-and-drop this <code class="literal">GameObject</code> into the <code class="literal">OnCloseEnough</code> variable of the <code class="literal">InteractiveObject</code> component. This will connect this reference to the <code class="literal">ObjectInteraction</code> component on the <code class="literal">GameObject</code> itself.</p></li><li><p>Add an external force of (<code class="literal">1.7</code>, <code class="literal">0</code>, <code class="literal">0</code>) and a random force of (<code class="literal">2</code>, <code class="literal">2</code>, <code class="literal">2</code>) to the interactive cloth to make the flag flap in the breeze. Consider experimenting with the external force and random force properties of the <code class="literal">InteractiveCloth</code> script to explore the various different flag behaviors that can be achieved.</p></li></ol></div><p>We now<a id="id185" class="indexterm"></a> have a <a id="id186" class="indexterm"></a>Prefab that we can customize for each state flag. Note the nice animation on the flag when the player walks by it. Let's create 50 Prefabs by applying the correct texture to the interactive cloth component and then dragging the hierarchy into the project tab. Let's also add the following script instances to each Prefab.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p><code class="literal">CustomGameObject</code>: Set the object type to <code class="literal">flag</code>, name it according to the state, and add a reference to the info card for this flag; the info card will show up when the inventory is clicked on, telling the user about the flag, the state name, and some trivia.</p></li><li><p>Add an <code class="literal">InteractiveObj</code> script, leaving everything as zero except for the reference to <code class="literal">ObjectInteraction</code> (also an instance on the <code class="literal">flag</code> Prefab).</p></li><li><p>Add an <code class="literal">ObjectInteraction</code> script to this object, and connect the reference to the <code class="literal">InteractiveObj</code> script. Set its parameters to <code class="literal">PutInInventory</code> and <code class="literal">Unique</code>, and set the texture to the state flag texture; the text will be the icon that shows up in the inventory when this item is collected.</p></li><li><p>Add a <code class="literal">MissionToken</code> script. Name the token the same as the state, and give each flag a unique ID ranging from 0 to 50.</p></li></ol></div><p>Congratulations! Once you have done this 50 times (it may take a while), you will have 50 state flag Prefabs. These should then be added to the <code class="literal">flagPrefabs</code> list in the <code class="literal">SetupMissionOne</code> script.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec28"></a>Creating the pop-up card Prefabs</h3></div></div></div><p>This game<a id="id187" class="indexterm"></a> level communicates the learning objectives to <a id="id188" class="indexterm"></a>the player through the information cards. This information will be baked onto a single texture in your favorite external pixel art program. When the player picks up a flag, or presses on the flag button in the inventory, a pop-up card for the relevant state is displayed as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_08.jpg" /></div><p>The pop-up card Prefabs<a id="id189" class="indexterm"></a> can be created by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a <a id="id190" class="indexterm"></a>new <code class="literal">GUITexture</code> object, and name it <code class="literal">popup_&lt;statename&gt;</code>.</p></li><li><p>Drag-and-drop an instance of the <code class="literal">TriviaCardScript</code> to the <span class="strong"><strong>GameObject</strong></span>. Set the card width and height to <code class="literal">320,320</code>.</p></li><li><p>Drag-and-drop an instance of <code class="literal">SimpleLifespanScript</code> to the <span class="strong"><strong>GameObject</strong></span>. Set the seconds parameter to <code class="literal">4</code>. This will make sure that if the information card disappears, it does not matter if you toggle it off from the inventory or if the user just lets it time out naturally.</p></li><li><p>Repeat steps 1 to 3 for each of the 50 states.</p></li><li><p>Drag-and-drop a reference to each of these Prefabs to the appropriate <code class="literal">flagObject</code> Prefab. Note that the reference for the game information pop up is in the <code class="literal">CustomGameInfo</code> component of the <code class="literal">flag</code> object.</p></li></ol></div><p>Congratulations! You have now created the learning content for the first level of the game. If you need to update these, simply edit the textures in your pixel art program, and Unity3D will naturally update the code and Prefabs.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_11.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec29"></a>Creating the mission pop-up Prefab</h3></div></div></div><p>These<a id="id191" class="indexterm"></a> game<a id="id192" class="indexterm"></a> missions communicate their state to the user through pop ups. We need to create two more special purposes dialog boxes that the game will use to reward the user and to inform the user of what the next objective is in the game. The first one, named <code class="literal">returnFlagsToMonument</code>, communicates to the user that they have all five flags and should walk back to the monument to finish. The second one, named <code class="literal">Level1Done</code>, communicates that the level is done and that the next level will load.</p><p>We can create a mission pop-up Prefab by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <code class="literal">GUITexture</code> object, and name it <code class="literal">returnFlagsToMonument</code>.</p></li><li><p>Drag-and-drop an instance of the <code class="literal">TriviaCardScript</code> to the GameObject. Set the card width and height to <code class="literal">320,320</code>.</p></li><li><p>Drag-and-drop an instance of the <code class="literal">TriviaCardScript</code> to the GameObject. Set the card width and height to <code class="literal">320,320</code>.</p></li><li><p>Drag-and-drop an instance of <code class="literal">SimpleLifespanScript</code> to the GameObject. Set the seconds parameter to <code class="literal">4</code>. This will make sure the pop up disappears after it times out.</p></li><li><p>Repeat steps 1 to 3 for another texture named Level1Done.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_09.jpg" /></div></li></ol></div><p>Congratulations! These two Prefabs will be used to communicate the user's progress through the learning <a id="id193" class="indexterm"></a>objectives<a id="id194" class="indexterm"></a> in level one. Create Prefabs by dragging-and-dropping these GameObjects to the project tab. We will place these Prefabs into the <code class="literal">missionMgr</code> script to finish configuring the level.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec30"></a>Creating the mission reward Prefabs</h3></div></div></div><p>By exploiting the <a id="id195" class="indexterm"></a>fact <a id="id196" class="indexterm"></a>that a <code class="literal">GameObject</code> Prefab can contain any number of sub-objects in the hierarchy, we can create Prefabs with any number of results to be achieved in the world when a mission is complete. We will use this fact to aggregate and pack together all of the results we want to achieve when the user accomplishes their goals. We will use this fact to construct a reward for when the flags are all found and a separate reward for when the flags are returned to the monument.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec31"></a>Creating the FoundAllTheFlags Prefab</h3></div></div></div><p>The <a id="id197" class="indexterm"></a>
<code class="literal">FoundAllTheFlags</code> Prefab <a id="id198" class="indexterm"></a>can be created by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <code class="literal">GUITexture</code> object, and name it <code class="literal">returnFlagsToMonument</code>.</p></li><li><p>Drag-and-drop an instance of the <code class="literal">returnFlagsToMonument</code> Prefab to this object.</p></li><li><p>Create a new <span class="strong"><strong>Cube</strong></span> GameObject, and name it <code class="literal">FlagReturnTriggerObj</code>. This object will be an invisible <code class="literal">InteractiveObj</code> class that will (on being picked up by the user), add the final token to the inventory, which will satisfy the second mission in the level.</p></li><li><p>Scale <a id="id199" class="indexterm"></a>and <a id="id200" class="indexterm"></a>position it so that it rests on top of the monument. Give it a large height, and make it about 15 percent wider and deeper than the monument itself. Add this object to the <code class="literal">FoundAllTheFlags</code> object.</p></li><li><p>Disable the mesh renderer on this object so that we no longer see it.</p></li><li><p>Add <code class="literal">MissionToken</code> to this object, give it an ID of <code class="literal">10</code>. Give it a title <code class="literal">ReturnToBase</code> and an appropriate description, such as <code class="literal">Returns Flags To Base</code>.</p></li><li><p>Add an object interaction script. Set the interaction to <code class="literal">AddMissionToken</code>, and set the <span class="strong"><strong>interactionType</strong></span> to <code class="literal">Unique</code>.</p></li><li><p>Add an <code class="literal">InteractiveObj</code> class, and set the <code class="literal">OnCloseEnough</code> script reference to the <code class="literal">ObjectInteractionScipt</code> from this object!</p></li><li><p>Drag this object to the project tab to create a Prefab from it.</p></li></ol></div><p>Congratulations! Now, when this parent object (<code class="literal">FoundAllTheFlags</code> Prefab) is instantiated, the following will occur:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">returnFlagsToMonument</code> Prefab will be instantiated. This object will detach itself from the parent and display the pop-up GUITexture for a few seconds before destroying itself.</p></li><li style="list-style-type: disc"><p>The <code class="literal">FlagReturnTriggerObj</code> Prefab will be instantiated. This invisible object will sit at the top of the monument. When the user walks back to the monument, this will result in a new mission token being collected, which will activate the second mission and complete the level!</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec32"></a>Creating the ReturnedTheFlagsResult Prefab</h3></div></div></div><p>One other <a id="id201" class="indexterm"></a>Prefab is <a id="id202" class="indexterm"></a>needed to finish the logic for level one. This Prefab will be instantiated once the user has gotten all the five objects and returned them to the monument.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new, empty <span class="strong"><strong>GameOobject</strong></span>, place it at (<code class="literal">0,0,0</code>), and name it <code class="literal">ReturnedTheFlagsResult</code>.</p></li><li><p>Add an instance of the <code class="literal">Level1Done</code> Prefab (that displays the pop-up dialog box for level completed) as a child of <code class="literal">ReturnedTheFlagsResult</code>.</p></li><li><p>Create a new, empty <span class="strong"><strong>GameObject</strong></span>, name it <code class="literal">InventoryPlaceAllFlags</code>, and add it as a child of <code class="literal">ReturnedTheFlagsResult</code>.</p></li><li><p>Add five instances of the <code class="literal">InventoryPlaceOnMonument</code> script to this object. Set each one to a unique <code class="literal">ObjectIndex</code> from <span class="strong"><strong>0</strong></span> to <span class="strong"><strong>4</strong></span>. This will remove a single object from the inventory and attach it to the monument at the flag mount of the same index.</p></li><li><p>Drag<a id="id203" class="indexterm"></a> this Prefab back into the project tab to make a Prefab from this compound object.</p></li></ol></div><p>Congratulations! Now <a id="id204" class="indexterm"></a>when this parent object (<code class="literal">ReturnedTheFlagsResult</code>) is instantiated, the following will occur:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The pop-up Prefab will be instantiated. This object will detach itself from the parent, and display the pop-up GUITexture for a few seconds before destroying itself.</p></li><li style="list-style-type: disc"><p>The <code class="literal">FlagReturnTriggerObj</code> Prefab will be instantiated. This invisible object will sit at the top of the monument. When the user walks back to the monument, it will result in a new mission token being collected, which will activate the second mission and complete the level!</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec33"></a>Configuring the mission manager</h3></div></div></div><p>Before we<a id="id205" class="indexterm"></a> can test our game level, we need to configure the <code class="literal">MissionMgr</code> class. This class acts as the dispatcher and gate for the dynamic behavior of the game logic. It can be configured by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Ensure that there are two missions in <code class="literal">MissionMgr</code>; the size of the missions list in the mission manager is equal to 2.</p></li><li><p>Generally, the default values inside a mission don't really matter (since we set them up in custom scripts such as <code class="literal">SetupMissionOne.cs</code>; however, some values need to be preconfigured).</p></li><li><p>In the second mission (mission one), make sure that the token array is of size 1, and has a reference to the <code class="literal">FlagReturnTriggerObj</code> mission token on the <code class="literal">InteractiveObject</code> class that is sitting on top of the <code class="literal">MissionMgr</code> script.</p></li><li><p>In the first mission, set the reward reference variable to the <code class="literal">foundtheflagresult</code> Prefab in the project tab.</p></li><li><p>In the second mission, set the reward reference variable to the <code class="literal">returnedtheflagsresult</code> Prefab in the project tab.</p></li></ol></div><p>And that's it! Now when these two missions are finished, those Prefabs will be instanced, causing pop ups to appear and time out, and causing other interactions with the inventory and missions systems as discussed previously.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec34"></a>Playing the level!</h3></div></div></div><p>We can test our work now by playing the level! <a id="id206" class="indexterm"></a>Drive the player around the level to find the five missing flags. Once found, press their icon in the inventory to read the information about each state. Once all five flags are found, the system will tell you to return them to the monument, at which time the flags will return and the mission will be done.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_03_10.jpg" /></div></div></div>