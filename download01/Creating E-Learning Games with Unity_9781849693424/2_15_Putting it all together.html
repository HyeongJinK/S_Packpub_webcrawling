<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec20"></a>Putting it all together</h2></div></div><hr /></div><p>Now that we have developed the classes necessary for the <code class="literal">InventoryMgr</code>, <code class="literal">MissionMgr</code>, and <code class="literal">InteractiveObj</code> systems, <a id="id133" class="indexterm"></a>let's build a scene that illustrates their functionality.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To get started, let's continue from <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Introduction to E-Learning and the Three Cs of 3D Games</em></span>, where we left off. Load the scene and save a copy named <code class="literal">chapter2</code>.</p></li><li><p>Add an instance of <code class="literal">InventoryMgr</code> to the <code class="literal">Player</code> GameObject by dragging-and-dropping it from the <span class="strong"><strong>Project</strong></span> tab to the <code class="literal">player</code> object. Alternatively, click on <span class="strong"><strong>Player</strong></span> and select <span class="strong"><strong>Add component</strong></span> from the <span class="strong"><strong>Inspector</strong></span> pane. Type in the name <code class="literal">InventoryMgr</code> and then click on it to add an instance.</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_02_07.jpg" /></div></li><li><p>Click on <span class="strong"><strong>Player</strong></span> and ensure that the <span class="strong"><strong>Tag</strong></span> is set to <span class="strong"><strong>Player</strong></span>. The <code class="literal">InteractiveObj</code> class will use this to make sure they can only be picked up by the player.</p></li><li><p>Set <span class="strong"><strong>Height</strong></span> and <span class="strong"><strong>Width</strong></span> to <span class="strong"><strong>40</strong></span> pixels to make the individual cells square shaped. Set the <span class="strong"><strong>Yposition</strong></span> to <span class="strong"><strong>0.85</strong></span> to indicate a <span class="emphasis"><em>y</em></span> coordinate of 85 percent from the top of the screen.</p></li><li><p>Create a new empty GameObject and name it <code class="literal">MissionMgr</code>. Attach the <code class="literal">MissionMgr</code> script to this object. We purposely detach this script from the player because the lifespan of <code class="literal">MissionMgr</code> may differ from the player object.</p><p>The results of all the discussed settings are shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_02_08.jpg" /></div></li></ol></div><p>Now that we have added our new<a id="id134" class="indexterm"></a> tracking systems to the game, let's create some objects to interact with:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a sphere and place it on the ground plane. Name it <code class="literal">A_Coin</code> and disable the mesh renderer component. On the sphere collider, click the <span class="strong"><strong>IsTrigger</strong></span> checkbox so that we can detect when the player enters the object.</p></li><li><p>Add a <span class="strong"><strong>Rigidbody</strong></span> component to the object. This is necessary for the <code class="literal">OnTriggerEnter</code> callback to be dispatched by the engine. Remember, the way Unity detects when the player (or any other object) enters a trigger is by checking its <span class="strong"><strong>Rigidbody</strong></span> component; so, if there is no such component attached, the the callback will not be dispatched.</p></li><li><p>Add a <code class="literal">CustomGameObject</code> script to this object. Set the display name to <code class="literal">money</code> and the object type to <code class="literal">coin</code>.</p></li><li><p>Add a <code class="literal">MissionToken</code> script to this object. Set <span class="strong"><strong>id</strong></span> to <code class="literal">1</code>, <span class="strong"><strong>Title</strong></span> to <code class="literal">token</code>, and the <span class="strong"><strong>Description</strong></span> to <code class="literal">mission 1 token</code>.</p></li><li><p>Add an <code class="literal">InteractiveObj</code> script to this object. Set <span class="strong"><strong>Rot Axis</strong></span> to (<code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">0</code>) to make the object rotate horizontally about the <span class="emphasis"><em>y</em></span> axis. Set <span class="strong"><strong>Rot Speed</strong></span> to <code class="literal">40</code> for a gentle rotation.</p></li><li><p>Add an <code class="literal">ObjectInteraction</code> script to this object. Set the interaction to <code class="literal">putInInventory</code>. Set the interaction type to <code class="literal">accumulate</code>. Point <code class="literal">Tex</code> to the <code class="literal">Coin-icon</code> coin texture.</p></li><li><p>Drag-and-drop this <code class="literal">gameObject</code> into the <code class="literal">OnCloseEnough</code> variable of the <code class="literal">InteractiveObject</code> component. This will connect this reference to the <code class="literal">ObjectInteraction</code> component on <code class="literal">gameObject</code> itself.</p></li><li><p>Now that the script is wired up, let's add a yellow coin model to the coin base. Create a cylinder <code class="literal">gameObject</code>, parent it to the <code class="literal">A_Coin</code> base, and set its local position to (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>). Create a material, colored yellow, and attach it to the mesh renderer of the cylinder.</p></li><li><p>Set its rotation to (<code class="literal">90</code>, <code class="literal">0</code>, <code class="literal">0</code>) in the inspector. Set its scale to (<code class="literal">0</code>, <code class="literal">0.16</code>, <code class="literal">0</code>) in the inspector as well.</p><p>The result of all these steps can be seen in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_02_03.jpg" /></div></li></ol></div><p>Congratulations! We now have one interactive object in the world. To test this, let's click on play and observe a slowly rotating coin. If we then walk the player up to it so that he or she can collect it, we will then see the inventory displaying the item.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec19"></a>Testing the mission system</h3></div></div></div><p>Let's add <a id="id135" class="indexterm"></a>another<a id="id136" class="indexterm"></a> type of interactive object and then build a couple of missions to finish validating our work.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag-and-drop this <code class="literal">A_Coin</code> object from the <span class="strong"><strong>Hierarchy</strong></span> tab into the <span class="strong"><strong>Project</strong></span> tab, thereby creating a Prefab. Name this Prefab <code class="literal">coin</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_02_09.jpg" /></div></li><li><p>Create a second interactive object, following the steps 1 to 9 from the <span class="emphasis"><em>Building an interactive object</em></span> section. Instead of making a yellow coin, create a red ruby and point the inventory texture to the ruby icon texture provided.</p></li><li><p>Name this object <code class="literal">A_Ruby</code> and set the mission token ID to <code class="literal">4</code>.</p></li><li><p>Drag-and-drop <code class="literal">A_Ruby</code> to the <span class="strong"><strong>Project</strong></span> tab, forming a Prefab named <code class="literal">Ruby</code>.</p></li><li><p>Drag-and-drop the coin and ruby Prefabs back into the <span class="strong"><strong>Hierarchy</strong></span> tab. At this point, there should be two coins and two rubies. Set the mission token ID of the second coin to <code class="literal">2</code> and the second ruby to <code class="literal">4</code>.</p></li></ol></div><p>Now that we have two coins and two rubies, let's create two missions!</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on <code class="literal">MissionMgr</code> and increase the size of the missions' array to <code class="literal">2</code>. Note that the array populates with an empty version of the <code class="literal">Mission</code> class. Set the first mission to <code class="literal">activated</code> and <code class="literal">visible</code>.</p></li><li><p>Set the first mission state to <span class="strong"><strong>MS_ACQUIRED</strong></span> and name it <span class="strong"><strong>Coin Craze</strong></span>.</p></li><li><p>Set the description to <span class="strong"><strong>collect all of the coins</strong></span>.</p></li><li><p>Set the points to <span class="strong"><strong>500</strong></span>.</p></li><li><p>Under tokens, drag-and-drop the two coin game objects. This will set the references to <code class="literal">MissionTokens</code> attached to the coin Prefabs.</p></li><li><p>Create a reward Prefab out of <code class="literal">GuiText</code> with <code class="literal">SimpleLifeSpanScript</code> attached. Set the string to <span class="strong"><strong>You have completed the coin challenge</strong></span> with a lifespan of 2 seconds. <a id="id137" class="indexterm"></a>Drag-and-drop this Prefab into the<a id="id138" class="indexterm"></a> reward field of <code class="literal">mission 1</code> in the mission manager. Make sure to delete any instances of this reward Prefab from the hierarchy; we want <code class="literal">MissionMgr</code> to spawn this!</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_02_10.jpg" /></div></li><li><p>Follow steps 7 to 12 from the <span class="emphasis"><em>Building an interactive object</em></span> section again, only this time name the mission <span class="strong"><strong>Ruby Run</strong></span> and point the mission tokens to the two ruby instances in the world (with unique mission token IDs). Create a new reward for this mission and drag-and-drop its Prefab onto the reward for mission 2.</p></li><li><p>Position the coins and rubies in the world at random locations in the game world. Play the level to observe <code class="literal">MissionMgr</code> in action, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849693424/graphics/3424OS_02_11.jpg" /></div></li></ol></div></div></div>