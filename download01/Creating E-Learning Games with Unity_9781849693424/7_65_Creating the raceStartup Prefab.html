<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec65"></a>Creating the raceStartup Prefab</h2></div></div><hr /></div><p>Recall<a id="id388" class="indexterm"></a> that the <a id="id389" class="indexterm"></a>second Prefab that is enabled when the <span class="strong"><strong>popup_Level2Start</strong></span> windows is clicked, is the <span class="strong"><strong>raceStartup</strong></span> Prefab. This object will commence the start of the other racers, leaving room for an eventual countdown clock. Let's start creating the <span class="strong"><strong>raceStartup</strong></span> Prefab by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new empty GameObject named <code class="literal">RaceStartup</code>.</p></li><li><p>Create a new script named <code class="literal">RaceStarterScript</code>, and add an instance of it to the <code class="literal">raceStartup</code> class.</p></li><li><p>This class should have a number of public variables to permit the tweaking of the race start.</p></li><li><p>In the following line of code, <code class="literal">stageTime</code> is the amount of time each stage lasts:</p><div class="informalexample"><pre class="programlisting">public float stageTime = 2.0f;</pre></div></li><li><p>In the following line of code, <code class="literal">numStates</code> is the number of states (of duration <code class="literal">stageTime</code>) that need to pass before the NPCs are activated:</p><div class="informalexample"><pre class="programlisting">public int numStages = 4;</pre></div></li><li><p>In the following line of code, <code class="literal">currentState</code> tracks which actual state is currently elapsing:</p><div class="informalexample"><pre class="programlisting">public int currentState = 0;</pre></div></li><li><p>Add a float <code class="literal">t</code> to track elapsed time as shown in the following line of code:</p><div class="informalexample"><pre class="programlisting">public float t;</pre></div></li><li><p>Add two <a id="id390" class="indexterm"></a>GameObject references to NPCs to activate as shown in the following lines of code:</p><div class="informalexample"><pre class="programlisting">public GameObject npcA;
public GameObject npcB;</pre></div></li><li><p>The core logic for this class happens in the <code class="literal">Update()</code> method each time Unity invokes this function and we track total elapsed time in <code class="literal">t</code> as shown in the following line of code:</p><div class="informalexample"><pre class="programlisting">t += time.deltaTime;</pre></div></li><li><p>Once the<a id="id391" class="indexterm"></a> final state is completed, we tell each NPC to change state to <code class="literal">patrol</code>. This has the effect of making them start to follow their spline paths via their component <code class="literal">SplineMgrs</code> as shown in the following code snippet:</p><div class="informalexample"><pre class="programlisting">if (currentState == numStates + 1)
{
  ncpA.GetComponent&lt;npcScript&gt;().SetState(npcScript.npcState.patrol);
  npcB.GetComponent&lt;npcScript&gt;().SetState(npcScript.npcState.patrol);</pre></div></li><li><p>If the elapsed time exceeds the state time, we reset the <code class="literal">stageTime</code> to zero plus any fractional difference beyond the <code class="literal">stageTime</code> that has been incurred and then increase the stage count by <code class="literal">1</code>. This is slightly more accurate than simply setting <code class="literal">t</code> to <code class="literal">0</code> for each stage and is prone to fewer errors over many stages. This can be accomplished with the following code snippet:</p><div class="informalexample"><pre class="programlisting">if (t &gt; stageTime)
{
   currentState++;
   t -= stageTime;
}</pre></div></li></ol></div><p>Congratulations! Now, the <span class="strong"><strong>raceStartup</strong></span> Prefab will activate the NPCs after an appropriate time has passed. Conveniently, this delay is adjustable inside the Unity Editor. This is a good thing as it lets the player to get a small head start on the other racers.</p></div>