<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec33"></a>Updating some systems</h2></div></div><hr /></div><p>We introduce a new class, <code class="literal">PlayerData</code>, to track the current level and points accrued of the player. To m<a id="id238" class="indexterm"></a>ake use of this new functionality, we need to update some systems by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Switch to the <code class="literal">LEVEL1</code> scene. Double-click on the <code class="literal">PlayerData</code> script to begin editing it.</p></li><li><p>Add a <code class="literal">public int score</code> and a <code class="literal">public GameState</code> level; note that in order to create an instance of the enumeration defined inside the <code class="literal">GameMgr</code> class, we need to prefix with <code class="literal">GameMgr</code> as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public class playerData : MonoBehaviour {
public int score;
public GameMgr eGameState;</pre></div></li><li><p>Add a public method called <code class="literal">addScore(int dScore)</code>. This method will be used by the different systems (primarily <code class="literal">MissionMgr</code>), to add score to the player's record. Note that since we use an integer for score, we could use this same method to add score or penalize the player (by adding negative scores) as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public void AddScore(int dScore)
{
  score += dScore;
} </pre></div></li><li><p>Add a public method called <code class="literal">StoreProgress(gameMgr.eGameState lvl)</code>. This method will be used to track which level the user is currently trying to complete. <a id="id239" class="indexterm"></a>We declare the method public rather than private so that other classes will be allowed to invoke this method on an instance of the <code class="literal">PlayerData</code> component. If it were private, then the code would not compile as shown in the following code:</p><div class="informalexample"><pre class="programlisting">public void StoreProgres{gameMgr.eGameState lvl)
{
  level = lvl;
} ;</pre></div><p>Now, let's connect the score tracking to the points in the game. Recall that <code class="literal">MissionMgr</code> stores a points field for each mission once it is completed. Let's go to <code class="literal">MissionMgr</code> and modify it to add the completed mission points to the <code class="literal">PlayerData</code> component.</p></li><li><p>In <code class="literal">MissionMgr</code>, in the <code class="literal">Validate()</code> method<a id="id240" class="indexterm"></a>, let's add a code block that searches for the <code class="literal">PlayerData</code> component on the <code class="literal">Player</code> GameObject. If it is found, then the points from the mission are added to the <code class="literal">PlayerData</code> score as shown in the following code:</p><div class="informalexample"><pre class="programlisting">GameObject go = GameObject.Find("Player1");
if (go)
{
   PlayerData pd = go.GetComponent&lt;PlayerData&gt;();
   if (pd)
      pd.AddScore(m.points);
}</pre></div></li><li><p>In order to visualize the player's score, let's add a <code class="literal">guiText</code> script to the bottom-right corner of the screen to show the score. To begin, create a new <code class="literal">guiText</code> script.</p></li><li><p>Name this object <code class="literal">score</code>. Parent it to the <code class="literal">_global</code> GameObject (because it should have persistency in the game). Set its position to (<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">0</code>) to offset the coordinates of the pixel-offset to the upper-right corner of the screen. This way, the negative <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> components of the pixel-offset will offset the score from the corner by the specified amount. Set <span class="strong"><strong>x</strong></span> to <code class="literal">-60</code> and <span class="strong"><strong>y</strong></span> to <code class="literal">-20</code>.</p></li></ol></div></div>