<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec68"></a>Text Assets – loading from the local files</h2></div></div><hr /></div><p>Another method to load in text data is externally from the project, that is, from files on the local hard drive. Text Data loaded in this way is read into the project dynamically from script, not necessarily<a id="id512" class="indexterm"></a> at scene startup, but whenever you<a id="id513" class="indexterm"></a> execute the necessary code. This means that for longer text files that involve heavy processing, lag becomes a serious consideration. In general, therefore, it is best to prefer statically loaded Text Assets to dynamic forms. For any dynamic assets, I recommend that you load and process them at scene startup to avoid in-game lagging, as shown in the following code sample 6-26:</p><div class="informalexample"><pre class="programlisting"> using UnityEngine;
 using System.Collections;
<span class="strong"><strong> using System.IO;</strong></span>
 
 //Function to load text data from external file
 public static string LoadTextFromFile(string Filename)
 {
    //If file does not exist on system, then return empty string
    if(!File.Exists(Filename)) return string.Empty;
 
    //File exists, now load text from file
    return <span class="strong"><strong>File.ReadAllText(Filename);</strong></span>
 }</pre></div><p>The code sample 6-26 loads a complete text file into one string object. You might, however, prefer to<a id="id514" class="indexterm"></a> process a text file line by line instead, especially if the file is a configuration file where values<a id="id515" class="indexterm"></a> are specified in separate lines. For this, see the following code sample 6-27:</p><div class="informalexample"><pre class="programlisting"> //Function to load text data, line by line, into a string array
 public static string[] LoadTextAsLines(string Filename)
 {
    //If file does not exist on system, then return empty array
    if(!File.Exists(Filename)) return null; 
 
    //Get lines
    return <span class="strong"><strong>File.ReadAllLines(Filename);</strong></span>
 }</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec52"></a>Text Assets – loading from the INI files</h3></div></div></div><p>Among the many text file types, you can load a common format is the INI file. It's, perhaps, not as common with Unity games, because many developers use the <code class="literal">PlayerPreferences</code> class<a id="id516" class="indexterm"></a> instead to store application settings. Even so, the INI files offer the advantage of storing application configuration data in only one place and in the same format across many different platforms. For<a id="id517" class="indexterm"></a> this reason, there are strong reasons to use INI files. Refer to the code sample 6-28 for an example INI that uses a key-value pairing format:</p><div class="informalexample"><pre class="programlisting">ApplicationName=MyTestApp
Date=1st Nov 2014
Author=Alan Thorn
Engine=Unity
Build=Production</pre></div><p>An ideal data structure to load INI files is the dictionary that mirrors a key-value pair structure. For this reason, it'd be great to load an INI file into a dictionary.</p><p>However, neither Unity nor Mono offers native support for this, which means we have to code the functionality ourselves, as shown in the following code sample 6-29:</p><div class="informalexample"><pre class="programlisting"> using UnityEngine;
 using System.Collections;
 using System.Collections.Generic;
 using System.IO;
 using System.Text;
 
 //Function to read basic ini file to dictionary
 public static Dictionary&lt;string, string&gt; ReadINIFile(string Filename)
 {
    //If file does not exist on system, then return null
    if(!File.Exists(Filename)) return null;
 
    //Create new dictionary
    Dictionary&lt;string, string&gt; INIFile = new Dictionary&lt;string, string&gt;();
 
    //Create new stream reader
    using (StreamReader SR = new StreamReader(Filename))
   {
         //String for current line
         string Line;
 
         //Keep reading valid lines
         while(!string.IsNullOrEmpty(Line = SR.ReadLine()))
         {
                //Trim line of leading and trailing white space
                Line.Trim();
 
                //Split the line at key=value
                string[] Parts = Line.Split(new char[] {'='});
 
                //Now add to dictionary
                INIFile.Add(Parts[0].Trim(), Parts[1].Trim());
         }
    }
 
    //Return dictionary
    return INIFile;
 }</pre></div><p>A dictionary returned<a id="id518" class="indexterm"></a> from this function will match the structure of the INI file. Therefore, values can be accessed in the form string <code class="literal">Value = MyDictionary["Key"];</code>. You can also enumerate<a id="id519" class="indexterm"></a> through all key and value members of a dictionary inside a <code class="literal">foreach</code>, as shown in the following code sample 6-30:</p><div class="informalexample"><pre class="programlisting"> //Build a dictionary from an INI file
 Dictionary&lt;string,string&gt; DB = ReadINIFile(@"c:\myfile.ini");
 
 //List all entries in dictionary
 foreach(KeyValuePair&lt;string, string&gt; Entry in DB)
 {
    //Loop through each key and value pair
    Debug.Log("Key: " + Entry.Key + " Value: " + Entry.Value);
 }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec53"></a>Text Assets – loading from the CSV files</h3></div></div></div><p>Earlier in this<a id="id520" class="indexterm"></a> chapter, we saw how to process a CSV file that features character names, both male and female. Let's now<a id="id521" class="indexterm"></a> see some source code to load CSV from a file on disk into an array of strings, with each string separated by a comma, as shown in the following code sample 6-31:</p><div class="informalexample"><pre class="programlisting"> //Function to load a string array from a CSV file
 public static string[] LoadFromCSV(string Filename)
 {
    //If file does not exist on system, then return null
    if(!File.Exists(Filename)) return null;
 
    //Get all text
    string AllText = File.ReadAllText(Filename);
 
    //Return string array
    return AllText.Split(new char[] {','});
 }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec54"></a>Text Assets – loading from the Web</h3></div></div></div><p>If you're making multiplayer games and need to access player or game data across the Web, if you need to<a id="id522" class="indexterm"></a> verify passwords with hashes online, or if you need<a id="id523" class="indexterm"></a> to access a web page to process its elements, then you will need the <code class="literal">WWW</code> class to retrieve text data online, as shown in the following code sample 6-32:</p><div class="informalexample"><pre class="programlisting"> //Gets text from the web in a string
 public IEnumerator GetTextFromURL(string URL)
 {
    //Create new WWW object
<span class="strong"><strong>    WWW TXTSource = new WWW(URL);</strong></span>
 
    //Wait for data to load
    yield return TXTSource;
 
    //Now get text data
<span class="strong"><strong>    string ReturnedText = TXTSource.text;</strong></span>
 }</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip47"></a>Tip</h3><p>More information<a id="id524" class="indexterm"></a> on the <code class="literal">WWW</code> class can be found in the<a id="id525" class="indexterm"></a> online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/WWW.html" target="_blank">http://docs.unity3d.com/ScriptReference/WWW.html</a>.</p></div></div></div>