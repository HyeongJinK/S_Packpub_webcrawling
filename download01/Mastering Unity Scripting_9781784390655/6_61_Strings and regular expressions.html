<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec63"></a>Strings and regular expressions</h2></div></div><hr /></div><p>Working with text data is critical and for many reasons. If you need to display subtitles, show in-game text, and implement localization functionality (supporting multiple languages), then you<a id="id472" class="indexterm"></a> would be working with text, specifically with Text Assets. In Unity, Text Assets refer to any text files included in the Unity project, and each asset is treated as <a id="id473" class="indexterm"></a>one long string even when multiple lines are involved (each line is separated by a <code class="literal">\n</code> escape character). Once your code is presented with a string like this, however, there're typically many ways in which you'll want to process it. Let's see some common but important string operations.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec44"></a>Null, empty strings, and white space</h3></div></div></div><p>When processing strings, you<a id="id474" class="indexterm"></a> can't always guarantee validity; sometimes, strings are <a id="id475" class="indexterm"></a>badly formed and don't make sense. For this reason, you'll frequently need to validate them before processing. A common way to validate them initially is to see whether a string is null, and then (if not<a id="id476" class="indexterm"></a> null) check the string's length, because<a id="id477" class="indexterm"></a> if the length is <code class="literal">0</code>, then the string is empty and, therefore, invalid, even though it's not <code class="literal">null</code>.</p><p>Again, you'll probably also want to eliminate the possibility that a string consists entirely of spaces, because a string<a id="id478" class="indexterm"></a> that is not <code class="literal">null</code> and features only white space characters will not, in fact, be of <code class="literal">0</code> length, even though it usually means there's nothing to process. You can validate a <a id="id479" class="indexterm"></a>string for each of these states individually, but the string class in .NET offers a compound or all-in-one convenience check for you, specifically the method<a id="id480" class="indexterm"></a> <code class="literal">IsNullOrWhiteSpace</code>. However, this method was introduced in .NET 4.5, and Mono does not support this version. This means a manual implementation is required for equivalent behavior, as shown in the following code sample 6-11:</p><div class="informalexample"><pre class="programlisting"> using UnityEngine;
 using System.Collections;
 //-------------------------------------------------------------
 //Class extension to add Null or White Space functionality
 public static class StringExtensions {
<span class="strong"><strong>    public static bool IsNullOrWhitespace(this string s){</strong></span>
          return s == null || s.Trim().Length == 0;
    }
 }
 //-------------------------------------------------------------
 public class StringOps : MonoBehaviour 
 {
    //Validate string
    public bool IsValid(string MyString)
    {
          //Check for null or white space
<span class="strong"><strong>          if(MyString.IsNullOrWhitespace()) return false;</strong></span>
 
          //Now validate further
          return true;
    }
 }
 //-------------------------------------------------------------</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec45"></a>String comparison</h3></div></div></div><p>You'll frequently need to compare two separate strings, typically, for equality to determine whether two strings are identical. You can do this using the <code class="literal">==</code> operator such as <code class="literal">string1 == string2</code>, but for best performance, use the <code class="literal">theString.Equals</code> method. This method has<a id="id481" class="indexterm"></a> several versions, all of varying computational expense. In general, you should prefer any version that contains an argument of type <code class="literal">StringComparison</code>. When the comparison type is explicitly stated, the operation will perform best, as shown in the following code sample 6-12:</p><div class="informalexample"><pre class="programlisting">   //Compare strings
   public bool IsSame(string Str1, string Str2)
   {
        //Ignore case
         return string.Equals(Str1, Str2, System.StringComparison.CurrentCultureIgnoreCase);
   }</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip41"></a>Tip</h3><p>More information <a id="id482" class="indexterm"></a>on the <code class="literal">String.Compare</code> method can be found online in MSDN at <a class="ulink" href="http://msdn.microsoft.com/en-us/library/system.string.compare%28v=vs.110%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/system.string.compare%28v=vs.110%29.aspx</a>.</p></div><p>Another method to quickly and regularly compare the same two strings for equality is to use string hashes, that<a id="id483" class="indexterm"></a> is, to convert each string into a unique integer and then to compare the integers instead, as shown in the following code sample 6-13:</p><div class="informalexample"><pre class="programlisting">   //Compare strings as hash
   public bool StringHashCompare(string Str1, string Str2)
   {
          int Hash1 = Animator.StringToHash(Str1);
          int Hash2 = Animator.StringToHash(Str2);

         return Hash1 == Hash2;
   }</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip42"></a>Tip</h3><p>You can also <a id="id484" class="indexterm"></a>use the <code class="literal">String.GetHashCode</code> function from the Mono library to retrieve a string's hash code. For more information, visit <a class="ulink" href="http://msdn.microsoft.com/en-us/library/system.string.gethashcode%28v=vs.110%29.aspx" target="_blank">http://msdn.microsoft.com/en-us/library/system.string.gethashcode%28v=vs.110%29.aspx</a>.</p></div><p>Sometimes, however, you don't want to compare for equality. Your intention might be to determine which string takes more priority alphabetically, that is, whether one string would appear before the other if they were both listed alphabetically in a dictionary. You can achieve this using the <a id="id485" class="indexterm"></a>
<code class="literal">String.Compare</code> function. However, again, be sure to use a version that features a <code class="literal">StringComparison</code> type in the arguments, as shown in the following code sample 6-14. With this version, <code class="literal">-1</code> would be returned if <code class="literal">Str1</code> comes before <code class="literal">Str2</code>, <code class="literal">1</code> would be returned if <code class="literal">Str2</code> comes before <code class="literal">Str1</code>, and <code class="literal">0</code> would be returned if the two strings are equal:</p><div class="informalexample"><pre class="programlisting">   //Sort comparison
   public int StringOrder (string Str1, string Str2)
   {
          //Ignores case
          return string.Compare(Str1, Str2, 
System.StringComparison.CurrentCultureIgnoreCase);
   }</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip43"></a>Tip</h3><p>Although <code class="literal">String.Compare</code> returns <code class="literal">0</code> to indicate that two strings are equal, never use this function for equality testing. For equality testing, use <code class="literal">String.Equals</code> or hashes, as both perform much faster than <code class="literal">String.Compare</code>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec46"></a>String formatting</h3></div></div></div><p>If you're creating GUI elements, such as high-score HUDs, player names, cash counters, or resources indicators, you'll <a id="id486" class="indexterm"></a>not only need to show literal text but also numerical values inside the strings, for example, by combing the word <code class="literal">Score:</code> with a string representation of the actual score, which will change over time depending on player performance. One way to achieve this is the <code class="literal">String.Format</code> method, as shown in the following code sample 6-15:</p><div class="informalexample"><pre class="programlisting">//Construct string from three numbers
public void BuildString(int Num1, int Num2, float Num3)
{
   string Output = string.Format("Number 1 is: {0}, Number 2 is: {1}, Number 3 is: {2}", Num1, Num2, Num3);

   Debug.Log (Output.ToString("n2"));
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec47"></a>String looping</h3></div></div></div><p>So far, we've seen <code class="literal">IEnumerable</code> and <code class="literal">IEnumerator</code>. Thankfully, these interfaces apply to strings and can be used to<a id="id487" class="indexterm"></a> loop or cycle through every letter in a string. This can be achieved using either the <code class="literal">IEnumerator</code> interface itself or via a <code class="literal">foreach</code> loop. Let's see both ways, as shown in the following code sample 6-16 and 6-17:</p><div class="informalexample"><pre class="programlisting">   //Sample 6-16
//Loops through string in foreach
   public void LoopLettersForEach(string Str)
   {
          //For each letter
          foreach(char C in Str)
          {
               //Print letter to console
               Debug.Log (C);
          }
   }

//Sample 6-17
   //Loop through string as iterator
   public void LoopLettersEnumerator(string Str)
   {
         //Get Enumerator
         IEnumerator StrEnum = Str.GetEnumerator();

         //Move to nextletter
         while(StrEnum.MoveNext())
        {
               Debug.Log ((char)StrEnum.Current);
        }
   }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec48"></a>Creating strings</h3></div></div></div><p>To make your code read better, work<a id="id488" class="indexterm"></a> in a cleaner way, and generally, be more consistent with .NET and the way it's intended to be used. It's a good practice to avoid initializing string variables as: <code class="literal">string MyString = "";</code>. Instead, try the following code for string declaration and assignment using <code class="literal">String.empty</code>:</p><div class="informalexample"><pre class="programlisting">string MyString = string.Empty;</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec49"></a>Searching strings</h3></div></div></div><p>If you're dealing with multiple lines of text read from a file, such as a Text Asset, you might need to find the first occurrence of a smaller string inside the larger one, for example, finding a smaller and separate word within the larger string. You can achieve this using the <a id="id489" class="indexterm"></a>
<code class="literal">String.IndexOf</code> method. If a match is found, the function would return a positive integer that indicates the<a id="id490" class="indexterm"></a> position in the larger string of the first character of the found word as a measured offset from the first letter. If no match is found, the function returns <code class="literal">-1</code>, as shown in the following code sample 6-18:</p><div class="informalexample"><pre class="programlisting">   //Searches string for a specified word and returns found index of first occurrence
   public int SearchString(string LargerStr, string SearchStr)
   {
          //Ignore case
          return LargerStr.IndexOf(SearchStr, System.StringComparison.CurrentCultureIgnoreCase);
   }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec50"></a>Regular expressions</h3></div></div></div><p>Occasionally, you might need to perform more complex searches on very large strings, such as finding all words in a string beginning with a specific letter, all words starting with <code class="literal">a</code> and ending in <code class="literal">t</code>, and so on. In these cases, you would want the results available in an array if there are any. You can <a id="id491" class="indexterm"></a>achieve this effectively using regular expressions (<code class="literal">Regex</code>). Regular expressions let you define a string value using a conventional and specialized syntax, specifying a search pattern. For example, the string <code class="literal">[dw]ay</code> means "find all words that end with <code class="literal">ay</code> and that also begin with either <code class="literal">d</code> or <code class="literal">w</code>. Thus, find all occurrences of either day or way". The regular expression can then be applied to a larger string to perform a search using the <code class="literal">Regex</code> class. The .NET framework provides access to regular expression searches through the <code class="literal">RegularExpressions</code> namespace, as shown in the following code sample 6-19:</p><div class="informalexample"><pre class="programlisting">01 //-------------------------------------------------------
02 using UnityEngine;
03 using System.Collections;
04 //Must include Regular Expression Namespace
05 using System.Text.RegularExpressions;
06 //-------------------------------------------------------
07 public class RGX : MonoBehaviour 
08 {
09 //Regular Expression Search Pattern
10 string search = "[dw]ay";
11 
12 //Larger string to search
13 string txt = "hello, today is a good day to do things my way";
14 
15 // Use this for initialization
16 void Start () 
17 {
18        //Perform search and get first result in m
19        Match m = Regex.Match(txt, search);
20 
21        //While m refers to a search result, loop
22        while(m.Success)
23        {
24              //Print result to console
25              Debug.Log (m.Value);
26 
27             //Get next result, if any
28             m = m.NextMatch();
29        }
30 }
31 }
32 //-------------------------------------------------------</pre></div><p>The following are the <a id="id492" class="indexterm"></a>comments for code sample 6-19:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 05</strong></span>: The <code class="literal">RegularExpressions</code> namespace must be included in all source files using regular expression searches.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 09 and 13</strong></span>: The string <code class="literal">Search</code> defines the regular expression itself. The string <code class="literal">txt</code> defines the larger string to be searched by the regular expression. The string <code class="literal">Search</code> searches for all occurrences of the words, <code class="literal">day</code> and <code class="literal">way</code>.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 19</strong></span>: The method <code class="literal">Regex.Match</code> is called to apply a regular expression search on the string <code class="literal">txt</code>. The results are stored in the local variable <code class="literal">m</code>. This variable can be iterated to scan for all results.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 25</strong></span>: The<a id="id493" class="indexterm"></a> results in <code class="literal">m</code> will include three matches (not two) based on the string <code class="literal">txt</code>. These will include <span class="emphasis"><em>day</em></span> as found in to<span class="emphasis"><em>day</em></span> as well as <span class="emphasis"><em>day</em></span> and <span class="emphasis"><em>way</em></span> by themselves.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip44"></a>Tip</h3><p>More information<a id="id494" class="indexterm"></a> on regular expressions can be found online at <a class="ulink" href="http://en.wikipedia.org/wiki/Regular_expression" target="_blank">http://en.wikipedia.org/wiki/Regular_expression</a>.</p></div></li></ul></div></div></div>