<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec88"></a>Localization</h2></div></div><hr /></div><p>Perhaps one of the most underappreciated and underdocumented aspect of game development is localization. This refers to the broad range of technical, economic, and logistical measures a developer takes to support multiple natural languages in their game, such as English, French, German, Spanish, Esperanto, and so on. The technical aim is not so much to support this or that specific language, but rather to establish an infrastructure that could support any<a id="id646" class="indexterm"></a> arbitrary language chosen at any time, now or later. The entire scope and role of localization in development is beyond the scope of this book, but here we'll examine one way in which the Unity Editor can be customized to<a id="id647" class="indexterm"></a> facilitate a quick and easy localization workflow. For example, consider the following sample XML file, in which game text for the buttons in a main menu system is defined in both English and a "spoof language" called Yoda:</p><div class="informalexample"><pre class="programlisting">&lt;?xml version="1.0"?&gt;
&lt;text&gt;
    &lt;language id="english"&gt;
         &lt;text_entry id="text_01"&gt;&lt;![CDATA[new game]]&gt;&lt;/text_entry&gt;
         &lt;text_entry id="text_02"&gt;&lt;![CDATA[load game]]&gt;&lt;/text_entry&gt;
         &lt;text_entry id="text_03"&gt;&lt;![CDATA[save game]]&gt;&lt;/text_entry&gt;
         &lt;text_entry id="text_04"&gt;&lt;![CDATA[exit game]]&gt;&lt;/text_entry&gt;
   &lt;/language&gt;
   &lt;language id="yoda"&gt;
         &lt;text_entry id="text_01"&gt;&lt;![CDATA[new game, you start]]&gt;&lt;/text_entry&gt;
         &lt;text_entry id="text_02"&gt;&lt;![CDATA[load game, you will]]&gt;&lt;/text_entry&gt;
         &lt;text_entry id="text_03"&gt;&lt;![CDATA[game save, you have]]&gt;&lt;/text_entry&gt;
         &lt;text_entry id="text_04"&gt;&lt;![CDATA[leave now, you must]]&gt;&lt;/text_entry&gt;
   &lt;/language&gt;
&lt;/text&gt;</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip59"></a>Tip</h3><p>Notice, the CDATA element encloses all custom text nodes to allow the use of any characters and symbols. More information on CDATA can<a id="id648" class="indexterm"></a> be found online at <a class="ulink" href="http://www.w3schools.com/xml/xml_cdata.asp" target="_blank">http://www.w3schools.com/xml/xml_cdata.asp</a>.</p></div><p>The XML defined earlier creates four text elements, one for each button on a sample user interface menu. Each text element is assigned a unique ID: <code class="literal">text_01</code>, <code class="literal">text_02</code>, <code class="literal">text_03</code>, and <code class="literal">text_04</code>. These IDs uniquely identify each item of text in the game and will match across all specified languages. The purpose here is to import the text file into Unity that allows the <a id="id649" class="indexterm"></a>developer to switch between languages at the touch of a button, and have all relevant text elements in the game change automatically to accommodate the language switch. Let's see how this works.</p><p>First import the localized text into a <code class="literal">Resources</code> folder in a Unity project. Create a folder named <code class="literal">Resources</code> and then import the localized text file into it, as shown in the following screenshot. In code, this means any object or class can load or open the text file using a <code class="literal">Resources.Load</code> call, as we'll see soon.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_13.jpg" /><div class="caption"><p>Importing localized text into a project</p></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip60"></a>Tip</h3><p>More information<a id="id650" class="indexterm"></a> on resources can be found online at the Unity documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Resources.html" target="_blank">http://docs.unity3d.com/ScriptReference/Resources.html</a>.</p></div><p>The imported text file simply contains all text data to be included in the game, where each element is associated with its ID. Thus, each string value is married to an ID, and the ID is consistent across language schemes that allow a seamless transition between languages. The ID is the one common denominator that makes an automated localization possible. To implement the localization system in code, we'll first create an attribute that should be applied to all localized strings. The attribute defines only the ID to be attached to a specific string variable, as shown in the following code sample 8-11:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
 using System.Collections;
 
 //Attribute to attach to string objects
 public class LocalizationTextAttribute : System.Attribute
 {
    //ID to assign
    public string LocalizationID = string.Empty;
 
    //Constructor
    public LocalizationTextAttribute(string ID)
    {
           LocalizationID = ID;
   }
 }</pre></div><p>With the <code class="literal">LocalizationTextAttribute</code> attribute now created, we can apply it to string members in code, which <a id="id651" class="indexterm"></a>associates them with a specific ID, as shown in the following code sample 8-12:</p><div class="informalexample"><pre class="programlisting">//----------------------------------------------
 using UnityEngine;
 using System.Collections;
 //----------------------------------------------
 public class SampleGameMenu : MonoBehaviour 
 {
    [LocalizationTextAttribute("text_01")]
    public string NewGameText = string.Empty;
 
    [LocalizationTextAttribute("text_02")]
    public string LoadGameText = string.Empty;
 
   [LocalizationTextAttribute("text_03")]
   public string SaveGameText = string.Empty;
 
    [LocalizationTextAttribute("text_04")]
    public string ExitGameText = string.Empty;
 }
 //----------------------------------------------</pre></div><p>The <code class="literal">SampleGameMenu</code> class appears as a regular class in the Object Inspector, as shown in the following screenshot. Later, through our <code class="literal">Editor</code> class, we'll develop the ability to automatically change all string members to the selected language.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_14.jpg" /><div class="caption"><p>A SampleGameMenu class features all texture required for a sample menu screen</p></div></div><p>Now, we'll code an <code class="literal">Editor</code> class to switch between languages. This class will add menu entries on the application menu, which when clicked will change the active language, as shown in the following code sample 8-13. This sample draws on a range of related concepts we've seen <a id="id652" class="indexterm"></a>already, including new ones. Specifically, it uses the <code class="literal">Reflection</code>, <code class="literal">Linq</code>, and <code class="literal">Editor</code> classes as well as the Mono Framework XML handling classes:</p><div class="informalexample"><pre class="programlisting">01 //-------------------------------------------
02 using UnityEngine;
03 using UnityEditor;
04 using System.Collections;
05 using System.Xml;
06 using System.Linq;
07 using System.Reflection;
08 //-------------------------------------------
09 public class LanguageSelector
10 {
<span class="strong"><strong>11 [MenuItem ("Localization/English")]</strong></span>
12 public static void SelectEnglish()
13 {
14        LanguageSelector.SelectLanguage("english");
15 }
16 
<span class="strong"><strong>17 [MenuItem ("Localization/French")]</strong></span>
18 public static void SelectFrench()
19 {
20        LanguageSelector.SelectLanguage("french");
21 }
22 
<span class="strong"><strong>23 [MenuItem ("Localization/Yoda")]</strong></span>
24 public static void SelectYoda()
25 {
26        LanguageSelector.SelectLanguage("yoda");
27 }
28 
29 public static void SelectLanguage(string LanguageName)
30 {
31        //Access XML Text File in Project
<span class="strong"><strong>32 TextAsset textAsset = Resources.Load("LocalText") as TextAsset;</strong></span>
33 
34        //Load text into XML Reader object
<span class="strong"><strong>35         XmlDocument xmlDoc = new XmlDocument();</strong></span>
<span class="strong"><strong>36         xmlDoc.LoadXml(textAsset.text);</strong></span>
37 
38       //Get language nodes
39 XmlNode[] LanguageNodes = (from XmlNode Node in xmlDoc.GetElementsByTagName("language")

40 where Node.Attributes["id"].Value.ToString().Equals(LanguageName.ToLower())
41       select Node).ToArray();
42 
43        //If no matching node found, then exit
44        if(LanguageNodes.Length &lt;= 0)
45              return;
46 
47       //Get first node
48       XmlNode LanguageNode = LanguageNodes[0];
49 
50      //Get text object
51 SampleGameMenu GM = Object.FindObjectOfType&lt;SampleGameMenu&gt;() as SampleGameMenu;
52 
53      //Loop through child xml nodes
54      foreach (XmlNode Child in LanguageNode.ChildNodes)
55        {
56              //Get text Id for this node
57              string TextID = Child.Attributes["id"].Value;
58               string LocalText = Child.InnerText;
59 
60              //Loop through all fields
<span class="strong"><strong>61 foreach(var field in GM.GetType().GetFields(BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.FlattenHierarchy))</strong></span>
62              {
63                    //If field is a string then is relevant
64                    if(field.FieldType == typeof(System.String))
65                    {
66                          //Get custom attributes for field
67 System.Attribute[] attrs = field.GetCustomAttributes(true) as System.Attribute[];

68 
69                    foreach (System.Attribute attr in attrs)
70                    {
71        if(attr is LocalizationTextAttribute)
72                                 {
73                                     //We've found text
74 LocalizationTextAttribute LocalAttr = attr as LocalizationTextAttribute;
75 
76               if(LocalAttr.LocalizationID.Equals( TextID ))
77                           {
78                          //id matches, now set value
79                          field.SetValue(GM, LocalText);
80                           }
81                     }
82              }
83              }
84       }
85       }
86 }
87 }
88 //-------------------------------------------</pre></div><p>The following are the comments for code sample 8-13:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 02-07</strong></span>: Remember to include wide range of namespaces as shown here. Our code will rely on them all to some degree.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 11-23</strong></span>: For this sample application, the three languages: <span class="strong"><strong>English</strong></span>, <span class="strong"><strong>French</strong></span>, and <span class="strong"><strong>Yoda</strong></span> are selectable from the application menu. For your own projects, your language<a id="id653" class="indexterm"></a> list may be different. But crucially, based on the localization system given here, integration of additional languages, even at a much later time, is easy.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 32</strong></span>: The <code class="literal">Resources.Load</code> function is called here to open the XML text file from the <code class="literal">Resources</code> folder in the project that extracts its text contents into one single concatenated string variable.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 35-36</strong></span>: The XML string is loaded into an <code class="literal">XmlDocument</code> object, which is a Mono class encapsulating a complete XML file, either on disk or in memory. The class also validates the document on loading, which means an exception will be generated here if the file contains syntax errors.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 53</strong></span>: Once a language is selected from the XML file, all child nodes of the language (each node a unique string) are cycled to find a matching ID.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 61</strong></span>: For each <a id="id654" class="indexterm"></a>string entry, all public string members for the text class are searched for an appropriate <code class="literal">LocalizationTextAttribute</code> and when found, the string ID is compared to check for a match. When a match is found, the string variable is assigned the corresponding localized string.</p></li></ul></div><p>To use the localization framework given here, first add a <code class="literal">SampleGameMenu</code> object to the scene as shown here:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_15.jpg" /><div class="caption"><p>Adding a Sample Game Menu object to the scene with localized text members</p></div></div><p>Then, choose a language from the application main menu by selecting <span class="strong"><strong>English</strong></span> or <span class="strong"><strong>Yoda</strong></span> from the <span class="strong"><strong>Localization</strong></span> tab, as shown here:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_16.jpg" /><div class="caption"><p>Setting the active language for the game</p></div></div><p>Once the active<a id="id655" class="indexterm"></a> language is specified, all strings with the <code class="literal">LocalizationTextAttribute</code> attribute will be updated, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_17.jpg" /><div class="caption"><p>Localized text is updated after selecting an active language</p></div></div></div>