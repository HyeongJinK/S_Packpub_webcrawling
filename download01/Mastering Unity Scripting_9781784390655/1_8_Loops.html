<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec14"></a>Loops</h2></div></div><hr /></div><p>Loops are one of the<a id="id51" class="indexterm"></a> most powerful tools in programming. Imagine a game where the entire level can be nuked. When this happens, you'll want to destroy almost everything in the scene. Now, you can do this by deleting each and every object individually in code, one line at a time. If you did this, then a small scene with only a few objects would take just a few lines of code, and this wouldn't be problematic. However, for larger scenes with potentially hundreds of objects, you'd have to write a lot of code, and this code would need to be changed if you altered the contents of the scene. This would be tedious. Loops can simplify the process to just a few lines, regardless of scene complexity or<a id="id52" class="indexterm"></a> object number. They allow you to repeatedly perform operations on potentially many objects. There are several kinds of loops in C#. Let's see some examples.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec10"></a>The foreach loop</h3></div></div></div><p>Perhaps, the simplest loop type in C# is the <code class="literal">foreach</code> loop. Using <code class="literal">foreach</code>, you can cycle through every<a id="id53" class="indexterm"></a> element in an array, sequentially from start to end, processing each item<a id="id54" class="indexterm"></a> as required. Consider the following code sample 1-6; it destroys all <code class="literal">GameObjects</code> from a <code class="literal">GameObject</code> array:</p><div class="informalexample"><pre class="programlisting">01 using UnityEngine;
02 using System.Collections;
03 
04 public class MyScriptFile : MonoBehaviour 
05 {
06     //Array of game objects in the scene
07     public GameObject[] MyObjects;
08 
09     // Use this for initialization
10     void Start ()
11     {
12          //Repeat code for all objects in array, one by one
13          foreach(GameObject Obj in MyObjects)
14          {
15              //Destroy object
16              Destroy (Obj);
17          }
18    }
19 
20    // Update is called once per frame
21    void Update () 
22    {
23    }
24 }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>
<span class="strong"><strong>Downloading the example code</strong></span>
</p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com" target="_blank">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support" target="_blank">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div><p>The <code class="literal">foreach</code> loop repeats the code block <code class="literal">{}</code> between lines 14–17, once for each element in the array <code class="literal">MyObjects</code>. Each pass or cycle in the loop is known as an iteration. The loop depends on array size; this means that larger arrays require more iterations and more processing time. The loop also features a local variable <code class="literal">obj</code>. This is declared in the <code class="literal">foreach</code> statement in line 13. This variable stands in for the selected or active element in the array as the loop passes each iteration, so <code class="literal">obj</code> represents the first element in the loop on the first iteration, the second <a id="id55" class="indexterm"></a>element on the second iteration, and so on.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>More information on the<a id="id56" class="indexterm"></a> <code class="literal">foreach</code> loop and its usage in C# can be found at <a class="ulink" href="http://msdn.microsoft.com/en-GB/library/ttw7t8t6.aspx" target="_blank">http://msdn.microsoft.com/en-GB/library/ttw7t8t6.aspx</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec11"></a>The for loop</h3></div></div></div><p>The <code class="literal">foreach</code> loop is handy when you need to iterate through a single array sequentially from start to end, processing<a id="id57" class="indexterm"></a> each element one at a time. But sometimes you need more control over the iterations. You might need to process a loop backwards from the end to the start, you <a id="id58" class="indexterm"></a>might need to process two arrays of equal length simultaneously, or you might need to process every alternate array element as opposed to every element. You can achieve this using the <code class="literal">for</code> loop, as shown here:</p><div class="informalexample"><pre class="programlisting">//Repeat code backwards for all objects in array, one by one
for(int i = MyObjects.Length-1; i &gt;= 0; i--)
{
   //Destroy object
   DestroyMyObjects[i]);
}</pre></div><p>The following are the comments for the preceding code snippet:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Here, the <code class="literal">for</code> loop traverses the <code class="literal">MyObjects</code> array backwards from the end to the start, deleting each <code class="literal">GameObject</code> in the scene. It does this using a local variable <code class="literal">i</code>. This is sometimes known as an <code class="literal">Iterator</code> variable, because it controls how the loop progresses.</p></li><li style="list-style-type: disc"><p>The <code class="literal">for</code> loop line has the following three main parts, each separated by a semicolon character:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">i</code>: This is initialized to <code class="literal">MyObjects.Length – 1</code> (the last element in the array). Remember that arrays are zero-indexed, so the last element is always <code class="literal">Array Length -1</code>. This ensures that loop iteration begins at the array end.</p></li><li style="list-style-type: disc"><p>
<code class="literal">i &gt;= 0</code>: This expression indicates the condition when the loop should terminate. The <code class="literal">i</code> variable acts like a countdown variable, decrementing backwards through the array. In this case, the loop should end when <code class="literal">i</code> is no longer greater than or equal to <code class="literal">0</code>, because <code class="literal">0</code> represents the start of the array.</p></li><li style="list-style-type: disc"><p>
<code class="literal">i--</code>: This expression controls how the variable <code class="literal">i</code> changes on each iteration of the loop moving from the array end to the beginning. Here, <code class="literal">i</code> will be decremented by one on each iteration, that is, a value of <code class="literal">1</code> will be <a id="id59" class="indexterm"></a>subtracted from <code class="literal">i</code> on each pass of the loop. In contrast, the statement <code class="literal">++</code> will add <code class="literal">1</code>.</p></li></ul></div></li><li style="list-style-type: disc"><p>During the loop, the expression <code class="literal">MyObjects[i]</code> is used to access array elements.</p></li></ul></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>More information on the<a id="id60" class="indexterm"></a> <code class="literal">for</code> loop and its usage in C# can be found at <a class="ulink" href="http://msdn.microsoft.com/en-gb/library/ch45axte.aspx" target="_blank">http://msdn.microsoft.com/en-gb/library/ch45axte.aspx</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec12"></a>The while loop</h3></div></div></div><p>Both the <code class="literal">for</code> and <code class="literal">foreach</code> loops were especially useful when cycling through an array, performing specific operations on each iteration. The <code class="literal">while</code> loop, in contrast, is useful to continually <a id="id61" class="indexterm"></a>repeat a specific behavior until a specified condition evaluates to <code class="literal">false</code>. For example, if you must deal damage to the player as long as they're standing on hot lava or continually move a vehicle until the breaks are applied, then a <code class="literal">while</code> loop <a id="id62" class="indexterm"></a>could be just what you need, as shown in the following code sample 1-7:</p><div class="informalexample"><pre class="programlisting">01 using UnityEngine;
02 using System.Collections;
03 
04 public class MyScriptFile : MonoBehaviour 
05 {
06     // Use this for initialization
07     void Start ()
08    {
09         //Will count how many messages have been printed
10         int NumberOfMessages = 0;
11 
12         //Loop until 5 messages have been printed to the console
13         while(NumberOfMessages &lt; 5) 
14         {
15              //Print message

16              Debug.Log ("This is Message: " + NumberOfMessages.ToString());

17 
18              //Increment counter
19              ++NumberOfMessages;
20         }
21    }
22 
23    // Update is called once per frame
24    void Update () 
25    {
26    }
27 }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note09"></a>Note</h3><p>
<span class="strong"><strong>ToString</strong></span>
</p><p>Many classes and objects in Unity have a<a id="id63" class="indexterm"></a> <code class="literal">ToString</code> function (see line 16 of code sample 1-7). This function converts the object, such as an integer (whole number), to a human-readable word or statement that can be printed to the <span class="strong"><strong>Console</strong></span> or <span class="strong"><strong>Debugging</strong></span> window. This is useful for printing objects and data to the console when debugging. Note that converting numerical objects to strings requires an implicit conversion.</p></div><p>The following <a id="id64" class="indexterm"></a>are the comments for code sample 1-7:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Line 13 begins the <code class="literal">while</code> loop with the condition that it repeats until the integer variable <code class="literal">NumberOfMessages</code> exceeds or equals 5</p></li><li style="list-style-type: disc"><p>The code block between lines 15 and 19 is repeated as the body of the <code class="literal">while</code> loop</p></li><li style="list-style-type: disc"><p>Line 19 increments the variable <code class="literal">NumberOfMessages</code> on each iteration</p></li></ul></div><p>The result of code sample 1-7, when executed in the game mode, will be to print five text messages to the Unity Console when the level begins, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_01_09.jpg" /><div class="caption"><p>Printing messages to Console in a while loop</p></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip07"></a>Tip</h3><p>More information <a id="id65" class="indexterm"></a>on the <code class="literal">while</code> loop and its usage in C# can be found at <a class="ulink" href="http://msdn.microsoft.com/en-gb/library/2aeyhxcd.aspx" target="_blank">http://msdn.microsoft.com/en-gb/library/2aeyhxcd.aspx</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec13"></a>Infinite loops</h3></div></div></div><p>One danger of using loops, especially <code class="literal">while</code> loops, is to accidentally create an infinite loop, that is, a loop that cannot end. If your game enters an infinite loop, it will normally freeze, perhaps permanently, requiring you to force a quit by terminating the application or even worse, causing a <a id="id66" class="indexterm"></a>complete system crash! Often, Unity will catch the problem and exit but don't rely on this. For example, removing line 19 of the code sample 1-7 would<a id="id67" class="indexterm"></a> create an infinite loop because the <code class="literal">NumberOfMessages</code> variable will never increment to a level that satisfies the <code class="literal">while</code> loop condition, thereby causing an exit. The message of this section, then, is first and foremost, "Take care when writing and planning loops to avoid infinite loops." The following is another classic example of an infinite loop that will certainly cause problems for your game, so be sure to avoid them:</p><div class="informalexample"><pre class="programlisting">//Loop forever
while(true)
{
}</pre></div><p>However, believe it or not, there are times when infinite loops are technically what you need for your game under the right conditions! If you need a moving platform to travel up and down endlessly, a magical orb to continually spin round and round, or a day-night cycle to perpetually repeat, then an infinite loop can be serviceable, provided it's implemented appropriately. Later in this book, we'll see examples where infinite loops can be put to good use. Loops are powerful, fun structures, but when coded inappropriately, whether infinite or not, they can be the source of crashes, stalls, and performance issues, so take care. In this book, we'll see good practices for creating loops.</p></div></div>