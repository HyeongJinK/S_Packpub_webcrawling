<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec87"></a>Property exposing</h2></div></div><hr /></div><p>By default, the Object<a id="id643" class="indexterm"></a> Inspector displays all public member variables of a class unless it's in <span class="strong"><strong>Debug</strong></span> mode or a private member is explicitly marked with the<a id="id644" class="indexterm"></a> <code class="literal">SerializeField</code> attribute and in these cases private member variables will be shown too:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_10.jpg" /><div class="caption"><p>Property accessing from the Object Inspector</p></div></div><p>However, C# properties will never be displayed by default, either in <span class="strong"><strong>Release</strong></span> or <span class="strong"><strong>Debug</strong></span> mode. As discussed in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Unity C# Refresher</em></span>, C# properties act like accessor functions to a variable. They essentially permit validation on each <code class="literal">get</code> and <code class="literal">set</code> operation because every <code class="literal">get</code> and <code class="literal">set</code> operation entails an internal function call. However, regardless of Unity's limitation in the Object Inspector, it's possible to write an editor extension that will show all properties for a class in the Object Inspector, which allows you to get and set the values directly. This section considers how in more detail. Again, we'll have reason to rely heavily on reflection.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip58"></a>Tip</h3><p>More information on the <a id="id645" class="indexterm"></a>
<code class="literal">SerializeField</code> class can be found in the online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/SerializeField.html" target="_blank">http://docs.unity3d.com/ScriptReference/SerializeField.html</a>.</p></div><p>Consider the following code sample 8-8 that features a few properties:</p><div class="informalexample"><pre class="programlisting"> //----------------------------------------------
 using UnityEngine;
 using System.Collections;
 //----------------------------------------------
 [System.Serializable]
 public class ClassWithProperties : System.Object
 {
    //Class with some properties
    //----------------------------------------------
<span class="strong"><strong>    public int MyIntProperty</strong></span>
    {
          get{return _myIntProperty;}â€©
          //Performs some validation on values
    set{if(value &lt;= 10)_myIntProperty = value;else _myIntProperty=0;}
    }
    //----------------------------------------------
 <span class="strong"><strong>   public float MyFloatProperty</strong></span>
   {
          get{return _myFloatProperty;}
          set{_myFloatProperty = value;}
   }
    //----------------------------------------------
<span class="strong"><strong>    public Color MyColorProperty</strong></span>
   {
          get{return _myColorProperty;}
          set{_myColorProperty = value;}
    }
    //----------------------------------------------
    //Private members
    private int _myIntProperty;
    private float _myFloatProperty;
    private Color _myColorProperty;
    //----------------------------------------------
 }
 //----------------------------------------------</pre></div><p>This class will be used internally by a different class as a public member, as shown in the following code sample 8-9:</p><div class="informalexample"><pre class="programlisting"> using UnityEngine;
 using System.Collections;
 
 public class LargerClass : MonoBehaviour 
 {
    public ClassWithProperties MyPropClass;
 }</pre></div><p>By default, the public <code class="literal">MyPropClass</code> member (although tagged as <code class="literal">System.Serializable</code>) will not show its members in the Object Inspector. This is because C# properties are not natively supported:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_11.jpg" /><div class="caption"><p>By default, the Object Inspector will not render the C# properties</p></div></div><p>To solve this issue, we can return to the <code class="literal">PropertyDrawer</code> class; this time associating the class with a specific class rather than an attribute, as shown in the following code sample 8-10:</p><div class="informalexample"><pre class="programlisting">01 //Custom Editor class to expose global properties of a class
02 //----------------------------------------------
03 using UnityEngine;
04 using UnityEditor;
05 using System.Collections;
06 using System.Reflection;
07 //----------------------------------------------
<span class="strong"><strong>08 [CustomPropertyDrawer(typeof(ClassWithProperties))]</strong></span>
09 public class PropertyLister : PropertyDrawer
10 {
11 //Height of inspector panel
<span class="strong"><strong>12 float InspectorHeight = 0;</strong></span>
13 
14 //Height of single row in pixels
<span class="strong"><strong>15 float RowHeight = 15;</strong></span>
16 
17 //Spacing between rows
18 float RowSpacing = 5;
19 
20 // Draw the property inside the given rect
21 public override void OnGUI(Rect position, SerializedProperty property, GUIContent label) 
22 {
23        EditorGUI.BeginProperty(position, label, property);
24 
25        //Get referenced object
<span class="strong"><strong>26        object o = property.serializedObject.targetObject;</strong></span>
<span class="strong"><strong>27 ClassWithProperties CP = o.GetType().GetField(property.name).GetValue(o) as ClassWithProperties;</strong></span>
28 
29        int indent = EditorGUI.indentLevel;
30        EditorGUI.indentLevel = 0;
31 
32       //Layout
33 Rect LayoutRect = new Rect(position.x, position.y, position.width, RowHeight);
34 
35       //Find all properties for object
<span class="strong"><strong>36 foreach(var prop in typeof(ClassWithProperties).GetProperties(BindingFlags.Public | BindingFlags.Instance))</strong></span>
37       {
38              //If integer property
39              if(prop.PropertyType.Equals(typeof(int)))
40              {
41 prop.SetValue(CP, EditorGUI.IntField(LayoutRect, prop.Name, (int)prop.GetValue(CP,null)), null);

42 LayoutRect = new Rect(LayoutRect.x, LayoutRect.y + RowHeight+RowSpacing, LayoutRect.width, RowHeight);
43              }
44 
45             //If float property
46             if(prop.PropertyType.Equals(typeof(float)))
47             {
48 prop.SetValue(CP, EditorGUI.FloatField(LayoutRect, prop.Name, (float)prop.GetValue(CP,null)), null);

49 LayoutRect = new Rect(LayoutRect.x, LayoutRect.y + RowHeight+RowSpacing, LayoutRect.width, RowHeight);
50             }
51 
52             //If color property
53              if(prop.PropertyType.Equals(typeof(Color)))
54              {
55 prop.SetValue(CP, EditorGUI.ColorField(LayoutRect, prop.Name, (Color)prop.GetValue(CP,null)), null);

56 LayoutRect = new Rect(LayoutRect.x, LayoutRect.y + RowHeight+RowSpacing, LayoutRect.width, RowHeight);
57             }
58        }
59 
60        //Update inspector height
61        InspectorHeight = LayoutRect.y-position.y;
62 
63        EditorGUI.indentLevel = indent;
64        EditorGUI.EndProperty();
65 }
66 //----------------------------------------------
67 //This function returns how high (in pixels) the field should be
68 //This is to make controls not overlap
69 public override float GetPropertyHeight (SerializedProperty property, GUIContent label)
70 {
<span class="strong"><strong>71        return InspectorHeight;</strong></span>
72 }
73 //----------------------------------------------
74 }
75 //----------------------------------------------</pre></div><p>The following are the comments for code sample 8-10:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Line 08</strong></span>: Notice that the <code class="literal">CustomPropertyDrawer</code> attribute is now associated with a regular class as opposed to an attribute. In this case, the rendering of a specific class is being customized for the Object Inspector as opposed to various properties of different types, which can share a common attribute.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 12-18</strong></span>: Some public members are declared, primarily to calculate the height (in pixels) of a single row in the Object Inspector. By default, the Object Inspector allocates one row (or line) for our custom rendering and all drawing is supposed to fit within that space. If the total height of our rendering exceeds the height of one line, all additional controls and data will overlap and mix with controls and widgets beneath. To address this problem, the <code class="literal">GetPropertyHeight</code> (at line 69) function can be used to return a pixel height allocated for our custom drawing.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 26-27</strong></span>: These lines are especially important. They use reflection to retrieve a type-correct object reference to the <code class="literal">ClassWithProperties</code> instance currently being drawn for this call to <code class="literal">OnGUI</code>. Specifically, a reference to <code class="literal">targetObject</code> is retrieved (the object selected), and then an instance to <code class="literal">ClassWithProperties</code> is retrieved from that. The result is that this code gives us direct and immediate access to the <code class="literal">ClassWithProperties</code> object.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lines 37-58</strong></span>: Each public property on the object is cycled in sequence, and for valid or supported data types, an inspector property is drawn that allows both read/write access to the property, provided the property itself supports both methods.</p></li></ul></div><p>The following screenshot shows the C# properties:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_08_12.jpg" /><div class="caption"><p>Accessing C# properties</p></div></div></div>