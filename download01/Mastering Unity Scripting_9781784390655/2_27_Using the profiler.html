<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec32"></a>Using the profiler</h2></div></div><hr /></div><p>One additional tool that's used partly for debugging and partly for optimization is the <span class="strong"><strong>Profiler</strong></span> window, which is available only in Unity Pro by clicking on the <span class="strong"><strong>Profiler</strong></span> tab in <span class="strong"><strong>Window</strong></span> in the application menu, as shown in the following screenshot. In short, the profiler gives you a statistical top-down view of how time and workload is distributed across the different parts of your game and across system hardware components, such as the CPU and graphics card. Using profiler, you can determine, for example, how much time is consumed by camera<a id="id176" class="indexterm"></a> rendering in the scene compared to physics calculations or to audio functionality, as well as to other categories. It lets you measure performance, compare numbers, and assess where performance can be improved. The profiler is not really a tool that alerts you to the presence of bugs in your code specifically. However, if you're experiencing performance problems in running the game, such as lags and freezes, then it could guide you to where optimizations can be made. For this reason, the profiler is a tool to which you'll turn if you decide that performance is an issue for your game and you need an educated, studied analysis of where to start implementing improvements.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_02_13.jpg" /><div class="caption"><p>The profiler is typically used to diagnose performance issues</p></div></div><p>When you run your game with the <span class="strong"><strong>Profiler</strong></span> window open, the graph will populate with statistics about the most recent frames. The profiler doesn't usually record information about all the frames since the game began, but only the most recent ones as will fit into memory sensibly. There is a toggleable "deep profile" method available in the upper toolbar of the <span class="strong"><strong>Profiler</strong></span> <a id="id177" class="indexterm"></a>window, which allows you (in theory) to get extra information about your game, but I'd recommend that you avoid this mode. It can cause performance issues with the Unity Editor when running asset-heavy and code-heavy games, and it can even freeze the editor altogether. Instead, I'd recommend that you only use the default mode. When using this mode, in most cases, you'll want to disable the visualization of <span class="strong"><strong>VSync</strong></span> from the <span class="strong"><strong>CPU Usage</strong></span> area to get a better view of other performance statistics, including <span class="strong"><strong>Rendering</strong></span> and <span class="strong"><strong>Scripts</strong></span>, as shown in the following screenshot. To do this, simply click on the <span class="strong"><strong>VSync</strong></span> icon in the graph index area:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_02_14.jpg" /><div class="caption"><p>Disabling the VSync display from the CPU usage area in the Profiler window</p></div></div><p>The horizontal axis of the graph represents framesâ€”the most recent frames added to the memory buffer. This axis keeps populating with new data while the game is running. The vertical axis represents time or computational expense: higher values are expressive of a more demanding and slower frame time. After the graph is filled with some data during the <span class="strong"><strong>Play</strong></span> mode, you can pause the game to examine its state. Select the frames from the graph to view more information on game performance during that frame. When you do this, the <span class="strong"><strong>Hierarchy</strong></span> panel in the bottom half of the <span class="strong"><strong>Profile</strong></span> window fills with function data about the code that is being executed on the selected frame. When viewing the graph, it's good practice<a id="id178" class="indexterm"></a> to watch for sudden increases (peaks or spikes), as shown in the following screenshot. These indicate frames of sudden and intense activity. Sometimes, they can be one-off occurrences that are either unavoidable due to hardware operations or that happen legitimately and are not the source of performance problems, such as scene transitions or loading screens.</p><p>However, they can indicate trouble too, especially if they happen regularly. So, when diagnosing performance issues, looking for spikes is a good place to start your investigation.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_02_15.jpg" /><div class="caption"><p>Selecting a frame from the profiler graph</p></div></div><p>The <span class="strong"><strong>Hierarchy</strong></span> view lists all the main functions and events in code that executes on the selected frame. For each<a id="id179" class="indexterm"></a> function, there are several crucial properties such as <span class="strong"><strong>Total</strong></span>, <span class="strong"><strong>Self</strong></span>, <span class="strong"><strong>Time ms</strong></span>, and <span class="strong"><strong>Self ms</strong></span>, which are shown here:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_02_16.jpg" /><div class="caption"><p>Examining function calls during selected frames</p></div></div><p>Let' s discuss these crucial properties in more detail:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Total and Time ms</strong></span>: The <span class="strong"><strong>Total</strong></span> column represents the proportion of frame time consumed by the function. The value of <span class="strong"><strong>49.1%</strong></span>, for example, means that 49.1 percent of the total time required for the selected frame was consumed by the function, including any time taken to call subfunctions (functions called within the function). The <span class="strong"><strong>Time ms</strong></span> column expresses the frame consumption time in absolute terms, measured in milliseconds. Together, these two values give you both a relative and absolute measure of how expensive calling the function is on each frame and in total.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Self and Self ms</strong></span>: The <span class="strong"><strong>Total</strong></span> and <span class="strong"><strong>Total ms</strong></span> settings measure the expense of the function for the selected frame, but they include the total time spent inside other functions that were invoked from within the function. Both <span class="strong"><strong>Self</strong></span> and <span class="strong"><strong>Self ms</strong></span> exclude this time and express only the total time spent within the function, minus any <a id="id180" class="indexterm"></a>additional time waiting for other functions to complete. These values are often the most important when seeking to pinpoint a specific function that causes performance problems.</p></li></ul></div><p>More information on the <a id="id181" class="indexterm"></a>Unity Profiler can be found at <a class="ulink" href="http://docs.unity3d.com/Manual/ProfilerWindow.html" target="_blank">http://docs.unity3d.com/Manual/ProfilerWindow.html</a>.</p></div>