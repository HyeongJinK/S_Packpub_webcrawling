<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec73"></a>Baking a navigation mesh</h2></div></div><hr /></div><p>The enemy to be created needs to walk intelligently around the level to find and chase the player as well as to find health-restore power-ups. The AI cannot simply walk in a straight line between any <a id="id538" class="indexterm"></a>two points, as there might be intervening obstacles such as walls and other characters. The AI should instead navigate around these objects when they're encountered. To achieve this in the long term, a navigation mesh should be used. This is an invisible mesh asset that Unity generates automatically to approximate all walkable, horizontal surfaces in the level, that is, surfaces classified as a floor. The navigation mesh itself contains no AI. It does not make anything walk. The navigation mesh is rather a mathematical model that contains all the necessary data that allows AI units to successfully calculate and travel a path that avoids obstacles as and when required. To generate a navigation mesh for the level, select the <span class="strong"><strong>Navigation</strong></span> option from the <span class="strong"><strong>Window</strong></span> tab of the application menu. This displays the <span class="strong"><strong>Navigation Mesh</strong></span> tab, which can be docked into the Object Inspector.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip49"></a>Tip</h3><p>For the basics on<a id="id539" class="indexterm"></a> navigation mesh baking, see the online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/Manual/Navmeshes.html" target="_blank">http://docs.unity3d.com/Manual/Navmeshes.html</a>.</p></div><p>When baking a navigation mesh, there are some additional details to keep in mind, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_07_05.jpg" /><div class="caption"><p>Preparing to bake a navigation mesh</p></div></div><p>First, the <span class="strong"><strong>Radius</strong></span> setting will likely require adjusting from its default. In short, this setting defines an imaginary circle around the feet of your characters; this circle indicates their approximate size as walking<a id="id540" class="indexterm"></a> agents. If the radius is too large, the navigation mesh appears broken or fractured, and if it is too small, the mesh takes a long time to generate, and additionally, your agents will penetrate through walls while walking. A certain degree of trial and error and refinement lets you reach a value that works best for your project. For this sample, a value of 0.2 works best. If the radius is too high, your navigation mesh will fracture in narrow areas, which is not good because agents cannot travel across gaps, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_07_06.jpg" /><div class="caption"><p>Navigation mesh fracture in narrow areas</p></div></div><p>Second, a navigation mesh (once generated) might appear raised above or offset upwards, away from the true mesh floor. If this happens, you could reduce the <span class="strong"><strong>Height Inaccuracy %</strong></span> setting to <code class="literal">1</code> from<a id="id541" class="indexterm"></a> the <span class="strong"><strong>Advanced</strong></span> group, as shown in the following screenshot. This prevents your agents from appearing to hover in midair. Remember that after adjusting any settings, you need to rebake the navigation mesh to apply the changes.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_07_07.jpg" /><div class="caption"><p>Reducing Height Inaccuracy % moves the generated navigation mesh closer to the true floor</p></div></div><p>From the figures, you can see that the maze scene features two separate maze areas (left and right) with no connecting mesh between them that allows the creation of a path. For this sample, the intelligent agents should be able to move freely between each section using a teleporter to transport them from one area to another, if required.</p><p>To achieve a connection like this between a break in the navigation mesh that allows the AI to compute valid paths<a id="id542" class="indexterm"></a> across surfaces, we could use off-mesh links. Add a new mesh to the level that should act as a teleporter pad or platform when stepped upon. For this example, I used a standard box mesh with a particle system for enhanced effect, but this is not essential. Then, attach an off-mesh link component to the mesh object, as shown here:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_07_08.jpg" /><div class="caption"><p>Creating a teleporter pad using off-mesh links</p></div></div><p>Repeat the procedure for the destination teleporter pad. For each teleporter, assign the object's transform to the <span class="strong"><strong>Start</strong></span> field of the off-mesh link component. This indicates the selected teleporter as the start point. Then, for the <span class="strong"><strong>End</strong></span> field, assign the destination transform. This establishes a connection between the two teleporters that creates a path between them. When the connection is established, a connection arrow should be drawn in-between the scene viewport when the <span class="strong"><strong>Navigation</strong></span> panel is open and active in the editor, as shown in the following screenshot. You can also generate <a id="id543" class="indexterm"></a>off-mesh links automatically. For more information, visit <a class="ulink" href="https://www.youtube.com/watch?v=w3-sSozYph4" target="_blank">https://www.youtube.com/watch?v=w3-sSozYph4</a>.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_07_09.jpg" /><div class="caption"><p>Defining a connection between off-mesh links</p></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip50"></a>Tip</h3><p>The starting <a id="id544" class="indexterm"></a>project for this chapter, ready for AI coding, can be found in the book's companion files (code bundle) in the <code class="literal">Start</code> folder of this chapter.</p></div></div>