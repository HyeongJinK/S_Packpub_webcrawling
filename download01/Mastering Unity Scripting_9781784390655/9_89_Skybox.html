<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec90"></a>Skybox</h2></div></div><hr /></div><p>The Skybox might seem<a id="id658" class="indexterm"></a> a strange place to begin an analysis of 2D, but it demonstrates an important feature set for cameras, specifically layering. The Skybox is essentially a cube-based background that's attached to a camera to show clouds, skies, and other distant details that should always act as the backdrop to a scene, but it never represents anything that the player can move close to. It is always distant, as shown here:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_01.jpg" /><div class="caption"><p>Skybox assets display a sky background for cameras</p></div></div><p>The main problem with the default Skyboxes native to Unity is that they remain static and motionless by default. Most developers, however, want their skies and clouds to gently rotate, even when<a id="id659" class="indexterm"></a> the camera is standing motionless, to portray the procession of a day or of time passing. Now, let's create an improved Skybox prefab using the Unity Skybox assets, two layered cameras, and a C# script file.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip61"></a>Tip</h3><p>The final project for a rotating Skybox can be found in the book's companion files.</p></div><p>For the sample project created here, let's import the <span class="strong"><strong>Character Controllers</strong></span> package for a first-person controller asset, the <span class="strong"><strong>Terrain Assets</strong></span> package for terrain textures that we can paint onto a sample terrain, and the <span class="strong"><strong>Skyboxes</strong></span> package for the Skybox textures, as shown in the following screenshot.</p><p>All these will be useful in building a sample project with a rotating Skybox.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_02.jpg" /><div class="caption"><p>Importing Character Controllers, Skyboxes, and Terrain Assets</p></div></div><p>Next, let's begin by creating the rotating Skybox prefab to make a reusable object. This object consists of three main parts or subobjects: a first-person controller that allows player movement and renders most scene objects, a second camera (the Skybox camera) that is rendered below<a id="id660" class="indexterm"></a> the first-person camera and shows only the Skybox, and a cube object with inverted normals that surrounds the Skybox camera and shows each Skybox texture on each face.</p><p>To start, create a new empty object at the scene origin (named <code class="literal">SkyBoxCamera</code>) and add a first-person controller object as a child. Then, create six <span class="strong"><strong>Quad</strong></span> objects from the main menu (by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Quad</strong></span>), aligning each object to the corners of the other, with the vertex snapping to form an inverted cube, that is, a cube whose faces are turned inwards, as shown in the following screenshot. This represents the mesh for the manual Skybox.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_03.jpg" /><div class="caption"><p>Create a manual Skybox from six Quad objects</p></div></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip62"></a>Tip</h3><p>Scale the Quads if required and make sure that they contain and enclose the first-person controller, which should be at the center of the Skybox.</p></div><p>Assign the Skybox faces<a id="id661" class="indexterm"></a> to a new layer, <code class="literal">SkyBoxLayer</code>, select the first-person controller camera, and then change the <span class="strong"><strong>Culling Mask</strong></span> field to exclude the <code class="literal">SkyBoxLayer</code> layer. The first-person camera should render only foreground objects and not background ones. To achieve this, change the <span class="strong"><strong>Clear Flags</strong></span> field to <span class="strong"><strong>Depth only</strong></span> in the Object Inspector, as shown in the following screenshot. This renders the camera background to transparent, which allows lower-order cameras to show through, if any.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_04.jpg" /><div class="caption"><p>Making the camera background transparent</p></div></div><p>Now, create a new and additional <code class="literal">Camera</code> object as a direct child object of the first-person camera and match its position, rotation, and scale. This allows the camera to inherit all the transformations from the first-person camera. The purpose of the secondary camera is to render only<a id="id662" class="indexterm"></a> the Skybox object as a layer beneath the first-person camera while matching the first-person position and rotation.</p><p>To this end, change the <span class="strong"><strong>Depth</strong></span> value of the new camera to any value less than the depth of the first-person camera; such as <code class="literal">-1</code>. Remove any audio listener components where required.</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_05.jpg" /><div class="caption"><p>Creating a second camera for Skybox rendering</p></div></div><p>Assign a unique Skybox texture to each cube face and take care to align them seamlessly by rotating or adjusting<a id="id663" class="indexterm"></a> the Quad alignment as needed. Then, change the material <span class="strong"><strong>Shader</strong></span> type for the Skybox textures to <span class="strong"><strong>Unlit/Texture</strong></span>, making the Skybox immune to scene lighting. The Skybox mesh should start taking shape, as shown here:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_06.jpg" /><div class="caption"><p>Adding Skybox textures to the Quads</p></div></div><p>Finally, apply the following code sample 9-1 to the Skybox parent object to create its rotation behavior and to <a id="id664" class="indexterm"></a>align it continuously to the camera position. This ensures that the Skybox is always centered on the camera wherever it travels in the scene:</p><div class="informalexample"><pre class="programlisting">01 //--------------------------------------------------
02 using UnityEngine;
03 using System.Collections;
04 //--------------------------------------------------
05 public class SkyBox : MonoBehaviour 
06 {
07 //--------------------------------------------------
08 //Camera to follow
09 public Camera FollowCam = null;
10 
11 //Rotate Speed (Degrees per second)
12 public float RotateSpeed = 10.0f;
13 
14 //Transform
15 private Transform ThisTransform = null;
16 //--------------------------------------------------
17 // Use this for initialization
18 void Awake () {
19       ThisTransform = transform;
20 }
21 //--------------------------------------------------
22 // Update is called once per frame
23 void Update () {
24        //Update position
25        ThisTransform.position = FollowCam.transform.position;
26 
27        //Update rotation
28 ThisTransform.Rotate(new Vector3(0,RotateSpeed * Time.deltaTime,0));
29 }
30 //--------------------------------------------------
31 }
32 //--------------------------------------------------</pre></div><p>From this, you now have a completed and enhanced Skybox, one that surrounds the camera and rotates to produce<a id="id665" class="indexterm"></a> greater realism and life in your scenes. You can even go further by adding multiple stacked skyboxes within each other, each with transparency, to create additional effects such as fog, mist, and so on:</p><div class="mediaobject"><img src="/graphics/9781784390655/graphics/0655OT_09_07.jpg" /><div class="caption"><p>Completing a manual Skybox prefab</p></div></div></div>