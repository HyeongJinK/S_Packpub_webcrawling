<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec26"></a>Data structures</h2></div></div><hr /></div><p>Now that we know the instruction set of our dungeon creation, we need to figure out how we plan to store the<a id="id168" class="indexterm"></a> dungeon board. We are building the Dungeon Board in a similar manner that we built the world board, so we might be able to use similar data structures. There are enough differences though, that we will need to evaluate what works best.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec27"></a>Back to the map</h3></div></div></div><p>We are using a dictionary<a id="id169" class="indexterm"></a> to store our world board because it has an easy and fast lookup method, plus it can be added to dynamically. For all those same reasons, we can use a dictionary to store the important points in our dungeon. Remember, we don't need to know every point in the dungeon, we only need to know the essential and random paths.</p><p>The tricky part is that we need to place the essential path first but then revisit every point in the path to potentially add a random branch. There is the option to iterate over the dictionary where we are storing our dungeon. However, we will be adding new points to the dictionary and will need to iterate over those as well. The reason being, a random branch from the essential path can continue on in its own direction.</p><p>A random path can move off in any direction and possibly circle back by itself. This would add two of the same entries to our dictionary but our dictionary requires every entry to be unique, which means we cannot have two of the same entry. We want to allow this circling and possible branching of already declared random paths because that's going to give us more possible dungeons variations.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_11.jpg" /><div class="caption"><p>A diagram of a path cycling back</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec28"></a>Queue</h3></div></div></div><p>So we need a data structure that will allow identical entries but also keep track of where and when to branch. This is a good situation to employ a <span class="strong"><strong>Queue</strong></span>. A queue is an array or list that we populate with <a id="id170" class="indexterm"></a>entries in some order and then remove those entries in some order. This <a id="id171" class="indexterm"></a>works for us because we can add a point into the queue that may branch, add the branch point, and then remove the original point so we don't revisit it. To do this, we will be using a queue access and processing called <span class="strong"><strong>FIFO</strong></span>.</p><p>FIFO stands for <span class="strong"><strong>first in first out</strong></span>. What this means is that when we add a point to the queue, it will go to the<a id="id172" class="indexterm"></a> end of the line. The first entry in the queue will be processed <a id="id173" class="indexterm"></a>and removed, and the next point in the list will take the first spot. This will happen till the list is empty. This is very similar to standing in a line at a bank.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_12.jpg" /><div class="caption"><p>A diagram of a queue</p></div></div><p>So, let's go over how the queue will operate for our dungeon:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Once our essential path is created, we can add the points (entrance to exit) to the queue</p></li><li style="list-style-type: disc"><p>We will then process in FIFO</p><p>If a point randomly branches, then we will add that point to the end of the queue</p></li><li style="list-style-type: disc"><p>Whether the point branches or not, it will be removed from the queue and we will process the next point in line</p></li><li style="list-style-type: disc"><p>Eventually, we will process all of the essential path points and begin processing the random paths in the same manner</p></li><li style="list-style-type: disc"><p>This will repeat until no more random paths have been created</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_13.jpg" /><div class="caption"><p>Diagram of essential path in queue</p></div></div></li></ul></div><p>Our algorithm and data structures have been finalized. We are ready to<a id="id174" class="indexterm"></a> start implementing. We just need to set a few things up in the Unity editor before we start.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec29"></a>Prefab setup</h3></div></div></div><p>There is some setup that we will need to perform in the Unity editor. We will be making a new prefab. We will <a id="id175" class="indexterm"></a>continue adding to the <span class="emphasis"><em>Roguelike</em></span> project we have been building from <a class="link" href="#" linkend="ch02">Chapters 2</a>, <span class="emphasis"><em>Roguelike Games</em></span> and <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Generating an Endless World</em></span>, so continue from the same project and scene.</p><p>The one thing our dungeon<a id="id176" class="indexterm"></a> design lacks at the moment is a way in and a way out. We need to create a doorway so the player knows where they can enter a dungeon. Likewise, while in a dungeon, we need the same kind of door to signify an exit.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec30"></a>An exit sign</h3></div></div></div><p>In the sprite sheet that was<a id="id177" class="indexterm"></a> initially loaded with the base code during <a class="link" href="#" linkend="ch02">Chapters 2</a>, <span class="emphasis"><em>Roguelike Games</em></span>, we have a<a id="id178" class="indexterm"></a> sprite of an exit sign. We can use this same sprite as both an entrance to the dungeon and an exit from it to save us time. You can easily change the artwork later if you wish or if you are not using the base game assets, you can just follow along in how we build the prefab.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_15.jpg" /><div class="caption"><p>Image of exit tile sprite</p></div></div><p>So let's make a prefab from the exit sign art as the floor and wall tiles:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the top menu, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span>.</p></li><li><p>Select the new empty object in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>Name the object <code class="literal">Exit</code>.</p></li><li><p>Add the tag <span class="strong"><strong>Exit</strong></span>.</p></li><li><p>Select the <span class="strong"><strong>Add Component</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> tab and add the <span class="strong"><strong>Sprite Renderer</strong></span> and <span class="strong"><strong>Box Collider 2D</strong></span> components.</p></li><li><p>In the <span class="strong"><strong>Sprite</strong></span> field of the <span class="strong"><strong>Sprite Renderer</strong></span> component, select <span class="strong"><strong>Scavangers_SpriteSheet_20</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Sorting Layer</strong></span> field of the <span class="strong"><strong>Sprite Renderer</strong></span> component, add a new sorting layer <span class="strong"><strong>Items</strong></span>. <span class="strong"><strong>Items</strong></span> should come after <span class="strong"><strong>Floor</strong></span> but before <span class="strong"><strong>Units</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_14.jpg" /><div class="caption"><p>An image of sorting layer order</p></div></div></li><li><p>In the <span class="strong"><strong>Box Collider 2D</strong></span> component, check <span class="strong"><strong>Is Trigger</strong></span>.</p></li><li><p>Drag and <a id="id179" class="indexterm"></a>drop the <span class="strong"><strong>Exit</strong></span> prefab from the <span class="strong"><strong>Hierarchy</strong></span> panel to the <span class="strong"><strong>Prefabs</strong></span> folder.</p></li><li><p>Delete the <span class="strong"><strong>Exit</strong></span> prefab from the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li></ol></div><p>This completes the setup for our doorway to and from our dungeons. We will refer the exit tile in code as we implement the dungeon generator. We are going to build a new class around the dungeon generation.</p></div></div>