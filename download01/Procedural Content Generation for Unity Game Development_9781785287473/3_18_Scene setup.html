<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec22"></a>Scene setup</h2></div></div><hr /></div><p>Now that we chose a data structure and designed our algorithm, we need to set up our scene. At the moment, at the start of our game, the player character shows up in the corner of the<a id="id107" class="indexterm"></a> screen with a black backdrop. The player can move in four directions but could potentially move off screen. The player can also move under the text that shows the player's health. We should fix this so that we can better see our PCG algorithm in action.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec15"></a>Player positioning</h3></div></div></div><p>Previously, we said that a starting grid of 5 x 5  for our initial Game Board would be a good metric. So<a id="id108" class="indexterm"></a> let's continue with a 5 x 5 Game Board in mind. If our 5 x 5 grid starts with the X-Y coordinate or (0,0) in the lower-left corner and (4,4) in the upper-right corner, then (2,2) will be the center of the grid. Select the <span class="strong"><strong>Player</strong></span> prefab in the <span class="strong"><strong>Hierarchy</strong></span> panel and set both the X and Y values to <code class="literal">2</code>.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808-03-10.jpg" /><div class="caption"><p>The grid will correspond with the x-y plane</p></div></div><p>Each sprite in <a id="id109" class="indexterm"></a>our sprite sheet is 32 x 32 pixels. When the sprite sheet was imported, the Pixels to Units import setting was set to 32 pixels equals 1 Unity unit of measure. So our Game Board will align precisely with the Unity x-y plane. We can then build our Game Board around our player character starting at (0,0) in the lower-left corner. This same unit of measure will be used to track our player's position.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808-03-11.jpg" /><div class="caption"><p>All our sprites are 32 x 32, which is 1 unit of measure</p></div></div><p>We changed<a id="id110" class="indexterm"></a> the position of the player character, but that doesn't prevent the player from being able to walk off screen. We need a way to keep the player character in sight at all times. We can write a script that makes it possible for the player to only move as far as the screen edge but that doesn't make sense since our Game Board is infinite. Instead, we can have the camera move with the player.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec16"></a>Camera following</h3></div></div></div><p>Unity makes it<a id="id111" class="indexterm"></a> easy to have a camera follow the player. There is a script in the Unity Standard Assets called <code class="literal">Camera2DFollow.cs</code>. We will simply import the script, which is included when you download Unity. We can then adjust the settings to suit our needs.</p><p>To import the script, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the top menu, navigate to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>2D</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Importing package</strong></span> popup, select <span class="strong"><strong>None</strong></span> to uncheck all the options.</p></li><li><p>Find and check the <code class="literal">Camera2DFollow.cs</code> package by navigating to the <span class="strong"><strong>2D</strong></span> | <span class="strong"><strong>Scripts</strong></span> directory.</p></li><li><p>Click on <span class="strong"><strong>Import</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808-03-12.jpg" /><div class="caption"><p>Import settings</p></div></div></li></ol></div><p>You will have a <span class="strong"><strong>Standard Assets</strong></span> folder added to your project. Inside the <span class="strong"><strong>Standard Assets</strong></span> folder is <span class="strong"><strong>2D</strong></span> | <span class="strong"><strong>Scripts</strong></span> | <span class="strong"><strong>Camera2DFollow.cs</strong></span>. Drag and drop the <span class="strong"><strong>Camera2DFollow</strong></span> <a id="id112" class="indexterm"></a>script onto the <span class="strong"><strong>Main Camera</strong></span>. Then, from the <span class="strong"><strong>Hierarchy</strong></span> pane, drag and drop the <span class="strong"><strong>Player</strong></span> prefab onto the <span class="strong"><strong>Target</strong></span> field in the <span class="strong"><strong>Camera2DFollow</strong></span> script component of the <span class="strong"><strong>Main Camera</strong></span>.</p><p>We are going to change the other settings as well:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Damping</strong></span> field to <code class="literal">1</code></p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Look Ahead Factor</strong></span> field to <code class="literal">1</code></p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Look Ahead Return Speed</strong></span> field to <code class="literal">0.5</code></p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Look Ahead Move Threshold</strong></span> field to <code class="literal">0.1</code></p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808-03-13.jpg" /><div class="caption"><p>The Camera 2D Follow settings screen</p></div></div></li></ul></div><p>You are welcome to experiment with the settings. There might be another set of values that you think looks better. However, this setup works without being too jerky.</p><p>So now, when<a id="id113" class="indexterm"></a> you start the game by pressing the play button, the Main Camera will snap to the player character. You can try walking around to test the camera follow settings. Then, after you are satisfied with how the camera follows the player, we will need to make some layer adjustments.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808-03-14.jpg" /><div class="caption"><p>No Game Board</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec17"></a>Layers</h3></div></div></div><p>Even though our game is 2D and takes place on only one visible plane, we can still place game objects on different layers to manage how things interact. So, we will add some layers to manage<a id="id114" class="indexterm"></a> how the player interacts with their environment:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Select the <span class="strong"><strong>Player</strong></span> prefab from the <span class="strong"><strong>Hierarchy</strong></span> panel</p></li><li style="list-style-type: disc"><p>Select the <span class="strong"><strong>Layer</strong></span> field dropdown</p></li><li style="list-style-type: disc"><p>Select <span class="strong"><strong>Add Layerâ€¦</strong></span> from the dropdown</p></li><li style="list-style-type: disc"><p>Add <code class="literal">BlockingLayer</code>, <code class="literal">Floor</code>, and <code class="literal">Units</code> as layer labels to any empty field (do not overwrite any existing field)</p></li><li style="list-style-type: disc"><p>Then, select the <span class="strong"><strong>Sorting Layers</strong></span> dropdown on the same screen</p></li><li style="list-style-type: disc"><p>Add <code class="literal">Floor</code> and <code class="literal">Units</code> as <span class="strong"><strong>Sorting Layer</strong></span> labels, in that order</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note12"></a>Note</h3><p>These layers might have been added from the import process in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Roguelike Games</em></span> but this is not guaranteed.</p></div><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808-03-15.jpg" /><div class="caption"><p>The Layer settings</p></div></div></li></ul></div><p>The layers will help <a id="id115" class="indexterm"></a>us divide tiles into specific regions of interest. Game objects that are impassable or can prevent the player from moving will be placed on the <code class="literal">BlockingLayer</code>. The <span class="strong"><strong>Player</strong></span> prefab and wall tiles will be on the <code class="literal">BlockingLayer</code> because the player should not simply be able to walk through walls.</p><p>The sorting layer is important because it will dictate which sprites are rendered first. We want the player character to render on top of the floor tiles. The layers at the top of the <span class="strong"><strong>Sorting Layers</strong></span> list are rendered first. So we place the <code class="literal">Floor</code> layer higher in the list so that it is rendered before the player character.</p><p>Now, we have to<a id="id116" class="indexterm"></a> select the <span class="strong"><strong>Layer</strong></span> and <span class="strong"><strong>Sorting Layer</strong></span> in the <span class="strong"><strong>Sprite Renderer</strong></span> component of our <span class="strong"><strong>Player</strong></span> prefab, floor tiles, and wall tiles.</p><p>For the <span class="strong"><strong>Player</strong></span> prefab, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <span class="strong"><strong>Player</strong></span>.</p></li><li><p>Select the <span class="strong"><strong>Layer</strong></span> dropdown.</p></li><li><p>Select <span class="strong"><strong>BlockingLayer</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Sprite Renderer</strong></span> component, select the <span class="strong"><strong>Sorting Layer</strong></span> dropdown.</p></li><li><p>Select <span class="strong"><strong>Units</strong></span>.</p></li></ol></div><p>For the floor tiles, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> tab, select the <span class="strong"><strong>Prefabs</strong></span> folder.</p></li><li><p>Select <span class="strong"><strong>Floor1</strong></span> to <span class="strong"><strong>Floor8</strong></span> at the same time using the <span class="emphasis"><em>Shift</em></span> or <span class="emphasis"><em>command</em></span> key.</p></li><li><p>In the <span class="strong"><strong>Sprite Renderer</strong></span> component, select the <span class="strong"><strong>Sorting Layer</strong></span> dropdown.</p></li><li><p>Select <span class="strong"><strong>Floor</strong></span>.</p></li></ol></div><p>For the wall tiles, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> tab, select the <span class="strong"><strong>Prefabs</strong></span> folder.</p></li><li><p>Select <span class="strong"><strong>Wall1</strong></span> to <span class="strong"><strong>Wall8</strong></span> at the same time.</p></li><li><p>Select the <span class="strong"><strong>Layer</strong></span> dropdown.</p></li><li><p>Select <span class="strong"><strong>BlockingLayer</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Sprite Renderer</strong></span> component, select the <span class="strong"><strong>Sorting Layer</strong></span> dropdown.</p></li><li><p>Select <span class="strong"><strong>Units</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>Unfortunately, layers in Unity do not carry over when making a package of your project. The reasoning behind this is that you might have created some layers in your project and then imported a package. If the imported package brought along it's layers, it might overwrite some of your originally created layers. For more on layers, visit the<a id="id117" class="indexterm"></a> Unity Docs at <a class="ulink" href="http://docs.unity3d.com/Manual/Layers.html" target="_blank">http://docs.unity3d.com/Manual/Layers.html</a>.</p></div></li></ol></div></div></div>