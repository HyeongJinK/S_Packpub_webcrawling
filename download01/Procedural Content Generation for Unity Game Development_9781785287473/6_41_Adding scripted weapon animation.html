<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec42"></a>Adding scripted weapon animation</h2></div></div><hr /></div><p>The art we imported for our <a id="id265" class="indexterm"></a>weapon modules is static, which means that we didn't add in any supplemental art to create animations. If we had added in these animations, our art assets would have increased dramatically, and we are trying to avoid this. So, instead, we are going to do what we have been doing and rely on programming.</p><p>We want the randomly constructed weapon to animate a swing when the player attacks. So, we are going to program the animation in such a way that it is the same for all the Weapons. This process is very much based on experimentation to get the right look and feel. One solution can be seen in <span class="emphasis"><em>Code Snip 6.8</em></span>. The code is in the <code class="literal">Weapon</code> class definition as the <code class="literal">Update</code> function definition:</p><div class="informalexample"><pre class="programlisting">1 void Update () {
2   if (inPlayerInventory) {
3     transform.position = player.transform.position;
4     if (weaponUsed == true) {
5       float degreeY = 0, degreeZ = -90f, degreeZMax = 275f;
6       Vector3 returnVecter = Vector3.zero;
7
8       transform.rotation = Quaternion.Slerp (transform.rotation, Quaternion.Euler (0, degreeY, degreeZ), Time.deltaTime * 20f);
9       if (transform.eulerAngles.z &lt;= degreeZMax) {
10        transform.eulerAngles = returnVecter;
11        weaponUsed = false;
12        enableSpriteRender (false);
13      }
14    }
15  }
16 }</pre></div><p>The weapon is initially in an upright state. So, the basics of the animation include making the weapon appear and swing downward from its pivot point. This is the reason we took time to adjust the pivot point of each sprite in the first place. Let's take a look at the scripted animation in C<span class="emphasis"><em>ode Snip 6.8</em></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">Line 2</code>: In order for the animation cycle to begin, the player must first have a weapon in his or her inventory. The <code class="literal">Player</code> class will directly change the <code class="literal">inPlayerInventory</code> variable.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 3</code>: We ensure the weapon shared the same coordinates as the player.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 4</code>: Only when the <code class="literal">weaponUsed</code> flag is set, we run the animation cycle. The <code class="literal">useWeapon</code> function will be called by the <code class="literal">Player</code> class who will set this flag.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 5-6</code>: These are the various rotation values that need to take place. These values can be adjusted for different arc animations.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 8</code>: This is <a id="id266" class="indexterm"></a>the actual animation. We use a <code class="literal">Slerp</code> function to rotate the sword that originates from the <code class="literal">Player</code> class. <span class="strong"><strong>Slerp</strong></span> stands <a id="id267" class="indexterm"></a>for <span class="strong"><strong>spherical linear interpolation</strong></span>, which is built into Unity.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 9-13</code>: We only want the sword to swing to a certain angle and then disappear again. Here, we check whether it has exceeded this angle and then, if so, we reset the angle of the weapon.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>For more information on<a id="id268" class="indexterm"></a> <span class="strong"><strong>Slerp</strong></span> (<span class="strong"><strong>Spherical Linear Interpolation</strong></span>) in Unity3D, refer to <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Quaternion.Slerp.html" target="_blank">http://docs.unity3d.com/ScriptReference/Quaternion.Slerp.html</a>.</p></div></li></ul></div><p>The animation is fairly simple, but most of the angles were acquired via experimenting and seeing what looked good. Animation usually involves some experimentation with what looks correct to the eye, regardless of your medium. You should play with the values and see what kind of animations you can make as well.</p><p>We aren't done with the animation implementation quite yet though. We need a way to drive the animation. The <code class="literal">useWeapon</code> function needs its definition filled so that the player can call the weapon animation. The <code class="literal">useWeapon</code> function only needs the following two lines:</p><div class="informalexample"><pre class="programlisting">1 enableSpriteRender(true);
2 weaponUsed = true;</pre></div><p>Now, we need to jump over to the <code class="literal">Player</code> class to write in where and when the weapon animation is called. Luckily, this is a very small change as well. In the <code class="literal">Player</code> class's <code class="literal">OnCantMove</code> function, we will add the following two lines at the end of the function definition:</p><div class="informalexample"><pre class="programlisting">1 if (weapon) {
2   weapon.useWeapon ();
3 }</pre></div><p>This conditional statement<a id="id269" class="indexterm"></a> checks whether there is a weapon in the player's inventory and if there is, then the <code class="literal">Player</code> class will call the animation. Note that the <code class="literal">OnCantMove</code> function is called when there is something obstructing the player's path. Therefore, the weapon animation will only be called when an object is obstructing the player's path, such as a wall or an enemy.</p><p>Go back to the Unity Editor to try out the newly implemented weapon animation. You'll need to go find a sword, exit the dungeon, and then attack a wall tile. If you attack a wall that is to the right of the player, you'll see the animation as if the player swings the sword at and through the wall.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_06_13.jpg" /><div class="caption"><p>Weapon animation</p></div></div><p>If you attack a wall that is to the left of the player, the player still swings to the right. In addition to this, the player is permanently facing toward the right. This just doesn't look right and pulls the player out of the immersion, as follows:</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_06_14.jpg" /><div class="caption"><p>The player faces to the right and the sword swings to the right as well, while the wall on the left is damaged</p></div></div></div>