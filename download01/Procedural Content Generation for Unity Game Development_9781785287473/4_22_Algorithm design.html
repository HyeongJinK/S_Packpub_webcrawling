<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec25"></a>Algorithm design</h2></div></div><hr /></div><p>In order to successfully<a id="id134" class="indexterm"></a> design an algorithm for a randomly generated dungeon, we need to define what we mean by <span class="emphasis"><em>dungeon</em></span>. In video<a id="id135" class="indexterm"></a> games, a dungeon is typically an enclosed labyrinth-like level with a start and an end. A subgenre of games called a <span class="strong"><strong>dungeon crawler</strong></span> gets its<a id="id136" class="indexterm"></a> name from having the player complete many of these levels known as dungeons. <span class="emphasis"><em>Roguelike</em></span> games are <a id="id137" class="indexterm"></a>also known for their dungeon crawler style game play but with the extension that the dungeons are procedurally generated.</p><p>So our aim is to make a maze-like level layout and design. There are plenty of maze creating algorithms that are well defined and documented on the Internet. You should spend some time looking at some of these maze creation algorithms and trying to understand them. However, we will be writing our own algorithm to get the most exposure to the topic.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec20"></a>Algorithm overview</h3></div></div></div><p>We can create the dungeon<a id="id138" class="indexterm"></a>, much like we do the game world board. We will lay out tiles representing the floor for our player to walk on. However, the difference is that we need to enclose the dungeon board, making it finite, and contain the player within bounds. And thus, we can add an entrance and an exit to the dungeon level as the only means in and out.</p><p>The game world is generated continuously as the player explores. This won't work for our dungeon as it needs a start and an end. We will have to generate the entire dungeon at once. This isn't always the case, but this will best suit our needs for this task. In this respect, there is a bit of game/level design that can happen when developing these algorithms to achieve the look and feel you desire for the level.</p><p>There are many ways we can do this. One of the most popular ways is to place large sections of predefined dungeon and connect them together. However, predefining sections of dungeon would force us to do more art creation than coding. In your own projects, the choice<a id="id139" class="indexterm"></a> is yours to make. But for this project, what we can do is use <span class="strong"><strong>pathfinding</strong></span> to create a way though our dungeon, and then add procedurally generated sections of dungeon onto that path.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec21"></a>The grid</h3></div></div></div><p>Pathfinding is usually<a id="id140" class="indexterm"></a> applied to a map, graph, or some other structure that has separated <a id="id141" class="indexterm"></a>points. We think of our world board as a grid that is just a graph of points on the x-y plane. We can do the same with our Dungeon Board. Using the grid concept, we will inherently know all the points in our dungeon.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_02.jpg" /><div class="caption"><p>A diagram of the simple grid</p></div></div><p>We can then guide our algorithm and keep it within the bounds of the grid. So, if we imagine our dungeon grid as a<a id="id142" class="indexterm"></a> square grid, we can pick a start point on the left somewhere. Then, we use some pathfinding to find its way to the right and place an endpoint. We can record every point the pathfinder took on the grid and place tiles there. The<a id="id143" class="indexterm"></a> result is the start of a random dungeon.</p><p>There are some very well-defined pathfinding algorithms in computer science, but we will create our own for our dungeon. However, you should always research a new topic and find out more about it on your own. Pathfinding is an important part of game development and has many uses.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>Note: Path-finding is used in most videos game. There are some situations where a character will follow a predefined path, but in most instances of gameplay, we need the AI to adapt to dynamic changes. <span class="emphasis"><em>Dijkstra's Algorithm</em></span> is a basis for path finding and is studied in general in most computer science academic programs. A general search on Dijkstra's Algorithm and pathfinding will yield a wealth of information. Even more relevant to game development is a path finding algorithm called <span class="strong"><strong>A*</strong></span>, which you should also research.</p></div><p>Usually, pathfinding<a id="id144" class="indexterm"></a> is meant to find the shortest/easiest path through an area to a destination. Because of their complexity, most pathfinding algorithms will be over-qualified for our task. We are looking to be a little surprised of the outcome ourselves, so we want to develop an algorithm that is based on randomness and is not so directed.</p><p>We want our<a id="id145" class="indexterm"></a> pathfinder to be spontaneous because that will translate to a more interesting dungeon layout. We only want the dimensions of the grid to contain the pathfinder. However, the pathfinder will require some direction in the form of random probability.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec22"></a>Essential path</h3></div></div></div><p>If we were to randomly lay tiles on our grid for our dungeon, we could end up with a dungeon that doesn't connect and has an entrance but with an inaccessible exit. So we can utilize as much of the grid as possible to create our entrance on the far left and our exit on the far right. Then, we connect the<a id="id146" class="indexterm"></a> two with our pathfinder, which we will call the<a id="id147" class="indexterm"></a> <span class="strong"><strong>essential path</strong></span>.</p><p>The essential path is just that, essential. By connecting the entrance to the exit, we ensure our dungeon can be completed. All the points on the essential path will have a floor tile to make sure the path is open. We can then add to the essential path to expand the dungeon.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_03.jpg" /><div class="caption"><p>A diagram of the simplest essential path</p></div></div><p>The simplest path in<a id="id148" class="indexterm"></a> a grid or point system is a straight line. However, a straight line for a dungeon isn't very interesting. So we should guide our path from left to<a id="id149" class="indexterm"></a> right but use some PRNs to create a probability that it veers up or down. This should give us a nice winding path.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_04.jpg" /><div class="caption"><p>A diagram of the winding essential path</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec23"></a>Random path and chambers</h3></div></div></div><p>Once we have<a id="id150" class="indexterm"></a> created our<a id="id151" class="indexterm"></a> essential path, we can add to it. This will add even more<a id="id152" class="indexterm"></a> variety to our dungeon and ensure that no two are<a id="id153" class="indexterm"></a> alike during game play. We will call these random branches from the essential path, <span class="strong"><strong>random paths</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_05.jpg" /><div class="caption"><p>A diagram of random paths in blue</p></div></div><p>We can further <a id="id154" class="indexterm"></a>add to a random path by placing a large opening at the end, which we will call a <span class="strong"><strong>chamber</strong></span>. The chamber mimics the type of dungeon generation we <a id="id155" class="indexterm"></a>spoke of earlier in which we predefine sections of the dungeon<a id="id156" class="indexterm"></a> and place them in. However, instead of predefining the chambers by building them<a id="id157" class="indexterm"></a> as an art asset, we will build the chambers procedurally. This will ensure that they will fit anywhere in our grid, as well as save us some memory by not having to store one or more chamber types as art assets.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_06.jpg" /><div class="caption"><p>A diagram of the chamber in red</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec24"></a>Filling in the rest of the gird</h3></div></div></div><p>After placing the <a id="id158" class="indexterm"></a>essential paths, random paths, and chambers, we will have a set of coordinates that refers to open space. This open space will be the floor tiles<a id="id159" class="indexterm"></a> of the Dungeon Board. We then need to enclose the dungeon or we will be able to walk into the blank region of the screen.</p><p>We can easily do this but filling in the rest of the grid with tiles that the player cannot move on or through. These tiles are wall tiles that cannot be destroyed by the player. These tiles are called outer wall tiles and they were already added to your prefab set as of <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Roguelike Games</em></span>.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_07.jpg" /><div class="caption"><p>Diagram of outer wall tiles in black</p></div></div><p>Also, since we are<a id="id160" class="indexterm"></a> moving from the far left to the far right, we will be placing tiles on the very edge of the Dungeon Board grid. This will create an opening to the blank<a id="id161" class="indexterm"></a> space onscreen. The same can happen to any random path that makes it to the end of the grid. So, we should wrap the entire grind in a single tile width of outer wall tiles to make sure the dungeon is truly closed.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_08.jpg" /><div class="caption"><p>A diagram of the outer wall tiles enclosing the dungeon in black</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec25"></a>Placing the entrance and exit</h3></div></div></div><p>Finally, we<a id="id162" class="indexterm"></a> need to define how the entrance and exit are determined in<a id="id163" class="indexterm"></a> the dungeon. Even though we are discussing this last, it will actually be the first thing the algorithm does. We already decided that we will be moving from left to right. From the far left of the grid, we can randomly select a point by varying the <span class="emphasis"><em>y</em></span> coordinate. So, we know our entrance will have an <span class="emphasis"><em>x</em></span> coordinate of <span class="strong"><strong>0</strong></span> and a random <span class="emphasis"><em>y</em></span> coordinate.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_09.jpg" /><div class="caption"><p>A diagram of possible starting points</p></div></div><p>After defining the<a id="id164" class="indexterm"></a> entrance, we can have the path build off of the <a id="id165" class="indexterm"></a>starting point. However, the path is unpredictable and it will be difficult to try and have it connect with a specified end point. Instead, we can let the path-finder run its course knowing that it will find its way to the far right side. We will then take the point at which the path ends itself, that is, the exit of the dungeon.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_04_10.jpg" /><div class="caption"><p>A diagram of the placement of exit based on the path</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec26"></a>Algorithm summary</h3></div></div></div><p>Algorithms, like<a id="id166" class="indexterm"></a> this one, can get long and complicated when trying to determine how and when to branch the path. To avoid complexity, we will let PRNs create a probability for certain outcomes. This way, we can leave the branching up to chance. Thus, our algorithm will be doing most of the level layout but we have some idea of the flow of the level based on our algorithm design. Let's summarize our algorithm:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set up the grid if we use a square grid; then, we only need to store a single number, which will represent all four sides, say 5 for a 5 x 5 grid.</p></li><li style="list-style-type: disc"><p>Generate the essential path from left to right, which will connect the dungeon entrance to the dungeon exit.</p><p>We can use a PRN here to determine the direction the path takes.</p></li><li style="list-style-type: disc"><p>Add random path branches to the essential path.</p><p>This is another opportunity to use PRNs as a  probability of a branch creation and also to determine the direction it takes.</p></li><li style="list-style-type: disc"><p>Fill in the rest of the<a id="id167" class="indexterm"></a> grid with impassable wall tiles to enclose the dungeon, which is inefficient but easy. You are welcome to trim the wall tiles to only surround the path and are encouraged to do so.</p></li></ul></div></div></div>