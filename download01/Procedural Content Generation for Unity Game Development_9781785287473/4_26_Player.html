<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec29"></a>Player</h2></div></div><hr /></div><p>The <code class="literal">Player</code> class has to<a id="id194" class="indexterm"></a> interact with the exit tile, which represents the entrance and exit of our dungeons. The player character also has to be transported to the Dungeon Board when the player moves to an exit tile. There are some subtleties to this, since we are not actually changing the scene. <span class="emphasis"><em>Code Snip 4.8</em></span> shows the updates the <code class="literal">Player</code> class requires:</p><div class="informalexample"><pre class="programlisting">14 public bool onWorldBoard;
15 public bool dungeonTransition;
…
19 protected override void Start () {
20  animator = GetComponent&lt;Animator&gt;();
21    
22  health = GameManager.instance.healthPoints;
23    
24  healthText.text = "Health: " + health;
25
26  position.x = position.y = 2;27
27
28  onWorldBoard = true;
29  dungeonTransition = false;
30
31  base.Start ();
32}
…
40 private void Update ()
…
63    if(horizontal != 0 || vertical != 0) {
64    if (!dungeonTransition) {
65    canMove = AttemptMove&lt;Wall&gt; (horizontal, vertical);
66    if(canMove &amp;&amp; onWorldBoard) {
67    position.x += horizontal;
68    position.y += vertical;
69    GameManager.instance.updateBoard(horizontal, vertical);
70    }
71      }
72   }
…
137 private void GoDungeonPortal () {
138  if (onWorldBoard) {
139    onWorldBoard = false;
140    GameManager.instance.enterDungeon();
141    transform.position = DungeonManager.startPos;
142  } else {
143    onWorldBoard = true;
144    GameManager.instance.exitDungeon();
145    transform.position = position;
146  }
147 }
148  
149 private void OnTriggerEnter2D (Collider2D other) {
150   if (other.tag == "Exit") {
151     dungeonTransition = true;
152     Invoke("GoDungeonPortal", 0.5f);
153     Destroy (other.gameObject);
154  }
155 }</pre></div><p>Let's see how the<a id="id195" class="indexterm"></a> changes connect with our dungeon generator:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">Lines 14-15</code>: We are adding a couple of Boolean variables because we will need to switch some things on and off. <code class="literal">onWorldBoard</code> will let us know if we are on the world board, which will determine whether we track our position or not. <code class="literal">dungeonTransition</code> will let us know if we need to switch off our movement for a second, so we can transition to the dungeon entrance.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 28-29</code>: Inside the <code class="literal">Start</code> function, we will initialize our new Boolean variables. We set <code class="literal">onWorldBoard</code> to <code class="literal">true</code> because we start on the world board. We set <code class="literal">dungeonTransition</code> to <code class="literal">false</code> because we don't initially begin transitioning to a dungeon.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 64</code>: We need to add a condition that when we are in transition to a dungeon entrance, we need to turn off movement. If we don't disable movement, then the player might try to continue to input movement. If half a movement is registered during the transition to a dungeon, it will cause some unusual behavior as the movement algorithm is now operating on an unintentional <a id="id196" class="indexterm"></a>offset.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 65</code>: <code class="literal">onWolrdBoard</code> gets added to the movement conditional. Both the world board and Dungeon Board will exist simultaneously. If we don't turn off the player position tracking, we will reveal sections of the world board while in the dungeon.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 137-147</code>: <code class="literal">GoDungeonPortal</code> is a two way function that manages the effect of the player interacting with the exit Tile. If the player is on the world board, then they enter a dungeon. If the player is in a dungeon, then they are sent back to the world board. Because we stop tracking player movement in a dungeon, we can send the player back to the world board position at which we transitioned to the dungeon.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 149-155</code>: This is an override of a Unity built-in function. The exit tile has a Box Collider 2D that acts as a trigger. The <code class="literal">OnTriggerEnter2D</code> function will check if we hit an exit tile and begin the transition to the dungeon. We need to use <code class="literal">Invoke</code> to create a delay in the transition to match our movement delay. We then destroy the exit tile so we can't reactivate it.</p></li></ul></div><p>At this point, the <code class="literal">DungeonManager</code>, <code class="literal">BoardManager</code>, and <code class="literal">Player</code> classes are all ready to interact with one another. We need to create a connection point for the information to be transferred between the classes. We will use the <code class="literal">GameManager</code> class for this task.</p></div>