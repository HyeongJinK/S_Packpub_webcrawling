<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec39"></a>Modular weapon scripts</h2></div></div><hr /></div><p>Our modular weapon script<a id="id252" class="indexterm"></a> will do the following three main actions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">Weapon</code> script will create the connection to the player and the weapon</p></li><li style="list-style-type: disc"><p>The player will need to carry and use the weapon</p></li><li style="list-style-type: disc"><p>The script will drive the scripted animation, and it will also drive the the random construction of the weapon from the weapon component</p></li></ul></div><p>We are going to place some hooks in the class definition as empty functions that we will fill in when we have some more information. Let's take a look at the full <code class="literal">Weapon</code> class script that's shown in <span class="emphasis"><em>Code Snip 6.1</em></span>:</p><div class="informalexample"><pre class="programlisting">1 using UnityEngine;
2 using System.Collections;
3
4 public class Weapon : MonoBehaviour {
5 
6  public bool inPlayerInventory = false;
7
8  private Player player;
9  private WeaponComponents[] weaponsComps;
10 private bool weaponUsed = false;
11  
12  public void AcquireWeapon () {}
13
14  void Update () {}
15  
16  public void useWeapon () {}
17
18  public void enableSpriteRender (bool isEnabled) {}
19
20  public Sprite getComponentImage (int index) {
21    return null;
22  }
23 }</pre></div><p>Let's go through and explain <a id="id253" class="indexterm"></a>what's happening in the <code class="literal">Weapon</code> class script:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">Line 6</code>: <code class="literal">inPlayerInventory</code> is a Boolean flag to identify whether or not the weapon was picked up by the player.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 8</code>: We want to keep a reference to the player character so that we can provide a reference to its absolute position at all times.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 9</code>: We will have an array of references to the weapon components child.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 10</code>: <code class="literal">weaponUsed</code> is another flag that we will use to trigger the swing animation.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 12</code>: This is our first hook. <code class="literal">AcquireWeapon</code> will be the function that the <code class="literal">Player</code> class calls in order to add a weapon to the inventory. We will need to make the <code class="literal">Weapon</code> class a child of the <code class="literal">Player</code> class as well.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 14</code>: We are keeping the <code class="literal">Update()</code> function because we will be running an animation that's controlled in this script. The animation will have to update frames along with the timing of the game.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 16</code>: <code class="literal">useWeapon()</code> will be the function that is called by the player to start the weapon swing animation.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 18</code>: Because the <code class="literal">Weapon</code> class is a child of the <code class="literal">Player</code> class and is always in the same location as the <code class="literal">Player</code> class, we will need a way to make it invisible. <code class="literal">enableSpriteRender (bool isEnabled)</code> will disable the Sprite Renderers of the weapon components to keep them invisible till they are used.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 20</code>: We want to inform the player about the weapon that they are carrying. Like the glove and boot items, we will add on a screen image of the sword that the player currently has in his or her inventory. <code class="literal">getComponentImage (int index)</code> will get the image that's to be displayed on the screen.</p></li></ul></div><p>We will return to the <code class="literal">Weapon</code> class definition throughout the rest of this chapter as we discover what is required to make our <code class="literal">Weapon</code> class work. We will follow the <code class="literal">Weapon</code> class definition <a id="id254" class="indexterm"></a>with the <code class="literal">WeaponComponents</code> class definition. We will then be able to fill in some of the blanks from the <code class="literal">Weapon</code> class definition. After all this, we can finish constructing the <span class="strong"><strong>Weapon</strong></span> prefab. For now, let's take a look at the <code class="literal">WeaponComponents</code> class in <span class="emphasis"><em>Code Snip 6.2</em></span>:</p><div class="informalexample"><pre class="programlisting">1 using UnityEngine;
2 using System.Collections;
3 using Random = UnityEngine.Random;
4
5 public class WeaponComponents : MonoBehaviour {
6
7  public Sprite[] modules;
8  
9  private Weapon parent;
10 private SpriteRenderer spriteRenderer;
11  
12  void Start () {
13    parent = GetComponentInParent&lt;Weapon&gt; ();
14    spriteRenderer = GetComponent&lt;SpriteRenderer&gt; ();
15    spriteRenderer.sprite = modules [Random.Range(0, modules.Length)];
16  }
17
18  void Update () {
19    transform.eulerAngles = parent.transform.eulerAngles;
20  }
21  
22  public SpriteRenderer getSpriteRenderer () {
23    return spriteRenderer;
24  }
25 }</pre></div><p>We will be able to choose which modules we want this component to render in the Unity Editor. The array of modules that we give the <code class="literal">WeaponComponent</code> class will have a single module that's chosen from it to be rendered. Let's take a look at what we have developed in <span class="emphasis"><em>Code Snip 6.2</em></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">Line 3</code>: Set<a id="id255" class="indexterm"></a> <code class="literal">Random</code> to use the Unity built-in Random library.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 7</code>: This array will hold the different modules that make up a weapon.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 9</code>: We will need to store a reference to the <code class="literal">parent</code> object, which is the <code class="literal">Weapon</code> object. The <code class="literal">Weapon</code> script will direct our weapon components to turn off and on.</p></li><li style="list-style-type: disc"><p><code class="literal">Line 10</code>: We will also need to store a reference to the Sprite Renderer component to turn it off and on.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 12-16</code>: The <code class="literal">Start()</code> function will be where we set up our parent and Sprite Renderer references. The function will then randomly select the module from the array of modules to render.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 18-20</code>: We will use the <code class="literal">Update()</code> function to continuously poll the <code class="literal">parent</code> weapon object for it's angle. We want all of the weapon components to match the angle of the <code class="literal">parent</code> weapon object and, in turn, the player character. The plan is to turn the weapon as the player character turns.</p></li><li style="list-style-type: disc"><p><code class="literal">Lines 22-24</code>: We want to pass a reference to the component's Sprite Renderer. This way, we can manipulate when the Sprite Renderer is enabled or disabled in the <code class="literal">Weapon</code> class.</p></li></ul></div><p>Now that we have the <code class="literal">WeaponComponent</code> class written, we can finish building our Weapon prefab. Return to the Unity Editor, and select the <span class="strong"><strong>Weapon</strong></span> GameObject in the <code class="literal">Hierarchy</code> panel. Add the <code class="literal">Weapon.cs</code> script.</p><p>Next, select each weapon component GameObject that is a child of the <span class="strong"><strong>Weapon</strong></span> GameObject. Add the <code class="literal">WeaponComponents.cs</code> script. Then, for <span class="strong"><strong>WeaponComponents1</strong></span>, select the <span class="strong"><strong>Modules</strong></span> array and set the size to <code class="literal">4</code>. Add the corresponding blade module sprites. Do the same for the other weapon components.</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_06_08.jpg" /><div class="caption"><p>Weapon Component's settings</p></div></div><p>You can now<a id="id256" class="indexterm"></a> drag and drop the whole <span class="strong"><strong>Weapon</strong></span> prefab into the <span class="strong"><strong>Prefabs</strong></span> folder, and delete the <span class="strong"><strong>Weapon</strong></span> object from the <span class="strong"><strong>Hierarchy</strong></span> panel. You'll see that the <span class="strong"><strong>Weapon</strong></span> prefab can be expanded. If you expand it, you'll see the child prefabs that are the weapon components. You can edit the individual components here:</p><div class="mediaobject"><img src="/graphics/9781785287473/graphics/B04808_06_09.jpg" /><div class="caption"><p>The expanded Weapon prefab</p></div></div></div>