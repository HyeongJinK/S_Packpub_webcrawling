<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec32"></a>Creating the obstacle</h2></div></div><hr /></div><p>The obstacle will <a id="id147" class="indexterm"></a>consist of two parts. There will be an image of an axe that we will rotate around and a base image that the axe will rotate around. The reason we will be controlling the rotation of the axe instead of using another animation is that it would be more complicated to scale Box Collider 2D on the object to always fit the rotating bounds of the axe. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin with, navigate to the <code class="literal">Assets</code> folder, right-click on it, select <span class="strong"><strong>Create</strong></span> and then <span class="strong"><strong>Folder</strong></span>.</p></li><li><p>Name the folder <code class="literal">Obstacle</code> and open this folder.</p></li><li><p>Now, right-click on the <code class="literal">Obstacle</code> folder and click on <span class="strong"><strong>Import New Asset…</strong></span>.</p></li><li><p>Navigate to the <code class="literal">Art</code> files for the book and open the <code class="literal">ChapterThree_Obstacle</code> folder.</p></li><li><p>Then, select <code class="literal">Obstacle_Axe.png</code> and click on <span class="strong"><strong>Import</strong></span>.</p></li><li><p>Now, right-click on the <code class="literal">Obstacle</code> folder again and click on <span class="strong"><strong>Import New Asset…</strong></span>.</p></li><li><p>Select <code class="literal">Obstacle_Axe_Base.png</code> and click on <span class="strong"><strong>Import</strong></span>.</p></li><li><p>Select both the imported files in the <code class="literal">Obstacle</code> folder (click on one and <span class="emphasis"><em>Ctrl</em></span> + left-click on the other).</p></li><li><p>Now, select <span class="strong"><strong>Filter Mode</strong></span> as <span class="strong"><strong>Point</strong></span>.</p></li><li><p>Then, select <span class="strong"><strong>Max Size</strong></span> as <code class="literal">256</code>.</p></li><li><p>Now, select <span class="strong"><strong>Format</strong></span> as <span class="strong"><strong>Truecolor</strong></span>.</p></li><li><p>Then, click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>Let's click and drag each of these files onto the <code class="literal">Obstacle</code> folder in the scene. (If character and/or pickup are in the way, move them to the left or right direction so that you have room to work).</p></li><li><p>Now, select <span class="strong"><strong>Obstacle_Axe</strong></span> and <span class="strong"><strong>Obstacle_Axe_Base</strong></span> GameObjects in the scene.</p></li><li><p>In <span class="strong"><strong>Inspector</strong></span>, select <a id="id148" class="indexterm"></a>both of their positions for <span class="strong"><strong>X</strong></span> as <code class="literal">0</code>, <span class="strong"><strong>Y</strong></span> as <code class="literal">0</code>, and <span class="strong"><strong>Z</strong></span> as <code class="literal">0</code>.</p></li><li><p>For <span class="strong"><strong>Obstacle_Axe_Base</strong></span>, select its <span class="strong"><strong>Z</strong></span> value as <code class="literal">0.1</code>.</p></li><li><p>Select <span class="strong"><strong>Obstacle_Axe</strong></span> and move it up so that the base of the axe handle is in the center of <span class="strong"><strong>Obstacle_Axe_Base</strong></span>, as shown in the following image:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_15.jpg" /></div></li></ol></div><p>With <span class="strong"><strong>Obstacle_Axe GameObject</strong></span> selected, navigate to the <span class="strong"><strong>Inspector</strong></span> tab and click on<span class="strong"><strong> Add Component.</strong></span> Search for <span class="strong"><strong>Box Collider 2D</strong></span> and select <span class="strong"><strong>Box Collider 2D</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Box Collider 2D</strong></span> settings, check <span class="strong"><strong>IsTrigger</strong></span>.</p></li><li><p>Also, in the <span class="strong"><strong>Box Collider 2D</strong></span> settings, select the offset in the <span class="strong"><strong>Y</strong></span> value as <code class="literal">0.12</code>.</p></li><li><p>Again, in the <span class="strong"><strong>Box Collider 2D</strong></span> settings, select <span class="strong"><strong>Size</strong></span> of <span class="strong"><strong>X</strong></span> as <code class="literal">0.36</code> and <span class="strong"><strong>Y</strong></span> as <code class="literal">0.2</code>.</p></li><li><p>Then, right-click on the <span class="strong"><strong>Hierarchy</strong></span> tab and select <span class="strong"><strong>Create Empty</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window, name the new GameObject as <code class="literal">Axe</code> and set its<span class="strong"><strong> Position</strong></span> to <span class="strong"><strong>X0</strong></span>, <span class="strong"><strong>Y0</strong></span>, and <span class="strong"><strong>Z0</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Obstacle_Axe</strong></span> and <span class="strong"><strong>Obstacle_Axe_Base</strong></span> GameObjects and drag them onto the <span class="strong"><strong>Axe</strong></span> GameObject.</p></li><li><p>Right-click on the <span class="strong"><strong>Hierarchy</strong></span> tab and select <span class="strong"><strong>Create Empty</strong></span> again.</p></li><li><p>Rename this new GameObject in the <span class="strong"><strong>Inspector</strong></span> window as <span class="strong"><strong>Pivot</strong></span> and set its <span class="strong"><strong>Position</strong></span> to <span class="strong"><strong>X0</strong></span>, <span class="strong"><strong>Y0</strong></span>, and<span class="strong"><strong> Z0</strong></span>.</p></li><li><p>Now, move the <span class="strong"><strong>Obstacle_Axe</strong></span> GameObject to the <span class="strong"><strong>Pivot</strong></span> GameObject.</p></li></ol></div><p>If you are having an issue <a id="id149" class="indexterm"></a>where the pivot isn't at the center of <span class="strong"><strong>Obstacle_Axe_Base</strong></span>, change the pivot position from <span class="strong"><strong>Object</strong></span> to <span class="strong"><strong>Pivot</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_16.jpg" /></div><p>You should now have GameObject in the <span class="strong"><strong>Hierarchy</strong></span> tab named as <span class="strong"><strong>Axe</strong></span> with three children: <span class="strong"><strong>Obstacle_Axe_Base</strong></span>, <span class="strong"><strong>Pivot</strong></span>, and <span class="strong"><strong>Obstacle_Axe</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_17.jpg" /></div><p>You should now be able to select the <span class="strong"><strong>Pivot</strong></span> GameObject and rotate it around so that it looks as if <span class="strong"><strong>Axe</strong></span> is rotating from the center of the <span class="strong"><strong>Axe</strong></span> GameObject:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_18.jpg" /></div><p>We now need to create the code class that will handle this obstacle. In the <code class="literal">Assets/Scripts</code> folder, right-click and select <span class="strong"><strong>Create</strong></span> and then <span class="strong"><strong>C# Script</strong></span>. Name the class <code class="literal">Obstacle</code>.</p><p>Select <span class="strong"><strong>Axe</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> tab. Now, in the <span class="strong"><strong>Inspector</strong></span> tab, click on<span class="strong"><strong> Add Component</strong></span>. Search for <a id="id150" class="indexterm"></a>
<span class="strong"><strong>Obstacle</strong></span> and select it.</p><p>In the <code class="literal">Assets/Scripts</code> folder, double-click on the <code class="literal">Obstacle</code> class to open it. As before, there is the Unity-generated code.</p><p>At the top of the class, we need a reference to the <span class="strong"><strong>Pivot</strong></span> GameObject so that we know what GameObject to rotate. Add the following code:</p><div class="informalexample"><pre class="programlisting">    // Pivot to rotate around
    public Transform Pivot;</pre></div><p>We also need the setting to set the rotation. We will use <code class="literal">Vector2 </code>and use it as a range. Add the following code under the <code class="literal">Pivot</code> variable:</p><div class="informalexample"><pre class="programlisting">    // Random range for rotation speed
    public Vector2 RotationSpeedGap;</pre></div><p>As <code class="literal">Vector2</code> is a struct with two float values, we can use both of its values for something other than a location. In this case, we will use them as the minimum and maximum rotation speed.</p><p>Now, we need a value that is chosen by <code class="literal">RotationSpeedGap</code>. Under <code class="literal">RotationSpeedGap</code>, add the following code:</p><div class="informalexample"><pre class="programlisting">    // Actual rotation speed based on RotationSpeedGap
    private float RotationSpeed;</pre></div><p>The concept here is that we can use the Random tool of the Unity engine to pick a value for us to avoid having absolute consistency between all obstacles. This way, each obstacle used will have its own rotation speed, making the game a bit more random and also a bit more difficult.</p><p>In the <code class="literal">Start</code> function, add the following code:</p><div class="informalexample"><pre class="programlisting">  // Use this for initialization
  void Start ()
  {
    RotationSpeed = Random.Range( RotationSpeedGap.x, RotationSpeedGap.y );
  }</pre></div><p>This sets <code class="literal">RotationSpeed</code> to a random value in the range that starts with <code class="literal">RotationSpeedGap.x</code> and ends with <code class="literal">RotationSpeedGap.y</code>.</p><p>Now, we have to rotate the <code class="literal">Pivot</code> object based on the rotation speed in the <code class="literal">Update</code> function. Add the following code:</p><div class="informalexample"><pre class="programlisting">  // Update is called once per frame
  void Update () 
  {
    Pivot.transform.Rotate( Vector3.forward, RotationSpeed );
  }</pre></div><p>The <code class="literal">Rotate</code> function is <a id="id151" class="indexterm"></a>designed to take a direction, which is <code class="literal">Vector3.forward</code> and a speed to rotate around, which is our generated <code class="literal">RotationSpeed</code> from the Random value between <code class="literal">RotationSpeedGap.x</code> and <code class="literal">RotationSpeedGap.y</code>.</p><p>Select <span class="strong"><strong>Axe GameObject</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> tab, and in the <span class="strong"><strong>Obstacle</strong></span> component settings, click on <span class="strong"><strong>Pivot</strong></span> and drag it onto the <span class="strong"><strong>Pivot</strong></span> box of the component in the <span class="strong"><strong>Inspector</strong></span> tab.</p><p>For the <span class="strong"><strong>Rotation Speed Gap</strong></span> values, I will use <span class="strong"><strong>X</strong></span> as <code class="literal">2</code> and <span class="strong"><strong>Y</strong></span> as <code class="literal">5</code>. You can use anything you'd like; the higher the values, the faster the axe spins.</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_19.jpg" /></div><p>If you play the game now, you will see the axe spinning towards the player.</p><p>The last step of <span class="strong"><strong>Obstacle</strong></span> is to write the logic that will check for the character colliding with it and then kill the character. The downside to how we have the <span class="strong"><strong>Axe</strong></span> obstacle set up is that as the parent object doesn't know of Box Collider 2D on <span class="strong"><strong>Obstacle_Axe</strong></span>, we have to create another C# class for <span class="strong"><strong>Obstacle_Axe</strong></span> so that we can tell when the character collides with it.</p><p>In the <code class="literal">Assets/Scripts</code> folder, right-click and select <span class="strong"><strong>Create</strong></span> and then <span class="strong"><strong>C# Script</strong></span>.</p><p>Name this <code class="literal">Obstacle_Axe</code>.</p><p>Select the <span class="strong"><strong>Obstacle_Axe</strong></span> <a id="id152" class="indexterm"></a>GameObject in the <span class="strong"><strong>Hierarchy</strong></span> tab, and in the <span class="strong"><strong>Inspector</strong></span> tab, click on <span class="strong"><strong>Add Component</strong></span>.</p><p>Search for <span class="strong"><strong>Obstacle_Axe</strong></span> and select <span class="strong"><strong>Obstacle_Axe</strong></span>.</p><p>Double-click on the <code class="literal">Obstacle_Axe</code> C# script to open it.</p><p>Select the <code class="literal">Start</code> and <code class="literal">Update</code> functions and delete them. These functions are not needed.</p><p>The <code class="literal">Obstacle_Axe</code> C# script should look similar to the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class Obstacle_Axe : MonoBehaviour 
{
  // When our collider collides with another collider
  void OnTriggerEnter2D(Collider2D Col)
  {
    Character gameCharacter;

    if (Col.gameObject.name == "Character")
    {
      gameCharacter = Col.gameObject.GetComponent&lt;Character&gt;( );
      if (gameCharacter != null)
      {
        gameCharacter.KillCharacter( );
      }
    }
  }
}</pre></div><p>Similar to the pickup's <code class="literal">OnTriggerEnter2D</code> function, we will check whether the GameObject owns the <span class="strong"><strong>Col</strong></span> collider named <span class="strong"><strong>Character</strong></span>. If it does, we get the <code class="literal">Character</code> component on it and make sure it exists. If it does not, we will call the <code class="literal">KillCharacter</code> function to kill the character.</p><p>If you play the game now, you can collide and be killed with <span class="strong"><strong>Obstacle</strong></span>. Remember that there is no reset to revive the <a id="id153" class="indexterm"></a>character yet. We will do this in the future UI chapter, where we will have the button to restart the game.</p></div>