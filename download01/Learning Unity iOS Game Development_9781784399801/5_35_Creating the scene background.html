<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec37"></a>Creating the scene background</h2></div></div><hr /></div><p>To start <a id="id258" class="indexterm"></a>with, we will need a C# script.</p><p>Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, search the <code class="literal">Assets/Scripts</code> folder and right-click on it.</p></li><li><p>Then, click on <span class="strong"><strong>Create</strong></span> and select <span class="strong"><strong>C# Script</strong></span>.</p></li><li><p>Now, name this <code class="literal">SceneBackground</code>.</p></li><li><p>Finally, double-click on the <code class="literal">SceneBackground</code> file to open it.</p></li></ol></div><p>The <code class="literal">SceneBackground</code> file will hold <span class="emphasis"><em>four</em></span> sprites. Each of these sprites will have their own movement speed and movement distance (speed being how fast they move and distance is how far forward and backward they can move).</p><p>Add the following code to the <code class="literal">SceneBackground</code> file before the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">    // Struct to hold data for Background Element
    [System.Serializable]
    public struct BackgroundElement
    {
      public Sprite BackgroundSprite;
      public float MovementSpeed;
      public float MovementDistance; 
      public Vector3 SpriteLocation;
      public Vector3 SpriteScale;

      [System.NonSerialized]
      public Vector3 ObjectStartLocation;
      [System.NonSerialized]
      public GameObject ChildObject;
      [System.NonSerialized]
      public bool bMoveBackwards;
    };

    // Array to store backgrounds for scene
    public BackgroundElement[ ] SceneBackgroundElement;</pre></div><p>The <code class="literal">BackgroundElement</code> struct is a way for us to create a sprite and manage its <code class="literal">MovementSpeed</code> and <code class="literal">MovementDirection</code> without having to create individual variables for all of them. This way, we can compartmentalize the data into a single struct object and assign the values we need with less code clutter. Then, with the <code class="literal">SceneBackgroundElement</code> array, we can create and assign the background images with unique settings to handle them correctly.</p><p><code class="literal">[System.Serializable]</code> allows you to edit these variables in the editor. Without this, the variables will not be shown in the <span class="strong"><strong>Inspector</strong></span> window when you select the GameObject from the <span class="strong"><strong>Hierarchy</strong></span> or <span class="strong"><strong>Project</strong></span> folder(s).</p><p>Save the <code class="literal">SceneBackground</code> code file and go back to Unity. Right-click on <span class="strong"><strong>Hierarchy</strong></span> and then select <span class="strong"><strong>Create Empty</strong></span>. Name this <code class="literal">SceneBackground</code>.</p><p>In the <span class="strong"><strong>Inspector</strong></span> window, with the new <span class="strong"><strong>SceneBackground</strong></span> GameObject selected in <span class="strong"><strong>Hierarchy</strong></span>, click on <span class="strong"><strong>Add Component</strong></span>. Search for <code class="literal">SceneBackground</code> and select <span class="strong"><strong>SceneBackground</strong></span>.</p><p>You should see a <a id="id259" class="indexterm"></a>drop-down list for <span class="strong"><strong>Scene Background Element</strong></span> with <span class="emphasis"><em>zero</em></span> elements. Set the number of elements to <span class="emphasis"><em>four</em></span>. You should now see the empty elements for <span class="strong"><strong>Scene Background Element</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_05_01.jpg" /></div><p>In order to set all of these, we need to import the art for them. In the <code class="literal">Assets</code> folder, right-click and select <span class="strong"><strong>Create</strong></span> and then <span class="strong"><strong>Folder</strong></span>. Name this <code class="literal">Background</code>.</p><p>Open the <code class="literal">Background</code> folder and right-click on it. Then, click on <span class="strong"><strong>Import New Assetâ€¦</strong></span>. Navigate to the book art files and find the folder named <code class="literal">ChapterFive_Background</code>. Import all the <span class="emphasis"><em>four</em></span> images.</p><p>This includes:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">Background_00</code></p></li><li style="list-style-type: disc"><p><code class="literal">Background_01</code></p></li><li style="list-style-type: disc"><p><code class="literal">Background_02</code></p></li><li style="list-style-type: disc"><p><code class="literal">Background_03</code></p></li></ul></div><p>Select all the four <a id="id260" class="indexterm"></a>images in the <code class="literal">Assets/Background</code> folder. Then, in the <span class="strong"><strong>Inspector</strong></span> window, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set <span class="strong"><strong>FilterMode</strong></span> to <span class="strong"><strong>Trilinear</strong></span>.</p></li><li><p>Set <span class="strong"><strong>MaxSize</strong></span> to <code class="literal">1024</code>.</p></li><li><p>Set <span class="strong"><strong>Format</strong></span> to <span class="strong"><strong>Truecolor</strong></span>.</p></li><li><p>Then, click on <span class="strong"><strong>Apply</strong></span>.</p></li></ol></div><p>With the <span class="strong"><strong>SceneBackground</strong></span> GameObject selected in <span class="strong"><strong>Hierarchy</strong></span>, click on the drop-down list for the <span class="strong"><strong>0</strong></span> element of the <span class="strong"><strong>SceneBackground</strong></span> script component.</p><p>In the <span class="strong"><strong>Sprite object</strong></span> slot, click on the small circle with a dot. When the window opens, select the sprite object, search for <code class="literal">Background_00</code> and then select <code class="literal">Background_00</code>. Change the Sprite Location to <code class="literal">0X</code>, <code class="literal">0Y</code>, and <code class="literal">0Z</code>; then, set the <code class="literal">Sprite Scale</code> to <code class="literal">1X</code>, <code class="literal">1Y</code>, and <code class="literal">1Z</code>. Leave <span class="strong"><strong>Movement Speed</strong></span> and <span class="strong"><strong>Movement Distance</strong></span> as <span class="emphasis"><em>zero</em></span>.</p><p>Next, we want to set the second element: clouds. Again, with the <span class="strong"><strong>SceneBackground</strong></span> GameObject selected, take at look at the <span class="strong"><strong>Inspector</strong></span> tab and click on the <span class="strong"><strong>1</strong></span>or <span class="strong"><strong>2</strong></span> element drop-down list so that you change the settings as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set <span class="strong"><strong>Background Sprite</strong></span> to <code class="literal">Background_01</code>.</p></li><li><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Movement Distance</strong></span> as <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Sprite</strong></span> <span class="strong"><strong>Location</strong></span> for <span class="strong"><strong>X</strong></span> to <code class="literal">5.65</code>, <span class="strong"><strong>Y</strong></span> to <code class="literal">1.95</code>, and <span class="strong"><strong>Z</strong></span> to <code class="literal">40</code>.</p></li><li><p>Set <span class="strong"><strong>Sprite Scale</strong></span> for <span class="strong"><strong>X</strong></span> to <code class="literal">0.2</code>, <span class="strong"><strong>Y</strong></span> to <code class="literal">0.2</code>, and <span class="strong"><strong>Z</strong></span> to <code class="literal">0.2</code>.</p></li></ol></div><p>Next element is smaller mountains:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set <span class="strong"><strong>Background Sprite</strong></span> to <code class="literal">Background_02</code>.</p></li><li><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Movement Distance</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Sprite</strong></span> <span class="strong"><strong>Location</strong></span> for <span class="strong"><strong>X</strong></span> to <code class="literal">3.45</code>, <span class="strong"><strong>Y</strong></span> to <code class="literal">2.25</code>, and <span class="strong"><strong>Z</strong></span> to <code class="literal">30</code>.</p></li><li><p>Set <span class="strong"><strong>Sprite</strong></span> <span class="strong"><strong>Scale</strong></span> for <span class="strong"><strong>X</strong></span> to <code class="literal">0.2</code>, <span class="strong"><strong>Y</strong></span> to <code class="literal">0.2</code>, and <span class="strong"><strong>Z</strong></span> to <code class="literal">0.2</code>.</p></li></ol></div><p>Finally, for the bigger mountains:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set <span class="strong"><strong>Background Sprite</strong></span> to <code class="literal">Background_03</code>.</p></li><li><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Movement Distance</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Sprite</strong></span> <span class="strong"><strong>Location</strong></span> for <span class="strong"><strong>X</strong></span> to <code class="literal">0</code>, <span class="strong"><strong>Y</strong></span> to <code class="literal">3.8</code>, and <span class="strong"><strong>Z</strong></span> to <code class="literal">45</code>.</p></li><li><p>Set <span class="strong"><strong>Sprite Scale</strong></span> for <span class="strong"><strong>X</strong></span> to <code class="literal">1</code>, <span class="strong"><strong>Y</strong></span> <code class="literal">1</code>, and <span class="strong"><strong>Z</strong></span> to <code class="literal">1</code>:</p></li></ol></div><p>The following is <a id="id261" class="indexterm"></a>screenshot showing the settings for all the elements:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_05_02.jpg" /></div><p>We will update the <a id="id262" class="indexterm"></a>
<span class="strong"><strong>Movement Speed</strong></span> and <span class="strong"><strong>Movement Distance</strong></span> values after we write the code that handles these values.</p><p>For now, let's write the code that will create and place the GameObjects and sprites based on the settings we just <a id="id263" class="indexterm"></a>created. In the <code class="literal">Start</code> function of the <code class="literal">SceneBackground</code> class, write the following code:</p><div class="informalexample"><pre class="programlisting">  // Use this for initialization
  void Start ( )
  {
    SpriteRenderer backgroundRenderer;
    GameObject backgroundObj;

    for (int i = 0; i &lt; SceneBackgroundElement.Length; i++)
    {
      // new GameObject
      backgroundObj = new GameObject( );

      // Parent it, set its position, and scale
      backgroundObj.transform.SetParent( transform );
      backgroundObj.transform.position = SceneBackgroundElement[i].SpriteLocation;
      backgroundObj.transform.localScale = SceneBackgroundElement[i].SpriteScale;

      // Keep reference of new object and its start location
      SceneBackgroundElement[ i ].ChildObject = backgroundObj;
      SceneBackgroundElement[ i ].ObjectStartLocation = backgroundObj.transform.position;

      // Create Renderer and set Sprite
      backgroundRenderer = backgroundObj.AddComponent&lt;SpriteRenderer&gt;();
      backgroundRenderer.sprite = SceneBackgroundElement[ i ].BackgroundSprite;
    }
  }</pre></div><p>As we only have values to use and are not using any direct reference to other GameObjects in the scene for these, we have to create them. To do this, we need a SpriteRenderer and a GameObject to hold it.</p><p>We know by the number of elements created by us (or if you were on a bigger team, the designer) in the GameObject <code class="literal">SceneBackground</code> script component that we have to create a certain number of GameObjects to hold the <code class="literal">BackgroundSprite</code> for each of the <code class="literal">SceneBackgroundElement</code> objects. In order to create all of them efficiently, we will use a <code class="literal">for</code> loop that will loop the number of created <code class="literal">SceneBackgroundElement</code> objects.</p><p>In each loop, we can create a new GameObject and set its parent using the <code class="literal">SetParent</code> function to transform the GameObject that holds this <code class="literal">SceneBackground</code> script component. We will then set its local position and scale, relative to the parent transform location, to the settings we entered. Then, we will store the new GameObject that was created to the <code class="literal">SceneBackgroundElement</code> of that loop and its location.</p><p>After this, add a <a id="id264" class="indexterm"></a>
<code class="literal">SpriteRenderer</code> component to the newly created GameObject and assign the sprite from the settings we entered to the sprite for <code class="literal">SpriteRenderer</code>.</p><p>If you run the game now, you should see a background with some mountains. The clouds will be out of the field of view of the camera. We will fix this by having them move across the screen.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec38"></a>Adding movement to SceneBackgroundElement</h3></div></div></div><p>As we <a id="id265" class="indexterm"></a>want some <a id="id266" class="indexterm"></a>movement to <code class="literal">SceneBackgroundObjects</code>, we need the code to manage it. In the <code class="literal">SceneBackground</code> class file, change the <code class="literal">Update</code> function, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">    // Update is called once per frame
    void Update ( ) 
    {
      for (int i = 0; i &lt; SceneBackgroundElement.Length; i++) 
      {
        // Does the SceneBackgroundElement move
        if (SceneBackgroundElement[i].MovementSpeed &gt; 0)
        {
          // Get current location and offset it by movement speed, based on bMoveBackwards
          Vector3 newSceneBackgroundLoc = SceneBackgroundElement[ i ].ChildObject.transform.position;
          newSceneBackgroundLoc.x += (SceneBackgroundElement[i].bMoveBackwards) 
          ? -SceneBackgroundElement[i].MovementSpeed * Time.deltaTime
          : SceneBackgroundElement[i].MovementSpeed * Time.deltaTime;

          // Set location based on movement speed offset
          SceneBackgroundElement[ i ].ChildObject.transform.position = newSceneBackgroundLoc;

          // If ChildObject has moved farther than move distance, have it move the other way.
          if (Vector3.Distance(SceneBackgroundElement[i].ChildObject.transform.position, SceneBackgroundElement[i].ObjectStartLocation) &gt;=
          SceneBackgroundElement[i].MovementDistance)
          {
            // Change the direction of the SceneBackgroundElement
            SceneBackgroundElement[ i ].bMoveBackwards = !SceneBackgroundElement[ i ].bMoveBackwards;
          }

        }
      }
    }</pre></div><p>We begin the <code class="literal">Update</code> function with a <code class="literal">for</code> loop. The <code class="literal">for</code> loop will loop through the <code class="literal">SceneBackgroundElement</code> struct variables that we created earlier. For each one of the struct elements, we will start by checking whether the <code class="literal">MoveSpeed</code> elements is greater than <span class="emphasis"><em>zero</em></span> because we do not want to try to move something if it isn't set to move.</p><p>Next, we <a id="id267" class="indexterm"></a>will create a new <a id="id268" class="indexterm"></a>
<code class="literal">Vector3</code> local variable within the scope of the <code class="literal">Update</code> function named <code class="literal">newSceneBackgroundLoc</code> and assign it to the <code class="literal">ChildObject</code> variable of the element of <code class="literal">SceneBackgroundElement</code> represented by <code class="literal">i</code>. This is the value represented by the current loop.</p><p>Once we have the position value of the <code class="literal">ChildObject</code> variable of the current <code class="literal">SceneBackgroundElement</code> variable, we can use the <span class="emphasis"><em>ternary operator</em></span> to decide which direction the <code class="literal">ChildObject</code> variable needs to be moving in. In addition, it has a rule that if you add a negative value to a positive value, it is subtracted. Then, we can use the <code class="literal">+=</code> operator to assign a negative value to the offset of <code class="literal">newSceneBackgroundLoc.x</code> if the <code class="literal">bMoveBackward</code> bool value is <code class="literal">true</code>. If it is <span class="emphasis"><em>not</em></span> <code class="literal">true</code>, we can then assign a positive value because positive plus positive is still positive. We multiply the negative or positive <code class="literal">MovementSpeed</code> value by <code class="literal">Time.deltaTime</code>, making the transition between movements a bit smoother.</p><p>We can then assign the <code class="literal">SceneBackgroundObject[ i ].ChildObject</code> position to the <code class="literal">newSceneBackgroundLoc</code> offset position, moving the <code class="literal">ChildObject</code> variable to whatever the <code class="literal">MovementSpeed</code> value is set to.</p><p>Once the <code class="literal">ChildObject</code> variable has been moved, we need to check whether the current distance from the start location is greater than the <code class="literal">MovementDistance</code> value of the current <code class="literal">SceneBackgroundObject</code>. If it is, we flip the <code class="literal">bMoveBackwards</code> value, making the previous <a id="id269" class="indexterm"></a>ternary <a id="id270" class="indexterm"></a>operator begin calculating the <code class="literal">newSceneBackgroundLoc</code> value in the opposite direction.</p><p>Let's go back to the Unity editor and change the movement values for the <code class="literal">SceneBackgroundElements</code> as follows:</p><p>In <span class="strong"><strong>Element0</strong></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">0.2</code></p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Distance</strong></span> to <code class="literal">2</code></p></li></ul></div><p>In <span class="strong"><strong>Element1</strong></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">1</code></p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Distance</strong></span> to <code class="literal">6</code></p></li></ul></div><p>In <span class="strong"><strong>Element2</strong></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">0.2</code></p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Distance</strong></span> to <code class="literal">4</code></p></li></ul></div><p>In<span class="strong"><strong> Element3</strong></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Speed</strong></span> to <code class="literal">0.2</code></p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Movement Distance</strong></span> to <code class="literal">4</code></p></li></ul></div><p>If you play the game now, you will see a lot more movement with the <code class="literal">SceneBackgroundElements</code>. Feel free to adjust these values to anything you want. The values are literal, meaning the larger the number, the farther/faster the object will change.</p></div></div>