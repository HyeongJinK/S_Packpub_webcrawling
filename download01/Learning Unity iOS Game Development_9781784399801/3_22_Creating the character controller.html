<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec26"></a>Creating the character controller</h2></div></div><hr /></div><p>These settings <a id="id107" class="indexterm"></a>allow the sprite sheet to be animated, have the same detail as the normal image, and keep the max file size down by limiting the max texture sheet size to 1024 pixels.</p><p>Next, we need to update the sprite sheet so that it knows the boundaries for each of the animation frames in the sheet. To perform this, in <span class="strong"><strong>Inspector</strong></span>, click on <span class="strong"><strong>Sprite</strong></span> <span class="strong"><strong>Editor</strong></span>.</p><p>This is designed to help us break the image based on the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> values we want to. For example, if each frame of the animation is <code class="literal">32</code> pixels wide on <span class="strong"><strong>X</strong></span> and <code class="literal">32</code> pixels wide on <span class="strong"><strong>Y</strong></span>, we can use the <span class="strong"><strong>Sprite Editor</strong></span> to cut the image into smaller images based on that size.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In <span class="strong"><strong>Sprite </strong></span><a id="id108" class="indexterm"></a>
<span class="strong"><strong>Editor</strong></span>, click on <span class="strong"><strong>Slice</strong></span> in the top-left corner of the window.</p></li><li><p>Select <span class="strong"><strong>Type</strong></span> as <span class="strong"><strong>Grid</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Pixel Size</strong></span> on <span class="strong"><strong>X</strong></span> as <code class="literal">32</code> and <span class="strong"><strong>Y</strong></span> as <code class="literal">32</code>.</p></li><li><p>Leave <span class="strong"><strong>Offset</strong></span> and <span class="strong"><strong>Padding</strong></span> as <code class="literal">0</code>.</p></li><li><p>Change the <span class="strong"><strong>Pivot</strong></span> to <span class="strong"><strong>Top</strong></span> <span class="strong"><strong>Left</strong></span>.</p></li><li><p>Then, click on <span class="strong"><strong>Slice</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_04.jpg" /></div></li></ol></div><p>This should result in the image being sliced into 32 x 32 boxes across the whole image. Take a look at the following image:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_05.jpg" /></div><p>The major issue with this image is that it has the character facing in the wrong direction because the character will run from left to right in the game and not from right to left, as shown in the preceding image. We will fix this later by flipping the <span class="strong"><strong>X</strong></span> axis of the character to -1, which will have the character face the correct orientation.</p><p>In the <code class="literal">Assets</code> folder, you <a id="id109" class="indexterm"></a>can see that <code class="literal">CharacterSheet</code> went from a single image to now a parent object with 16 children, ranging from <code class="literal">CharacterSheet_0</code> to <code class="literal">CharacterSheet_15</code>.</p><p>In order to make this <code class="literal">CharacterSheet</code> work in game, we need to create an animation for it. To perform this, select the <code class="literal">CharacterSheet</code> parent object in the <code class="literal">Assets</code> folder and left-click and drag it onto the <span class="strong"><strong>Scene</strong></span> window.</p><p>You should see a popup asking you to save the anim file in the <code class="literal">Assets/Character</code> folder. Name it <code class="literal">Character_Run</code> and click on <span class="strong"><strong>Save</strong></span>. Remember to drag it onto Scene and <span class="emphasis"><em>not</em></span> on Hierarchy. If you drag it onto Hierarchy, the animation window will <span class="emphasis"><em>not</em></span> appear.</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_06.jpg" /></div><p>After you click on <span class="strong"><strong>Save</strong></span>, a couple of things will happen. The first and most noticeable change is that the GameObject named <code class="literal">CharacterSheet_0</code> will be available in your game world. The second and third things are additions to files in your <code class="literal">Assets/Character</code> folder.</p><p>The first file added will be the <code class="literal">.anim</code> file called <code class="literal">Character_Run</code>. This is the <span class="strong"><strong>animation</strong></span> file that is in charge to cycle the animation of the character. The second is a <span class="strong"><strong>controller</strong></span> file.</p><p>The <span class="strong"><strong>controller</strong></span> file is used to set how the character will blend its animations. Double-click on the <code class="literal">ControllerSheet_0</code> controller file to open it. You will see three nodes: the <span class="strong"><strong>Any State</strong></span> node, the <a id="id110" class="indexterm"></a>
<span class="strong"><strong>Entry</strong></span> node, and the <span class="strong"><strong>Character_Run</strong></span> node. The <span class="strong"><strong>Any State</strong></span> node is the node that essentially starts the controller, meaning that no matter what goes on in the controller file, this is what will run as long as it exists.</p><p>In order to start your controller, right-click on the <span class="strong"><strong>Any State</strong></span> node and select <span class="strong"><strong>Make Transition</strong></span>. You'll see that your mouse will not be connected to a white line with an arrow in the middle.</p><p>Move the end of the white line and click on the <span class="strong"><strong>Character_Run</strong></span> node. This connects the <span class="strong"><strong>Any State</strong></span> node to the <span class="strong"><strong>Character_Run</strong></span> node, making it the default node that will play if this controller is being used. This will be the case for our character.</p><p>To be sure, select <span class="strong"><strong>File</strong></span> and then click on <span class="strong"><strong>Save Project</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_07.jpg" /></div><p>Next, we need to complete the controller by adding a jumping portion to it. To perform this, we need to take the same steps as the <span class="strong"><strong>Character_Run</strong></span> node:</p><p>In the <code class="literal">Assets/Character</code> folder, right-click on and select <span class="strong"><strong>Import New Asset…</strong></span>.</p><p>In the same <code class="literal">ChapterThree_Character</code> folder, select the <code class="literal">CharacterJumpSheet.png</code> file and import it.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With the new <a id="id111" class="indexterm"></a>import file selected, go to Inspector and set <span class="strong"><strong>Sprite Mode</strong></span> as <span class="strong"><strong>Multiple</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Filter Mode</strong></span> as <span class="strong"><strong>Point</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Max Size</strong></span> as <span class="strong"><strong>512</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Format</strong></span> as <span class="strong"><strong>Truecolor</strong></span>.</p></li><li><p>Then, click on <span class="strong"><strong>Apply</strong></span>.</p></li><li><p>We now need to slice <span class="strong"><strong>CharacterJumpSheet.png</strong></span> into the same 32 x 32 subimages.</p></li><li><p>Open the <span class="strong"><strong>Sprite Editor</strong></span> by having <span class="strong"><strong>CharacterJumpSheet.png</strong></span> selected and click on <span class="strong"><strong>Sprite</strong></span> <span class="strong"><strong>Editor</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Slice</strong></span> in the top-right corner of the<span class="strong"><strong> Sprite Editor</strong></span> window.</p></li><li><p>Select <span class="strong"><strong>Type</strong></span> as <span class="strong"><strong>Grid</strong></span>.</p></li><li><p>Select <span class="strong"><strong>Pixel</strong></span> <span class="strong"><strong>Size</strong></span> for <span class="strong"><strong>X</strong></span> as <code class="literal">32</code>.</p></li><li><p>Select <span class="strong"><strong>Pixel</strong></span> <span class="strong"><strong>Size</strong></span> for <span class="strong"><strong>Y</strong></span> as <code class="literal">32</code>.</p></li><li><p>Select <span class="strong"><strong>Pivot</strong></span> as <span class="strong"><strong>Top</strong></span> <span class="strong"><strong>Left</strong></span>.</p></li><li><p>Then, click on <span class="strong"><strong>Slice</strong></span> and then on <span class="strong"><strong>Apply</strong></span>.</p></li></ol></div><p>You should now have a similar file as what <code class="literal">CharacterSheet</code> shows and a parent object name (<code class="literal">CharacterJumpSheet</code>) with <span class="emphasis"><em>two</em></span> children named <code class="literal">CharacterJumpSheet_0</code> and <code class="literal">CharacterJumpSheet_1</code>.</p><p>In order to have an animation that we can use for this file and <code class="literal">CharacterSheet</code>, perform the same as what we did earlier for <code class="literal">CharacterSheet</code>: click on <code class="literal">CharacterJumpSheet</code> and drag it onto the <span class="strong"><strong>Scene</strong></span> window.</p><p>Name the anim file <code class="literal">Character_Jump</code>.</p><p>One thing that needs mentioning is that by default, Unity will create another controller file for this animation. We do not need this.</p><p>Click on <code class="literal">CharacterJumpSheet_0.controller</code> and then <span class="emphasis"><em>Delete</em></span> on your keyboard. Alternatively, you can right-click on <code class="literal">CharacterJumpSheet_0</code> and select <span class="strong"><strong>Delete</strong></span> from the options.</p><p>We now need to connect the new <code class="literal">Character_Jump.anim</code> file to the <code class="literal">ControllerSheet_0.controller</code> file. To start with, open the <code class="literal">ControllerSheet_0.controller</code> file. Now, you can again see the animation state controller in the <span class="strong"><strong>Animator</strong></span> window.</p><p>Before adding the <a id="id112" class="indexterm"></a>
<code class="literal">Controller_Jump.anim</code> file, we first need to create a <span class="strong"><strong>parameter</strong></span> for the controller file to use in order to blend between the two animations we have. In the top-left corner of the <span class="strong"><strong>Animator</strong></span> window, there are two tabs: <span class="strong"><strong>Layers</strong></span> and <span class="strong"><strong>Parameters</strong></span>. Click on <span class="strong"><strong>Parameters</strong></span>.</p><p>Under the selection for <span class="strong"><strong>Parameters</strong></span>, there is a small <span class="strong"><strong>+</strong></span> icon. Click on it and select <span class="strong"><strong>Bool</strong></span>. Name this bool <code class="literal">Jump</code>:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_08.jpg" /></div><p>The parameter system in the <span class="strong"><strong>Animator</strong></span> window is a utility that allows you to blend between specific animations during the period for which the game runs. In our case, we need to let our controller know when the player jumps. When this happens, we can change the bool value in the controller to true and the animations will blend from running to jumping.</p><p>Next, let's add the <code class="literal">Character_Jump.anim</code> file to the controller. To perform this, select the anim file and then click and drag it onto the <span class="strong"><strong>Animator</strong></span> window. You'll see that a new animation state box called <span class="strong"><strong>Character_Jump</strong></span> will appear in the <span class="strong"><strong>Animator</strong></span> window.</p><p>We now need to connect the <span class="strong"><strong>Character_Run</strong></span> state to the <span class="strong"><strong>Character_Jump</strong></span> state. As before, when we connected states, right-click on the <span class="strong"><strong>Character_Run</strong></span> state box and select <span class="strong"><strong>Make Transition</strong></span>. Then, with the white line attached to the mouse cursor, click on <span class="strong"><strong>Character_Jump</strong></span>.</p><p>We also need to <a id="id113" class="indexterm"></a>connect <span class="strong"><strong>Character_Jump</strong></span> to the <span class="strong"><strong>Character_Run</strong></span> state box. To perform this, follow the same steps of selecting the animation state box—this time <span class="strong"><strong>Character_Jump</strong></span>—and select <span class="strong"><strong>Make Transition</strong></span>. With the white line attached to the mouse cursor, click on <span class="strong"><strong>Character_Run</strong></span>.</p><p>This will now make it such that both the animation states are connected to each other and allows you to blend between each of them:</p><div class="mediaobject"><img src="/graphics/9781784399801/graphics/B04063_03_09.jpg" /></div><p>For the controller to know when to switch between these two animation states, we have to tell the transition lines what parameter to look out for. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the transition line from <span class="strong"><strong>Character_Run </strong></span>to <span class="strong"><strong>Character_Jump</strong></span>.</p></li><li><p>In <span class="strong"><strong>Inspector</strong></span>, at the bottom, look for the <span class="strong"><strong>Conditions</strong></span> section. In this section, there is a gray <span class="strong"><strong>+</strong></span> button.</p></li><li><p>Click on the gray <span class="strong"><strong>+</strong></span> button.</p></li></ol></div><p>As we only have <span class="emphasis"><em>one</em></span> parameter, this will automatically fill with <span class="strong"><strong>Jump</strong></span> and set it to <span class="strong"><strong>true</strong></span>.</p><p>Next, find the section named<span class="strong"><strong> Has Exit Time</strong></span> and uncheck this selection box. If checked, this setting allows the animation to complete before it transitions into the new state. As we want the <span class="strong"><strong>Jump</strong></span> animation to play as soon as the input has been received from the player, we will uncheck it.</p><p>We now need to do the same thing in reverse to connect <span class="strong"><strong>Character_Jump</strong></span> to the <span class="strong"><strong>Character_Run</strong></span> transition.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <a id="id114" class="indexterm"></a>transition line that faces from <span class="strong"><strong>Character_Jump</strong></span> to <span class="strong"><strong>Character_Run</strong></span>.</p></li><li><p>Now, click on the gray <span class="strong"><strong>+</strong></span> button in <span class="strong"><strong>Conditions</strong></span>.</p></li><li><p>Change <span class="strong"><strong>true</strong></span> to <span class="strong"><strong>false</strong></span>.</p></li><li><p>Then, uncheck the<span class="strong"><strong> Has Exit Time</strong></span> box.</p></li><li><p>To save, click on <span class="strong"><strong>File</strong></span> and select <span class="strong"><strong>Save Project</strong></span>.</p></li></ol></div></div>