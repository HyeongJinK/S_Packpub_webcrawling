<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec41"></a>Working with events</h2></div></div><hr /></div><p>Behind the new UI <a id="id589" class="indexterm"></a>system is the introduction of a new <span class="strong"><strong>UnityEvent</strong></span> logic that is intended to standardize and delegate managed interactions between GameObjects in a scene; primarily, it focuses the input interactions with the new UI but it doesn't have to stop there.</p><p>At the core of the new UI system there is a new type of delegate manager called the <span class="strong"><strong>UnityEvent</strong></span>. This manager allows you to create, add, and remove multiple delegate functions to it and execute them all at once.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note147"></a>Note</h3><p>The <span class="strong"><strong>UnityEvent</strong></span> is <a id="id590" class="indexterm"></a>an extension of the base delegate pattern that is found in most programming languages, obviously now tuned to work better from within Unity's own engine and language interpreter.</p><p>For more detail about <a id="id591" class="indexterm"></a>delegates, see:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<a class="ulink" href="http://bit.ly/CSharpDelegates" target="_blank">http://bit.ly/CSharpDelegates</a>—MS Reference</p></li><li style="list-style-type: disc"><p>
<a class="ulink" href="http://bit.ly/CSharpDelegateTutorial" target="_blank">http://bit.ly/CSharpDelegateTutorial</a>—MS Delegate tutorial</p></li><li style="list-style-type: disc"><p>
<a class="ulink" href="http://bit.ly/PowerOfDelegates" target="_blank">http://bit.ly/PowerOfDelegates</a>—Power of delegates</p></li></ul></div></div><p>Starting simple, we'll create a script that will output to the console to show the event has occurred. Create a <a id="id592" class="indexterm"></a>new <code class="literal">c#</code> script called <code class="literal">SimpleEvent.cs</code> and replace its contents with the following:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note148"></a>Note</h3><p>For standards stake, you should add scripts into a folder called <code class="literal">Scripts</code> and scenes into a folder called <code class="literal">Scenes</code>. It's up to you; this isn't mandatory or anything.</p></div><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.Events;
 
public class SimpleEvent : MonoBehaviour {
  //My UnityEvent Manager
  public UnityEvent myUnityEvent = new UnityEvent();
 
  void Start () {
    //Subscribe my delegate to my UnityEvent Manager
    myUnityEvent.AddListener(MyAwesomeDelegate);
    //Execute all registered delegates
    myUnityEvent.Invoke();
  }
 
  //My Delegate function
  private void MyAwesomeDelegate()
  {
    Debug.Log("My Awesome UnityEvent lives");
  }
}</pre></div><p>Now, create a new scene and add an empty GameObject into the scene, then rename it to <code class="literal">SimpleEventObject</code> (as this GameObject is just there to attach the script to, it doesn't matter what it is actually called). Then either drag the script to the new <code class="literal">SimpleEventObject</code> GameObject or click on <span class="strong"><strong>Add</strong></span> <span class="strong"><strong>Component</strong></span> in the inspector (with the new <span class="strong"><strong>SimpleEventObject</strong></span> GameObject selected) and find the <span class="strong"><strong>SimpleEvent</strong></span> script to add to it.</p><p>Once you have added the script to the <span class="strong"><strong>SimpleEventObject</strong></span>, then you see the following view in the Inspector:</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_01.jpg" /><div class="caption"><p>Inspector showing the UnityEvent property drawer</p></div></div><p>You should recognize the property drawer shown as it's the same one that's used by the built-in UI components that can be interacted with, such as the Button, Slider, and so on. It works the same way too because they also use <span class="strong"><strong>UnityEvents</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note149"></a>Note</h3><p>Note that it doesn't have to be a UI object you attach the script to; it doesn't even need to have an <span class="strong"><strong>EventSystem</strong></span> in the scene for <span class="strong"><strong>UnityEvents</strong></span> to function!</p></div><p>With the <span class="strong"><strong>SimpleEvent</strong></span> <a id="id593" class="indexterm"></a>script attached to the <span class="strong"><strong>SimpleEventObject</strong></span> GameObject, when you run your project now, the script will:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Call the <code class="literal">Start</code> method when the scene runs.</p></li><li><p>Register the <code class="literal">MyAwesomeDelegate</code> function as a delegate of the new <span class="strong"><strong>UnityEvent.</strong></span>
</p></li><li><p>
<code class="literal">Invoke</code> (run) the <code class="literal">UnityEvent</code>, which causes all delegates to fire.</p></li><li><p>Run the <code class="literal">MyAwesomeDelegate</code> method and output to the debug console.</p></li></ol></div><p>This is all nice and neat but pretty much the same as what you can do with regular delegates. However, as with the other <span class="strong"><strong>UnityEvent</strong></span> implementations, we can also configure the <span class="strong"><strong>UnityEvent</strong></span> in the inspector thanks to its very useful <span class="strong"><strong>Property drawer</strong></span>.</p><p>To show this, let's add an additional method to the previous script (a public one this time) as follows:</p><div class="informalexample"><pre class="programlisting">public void RunMeFromTheInspector()
{
  Debug.Log("Look, I was configured in the inspector");
}</pre></div><p>Then in the inspector, do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <span class="strong"><strong>SimpleEventObject</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>+</strong></span> symbol of the <span class="strong"><strong>UnityEvent</strong></span> property drawer to register a new <span class="strong"><strong>Event</strong></span>.</p></li><li><p>Leave the <span class="strong"><strong>Runtime Only</strong></span> option alone, since we don't need it running in the editor.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note150"></a>Note</h3><p>The option <span class="strong"><strong>Editor</strong></span> <span class="strong"><strong>And</strong></span> <span class="strong"><strong>Runtime</strong></span> is effectively the same as using the <code class="literal">[ExecuteInEditMode]</code> code attribute you can use in code. Just runs it continually <a id="id594" class="indexterm"></a>while the editor is open as well as when the game is running.</p><p>Refer to <a class="ulink" href="http://docs.unity3d.com/ScriptReference/ExecuteInEditMode.html" target="_blank">http://docs.unity3d.com/ScriptReference/ExecuteInEditMode.html</a> for more information.</p></div></li><li><p>Select the <a id="id595" class="indexterm"></a>
<span class="strong"><strong>SimpleEventObject</strong></span> using the object selector in the field below the <span class="strong"><strong>Runtime Only</strong></span> option (or drag the GameObject from the scene on to the field). This selects the object the <span class="strong"><strong>Event</strong></span> is to fire against.</p></li><li><p>Finally, use the drop-down box to the right of the <span class="strong"><strong>Runtime Only</strong></span> option to select the action to fire on the selected GameObject. In this case, select the <span class="strong"><strong>SimpleEvent</strong></span> <span class="strong"><strong>| RunMeFromTheInspector()</strong></span> option to run our new delegate function we created earlier.</p></li></ol></div><p>This should result in the following view in the <span class="strong"><strong>Inspector</strong></span> with the <span class="strong"><strong>SimpleEventObject</strong></span> selected in the hierarchy: </p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_02.jpg" /></div><p>When the project is run this time, it will give us the same effect as with the code declaration. However, it is now being performed using the editor configuration, a world of choice at your <a id="id596" class="indexterm"></a>fingertips. (You should see two output events, one from code and one from the editor configured option.)</p><p>Well, that is all well and good being able to click on something and start an action, but what about if we also want to send some data?</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec70"></a>Using a parameter</h3></div></div></div><p>We can expand on <a id="id597" class="indexterm"></a>the previous example by using a set of parameters as part of the <code class="literal">UnityEvent</code> call. First you need to declare a new class type using the <a id="id598" class="indexterm"></a>parameter pattern you wish to use. This needs to derive from (or be based upon) the <code class="literal">UnityEvent</code> class using the data type of the information you want to pass. For example, let's create a new <code class="literal">C#</code> script called <code class="literal">MyParameterizedEventClass</code> that will derive from <code class="literal">UnityEvent</code> using a string parameter as follows:</p><div class="informalexample"><pre class="programlisting">using System;
using UnityEngine.Events; 

[Serializable]
public class MyParameterizedEventClass : UnityEvent&lt;string&gt;{}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note151"></a>Note</h3><p>If you don't add the <code class="literal">[Serializable]</code> attribute tag to the class type, the <code class="literal">UnityEvent</code> will not be available in the editor inspector! (Which you may want to enforce.)</p><p>Also, don't forget to add the following <code class="literal">using</code> statement to the script file (for the <code class="literal">Serializable</code> attribute), else you will get errors:</p><div class="informalexample"><pre class="programlisting">using System;</pre></div></div><p>With our new type, we can now create and use the event as before but now with an optional parameter. So create a new <code class="literal">C#</code> script called <code class="literal">SimpleParameterizedEvent</code>, and replace its contents with the following code:</p><div class="informalexample"><pre class="programlisting">using System;
using UnityEngine;
using UnityEngine.Events;
 
public class SimpleParameterizedEvent : MonoBehaviour {
  //My parameterized UnityEvent Manager
  public  MyParameterizedEventClass myParameterizedEvent = 
new MyParameterizedEventClass();
 
  void Start () 
  {
  //Subscribe my delegate to my parameterized UnityEvent Manager
    myParameterizedEvent.AddListener(MyOtherDelegate);
 
  // Execute all registered delegates with the string parameter
    myParameterizedEvent.Invoke("Hello World");
  }

  //My parameterized Delegate function
  private void MyOtherDelegate(string arg0)
  {
    Debug.Log("Some Message - " + arg0);
  }

  public void RunMeFromTheInspector(string arg0)
  {
    Debug.Log("What are you telling me? : " + arg0);
  }
}</pre></div><p>If we then add this to our <a id="id599" class="indexterm"></a>scene as before on a new empty GameObject called <span class="strong"><strong>SimpleParameterizedEventObject</strong></span> and also configure it in the editor as <a id="id600" class="indexterm"></a>before using the static version of the <code class="literal">RunMeFromTheInspector(string)</code> method as shown in the following screenshot, we get the same as before but we are now passing it some additional information in the call using the new value field:</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_03.jpg" /></div><p>So when we run the project with the previous configuration, we get one message from the code saying <span class="strong"><strong>Some Message - Hello World</strong></span> and one message from the editor configuration saying "<span class="strong"><strong>What are you telling me? : Inspector Gadget</strong></span>".</p><p>It's a little more <a id="id601" class="indexterm"></a>complicated but also gives you a little more <a id="id602" class="indexterm"></a>freedom.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note152"></a>Note</h3><p>
<span class="strong"><strong>A word about parameter types</strong></span>
</p><p>It is worth noting <a id="id603" class="indexterm"></a>that at present, Unity only supports the <code class="literal">C#</code> base types (<code class="literal">bool</code>, <code class="literal">string</code>, <code class="literal">int</code>, and <code class="literal">float</code>) and Unity types (GameObject, and so on) as parameter types with UnityEvents. </p><p>See this video at the 10:30 timestamp for more details on the supported data types <a class="ulink" href="http://bit.ly/UnityEventSupportedTypes" target="_blank">http://bit.ly/UnityEventSupportedTypes</a>.</p></div><p>You can have up to four parameters in a single method with the current version of the <code class="literal">UnityEvent</code> class at present but you can extend that, if you wish, in the source code (see the <span class="emphasis"><em>Getting access to the source</em></span> section later in this chapter)</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec71"></a>Built-in event interfaces</h3></div></div></div><p>For the UI <a id="id604" class="indexterm"></a>system, Unity has built a horde of event types and <a id="id605" class="indexterm"></a>interfaces to support these events, ready to use, straight out of the box. Each of these is implicitly implemented in the Input handlers to ensure all the events occur at the right time depending on user input.</p><p>The events that are currently available in Unity 4.6 broken down in to their respective groups are as follows: (which could change over time):</p><p>The <a id="id606" class="indexterm"></a>Pointer Events:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">IPointerEnterHandler</code>: This occurs when a cursor (for example a mouse cursor) <a id="id607" class="indexterm"></a>enters the <span class="strong"><strong>Rect Transform</strong></span> area of a UI object</p></li><li style="list-style-type: disc"><p>
<code class="literal">IPointerExitHandler</code>: This occurs when a cursor leaves the <span class="strong"><strong>Rect Transform</strong></span> <a id="id608" class="indexterm"></a>area of a UI object</p></li><li style="list-style-type: disc"><p>
<code class="literal">IPointerDownHandler</code>: This occurs when input presses on a selectable UI control (for example, a <a id="id609" class="indexterm"></a>button)</p></li><li style="list-style-type: disc"><p>
<code class="literal">IPointerUpHandler</code>: This <a id="id610" class="indexterm"></a>occurs when input is released on a selectable UI control </p></li><li style="list-style-type: disc"><p>
<code class="literal">IPointerClickHandler</code>: This <a id="id611" class="indexterm"></a>occurs when input clicks (presses and releases) on a selectable UI control</p></li></ul></div><p>The <a id="id612" class="indexterm"></a>
<span class="strong"><strong>Drag Handlers</strong></span> events:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">IInitializePotentialDragHandler</code>: This is the first point at which a drag <a id="id613" class="indexterm"></a>could be taking place</p></li><li style="list-style-type: disc"><p>
<code class="literal">IBeginDragHandler</code>: This <a id="id614" class="indexterm"></a>means a confirmed drag action has begun</p></li><li style="list-style-type: disc"><p>
<code class="literal">IDragHandler</code>: This <a id="id615" class="indexterm"></a>means a UI component is being dragged (pointer down and cursor movement)</p></li><li style="list-style-type: disc"><p>
<code class="literal">IEndDragHandler</code>: This <a id="id616" class="indexterm"></a>means a dragged UI component has been released (pointer released when dragging)</p></li><li style="list-style-type: disc"><p>
<code class="literal">IDropHandler</code>: This <a id="id617" class="indexterm"></a>is the same as end drag but without drag data</p></li></ul></div><p>The <a id="id618" class="indexterm"></a>
<span class="strong"><strong>Miscellaneous</strong></span> handler events:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">IScrollHandler</code>: This <a id="id619" class="indexterm"></a>occurs whenever scrolling is detected from an input device; for example a mouse scroll wheel</p></li><li style="list-style-type: disc"><p>
<code class="literal">IUpdateSelectedHandler</code>: This <a id="id620" class="indexterm"></a>occurs when the selected UI control is updated/changed</p></li><li style="list-style-type: disc"><p>
<code class="literal">ISelectHandler</code>: This <a id="id621" class="indexterm"></a>occurs when a UI control is selected/focused upon</p></li><li style="list-style-type: disc"><p>
<code class="literal">IDeselectHandler</code>: This <a id="id622" class="indexterm"></a>occurs when a UI control is unselected/loses focus</p></li><li style="list-style-type: disc"><p>
<code class="literal">IMoveHandler</code>: This <a id="id623" class="indexterm"></a>occurs whenever a controller moves (uses <code class="literal">Input.GetAxis</code>)</p></li><li style="list-style-type: disc"><p>
<code class="literal">ISubmitHandler</code>: This <a id="id624" class="indexterm"></a>occurs whenever a <span class="strong"><strong>Submit</strong></span> button is pressed (default, the <span class="emphasis"><em>Enter</em></span> key)</p></li><li style="list-style-type: disc"><p>
<code class="literal">ICancelHandler</code>: This <a id="id625" class="indexterm"></a>occurs whenever a <span class="strong"><strong>Submit</strong></span> button is pressed (default, the <span class="emphasis"><em>Esc</em></span> key)</p></li></ul></div><p>By using <a id="id626" class="indexterm"></a>these interfaces in your scripts, you can automatically bind to these events when they occur. Now that we know what's available, how do we use them?</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec72"></a>Executing events</h3></div></div></div><p>To use the built-in <a id="id627" class="indexterm"></a>events (so your script reacts when the event occurs) is quite simple. As an example, we'll put together a simple script that shows a tooltip when you hover over a UI element.</p><p>First create a new <code class="literal">C#</code> script called <code class="literal">Tooltip</code> and replace its contents with the following:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;
using UnityEngine.UI;
 
public class Tooltip : MonoBehaviour
{
  private bool m_tooltipDisplayed = false;
  public RectTransform TooltipItem;
  private Vector3 m_tooltipOffset;
}</pre></div><p>Next we'll add the two event interfaces we will use for the tooltip, <code class="literal">IPointerEnterHandler</code> (to detect when the mouse moves over a UI GameObject) and <code class="literal">IPointerExitHandler</code> (to detect when the mouse moves away from a UI GameObject). To do this, simply update the class definition to the following:</p><div class="informalexample"><pre class="programlisting">public class Tooltip : MonoBehaviour<span class="strong"><strong>, IPointerEnterHandler, IPointerExitHandler</strong></span>
</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip44"></a>Tip</h3><p>When you create your own classes using the event handlers, the interface names are sometimes shown with red squiggles. To fix this just right-click the interface with the red squiggle and select <span class="strong"><strong>Resolve | using UnityEngine.EventSystems</strong></span> menu item.</p><p>You can also just add the <code class="literal">using UnityEngine.EventSystems;</code> to the top of the script manually.</p></div><p>With the interfaces added, we need to add the handler methods for those interfaces, so add the following to your script:</p><div class="informalexample"><pre class="programlisting">public void OnPointerEnter(PointerEventData eventData)
{
  //Mark the tooltip as displayed
  m_tooltipDisplayed = true;
  //Move the tooltip item to the detected GO and offset it above
  TooltipItem.transform.position = 
transform.position + m_tooltipOffset;
  //Activate the tooltip
  TooltipItem.gameObject.SetActive(m_tooltipDisplayed);
}
 
public void OnPointerExit(PointerEventData eventData)
{
  m_tooltipDisplayed = false;
  TooltipItem.gameObject.SetActive(m_tooltipDisplayed);
}</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip45"></a>Tip</h3><p>Alternatively, in <a id="id628" class="indexterm"></a>Visual Studio or MonoDevelop, you can just right-click the interface name (for example, <code class="literal">IPointerEnterHandler</code>) and navigate to <span class="strong"><strong>Implement Interface</strong></span> | <span class="strong"><strong>Implement Interface</strong></span> to add all the necessary methods to your class automatically.</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_04.jpg" /></div><p>You just then need to add code to the generated method for what to do when the event occurs (as shown in the previous screenshot).</p><p>It is also worth <a id="id629" class="indexterm"></a>noting that in different versions of MonoDevelop and Visual Studio, the public portion of the function may or may not be added. Either will work, and it's up to you whether you want to expose those functions outside of your script.</p></div><p>To finish, we just need to set up the properties for when the script starts by adding the following method to the <code class="literal">Tooltip</code> script:</p><div class="informalexample"><pre class="programlisting">void Start () {
  //Offset the tooltip above the target GameObject
  m_tooltipOffset = 
new Vector3(0,TooltipItem.sizeDelta.y ,0);
  //Deactivate the tooltip so that it is only shown when you
//want it to
  TooltipItem.gameObject.SetActive(m_tooltipDisplayed);
}</pre></div><p>Now that you have the script, in order to use it we need to:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a <code class="literal">UI</code> element called <code class="literal">HoverOverMe</code> on a <span class="strong"><strong>Canvas</strong></span> and add the <code class="literal">Tooltip</code> script to it.</p></li><li><p>Create another <code class="literal">UI</code> element for the <span class="strong"><strong>tooltip</strong></span>, say an image (add a <code class="literal">Text</code> component as a child if you wish). Make sure to position it off the UI Canvas so it does not block the UI on startup.</p></li><li><p>Select the <span class="strong"><strong>HoverOverMe</strong></span> GameObject and set the <span class="strong"><strong>Tooltip Item</strong></span> property of the <span class="strong"><strong>Tooltip </strong></span>script to the UI element you created for the tooltip.</p></li></ol></div><p>Done! Now when you run the project, the tooltip will pop up above the UI element you attached the script to when the mouse moves over it and when it moves away it will be hidden. In the example <a id="id630" class="indexterm"></a>project, I created an <span class="strong"><strong>Image</strong></span> and added the <span class="strong"><strong>ToolTip script</strong></span> to it. I then added another <span class="strong"><strong>Image</strong></span> called <span class="strong"><strong>ToolTip</strong></span>, this time with a <span class="strong"><strong>Text</strong></span> control as a child (setting the <span class="strong"><strong>Text Anchor</strong></span> to <span class="strong"><strong>Fill</strong></span>). Finally, I set the <span class="strong"><strong>Tooltip Item</strong></span> property of the script on the initial <span class="strong"><strong>Image</strong></span> to my new ToolTip Image/Text GameObject. This was the result:</p><p>Note, the Tooltip (shown in green) only appears when the mouse is over the GameObject (shown in white).</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_12.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note153"></a>Note</h3><p>Note: This is a very basic implementation and only works for <span class="strong"><strong>Screen Space – Overlay</strong></span> canvases. To use it with <span class="strong"><strong>Screen Space – Camera</strong></span> or <span class="strong"><strong>World Space</strong></span> canvases, you will have to translate the mouse position with the <code class="literal">ScreenPointToRay</code> function (check out the <span class="strong"><strong>UIWindowBase</strong></span> example later for more details).</p></div><p>You could also have several objects using the same tooltip; or even make the tooltip dynamic and change its text/image based on the object it hovers over.</p><p>So how does this actually work then? Sure, we have this script but what does it all mean?</p><p>Since we added <a id="id631" class="indexterm"></a>the <code class="literal">IPointerEnterHandler</code> and <code class="literal">IPointerExitHandler</code> interfaces, the following now happens:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note154"></a>Note</h3><p>Note: If you only add the interfaces and not the implemented methods, your script will fail with a message like this:</p><p>
<span class="strong"><strong>Does not implement interface member</strong></span> <code class="literal">UnityEngine.EventSystems.IPointerExitHandler.OnPointerExit</code>(<code class="literal">UnityEngine.EventSystems.PointerEventData</code>)'</p><p>To fix this, add the methods you are missing manually, or by using the automatic method mentioned earlier.</p></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>You have a script that implemented one of the previously mentioned events attached to a GameObject in a scene</p></li><li style="list-style-type: disc"><p>When an input handler (say the <code class="literal">StandaloneInputModule</code>) needs to fire an event it will search for relevant GameObjects that implement the interface for the event (this may be limited to those identified by raycast hits)</p></li><li style="list-style-type: disc"><p>If a GameObject is found to be implementing the relevant interface, it then executes the handler method for that interface and passes the necessary data for that event with it</p></li></ul></div><p>Some events are managed by the Input handlers, others are managed by the Event<span class="strong"><strong> </strong></span>system itself.</p><p>All this framework <a id="id632" class="indexterm"></a>does, is to make it incredibly simple to add handling for these types of events to any script or component easily.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec73"></a>Building your own handlers or custom events</h3></div></div></div><p>Now, you <a id="id633" class="indexterm"></a>don't have to edit Unity's UI source code to build <a id="id634" class="indexterm"></a>your own events; you can just write your own. It is a bit of a <a id="id635" class="indexterm"></a>complicated setup but if you follow the standard, then it will be a lot easier to manage alongside Unity's UI framework (and if you find it immensely useful you could submit it to Unity later).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note155"></a>Note</h3><p>This is optional, of course, and you can still do your own thing if you are so inclined. However, a lot of thought went into the current event framework that Unity has built, so it's worth considering.</p></div><p>To build your own <a id="id636" class="indexterm"></a>event, you will need to define the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A custom event data structure (extending from <code class="literal">BaseEventData</code>).</p></li><li style="list-style-type: disc"><p>An interface for the custom event (extending from <code class="literal">IEventSystemHandler</code>).</p></li><li style="list-style-type: disc"><p>A static container class containing the Execute functions.</p></li><li style="list-style-type: disc"><p>(<span class="emphasis"><em>Optional</em></span>) An Input module (extending from <code class="literal">BaseInputModule</code>) to process and execute your events. This could be done from anywhere, however.</p></li><li style="list-style-type: disc"><p>A class or GameObject that implements your interface (covered previously).</p></li></ul></div><p>This sounds like a lot, but in reality it really is (just kidding)!</p><p>The main reason you would want to build your own events is to manage things going on in your game world that other objects need to know about, such as:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>An alarm system alerting all droids to swarm in</p></li><li style="list-style-type: disc"><p>Targeting data, to tell your starships to attack a certain point</p></li><li style="list-style-type: disc"><p>A conversation or event log system, where several parties needs to feed data in to be displayed</p></li></ul></div><p>If we take the first example, let's walk through setting up our custom event handler. An alarm system is a great <a id="id637" class="indexterm"></a>fit for this, especially with an <span class="strong"><strong>Input Manager</strong></span> that <a id="id638" class="indexterm"></a>monitors all cameras and sends all the droids if one <a id="id639" class="indexterm"></a>detects something. (I really like this idea, as it could open up <a id="id640" class="indexterm"></a>possibilities of hacking cameras to prevent the alarm being raised.)</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec37"></a>A custom event Data Structure</h4></div></div></div><p>When <a id="id641" class="indexterm"></a>planning your custom event, the cornerstone is what <a id="id642" class="indexterm"></a>data you consider to be important when this event fires. In the built-in interfaces, this can include information such as which GameObject is being affected, the mouse cursor position, and so on.</p><p>To start off, we'll create a new <code class="literal">C#</code> script to put all this code into one file, just so it's readable. To fully implement it, however, you would need an actual game to wrap around it. The main aim here is to set you on the path. </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note156"></a>Note</h3><p>To keep this example simple, we will put all the <span class="strong"><strong>UnityEvent</strong></span> code in a single code file called <code class="literal">AlarmSystem</code>. This is optional, of course, and you can create separate scripts for each section if you so wish.</p><p>Having the code all together like this will just make it easier to maintain all the crisscrossed event code.</p></div><p>So create a new <code class="literal">C#</code> script called <code class="literal">AlarmSystem</code> and replace its contents with the following (just the base using statements we need):</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;</pre></div><p>For our <a id="id643" class="indexterm"></a>alarm, we only need the location of the alarm trigger point to send our drones in which would look like the following code, add this to our AlarmSystem script:</p><div class="informalexample"><pre class="programlisting">// Custom data we will send via the event system
public class AlarmEventData : BaseEventData
{
    public Vector3 AlarmTriggerData;
 
    public AlarmEventData(EventSystem eventSystem, 
Vector3 alarmTriggerData): base(eventSystem)
    {
        AlarmTriggerData = alarmTriggerData;
    }
}</pre></div><p>The important parts of this class definition are:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The class derives from the <code class="literal">BaseEventData</code> class</p></li><li style="list-style-type: disc"><p>The class constructor passes the <code class="literal">EventSystem</code> for the event back to the base class constructor using the <code class="literal">base()</code> notation</p></li><li style="list-style-type: disc"><p>With our data in place we can now define our interface</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note157"></a>Note</h3><p>I've used a <code class="literal">Vector3</code> here for the event data to identify the location of the alarm that has been <a id="id644" class="indexterm"></a>triggered. If you were just doing a <a id="id645" class="indexterm"></a>2D game then this could be changed to a <code class="literal">Vector2</code>. Alternatively, you might want to add more data such as the direction of the camera with another Vector. The choice is up to you.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec38"></a>A custom event Interface</h4></div></div></div><p>The interface <a id="id646" class="indexterm"></a>for your event is by far the simplest part of the <a id="id647" class="indexterm"></a>puzzle and looks like the following code. Just add this to the <code class="literal">AlarmSystem</code> script (after the <code class="literal">AlarmEventData</code> class section) we created earlier:</p><div class="informalexample"><pre class="programlisting">// The interface you implement 
// in your MonoBehaviours to receive events
public interface IAlarmHandler : IEventSystemHandler
{
    void OnAlarmTrigger(AlarmEventData eventData);
}</pre></div><p>Here we are simply defining:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The name of the interface to be used on all classes implementing our alarm system (will this also include turrets?)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note158"></a>Note</h3><p>Standards suggest that all interfaces are prefixed with the uppercase letter I, so that they are easily distinguishable and easy to read.</p></div></li><li style="list-style-type: disc"><p>A simple method that will be used as the template in classes that implement the interface (there can be more than one if you support multiple actions)</p></li></ul></div><p>Now that this is ready, it <a id="id648" class="indexterm"></a>can be used on classes in the project; however, next <a id="id649" class="indexterm"></a>we need to be able to handle the event.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec39"></a>A custom event static container</h4></div></div></div><p>So that the <a id="id650" class="indexterm"></a>Event System can call your custom event in the <a id="id651" class="indexterm"></a>same way that it calls the rest of the events in its control, you need some boilerplate code so it can use it effectively, which looks like the following code. Add this after the <code class="literal">IAlarmHandler</code> interface in the <code class="literal">AlarmSystem</code> script:</p><div class="informalexample"><pre class="programlisting">// container class that holds the execution logic that is called 
// by the event system to delegate the call to the interface
public static class MyAlarmTriggerEvents
{
    // call that does the mapping
    private static void Execute(IAlarmHandler handler, 
BaseEventData eventData)
    {
        // The ValidateEventData makes sure the passed event 
  // data is of the correct type
        handler.OnAlarmTrigger(
ExecuteEvents.ValidateEventData&lt;AlarmEventData&gt;(eventData));
    }
 
    // helper to return the function that should be invoked
    public static 
  ExecuteEvents.EventFunction&lt;IAlarmHandler&gt; AlarmEventHandler
    {
        get { return Execute; }
    }
}</pre></div><p>There is not much <a id="id652" class="indexterm"></a>to say at this point, when you execute <a id="id653" class="indexterm"></a>the event you will pass the <code class="literal">AlarmEventHandler</code> that will in turn inform the Event System what the execute method is for the event.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec40"></a>Processing a custom event</h4></div></div></div><p>Right with <a id="id654" class="indexterm"></a>our <code class="literal">EventHandler</code> all written up, next we simply need to implement it within our sample game.</p><p>The last piece of the <a id="id655" class="indexterm"></a>puzzle is the raising of the event, the point at which the event occurs and all objects implementing the interface are informed that the event has happened.</p><p>For this, we will need a separate <code class="literal">input module</code> script that we can attach to an Event System, so create a new C# script called <code class="literal">MyAlarmScannerModule</code> and replace its contents with the following:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;
//Custom input module that can send the events
public class MyAlarmScannerModule : BaseInputModule
{
    // list of objects to invoke on
    public GameObject[] TargetDroids;
    // Variable to store the location of a triggered alarm
      private Vector3 TriggeredCameraLocation;
    // Variable to denote if the alarm has been activated or not
      private bool alarmTriggered;
 
    // called each tick on active input module
    public override void Process()
    {
        // if we don't have targets return
        if (TargetDroids == null ||  TargetDroids.Length == 0)
            return;
        // If the alarm has already been triggered 
  // then there's no point shouting
        if (alarmTriggered)
            return;

        //Placeholder to add some snazzy logic to locate triggered
  //alarms, just returns none for now.
        TriggeredCameraLocation = Vector3.zero;

        // for each droid invoke our custom event if the alarm
        // is triggered
        if (TriggeredCameraLocation != Vector3.zero)
        {
            alarmTriggered = true;
            var eventdata = new AlarmEventData(eventSystem, TriggeredCameraLocation);
            foreach (var droid in TargetDroids)
            {
                ExecuteEvents.Execute(droid, eventdata,MyAlarmTriggerEvents.AlarmEventHandler);
            }
        }
    }
}</pre></div><p>The only <a id="id656" class="indexterm"></a>important part of this script is the <code class="literal">Process</code> method, as this is called by the <code class="literal">BaseInputModule</code> class when it is this script's turn to run (called by the <span class="strong"><strong>EventSystem</strong></span>). Within this script you need to go through whatever selection logic you need to use to identify those GameObjects that need notifying (in this case, the set of droids on our level looking for trouble), then for each droid we are calling Executing the event on that GameObject if it exists.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note159"></a>Note</h3><p>Granted, this is a very simplistic example, there are more complicated scenarios you can implement, most of which are implemented in the <span class="strong"><strong>Input Modules</strong></span> in the UI source. Jump <a id="id657" class="indexterm"></a>down to the <span class="emphasis"><em>Getting access to the source</em></span> section and browse through the source if you dare!</p></div><p>You don't have to build an input system if you don't want to; this is just one example. If you wish you can <a id="id658" class="indexterm"></a>simply call <code class="literal">ExecuteEvents.Execute</code> (provided you have a reference to the <span class="strong"><strong>Event System</strong></span> from the scene) from anywhere in your code to fire an event, say for a Game Over event maybe!</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec74"></a>The Roll a Ball Derby</h3></div></div></div><p>If we take the <a id="id659" class="indexterm"></a>previous system and put it into action in a simple example, we can start to see the possibilities of the new UnityEvent system.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note160"></a>Note</h3><p>For this, I <a id="id660" class="indexterm"></a>used Unity's own <span class="emphasis"><em>Roll a Ball</em></span> example from their tutorial site, which you can follow along to create the base sample: <a class="ulink" href="http://unity3d.com/learn/tutorials/projects/roll-a-ball" target="_blank">http://unity3d.com/learn/tutorials/projects/roll-a-ball</a>.</p><p>To save time (and since Unity doesn't provide a finished version of the tutorial) I've created a Unity package you can import to speed along its creation, which you can download from <a class="ulink" href="http://bit.ly/1AaDKF2" target="_blank">http://bit.ly/1AaDKF2</a> and then import into your project using <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Custom Package</strong></span> in the menu. (It's also included in the code bundle for this project in the <code class="literal">Chapter 6</code> folder).</p></div><p>In the <span class="emphasis"><em>Roll A Ball</em></span> example, we start off with a simple scene where our valiant hero ball is completely surrounded, as you can see in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_13.jpg" /><div class="caption"><p>The completed Roll A Ball Unity tutorial (without the GUIText parts)</p></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note161"></a>Note</h3><p>Make sure you have also added the <span class="strong"><strong>AlarmSystem</strong></span> and <span class="strong"><strong>MyAlarmScannerModule</strong></span> scripts from the previous section to complete this example.</p></div><p>In this example, we will add four alarm plates, which when triggered will cause all the enemy spinning blocks to charge in to attack the hero. (However, since the ball just collects the cubes, it <a id="id661" class="indexterm"></a>really ends up more like Mario with a Coin hoover.)</p><p>To implement our fancy new custom event, we need a couple of things, namely:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A script that implements our new event interface</p></li><li style="list-style-type: disc"><p>A script for the <code class="literal">Alarm</code> trigger that our Custom Input System will be watching out for</p></li><li style="list-style-type: disc"><p>Some logic in our Custom Input system to watch for triggered alarms (we just have boilerplate at the moment that does nothing)</p></li></ul></div><p>All of this is very simple and basic.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note162"></a>Note</h3><p>This example has been greatly simplified in order to fit it within the scope of this title (else it <a id="id662" class="indexterm"></a>could have been at least twice as big). I'll probably do a much larger example using these techniques on my blog at a later date (if I haven't yet when you're reading this). Keep an eye on the forums where it will be announced.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec41"></a>The Droid script</h4></div></div></div><p>The script for our <a id="id663" class="indexterm"></a>alert sentries, who are waiting for some kind of alarm to strike them into action is very easy to implement (especially if you have been <a id="id664" class="indexterm"></a>following along). It is in effect no different to building a script that implements the built-in UI events.</p><p>First, create a new C# script called <code class="literal">DroidScript</code> (either in the <span class="strong"><strong>Project</strong></span> script folder or in the <span class="strong"><strong>Roll a Ball</strong></span> script folder) and either add the <code class="literal">IAlarmHandler</code> interface manually to implement that interface (using the handy trick I showed you earlier) or just replace its contents with the following:</p><div class="informalexample"><pre class="programlisting">using System.Collections;
using UnityEngine;

public class DroidScript : MonoBehaviour, IAlarmHandler {

  public void OnAlarmTrigger(AlarmEventData eventData)
  {
    //Intruder found, attack!!!
  }
}</pre></div><p>So we have our event template, to this we'll add a simple <code class="literal">Coroutine</code> (after the <code class="literal">OnAlarmTrigger</code> function) that will make our cubes race to the alarm spot once it triggers, as shown in the following code (mainly to have something visible to see, I would have preferred turrets shooting at their foe but that would have been a lot more to script):</p><div class="informalexample"><pre class="programlisting">  //Coroutine that will move an object from its current 
//position to another
IEnumerator MoveToPoint(Vector3 target)
  {
    float timer = 0f;
    var StartPosition = transform.position;
    while (target != transform.position)
    {
      transform.position = 
Vector3.Lerp(StartPosition, target, timer);
      timer += Time.deltaTime;
      yield return new WaitForEndOfFrame();
    }
    yield return null;
  }</pre></div><p>Next, we update the <a id="id665" class="indexterm"></a>
<code class="literal">OnAlarmTrigger</code> function for the interface, to <a id="id666" class="indexterm"></a>call <code class="literal">Coroutine</code> when it's called:</p><div class="informalexample"><pre class="programlisting">  public void OnAlarmTrigger(AlarmEventData eventData)
  {
    //Intruder found, attack!!!
    <span class="strong"><strong>StartCoroutine(MoveToPoint(eventData.AlarmTriggerData));</strong></span>
  }</pre></div><p>To finish off, add the <code class="literal">DroidScript</code> script to the <span class="strong"><strong>Pickup Prefab</strong></span> (select the <span class="strong"><strong>Pickup prefab</strong></span>, click <span class="strong"><strong>Add</strong></span> Component in the inspector, and select the script) and the rolling cubes of death will be ready.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note163"></a>Note</h3><p>If you add the script to the individual <span class="strong"><strong>Pickup</strong></span> instances in the scene you will have to do it many times (and also you have remember to add it to any other pickups you add in the scene). If you add it to the <span class="strong"><strong>Pickup Prefab</strong></span>, then all instances of that prefab will automatically be updated!</p></div><p>Now our cunning cubes <a id="id667" class="indexterm"></a>will race to assault the intruder once the alarm fires, so now we need the actual alarm.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec42"></a>The Alarm plates</h4></div></div></div><p>Again, we'll <a id="id668" class="indexterm"></a>keep things simple. For the alarm trigger, we will just add some pressure plates to the floor that when the hero runs over them, they will mark themselves as triggered.</p><p>First add a new <span class="strong"><strong>Plane</strong></span> (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span>) to the scene, reset its position (using the cog icon in the top-right hand corner of the <span class="strong"><strong>Transform</strong></span> component in the <span class="strong"><strong>Inspector</strong></span> window) and scale it down to a reasonable size (such as <code class="literal">0.15</code> on the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span> and <span class="strong"><strong>Z</strong></span> <span class="strong"><strong>Transform</strong></span> <span class="strong"><strong>Scale</strong></span> properties). Name the new <span class="strong"><strong>Plane</strong></span> <code class="literal">Alarm</code> and also set its <span class="strong"><strong>Mesh Collider</strong></span> to a Trigger by checking the <span class="strong"><strong>Is Trigger</strong></span> property, as shown in the following screenshot (leave all the other options as per their defaults):</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_14.jpg" /></div><p>As we intend to have more than one alarm, make this new creation a <span class="strong"><strong>Prefab</strong></span> by dragging the <span class="strong"><strong>Alarm</strong></span> <a id="id669" class="indexterm"></a>GameObject from the project <span class="strong"><strong>Hierarchy</strong></span> to the <span class="strong"><strong>Prefabs</strong></span> folder.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note164"></a>Note</h3><p>The <span class="strong"><strong>Alarm</strong></span> GameObject should now turn blue in the project hierarchy to denote it is now a prefab instance.</p></div><p>Now that we have our prefab, create an Empty GameObject in the scene, reset its position, and name it <span class="strong"><strong>Alarms</strong></span> (this will be our <span class="strong"><strong>Alarms</strong></span> grouping object). Then drag our current <span class="strong"><strong>Alarm</strong></span> to the <span class="strong"><strong>Alarms</strong></span> GameObject to make it a child, then reset its position.</p><p>Next position the <span class="strong"><strong>Alarm</strong></span> in the scene at an appropriate point to trip the hero up (as shown in the following screenshot). I placed it to the side between the Hero sphere and the blocks (because I'm evil); additionally, (if you wish) raise it up a bit on the <span class="strong"><strong>Y</strong></span> axis (say <code class="literal">0.1</code>) so that it is above the ground plane.</p><p>Now one <span class="strong"><strong>Alarm</strong></span> is fun, but four are better, so duplicate the <span class="strong"><strong>Alarm</strong></span> (by navigating to <span class="strong"><strong>Edit</strong></span> <span class="emphasis"><em>|</em></span> <span class="strong"><strong>Duplicate</strong></span> in the menu or <span class="emphasis"><em>Ctrl</em></span>/<span class="emphasis"><em>Cmd D</em></span>) and move them to other positions in the scene. Here is a screenshot <a id="id670" class="indexterm"></a>of what I ended up with (but the final placement is up to you!):</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_06_15.jpg" /></div><p>With our <span class="strong"><strong>Alarms</strong></span> in place, all we need now is a simple script to change the state of the <span class="strong"><strong>Alarm</strong></span> once the Hero triggers it. So create a new <code class="literal">C#</code> script called <code class="literal">AlarmScript</code> and replace its contents as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class AlarmScript : MonoBehaviour {
  void OnTriggerEnter(Collider other)
  {
    gameObject.SetActive(false);
  }
}</pre></div><p>Just a very basic script to deactivate the <span class="strong"><strong>Alarm</strong></span> if the Hero's Sphere enters the alarm's plane collider, nothing fancy.</p><p>To finish off, add the <span class="strong"><strong>AlarmScript</strong></span> script to the <span class="strong"><strong>Alarm Prefab</strong></span> and we are set.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec43"></a>Who watches the watchers?</h4></div></div></div><p>To close, we <a id="id671" class="indexterm"></a>need to replace the boilerplate in our <code class="literal">MyAlarmScannerModule</code> input module that is managing the events to scan the alarms and send in the killer robots if any foolish Hero tries to plunder the gold.</p><p>To keep with the basic example thread, we will just add another public property to our custom input module that manages all the available alarms in the scene. We will then iterate over those alarms and look for any that have been made inactive by the clumsy Hero tripping over them.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note165"></a>Note</h3><p>If you want to add a more complicated system to discover objects to monitor in a scene, be aware that this discovery has to happen <span class="emphasis"><em>before</em></span> the input module is processed, for example, in a custom rayscanning or detection module.</p><p>If you try to build an array of objects (say using the <code class="literal">GetObjectsWIthTag</code> method) in the <code class="literal">Process</code> method, it will be unable to interrogate the list. It's not immediately obvious why this doesn't work, but if I was to hazard a guess, it's that the processing of the Input modules is either handled on another thread or is using some uber performant process. Simply put, it won't be able to see changes in your scene.</p><p>I'll see about adding a more complicated scenario in the follow-up example on my blog.</p></div><p>With that in <a id="id672" class="indexterm"></a>mind, let's edit the <code class="literal">MyAlarmScannerModule</code> script and add a new public property for the <code class="literal">Alarms</code> as follows:</p><div class="informalexample"><pre class="programlisting">public GameObject[] Alarms;</pre></div><p>Then replace the boiler plate line </p><div class="informalexample"><pre class="programlisting">TriggeredCameraLocation = Vector3.zero;</pre></div><p>with the following:</p><div class="informalexample"><pre class="programlisting">TriggeredCameraLocation = Vector3.zero;
foreach (var alarm in Alarms)
{
    if (!alarm.activeSelf)
    {
        TriggeredCameraLocation = alarm.transform.position;
    }
}</pre></div><p>This simply loops the alarms and if it finds one that is inactive, it sets the <code class="literal">TriggeredCameraLocation</code> to the position of the triggered alarm; this will then cause all the selected <span class="strong"><strong>Droids</strong></span> to be activated.</p><p>With everything set, all that remains is to create an <span class="strong"><strong>EventSystem</strong></span> in the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>EventSystem</strong></span>), add the <code class="literal">MyAlarmScannerModule</code> script to the <span class="strong"><strong>EventSystem</strong></span>, then add all the Pickups to the <code class="literal">Target Droids</code> array property and all the <code class="literal">Alarms</code> to the <code class="literal">Alarms array</code> property.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note166"></a>Note</h3><p>Note: We only add an <span class="strong"><strong>EventSystem</strong></span> to the scene for the custom input module. We don't actually need a <span class="strong"><strong>Canvas</strong></span> or any UI components!</p></div><p>If everything went well, when you run the scene and move the sphere using the arrow keys, when the Hero <a id="id673" class="indexterm"></a>accidentally trips one of the alarms, they will be assaulted from all sides by the cubes.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip47"></a>Tip</h3><p>A handy tip when assigning multiples of anything from a scene to an array property in the inspector is to Lock the inspector and then drag them all at once.</p><p>To lock the inspector simply click the <span class="strong"><strong>Lock</strong></span> icon in the upper-right hand corner of the <span class="strong"><strong>Inspector</strong></span> window. While locked, it will not change its view to any other objects selected in the scene. This allows you to multiple select all the <span class="strong"><strong>Pickups</strong></span> or <span class="strong"><strong>Alarms</strong></span> and drag them all at once to their respective properties in the <span class="strong"><strong>Inspector</strong></span> window.</p><p>For a visual explanation of this, check out the second image in the set of animated GIFs at <a class="ulink" href="http://bit.ly/UnityAnimatedTips" target="_blank">http://bit.ly/UnityAnimatedTips</a> (also check out the others while you are at it!).</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec75"></a>Summing up the Event System</h3></div></div></div><p>With great <a id="id674" class="indexterm"></a>power comes great responsibility. This is so true with the new <span class="strong"><strong>EventSystem</strong></span>; there is a lot going on under the covers and a lot of performance tweaks and enhancements that are unseen.</p><p>Granted, the previous example could have been achieved with delegates and a singleton manager coordinating everything, but it is a very basic example.</p><p>In truth, it could be a whole lot bigger with a scanner module that looks for collisions near the player that feeds into the alarm system, or independent radar style scanners for each alarm. Because the system is so modular, you can craft almost anything in a componentized fashion and it will be fast (provided you stick to the rules). Plus the interface design ensures it is fast and easy in a more object-orientated way to design your game and be sure it's not going to break in some freakish fashion.</p><p>I leave it to you to <a id="id675" class="indexterm"></a>play further (or wait until I publish a new free, fully featured bonus tutorial on my blog).</p></div></div>