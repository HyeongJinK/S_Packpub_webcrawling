<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec15"></a>The UnityEvent system</h2></div></div><hr /></div><p>The <a id="id290" class="indexterm"></a>second most important improvement to Unity (in addition to the new <span class="strong"><strong>UI</strong></span>) is an all singing, all dancing new event system.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note66"></a>Note</h3><p>This section is just a UI overview of the new <span class="strong"><strong>UnityEvent</strong></span> system; for a more code intensive overview, see <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Working with the UI Source </em></span>(it's all about the code, about that code, no tuples – a little Meghan Trainor reference for you, now that song that is likely stuck in your head as well!! <span class="inlinemediaobject"><img src="/graphics/9781783553617/graphics/skeleton.jpg" /></span>).</p></div><p>At its core, it is not much more than a weak reference manager, marshalling calls between the input and raycasting systems and exposing these calls as events that any delegate or control can attach to. It's also much, much more, with its extensive extensibility framework.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note67"></a>Note</h3><p>For more information on what <span class="emphasis"><em>Weak Referencing</em></span> is and what it means to you, check out this great Code Project article on it: <a class="ulink" href="http://bit.ly/WeakReferencing" target="_blank">http://bit.ly/WeakReferencing</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec29"></a>Raycasting</h3></div></div></div><p>At the<a id="id291" class="indexterm"></a> heart of the new <span class="strong"><strong>Unity UI</strong></span> user interaction system is <a id="id292" class="indexterm"></a>the use of <span class="strong"><strong>Raycasting</strong></span> to determine what UI component the user is interacting with, either via movement (am I over a UI control?), direct interaction (click, hold, drag, release, and so on), or combinations thereof.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note68"></a>Note</h3><p>Raycasting is a method of drawing a line from a single point to another and determining whether anything got in the way or got hit by drawing that line (known as a ray). It can either be two arbitrary points, or (as in most cases) a line from the user's touch, click, or hover through the scene to see whether they are interacting with anything.</p><p>For more details, check the Unity page on <span class="strong"><strong>Raycasting</strong></span> here: <a class="ulink" href="http://docs.unity3d.com/Manual/CameraRays.html" target="_blank">http://docs.unity3d.com/Manual/CameraRays.html</a>.</p><p>In most <a id="id293" class="indexterm"></a>cases, raycasting is done to a single layer in your scene (the interactable bits) to improve performance and only interact with interactable things on that layer. </p><p>With the UI system, these are generally UI controls on the UI layer (the default for Unity UI controls) but this behavior can be altered if you wish.</p></div><p>By<a id="id294" class="indexterm"></a> default, <span class="strong"><strong>Unity UI</strong></span> adds a <span class="strong"><strong>Graphic Raycaster</strong></span> (a new<a id="id295" class="indexterm"></a> graphics-based raycasting component) to a <span class="strong"><strong>Canvas</strong></span> that provides a robust and performant raycasting system for the graphical canvas (as highlighted earlier), this provides user interaction with graphical elements of the UI system.</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_02_26.jpg" /></div><p>Unity also provides some other <span class="emphasis"><em>out-of-the-box</em></span> raycasting components, including:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Physics Raycaster</strong></span>: This performs raycast tests on 3D models and 3D collidable <a id="id296" class="indexterm"></a>objects, such as models/meshes</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Physics 2D Raycaster</strong></span>: This is the same as the Physics raycaster but limited to 2D <a id="id297" class="indexterm"></a>sprites and 2D collidable objects</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Base Raycaster</strong></span>: This is a high-level base implementation to create your own raycast <a id="id298" class="indexterm"></a>systems</p></li></ul></div><p>All of these systems rely on an <span class="strong"><strong>Event Camera</strong></span>, which will be used as the source for all raycasts and can be configured to any camera in your scene—which camera will depend on your needs.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec30"></a>Input modules</h3></div></div></div><p>The<a id="id299" class="indexterm"></a> other input to the Event system is the hardware <a id="id300" class="indexterm"></a>interaction for touch, mouse, and keyboard inputs. Unity has finally delivered a framework in which these are now abstracted and (more importantly) implemented in a more consistent manner.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note69"></a>Note</h3><p>For other inputs, you will have to build them yourself or keep an eye on the community for new possibilities.</p><p>With this new abstraction, it would be relatively easy to drop in an input module for a Gamepad, Wiimote, or even the Kinect sensor or Leap controller.</p><p>Once<a id="id301" class="indexterm"></a> built, you simply attach it to the Unity <span class="strong"><strong>EventSystem</strong></span> for the scene and off you go.</p></div><p>The<a id="id302" class="indexterm"></a> input modules that Unity provides out of the box are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Standalone Input Module</strong></span>: This is your basic keyboard and mouse input, tracking <a id="id303" class="indexterm"></a>where the mouse is and what mouse/keyboard buttons are pressed.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Touch Input Module</strong></span>: This is a basic touch input system handling touches, dragging,<a id="id304" class="indexterm"></a> and position data. It effectively fakes a mouse in its implementation.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Pointer Input Module</strong></span>: This is a higher level class providing the base functionality <a id="id305" class="indexterm"></a>for both of the previous modules, only accessible through code.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Base Input Module</strong></span>: This is a base level input system that is used to create new<a id="id306" class="indexterm"></a> implementations in code, providing all the raw framework to handle just about any input interaction.</p></li></ul></div><p>If you want to support more than one input mode, then not to worry. Each input module is complementary and adds to the whole input system, so if you want more just keep adding them to the <span class="strong"><strong>EventSystem</strong></span> GameObject in your scene, as shown here:</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_02_27.jpg" /><div class="caption"><p>An <span class="strong"><strong>Event System</strong></span> configured with both Keyboard/Mouse and Touch input</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec31"></a>Input events</h3></div></div></div><p>We'll<a id="id307" class="indexterm"></a> cover Event triggers further in <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Control, Control, You Must Learn Control </em></span>with the implementation of the new <span class="strong"><strong>Unity UI</strong></span> controls, but it <a id="id308" class="indexterm"></a>is worth going over the basics here first.</p><p>At the core of Unity's new input event system, there are several interfaces that describe all the different types of events the base implementation is able to handle:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note70"></a>Note</h3><p>I say base events because the system is fully extendable and you can create your own events should you wish.</p></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>PointerEnter</strong></span> (<code class="literal">IPointerEnterHandler/OnPointerEnter</code>): This is similar to the <code class="literal">onTriggerEnte</code>r or <code class="literal">OnCollisionEnter</code> interfaces. It <a id="id309" class="indexterm"></a>denotes the point when a cursor enters the region within a <span class="strong"><strong>Unity UI</strong></span> control.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>PointerExit</strong></span> <code class="literal">(IPointerExitHandler/OnPointerExit</code>): Like <code class="literal">onTriggerExit</code> or <code class="literal">OnCollisionExit</code>. It denotes the point when a cursor leaves the region of a <a id="id310" class="indexterm"></a>
<span class="strong"><strong>Unity UI</strong></span> control.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>PointerDown</strong></span> (<code class="literal">IPointerDownHandler/OnPointerDown</code>): This is fired when <a id="id311" class="indexterm"></a>a <span class="strong"><strong>Mouse</strong></span> button or <span class="strong"><strong>Touch</strong></span> is held down; it fires for each frame where the button/touch is held.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>PointerUp</strong></span> (<code class="literal">IPointerUpHandler/OnPointerUp</code>): This<a id="id312" class="indexterm"></a> is fired when a Mouse or Touch is released from being held (Not on release of click).</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>PointerClick</strong></span> (<code class="literal">IPointerClickHandler/OnPointerClick</code>): This is fired when the <a id="id313" class="indexterm"></a>user releases the mouse click<a id="id314" class="indexterm"></a> or a touch on the same GameObject it was pressed on. (If the user hasn't moved the pointer off the GameObject.)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Drag</strong></span> (<code class="literal">IDragHandler/OnDrag</code>): This is fired when a draggable object is held <a id="id315" class="indexterm"></a>and movement has started in any direction (Movement delta increased).</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Drop</strong></span> (<code class="literal">IDropHandler/OnDrop</code>): This is fired when a draggable item has been <a id="id316" class="indexterm"></a>moved and the mouse or touch has been released, finishing the movement.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Scroll</strong></span> <code class="literal">(IScrollHandler/OnScroll</code>): Fired when a scroll wheel on a mouse <a id="id317" class="indexterm"></a>or controller is used.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>UpdateSelected</strong></span> (<code class="literal">IUpdateSelectedHandler/OnUpdateSelected</code>): This is fired <a id="id318" class="indexterm"></a>whenever the contents of a control are updated, such as a text field.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Select</strong></span> (<code class="literal">ISelectHandler/OnSelect</code>): This is fired when an object or toggle is <a id="id319" class="indexterm"></a>selected and focus is achieved, for example, when navigation occurs between Interactable GameObjects/Controls.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Deselect</strong></span> (<code class="literal">IDeselectHandler/OnDeselect</code>): This is fired when an object or <a id="id320" class="indexterm"></a>toggle is deselected and focus is lost. For example,when navigation occurs between Interactable GameObjects/Controls.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Move</strong></span> <code class="literal">(IMoveHandler/OnMove</code>): This is a continuous event that is fired while <a id="id321" class="indexterm"></a>a draggable object is being moved (Constant delta increase).</p></li></ul></div><p>With these events, it is possible to write a script to enable any GameObject (even non-<span class="strong"><strong>Unity UI</strong></span> related) to react to these events as they are generated from the Unity <span class="strong"><strong>EventSystem</strong></span>, for example:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;
public class eventHandler : MonoBehaviour, IPointerClickHandler {
  #region IPointerClickHandler implementation
  public void OnPointerClick (PointerEventData eventData)
  {
    //Do something with a click
  }
  #endregion
}</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip21"></a>Tip</h3><p>The <code class="literal">#region</code> syntax is extremely useful for creating readable script files. It allows <a id="id322" class="indexterm"></a>you to collapse or expand the code within a <code class="literal">#region</code>/<code class="literal">#endregion</code> block.</p><p>Check here for more details on using <code class="literal">#regions</code> to keep your code files clean: <a class="ulink" href="http://bit.ly/RegionSyntax" target="_blank">http://bit.ly/RegionSyntax</a>.</p></div><p>This<a id="id323" class="indexterm"></a> provides us with a base implementation to add click behavior to any GameObject in a scene. More on this later</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note71"></a>Note</h3><p>Remember, for the events to be managed and captured, you will need the appropriate <span class="strong"><strong>RayCast</strong></span> system attached to the camera that renders the GameObject. For example, if you attached the previous script to a 3D model, you would need to add the <span class="strong"><strong>Physics Raycaster</strong></span> to the main 3D camera and the 3D object would need some sort of 3D collider such as <span class="strong"><strong>Mesh collider</strong></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec32"></a>Event Triggers</h3></div></div></div><p>Not to be<a id="id324" class="indexterm"></a> outdone by the previous weighty code-based <a id="id325" class="indexterm"></a>approach for using input events from the <span class="strong"><strong>UnityEvent</strong></span> system, there is also a just-as-powerful graphical system to add events to GameObjects using <span class="strong"><strong>Event Triggers</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781783553617/graphics/3617OS_02_28.jpg" /><div class="caption"><p>A configured Event Trigger with two events and a single action for each</p></div></div><p>Some of the new <span class="strong"><strong>UI</strong></span> controls natively implement the <span class="strong"><strong>Event Trigger</strong></span> behavior using the interfaces described previously, but it is also provided separately should you have the need to extend anything else with such a capability from <span class="strong"><strong>Editor</strong></span>. (Although Unity recommends using code or the built-in controls.)</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip22"></a>Tip</h3><p>It is worth noting that although the <span class="strong"><strong>Event Trigger</strong></span> component exists, Unity recommends you build your own scripts, mainly for performance reasons. The <span class="strong"><strong>Event Trigger</strong></span> component is bound to <span class="emphasis"><em>all</em></span> events and <span class="emphasis"><em>receives all</em></span> events by default. It then decides which to act upon based on the component's configuration, so it's not as performant as your own specific script. Keep this in mind and only use the <span class="strong"><strong>Event Trigger</strong></span> component if you really, really need it.</p></div><p>In short, the <span class="strong"><strong>Event Trigger</strong></span> allows you to:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Create an event hook in the inspector (Shown as <code class="literal">PointerClick</code> and <code class="literal">PointerExit</code> in the preceding screenshot)</p></li><li style="list-style-type: disc"><p>Attach the result of that event to another GameObject</p></li><li style="list-style-type: disc"><p>Select a property, script, or other attribute on the target object to manipulate (shown as the <code class="literal">Image.sprite</code> property or the <code class="literal">RectTransform.BroadcastMessage</code> method)</p></li><li style="list-style-type: disc"><p>If applicable, provide a value or input to the target call</p></li></ul></div><p>What's even better is that you can attach as many different actions on the result of the event. So<a id="id326" class="indexterm"></a> if you wished, you could update several<a id="id327" class="indexterm"></a> different GameObjects or several different properties of a target GameObject on the result of a single event.</p><p>We'll cover this in more detail in <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Control, Control, You Must Learn Control</em></span> when we cover the specific controls that implement this behavior, just a taster for now.</p></div></div>