<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec50"></a>Building an explosive barrel</h2></div></div><hr /></div><p>One of the first things <a id="id410" class="indexterm"></a>we are going to look at is the common FPS staple: explosive barrels. These will allow the player to get a "leg up" on their enemies by causing explosions when damaged enough. They're also fairly simple to create.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To start off, let's open up the level we created in the <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Building Encounters</em></span> (<code class="literal">Chapter 5_5_ HealthPacksPickups.unity</code> in the example files you can get from the Packt Publishing website).</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_01.jpg" /></div><p>Let's get <a id="id411" class="indexterm"></a>the implementation of the functionality to work correctly, then we can make it look nice.</p></li><li><p>Create an object to represent our barrel. To do this, go to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Cylinder</strong></span>.</p><p>This will create a 3D object that will look like a cylinder and give it a collider so that it blocks our player if he/she walks into it. It can also be hit by bullets.</p></li><li><p>Change the object's name to <code class="literal">Barrel</code>. The default cylinder is a bit too large to be a barrel, so we will change the <span class="strong"><strong>Y</strong></span> value of the <span class="strong"><strong>Scale</strong></span> property to <code class="literal">.75</code>. Then, we will position it so that it fits the ground (<code class="literal">-7</code>, <code class="literal">1.7</code>, <code class="literal">5.1</code> in this case).</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_02.jpg" /></div></li><li><p>Next, we <a id="id412" class="indexterm"></a>want it to react to being damaged. So, we will need to add a <span class="strong"><strong>VP_Damage Handler</strong></span> component to it. To do this, from the <span class="strong"><strong>Inspector</strong></span> tab, click on the <span class="strong"><strong>Add Component</strong></span> button, type in <code class="literal">damage</code>, and select it from the dropdown menu.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_03.jpg" /></div><p>The <a id="id413" class="indexterm"></a>
<span class="strong"><strong>VP_DamageHandler</strong></span> component gives objects the ability to take damage and die. It's important to note that this will not respawn objects (use the <span class="strong"><strong>VP_Respawner</strong></span> component for that). As we don't want the barrels to respawn, it is fine to use this component. In this case, if we play the game and shoot the barrel, it will disappear.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note66"></a>Note</h3><p>For more information on <a id="id414" class="indexterm"></a>the <span class="strong"><strong>Damage Handler</strong></span>, check out <a class="ulink" href="http://www.visionpunk.com/hub/assets/ufps/manual/damage" target="_blank">http://www.visionpunk.com/hub/assets/ufps/manual/damage</a>.</p></div></li><li><p>We don't want a single small bullet to destroy the barrel, so in the <span class="strong"><strong>Vp_Damage Handler</strong></span> component, we will set the <span class="strong"><strong>Max Health</strong></span> and <span class="strong"><strong>Current Health</strong></span> variables to <code class="literal">5</code>. The higher the number used here, the more is the damage needed to be done to the barrel before it is destroyed.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_24.jpg" /></div><p>Currently, when <a id="id415" class="indexterm"></a>we kill the barrel, the object just disappears. Instead, let's have an explosion occur that will damage everything nearby.</p></li><li><p>Under the <span class="strong"><strong>Vp_Damage Handler</strong></span> component, expand the <span class="strong"><strong>Death Spawn Objects</strong></span> variable and change the <span class="strong"><strong>Size</strong></span> value to <code class="literal">1</code>.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> tab, go to the <code class="literal">Assets/UFPS/Base/Content/Prefabs/Explosions </code>folder and move the <code class="literal">CubeExplosion</code> prefab to the <span class="strong"><strong>Death Spawn Object </strong></span>slot by holding down the mouse button over it and dragging it into the slot.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_04.jpg" /></div><p>Now, if we<a id="id416" class="indexterm"></a> were to walk up to the barrel and attack it, we would get knocked back. However, enemy AIs don't seem to respond to it. This is because the Shooter AI characters do not come with a <span class="strong"><strong>Damage Handler</strong></span> component. However, we can do a quick fix for this to work.</p></li><li><p>Back in the <span class="strong"><strong>Project</strong></span> tab, select the <code class="literal">CubeExplosion</code> prefab. From the <span class="strong"><strong>Vp_Explosion</strong></span> component, uncheck the <span class="strong"><strong>Require Damage Handler</strong></span> property. </p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_25.jpg" /></div><p>This tells <a id="id417" class="indexterm"></a>the explosions that any object within its radius will have the <code class="literal">Damage </code>function called, which our enemies have an implementation for, even if it doesn't have a <span class="strong"><strong>Vp_Damage Handler</strong></span> component.</p></li><li><p>Now, let's create a prefab of our barrel by going to the <span class="strong"><strong>Project </strong></span>tab, opening the <code class="literal">Assets/Prefab</code> folder, and dragging the<code class="literal"> Barrel</code> game object from the <span class="strong"><strong>Hierarchy</strong></span> tab into the folder.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_05.jpg" /></div></li><li><p>Now, to<a id="id418" class="indexterm"></a> confirm whether everything is working correctly, create a copy of the barrel by dragging it from the<code class="literal"> Prefabs</code> folder into the game world. You'll notice that it will automatically try to place itself on the floor for us.</p></li><li><p>Save the level and run the game.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_06.jpg" /></div></li></ol></div><p>There we go! When<a id="id419" class="indexterm"></a> we destroy the barrel, our enemies will be damaged by being caught in the explosion.</p></div>