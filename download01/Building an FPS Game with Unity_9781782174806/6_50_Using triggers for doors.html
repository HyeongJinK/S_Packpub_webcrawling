<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec51"></a>Using triggers for doors</h2></div></div><hr /></div><p>Earlier, you learned how to use triggers<a id="id420" class="indexterm"></a> to do something simple, such as spawning enemies to be<a id="id421" class="indexterm"></a> attacked. In this section, you're going to learn how to use the same principles for doors.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Since we're using the first doorway we created to spawn enemies, let's create our new door in the second one. To do this, open up <span class="strong"><strong>Prototype</strong></span> and select <span class="strong"><strong>Create</strong></span> to add a new <span class="strong"><strong>Cube </strong></span>into the world, placing it in such a way that it fits the front of the doorway we created earlier.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip09"></a>Tip</h3><p>For a refresher on how Prototype works, refer to <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Prototyping Levels with Prototype</em></span>.</p></div><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_07.jpg" /></div></li><li><p>Now, switch <a id="id422" class="indexterm"></a>to the <span class="strong"><strong>Object</strong></span> mode and press the <span class="emphasis"><em>M</em></span> key to <a id="id423" class="indexterm"></a>specify this object as a <span class="strong"><strong>Mover.</strong></span> To make it easier to tell the difference between the normal stuff and it, select the <span class="strong"><strong>Vertex Colors</strong></span> option and make the object green.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_08.jpg" /></div></li><li><p>Next, duplicate <a id="id424" class="indexterm"></a>the object, click on the <span class="strong"><strong>Set Trigger</strong></span> button, and<a id="id425" class="indexterm"></a> drag it out toward both the sides of the door.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_09.jpg" /></div></li><li><p>To make it easier<a id="id426" class="indexterm"></a> to look at, rename the trigger to <code class="literal">DoorTrigger</code> and<a id="id427" class="indexterm"></a> the door to <code class="literal">Door</code>. Then, make the <code class="literal">Door</code> object a child of <code class="literal">Door Trigger</code>.</p><p>Now, why are we making the trigger the parent? Well, later on, when we are creating animations, the door will be moving. If the door was the parent, then the trigger would move as well.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_10.jpg" /></div></li><li><p>We also need to<a id="id428" class="indexterm"></a> set the <span class="strong"><strong>Layer</strong></span> value of <code class="literal">DoorTrigger</code> to <code class="literal">Trigger</code> so<a id="id429" class="indexterm"></a> that it cannot be hit by bullets. A dialogue box will open up, asking if you want to apply the layer to the child; in this case, we will say <span class="emphasis"><em>no</em></span>, because the bullet should actually hit the door, but not the trigger.</p><p>Now, we need to make it such that when the player hits the trigger, the door will open and when they leave, it will close. To do this, we will need to write some script; but before we do that, we'll need to create an animation for the door to move.</p></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> tab, select the <code class="literal">Door</code> object and go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span>. This will open up the <span class="strong"><strong>Animation</strong></span> window, which is where we create animations inside Unity. Drag and drop the window to where the <span class="strong"><strong>Project</strong></span> tab is to work with it with ease. Then, click on the <span class="strong"><strong>Create</strong></span> button on the left-hand side of the <span class="strong"><strong>Animation</strong></span> tab (clicking the up and down arrow keys for the dropdown menu) and select <span class="strong"><strong>[Create New Clip]</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_27.jpg" /></div></li><li><p>Unity will ask<a id="id430" class="indexterm"></a> you where you want to save the animation<a id="id431" class="indexterm"></a> file. Go to the <code class="literal">Assets </code>folder and create a new folder called <code class="literal">Animations</code>. Type in <code class="literal">DoorOpen.anim</code> and press <span class="strong"><strong>Save</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_11.jpg" /></div></li><li><p>Exit Prototype if it is open and switch to the<span class="strong"><strong> Translate</strong></span> tool (<span class="emphasis"><em>W</em></span>). Click on the record button and drag the red bar to the <code class="literal">0:30</code> spot by dragging the mouse on the bar with the image's measurements. Then, with the <code class="literal">Door</code> object selected in the <span class="strong"><strong>Hierarchy </strong></span>tab, drag the door over to the side.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_12.jpg" /></div><p>You <a id="id432" class="indexterm"></a>should notice that the animation has automatically <a id="id433" class="indexterm"></a>created two key frames, one at the start <code class="literal">0:00</code> and one where we moved the red bar to.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note67"></a>Note</h3><p>For more details on the <span class="strong"><strong>Animation</strong></span> tool<a id="id434" class="indexterm"></a> and the many ways you can use this tool to modify any value, check out <a class="ulink" href="https://unity3d.com/learn/tutorials/modules/beginner/live-training-archive/animate-anything" target="_blank">https://unity3d.com/learn/tutorials/modules/beginner/live-training-archive/animate-anything</a>.</p></div></li><li><p>Click on the record button again to stop recording. Now, by default, this newly created animation will be played over and over again. To fix this, go to the <code class="literal">Door</code> object and, from the newly added <span class="strong"><strong>Animator</strong></span> component, double-click on the <span class="strong"><strong>Controller</strong></span> variable (called <code class="literal">Door</code>) to open up the<span class="strong"><strong> Animator</strong></span> window.</p></li><li><p>Right-click, select<a id="id435" class="indexterm"></a> <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span>, and name it <code class="literal">Idle</code>. Then, <a id="id436" class="indexterm"></a>right-click on the newly created <code class="literal">Idle</code> object again and select <span class="strong"><strong>Set As Layer Default State</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_13.jpg" /></div><p>Now, our animation will only play when we ask it to and not by default. However, once we play it, it will play over and over again.</p></li><li><p>To fix this, from the <span class="strong"><strong>Project</strong></span> tab, go to the <code class="literal">Assets/Animations</code> folder and click on the <code class="literal">Door Open</code> object. Then, uncheck the <span class="strong"><strong>Loop Time</strong></span> property so that it will not loop.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_14.jpg" /></div></li><li><p>After this, create a <code class="literal">DoorClose</code> animation doing the reverse of what we did before.</p><p>That being <a id="id437" class="indexterm"></a>said, now that we have the animation, we <a id="id438" class="indexterm"></a>need to call it within the code or it'll never happen.</p></li><li><p>Go to the <code class="literal">MyGame/Scripts</code> folder, select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>New C# Script</strong></span>, and name it <code class="literal">DoorBehaviour</code>. Once finished, double-click on the created file to open <code class="literal">MonoDevelop</code>.</p></li><li><p>Once inside, change the code to the following:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class DoorBehaviour : MonoBehaviour {

  /// &lt;summary&gt;
  /// The Animator component of our door object
  /// &lt;/summary&gt;
  public Animator doorAnim;

  // Called whenever an object with a collider enters our trigger
  void OnTriggerEnter(Collider other)
  {
    // Check if the player hit the trigger
    if(other.name.Contains("Player"))
    {
      Debug.Log ("Open Door");

      // Play our door animation like normal (speed at 1)
      doorAnim.StopPlayback ();
      doorAnim.Play ("DoorOpen", -1, 0.0f);
    }
  }

  // Called whenever an object with a collider exits our trigger
  void OnTriggerExit(Collider other)
  {
    // Check if the player hit the trigger
    if(other.name.Contains("Player"))
    {
      Debug.Log ("Close Door");

      // Play our door animation reversed (speed at -1)
      doorAnim.StopPlayback ();
      doorAnim.Play ("DoorClose");
    }
  }
}</pre></div><p>This code <a id="id439" class="indexterm"></a>uses two built-in functions inside Unity: <code class="literal">OnTriggerEnter</code> <a id="id440" class="indexterm"></a>and <code class="literal">OnTriggerExit</code>. When our player hits the trigger, we will play our door animation. On exiting, we will play the same animation, but reversed. This way, the door will close for us.</p></li><li><p>Next, we need to attach this component to our trigger. Select it and drag and drop the <code class="literal">DoorBehaviour</code> file on top of it.</p></li><li><p>Once the component is attached, drag and drop our <code class="literal">Door</code> object under the <code class="literal">doorAnim</code> property.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_15.jpg" /></div></li><li><p>Now, save <a id="id441" class="indexterm"></a>your <a id="id442" class="indexterm"></a>scene and run again.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_06_16.jpg" /></div></li></ol></div><p>With this, we <a id="id443" class="indexterm"></a>now have doors that will open and close when we approach<a id="id444" class="indexterm"></a> them.</p></div>