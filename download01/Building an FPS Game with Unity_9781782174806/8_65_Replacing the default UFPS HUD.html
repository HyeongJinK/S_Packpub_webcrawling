<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec64"></a>Replacing the default UFPS HUD</h2></div></div><hr /></div><p>We now have a<a id="id568" class="indexterm"></a> Main menu, but our regular game level is showing a default UI. While it's fine for testing purposes, we may want to make something a little more custom for our finished product.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start off by opening up any of the levels you've created that have the <code class="literal">AdvancedPlayer</code> prefab inside it (I chose <code class="literal">Chapter7_MeshingYourLevel</code>).</p></li><li><p>From there select your <code class="literal">AdvancedPlayer</code> and look at it from the Inspector. One of the components you'll see is the <code class="literal">vp_SimpleHUD</code> component.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_16.jpg" /></div><p>This is what draws the screen in the default way and can be a good reference when it comes to accessing variables. However, we do not want to use it in this case.</p></li><li><p>Right-click<a id="id569" class="indexterm"></a> on the <span class="strong"><strong>vp_SimpleHUD</strong></span> component and select <span class="strong"><strong>Remove Component</strong></span>.</p></li><li><p>Now that we've removed the previous HUD, it's time to add in our own. Create a Canvas by selecting <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Canvas</strong></span>.</p></li><li><p>For our purposes we're going to be using <span class="strong"><strong>Slider</strong></span> as the basis of our lifebar. To do that with the Canvas selected, go to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Slider</strong></span>.</p><p>A slider is a graphic with a handle that the user can drag to change a value between a min and max value. In this instance we are using a slider for display purposes rather than the interaction that it offers but let's first see what it does. If you go into the Inspector and scroll down to the <span class="strong"><strong>Slider</strong></span> component you'll see a value called <span class="strong"><strong>Value</strong></span>; when you change it you'll see the slider move as well.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_17.jpg" /></div></li><li><p>Next let's customize how this looks so it fits the roll of a healthbar better. Expand the Slider object in the Hierarchy to see the <span class="strong"><strong>Fill Area</strong></span> and <span class="strong"><strong>Handle Slide Area</strong></span> objects. Delete <span class="strong"><strong>Handle Slide Area</strong></span> as we will not be needing it.</p></li><li><p>After that, from<a id="id570" class="indexterm"></a> the Hierarchy tab inside the Slider object expand the <span class="strong"><strong>Fill Area</strong></span> object to see its children and from there select the <span class="strong"><strong>Fill</strong></span> object. From there set the <span class="strong"><strong>Color</strong></span> on the <span class="strong"><strong>Image</strong></span> component to green to make it look more like a health bar.</p></li><li><p>Next let's position this to the top left of the screen. Select the <code class="literal">Slider</code> object and then click on the anchor helper button, hold down the <span class="emphasis"><em>Alt</em></span> key, and then press the top left option.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_18.jpg" /></div><p>When you hold down the <span class="emphasis"><em>Alt</em></span> key and click on the button, you're also setting the position of the object in addition to setting the anchor.</p></li><li><p>You'll notice <a id="id571" class="indexterm"></a>now that it's placed in the correct position, but <span class="strong"><strong>Pos X</strong></span> is <code class="literal">80</code> when we'd rather it be <code class="literal">0</code>; so we need to change <span class="strong"><strong>X</strong></span> in the <span class="strong"><strong>Pivot</strong></span> section to <code class="literal">0</code> and <span class="strong"><strong>Y</strong></span> to <code class="literal">1</code>. Then set <span class="strong"><strong>Pos X</strong></span> to <code class="literal">10</code> to give some spacing from the edge of the screen.</p><p>Next, we need to add and display some information about our weapon: its name and the ammo we have.</p></li><li><p>Go to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span>. This time put the object in the bottom left corner.</p></li><li><p>Change the <span class="strong"><strong>Text</strong></span> inside the object to <code class="literal">WeaponName</code> and rename the object to <code class="literal">Weapon Name</code>.</p></li><li><p>Change the <span class="strong"><strong>Font Size</strong></span> to <code class="literal">20</code> and the <span class="strong"><strong>Color</strong></span> to white.</p></li><li><p>After that, to make it easier to read, let's add an <span class="strong"><strong>Outline</strong></span> component by selecting the object and then clicking <span class="strong"><strong>Add Component</strong></span> and selecting <span class="strong"><strong>Outline</strong></span> after typing it in.</p></li><li><p>Then select the <code class="literal">Weapon Name</code> object and duplicate it (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>). Move the duplicated object above the current one and rename it to <code class="literal">Weapon Info</code>. Then change <span class="strong"><strong>Pos Y</strong></span> to <code class="literal">40</code> and <span class="strong"><strong>Text</strong></span> to <code class="literal">200/200</code>: this will be where we will tell the player how<a id="id572" class="indexterm"></a> much ammo they have in the currently selected weapon.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_19.jpg" /></div><p>Now that we have the base UI in, let's add in some code to display the correct data for these UI elements.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> tab go into the <code class="literal">MyGame/Scripts</code> folder and create a new <span class="strong"><strong>C# Script</strong></span> called <code class="literal">GameHUD</code>.</p></li><li><p>Double-click <a id="id573" class="indexterm"></a>on the script to open up <code class="literal">MonoBehaviour</code> and use the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.UI; // Text, Slider

/// &lt;summary&gt;
/// Updates and provides details for the in-game HUD.
/// &lt;/summary&gt;
public class GameHUD : MonoBehaviour 
{
  // Will show Object References at the top of these //variables
  [Header("Object References")]
  public Slider slider;
  public Text weaponName;
  public Text weaponInfo;
  public Transform advancedPlayer;

  // Contains all of the info we need for the HUD
  protected vp_FPPlayerEventHandler m_Player = null;

  void OnLevelWasLoaded ()
  {
    m_Player = advancedPlayer.GetComponent&lt;vp_FPPlayerEventHandler&gt;();
  }
  
  // Update is called once per frame
  void Update () 
  {
    // Only do the actions if m_Player has a value other 
      // than null
    if(m_Player)
    {
      // First we'll set the health
      slider.value = m_Player.Health.Get() / 
                     m_Player.MaxHealth.Get();

      // Next, we want to display the ammo
      int currentAmmo = m_Player.CurrentWeaponAmmoCount.Get();
      int maxAmmo = m_Player.CurrentWeaponMaxAmmoCount.Get();

      // If we have ammo, display the details
      if((maxAmmo &gt; 0) &amp;&amp; (currentAmmo &gt; 0))
      {
        weaponInfo.text = currentAmmo.ToString() + "/" + 
                          maxAmmo.ToString();
      }
      else
      {
        //If we don't, just be blank
        weaponInfo.text = "";
      }

      // Lastly, let's display what weapon we're using
      weaponName.text = m_Player.CurrentWeaponName.Get();
    }
  }
}</pre></div></li><li><p>After that, attach <a id="id574" class="indexterm"></a>the newly created script to the Canvas object and assign the variables to the objects with the same name.</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_20.jpg" /></div><p>You'll notice that we now have a header on top of the object references. This<a id="id575" class="indexterm"></a> is due to the decorator drawer that we used. These are actually one of my favorite parts of the engine as they allow you to customize how variables are shown and their layout.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note82"></a>Note</h3><p>For more info on these and other kinds of <a id="id576" class="indexterm"></a>drawers, check out: <a class="ulink" href="http://blogs.unity3d.com/2012/09/07/property-drawers-in-unity-4" target="_blank">http://blogs.unity3d.com/2012/09/07/property-drawers-in-unity-4/</a>.</p></div></li><li><p>Save your game, and play!</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_21.jpg" /></div><p>And, as you can see, we're almost there. The information is being displayed properly using the names of the objects and the healthbar is working <a id="id577" class="indexterm"></a>correctly; however, it's very small compared to how it was used in our editor window. We can make this HUD scale with the size of the screen by making use of the <span class="strong"><strong>Canvas Scalar</strong></span> property. Let's do that now:</p></li><li><p>Select your <code class="literal">Canvas</code> object in the <span class="strong"><strong>Hierarchy</strong></span> and from the <span class="strong"><strong>Inspector</strong></span> tab go to the <span class="strong"><strong>Canvas Scalar</strong></span> component. Under <span class="strong"><strong>UI Scale Mode</strong></span> change the value to <code class="literal">Scale with Screen Size</code> and leave the other values at their defaults for now.</p></li><li><p>Save the <a id="id578" class="indexterm"></a>game and play it!</p><div class="mediaobject"><img src="/graphics/9781782174806/graphics/B04317_08_22.jpg" /></div></li></ol></div><p>As you can see, things are much clearer now!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note83"></a>Note</h3><p>For more information on making your UI fit with multiple different resolutions, check out: <a class="ulink" href="http://docs.unity3d.com/Manual/HOWTO-UIMultiResolution.html" target="_blank">http://docs.unity3d.com/Manual/HOWTO-UIMultiResolution.html</a>.</p></div></div>