<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec32"></a>Vertical texture mapping</h2></div></div><hr /></div><p>This is the process by which we combine two texture layers to correctly map a flat texture to vertical surfaces such as mountains and cliff faces. Some 3D <a id="id234" class="indexterm"></a>engines can have some kind of vertical mapping built into a pixel shader which is very handy when available. However, we can't always rely on this; for our project we can assume the mobile platforms will require baked textures with correctly mapped vertical surfaces. We can create two layers to achieve accurate vertical mapping in the following manner:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Create our first material layer for cliffs, we'll name this <code class="literal">Mountains 0-90</code>.</p></li><li style="list-style-type: disc"><p>Assign it a nice Canyon Rock texture (such as the <code class="literal">arid2/canyon_rock01.tga</code> texture as provided in the GROME texture library).</p></li><li style="list-style-type: disc"><p>Create a new mask, default values are fine for this example. </p></li><li style="list-style-type: disc"><p>In the parameters for the texture set the UV tiling to something that fits the scene (for example <code class="literal">20</code>, <code class="literal">20</code>). Set the HV spin for this layer to <code class="literal">0</code>, <code class="literal">90</code>. This is shown in the following screenshot.</p></li><li style="list-style-type: disc"><p>Now the tricky part, using the <span class="strong"><strong>MaskGenerator</strong></span> tool, find the preset named <span class="strong"><strong>Vertical 0 90</strong></span>.</p></li><li style="list-style-type: disc"><p>With our <span class="strong"><strong>Mountains 0-90</strong></span> layer active, hold down <span class="emphasis"><em>Ctrl</em></span> and press the left mouse button and select the preset mask parameters named <span class="strong"><strong>Vertical 0 90 (1)</strong></span> and <span class="strong"><strong>Vertical 0 90 (2)</strong></span> (shown in the following <a id="id235" class="indexterm"></a>screenshot on the right-hand side).</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_04_18.jpg" /></div></li><li style="list-style-type: disc"><p>Click on the <span class="strong"><strong>MaskGenerator</strong></span> tool's <span class="strong"><strong>Apply</strong></span> button to map the texture to the vertical surfaces.</p></li><li style="list-style-type: disc"><p>Now we create the second vertical layer for textures that run perpendicular. Name this layer <code class="literal">Mountains 90-90</code>.</p></li><li style="list-style-type: disc"><p>Assign it the same texture (Canyon Rock as before).</p></li><li style="list-style-type: disc"><p>Create a new mask, again with the default values.</p></li><li style="list-style-type: disc"><p>In the parameters for this texture we'll set the same UV tiling values (<code class="literal">20</code>, <code class="literal">20</code>). But this time we set the HV spin for the layer to <code class="literal">90</code>, <code class="literal">90</code>.</p></li><li style="list-style-type: disc"><p>With the <span class="strong"><strong>MaskGenerator</strong></span> tool, find the preset named <span class="strong"><strong>Vertical 90 90</strong></span>.</p></li><li style="list-style-type: disc"><p>With the <span class="strong"><strong>Mountains 90-90</strong></span> layer active, hold down <span class="emphasis"><em>Ctrl</em></span> and press the left mouse button and select the preset mask parameters named <span class="strong"><strong>Vertical 90 90 (1)</strong></span> and <span class="strong"><strong>Vertical 90 90 (2)</strong></span> (shown in the following screenshot on the right-hand side). Click the layer's <span class="strong"><strong>Add</strong></span> button.</p></li><li style="list-style-type: disc"><p>Click the <span class="strong"><strong>MaskGenerator</strong></span> tool's <span class="strong"><strong>Apply</strong></span> button to map the texture to the vertical surfaces.</p></li></ul></div><p>Assuming we got everything correct our vertical surfaces should be suitably mapped by two texture layers as show in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_04_19.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec33"></a>ColorBake tool</h3></div></div></div><p>For mobile platforms in particular, baking multiple layers into a single layer has enormous performance benefits. This is <a id="id236" class="indexterm"></a>different from merging down layers on the layer stack. This method leaves our original source layers intact.</p><p>The Color Bake operation combines all visible layers (from top to bottom) into the bottom-most visible layer. By combining our layers into a single layer we have a texture we can export that works great for mobile platforms and overhead maps.</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_04_12.jpg" /></div><p>To create a baked layer we create a color texture on the layer stack (assign zones by right-clicking on it, when the new material dialog box appears click on the <span class="strong"><strong>New</strong></span> texture).</p><p>The resolution chosen for the color texture will equal the highest resolution the baked texture can carry, it's likely that a loss of detail will occur. For mobile platforms, it's probably not wise to choose anything higher than a resolution of 1,024. If the scene has a detail texture then this will be lost in the bake. Although the <a id="id237" class="indexterm"></a>detail texture could be reapplied in the host game engine by the programmer, this can be done as part of the engine material definition.</p><p>The <span class="strong"><strong>No per layer lighting</strong></span> option should be ticked to discard lighting information from layers during the bake process.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec34"></a>NormalMap tool</h3></div></div></div><p>A normal map (sometimes referred to as a <a id="id238" class="indexterm"></a>bump map) <a id="id239" class="indexterm"></a>can be generated automatically from the currently visible terrain surface. This tool requires a color texture layer to write on. The purpose of a NormalMap is to bake information on surface normals for lighting calculations. Once that information has been baked into a texture you can use much lower resolution terrain surfaces without losing the bumpy details, even at mid to long range view distances. This is ideal for games where we need to use terrain exported as low resolution meshes, we can retain the surface detail from the high-resolution mesh.</p><p>To create a normal map using the <a id="id240" class="indexterm"></a>tool, first create a new color texture layer on the material stack:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>New material layer</p></li><li style="list-style-type: disc"><p>Right-click on <span class="strong"><strong>Assign to selection</strong></span>
</p></li><li style="list-style-type: disc"><p>Click on <span class="strong"><strong>New</strong></span> texture (assign resolution to something like 1,024), click on <span class="strong"><strong>OK</strong></span>
</p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Layer Shading Configuration</strong></span> to NormalMap</p></li><li style="list-style-type: disc"><p>Click the NormalMap button to activate the tool</p></li><li style="list-style-type: disc"><p>Click on the <span class="strong"><strong>Apply</strong></span> button and wait</p></li></ul></div><p>Your terrain should turn purple and green(ish). From the layer stack, drag the layer to the bottom. Toggle its visibility to admire the difference it makes to the scene lighting.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note02"></a>Note</h3><p>The normal map format is <code class="literal">RGB = normal.XYZ</code>, with <code class="literal">normal.X</code> and <code class="literal">normal.Z</code> normalized from -1 – 1 to 0 – 1 interval (<code class="literal">normalized = (original + 1) * 0.5</code>) so they fit into color channel. </p><p>
<code class="literal">Normal.Y</code> doesn't need to be normalized, for terrain this normal is always facing up.</p></div></div></div>