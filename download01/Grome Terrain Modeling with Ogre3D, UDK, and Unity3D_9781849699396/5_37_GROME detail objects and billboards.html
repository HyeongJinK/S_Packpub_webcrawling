<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec39"></a>GROME detail objects and billboards</h2></div></div><hr /></div><p>GROME's vegetation layers <a id="id253" class="indexterm"></a>have a set of properties controlling visibility range, fade-out distance, and create objects where one model is swapped for a lower detail one (<a id="id254" class="indexterm"></a>Level of Detail "LOD" collections). It also supports <a id="id255" class="indexterm"></a>
<span class="strong"><strong>billboards</strong></span>; a term used in computer graphics to describe a textured quad that always faces the camera. A billboard quad is aligned to the camera using a vertex shader on the 3D hardware and can process thousands of billboards very quickly. Most game engines support this kind of object.</p><p>GROME vegetation layers are named "Detail" layers since it can render any kind of object such as rocks or debris, not just vegetation.</p><p>GROME also divides <a id="id256" class="indexterm"></a>detail layers into two very distinct types:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>3D <a id="id257" class="indexterm"></a>Objects</p></li><li style="list-style-type: disc"><a id="id258" class="indexterm"></a><p>Billboards</p></li></ul></div><p>You specify the type of detail layer when assigning zones to a Detail layer. Again these types won't export directly to our game engines.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec35"></a>The Detail layer stack</h3></div></div></div><p>To set the mode of the layer stack to <span class="strong"><strong>Details</strong></span> we set it <a id="id259" class="indexterm"></a>from the drop-down control in the workspace panel, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_01.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec26"></a>Adding grass billboards</h4></div></div></div><p>As with all modes of the layer stack, a layer is assigned one or more zones from the scene by right-clicking on a layer and selecting <span class="strong"><strong>Assign to selection</strong></span>. Doing <a id="id260" class="indexterm"></a>so will present us with a <a id="id261" class="indexterm"></a>dialog box (shown in the following screenshot) which applies selected detail objects according to a coverage mask (which is empty on creation).</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_02.jpg" /></div><p>The <span class="strong"><strong>Type</strong></span> drop-down control <a id="id262" class="indexterm"></a>on the dialog helps to toggle between the two modes; <span class="strong"><strong>Grass Billboards</strong></span> and <span class="strong"><strong>3D Objects</strong></span>. This changes the input parameters on the lower parts of the dialog. Billboards have additional parameters for wind animation.</p><p>Grass billboards can make use of strips of images to create variations <a id="id263" class="indexterm"></a>
<a id="id264" class="indexterm"></a>using a single layer. The GROME texture library contains a selection of these consisting of four types of color matched grass. An example <a id="id265" class="indexterm"></a>image strip is shown as follows:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_03.jpg" /></div><p>The <span class="strong"><strong>Texture</strong></span> settings<a id="id266" class="indexterm"></a> in the <a id="id267" class="indexterm"></a>
<span class="strong"><strong>New Detail Layer</strong></span> dialog allows us to specify different billboard sizes and density values for each subimage.</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_04.jpg" /></div><p>When using an image strip it's important we click the <span class="strong"><strong>+</strong></span> button <a id="id268" class="indexterm"></a>to correctly set the number of <span class="strong"><strong>Detail items</strong></span> so that it is equal to the number of images in the strip. If we don't, the whole strip will be used for the billboard and the results will look a little strange, especially when the camera is rotated. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec27"></a>Adding 3D Object details</h4></div></div></div><p>This is accomplished from the same <a id="id269" class="indexterm"></a>
<span class="strong"><strong>New Detail Layer</strong></span> dialog box, however the <span class="strong"><strong>Type</strong></span> drop-down control presents a different set of controls. This <a id="id270" class="indexterm"></a>is <a id="id271" class="indexterm"></a>shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_05.jpg" /></div><p>3D Objects should have a small polygon count as many will end up being drawn in the scene. The <span class="strong"><strong>Density</strong></span> <a id="id272" class="indexterm"></a>value is the maximum number of these objects that will be placed at random (in an algorithm that uses <a id="id273" class="indexterm"></a>
<span class="strong"><strong>Noise seed</strong></span> as a placement modifier) inside each "cell". A <a id="id274" class="indexterm"></a>cell is a single pixel of the coverage mask. When you create a mask you're asked for resolution (default is 512 x 512 pixels) and a color to initialize the <a id="id275" class="indexterm"></a>mask with. Remember, <a id="id276" class="indexterm"></a>white is maximum coverage, black is zero coverage.</p><p>This mask will be added to each zone, so it will be stretched to fit. If you need fine control over coverage use a high-resolution mask but it's better to keep it small and adjust the density as required.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec36"></a>The Detail toolset</h3></div></div></div><p>For creating coverage masks for detail objects we have three <a id="id277" class="indexterm"></a>kinds of tools: Brushes, Mask import, and Procedural.</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_06.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec28"></a>Brush tool</h4></div></div></div><p>The brush <a id="id278" class="indexterm"></a>tool operates in a similar manner to the <a id="id279" class="indexterm"></a>Masked Texture brush tool or selection brush tool. You paint a value into the coverage mask and the Graphite engine populates the area according to the layer's parameters.</p><p>You can use the brush size hotkeys (square brackets) to adjust coverage as you paint. The tool roll-up has three radio buttons controlling the paint mode. You add, subtract, or write an absolute value to the mask. Setting an absolute level of zero will erase details. The next screenshot shows an example of painting with the brush tool from a top-down camera view. </p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_07.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec29"></a>Mask tool</h4></div></div></div><p>This enables us to import a grayscale image and apply it to a specified area and size. The imported image is positioned such that it is centered at the position indicated by the <span class="strong"><strong>Origin</strong></span> coordinates on the tool panel. To get the coordinates you can use the <span class="strong"><strong>Scene Statistics</strong></span> option in the <span class="strong"><strong>Utilities</strong></span> menu at the top of the window. <a id="id280" class="indexterm"></a>Assuming you have just the zones you want to cover selected, the center point will be given (you can ignore the Y value). The mask will cover the specified size in world units. An example of applying a mask is shown as follows:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_08.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec30"></a>Procedural tools</h4></div></div></div><p>Two tools are listed in the procedural toolset: Generator and Resampler. <a id="id281" class="indexterm"></a>The Resampler tool allows us to adjust the resolution of the coverage mask. Simply set the new resolution and click on the <a id="id282" class="indexterm"></a>
<span class="strong"><strong>Apply</strong></span> button (as with all tools you need a selection and the layer should be armed for use otherwise no operation can take place).</p><p>The Generator is the most fun and time saving tool of the collection. It operates on the same principles as Masked Textures. Using one or more Distribution Masks it will apply values to the coverage mask according to the parameters specified in each DM parameter. Each Distribution Mask specifies information about altitude range, slope angle, and orientation. Using these we apply details to specific areas of terrain topography. Grasses on plains, rocks on hills, and trees placed below fixed altitudes. It's capable of doing a lot a work for the artist. Applying many layers of vegetation detail is a <a id="id283" class="indexterm"></a>time-consuming task in some game engines; large game worlds are especially challenging.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch05lvl4sec01"></a>A quick example</h5></div></div></div><p>Starting with an empty project we will make a single zone and <a id="id284" class="indexterm"></a>apply a procedural heightmap operation to give it some features (making the altitude range something like 0 to 200 units). Just so we have a simple heightmap, or paint some features using a brush.</p><p>Let's walk through the steps to create a single grass layer:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a detail layer to the layer stack and assign it to the zone. When the new detail dialog appears set the type to <span class="strong"><strong>Grass Billboards</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Newâ€¦</strong></span> mask button (keeping the default values) and pick a grass texture from the GROME library.</p></li><li><p>Using the Procedural Generator tool we're going to map the grass to the height range 0 to 100 and avoid slopes greater than 20 degrees.</p></li><li><p>Filling out the Distribution Mask as shown previously and adding it to the <span class="strong"><strong>Layer in use</strong></span> at the bottom of the roll-up.</p></li><li><p>Add a small value to the <span class="strong"><strong>Att</strong></span> (attenuation) field to feather the detail.</p></li><li><p>Make sure the Apply method is set to <span class="strong"><strong>Replace</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Apply</strong></span> button.</p></li></ol></div><p>The result should approximate the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_09.jpg" /></div><p>Experiment with different ranges and "color" value in the Distribution <a id="id285" class="indexterm"></a>Mask. Note how different shades of gray alter the density of the detail coverage.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch05lvl4sec02"></a>A closer look at Billboard Grasses </h5></div></div></div><p>GROME like other game engines creates a "moving carpet" of grass detail centered on the camera. As the player moves, any grass object moving out of range disappears. New grass objects are faded into view in front of the player. Quite often this moving carpet is noticeable in games but careful attention to match the color <a id="id286" class="indexterm"></a>between the grass and terrain textures can greatly reduce the visual impact of the pop-in effect.</p><p>When adding grass or any detail layer we should take time to set the fade start and fade end parameters. This sets the size of this "moving carpet" in which the billboards are visible.</p><p>To make things interesting, the Graphite engine used by GROME does a pretty good job of blending <span class="strong"><strong>material</strong></span> <a id="id287" class="indexterm"></a>layers with <span class="strong"><strong>detail</strong></span> layers to blend baked shadows with dynamic lighting. This is similar to how decals can have an optional material layer applied during rendering. For Unity and UDK we don't need to concern ourselves with these options, they have their own methods for doing this kind of blending.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch05lvl4sec03"></a>Blending shadowmaps with vegetation</h5></div></div></div><p>If we have created a material layer containing a baked <a id="id288" class="indexterm"></a>shadowmap, we can use this to neatly blend grass billboards with the shadowmap as illustrated in the following screenshot. This greatly improves the scene at little cost.</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_10.jpg" /></div><p>You can find this setting below the detail layer stack when you have expanded and selected the layer (see the following dialog image). </p><p>Here we have in our scene a material layer simply named <span class="strong"><strong>Shadowmap</strong></span> containing baked shadows. From the Detail layer parameters, we simply select the material layer we want to use for <span class="strong"><strong>Shadow</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_11.jpg" /></div><p>Also note that we can set layers that modify the diffuse color and lighting of vegetation. This is handy for providing more natural color blending in <a id="id289" class="indexterm"></a>GROME but not widely supported in other engines.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec31"></a>3D Objects in detail layers</h4></div></div></div><p>The Detail tools, when using a layer set to 3D Object types, are identical to using grass billboards except in place of quads the engine will use a <a id="id290" class="indexterm"></a>DAE (Collada) object. When you consider that many thousands of these might be generated in a small space it's recommend you test small sample areas or use the hand brushing tools.</p><p>There's one caveat to using Detail layers for large objects such as trees; they don't cast any shadows. The shadowmap texture tool doesn't create shadows for 3D Objects placed in this manner. If we wish to hand-place trees it's a good idea to use the <a id="id291" class="indexterm"></a>Object tools (on an Object layer) which is for placement of 3D entities. Forests and trees placed using this method will have shadows baked by the shadowmap tool, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849699396/graphics/9182_05_12.jpg" /></div><p>Exporting vegetation as instanced objects results in a text file containing coordinate sets, not an image map. A special importer will be required to pull this data into our game. Another point to consider is that the host engine might render objects differently, therefore baked shadows won't match. </p><p>Unity 3D can render and bake vegetation shadows onto terrains so that you can skip this process altogether.</p><p>One final point about masks; during the GROME export process, every layer for each stack and each zone is exported as a mask. The exported masks are in a common image format (BMP, PNG, DDS, or JPG depending on user preference). This is a potentially large number of masks to import later, so anything we can do to keep down the amount of work is a bonus to the speed of our export pipeline. If the host 3D engine can natively perform some function it's worth pursuing. In game development I firmly believe in the mantra "whatever works".</p></div></div></div>