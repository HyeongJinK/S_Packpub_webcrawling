<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec61"></a>An animated walk-through</h2></div></div><hr /></div><p>Next, we'll implement an <a id="id473" class="indexterm"></a>automated walk-through of the scene. In conventional games, this is often used for a cut-scene, that is, a canned fly-through animation as a transition from one level to another. In VR, it's somewhat different. Walk-throughs can really be the VR experience itself. Head tracking is still active. So, it's not simply a pre-recorded video. You can look around and experience it, and it is more like an amusement park ride. This is often called an <span class="emphasis"><em>on-the-rails</em></span> VR experience.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec91"></a>Unity's animation system</h3></div></div></div><p>Unity's<a id="id474" class="indexterm"></a> animation system is a powerful multipart <a id="id475" class="indexterm"></a>system that lets you build advanced and intricate animation behaviors. The animation system has different but similar sounding parts:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>An <span class="strong"><strong>Animation Curve</strong></span>
<a id="id476" class="indexterm"></a> defines a spline curve for a specific property that changes its value over time.</p></li><li style="list-style-type: disc"><p>An <span class="strong"><strong>Animation Clip</strong></span> is a<a id="id477" class="indexterm"></a> named set of curves that can be applied to an object and played (it animates the object). It can be edited in the <span class="strong"><strong>Animation View</strong></span> panel.</p></li><li style="list-style-type: disc"><p>An <span class="strong"><strong>Animator Controller</strong></span>
<a id="id478" class="indexterm"></a> keeps track of the clips that should be playing and when these clips should be changed or blended together. It can be edited with the <span class="strong"><strong>Animator</strong></span> panel visual editor.</p></li><li style="list-style-type: disc"><p>An object can be given an <a id="id479" class="indexterm"></a>
<span class="strong"><strong>Animator Component</strong></span>, which is then assigned one (or more) <span class="strong"><strong>Animator Controller</strong></span>.</p></li></ul></div><p>Prior to Unity 5, there were separate legacy and Mecanim humanoid animation systems, which have since been combined into a single main animation system of Unity. The legacy system included an <span class="strong"><strong>Animation Component</strong></span>, which is no longer used.</p><p>The Unity animation system is largely oriented towards humanoid animations, or at least, building complex animations from multiple clips that may be blended together and can respond to other events. Details of <span class="strong"><strong>Animator Controller</strong></span> and animating humanoid character movements are outside the scope of this book, but it is a fascinating specialty.</p><p>I've introduced <a id="id480" class="indexterm"></a>this topic because we're not going to use it. Say what? Well, the animation that we require for this project is just a simple <span class="strong"><strong>Transform</strong></span> update. So, using the animation system would be overkill, but the context is important. Given an <span class="strong"><strong>Animation Component</strong></span> on an object, it references an <span class="strong"><strong>Animator Controller</strong></span> that orchestrates one or more named <span class="strong"><strong>Animation Clips</strong></span>. <span class="strong"><strong>Animation Clips</strong></span> consist of key-frame curves for the properties that you want to animate. We will just make and use our own <span class="strong"><strong>Animation Curves</strong></span> without all the other stuff.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec92"></a>Scripted animation</h3></div></div></div><p>For this<a id="id481" class="indexterm"></a> project, we will add a script to the<a id="id482" class="indexterm"></a> first-person character (<code class="literal">MeMyselfEye</code>) to change its <span class="strong"><strong>Transform</strong></span> position and rotation over time. It works by defining the key-frame transforms. As the name suggests, for key-frame animation, we define the camera's location at specific key times in the ride. The in-between frames are calculated automatically.</p><p>Our first job is to decide where the key nodes on the track should be placed and which way the camera should be facing. We will set three parameters for the first-person character—position <span class="emphasis"><em>X</em></span>, position <span class="emphasis"><em>Z</em></span>, and rotation <span class="emphasis"><em>Y</em></span>. You can do this manually by using the built-in <span class="strong"><strong>Animation View</strong></span> panel. Instead, we'll do it with a script.</p><p>In our gallery's fun ride, I want to make sure that the visitor gets to see each of the photos on the walls. So for each key frame, the user should be directly in front of one of the artworks as the ride progresses through the exhibition. For this to work properly, ensure that <code class="literal">ArtworkRigs</code> under <span class="strong"><strong>Artworks</strong></span> are in the exact order in which you want to ride through the scene. We'll place each key position one meter away from the middle of the frame, using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>If necessary, drag <code class="literal">MeMyselfEye</code> from the <code class="literal">Prefabs</code> folder under the <code class="literal">Project Assets/</code> directory into <span class="strong"><strong>Hierarchy</strong></span>, position it at the entrance, like <span class="emphasis"><em>X</em></span> = <code class="literal">2.6</code>, <span class="emphasis"><em>Z</em></span> = <code class="literal">-4.7</code>, and delete the default <span class="strong"><strong>Main Camera</strong></span> option.</p></li><li><p>In <span class="strong"><strong>Hierarchy</strong></span>, select <code class="literal">MeMyselfEye</code>. Then in <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <code class="literal">ExhibitionRide</code>.</p></li><li><p>Open the new script in <span class="strong"><strong>MonoDevelop</strong></span>.</p></li><li><p>Edit the <code class="literal">ExhibitionRide.cs</code> script, as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class ExhibitionRide : MonoBehaviour {
  public GameObject artworks;
  public float startDelay = 3f;
  public float transitionTime = 5f;
  private AnimationCurve xCurve, zCurve, rCurve;
  void Start () {
    int count = artworks.transform.childCount + 1;
    Keyframe[] xKeys = new Keyframe[count];
    Keyframe[] zKeys = new Keyframe[count];
    Keyframe[] rKeys = new Keyframe[count];
    int i = 0;
    float time = startDelay;
    xKeys [0] = new Keyframe (time, transform.position.x);
    zKeys [0] = new Keyframe (time, transform.position.z);
    rKeys [0] = new Keyframe (time, transform.rotation.y);
    foreach (Transform artwork in artworks.transform) {
      i++;
      time += transitionTime;
      Vector3 pos = artwork.position - artwork.forward;
      xKeys[i] = new Keyframe( time, pos.x );
      zKeys[i] = new Keyframe( time, pos.z );
      rKeys[i] = new Keyframe( time, artwork.rotation.y );
    }
    xCurve = new AnimationCurve (xKeys);
    zCurve = new AnimationCurve (zKeys);
    rCurve = new AnimationCurve (rKeys);
  }
  void Update () {
    transform.position = new Vector3 (xCurve.Evaluate (Time.time), transform.position.y, zCurve.Evaluate (Time.time));
    Quaternion rot = transform.rotation;
    rot.y = rCurve.Evaluate (Time.time);
    transform.rotation = rot; 
  }
}</pre></div></li></ol></div><p>In the<a id="id483" class="indexterm"></a> script, we declare three public parameters. The <code class="literal">GameObject artworks</code> variable should get initialized to the parent (<code class="literal">Artworks</code>), which<a id="id484" class="indexterm"></a> contains the <code class="literal">ArtworkRig</code> objects in the order in which they will get visited in the animation. The <code class="literal">startDelay</code> variable is the number of seconds before the ride begins, and the <code class="literal">transitionTime</code> variable is the time taken to travel from one viewing position (key frame) to the next.</p><p>We also define three <code class="literal">private AnimationCurve</code> variables named <code class="literal">xCurve</code>, <code class="literal">zCurve</code>, and <code class="literal">rCurve</code> for the <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Z</em></span> position and the <span class="emphasis"><em>y</em></span>-axis rotation at each viewing position. The <code class="literal">Start()</code> function initializes these curves.</p><p>An <code class="literal">AnimationCurve</code> object<a id="id485" class="indexterm"></a> is defined as an array of <code class="literal">Keyframes</code>. We will have one Keyframe for each viewing position plus the initial start point. Therefore, the first element of the Keyframe arrays is set to the initial <code class="literal">MeMyselfEye transform.position.x</code>, <code class="literal">transform.position.z</code>, and <code class="literal">transform.rotation.y</code> values. For each subsequent Keyframe, we use the artwork <span class="strong"><strong>Transform</strong></span> to find a point in the space one meter in front of the frame (<code class="literal">Vector3 pos = artwork.position – artwork.forward</code>).</p><p>Then in <code class="literal">Update()</code>, we <a id="id486" class="indexterm"></a>update the <code class="literal">transform.position</code> and <code class="literal">transform.rotation</code> properties to the interpolated values for the current <code class="literal">Time.time</code> property.</p><p>Save the script and then perform the following step:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From <span class="strong"><strong>Hierarchy</strong></span>, select <code class="literal">MeMyselfEye</code>.</p></li><li><p>Drag the <code class="literal">Artworks</code> object (which contains all <code class="literal">ArtworkRigs</code>) onto the <span class="strong"><strong>Exhibition Ride (Script) Artworks</strong></span> parameter field.</p></li></ol></div><p>When you play the scene, you get a nice easy ride through the art gallery, with a slight pause to view each photo. That's real nice! Hopefully, you picked images that you can show to all your friends and family!</p><p>In this script, I used the <code class="literal">transform.rotation</code> Quaternion <code class="literal">y</code> value directly. It's usually not recommended to manipulate Quaternion's value directly, but since we're consistently changing only a single axis, it is safe.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>
<span class="strong"><strong>Extra challenge</strong></span>: There are many things that you can add to enhance and complete the VR experience. Add an introductory splash screen and a "Click to Start" button. Add audio to the <code class="literal">ArtworkRig</code> that plays appropriate sounds, or a narration explaining each art piece. You can modify the size of images and/or frames for variety. You can also adjust the viewing distance, velocity per image, and so on. As mentioned earlier, you can load images at runtime from external sources, such as the Web, phone, or, hmm, Facebook!</p></div></div></div>