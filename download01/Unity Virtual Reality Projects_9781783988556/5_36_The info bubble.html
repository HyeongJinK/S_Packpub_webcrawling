<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec38"></a>The info bubble</h2></div></div><hr /></div><p>In a<a id="id272" class="indexterm"></a> comic book, when a character says something, it's shown in a <span class="emphasis"><em>speech bubble</em></span>. In many online social worlds, participants are represented by avatars and if you hover above someone's avatar, their name is displayed. I'll call this type of user interface an <span class="emphasis"><em>info bubble</em></span>.</p><p>Info bubbles are located in world space at a specific 3D position, but the canvas should always be facing the camera. We can ensure this with a script.</p><p>In this example, we'll display the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Z</strong></span> location of the <code class="literal">WalkTarget</code> object (set up in the previous chapter), controlled by the <code class="literal">LookMoveTo.cs</code> script. To add the info bubble, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the <span class="strong"><strong>Project</strong></span> panel, drag the <code class="literal">DefaultCanvas</code> prefab directly into the <span class="strong"><strong>Scene</strong></span> view on top of <code class="literal">WalkTarget</code> under <code class="literal">GameController</code> so that its a child of <code class="literal">WalkTarget</code>.</p></li><li><p>Rename it to <code class="literal">InfoBubble</code>.</p></li><li><p>With <code class="literal">InfoBubble</code> selected, set the <span class="strong"><strong>Rect Transform</strong></span> component's <span class="strong"><strong>Pos X</strong></span>, <span class="strong"><strong>Pos Y</strong></span>, <span class="strong"><strong>Pos Z</strong></span> to (<code class="literal">0</code>, <code class="literal">0.2</code>, <code class="literal">0</code>).</p></li><li><p>With <span class="strong"><strong>Text</strong></span> under <code class="literal">InfoBubble</code> selected, set the <span class="strong"><strong>Rect Transform</strong></span> component's <span class="strong"><strong>Pos X</strong></span>, <span class="strong"><strong>Pos Y</strong></span>, <span class="strong"><strong>Pos Z</strong></span> to (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>) and <span class="strong"><strong>Right</strong></span>, <span class="strong"><strong>Bottom</strong></span> to <code class="literal">0</code>, <code class="literal">0</code>.</p></li><li><p>With <span class="strong"><strong>Image</strong></span> under <code class="literal">InfoBubble</code> selected, set <span class="strong"><strong>Scale</strong></span> to (<code class="literal">0.7</code>, <code class="literal">0.2</code>, <code class="literal">1</code>).</p></li><li><p>Enter the <span class="strong"><strong>X:00.00, Z:00.00</strong></span> sample string for <span class="strong"><strong>Text</strong></span>.</p></li></ol></div><p>Verify that<a id="id273" class="indexterm"></a> the canvas and text look roughly the right size and position and adjust the text as you please.</p><p>Now, we will modify the <code class="literal">LookMoveTo.cs</code> script to show the current <code class="literal">WalkTarget</code> <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Z</strong></span> position. Open the script in the MonoDevelop editor, and add the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
<span class="strong"><strong>using UnityEngine.UI;</strong></span>
using System.Collections;

public class LookMoveTo : MonoBehaviour {
  public GameObject ground;
<span class="strong"><strong>  public Transform infoBubble;</strong></span>

<span class="strong"><strong>  private Text infoText;</strong></span>

<span class="strong"><strong>  void Start () {</strong></span>
<span class="strong"><strong>    if (infoBubble != null) {</strong></span>
<span class="strong"><strong>      infoText = infoBubble.Find ("Text").GetComponent&lt;Text&gt; ();</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>  }</strong></span>

  void Update () {
    Transform camera = Camera.main.transform;
    Ray ray;
    RaycastHit[] hits;
    GameObject hitObject;

    ray = new Ray (camera.position, camera.rotation * Vector3.forward);
    hits = Physics.RaycastAll (ray);
    for (int i=0; i &lt; hits.Length; i++) {
      RaycastHit hit = hits [i];
      hitObject = hit.collider.gameObject;
      if (hitObject == ground) {
<span class="strong"><strong>        if (infoBubble != null) {</strong></span>
<span class="strong"><strong>          infoText.text = "X:" + hit.point.x.ToString("F2") + ", Z:" + hit.point.z.ToString("F2");</strong></span>

<span class="strong"><strong>          infoBubble.LookAt(camera.position);</strong></span>
<span class="strong"><strong>          infoBubble.Rotate ( 0.0f, 180.0f, 0.0f );</strong></span>
<span class="strong"><strong>      }</strong></span>
        transform.position = hit.point;
      }
    }
  }

}</pre></div><p>The line <code class="literal">using UnityEngine.UI;</code> states that this script will need access to the Unity UI API. We <a id="id274" class="indexterm"></a>defined a <code class="literal">public Transform infoBubble</code> variable, which will be set to the <code class="literal">WalkTarget/InfoBubble</code> object. We also defined a private <span class="strong"><strong>Text</strong></span> the <code class="literal">infoText</code> variable, which gets set to the <code class="literal">InfoBubble</code> object's <span class="strong"><strong>Text</strong></span> object. The script assumes that the given <code class="literal">InfoBubble</code> has a child <span class="strong"><strong>Text</strong></span> UI object.</p><p>So, the <code class="literal">infoText text</code> object has a text component, which has a text string property! You can see what I mean in Unity editor. If you examine the <span class="strong"><strong>Inspector</strong></span> panel while <code class="literal">InfoBubble/Text</code> is selected, you'll see that it contains a <span class="strong"><strong>Text (Script)</strong></span> component, which has a <span class="strong"><strong>Text</strong></span> field. This <span class="strong"><strong>Text</strong></span> field is where we write our messages. So in <code class="literal">Setup()</code>, we find the <code class="literal">WalkTarget/InfoBubble/Text</code> object assigning the <span class="strong"><strong>Text</strong></span> object to <code class="literal">infoText</code>, and then in <code class="literal">Update()</code>, we set the string value of <code class="literal">infoText.text</code> so that the score is shown on the bubble canvas.</p><p>Also, in <code class="literal">Update()</code>, we transformed the <code class="literal">infoBubble</code> canvas so that it's always facing us using <code class="literal">infoBubble.LookAt()</code> and passing it the camera position. The result of <code class="literal">LookAt()</code> has the canvas facing away from us. So, we also need to rotate it around the <span class="emphasis"><em>y</em></span>-axis by 180 degrees.</p><p>Save the script and drag the <code class="literal">InfoBubble</code> object from <span class="strong"><strong>Hierarchy</strong></span> onto the <span class="strong"><strong>Info Bubble</strong></span> slot in the <span class="strong"><strong>Look Move To (Script)</strong></span> component. If you don't assign the <code class="literal">InfoBubble</code> canvas, the script will still run because we test for <code class="literal">null </code>objects before we reference them.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip14"></a>Note</h3><p>An info bubble UI canvas is attached to other game objects, moving when they move and always facing the camera (like a billboard).</p></div><p>Run the scene in VR, and you'll see that <code class="literal">WalkTarget</code> has a little info bubble telling us about its <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Z</strong></span> position.</p><div class="mediaobject"><img src="/graphics/9781783988556/graphics/B04781_05_09.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p>
<span class="strong"><strong>Extra challenge:</strong></span> Want to try something else? Implement a health meter bar for Ethan. Use the <code class="literal">countDown</code> variable in the <code class="literal">KillTarget</code> script to determine his percent health, and show a health meter (horizontal bar) above his head when it's not 100 percent.</p></div><p>Info <a id="id275" class="indexterm"></a>bubbles are useful when you need to display UI messages that belong to specific objects in the scene and may move in concert with the objects.</p></div>