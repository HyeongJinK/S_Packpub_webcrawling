<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec50"></a>Bouncy balls</h2></div></div><hr /></div><p>
<span class="strong"><strong>Feature</strong></span>: <span class="emphasis"><em>When a ball drops from mid-air and hits the ground, it bounces back up and down, and up again, diminished by gravity.</em></span>
</p><p>We are going <a id="id406" class="indexterm"></a>to start simply with a new scene that consists of a ground plane and a sphere. Then, we'll add physics to it, a bit at a time, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new scene by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Scene</strong></span>.</p></li><li><p>Then, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save Scene As...</strong></span> and name it <code class="literal">BallsFromHeaven</code>.</p></li><li><p>Create a new plane by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span> and reset its position using the <span class="strong"><strong>Transform</strong></span> component's <span class="emphasis"><em>gear</em></span> icon | <span class="strong"><strong>Reset</strong></span>.</p></li><li><p>Create a new sphere by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Sphere</strong></span> and rename it <code class="literal">BouncyBall</code>.</p></li><li><p>Set its <span class="strong"><strong>Scale</strong></span> to (<code class="literal">0.5</code>, <code class="literal">0.5</code>, <code class="literal">0.5</code>) and <span class="strong"><strong>Position</strong></span> to (<code class="literal">0</code>, <code class="literal">5</code>,<code class="literal">0</code>) so that it's above the center of the plane.</p></li><li><p>Drag the <span class="strong"><strong>Red</strong></span> material from <span class="strong"><strong>Project Assets</strong></span> (created in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Objects and Scale</em></span>) onto it so that it looks like a bouncy ball.</p></li></ol></div><p>The new Unity scene defaults come with <span class="strong"><strong>Directional Light</strong></span> and <span class="strong"><strong>Main Camera</strong></span>. It's OK to use this <span class="strong"><strong>Main Camera</strong></span> for the time being.</p><p>Click on <span class="emphasis"><em>Play</em></span> button. Nothing happens. The ball just sits in mid-air and doesn't move.</p><p>Now, let's give it a Rigidbody, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <code class="literal">BouncyBall</code> selected, in <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Rigidbody</strong></span>.</p></li><li><p>Click on <span class="emphasis"><em>Play</em></span> button. It drops like a lead balloon.</p></li></ol></div><p>Let's make it bounce, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, select the top-level <span class="strong"><strong>Assets</strong></span> folder, navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Folder</strong></span>, and rename it to <code class="literal">Physics</code>.</p></li><li><p>With the <code class="literal">Physics</code> folder selected, create a material by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Physic Material</strong></span>.</p></li><li><p>Name it <code class="literal">Bouncy</code>.</p></li><li><p>Set its <span class="strong"><strong>Bounciness</strong></span> value to <code class="literal">1</code>.</p></li><li><p>With the <code class="literal">BouncyBall</code> sphere selected in <span class="strong"><strong>Hierarchy</strong></span>, drag the <code class="literal">Bouncy</code> asset from <span class="strong"><strong>Project</strong></span> onto the sphere's <span class="strong"><strong>Collider</strong></span> material field in <span class="strong"><strong>Inspector</strong></span>.</p></li></ol></div><p>Click on <span class="emphasis"><em>Play</em></span> button. It <a id="id407" class="indexterm"></a>bounces, but it does not go very high. We used the maximum value for <span class="strong"><strong>Bounciness</strong></span> as <code class="literal">1.0</code>. What's slowing it down? It's not the <span class="strong"><strong>Friction</strong></span> settings. Rather, the <span class="strong"><strong>Bounce Combine</strong></span> is set to <span class="strong"><strong>Average</strong></span>, which determines how much of the bounciness of the ball (1) is mixed with that of the plane (0). So, it diminishes rapidly over time. We want the ball to retain all its bounciness. We will accomplish this, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change the <code class="literal">Bouncy</code> object's <span class="strong"><strong>Bounce Combine</strong></span> to <span class="strong"><strong>Maximum</strong></span>.</p></li><li><p>Click on <span class="emphasis"><em>Play</em></span> button.</p></li></ol></div><p>Much better. Actually, too much better. The ball keeps bouncing back up to its original height, ignoring gravity. Now, change the <span class="strong"><strong>Bounciness</strong></span> to <code class="literal">0.8</code>. The bounces diminish, and the ball will eventually come to a stop.</p><p>Let's check it out in VR, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Delete the default <span class="strong"><strong>Main Camera</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> root.</p></li><li><p>Drag the <code class="literal">MeMyselfEye</code> prefab from <span class="strong"><strong>Project Assets</strong></span> into the scene. Set its <span class="strong"><strong>Position</strong></span> to (<code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">-4</code>).</p></li></ol></div><p>Run it in VR. Pretty neat! Even the simplest things look impressive in VR.</p><p>OK, let's have some fun. Make it rain bouncy balls! To do this, we'll make the ball a prefab and write a script that instantiates new balls, dropping them from random positions, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag the <code class="literal">BouncyBall</code> object from <span class="strong"><strong>Hierarchy</strong></span> into <code class="literal">Project Assets/Prefabs</code> folder, making it a prefab.</p></li><li><p>Delete the <code class="literal">BouncyBall</code> object from the <span class="strong"><strong>Hierarchy</strong></span>, since we'll be instantiating them with a script.</p></li><li><p>Create an empty game controller object to attach the script to by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span>. Rename it <code class="literal">GameController</code>.</p></li><li><p>In <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>, name it <code class="literal">BallsFromHeaven</code>, and open the script in MonoDevelop.</p></li></ol></div><p>Edit the script so that it looks like this:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class BallsFromHeaven : MonoBehaviour {
  public GameObject ball;
  public float startHeight = 10f;
  public float fireInterval = 0.5f;

  private float nextBallTime = 0.0f;

  void Update () {
    if (Time.time &gt; nextBallTime) {
      nextBallTime = Time.time + fireInterval;
      Vector3 position = new Vector3( Random.Range (-4.0f, 4.0f), startHeight, Random.Range (-4.0f, 4.0f) );
      Instantiate( ball, position, Quaternion.identity );
    }
  }
}</pre></div><p>The script<a id="id408" class="indexterm"></a> drops a new ball from <code class="literal">startHeight</code> at the rate of every <code class="literal">fireInterval</code> seconds (an interval of 0.5 means that a new ball is dropped every half second). The new ball position is at a random <span class="strong"><strong>X</strong></span>-<span class="strong"><strong>Z</strong></span> coordinate between <code class="literal">-4</code> and <code class="literal">4</code>. The <code class="literal">Instantiate()</code> function adds a new ball into the scene <span class="strong"><strong>Hierarchy</strong></span>.</p><p>Save the script. We now need to populate the <span class="strong"><strong>Ball</strong></span> field with the <code class="literal">BouncyBall</code> prefab, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <code class="literal">GameController</code> selected in <span class="strong"><strong>Hierarchy</strong></span>, drag the <code class="literal">BouncyBall</code> prefab from <code class="literal">Project Assets/Prefabs</code> folder onto the <span class="strong"><strong>Ball</strong></span> slot in the <span class="strong"><strong>Balls From Heaven (Script)</strong></span> panel in <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Be sure to use the <code class="literal">BouncyBall</code> prefab from <span class="strong"><strong>Project Assets</strong></span> so that can be instantiated.</p></li><li><p>Save the scene. Run it in VR. Fun!</p></li></ol></div><p>This is what I get:</p><div class="mediaobject"><img src="/graphics/9781783988556/graphics/B04781_07_02.jpg" /></div><p>Watch <a id="id409" class="indexterm"></a>the <span class="strong"><strong>Hierarchy</strong></span> panel as new balls are instantiated. Note that some balls end up bouncing off the plane platform but remain in the <span class="strong"><strong>Hierarchy</strong></span> panel. We need to clean this up by adding a script that destroys the balls that are out of play, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <code class="literal">BouncyBall</code> prefab in <code class="literal">Project Assets/Prefabs</code>.</p></li><li><p>Navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span>, name it <code class="literal">DestroySelf</code>, and open it in MonoDevelop.</p></li></ol></div><p>Here's a <code class="literal">DestroySelf.cs</code> script, which will destroy the object if its <span class="strong"><strong>Y</strong></span> position is well below the ground plane (<span class="strong"><strong>Y</strong></span> = <code class="literal">0</code>):</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class DestroySelf : MonoBehaviour {
  void Update () {
    if (transform.position.y &lt; -5f) {
      Destroy (gameObject);	
    }
  }
}</pre></div><p>Whenever you have a script that instantiates objects, you must be aware of the lifecycle of the object and possibly arrange to destroy it when it is no longer needed.</p><p>In summary, we<a id="id410" class="indexterm"></a> created a sphere with a Rigidbody and added a Physic Material with a <span class="strong"><strong>Bounciness</strong></span> property of <code class="literal">0.8</code> and <span class="strong"><strong>Bounce Combine</strong></span> to <span class="strong"><strong>Maximum</strong></span>. Then, we waved the <code class="literal">BouncyBall</code> as a prefab and wrote a script to instantiate new balls that drop from above.</p></div>