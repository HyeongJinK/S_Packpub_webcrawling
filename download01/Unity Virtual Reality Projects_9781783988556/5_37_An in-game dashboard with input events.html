<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec39"></a>An in-game dashboard with input events</h2></div></div><hr /></div><p>An in-game<a id="id276" class="indexterm"></a> dashboard is a UI display that is integrated into the game itself. A typical scenario is an automobile or a space ship, where you are seated in a cockpit. At waist level (desk level) is a panel with a set of controls, gauges, information displays, and so on. Dashboards generally feel more natural in a seated VR experience.</p><p>A few pages back, we discussed windshield HUDs. Dashboards are pretty much the same thing. One difference is that the dashboard may be more obviously a part of the level environment and not simply an auxiliary information display or a menu.</p><p>In<a id="id277" class="indexterm"></a> fact, dashboards can be a very effective mechanism to control VR motion sickness. Researchers have found that when a VR user has a better sense of being grounded and has a consistent <span class="emphasis"><em>horizon line</em></span> in view, he's much less likely to experience nausea while moving around a virtual space. The opposite being a floating one-dimensional eyeball with no sense of self or grounding, which is asking for trouble. (See the <span class="emphasis"><em>Oculus Best Practices</em></span> for this and other great tips by visiting <a class="ulink" href="https://developer.oculus.com/documentation/intro-vr/latest/concepts/bp_intro/" target="_blank">https://developer.oculus.com/documentation/intro-vr/latest/concepts/bp_intro/</a>).</p><p>In this <a id="id278" class="indexterm"></a>example, we'll make a simple dashboard with a Start/Stop button. For now, the buttons will operate a water hose in the scene to help fend off the zombies. (<span class="emphasis"><em>Why not?</em></span>). This project uses the scene created in the previous chapter.</p><p>This project is a bit more complicated than you might expect. However, if you've ever had to build anything in Minecraft, you know that even the simple things may require assembling multiple parts. Here's what we will do:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Create a dashboard canvas with two functional buttonsâ€”Start and Stop</p></li><li style="list-style-type: disc"><p>Add a water hose to the scene and wire it to the buttons</p></li><li style="list-style-type: disc"><p>Write a simple version of the script that activates the buttons</p></li><li style="list-style-type: disc"><p>Highlight a button by looking at it</p></li><li style="list-style-type: disc"><p>Improve the script to activate the button only if it's highlighted</p></li><li style="list-style-type: disc"><p>Modify the reticle cursor (created earlier) so that its enabled only when looking at the dashboard</p></li><li style="list-style-type: disc"><p>Consider mechanisms to <span class="emphasis"><em>click</em></span> with different VR hardware</p></li></ul></div><p>So let's get to it.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec55"></a>Creating a dashboard with buttons</h3></div></div></div><p>First, let's create a dashboard with a<a id="id279" class="indexterm"></a> Start and a Stop button, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the <span class="strong"><strong>Project</strong></span> panel, drag the <code class="literal">DefaultCanvas</code> prefab onto the <code class="literal">MeMyselfEye</code> object in the <span class="strong"><strong>Hierarchy</strong></span> panel so that it becomes a child.</p></li><li><p>Rename it to <code class="literal">Dashboard</code>.</p></li><li><p>With <code class="literal">Dashboard</code> selected, set the <span class="strong"><strong>Rect Transform</strong></span> component's <span class="strong"><strong>Pos X</strong></span>, <span class="strong"><strong>Pos Y</strong></span>, <span class="strong"><strong>Pos Z</strong></span> to (<code class="literal">0</code>, <code class="literal">-1</code>, <code class="literal">0.2</code>) and its <span class="strong"><strong>Rotation</strong></span> to (<code class="literal">60</code>, <code class="literal">0</code>, <code class="literal">0</code>).</p></li><li><p>Disable or delete the <span class="strong"><strong>Text</strong></span> child object of <code class="literal">Dashboard</code>.</p></li></ol></div><p>This places the dashboard one meter<a id="id280" class="indexterm"></a> below our eyes and a little out in front.</p><p>For a <span class="emphasis"><em>work-in-progress</em></span> look, if you'd like, I've included an image sketch of a vehicle dashboard that you can use, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">DashboardSketch.png</code> file into your <span class="strong"><strong>Project</strong></span> (such as the <code class="literal">Assets/Textures</code> folder).</p></li><li><p>Add a new <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Raw Image</strong></span> as a child of <code class="literal">Dashboard</code>.</p></li><li><p>Drag the <code class="literal">DashboardSketch</code> texture from the <span class="strong"><strong>Project</strong></span> panel onto the <span class="strong"><strong>Texture</strong></span> field of the <span class="strong"><strong>Raw Image</strong></span> component.</p></li><li><p>Set its <span class="strong"><strong>Rect Transform</strong></span> component's <span class="strong"><strong>Pos X</strong></span>, <span class="strong"><strong>Pos Y</strong></span>, <span class="strong"><strong>Pos Z</strong></span> to (<code class="literal">0</code>,<code class="literal">0</code>,<code class="literal">0</code>), <span class="strong"><strong>Width</strong></span> to <code class="literal">140</code>, and <span class="strong"><strong>Height</strong></span> to <code class="literal">105</code>.</p></li><li><p>It should be <span class="strong"><strong>Anchored</strong></span> at <span class="strong"><strong>middle</strong></span>-<span class="strong"><strong>center</strong></span> (<code class="literal">0.5</code>,<code class="literal">0.5</code>) in <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Pivot</strong></span>, with <span class="strong"><strong>Rotation</strong></span> (<code class="literal">0</code>,<code class="literal">0</code>,<code class="literal">0</code>).</p></li><li><p>Set <span class="strong"><strong>Scale</strong></span> to (<code class="literal">4.5</code>,<code class="literal">4.5</code>,<code class="literal">4.5</code>).</p></li></ol></div><p>Next we will add the Start and Stop buttons. They can go anywhere you'd like on the canvas, but the sketch has two nice spaces predefined for them:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a new <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Button</strong></span> as a new child of <code class="literal">Dashboard</code>. Name it <code class="literal">StartButton</code>.</p></li><li><p>Set its <span class="strong"><strong>Rect Transform</strong></span> component's <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, <span class="strong"><strong>Z</strong></span> to (<code class="literal">-48</code>, <code class="literal">117</code>, <code class="literal">0</code>), ser <span class="strong"><strong>Width</strong></span>, <span class="strong"><strong>Height</strong></span> to (<code class="literal">60</code>, <code class="literal">60</code>), and <span class="strong"><strong>Anchored</strong></span> to <span class="strong"><strong>center</strong></span>-<span class="strong"><strong>middle</strong></span> (<code class="literal">0.5</code>). No <span class="strong"><strong>Rotation</strong></span> and <span class="strong"><strong>Scale</strong></span> of <code class="literal">1</code>.</p></li><li><p>In the button's <span class="strong"><strong>Image (Script)</strong></span> component pane, for <span class="strong"><strong>Source Image</strong></span>, click on the tiny circle on the far right to open the <span class="strong"><strong>Select Sprite</strong></span> picker and choose <span class="strong"><strong>ButtonAcceleratorUpSprite</strong></span> (which you may have imported into the <code class="literal">Assets/Standard Assets/CrossPlatformInput/Sprites</code> folder).</p></li><li><p>In the button's <span class="strong"><strong>Button (Script)</strong></span> component pane, for <span class="strong"><strong>Normal Color</strong></span>, I liked RGB (<code class="literal">89</code>,<code class="literal">154</code>,<code class="literal">43</code>) and set <span class="strong"><strong>Highlighted Color</strong></span> to (<code class="literal">105</code>, <code class="literal">255</code>, <code class="literal">0</code>).</p></li><li><p>Similarly, create another button named <code class="literal">StopButton</code> with the <span class="strong"><strong>Rect Transform</strong></span> component's <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, <span class="strong"><strong>Z</strong></span> (<code class="literal">52</code>, <code class="literal">118</code>, <code class="literal">0</code>), set <span class="strong"><strong>Width</strong></span>, <span class="strong"><strong>Height</strong></span> to (<code class="literal">60</code>, <code class="literal">60</code>), for <span class="strong"><strong>Source Image</strong></span> select <span class="strong"><strong>ButtonBrakeOverSprite</strong></span>, choose <span class="strong"><strong>Normal Color</strong></span> (<code class="literal">236</code>, <code class="literal">141</code>, <code class="literal">141</code>) and <span class="strong"><strong>Highlighted Color</strong></span> (<code class="literal">235</code>, <code class="literal">45</code>, <code class="literal">0</code>).</p></li></ol></div><p>The result should look like this:</p><div class="mediaobject"><img src="/graphics/9781783988556/graphics/B04781_05_10.jpg" /><div class="caption"><p>2001 Audi A6 (source (<a class="ulink" href="http://www.justanswer.com/audi/6sskf-audi-a6-audi-a6-51-reg-centre-dashboard.html#re.v/174/" target="_blank">http://www.justanswer.com/audi/6sskf-audi-a6-audi-a6-51-reg-centre-dashboard.html#re.v/174/</a>)</p></div></div><p>One last thing. If you're using <a id="id281" class="indexterm"></a>the <code class="literal">ReticleCursor</code> that was created earlier in this chapter with the <code class="literal">CursorPositioner.cs</code> script, we want the dashboard itself to have a collider for the script. We can achieve this by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <code class="literal">Dashboard</code> selected, right-click for options, and navigate to <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Position</strong></span> to (<code class="literal">0</code>,<code class="literal">0</code>,<code class="literal">0</code>), <span class="strong"><strong>Rotation</strong></span> to (<code class="literal">270</code>,<code class="literal">0</code>,<code class="literal">0</code>) and <span class="strong"><strong>Scale</strong></span> to (<code class="literal">64</code>,<code class="literal">1</code>,<code class="literal">48</code>).</p></li><li><p>Disable its <span class="strong"><strong>Mesh Renderer</strong></span> (but leave its <span class="strong"><strong>Mesh Collider</strong></span> enabled).</p></li></ol></div><p>Now the dashboard has a plane child that isn't rendered, but its collider will be detected when <code class="literal">CursorPositioner</code> does its ray cast.</p><p>Having a single toggle button with pressed and released states might be better than separate Start and Stop buttons. When we're done with this chapter, go ahead and figure out how to do it!</p><p>We just created a world space canvas that should appear in VR at waist or desk level. We decorated it with a dashboard sketch and added two UI buttons. Now, we'll wire up the buttons to specific events.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec56"></a>Linking the water hose to the buttons</h3></div></div></div><p>Let's first give the buttons something to<a id="id282" class="indexterm"></a> do, such as the action of turning on a fire hose. If we aim it strategically, it might even fend off rogue zombies. Coincidentally, the Unity <span class="strong"><strong>Particle Systems</strong></span> under <span class="strong"><strong>Standard Assets</strong></span> that we imported earlier has a water hose that we can use. Add it to the scene, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>If you haven't done so already, import the <span class="strong"><strong>Particle Systems</strong></span> standard asset from the main menu bar and navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>ParticleSystems</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, find <code class="literal">the Assets/Standard Assets/Particle Systems/Prefabs/Hose</code> prefab and drag it into the <span class="strong"><strong>Scene</strong></span> view.</p></li><li><p>Set its <span class="strong"><strong>Transform</strong></span> component's <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, <span class="strong"><strong>Z</strong></span> to (<code class="literal">-3</code>, <code class="literal">0</code>, <code class="literal">1.5</code>) and <span class="strong"><strong>Rotation</strong></span> to (<code class="literal">340</code>, <code class="literal">87</code>, <code class="literal">0</code>).</p></li><li><p>Ensure that <span class="strong"><strong>Hose</strong></span> is enabled (check its <span class="strong"><strong>Enable</strong></span> checkbox).</p></li><li><p>Unfold the <span class="strong"><strong>Hose</strong></span> in <span class="strong"><strong>Hierarchy</strong></span> so that you can see its child <span class="strong"><strong>WaterShower</strong></span> particle system. Select it.</p></li><li><p>In <span class="strong"><strong>Inspector</strong></span>, in the <span class="strong"><strong>Particle System</strong></span> properties pane, look for <span class="strong"><strong>Play On Awake</strong></span> and uncheck it.</p></li></ol></div><p>Note that the <span class="strong"><strong>Hose</strong></span> object in <span class="strong"><strong>Hierarchy</strong></span> has a <span class="strong"><strong>WaterShower</strong></span> child object. This is the actual particle system that we will control with the buttons. It should start <span class="emphasis"><em>off</em></span>.</p><p>The <span class="strong"><strong>Hose</strong></span> prefab itself comes with mouse-driven script that we don't want to use, so disable it, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <span class="strong"><strong>Hose</strong></span> selected, disable (uncheck) its <span class="strong"><strong>Hose (Script)</strong></span>.</p></li><li><p>Also disable (uncheck) the <span class="strong"><strong>Simple Mouse Rotator (Script)</strong></span> component.</p></li></ol></div><p>Now we will wire up <code class="literal">StartButton</code> to the <span class="strong"><strong>WaterShower</strong></span> particle system, by telling the buttons to listen for the <code class="literal">OnClick()</code> events, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Unfold the <span class="strong"><strong>Hose</strong></span> in <span class="strong"><strong>Hierarchy</strong></span> so that you can see its child <span class="strong"><strong>WaterShower</strong></span> particle system.</p></li><li><p>In <span class="strong"><strong>Hierarchy</strong></span>, select <code class="literal">StartButton</code> (under <code class="literal">MeMyselfEye/Dashboard</code>).</p></li><li><p>Note that the <span class="strong"><strong>On Click()</strong></span> pane in the <span class="strong"><strong>Inspector</strong></span> is empty. Click on the <span class="emphasis"><em>Plus</em></span> (<span class="strong"><strong>+</strong></span>) icon on the lower right of that pane to reveal a new field labeled <span class="strong"><strong>None (Object)</strong></span>.</p></li><li><p>Drag the <span class="strong"><strong>WaterShower</strong></span> particle system from <span class="strong"><strong>Hierarchy</strong></span> onto the <span class="strong"><strong>None (Object)</strong></span> field.</p></li><li><p>Its function selector the default value is <span class="strong"><strong>No Function</strong></span>. Change it to <span class="strong"><strong>ParticleSystem</strong></span> | <span class="strong"><strong>Play()</strong></span>.</p></li></ol></div><p>OK. The steps are similar for <a id="id283" class="indexterm"></a>the <code class="literal">StopButton</code>, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In <span class="strong"><strong>Hierarchy</strong></span>, select <code class="literal">StopButton</code>.</p></li><li><p>Click on the <span class="emphasis"><em>Plus</em></span> (<span class="strong"><strong>+</strong></span>) icon on the lower right of its <span class="strong"><strong>On Click()</strong></span> pane.</p></li><li><p>Drag the <span class="strong"><strong>WaterShower</strong></span> from <span class="strong"><strong>Hierarchy</strong></span> onto the <span class="strong"><strong>None (Object)</strong></span> field.</p></li><li><p>Its function selector the default value is <span class="strong"><strong>No Function</strong></span>. Change it to <span class="strong"><strong>ParticleSystem</strong></span> | <span class="strong"><strong>Stop()</strong></span>.</p></li></ol></div><p>The Start and Stop buttons <span class="emphasis"><em>listen for OnClick() events</em></span>, and when one comes, it will call the <span class="strong"><strong>WaterShower</strong></span> particle system's <code class="literal">Play()</code> and <code class="literal">Stop()</code> functions respectively. To make it work, we need to press the buttons.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec57"></a>Activating buttons from the script</h3></div></div></div><p>Before we give the user a way to<a id="id284" class="indexterm"></a> press the buttons, let's see how we can do this from a script. Create a new script on <code class="literal">GameController</code>, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <code class="literal">GameController</code> selected, press <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> to create a script named <code class="literal">ButtonExecuteTest</code>.</p></li><li><p>Open the script in MonoDevelop.</p></li></ol></div><p>In the following script, we turn the hose on and off in five second intervals, as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;
using System.Collections;

public class ButtonExecuteTest : MonoBehaviour {
  private GameObject startButton, stopButton;
  private bool on = false;
  private float timer = 5.0f;

  void Start () {
    startButton = GameObject.Find ("StartButton");
    stopButton = GameObject.Find ("StopButton");
  }

  void Update () {
    timer -= Time.deltaTime;
    if (timer &lt; 0.0f) {
      on = !on;
      timer = 5.0f;

      PointerEventData data = new PointerEventData (EventSystem.current);
      if (on) {
        ExecuteEvents.Execute&lt;IPointerClickHandler&gt; (startButton, data, ExecuteEvents.pointerClickHandler);
      } else {
        ExecuteEvents.Execute&lt;IPointerClickHandler&gt; (stopButton, data, ExecuteEvents.pointerClickHandler);
      }
    }
  }
}</pre></div><p>The script manages a Boolean <code class="literal">on</code> value, which <a id="id285" class="indexterm"></a>says that if the hose is on or off. And it has a timer which counts down from five seconds on each update. We use the <code class="literal">private</code> keyword for variables that are only used within this script, whereas the <code class="literal">public</code> ones can be viewed and modified via the Unity editor and other scripts. For <code class="literal">startButton</code> and <code class="literal">stopButton</code>, I decided to use <code class="literal">GameObject.Find()</code> to get them rather than having you drag and drop them in the Unity editor.</p><p>In this script, we introduced the <code class="literal">UnityEngine.EventSystems</code>. <span class="emphasis"><em>Events</em></span> are a way for different components to talk to one another. When an event occurs, such as a button press, a function in another script may get called. In our case, we're going to trigger an event corresponding to the start button press, and another corresponding to the stop button press.</p><p>The meat of our script is in the <code class="literal">ExecuteEvents.Execute</code> functions. Since we set up the button to respond to the <code class="literal">OnClick()</code> events, we just need to send such an event to the button that we want to execute. When we want to turn the hose on, we call <code class="literal">ExecuteEvents.Execute&lt;IPointerClickHandler&gt; (startButton, data, ExecuteEvents.pointerClickHandler)</code>. When we want to turn it off, we call the same for <code class="literal">stopButton</code>. The API requires a <code class="literal">PointerEventData</code> object to be included with the<a id="id286" class="indexterm"></a> arguments. So, we also provide that. (For more information on scripting Unity events, visit <a class="ulink" href="http://docs.unity3d.com/Manual/EventSystem.html" target="_blank">http://docs.unity3d.com/Manual/EventSystem.html</a>.)</p><p>Save the script and click on <span class="strong"><strong>Play</strong></span>. The hose should turn on and off every five seconds (as if a cat were walking on the dashboard).</p><p>Now that we tested the event system connection between the button clicks and the hose, we can disable this script before moving on to the next one.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip15"></a>Note</h3><p>Breaking down a complex feature into bite-sized pieces and testing them separately is an excellent implementation strategy.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec58"></a>Look to highlight a button</h3></div></div></div><p>Meanwhile, let's detect when the <a id="id287" class="indexterm"></a>user is looking at a button and highlight it. Although <span class="strong"><strong>Button</strong></span> is a Unity UI object, it needs to be detected with a ray cast. There may be other ways to accomplish this, but here we will add a game object sphere to each button, tag it as <code class="literal">Button</code> and cast a ray to detect it. First, add the spheres by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select <code class="literal">StartButton</code> (under <code class="literal">MeMyselfEye/Dashboard</code>), right-click for options, and navigate to <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Sphere</strong></span>.</p></li><li><p>Set its <span class="strong"><strong>Transform</strong></span> component's <span class="strong"><strong>Scale</strong></span> to (<code class="literal">52</code>, <code class="literal">52</code>, <code class="literal">52</code>) so that it fits the button size.</p></li><li><p>To add a tag named <code class="literal">Button</code>, near the top of the <span class="strong"><strong>Inspector</strong></span> panel, click on the <span class="strong"><strong>Tag</strong></span> selector, click on <span class="strong"><strong>Add Tag</strong></span>, and then select the <span class="emphasis"><em>Plus</em></span> (<span class="strong"><strong>+</strong></span>) icon to add a row to the tag list. Enter the name <code class="literal">Button</code> in place of <span class="strong"><strong>New Tag</strong></span>.</p></li><li><p>We're tagging the sphere child of <code class="literal">StartButton</code>. So, click on the sphere in <span class="strong"><strong>Hierarchy</strong></span> again so that its <span class="strong"><strong>Inspector</strong></span> panel is visible again. Then, click on the <span class="strong"><strong>Tag</strong></span> selector. This time, <code class="literal">Button</code> should be included in the list. Select it.</p></li></ol></div><p>The following screenshot shows the sphere on the button in <span class="strong"><strong>Scene</strong></span> and tagged <code class="literal">Button</code> in <span class="strong"><strong>Inspector</strong></span> before we disable its <span class="strong"><strong>Mesh Renderer</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781783988556/graphics/B04781_05_11.jpg" /></div><p>Disable the sphere's <span class="strong"><strong>Mesh Renderer</strong></span> by unchecking the <span class="strong"><strong>Mesh Renderer</strong></span> checkbox.</p><p>Also, repeat these steps for <code class="literal">StopButton</code>.</p><p>Now, create a new script on <code class="literal">GameController</code>, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With <code class="literal">GameController</code> selected, if <a id="id288" class="indexterm"></a>you haven't already, disable the previous <code class="literal">ButtonExecuteTest</code> script now by unchecking its <span class="strong"><strong>Enable</strong></span> checkbox.</p></li><li><p>With <code class="literal">GameController</code> selected, navigate to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> to create a script named <code class="literal">ButtonExecute</code>.</p></li><li><p>Open the script in MonoDevelop.</p></li></ol></div><p>In the following <code class="literal">ButtonExecute.cs</code> script, we tell the button to become highlighted when you look at it:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;
using System.Collections;

public class ButtonExecute : MonoBehaviour {
  private GameObject currentButton;

  void Update () {
    Transform camera = Camera.main.transform;
    Ray ray = new Ray(camera.position, camera.rotation * Vector3.forward );
    RaycastHit hit;
    GameObject hitButton = null;
    PointerEventData data = new PointerEventData (EventSystem.current);
    if (Physics.Raycast (ray, out hit)) {
      if (hit.transform.gameObject.tag == "Button") {
        hitButton = hit.transform.parent.gameObject;
      }
    }
    if (currentButton != hitButton) {
      if (currentButton != null) { // unhighlight
        ExecuteEvents.Execute&lt;IPointerExitHandler&gt; (currentButton, data, ExecuteEvents.pointerExitHandler);
      }
      currentButton = hitButton;
      if (currentButton != null) { // highlight
        ExecuteEvents.Execute&lt;IPointerEnterHandler&gt; (currentButton, data, ExecuteEvents.pointerEnterHandler);
      }
    }
  }
}</pre></div><p>Much of this script should look familiar to you by now. On each frame's <code class="literal">Update()</code> function, we cast a ray from the camera, looking for a hit of an object tagged <code class="literal">Button</code> (the button's sphere). So, we take its <a id="id289" class="indexterm"></a>parent (the UI button itself) as <code class="literal">hitButton</code>. We remember <code class="literal">currentButton</code> that's highlighted between the calls to <code class="literal">Update()</code>. So, we can detect whether the new hit is the same or different (or nothing at all, null).</p><p>This script executes two new events on the <code class="literal">Button</code> object. In the previous <code class="literal">ButtonExecuteTest.cs</code> script, we executed a <span class="emphasis"><em>click</em></span> event (<code class="literal">pointerClickHandler</code>). This time, we will execute <span class="emphasis"><em>enter</em></span> and <span class="emphasis"><em>exit</em></span> events to highlight and remove the highlight respectively (with <code class="literal">pointerEnterHandler</code> and <code class="literal">pointerExitHandler</code>).</p><p>Save the script and <span class="emphasis"><em>Play</em></span>. When you gaze at a button, it should highlight, and when you gaze away from it, it should remove the highlight.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec59"></a>Looking and then clicking to select</h3></div></div></div><p>To be<a id="id290" class="indexterm"></a> a functional dashboard, the buttons should operate when they're clicked. Let's use the generic <code class="literal">Clicker</code> class that <a id="id291" class="indexterm"></a>we wrote in <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>VR Build and Run</em></span>, which checks for user clicks on the keyboard, mouse, or the Cardboard trigger.</p><p>At the top of the <code class="literal">ButtonExecute.cs</code> script's class definition, add the following:</p><div class="informalexample"><pre class="programlisting">public class ButtonExecute : MonoBehaviour {
  private GameObject currentButton;
<span class="strong"><strong>  private clicker = new Clicker ();</strong></span>
</pre></div><p>Then the changes made to the <code class="literal">ButtonExecute.cs</code> script are pretty simple. At the bottom of <code class="literal">Update()</code>, make the following changes:</p><div class="informalexample"><pre class="programlisting">    ...
    if (currentButton != hitButton) {
      if (currentButton != null) { // unhighlight
        ExecuteEvents.Execute&lt;IPointerExitHandler&gt; (currentButton, data, ExecuteEvents.pointerExitHandler);
      }
      currentButton = hitButton;
      if (currentButton != null) { // highlight
        ExecuteEvents.Execute&lt;IPointerEnterHandler&gt; (currentButton, data, ExecuteEvents.pointerEnterHandler);
      }
    }
<span class="strong"><strong>    if (currentButton != null) {</strong></span>
<span class="strong"><strong>      if (clicker.clicked()) {</strong></span>
<span class="strong"><strong>        ExecuteEvents.Execute&lt;IPointerClickHandler&gt; (currentButton, data, ExecuteEvents.pointerClickHandler);</strong></span>
<span class="strong"><strong>      }</strong></span>
<span class="strong"><strong>    }</strong></span>
</pre></div><p>After the setting of highlighting, if there's still one highlighted and any key is pressed (keyboard or mouse), we'll take that as a select and click on the UI button.</p><p>We <a id="id292" class="indexterm"></a>now have an in-game<a id="id293" class="indexterm"></a> dashboard with buttons that respond to user input, which controls the behavior of an object (water hose) in the scene.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec60"></a>Looking and staring to select</h3></div></div></div><p>Instead<a id="id294" class="indexterm"></a> of using a clicker, we can use a time-based selection to click on the button. To make this work, we'll keep a countdown timer while staring at a button, much like the one that we used to kill Ethan in the previous chapter. The <code class="literal">ButtonExecute.cs</code> script now looks like this:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.EventSystems;
using System.Collections;

public class ButtonExecute : MonoBehaviour {
<span class="strong"><strong>  public float timeToSelect = 2.0f;</strong></span>
<span class="strong"><strong>  private float countDown;</strong></span>
  private GameObject currentButton;
  private clicker = new Clicker ();

  void Update () {
    Transform camera = Camera.main.transform;
    Ray ray = new Ray(camera.position, camera.rotation * Vector3.forward );
    RaycastHit hit;
    GameObject hitButton = null;
    PointerEventData data = new PointerEventData (EventSystem.current);
    if (Physics.Raycast (ray, out hit)) {
      if (hit.transform.gameObject.tag == "Button") {
        hitButton = hit.transform.parent.gameObject;
      }
    }
    if (currentButton != hitButton) {
      if (currentButton != null) { // unhighlight
        ExecuteEvents.Execute&lt;IPointerExitHandler&gt; (currentButton, data, ExecuteEvents.pointerExitHandler);
      }
      currentButton = hitButton;
      if (currentButton != null) { // highlight
        ExecuteEvents.Execute&lt;IPointerEnterHandler&gt; (currentButton, data, ExecuteEvents.pointerEnterHandler);
<span class="strong"><strong>        countDown = timeToSelect;</strong></span>
      }
    }
    if (currentButton != null) {
<span class="strong"><strong>      countDown -= Time.deltaTime;</strong></span>
<span class="strong"><strong>      if (clicker.clicked() || countDown &lt; 0.0f) {</strong></span>
        ExecuteEvents.Execute&lt;IPointerClickHandler&gt; (currentButton, data, ExecuteEvents.pointerClickHandler);
<span class="strong"><strong>        countDown = timeToSelect;</strong></span>
      }
    }
  }
}</pre></div><p>When <a id="id295" class="indexterm"></a>a button is highlighted, the <code class="literal">countDown</code> timer starts. When it reaches zero, we consider that to be a click. <span class="emphasis"><em>Does it work for you? Wooohooo!!!</em></span>
</p><p>So this was a relatively complex project. The goal was to create a dashboard with buttons that turn a hose on and off. We broke it down into discrete steps, added the objects and components a step at a time, and tested each step to make sure that it works as expected before moving on. If you tried to implement this all at once or blew through it without testing, things can (and will) go wrong, and it'll be much harder to figure out where the problem cropped up.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note12"></a>Note</h3><p>
<span class="strong"><strong>Extra challenge</strong></span>: This feature can be further enhanced for different purposes. For example, it can be used to give the user a feedback that the countdown is running, perhaps by animating a selection cursor (such as concentric circles). Also, further feedback can be given when the click event is executed. For example, the <span class="strong"><strong>Button</strong></span> UI object has a <span class="strong"><strong>Transition</strong></span> option called <span class="strong"><strong>Animation</strong></span> that might be helpful. Also, consider audio cues.</p></div></div></div>