<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec66"></a>Magic orbs</h2></div></div><hr /></div><p>For the<a id="id520" class="indexterm"></a> next example, we'll look at the sphere from the inside, mapping an ordinary image onto its inside surface. Then, we'll put a solid colored <span class="emphasis"><em>shell</em></span> around the outside. So, you have to actually walk up to the sphere and stick your head into it to see what's there!</p><p>Follow these steps to build it (I'm using the <code class="literal">GrandCanyon.png</code> image that we introduced back in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Objects and Scale</em></span>, but you can use any image—preferably a landscape with big sky):</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Move <code class="literal">Sphere 1</code> out of the way and set its <span class="strong"><strong>Position</strong></span> to <code class="literal">(-3, 1.5, -1.5</code>).</p></li><li><p>Create a new sphere by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Sphere</strong></span>, set its <span class="strong"><strong>Position</strong></span> to (<code class="literal">0, 1.5, 0</code>), and name it <code class="literal">Sphere 2</code>.</p></li><li><p>Disable its <span class="strong"><strong>Sphere Collider</strong></span> component by unchecking the checkbox.</p></li><li><p>Create a new material by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Material</strong></span> and name it <code class="literal">GrandCanyonInward</code>.</p></li><li><p>Drag the <code class="literal">GrandCanyonInward</code> material onto <code class="literal">Sphere 2</code>.</p></li><li><p>Locate the <code class="literal">GrandCanyon</code> texture image and drag it onto the <code class="literal">GrandCanyonInward</code> component's <span class="strong"><strong>Albedo</strong></span> texture (onto the square towards the far left of the <span class="strong"><strong>Albedo</strong></span> field).</p></li></ol></div><p>At this <a id="id521" class="indexterm"></a>point, we have a sphere with an image wrapped around its outside, as in the previous example. Now, we'll reverse it so that the texture is rendered on the inside surface. We do this by using a custom shader, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new custom shader by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Shader</strong></span> and name it <code class="literal">InwardShader</code>.</p></li><li><p>In the <span class="strong"><strong>Project Assets</strong></span>, double-click on the new <code class="literal">InwardShader</code> to open it in MonoDevelop.</p></li></ol></div><p>Edit the shader's definition file, as follows:</p><div class="informalexample"><pre class="programlisting">Shader "Custom/InwardShader" {
  Properties {
    _MainTex ("Albedo (RGB)", 2D) = "white" {}
  }
  SubShader {
    Tags { "RenderType"="Opaque" }
    LOD 200

    Cull Front

    CGPROGRAM
    #pragma surface surf Standard vertex:vert

    void vert(inout appdata_full v) {
      v.normal.xyz = v.normal * -1;
    }

    sampler2D _MainTex;

    struct Input {
      float2 uv_MainTex;
    };

    void surf (Input IN, inout SurfaceOutputStandard o) {
      fixed4 c = tex2D (_MainTex, IN.uv_MainTex);
      o.Albedo = c.rgb;
    }
    ENDCG
  }
  FallBack "Diffuse"
}</pre></div><p>A Unity <a id="id522" class="indexterm"></a>shader is a text script file with directives on how Unity's rendering pipeline does its magic. Reading through the preceding shader code, our custom shader is named <code class="literal">InwardShader</code>. It has one <span class="strong"><strong>Properties</strong></span> panel—the <span class="strong"><strong>Albedo</strong></span> texture that you can set from the Unity editor. We set the <code class="literal">Cull</code> mode to <code class="literal">Front</code> (the possible values are <code class="literal">Back</code>, <code class="literal">Front</code>, and <code class="literal">Off</code>); the word <span class="strong"><strong>cull</strong></span> in this context means "to remove or ignore". Thus, it'll ignore the front faces but render the back ones. We also invert the normal vectors of each face (<code class="literal">v.normal.xyz = v.normal * -1</code>) for lighting calculations. The <code class="literal">surf()</code> sampler function, called by the Unity renderer, applies the properties defined in the shader, which is only the main texture image in this case.</p><p>To be honest, I actually found this code from a Web search, studied it, and then simplified it <a id="id523" class="indexterm"></a>for this example. You can learn more about Unity's ShaderLab from <a class="ulink" href="http://docs.unity3d.com/Manual/ShadersOverview.html" target="_blank">http://docs.unity3d.com/Manual/ShadersOverview.html</a>.</p><p>Now, apply the shader and ensure that the <code class="literal">Sphere 2</code> object is selected. On its <code class="literal">GrandCanyonInsider</code> material component in <span class="strong"><strong>Inspector</strong></span>, navigate to <span class="strong"><strong>Shader</strong></span> | <span class="strong"><strong>Custom</strong></span> | <span class="strong"><strong>InwardShader</strong></span>.</p><p>Try it in VR. From the outside, it looks especially weird, but walk into the sphere and look around. <span class="emphasis"><em>Well? I think it's cool.</em></span>
</p><p>For locomotion, you may need to add the <code class="literal">HeadLookWalk</code> script (written in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>First-person Character</em></span>) to <code class="literal">MeMyselfEye</code>, or just use Unity's standard <code class="literal">FPSController</code> prefab in place of <code class="literal">MeMyselfEye</code>.</p><p>Finally, we'll encase it in a solid colored orb by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the <code class="literal">Sphere 2</code> object in <span class="strong"><strong>Hierarchy</strong></span>, right-click, and navigate to <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Sphere</strong></span> so that the new sphere is a child of <code class="literal">Sphere 2</code>.</p></li><li><p>Disable its <span class="strong"><strong>Sphere Collider</strong></span> component by unchecking it.</p></li><li><p>Find a solid material, such as the one we made in a previous chapter, named <code class="literal">Red</code> and drag it onto the new sphere.</p></li></ol></div><p>Try it in VR. The following image is a capture of what I see. It's like peering into an egg shell!</p><div class="mediaobject"><img src="/graphics/9781783988556/graphics/B04781_09_03.jpg" /></div><p>We <a id="id524" class="indexterm"></a>created two concentric spheres—same size and position. We disabled their colliders so that we can penetrate through their surfaces. One sphere has a default shader, which renders the outward facing surface (in red). The other sphere uses a custom shader named <code class="literal">InwardShader</code>.</p><p>As a first-person character, you can go into the sphere and look around. If you're using a headset that supports positional tracking such as Oculus Rift, then you don't have to actually walk into the sphere. You can stop in front of it and lean in to stick your head into it! <span class="emphasis"><em>It's like magic!</em></span>
</p></div>