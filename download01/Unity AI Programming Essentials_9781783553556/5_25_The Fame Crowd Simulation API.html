<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec27"></a>The Fame Crowd Simulation API</h2></div></div><hr /></div><p>The Fame <a id="id130" class="indexterm"></a>Crowd Simulation API by TechBizXccelerator is available at Unity Asset Store under the name Crowd Simulator API for $45 at the time of writing this book. It allows you to create groups and customize steering behaviors. For our crowd demo, we will create a demo with many spaceships traveling in a group.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec13"></a>Setting up a scene with Fame</h3></div></div></div><p>To <a id="id131" class="indexterm"></a>create<a id="id132" class="indexterm"></a> our demo, first create a new scene with a plane as the ground. Like most of the AI plugins in this book, Fame Crowd Simulation also supports Unity's built-in terrain system, but for this demo, a basic ground plane will be fine. Fame also uses a singleton pattern that has one class that manages <a id="id133" class="indexterm"></a>everything<a id="id134" class="indexterm"></a> for crowd management, so create an empty GameObject and call it <span class="strong"><strong>Crowd Manager</strong></span>. Then, import Fame if it is not already in your project, and attach the <code class="literal">FameManager</code> script from <code class="literal">Fame Assets/FameScripts/FameManager.cs</code> to the <span class="strong"><strong>Crowd Manager</strong></span> GameObject. This initial setup is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_01_1.jpg" /></div><p>The following should be the hierarchy:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_01_2.jpg" /></div><p>This is our<a id="id135" class="indexterm"></a> basic Fame scene setup with a <span class="strong"><strong>Crowd Manager</strong></span> object.</p><p>The <span class="strong"><strong>FameManager</strong></span> object will be our main point of interaction with Fame, and we can interact with it from anywhere in our game code.</p><p>Unlike the other systems we saw where we create the AI characters individually to define our crowds, in Fame, we will define a group of characters, also called a flock. Add the ship model from <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Behavior Trees</em></span>, and then create another empty GameObject and call it <code class="literal">Ships</code>. Then, attach the <code class="literal">FlockGroup.cs</code> script to it from <code class="literal">Assets/FrameScripts</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note07"></a>Note</h3><p>To avoid the warning about not having a terrain in <span class="strong"><strong>FAME settings,</strong></span> disable <span class="strong"><strong>Enable Terrain Effect</strong></span> in <span class="strong"><strong>FameManager</strong></span> and <span class="strong"><strong>Get Info From Terrain GameObject</strong></span> in Fame terrain.</p></div><p>
<code class="literal">FlockGroup</code> is the <a id="id136" class="indexterm"></a>main class to hold a group of characters, and it has several settings we can customize:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Flock Type</strong></span>: This is <span class="strong"><strong>Ground</strong></span> or <span class="strong"><strong>Air</strong></span> and defines whether the AI characters will move on a plane (ground) or move in all three axes (air). If set to <span class="strong"><strong>Air</strong></span>, characters will ignore any terrain. You might think we would set our ships to air, but<a id="id137" class="indexterm"></a> we want them <a id="id138" class="indexterm"></a>to all hover at the <a id="id139" class="indexterm"></a>same height, so keep this set to ground.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Num Agent</strong></span>: This<a id="id140" class="indexterm"></a> is the number of agents (or AI characters) in the group. This can be a very high number as Fame is efficient, but for our demo, we will set this to 8.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Avatar</strong></span>: This<a id="id141" class="indexterm"></a> is the GameObject set to be the individual members of the crowd. For our demo, this is the ship model.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>FlockMemberScript</strong></span>: You <a id="id142" class="indexterm"></a>can create a custom script to define how the members of your crowd will act. For this demo, we will keep things simple and use Fame's default <code class="literal">FlockMemberScript.cs</code> script.</p></li></ul></div><p>The following screenshot shows our Fame <span class="strong"><strong>FlockGroup</strong></span> settings for the ship group:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_02.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec14"></a>Setting up a group</h3></div></div></div><p>Next, we <a id="id143" class="indexterm"></a>need to create the initial formation <a id="id144" class="indexterm"></a>we want our group to be in. With the <span class="strong"><strong>Ships</strong></span> GameObject selected, you will see three connected gizmos in the Unity 3D view that represent the shape of the initial group. Go to <span class="strong"><strong>Formation Shape</strong></span> in the <span class="strong"><strong>Inspector</strong></span> panel for <span class="strong"><strong>Ships</strong></span> and click on <span class="strong"><strong>Add Point</strong></span>. This creates a fourth point for the shape of the group. Arrange the points into a pyramid-like shape and click on <span class="strong"><strong>Create Avatars</strong></span>. A set of ships in a group will be created:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_03.jpg" /></div><p>This is our <a id="id145" class="indexterm"></a>group setup that shows the<a id="id146" class="indexterm"></a> control points that define the boundary for our group. You can see our ship group shape with eight ships has been created.</p><p>Creating a group object was really easy with Fame. Now, we need to set up a way for our crowd to move. We will have the ships move across the plane to a target point. Set the <span class="emphasis"><em>Z</em></span> scale of the plane to a larger value, create a sphere object to be our target position, and place it across the plane. The screen should look as follows:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_04.jpg" /></div><p>You can see a group of ships with a target placed.</p><p>When we send the group, or flock, the command to move to the target location, it will move the position of the flock to match it, which isn't necessarily the center of the flock. In this demo, the center of the flock is the upper-left corner from the camera view, which is why the target sphere is offset to the upper-left corner.</p><p>Now that<a id="id147" class="indexterm"></a> we have a target element in<a id="id148" class="indexterm"></a> the scene, we need to give Fame a command to move the group to it. Fame supports path following, but as most of the time we will want our groups to move dynamically, such as chasing a player, we will look at how to move the crowd by code. We have a lot of ways to set up a script to control the flock, but we'll take the simplest route and use a game manager. Create another empty GameObject and call it <span class="strong"><strong>GameManager</strong></span>. Then, create a new script, <code class="literal">GameManager.cs</code>, and attach it to the <span class="strong"><strong>GameManager</strong></span> object.</p><p>Add the following code to it:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class GameManager : MonoBehaviour {

  public Transform target;

  void Start () {

  }

  void Update () {
    FlockGroup group = FameManager.GetFlockGroup(1); // Get first flock

    group.MoveGroupAbs(target.position);
  }
}</pre></div><p>In this code, we have a public variable for the target for the flock. In the Unity editor, drag the <span class="strong"><strong>Sphere</strong></span> target object to this field to set its value. Then, in the update, we just get the flock group from Fame manager (which is a singleton class with static methods, so we don't need a reference to it). Then, we just use <code class="literal">MoveGroupAbs</code> that tells the group to move to a specific location. (There is also a method called <code class="literal">MoveGroup</code> that takes in an offset instead of an absolute position you can use if you want the crowd to move in a general direction instead of to a specific point.) If you run the demo now, the ships will travel down the ground to the target point. As you can see, setting up a crowd and giving directions <a id="id149" class="indexterm"></a>for it to move is <a id="id150" class="indexterm"></a>very easy and straightforward with Fame.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec15"></a>Adding obstacles to Fame</h3></div></div></div><p>Next, let's<a id="id151" class="indexterm"></a> add an obstacle inbetween <a id="id152" class="indexterm"></a>the ships and their target. Increase the size of the ground plane by increasing its <span class="emphasis"><em>X</em></span> scale. Then, add a cylinder to the middle of the scene to be an obstacle for the ships. To have this obstacle recognized by Fame, add the Fame obstacle script, <code class="literal">FameObstacle.cs</code>, to it. Fame allows two types of obstacles: round (circles) and 2D polygons. You specify the polygon ones, the same as we did for group shapes, by modifying control points. For our obstacle, we just need it to match the radius of the cylinder. In this example, the cylinder has a scale of <span class="strong"><strong>50</strong></span>, which makes its radius 25, so set the obstacle's <span class="strong"><strong>radius</strong></span> to <code class="literal">25</code>.</p><p>The demo should now look like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_05.jpg" /></div><p>This is the<a id="id153" class="indexterm"></a> obstacle setup for our ship group.</p><p>If you run the demo now, the ships will go to their target and smoothly avoid the obstacle. You can see in the next screenshot how the ships avoid our obstacle:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_06.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec16"></a>Adding vector fields to Fame</h3></div></div></div><p>We just<a id="id154" class="indexterm"></a> saw how to add obstacles <a id="id155" class="indexterm"></a>to our Fame crowd scene. Right now, all of our ships split when avoiding the cylinder, about half to the left and the other half to the right. However, we want all of them to move to the left. To do this, we can vector fields to the scene. Vector fields are a popular way of adding directional <span class="emphasis"><em>hints</em></span> to a scene, and they are defined areas that have directional vectors that are associated with them. When a character is inside the field, the vector helps move the character in the desired direction. Vector fields can be a powerful tool for level design and are easy to add to your scene. To see how easy it is to add them to the scene, add a new empty GameObject to the scene and name it <code class="literal">Field</code>. Then, attach the <code class="literal">FameField.cs</code> script from <code class="literal">Assets/Fame Assets/FameScripts</code> to it. The field can be rectangular, called <span class="strong"><strong>Uniform</strong></span> or <span class="strong"><strong>Circular</strong></span>. Select <span class="strong"><strong>Uniform</strong></span> for the type and set <span class="strong"><strong>x</strong></span> and <span class="strong"><strong>z widths</strong></span> to <span class="strong"><strong>75</strong></span>. Then, set the angle to <span class="strong"><strong>45</strong></span> and the magnitude to <span class="strong"><strong>100</strong></span>. The white arrow visualizes the angle for the vector field. Place the field over the initial positions for the ships, as shown:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_07.jpg" /></div><p>If you <a id="id156" class="indexterm"></a>run the demo now, ships will <a id="id157" class="indexterm"></a>all veer to the left before avoiding the cylinder. For larger levels, you can set up multiple vector fields; they are a good way to control the general movement of AI characters.</p><p>This Fame demo showed you the basics you'll need to create organized crowds for most games: creating crowds, giving them directions to move, and adding obstacles and vector fields. Next, we will look at another specialized AI plugin, ANT-Op. You can see the ship group changing its direction because of the vector field. You can also notice how our crowd uses the vector fields to direct ship movement to the left:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_05_08.jpg" /></div></div></div>