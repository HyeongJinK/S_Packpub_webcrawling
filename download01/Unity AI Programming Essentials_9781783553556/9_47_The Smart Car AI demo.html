<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec45"></a>The Smart Car AI demo</h2></div></div><hr /></div><p>Now, we'll <a id="id243" class="indexterm"></a>start setting up our driving demo that will have a car driving along a road and avoiding obstacles.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec24"></a>Setting up a Unity test scene</h3></div></div></div><p>Besides <a id="id244" class="indexterm"></a>needing Smart Car, we'll need an<a id="id245" class="indexterm"></a> environment for our AI cars to drive in. We'll use Car Tutorial v1.3 that is made by Unity, which you can download for free from the Asset Store. Import the project and open <span class="strong"><strong>TheTrack</strong></span> scene from the imported <code class="literal">Scenes</code> folder. Next, add a car to the scene. The car prefab that comes with Car Tutorial doesn't have the complete wheel physics setup, so you can configure it using the steps in the last section or use the <span class="strong"><strong>EnemyAICar</strong></span> prefab from Smart Car. To make the car work better with the <span class="strong"><strong>Tutorial</strong></span> scene, extend the rays a little, set <span class="strong"><strong>Wide</strong></span> and <span class="strong"><strong>Tight Ray Distance</strong></span> both to <code class="literal">40</code> and <span class="strong"><strong>Long Ray Distance</strong></span> to <code class="literal">50</code>. This keeps the car from hitting obstacles when going too fast and missing tight turns. Once you have a car in the scene configured for Smart Car, select the <span class="strong"><strong>Main_Camera</strong></span> object and set your car to <span class="strong"><strong>Target</strong></span> for the <span class="strong"><strong>Car Camera</strong></span> script.</p><p>If you start the demo now, the car still won't run but the main camera in the scene will follow it:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_09_02.jpg" /></div><p>This<a id="id246" class="indexterm"></a> screenshot is of the <span class="strong"><strong>Main_Camera</strong></span> game<a id="id247" class="indexterm"></a> object of Car Tutorial. These are the settings for the <span class="strong"><strong>TheTrack</strong></span> scene with <span class="strong"><strong>Target</strong></span> set to the Smart Car prefab.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>Another setting in the scene that can cause problems is the <code class="literal">TunnelSoundTrigger</code> Sound Toggler script. As it isn't important to use, select the <code class="literal">TunneISoundTrigger</code> script and remove that component to avoid errors later.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec25"></a>Using Unity's built-in NavMesh system</h3></div></div></div><p>The<a id="id248" class="indexterm"></a> next thing we need for our car<a id="id249" class="indexterm"></a> demo is a navigation mesh. Smart Car uses Unity's built-in system. Unity's system is similar to RAIN's but we haven't used it much yet as unlike other plugins, Unity does not have a built-in behavior tree system. Fortunately, we don't need behavior trees for our car demos, so navigate to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Navigation</strong></span>.</p><p>This brings up the <span class="strong"><strong>Navigation</strong></span> tab with three subtabs to help configure the NavMesh:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Object</strong></span>: This helps you filter what objects in the scene are part of the navigation <a id="id250" class="indexterm"></a>mesh. Any objects that are tagged with <span class="strong"><strong>Navigation Static</strong></span> will be included in the mesh<a id="id251" class="indexterm"></a> as a walkable area.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Bake</strong></span>: This <a id="id252" class="indexterm"></a>has options to bake the mesh. The two most important options are <span class="strong"><strong>Radius</strong></span> and <span class="strong"><strong>Height</strong></span>, which are dimensions for the character to navigate on the mesh.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Layers</strong></span>: This allows you to <a id="id253" class="indexterm"></a>customize the placement of different navigation meshes on different layers.</p></li></ul></div><p>For our <a id="id254" class="indexterm"></a>demo, we want only the roads<a id="id255" class="indexterm"></a> to be navigable. Select the other building and miscellaneous objects in the scene and set their static property (which is to the right of their name in <span class="strong"><strong>Inspector</strong></span>) to not have <span class="strong"><strong>Navigation Static</strong></span> set. Then, for the different road objects, such as <span class="strong"><strong>Road_Coll</strong></span>, <span class="strong"><strong>Road_Coll01</strong></span>, and so on, make sure that they have <span class="strong"><strong>Navigation Static</strong></span> checked. Then, go back to the <span class="strong"><strong>Navigation</strong></span> tab and click on <span class="strong"><strong>Bake</strong></span>. If you have everything set correctly after you bake, you should see the navigation mesh in the same area as the road:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_09_03.jpg" /></div><p>This is how the road navigation mesh setup should look.</p><p>This should have been pretty quick to recreate, but depending on the character size settings and the amount of geometry in the scene, this can take a bit of time. We will discuss navigation meshes more and the algorithm behind how they are generated in <a class="link" href="#" linkend="ch11">Chapter 11</a>, <span class="emphasis"><em>Advanced NavMesh Generation</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>
<span class="strong"><strong>NavMeshAgent</strong></span> is the built-in Unity component to create characters that move on a navigation mesh. Smart Car uses this internally. We won't be using this class <a id="id256" class="indexterm"></a>directly but you <a id="id257" class="indexterm"></a>can if you want to try more of Unity's<a id="id258" class="indexterm"></a> built-in navigation system; it is a good class to look at.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec26"></a>Setting up waypoints</h3></div></div></div><p>The final<a id="id259" class="indexterm"></a> step to get a car driving is to set up <a id="id260" class="indexterm"></a>waypoints for the car to follow. The NavMesh we created defines the area that the car can navigate to and the waypoints define the general path the car should follow. Create a new empty game object and name it <code class="literal">Road Waypoints</code>. Then, create a few more empties with the names <span class="strong"><strong>waypoint 1</strong></span>, <span class="strong"><strong>waypoint 2</strong></span>, <span class="strong"><strong>waypoint 3</strong></span>, and so on. Place the waypoint empties at different parts along the road. Note that the NavMesh for the road will define how to get from one waypoint to the next, so the line between waypoints doesn't have to go through the road. For instance, you could have one waypoint at the start of a curve and the second at the end and the car would still go around the curve through the waypoints. In the Smart AICar script, set the empties to the <span class="strong"><strong>Waypoints</strong></span> field. After doing this, the waypoints will be visualized in the edit or view to make adjusting their locations easier. Refer to the following screenshot, and you can see how the visualization of Smart car AI waypoints looks:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_09_04.jpg" /></div><p>If you <a id="id261" class="indexterm"></a>run the demo after setting the waypoints, the<a id="id262" class="indexterm"></a> car drives realistically across the road. If you want to fine-tune the car more, remember there are many physics settings with Smart Car that can be adjusted to change how the car acts.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec27"></a>Adding obstacles to driving</h3></div></div></div><p>As<a id="id263" class="indexterm"></a> Smart Car uses a combination<a id="id264" class="indexterm"></a> of a NavMesh and ray casting, you can add <a id="id265" class="indexterm"></a>objects dynamically to the scene, and as long as they have colliders attached (and are on a car's <span class="strong"><strong>Recast Layers</strong></span>), the car will avoid them. To try this out, add a few large cylinders to the road, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_09_05.jpg" /></div><p>Then, in<a id="id266" class="indexterm"></a> the <span class="strong"><strong>Recast Layers</strong></span> dropdown<a id="id267" class="indexterm"></a> for your car, make sure that it is set to ray cast on <a id="id268" class="indexterm"></a>the same layer as the obstacles. Select a <span class="strong"><strong>Cylinder</strong></span> object and in <span class="strong"><strong>Inspector</strong></span>, select <span class="strong"><strong>Add Layer</strong></span>. We need to create an obstacles layer, so select the dropdown and in the first slot for <span class="strong"><strong>User Layer</strong></span>, set it to <span class="strong"><strong>obstacles</strong></span>.</p><p>Then, for each cylinder, set its layer to <span class="strong"><strong>obstacles</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_09_06.jpg" /></div><p>This is how the <span class="strong"><strong>Inspector</strong></span> window should look after creating the obstacle layer.</p><p>Then, for <a id="id269" class="indexterm"></a>Smart Car in the <span class="strong"><strong>Raycast Layers</strong></span> dropdown, make<a id="id270" class="indexterm"></a> sure that the <span class="strong"><strong>obstacles</strong></span> layer<a id="id271" class="indexterm"></a> is selected. Once you have this set up, if you run the demo, the car will drive and avoid the obstacles. The car still uses physics for its control, and sometimes if you place the obstacles too close to one another, the car will run into one. Fortunately, in this case, the car will back up and then drive past it, which is a nice touch Smart Car has.</p><p>The cylinders are static objects in our scene, but as ray casting is used, there is no reason why you cannot script dynamic objects and the car will still avoid them. To see this, run the demo and in the scene view, grab one of the obstacles and move it around to block the car; the car will try to avoid it.</p></div></div>