<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec39"></a>The chase and attack demo</h2></div></div><hr /></div><p>In the<a id="id227" class="indexterm"></a> first demo, we will build an enemy ship that senses for the player, and if it sees the player, it starts moving toward it and then attacks it. A simple version of this would be to have the enemy wander with a visual sensor to detect the player, and if it sees the player, the enemy will move toward it and attack it. This would work but it really wouldn't be any different from the demo from <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>Adaptation</em></span>, where the ship had to search for and collect gold. To make it a little different, we'll use a two-sensor approach. We will have one larger sensor on the enemy that detects the player, and if the enemy senses the player aspect, it will start chasing the player. Then, there is a second smaller sensor that attacks the player, that is, if it senses the player, then the enemy stops chasing and it instead attacks. This gives the effect of chasing the player but when the enemy gets closer, it stops and starts attacking, instead of just chasing and attacking at the same time.</p><p>To begin setting these up, go to the <span class="strong"><strong>Perception</strong></span> tab on the enemy AI rig (the little eye icon tab) and add a visual sensor called <code class="literal">ChaseSensor</code>. This should be pretty large and cover most of the scene. Then, add a second visual sensor and call it <code class="literal">AttackSensor</code>. Make this one about a third the size of <code class="literal">ChaseSensor</code>. The setup should look something like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_08_04.jpg" /></div><p>The preceding screenshot shows our enemy setup with two sensors: one will be used to chase and the smaller one will be used to attack.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>Using multiple sensors of the same type is a powerful tool to have AI characters react to things differently based on how far away they are.</p></div><p>Now we<a id="id228" class="indexterm"></a> have our sensor, we can work on the behavior tree for the enemy. Select the <span class="strong"><strong>Mind</strong></span> tab of the enemy AI rig and open the behavior editor. Create a new behavior tree called <span class="strong"><strong>ChaseAndAttack</strong></span>. The enemy will detect and chase or attack the player at the same time, so right-click on the <span class="strong"><strong>root</strong></span> node and change its type to <span class="strong"><strong>Parallel</strong></span>. Then, add two detect nodes, one for the chase sensor and one for the attack sensor. For the chase detect node, set <span class="strong"><strong>Sensor</strong></span> to <span class="strong"><strong>"ChaseSensor"</strong></span>, <span class="strong"><strong>Aspect</strong></span> to <span class="strong"><strong>"player"</strong></span>, and the form variable to <code class="literal">playerChase</code> (remember to watch out for the quotes). For the attack sensor, set <span class="strong"><strong>Sensor</strong></span> to <span class="strong"><strong>"AttackSensor"</strong></span>, <span class="strong"><strong>Aspect</strong></span> also to <span class="strong"><strong>"player"</strong></span>, and the form variable to <code class="literal">playerAttack</code>. Then, add a constraint node, which will go off if either of the sensors has found something, so set its constraint to <span class="strong"><strong>playerChase != null || playerAttack != null</strong></span>. Then, add a <span class="strong"><strong>selector</strong></span> node under the <span class="strong"><strong>constraint</strong></span> node that will handle the attack and chase logic. The multiple visual sensors behavior tree should look like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_08_05.jpg" /></div><p>Remember the <span class="strong"><strong>selector</strong></span> node will continue to run its children until one succeeds, so first we will check for attack. If <code class="literal">playerAttack</code> has a value (that is, it is not null), we will set <code class="literal">isAttacking</code> to true, and if not, set it to false. Add a <span class="strong"><strong>constraint</strong></span> node under the <span class="strong"><strong>selector</strong></span> that checks for attacks and set its constraint to <span class="strong"><strong>playerAttack != null</strong></span>. As the <code class="literal">playerAttack</code> variable is not null, add an <span class="strong"><strong>expression</strong></span> node to start attacking with an expression value of <code class="literal">isAttacking</code>, which is equal to true.</p><p>Then, if <code class="literal">playerAttack</code> is null, we want the attack to stop, so add another expression with <code class="literal">isAttacking</code>, which is equal to false. The attack setup on our enemy behavior tree should look like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_08_06.jpg" /></div><p>If you run <a id="id229" class="indexterm"></a>the demo now, when the player gets sensed by <code class="literal">AttackSensor</code>, the enemy will start attacking and stop when the player is out of range.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>Our attack behavior here is very simple; we are just flashing the ship. However, there's no reason why you couldn't add additional attack nodes and states to make the behavior more realistic.</p></div><p>Finally, we need to have the enemy chase the player if it is not attacking, so add a custom node called <code class="literal">Chase</code> to the bottom of the selector. Create a <code class="literal">Chase</code> script for it and set the <code class="literal">Chase</code> code to the following:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_08_07.jpg" /></div><p>This<a id="id230" class="indexterm"></a> code first finds the <code class="literal">player</code> GameObject and then just moves to the player's position. This is unlike the code in the demos in <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>Adaptation</em></span>, where we did a check to stop moving if the character gets very close to the moving target. When the character gets close to the target, it will stop moving and start attacking, so we don't need checks. If you run the demo now, the enemy will chase the player and start attacking:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_08_08.jpg" /></div><p>The <a id="id231" class="indexterm"></a>preceding screenshot shows how an enemy attacking the player will look at the end.</p></div>