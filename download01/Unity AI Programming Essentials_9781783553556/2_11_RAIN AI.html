<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec16"></a>RAIN AI</h2></div></div><hr /></div><p>RAIN has <a id="id42" class="indexterm"></a>this section put together pretty well. In reality, we only have one small section to change from the pathfinding demo, especially because the pathfinding demo had actually turned off the patrol feature.</p><p>Start with the project for RAIN AI from <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Pathfinding</em></span>. From the menu, navigate to <span class="strong"><strong>RAIN</strong></span> | <span class="strong"><strong>Behavior Tree Editor</strong></span>. From the editor, select <span class="strong"><strong>FollowGreenRoad</strong></span>. Under <span class="strong"><strong>Sequence</strong></span> is a patrol route node called <span class="strong"><strong>waypointpatrol</strong></span>; select it. Finally, we have a property called <span class="strong"><strong>Loop Type</strong></span>. Presently, it is on <span class="strong"><strong>One</strong></span> <span class="strong"><strong>Way</strong></span>, which stops at the last waypoint. You can switch it to <span class="strong"><strong>Ping</strong></span> <span class="strong"><strong>Pong</strong></span> or <span class="strong"><strong>Loop</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_05.jpg" /></div><p>
<span class="strong"><strong>Ping Pong</strong></span> bounces you back and forth on the path, while <span class="strong"><strong>Loop</strong></span> connects the last waypoint to the first to start over.</p><p>This works when creating a typical patrolling behavior, where a character loops along a path. However, what if we want to have a character patrol an area by walking around back and forth to different points without always following the same route? In RAIN AI, we can do this by using a waypoint network instead of a waypoint graph and updating our behavior tree to randomly pick different points in the level to go to.</p><p>To illustrate this, create a new scene, and like in our current patrol example, add a character and some blocks and create a navigation mesh. Separate the blocks a bit so that we can add different paths in between them. You can refer to the next screenshot to view this setup:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_06.jpg" /></div><p>In this<a id="id43" class="indexterm"></a> demo, we will have the character walk to different points outside the walls, but when patrolling, the character won't go in a circle outside the walls; instead, it will always walk through the middle. To do this, we will need a waypoint network similar to the one shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_07.jpg" /></div><p>To add a waypoint, navigate to <span class="strong"><strong>RAIN</strong></span> | <span class="strong"><strong>Create Waypoint Network</strong></span>. Then, set up the network similar to how you set up a waypoint route, by creating different points. However, unlike a waypoint route, with a waypoint network you can also connect different points. To connect two waypoints, select them by pressing <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> and left-clicking the mouse and then click on <span class="strong"><strong>Connect</strong></span> in the <span class="strong"><strong>RAIN Waypoint Network</strong></span> component menu. Connect the points in a <span class="emphasis"><em>plus sign</em></span> shape as illustrated in the previous screenshot. With this network, to walk from the side of one wall to another, the character will always need to walk through the middle of the scene.</p><p>The network <a id="id44" class="indexterm"></a>waypoint describes how a character should walk to different spots on a level, but it actually doesn't contain the different points we can tell the AI character to go to. If we want to tell our character to go to a specific location, we need what RAIN calls a navigation target. A navigation target is just an object that contains a point in the scene that we can use with the rest of the AI system. You can create navigation targets by navigating to <span class="strong"><strong>RAIN</strong></span> |<span class="strong"><strong> Create Navigation Target</strong></span> and place them like you would place a waypoint. Create three navigation targets and place them on the side of three walls. We will follow a convention used in other RAIN examples and name the navigation targets <code class="literal">Location1</code>, <code class="literal">Location2</code>, and <code class="literal">Location3</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_08_1.jpg" /></div><p>The Inspector panel should look like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_08_2.jpg" /></div><p>This is all of the scene setup that we need to specify routes and locations for the character to walk. However, we will need to customize the behavior tree to randomly choose different points to patrol to.</p><p>Create a new behavior tree for our character and call it <code class="literal">Patrol</code>. Open the behavior tree editor, and below the new root node, create a <span class="strong"><strong>Random</strong></span> node by right-clicking on the root and navigating to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Decisions</strong></span> | <span class="strong"><strong>Random</strong></span>. This creates a node that randomly selects one of its children to execute. Don't worry too much about how the different nodes work in the RAIN behavior tree for now; we will go into more detail about them in the next chapter. For now, create three expression nodes as children of the <span class="strong"><strong>Random</strong></span> node by right-clicking on <span class="strong"><strong>Random</strong></span> and navigating to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Actions</strong></span> | <span class="strong"><strong>Expression</strong></span>. An expression node allows us to execute a single statement, which is called an expression in RAIN. Rename<a id="id45" class="indexterm"></a> the expression nodes <code class="literal">Choose Location 1</code>, <code class="literal">Choose Location 2</code>, <code class="literal">Choose Location 3</code>. Then, in the expression field for the nodes, set the first to <code class="literal">location = navigationtarget(Location1)</code>, and do the same for the other location expression nodes, using numbers 2 and 3. These expression nodes create a variable location that is a randomly determined navigation target that we can use as a target to walk to. The setup should look like this:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_09.jpg" /></div><p>All that is left is to add nodes to walk to the target. Right-click on the root node and navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Decisions</strong></span> | <span class="strong"><strong>Waypoint Path</strong></span> (not waypoint patrol like last time). In the waypoint path node, set the <span class="strong"><strong>Waypoint Network</strong></span> field to <code class="literal">PatrolNetwork</code> (with quotes) to tell it which network to use. Set the <span class="strong"><strong>Path Target</strong></span> field to location (without quotes), which is the variable we stored our random target to walk to. Finally, set up the rest of the tree as shown earlier, with an animation node and a child <code class="literal">Move</code> node. The final setup should look as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553556/graphics/3556OT_02_10.jpg" /></div><p>If you run the <a id="id46" class="indexterm"></a>project now, the character will randomly patrol the area of the level by randomly walking from one navigation target location to the next and always walking through the middle of the level.</p></div>