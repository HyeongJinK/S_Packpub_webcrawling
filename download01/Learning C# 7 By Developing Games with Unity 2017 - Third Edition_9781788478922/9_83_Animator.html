<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec82"></a>Animator</h2></div></div><hr /></div><p>Another important topic in this book is how to animate our character. Certain animations will be played on the character for specific events. Unity has a really clever system already built in for controlling animation: <span class="strong"><strong>Mecanim</strong></span>. We won't go into too much detail about animating stuff in Unity. All I want you to know is that I have prepared the following animation clips for you:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Idle</strong></span>: This is played when the player is not moving (holding position)</li><li style="list-style-type: disc"><span class="strong"><strong>Run</strong></span>: This is played when the player is grounded and alive</li><li style="list-style-type: disc"><span class="strong"><strong>Jump</strong></span>: This is played during a jump</li><li style="list-style-type: disc"><span class="strong"><strong>Dead</strong></span>: This is played when the player hits an obstacle and dies</li></ul></div><p>To preview how animation clips are connected, open the <strong class="userinput"><code>Animator</code></strong> view by going to <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Animator</code></strong> and selecting the <strong class="userinput"><code>Player</code></strong> game object from the hierarchy:</p><div class="mediaobject"><img src="/graphics/9781788478922/graphics/f1cde11f-c9a9-4ae5-acc2-30eb2a23ac6a.png" /></div><p>This is an <strong class="userinput"><code>Animator</code></strong> view. As we want to focus on programming in this book, we won't discuss the details here. All I want you to notice is the <strong class="userinput"><code>Parameters</code></strong> tab and two <code class="literal">bool</code> type parameters we have already set up. To control animations of Jake, we just need to make sure the <code class="literal">IsGrounded</code> and <code class="literal">isAlive</code> bools are set to the correct values. We will do that from our <code class="literal">PlayerController</code> script.</p><p>The first step is to access the <strong class="userinput"><code>Animator</code></strong> component in the code. We already learned about the <code class="literal">GetComponent</code> method of Unity. This time, I want to talk about another way to gain easy access to certain components. Add the following line to your code just after the line that declares the <code class="literal">rigidBody</code> variable:</p><pre class="programlisting">public Animator animator; </pre><p>Save the script, select the <strong class="userinput"><code>Player</code></strong> game object, and look at the <strong class="userinput"><code>Inspector</code></strong> panel. We just created a new public member of the <strong class="userinput"><code>Animator</code></strong> type and called it <code class="literal">animator</code>. The <strong class="userinput"><code>Animator</code></strong> field will appear in the <strong class="userinput"><code>Inspector</code></strong> window. The next step is to assign this variable. Have a look at the hierarchy. There is a child object of the <strong class="userinput"><code>Player</code></strong> game object, called <code class="literal">sprite</code>, we have the <strong class="userinput"><code>Animator</code></strong> component on. Simply drag the <code class="literal">sprite</code> game object from the hierarchy on top of the <strong class="userinput"><code>None (Animator)</code></strong> field. Unity will automatically recognize that you are trying to assign <strong class="userinput"><code>Animator</code></strong> from the <code class="literal">sprite</code> game object to the <code class="literal">Animator</code> variable:</p><div class="mediaobject"><img src="/graphics/9781788478922/graphics/836be0ba-c8a7-4823-9377-e03bc7a7f421.png" /></div><p>After a correct assignment, the <strong class="userinput"><code>Inspector</code></strong> window will look like the preceding screenshot. Now, we have really easy access to the <strong class="userinput"><code>Animator</code></strong> component through the <code class="literal">animator</code> variable within the <code class="literal">PlayerController</code> script. Let's put that to use. First, set the <code class="literal">isAlive</code> animator parameter to <code class="literal">true</code>, as we want Jake to be happy at the start. Add the <code class="literal">Start</code> method in <code class="literal">PlayerController</code> with the following line:</p><pre class="programlisting">void Start() { 
  animator.SetBool("isAlive", true); </pre><p>At the end of the <code class="literal">Update</code> method, insert this line to set the <code class="literal">IsGrounded</code> animator parameter:</p><pre class="programlisting">animator.SetBool("isGrounded", IsGrounded()); </pre><p>Save the code and press <strong class="userinput"><code>Play</code></strong> in Unity. Jake should be set to the alive state at the start and change his face a little during the jumps. This is cool, isn't it?</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec60"></a>Running</h3></div></div></div><p>Jake is very much alive now–smiling, jumping, and running... in the same place. The next task is to make him run forward. You probably know how we are going to approach this. We can add a constant force forward. Add a <code class="literal">runningSpeed</code> float public variable to the <code class="literal">PlayerController</code> class:</p><pre class="programlisting">publicfloat runningSpeed = 1.5f; </pre><p>Also, add the following method to apply the force:</p><div class="mediaobject"><img src="/graphics/9781788478922/graphics/0523d769-e5bd-4721-a79a-6b804af79f9e.png" /></div><p>The <code class="literal">FixedUpdate</code> method is called automatically in Unity after a fixed time interval; it is not like the <code class="literal">Update</code> method, which is called every frame.</p><p><code class="literal">FixedUpdate</code> is the best place to add constant forces to your physics. If you wish to learn more about the <code class="literal">FixedUpdate</code> method, dive into Unity's documentation. For now, all you need to understand is that this method is called all the time, and you do not need to call this yourself. In line <strong class="userinput"><code>34</code></strong>, we are applying a <code class="literal">Vector2</code> velocity to the <code class="literal">rigidbody</code>. The new <code class="literal">Vector2</code> is a simple C# constructor, and we are passing the <code class="literal">x</code> and <code class="literal">y</code> values in brackets. Our character is moving from left to right, so we are applying a force with <code class="literal">x</code> equal to the running speed and leaving velocity <code class="literal">y</code> unchanged.</p><p>Line <span class="strong"><strong>31</strong></span> prevents constant acceleration. We are only applying force if the <code class="literal">x</code> velocity is lower than the running speed. In other words, if the character's speed is slower than the running speed, push him forward.</p><p>Go ahead, save your script and press <strong class="userinput"><code>Play</code></strong> in Unity. You will see Jake is moving forward now. We have implemented the running and jumping functionalities. I think we can easily call it our first gameplay! As you have probably noticed, Jake will run forward until he falls off the platform and will be falling forever until you restart. We are missing a game over event here. In the next chapter, we will write the <code class="literal">GameManager</code> class to help us clamp the whole game functionality together.</p></div></div>