<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch13lvl1sec110"></a>High score and persisting data</h2></div></div><hr /></div><p>Pretty much every <a id="id422" class="indexterm"></a>game has some sort of scoring system. You will now learn how to write simple code that calculates the score based on the distance the Player has traveled since the start of the level. We will then use this score value and store it in Unity <code class="literal">PlayerPrefs</code> to make sure that the value is remembered between sessions. <code class="literal">PlayerPrefs</code> is a very useful built-in Unity class that allows us to store and access data between Unity sessions.</p><p>Let's write the following method in the <code class="literal">Player</code> class:</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_13_09.jpg" /></div><p>We have finally come to a real-life example of a method that returns something. As you can see, the <code class="literal">GetDistance()</code> method returns a float valueâ€”the distance between the starting point and the current position of the player game object.</p><p>I won't go too much into the detai here. I encourage you to dive into the Unity <span class="strong"><strong>Scripting Reference</strong></span> and search for <code class="literal">Vector2.Distance</code> to understand exactly how it works.</p><p>Having the <code class="literal">GetDistance()</code> method working, we can now call it from any place in the code and get the accurate distance traveled by the <code class="literal">Player</code> game object. The value returned by this method will <a id="id423" class="indexterm"></a>be used directly as the player's score. Now is a good time to connect the score UI label directly to the <code class="literal">GetDistance()</code> method.</p><p>In the <code class="literal">ViewInGame</code> class, we declare the <code class="literal">scoreLabel Text</code> variable and add a new line to the <code class="literal">Update()</code> method just above the line where we are assigning the coin label.</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_13_10.jpg" /></div><p>Notice line <span class="strong"><strong>12</strong></span>. We are assigning the <code class="literal">scoreLabel.text</code> value by taking it directly from the float value returned from the <code class="literal">PlayerController.instance.GetDistance()</code> method. I hope this is not confusing! If it is, please remember what we said in the very early chapters of this book. A function can be the substitute for a value. In this case, when we are calling <code class="literal">GetInstance()</code>, we are getting back an <code class="literal">int</code> number straightaway. All we need to do is convert that float into a string. To do this, we use the <code class="literal">ToString()</code> function right away.</p><p>You are probably wondering, "What is the magical <code class="literal">f0</code> parameter that we are passing in <code class="literal">ToString("f0")</code>?" It describes how we want our string to be formatted. In this case, we just want a whole number, without any decimals. I encourage you to read more online about C# <code class="literal">ToString()</code> formatting.</p><p>The last thing to do is connect <a id="id424" class="indexterm"></a>the <code class="literal">scoreLabel</code> variable with the actual <code class="literal">scoreLabel</code> game object in the <span class="strong"><strong>Hierarchy</strong></span> view. When you are ready, click on <span class="strong"><strong>Play</strong></span> in Unity. The score label in the top-left corner will be showing the correct score value. Great job!</p><p>What you just learned is how to convert a float value to a string and display the value in the UI for the user.</p><p>We are getting close to finish writing the functionality for the <code class="literal">inGameView</code>. We will now work on persisting data. What does this mean? We want the user's high score to be remembered between game sessions. So, if the user closes the game and then opens it again, their high score will not be reset to zero. Rather, will remember their best score.</p><p>Unity does have an easy-to-use system for this. Let's jump into the scripting reference and search for <code class="literal">PlayerPrefs</code>.</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_13_11.jpg" /></div><p>The preceding screenshot <a id="id425" class="indexterm"></a>has been taken from <a class="ulink" href="http://docs.unity3d.com/ScriptReference/PlayerPrefs.html" target="_blank">http://docs.unity3d.com/ScriptReference/PlayerPrefs.html</a>. Let's take a look at the list of static functions again, specifically at the <code class="literal">SetFloat</code> and <code class="literal">GetFloat</code> functions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">SetFloat(string key, float value)</code>: This sets the value of the preference identified by the key.</p></li><li style="list-style-type: disc"><p>
<code class="literal">public static float GetFloat(string key, float defaultValue = 0.0F)</code>: This returns the value corresponding to the key in the preference file, if it exists. If it doesn't exist, it will return <code class="literal">defaultValue</code>.</p></li></ul></div><p>In simple words, we can ask Unity to save the float value accessible under the string key. Let's jump straight into our code. Open the <code class="literal">PlayerController</code> script and add the high-score-saving code.</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_13_12.jpg" /></div><p>What are we doing here? At the moment when the player is killed, we check whether the current distance traveled is greater than the float value stored under the high score key in <code class="literal">Player</code> prefs. If the distance is greater, it means the user has achieved a new high score, so Unity proceeds to line <span class="strong"><strong>79</strong></span> and overrides the value in <code class="literal">PlayerPrefs</code>. Saving done!</p><p>Now, we need to make sure that <code class="literal">highscoreLabel</code> is displaying the correct value all the time. Yet again, add a new <a id="id426" class="indexterm"></a>
<code class="literal">Text</code> type variable, call it <code class="literal">highscoreLabel</code> this time, and add a line to the <code class="literal">Update</code> function.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"></a>Note</h3><p>Make sure that all public member slots are connected to the correct game objects to avoid <span class="emphasis"><em>Null Reference Exceptions</em></span>.</p></div><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_13_13.jpg" /></div><p>Our high score should work now. Play a game. Let the character die, restart the game, and see whether the value is <a id="id427" class="indexterm"></a>displayed in the-top right corner.</p></div>