<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec79"></a>User input</h2></div></div><hr /></div><p>The first and relatively <a id="id298" class="indexterm"></a>simple functionality we can add is the ability to jump. We already have basic physics with gravity working on the <span class="strong"><strong>Player</strong></span> game object. Before we can make our <span class="strong"><strong>Player</strong></span> game object jump, we need to know when this should happen. The user always needs some sort of interface in order to interact with the game. On the PC and Mac, in most of cases, it will be the mouse or keyboard. On mobile devices, it will be the touchscreen.</p><p>Unity gives us a lot of <span class="emphasis"><em>out-of-the-box</em></span> functions we can call to check whether user is trying to interact through any input.</p><p>As we are writing a standalone game, I think it best if we stick to the mouse control.</p><p>Please open the Unity <span class="strong"><strong>Scripting Reference</strong></span> and search for <code class="literal">Input</code>. You can have a read through the documentation on the <code class="literal">Input</code> class of jump straight to the <code class="literal">Input.GetMouseButtonDown</code> public method. Read it thoroughly.</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_7.jpg" /></div><p>
<code class="literal">Input.GetMouseButtonDown</code> returns <code class="literal">true</code> during the frame when the user pressed the given mouse button. According to the documentation, it's best if we call <code class="literal">Input.GetMouseButtonDown</code> inside the <code class="literal">Update</code> function. Let's write some code to test how it works:</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_8.jpg" /></div><p>Let's analyze the <a id="id299" class="indexterm"></a>code:</p><p>In line <span class="strong"><strong>14</strong></span> <code class="literal">Input.GetMouseButtonDown(0)</code> returns the <code class="literal">bool</code> value so we can use it in the <code class="literal">if</code> statement directly.</p><div class="informalexample"><pre class="programlisting">if(Input.GetMouseButtonDown(0))</pre></div><p>This is in fact exactly same as the next line:</p><div class="informalexample"><pre class="programlisting">if(Input.GetMouseButtonDown(0) == true)</pre></div><p>Line <span class="strong"><strong>14</strong></span> is executed in every frame over and over again when Unity is in <span class="strong"><strong>Play</strong></span> mode. If the user clicks on the left mouse button, the <code class="literal">if</code> statement value in line <span class="strong"><strong>14</strong></span> will be true in that frame and Unity will execute everything within the <code class="literal">if</code> statement code block. Complicated? If so, I'll try again.</p><p>If the user clicks on the left mouse button, <code class="literal">Debug.Log("Left mouse button clicked!")</code> will execute and a message will be displayed in the <span class="strong"><strong>Console</strong></span> window. Go ahead, save the file and press <span class="strong"><strong>Play</strong></span> in Unity. Click on the left mouse button on the <span class="strong"><strong>Game</strong></span> window. You will see the <span class="strong"><strong>Console</strong></span> populating message every time you click. We can handle the user input now and tell Jake to jump when the user wants it.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec62"></a>Jump</h3></div></div></div><p>I will be sending you to the <a id="id300" class="indexterm"></a>Unity <span class="emphasis"><em>Scripting documentation</em></span> many times now to make sure you understand the code before we use it and to learn that it is always a good practice to investigate the documentation if you see something new. Nobody would ever expect you to remember the entire Unity documentation, so it's good to learn how to find stuff you need.</p><p>Search <code class="literal">scripting reference for Rigidbody2D.AddForce</code>. This is the way we will apply force on Jake. Let's add more code to <code class="literal">PlayerController</code> so it looks more or less like this:</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_9.jpg" /></div><p>Lots of new code! Let's go through each new line we have added.</p><p>Line <span class="strong"><strong>6</strong></span> should be very easy to understand for you now. It declares the <code class="literal">float</code> type variable <code class="literal">jumpForce</code>. In lines <span class="strong"><strong>7</strong></span> and <span class="strong"><strong>10</strong></span>, we will be controlling the character physics in the <code class="literal">PlayerController</code> script, so we need easy access to the <code class="literal">RigidBody2D</code> component on the same game object.</p><p>Have a look in the <span class="strong"><strong>Scripting Reference</strong></span> for <code class="literal">GameObject.GetComponent</code>. It searches the game object our <code class="literal">PlayerController</code> is attached to for the <code class="literal">Rigidbody2D</code> component and returns it so we can assign the <code class="literal">rigidBody</code> private variable for easy access. <code class="literal">GetComponent</code> must be called at runtime, so we are calling it in the <code class="literal">Awake</code> function. After line <span class="strong"><strong>10</strong></span>, we can simply say <code class="literal">rigidBody</code>. The <code class="literal">RigidBody2D</code> component will be called on <code class="literal">playerGameObject</code>.</p><p>See how simple the <code class="literal">Jump</code> function is. It's just a simple line saying, "Hey RigidBody, apply force with the direction up with this jump force." There are a few force modes we can use for other useful stuff; however, impulse make sense for jumping. We just want to kick the character up and then let him fall back to the ground.</p><p>Go ahead, press <span class="strong"><strong>Play</strong></span> in Unity <a id="id301" class="indexterm"></a>and then click on the left mouse button a few times in the game view. Hey! Jake is actually jumping but something is wrong. We need him to jump higher. Experiment with the jump force in the inspector to find the right value. I think value <code class="literal">25</code> looks good for the jump height. It's not too high and not too low.</p><p>You probably noticed already we have another issue. We are applying the jump force every time the left mouse button is clicked. This is good. However, Jake should not jump in the air. If you click on the left mouse button many times quickly, he'll simply fly away. We can fix that by adding bit more code. The right behavior will be to only jump when the character is on the ground.</p><p>Lets add the following code and edit the Jump method a little:</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_10.jpg" /></div><p>I will make a little exception from the rule; I won't analyze this code from top to bottom. I want to talk about the <code class="literal">IsGrounded</code> function. In programming and math in general, there isn't any simple way of asking <a id="id302" class="indexterm"></a>the computer if the character is on the ground or in the air. Game developers must turn complex ideas and into simple programmable parts. Let's not talk about the <code class="literal">IsGrounded</code> method yet. Let's focus on line <span class="strong"><strong>31</strong></span>.</p><p>Search the scripting reference for <code class="literal">Physics2D.Raycast</code> and have a read through. You should see that raycast is casting a ray against colliders in the scene. It does sound very complicated. Trust me, it isn't. It will all be clear to you in few minutes. Raycast? What is the mystery about raycast? The simplest real-life example for raycast would be a laser pointer. Imagine you are holding the laser pointer and pointing at the floor. This is exactly what are we doing in line <span class="strong"><strong>31</strong></span>. We are basically saying "Hey Unity, shoot the laser down from this <code class="literal">GameObject</code> position and check whether the distance to hit any object on the ground layer is less than 0.2."</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_11.jpg" /></div><p>Have a look at this picture. The green point represents the origin of the ray we are virtually casting. The blue point is the hit point. The ray distance would be the distance between the origin and the hit point. In this case, we are casting the ray down to a maximum distance of 0.2. I have visualized that distance with a yellow line. Looking back at <code class="literal">IsGroundedMethod()</code>, we can <a id="id303" class="indexterm"></a>see that the method is returning true if the raycast hit happens within a distance of 0.2 or less; otherwise, we return false.</p><p>I hope this is fairly clear to you now. Let's look at the parameters in the actual <code class="literal">Raycast</code> function again. <code class="literal">Physics2D.Raycast</code> has lots of different overloads, which means we can pass a few sets of parameters to the method. In this case, we are using an overload with four parameters:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">Origin</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">Direction</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">Distance</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">layerMask</code>
</p></li></ul></div><p>You can preview the names and <a id="id304" class="indexterm"></a>types of the parameters if you hover your mouse for a new seconds above the <code class="literal">Raycast</code> word in the code:</p><p>.</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_12.jpg" /></div><p>
</p><p>We have already covered <code class="literal">origin</code>, <code class="literal">direction</code>, and <code class="literal">distance</code>. Let's talk briefly about <code class="literal">layerMask</code>. We can specify a filter here to detect colliders only on certain layers. This means we can set Unity to make raycast work only on specific layers. In this case, we are simply checking if <span class="strong"><strong>Player</strong></span> is grounded or not. So, the wise thing to do is to set raycast to work only with objects on the ground layer.</p><p>To make sure everything works as it should, we must create the ground layer.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In Unity, navigate to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Tags and Layers</strong></span>.</p></li><li><p>In the Inspector, write <code class="literal">Ground</code> next to <span class="strong"><strong>User Layer 8</strong></span>.</p></li><li><p>Select the <code class="literal">FloorShort</code> game object in the hierarchy and set its layer to <span class="strong"><strong>Ground</strong></span>. Set it up as shown here:</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_14.jpg" /></div></li><li><p>We have the <span class="strong"><strong>Ground </strong></span>
<a id="id305" class="indexterm"></a>
<span class="strong"><strong>Layer</strong></span> set up. Set up the layer mask on the <span class="strong"><strong>Player</strong></span> game object now. If you save the <span class="strong"><strong>Player</strong></span> script, you will notice a new public member variable has appeared:</p><div class="mediaobject"><img src="/graphics/9781785287596/graphics/B04245_09_13.jpg" /></div></li><li><p>Press <span class="strong"><strong>Play</strong></span> in Unity and perform a test jump. If everything is done correctly, jumping will work only when Jake is on the ground. We check if Jake is on the ground in line <span class="strong"><strong>22</strong></span>. If the <code class="literal">IsGrounded()</code> method returns true, the <code class="literal">Jump</code> method is called; otherwise, we simply ignore the user click.</p></li></ol></div></div></div>