<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec20"></a>Sprite animation</h2></div></div><hr /></div><p>Besides the 2D sprite system, Unity has created and updated their animation to handle 2D. With a greatly<a id="id212" class="indexterm"></a> enhanced dope sheet animation/clip controller and full integration with the Mecanim state management system, there is a boundless world of choices available that are easy to use once you get to grips with them.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec26"></a>Animation components</h3></div></div></div><p>All of the animation in<a id="id213" class="indexterm"></a> the new 2D system in Unity uses the new Mecanim system (introduced in Version 4) for design and control, which once you get used to is very simple and easy to use.</p><p>It is broken up into three main parts: animation controllers, animation clips, and animator components.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec24"></a>Animation controllers</h4></div></div></div><p><span class="strong"><strong>Animation controllers</strong></span><a id="id214" class="indexterm"></a> are simply state machines that are used to control when an animation should be played and how often, including <a id="id215" class="indexterm"></a>what conditions control the transition between each state. In the new 2D system, there must be at least one controller per animation for it to play, and controllers can contain many animations as you can see here with three states and transition lines between them:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_01.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec25"></a>Animation clips</h4></div></div></div><p><span class="strong"><strong>Animation clips</strong></span> are the<a id="id216" class="indexterm"></a> heart of the animation system<a id="id217" class="indexterm"></a> and have come very far from their previous implementation in Unity. Clips were used just to hold the crafted animations of the 3D models with a limited ability to tweak them for use on a complete 3D model:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_02.jpg" /></div><p>The new animation dope sheet system (as shown in the preceding screenshot) is very advanced; in fact, now it tracks almost every change in the inspector for sprites, allowing you to animate just about everything. You can even control which sprite from a spritesheet is used for each frame of the animation.</p><p>The preceding<a id="id218" class="indexterm"></a> screenshot shows a three-frame sprite animation and a modified <span class="strong"><strong>x</strong></span> position modifier for the middle image, giving a hopping effect<a id="id219" class="indexterm"></a> to the sprite as it runs. This ability of the dope sheet system implies there is less burden on the shoulders of art designers to craft complex animations as the animation system itself can be used to produce a great effect.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip12"></a>Tip</h3><p>Sprites don't have to be picked from the same spritesheet to be animated. They can come from individual textures or picked from any spritesheet you have imported.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec26"></a>The Animator component</h4></div></div></div><p>To use the new animation<a id="id220" class="indexterm"></a> prepared in a<a id="id221" class="indexterm"></a> controller, you need to apply it to a game object in the scene. This is done through the <span class="strong"><strong>Animator</strong></span> component, as shown here:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_27.jpg" /></div><p>The only property we actually care about in 2D is the<a id="id222" class="indexterm"></a> <span class="strong"><strong>Controller</strong></span> property. This is where we attach the controller we just created.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note21"></a>Note</h3><p>Other properties only apply to the 3D humanoid models, so we can ignore them for 2D. For more information about the complete 3D Mecanim system<a id="id223" class="indexterm"></a>, refer to the Unity Learn guide at <a class="ulink" href="http://unity3d.com/learn/tutorials/modules/beginner/animation" target="_blank">http://unity3d.com/learn/tutorials/modules/beginner/animation</a>.</p></div><p>Animation<a id="id224" class="indexterm"></a> is just one of the uses of the<a id="id225" class="indexterm"></a> Mecanim system; we'll explore other uses of it in <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>Encountering Enemies and Running Away</em></span>, <a class="link" href="#" linkend="ch09">Chapter 9</a>, <span class="emphasis"><em>Getting Ready to Fight</em></span>, and <a class="link" href="#" linkend="ch10">Chapter 10</a>,<span class="emphasis"><em> The Battle Begins</em></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec27"></a>Setting up animation controllers</h3></div></div></div><p>So, to start creating animations, you first need an animation controller in order to define your animation clips. As<a id="id226" class="indexterm"></a> stated before, this is just a state machine that controls the execution of animations even if there is only one animation. In this case, the controller runs the selected animation for as long as it's told to.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>If you are browsing around the components that can be added to the game object, you will come across the <span class="strong"><strong>Animator</strong></span> component, which takes a single animation clip as a parameter. This is the legacy animation system for backward compatibility only. Any new animation clip created and set to this component will <span class="emphasis"><em>not</em></span> work; it will simply generate a console log item stating <span class="strong"><strong>The AnimationClip used by the Animation component must be marked as Legacy</strong></span>. So, in Unity 4.3 onwards, just avoid this.</p></div><p>Creating an animation controller is just as easy as any other game object. In the <span class="strong"><strong>Project</strong></span> view, simply right-click on the view and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Animator Controller</strong></span>.</p><p>Opening the new animation will show you the blank animator controller in the Mecanim state manager window, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_03.jpg" /></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip13"></a>Tip</h3><p>There is a lot of functionality in the Mecanim state engine, which is largely outside the scope of this book. Check out for more dedicated books on this, such as <span class="emphasis"><em>Unity 4 Character Animation with Mecanim</em></span>, <span class="emphasis"><em>Jamie Dean</em></span>, <span class="emphasis"><em>Packt Publishing</em></span>.</p></div><p>If you have any<a id="id227" class="indexterm"></a> existing clips, you can just drag them to the Mecanim controller's <span class="strong"><strong>Edit</strong></span> window; alternatively, you can just select them in the <span class="strong"><strong>Project</strong></span> view, right-click on them, and select <span class="strong"><strong>From selected clip</strong></span> under <span class="strong"><strong>Create</strong></span>. However, we will cover more of this later in practice.</p><p>Once you have a controller, you can add it to any game object in your project by clicking on <span class="strong"><strong>Add Component</strong></span> in the inspector or by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Create</strong></span> and <span class="strong"><strong>Miscellaneous</strong></span> | <span class="strong"><strong>Animator</strong></span> and selecting it. Then, you can select your new controller as the <span class="strong"><strong>Controller</strong></span> property of the animator. Alternatively, you can just drag your new controller to the game object you wish to add it to.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>Clips in a controller are bound to the spritesheet texture of the object the controller is attached to. Changing or removing this texture will prevent the animation from being displayed correctly. However, it will appear as it's still running.</p></div><p>So with a controller<a id="id228" class="indexterm"></a> in place, let's add some animation to it.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip14"></a>Tip</h3><p>If you are using the automatic clip creation technique detailed in the next section, you can skip this step as it also generates the animation controller for you.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec28"></a>Setting up animation clips</h3></div></div></div><p>Unlike the 3D system in Unity where animations are defined in modeling programs and bound to certain model<a id="id229" class="indexterm"></a> types and poses, there are actually two ways in which animations (or clips) can be created in the new 2D system. This is because Unity controls the creation of an animation, not an external tool.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec27"></a>Manual animation clip creation</h4></div></div></div><p>Let's start off by creating <a id="id230" class="indexterm"></a>some animation clips manually. It is a slightly lengthier task than the automatic route, but it is good to understand what the automatic system is actually doing for you. This helps you choose which route to take depending on the kind of animation you want to create.</p><p>To start, first we need to create a game object in the hierarchy with an animator component and controller attached to it so that we can add a reference to the spritesheet. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag either the spritesheet (with the regions defined) or any single sprite to the scene hierarchy in the scene view. This will create a new game object with <span class="strong"><strong>Sprite Renderer</strong></span> for the assigned texture.</p></li><li><p>Add the <span class="strong"><strong>Animator</strong></span> component to the game object.</p></li><li><p>Create a new animator controller by clicking on <span class="strong"><strong>Animator Controller</strong></span> in the <span class="strong"><strong>Project</strong></span> view.</p></li><li><p>Drag the new animation controller to the game object, or set it to the <span class="strong"><strong>Controller</strong></span> property in the inspector panel for the animator.</p></li></ol></div><p>Now, if you open the <span class="strong"><strong>Animator</strong></span> window (<span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span>) with the new game object selected, you will get a blank animation with no clips defined, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_09.jpg" /></div><p>To create your first<a id="id231" class="indexterm"></a> clip, simply click on the clip selection drop-down menu and click on <span class="strong"><strong>[Create New Clip]</strong></span>, as shown here:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_10.jpg" /></div><p>From here, you can either drag individual sprites onto the timeline at the points you want to show a sprite from in your animation, or you can alter the properties in the <span class="strong"><strong>Inspector</strong></span> pane to animate how the sprite should look on the screen. You can even preview the animation by clicking on the play button in the <span class="strong"><strong>Animation</strong></span> tab and it will display the running animation in the <span class="strong"><strong>Scene</strong></span> view window:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_11.jpg" /></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip15"></a>Tip</h3><p>From the preceding screenshot, you will notice that I have moved the <span class="strong"><strong>Animation</strong></span> window to a separate part of the screen (just drag the tab and move/dock) so that both the <span class="strong"><strong>Project</strong></span> and <span class="strong"><strong>Animator</strong></span> windows are placed side by side. This makes it easier to drag the sprites on to the dope sheet.</p></div><p>Now, you can have<a id="id232" class="indexterm"></a> ultimate control over your animation as it plays out on the screen. The next section will go into more detail on the dope sheet system and what it has to offer.</p><p>Note that you are not limited to the whole character animation with the new animation system; you can also construct characters from several sprites and animate them individually. The best example of this is Unity's own 2D platform sample, which is available at the Unity <span class="strong"><strong>Asset</strong></span> store (<a class="ulink" href="http://bit.ly/UnityPlatformer2D" target="_blank">http://bit.ly/UnityPlatformer2D</a>):</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_12.jpg" /></div><p>In the screenshot, you can see all the parts of the hero in the hierarchy, such as the body, tash, feet, and bazooka as separate sprites; then, in the animation dope sheet, the <span class="strong"><strong>Run</strong></span> animation<a id="id233" class="indexterm"></a> alters the position of each of these sprites to emulate a fast walking effect. This feature can be used in a powerful way once you get your head around what is possible.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec28"></a>Automatic animation clip creation</h4></div></div></div><p>The approach I'd always recommend (especially for beginners) is to let Unity create the animation clips for you. The <a id="id234" class="indexterm"></a>automatic routines are well equipped to understand your animations, and they set the various properties for you very well. You can always tweak it later.</p><p>The process is very simple, and you can even create the default animation controller in the process by performing the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, delete the example you created previously, just to avoid confusion.</p></li><li><p>Browse to the spritesheet that is in the <code class="literal">Assets</code> folder structure in the <span class="strong"><strong>Project</strong></span> view.</p></li><li><p>Expand the discovered sprites by clicking on the arrow next to the spritesheet's image.</p></li><li><p>Select all the sprites for a single animation.</p></li><li><p>Drag the selection to the <span class="strong"><strong>Scene</strong></span> view hierarchy (<span class="emphasis"><em>not</em></span> the <span class="strong"><strong>Game</strong></span> view).</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_04.jpg" /><div class="caption"><p>Dragging multiple sprites to the scene to make an animation</p></div></div></li><li><p>You will then<a id="id235" class="indexterm"></a> be prompted where to save the new animation clip:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_05.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note24"></a>Note</h3><p>The animation controller that is automatically created will have the same name as the first sprite in your animation. Be sure to rename it if you wish.</p></div></li><li><p>Save it<a id="id236" class="indexterm"></a> to <code class="literal">Assets\Animation\Clips</code> and you are done.</p></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip16"></a>Tip</h3><p>If you perform the preceding steps for every animation, just remember to delete any controllers it creates that you do not intend to use. Time and experience will help you find the right path that fits your needs.</p></div><p>Once saved, be sure to sort your controllers and clips in the correct folder of your project, or leave them where they are until you are happy.</p><p>If you examine your <a id="id237" class="indexterm"></a>new game object in the <span class="strong"><strong>Inspector</strong></span> pane, you should find a new sprite created with an <span class="strong"><strong>Animator</strong></span> component along with the new controller you saved, shown in the <span class="strong"><strong>Inspector</strong></span> pane as you can see here:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_06.jpg" /></div><p>Now, if you double-click on either the new controller in your <code class="literal">Project</code> folder or the <span class="strong"><strong>Controller</strong></span> parameter in the <span class="strong"><strong>Animator</strong></span> controller component in the <span class="strong"><strong>Inspector</strong></span> pane, you will see the new single state animation that was generated for you, as follows:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_07.jpg" /></div><p>If you also want to check<a id="id238" class="indexterm"></a> out how the animation looks like, select your new object in your <span class="strong"><strong>Project</strong></span> hierarchy and open the <span class="strong"><strong>Animation</strong></span> view by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span> in the menu. Once open, you should see the animator <span class="strong"><strong>Dope Sheet</strong></span> view (as shown in the following screenshot) for the currently selected game object with the current animation clip in view (as highlighted):</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_08.jpg" /></div><p>Here, you can see the simple sprite animation expressed in the <span class="strong"><strong>Dope Sheet</strong></span> view with the timings for when the sprite's image will change. By default, this will be in an eternal loop from start to finish.</p><p>Any changes that you <a id="id239" class="indexterm"></a>make at this point with <span class="strong"><strong>Dope Sheet</strong></span> open in the <span class="strong"><strong>Inspector</strong></span> pane will be recorded at the selected time in the animation, so be careful about what you click on. We will cover more on the dope sheet system later.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec29"></a>Animator Dope Sheet</h4></div></div></div><p>The new and improved<a id="id240" class="indexterm"></a> animation <span class="strong"><strong>Dope Sheet</strong></span> has a growing set of features to make the animation easier and yet more powerful:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_13.jpg" /></div><p>The features aren't limited to the new 2D system for use, but they do make a lot of 2D tasks a lot simpler to implement.</p><p>Navigating round the Animation editor (as shown in the previous screenshot), we have the following sections:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec04"></a>(1) The time/recording controls</h5></div></div></div><p>The time controls let <a id="id241" class="indexterm"></a>you play or step through your<a id="id242" class="indexterm"></a> recorded animation to see how it flows. This is especially useful when combined with the active play in the <span class="strong"><strong>Scene </strong></span>and<span class="strong"><strong> Game </strong></span>views.</p><p>The record button determines whether the changes in the <span class="strong"><strong>Scene</strong></span> or <span class="strong"><strong>Inspector</strong></span> panes will affect the <span class="strong"><strong>Animation</strong></span> properties and will add new ones if a property has not been touched yet.</p><p>There are also the buttons to add new <span class="strong"><strong>KeyFrames</strong></span> (specific point on the timeline at the currently selected time) or <span class="strong"><strong>Animation Events</strong></span> (script launching points based on time).</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec05"></a>(2) Selecting the animation clip</h5></div></div></div><p>This is a simple<a id="id243" class="indexterm"></a> list of all the clips in the<a id="id244" class="indexterm"></a> current animation set/controller. It also has the facility to add more clips directly from this drop-down menu.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec06"></a>(3) The sample rate (frames per second)</h5></div></div></div><p>The sample rate sets the number of frames per second that are available in the timeline. It controls the number <a id="id245" class="indexterm"></a>of key frame<a id="id246" class="indexterm"></a> points possible between time intervals.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec07"></a>(4) Animation properties</h5></div></div></div><p>Animation properties<a id="id247" class="indexterm"></a> list all the different <span class="strong"><strong>Inspector</strong></span> properties that are being controlled by this animation clip. If a property is touched in<a id="id248" class="indexterm"></a> the editor while the record mode is active, it will create a new property in the animator or alter the existing property at the current time.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note25"></a>Note</h3><p>Currently, the animations have one limitation. If a property is part of a construct such as <code class="literal">vector3</code> and even if you only change one part of that construct, say the X value, it will set the other parts to their default values.</p><p>Animating the <span class="emphasis"><em>x</em></span> axis on a position property, for instance to 0.1, at a specified time will also set the Y and Z values to 0; this overrides any script, changing those values. Keep this in mind while animating similar properties.</p></div><p>While in the record mode, <span class="emphasis"><em>any</em></span> change in the editor will be captured. This includes any child game object properties that you change. This becomes very useful if your animated objects comprise multiple sprites in the child game objects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec08"></a>(5) Timeline</h5></div></div></div><p>The timeline window<a id="id249" class="indexterm"></a> shows all the key frames being animated<a id="id250" class="indexterm"></a> over the lifetime of the animation. Setting the sample rate higher and lower will control how many key points/frames will be available between time units.</p><p>You can also use the following keyboard shortcuts<a id="id251" class="indexterm"></a> to navigate between the frames on the timeline:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Press comma (<span class="emphasis"><em>,</em></span>) to go to the previous frame</p></li><li style="list-style-type: disc"><p>Press period (<span class="emphasis"><em>.</em></span>) to go to the next frame</p></li><li style="list-style-type: disc"><p>Press <span class="emphasis"><em>Alt</em></span> + Comma (<span class="emphasis"><em>,</em></span>) to go to the previous key frame</p></li><li style="list-style-type: disc"><p>Press <span class="emphasis"><em>Alt</em></span> + Period (<span class="emphasis"><em>.</em></span>) to go to the next key frame</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch03lvl4sec09"></a>(6) Dope/curve view</h5></div></div></div><p>The timeline view<a id="id252" class="indexterm"></a> has an alternate view mode to add finer <a id="id253" class="indexterm"></a>control and curves between the key frame animations, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849697347/graphics/7347OT_03_14.jpg" /></div><p>Editing the curves<a id="id254" class="indexterm"></a> takes a little finesse but makes for a better-looking transition than the default <code class="literal">Boolean</code> (on/off) effect.</p><p>You can further control the curves by setting the inbound and outbound tangents of the curve, setting either a smooth (linear), sharp (constant), or free-form curve. Simply play with these settings until you have the kind of curve you want.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"></a>Note</h3><p>Curves<a id="id255" class="indexterm"></a> can also be used for just about anything and from anywhere in the code. So, if you are using a separate library or complex math to emulate curves or tweening, stop and have a serious look at the animation curves. We will cover more on this later.</p></div><p>We'll cover curves in <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>NPCs and Interactions</em></span>, where we'll learn a few of the slightly more complex curves and animations.</p></div></div></div></div>