<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec09"></a>CAD or 3D modeling software</h2></div></div><hr /></div><p>Nowadays, it can<a id="id7" class="indexterm"></a> be assumed that almost any architect or architectural<a id="id8" class="indexterm"></a> office use CAD or modeling software, such as <span class="emphasis"><em>Autodesk AutoCAD</em></span>
<a id="id9" class="indexterm"></a> or <a id="id10" class="indexterm"></a>
<span class="emphasis"><em>Nemetschek VectorWorks</em></span>, commonly in combination with <span class="emphasis"><em>Trimble SketchUp</em></span>
<a id="id11" class="indexterm"></a>. In addition, we currently see a migration towards <span class="strong"><strong>Building Information Modeling</strong></span> (<span class="strong"><strong>BIM</strong></span>)<a id="id12" class="indexterm"></a>, which will be discussed in the next section.</p><p>It should be noted that 2D Drafting<a id="id13" class="indexterm"></a> is still omnipresent in architectural offices worldwide. While AutoCAD<a id="id14" class="indexterm"></a> presents both 2D and 3D functionality, many offices still rely on the creation of 2D documents for documentation purposes. The first hurdle they need to tackle in the context of real-time architectural visualization is switching to 3D, as the use of a Game Authoring Environment, such as Unity makes hardly any sense when you don't create 3D models.</p><p>As it stands, Unity is <a id="id15" class="indexterm"></a>mostly oriented to the so-called <span class="strong"><strong>Digital Content Creation</strong></span> (<span class="strong"><strong>DCC</strong></span>) systems, which provide a combination of modeling, rendering, and animation functionality, such as <span class="emphasis"><em>Autodesk 3ds Max</em></span>
<a id="id16" class="indexterm"></a> or <a id="id17" class="indexterm"></a>
<span class="emphasis"><em>Maxon CINEMA 4D</em></span>. Models from such software can be saved directly inside the Unity project's <code class="literal">Assets</code> folder<a id="id18" class="indexterm"></a> and are subsequently converted in the background automatically. When using any of the directly supported software tools, modelers can further edit the models by simply double-clicking the model name from within Unity. This opens the original software, where they can modify the model<a id="id19" class="indexterm"></a> and save it again, with Unity taking care of the model <a id="id20" class="indexterm"></a>conversion in the background. This approach is supported by Autodesk 3ds Max and Maya, Maxon CINEMA 4D, Blender, and some other applications given at <a class="ulink" href="http://docs.unity3d.com/Documentation/Manual/3D-formats.html" target="_blank">http://docs.unity3d.com/Documentation/Manual/3D-formats.html</a>. However, most architects will agree that these are not the primary modeling systems in use for architectural modeling.</p><p>As it stands, a typical CAD model in for example, AutoCAD <code class="literal">DWG</code> format, is not supported by Unity, so you need to convert your model into an alternative format. The <code class="literal">FBX</code> format is currently the best supported format for Unity, probably alongside the open <code class="literal">COLLADA</code> format, with extension <code class="literal">.DAE</code>. If your CAD or 3D software can export one of these two formats directly, use them as your first choice. Otherwise, you can try if your software has <code class="literal">3DS</code> or <code class="literal">OBJ</code> export, which are the other two formats that Unity can also read directly. While <code class="literal">DXF</code> is supported as well, this is not recommended, as you need to use an older version of the format and texture information will not survive the conversion.</p><p>The following table gives an overview of which formats can be exported from some typical CAD software into Unity 4.x and also discusses expected possible problems.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /><col align="left" /></colgroup><thead><tr><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>CAD Software</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Export</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Comments</p>
</th></tr></thead><tbody><tr><td style="" rowspan="3" align="left" valign="top">
<p>AutoCAD (<code class="literal">DWG</code>)</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">DWG</code>
</p>
</td><td style="" align="left" valign="top">
<p>Not supported by Unity.</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<code class="literal">DXF</code>
</p>
</td><td style="" align="left" valign="top">
<p>Not recommended.</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<code class="literal">FBX</code>
</p>
</td><td style="" align="left" valign="top">
<p>Preferred, especially if textures have been applied already.</p>
</td></tr><tr><td style="" rowspan="3" align="left" valign="top">
<p>VectorWorks (<code class="literal">VWX</code>)</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">DXF</code>
</p>
</td><td style="" align="left" valign="top">
<p>Not recommended.</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<code class="literal">C4D</code>
</p>
</td><td style="" align="left" valign="top">
<p>
<span class="emphasis"><em>Exchange</em></span> add-on recommended; requires CINEMA 4D.</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<code class="literal">FBX</code>, <code class="literal">DAE</code>
</p>
</td><td style="" align="left" valign="top">
<p>
<span class="emphasis"><em>RenderWorks</em></span> add-on required.</p>
</td></tr><tr><td style="" rowspan="3" align="left" valign="top">
<p>SketchUp (<code class="literal">SKP</code>)</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">FBX</code>
</p>
</td><td style="" align="left" valign="top">
<p>Preferred, but only supported by Pro-version or add-ins.</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<code class="literal">DAE</code>
</p>
</td><td style="" align="left" valign="top">
<p>Through Google Earth <code class="literal">KMZ</code> export (zipped folder).</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<code class="literal">OBJ</code>
</p>
</td><td style="" align="left" valign="top">
<p>Can be added with Ruby script.</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>Rhino (<code class="literal">3DM</code>)</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">FBX</code>, <code class="literal">3DS</code>, <code class="literal">OBJ</code>
</p>
</td><td style="" align="left" valign="top">
<p>Good 3D format support, with control over polygon count and texture mapping.</p>
</td></tr></tbody></table></div><p>The primary goal is to get a model on the right scale and with correctly applied materials inside Unity. While not set in stone, the units inside Unity are typically interpreted as being meters. For proper material conversion, support for texturing and the preservation of <span class="strong"><strong>UV-texture coordinates</strong></span>
<a id="id21" class="indexterm"></a> (the way materials are projected onto geometry, which is discussed later on) is essential. While this is common knowledge for visualization artists and game<a id="id22" class="indexterm"></a> modelers, this is not always the case for CAD users. Most <a id="id23" class="indexterm"></a>architectural 3D models are created to contain accurate geometry, but present materials as single colors, often tied to the layer on which the object resides.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec06"></a>Passing through intermediate software</h3></div></div></div><p>If you are in a situation where there is no suitable supported format, you have to rely on 3D conversion software. Even if your CAD system is supported, it makes sense to pass it through other <a id="id24" class="indexterm"></a>software to fine-tune the conversion. You can export an AutoCAD model as a <code class="literal">DWG</code> file into 3ds Max and do the Unity conversion from there.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"></a>Tip</h3><p>While many software combinations are usable, the workflow can be smoother when using a solution from a single software vendor. Going from AutoCAD to 3ds Max or from VectorWorks to CINEMA 4D will ease the conversion, which we will discuss later on.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec07"></a>Expected pitfalls</h3></div></div></div><p>There are several <a id="id25" class="indexterm"></a>typical problems that can occur when loading CAD models inside Unity. In most cases, paying attention during modeling can optimize the results considerably.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec02"></a>Missing back-faces</h4></div></div></div><p>The following <a id="id26" class="indexterm"></a>screenshot displays a rather typical SketchUp model of the <a id="id27" class="indexterm"></a>Barcelona Pavillion, by the architect Mies van der Rohe. It was downloaded from the 3D Warehouse and modeled by user <span class="emphasis"><em>Cintilante 3D</em></span> available at <a class="ulink" href="http://sketchup.google.com/3dwarehouse/details?mid=fabea878c454e119e8d39fcb58c495ea" target="_blank">http://sketchup.google.com/3dwarehouse/details?mid=fabea878c454e119e8d39fcb58c495ea</a>. When you open the model inside SketchUp, everything looks normal, but when loading it inside Unity, a large part of it seems to be missing at first sight.</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_01_01.jpg" /></div><p>Upon closer inspection, the geometry is actually available in the model, but can only be seen from the other side, for example, from the bottom. CAD software often displays front and back-faces of geometry, whereas Unity hides back-faces for performance reasons (namely, <span class="strong"><strong>back-face culling</strong></span>). The order in which vertices of faces are connected defines the <span class="emphasis"><em>face orientation</em></span>. If you don't pay attention to face orientation during modeling, gaps will <a id="id28" class="indexterm"></a>appear inside Unity. This problem is not unique to Unity. <span class="emphasis"><em>Abvent Artlantis</em></span>, a rendering companion software often used by architects, also<a id="id29" class="indexterm"></a> hides back-faces. We have encountered this numerous times when students are trying to import SketchUp models. This is less problematic when you model with volumes or primitive objects, as they are usually well oriented to start with.</p><p>The solution is to either display both sides of the geometry, which effectively doubles the geometry to show on screen, or to flip the wrongly oriented faces in the modeling system, which is obviously recommended. In a correct model, only front faces should be visible. In the case of SketchUp, front and back-faces are both visible, but they have different materials applied, which complicates conversion to Unity.</p><p>When you model with single faces, this really becomes problematic. The face will only be visible from the front side and is missing completely when looking from the back. If you are modeling fences or other thin elements, such as glass panes, you need to either model them as thin boxes or export the model with faces for both sides separately. If supported, turn off back-face display in the CAD system, to better assess how the model will appear inside Unity. When using SketchUp, switch to the <span class="emphasis"><em>Monochrome Face Style</em></span>, which will show all face orientation mistakes (back-faces) in a light blue color, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_01_02.jpg" /></div><p>Right click on the problematic faces and choose the <span class="strong"><strong>Reverse Faces…</strong></span> option. Before you export any SketchUp model to Unity, switch to this face style and flip all blue faces. Beware that you<a id="id30" class="indexterm"></a> might need to re-assign materials, as the front face material <a id="id31" class="indexterm"></a>will be moved to the other side as well, which is not visible in the Monochrome face style.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec03"></a>Missing texture coordinates</h4></div></div></div><p>Texture coordinates <a id="id32" class="indexterm"></a>are the link between a texture image (for example, a picture of a brick wall) and the geometry onto which it is applied. Texture coordinates <a id="id33" class="indexterm"></a>are stored inside the vertices of geometry, alongside<a id="id34" class="indexterm"></a> geometric coordinates.</p><p>While most game modelers colorize geometry using textures, many architectural models contain plain and solid colors. When exporting to Unity, this becomes a problem, as faces will not have their texture coordinates properly set up. When you assign a material inside Unity or change the <span class="strong"><strong>Base</strong></span> (<span class="strong"><strong>RGB</strong></span>) texture, it will not be positioned correctly. Chances are that you'll only see a single color, usually the border pixel(s) of the texture or that the position and scale of the texture map on the geometry is inconsistent. The following image displays a basic brick texture and how it is mapped on the imported geometry. The stretched pixels indicate an incorrect mapping setup.</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_01_03.jpg" /></div><p>To alter these coordinates from within Unity, Unity requires separate tools and is really cumbersome, certainly when the original model changes. Always assign textures in the original model, even if the <a id="id35" class="indexterm"></a>texture itself is only a <a id="id36" class="indexterm"></a>placeholder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec04"></a>Superfluous geometry</h4></div></div></div><p>The way models are<a id="id37" class="indexterm"></a> created for game environments is fundamentally <a id="id38" class="indexterm"></a>different from the way architectural models are set up. Professional game modelers are trained to use as little geometry as possible. Even though Unity is capable of displaying fairly large and complex models, performance will suffer, so every possible face that is never seen is omitted.</p><p>In a CAD model, this is not the case. A door that is placed inside a wall will cover the side of the wall opening, but the faces of this side are still modeled, even if they are never seen. Likewise, cabinets and closets are commonly placed against a wall. If the cabinet never moves, game modelers would remove those faces, whereas architects need them to be visible, as the model can be displayed with or without the covering objects visible.</p><p>This problem is harder to solve, as the architectural model has many different purposes. In any case, the architect would need to set up a specific model display to be used when exporting for real-time usage. Such a view needs to hide as much geometry as possible and hide at least those elements that are never to be seen in the real-time model.</p><p>It can be valuable to export the CAD or BIM model in chunks, providing more flexibility inside Unity to selectively show or hide parts of the model. Depending on the use case, you could toggle furniture, technical installations, outside walls or even different design alternatives. The next section will show this with the help of an example.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec05"></a>Lack of instances</h4></div></div></div><p>Most CAD systems support a notion of a <span class="emphasis"><em>Block</em></span> or a <span class="emphasis"><em>Symbol</em></span>. These are objects that occur repeatedly, with identical properties. Typical examples include furniture or sanitary equipment. This technique is called <span class="emphasis"><em>instancing</em></span>
<a id="id39" class="indexterm"></a>, in general. Such objects are used to diminish file sizes and optimize modeling and display performance. Instancing in Unity is<a id="id40" class="indexterm"></a> organized using <span class="emphasis"><em>Prefabs</em></span>, which are displayed with a blue name in the editor.</p><p>However, when converting CAD models to Unity, instancing information often gets lost, depending on the way the export function was implemented. This is something to be tested early on, since it can make a huge difference in performance.</p><p>If the export process does not support instancing, it might be beneficial to export only the unique geometry and assemble the model inside Unity, after turning each unique element into a single prefab. For example, in a restaurant project, export a single table into a separate file and load that into your Unity project as a prefab alongside the building geometry. When copying this, all instances will be identical and the system can optimize its performance automatically. This is more efficient than exporting the full scene with all tables included. Beware that this can be a considerable effort, so do this only if required, for example, when the player is able to move or interact with the tables.</p></div></div></div>