<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec21"></a>Shadows</h2></div></div><hr /></div><p>Most current games support some form of shadows. They can be pre-calculated or rendered in real-time. <span class="emphasis"><em>Pre-calculation</em></span> implies that the effect of shadows and lighting is calculated in advance and rendered onto an additional material layer. It only makes sense for objects that don't move in the scene. <span class="emphasis"><em>Real-time shadows</em></span> are rendered using the GPU, but can be<a id="id143" class="indexterm"></a> computationally expensive and should only be used for dynamic lighting. You might be familiar with real-time shadows from applications such as SketchUp and recent versions of ArchiCAD or Revit.</p><p>Ideally, both techniques are combined. The overall lighting of the scene (for example, buildings, street, interiors, and so on) is pre-calculated and baked in texture maps. Additional real-time shadows are used on the moving characters. Unity can blend both types of shadows to simulate dynamic lighting in large scenes. Some of these techniques, however, are only supported in the pro-version.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec14"></a>Real-time shadows</h3></div></div></div><p>Imagine we want to<a id="id144" class="indexterm"></a> create a sun or shadow study of a building. This is<a id="id145" class="indexterm"></a> best appreciated in real-time and by looking from the outside. We will use the same model as we did in the previous chapter, but load it in a separate scene. We want to have a light object acting as a sun, a spherical object to act as a visual clue where the sun is positioned and link them together to control the rotations in an easy way. The steps to be followed to achieve this are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a Directional light, name it <code class="literal">SunLight</code> and choose the <span class="strong"><strong>Shadow Type</strong></span>. <span class="strong"><strong>Hard shadows</strong></span> are more sharply defined and are the best choice in this example, whereas <span class="strong"><strong>Soft shadows</strong></span> look smoother and are better suited for a subtle, mood lighting.</p></li><li><p>Add an empty GameObject by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span> that is positioned in the center of the scene and name it <code class="literal">ORIGIN</code>.</p></li><li><p>Create a Sphere<span class="strong"><strong> </strong></span>GameObject by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>Sphere</strong></span>, name it <code class="literal">VisualSun</code>.</p></li><li><p>Make it a <span class="emphasis"><em>child</em></span> of the <span class="strong"><strong>ORIGIN</strong></span> by dragging the <span class="strong"><strong>VisualSun</strong></span> name in the <span class="strong"><strong>Hierarchy</strong></span> Tab onto the <span class="strong"><strong>ORIGIN</strong></span> name.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note06"></a>Note</h3><p>Children are linked to their parent object and follow the parent's transformation. Parent-Child relations are indicated in the <span class="strong"><strong>Hierarchy</strong></span> Tab using <a id="id146" class="indexterm"></a>small triangles, which you can collapse or fold out. Children are displayed below and slightly to the right of their parent. The next screenshot highlights an actual example.</p></div></li><li><p>Give <a id="id147" class="indexterm"></a>it a bright, yellow material, using a <span class="strong"><strong>Self-Illumin/Diffuse</strong></span> <span class="strong"><strong>Shader</strong></span>. Deactivate <span class="strong"><strong>Cast Shadows</strong></span> and <span class="strong"><strong>Receive Shadows</strong></span> on the <span class="strong"><strong>Mesh Renderer</strong></span> component.</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_03_01.jpg" /></div></li><li><p>After you have placed the <span class="strong"><strong>VisualSun</strong></span> as a child of the origin object, reset the position of the Sphere to be <code class="literal">0</code> for <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span> and <span class="strong"><strong>Z</strong></span>. It now sits in the same place as its parent. Even if you move the parent, its <span class="emphasis"><em>local</em></span> position stays at <span class="strong"><strong>X</strong></span>=<code class="literal">0</code>, <span class="strong"><strong>Y</strong></span>=<code class="literal">0</code> and <span class="strong"><strong>Z</strong></span>=<code class="literal">0</code>, which makes it convenient for a placement relative to its parent object. Alter the Z-position to define an offset from the origin, for example 20 units. The negative Z will facilitate the SunLight orientation in the next step.</p></li><li><p>The <span class="strong"><strong>SunLight</strong></span> can be dragged onto the <span class="strong"><strong>VisualSun</strong></span> and its local position reset to zero as well. When all rotations are also zero, it emits light down the Z-axis and thus straight to the origin.</p></li><li><p>If you want to have a nice <span class="emphasis"><em>glow</em></span> effect, you can add a <span class="emphasis"><em>Halo</em></span> by navigating to <span class="strong"><strong>Components</strong></span> | <span class="strong"><strong>Effects</strong></span> | <span class="strong"><strong>Halo</strong></span> and then to <span class="strong"><strong>SunLight</strong></span> and setting a suitable <span class="strong"><strong>Size</strong></span>.</p></li></ol></div><p>We now have a hierarchic structure of the origin, the visible sphere and the Directional light, that is<a id="id148" class="indexterm"></a> accentuated by the halo. We can adjust this assembly by<a id="id149" class="indexterm"></a> rotating the origin around. Rotating around the Y-axis defines the orientation of the sun, whereas a rotation around the X-axis defines the <span class="emphasis"><em>azimuth</em></span>. With these two rotations, we can position the sun wherever we want.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>Mastering parent-child relations is important for effective scene organization.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec06"></a>Sun study animation</h4></div></div></div><p>To automate movement in a game, we can use either an animation clip or a custom script. We'll show an animation clip<a id="id150" class="indexterm"></a> in the following example:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Before we start defining the animation, ensure the <span class="strong"><strong>ORIGIN</strong></span> is selected. Also open an <span class="strong"><strong>Animation</strong></span> Tab by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span> and dock it somewhere convenient.</p></li><li><p>There are different ways to create an animation clip. You can either right-click on the timeline in the <span class="strong"><strong>Animation</strong></span> Tab or click on the second popup (the menu displays <span class="strong"><strong>[Create New Clip]</strong></span>) just above the object tree in the same window. A dialog opens asking you to name the new animation clip, so name it <span class="strong"><strong>SunPath</strong></span>. This is an Asset, which is stored as a file in the <code class="literal">Assets</code> folder. You will also see that an <span class="strong"><strong>Animation</strong></span>
<span class="strong"><strong> </strong></span>component is added to the <span class="strong"><strong>ORIGIN</strong></span> GameObject, which points to the <span class="strong"><strong>SunPath</strong></span> animation clip we just created. This is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_03_02.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note07"></a>Note</h3><p>You can also create an Animation Clip from the menu by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Animation</strong></span> but then you need to add the Animation component to the <span class="strong"><strong>ORIGIN</strong></span> object and select the <span class="strong"><strong>SunPath</strong></span> clip or simply drag the clip on the object.</p></div></li><li><p>Now the clip is ready to record <span class="emphasis"><em>keyframe animation</em></span> in the Animation Tab. This should immediately make sense to anyone familiar with 3D animation software or other tools, such as <a id="id151" class="indexterm"></a>Adobe Flash. We'll follow the step-by-step procedure given<a id="id152" class="indexterm"></a> as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the small circle icon on the right side of the <span class="strong"><strong>Rotation.y</strong></span> parameter and select <span class="strong"><strong>Add Curves</strong></span>, which creates new <span class="emphasis"><em>Animation Curves</em></span> for the rotations (we always have the three of them included).</p></li><li><p>Drag the <span class="emphasis"><em>timeslider</em></span> (the red vertical line) to time <code class="literal">0:00</code> and add a <span class="emphasis"><em>key/keyframe</em></span> by right-clicking on the dark grey area underneath the timeline and select <span class="strong"><strong>Add Keyframe</strong></span>. As long as the red recording button is active, you can adjust the timeslider and change rotation values in the transform component, so keyframes will be added automatically.</p></li><li><p>Ensure that the Y-rotation is <code class="literal">0</code> degrees at timestep <code class="literal">0:00</code> and that it is <code class="literal">360</code> degrees at a later timestep (for instance, <code class="literal">02:00</code>). The yellow line indicating the rotation animation curve should be linear, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_03_03.jpg" /></div></li><li><p>Select the SunPath clip in the Project tab to display its properties and set the <span class="strong"><strong>wrap mode</strong></span> of the Animation Clip in the Inspector Tab to "<span class="strong"><strong>loop</strong></span>" so it will repeat in a cycle.</p></li></ol></div></li><li><p>The animation clip is now attached to the Origin and it plays if you run the game (<span class="strong"><strong>Play Automatically</strong></span> parameter is set to true in the Animation component) or if you press the triangular play button in the Animation Tab.</p></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>For a more elaborate sun study, also animate the X-rotation (or azimuth), the intensity, and the color of the Sun.</p><p>Animation clips<a id="id153" class="indexterm"></a> can be reused with other objects and in other scenes.</p><p>To reuse this setup in other scenes, turn the whole hierarchy into a <span class="emphasis"><em>Prefab</em></span>. To export it into other projects, consider exporting it as a <span class="emphasis"><em>Package</em></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec07"></a>Faking shadows</h4></div></div></div><p>A <span class="emphasis"><em>Blob Shadow</em></span> is a<a id="id154" class="indexterm"></a> cheap <a id="id155" class="indexterm"></a>way to add a hint of a shadow. A special bitmap is <a id="id156" class="indexterm"></a>projected and when positioned correctly appears, for example, underneath the feet of your main character, as we show it in the following steps. This requires fewer resources than using real-time shadows.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Load the <span class="strong"><strong>Projectors</strong></span> package by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Projectors</strong></span>, which contains a few materials, shaders, and prefabs to get you started.</p></li><li><p>Drag the <span class="strong"><strong>Blob Shadow Projector</strong></span> prefab onto the scene. This contains a Projector component, which acts similar to a light source, but uses a material. The following <span class="strong"><strong>Inspector</strong></span> screenshot shows the material being set up using the <span class="strong"><strong>Projector/Multiply</strong></span> shader and a <span class="strong"><strong>Cookie</strong></span> texture of a black blurred circle on a white background.</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_03_04.jpg" /></div></li><li><p>Position this Projector above our third person character using the transformation gizmo, so it projects a soft dark-grey circle.</p></li><li><p>To avoid casting a shadow onto the character, increase the <span class="strong"><strong>Near Clip Plane</strong></span> parameter of the <a id="id157" class="indexterm"></a>Projector so the shadow starts just<a id="id158" class="indexterm"></a> underneath the feet of our character (for example, 3 units). The <span class="strong"><strong>Far Clip Plane</strong></span> is usually big enough by default.</p></li><li><p>To ensure the Projector follows the character wherever it goes, you can use a short script or simply drag the Projector as a child object of the character, as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559060/graphics/7500_03_05.jpg" /></div></li></ol></div></div></div></div>