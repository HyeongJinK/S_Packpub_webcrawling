<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec202"></a>C# Addendum</h2></div></div><hr /></div><p>The <span class="strong"><strong>ClockScript</strong></span> was fairly painless to convert to C#. These were the steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Copy/paste the<a id="id612" class="indexterm"></a> JavaScript code into a new C# script (keeping the C# class definition and omitting the #pragma strict line)</p></li><li><p>Add the appropriate access modifier to the variable definitions (note: any variables that need to show up in the drag-n-drop Unity interface, like the ones that store the textures, need the <code class="literal">public</code> modifier. Use <code class="literal">private</code> for all other variables)</p></li><li><p>Change the syntax of all the variable definitions (declare the type before the variable name, and nix the colon)</p></li><li><p>Change the function declarations so that they start with the return type (<code class="literal">void</code> in all cases for this script) and an access modifier (<code class="literal">private</code> for all of these functions)</p></li><li><p>Add the <code class="literal">new</code> keyword when defining a <code class="literal">Rect</code> or a <code class="literal">Vector2</code> instance</p></li><li><p>Explicitly cast variables when you convert a float to an int. See this line for an example:</p><div class="informalexample"><pre class="programlisting">  minutes = (int)(timeRemaining/60); // minutes is an int, while timeRemaining is a float</pre></div></li></ol></div><p>Remember that if you remove the Javascript component and attach a C# script instead, you'll have to re-drag-n-drop all of the textures into the variables, because Unity loses track of them entirely.</p><p>A fun exercise <a id="id613" class="indexterm"></a>(depending on your definition of "fun") would be to create a new C# script, and to see if you can work through the errors one by one to completely convert this script yourself.  Give it a try!  The answer key is below, in case you get into trouble.</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ClockScriptCSharp : MonoBehaviour {

  
  private bool clockIsPaused = false;
  private float startTime; //(in seconds)
  private float timeRemaining; //(in seconds)
  private float percent;
  public Texture2D clockBG;
  public Texture2D clockFG;
  private float clockFGMaxWidth; // the starting width of the foreground bar
  public Texture2D rightSide;
  public Texture2D leftSide;
  public Texture2D back;
  public Texture2D blocker;
  public Texture2D shiny;
  public Texture2D finished;  
  
  private void Awake ()
  {
    startTime = Time.time + 120.0f;
    clockFGMaxWidth = clockFG.width;
  }

  private void Update ()
  {
    if (!clockIsPaused)
    {
       // make sure the timer is not paused
       DoCountdown();
    }
  }
  
  private void DoCountdown()
  {
    timeRemaining = startTime - Time.time;
    percent = timeRemaining/startTime * 100;
    if (timeRemaining &lt; 0)
    {
      timeRemaining = 0;
      clockIsPaused = true;
      TimeIsUp();
    }
    ShowTime();  
    //Debug.Log("time remaining = " + timeRemaining);
  }
  
  private void PauseClock()
  {
     clockIsPaused = true;
  }
  
  private void UnpauseClock()
  {
     clockIsPaused = false;
  }
  
  private void ShowTime()
  {
    int minutes;
    int seconds;
    string timeStr;
    minutes = (int)(timeRemaining/60);
    seconds = (int)(timeRemaining % 60);
    timeStr = minutes.ToString() + ":";
    timeStr += seconds.ToString("D2");
    guiText.text = timeStr; //display the time to the GUI
  }
  
  private void TimeIsUp()
  {
    Debug.Log("Time is up!");
  }
  
  private void OnGUI()
  {
    int pieClockX = 100;
    int pieClockY = 50;
     
    int pieClockW = 64; // clock width
    int pieClockH = 64; // clock height
     
    int pieClockHalfW = (int)(pieClockW * 0.5); // half the clock width
    int pieClockHalfH = (int)(pieClockH * 0.5); // half the clock height
  
    bool isPastHalfway = percent &lt; 50;
    Rect clockRect = new Rect(pieClockX, pieClockY, pieClockW, pieClockH);
    float rot = (percent/100) * 360;
    Vector2 centerPoint = new Vector2(pieClockX + pieClockHalfW, pieClockY + pieClockHalfH);
    Matrix4x4 startMatrix = GUI.matrix;
    
    GUI.DrawTexture(clockRect, back, ScaleMode.StretchToFill, true, 0);
    
    if(isPastHalfway)
    {
      GUIUtility.RotateAroundPivot(-rot-180, centerPoint);
      GUI.DrawTexture(clockRect, leftSide, ScaleMode.StretchToFill,true, 0);  
      GUI.matrix = startMatrix;
      GUI.DrawTexture(clockRect, blocker, ScaleMode.StretchToFill,true, 0);
    } else {
      GUIUtility.RotateAroundPivot(-rot, centerPoint);
      GUI.DrawTexture(clockRect, rightSide, ScaleMode.StretchToFill,true, 0);   
      GUI.matrix = startMatrix;
      GUI.DrawTexture(clockRect, leftSide, ScaleMode.StretchToFill,true, 0);    
    }
    
    
    if(percent &lt; 0)
    {
      GUI.DrawTexture(clockRect, finished, ScaleMode.StretchToFill,true, 0);
    }
    
    GUI.DrawTexture(clockRect, shiny, ScaleMode.StretchToFill, true, 0);
  
    float newBarWidth = (percent/100) * clockFGMaxWidth; // this isthe width that the foreground bar should be
    int gap = 20; // a spacing variable to help us position the clock
    GUI.BeginGroup (new Rect(Screen.width - clockBG.width - gap, gap,clockBG.width, clockBG.height));      
    GUI.DrawTexture (new Rect (0,0, clockBG.width, clockBG.height),clockBG);  
      GUI.BeginGroup (new Rect (5, 6, newBarWidth, clockFG.height));
        GUI.DrawTexture (new Rect (0,0, clockFG.width, clockFG.height), clockFG);    
      GUI.EndGroup ();   
    GUI.EndGroup ();
    
  }
}</pre></div></div>