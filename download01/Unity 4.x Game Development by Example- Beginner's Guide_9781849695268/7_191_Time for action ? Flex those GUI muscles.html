<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec193"></a>Time for action – Flex those GUI muscles</h2></div></div><hr /></div><p>Let's take a trip down memory lane<a id="id569" class="indexterm"></a> to the previous chapter, where we became <code class="literal">OnGUI</code> ninjas. We'll use the GUI techniques<a id="id570" class="indexterm"></a> we already know to display the two bars, and shrink the foreground bar as time runs out.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <code class="literal">DoCountdown</code> function of the <span class="strong"><strong>ClockScript</strong></span>, calculate the percentage of time elapsed by comparing the <code class="literal">startTime</code> and the <code class="literal">timeRemaining</code> values:</p><div class="informalexample"><pre class="programlisting">function DoCountdown()
{
  timeRemaining = startTime - Time.time;
<span class="strong"><strong>  percent = timeRemaining/startTime * 100;</strong></span>
  if (timeRemaining &lt; 0)
  {
    timeRemaining = 0;
    clockIsPaused = true;
    TimeIsUp();
  }
  ShowTime();
}</pre></div></li><li><p>Store the initial width of the <code class="literal">clockFG</code> graphic in a variable called <code class="literal">clockFGMaxWidth</code> in the <code class="literal">Awake</code> function:</p><div class="informalexample"><pre class="programlisting">function Awake()
{
  startTime = 120.0;
<span class="strong"><strong>  clockFGMaxWidth = clockFG.width;  </strong></span>
}</pre></div></li><li><p>Create the built-in <code class="literal">OnGUI</code> function<a id="id571" class="indexterm"></a> somewhere apart from the other functions in your script (make sure you don't create it inside the curly brackets of some other function!)</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>function OnGUI()</strong></span>
<span class="strong"><strong>{</strong></span>
<span class="strong"><strong>  var newBarWidth:float = (percent/100) * clockFGMaxWidth; // this is the width that the foreground bar should be</strong></span>
<span class="strong"><strong>  var gap:int = 20; // a spacing variable to help us position the clock</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div></li><li><p>Create a new group to <a id="id572" class="indexterm"></a>contain the <code class="literal">clockBG</code> texture. <a id="id573" class="indexterm"></a>We'll position the group so that the <code class="literal">clockBG</code> graphic appears 20 pixels down, and 20 away from the right edge of the screen:</p><div class="informalexample"><pre class="programlisting">function OnGUI()
{
  var newBarWidth:float = (percent/100) * clockFGMaxWidth; // this is the width that the foreground bar should be
  var gap:int = 20; // a spacing variable to help us position the clock
<span class="strong"><strong>  GUI.BeginGroup (new Rect(Screen.width - clockBG.width - gap,</strong></span>
<span class="strong"><strong>    gap, clockBG.width, clockBG.height));      </strong></span>
<span class="strong"><strong>  GUI.EndGroup ();</strong></span>
}</pre></div></li><li><p>Use the <code class="literal">DrawTexture</code> method<a id="id574" class="indexterm"></a> to draw the <code class="literal">clockBG</code> texture inside the group:</p><div class="informalexample"><pre class="programlisting">  GUI.BeginGroup (new Rect (Screen.width - clockBG.width - gap,
   gap, clockBG.width, clockBG.height));
<span class="strong"><strong>  GUI.DrawTexture (Rect (0,0, clockBG.width, clockBG.height),</strong></span>
<span class="strong"><strong>    clockBG);      </strong></span>
  GUI.EndGroup ();</pre></div></li><li><p>Nest another group inside the first group to hold the <code class="literal">clockFG</code> texture. Notice that we're offsetting it by a few pixels (5,6) so that it appears inside the <code class="literal">clockBG</code> graphic:</p><div class="informalexample"><pre class="programlisting">  GUI.BeginGroup (new Rect (Screen.width - clockBG.width - gap,
    gap, clockBG.width, clockBG.height));
  GUI.DrawTexture (Rect (0,0, clockBG.width, clockBG.height),
    clockBG);   
<span class="strong"><strong>    GUI.BeginGroup (new Rect (5, 6, newBarWidth, clockFG.height));</strong></span>
<span class="strong"><strong>    GUI.EndGroup ();   </strong></span>
  GUI.EndGroup ();</pre></div><p>Here, I've indented the second group to make the code easier to read.</p></li><li><p>Now, draw the <code class="literal">clockFG</code> texture inside that nested group:</p><div class="informalexample"><pre class="programlisting">GUI.BeginGroup (new Rect (5, 6, newBarWidth, clockFG.height));
<span class="strong"><strong>GUI.DrawTexture (Rect (0,0, clockFG.width, clockFG.height),</strong></span>
<span class="strong"><strong>  clockFG);</strong></span>
GUI.EndGroup ();</pre></div><p>Did you punch that in <a id="id575" class="indexterm"></a>correctly? Here's what the <a id="id576" class="indexterm"></a>entire function looks like all at once:</p><div class="informalexample"><pre class="programlisting">function OnGUI()
{
  var newBarWidth:float = (percent/100) * clockFGMaxWidth; // this is the width that the foreground bar should be
  var gap:int = 20; // a spacing variable to help us positionthe clock
  GUI.BeginGroup (new Rect (Screen.width - clockBG.width - gap,
    gap, clockBG.width, clockBG.height));
  GUI.DrawTexture (Rect (0,0, clockBG.width, clockBG.height),
   clockBG);   
       GUI.BeginGroup (new Rect (5, 6, newBarWidth,
         clockFG.height));
       GUI.DrawTexture (Rect (0,0, clockFG.width, clockFG.height), clockFG);
       GUI.EndGroup (); 
  GUI.EndGroup ();
}</pre></div></li></ol></div><p>Save the script and jump back into Unity. Let's turn off the old and busted number clock so that we can marvel at the new hotness—our graphical clock. Select the <span class="strong"><strong>Clock</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> panel. Locate the <span class="strong"><strong>GUIText</strong></span> component in the <span class="strong"><strong>Inspector</strong></span> panel, and uncheck its check box to turn off its rendering.</p><div class="mediaobject"><img src="/graphics/9781849695268/graphics/5268OT_07_15.jpg" /></div><p>.</p><p>Now, test your game. Fantastic! Your new graphical clock drains ominously as time runs out. That'll really put the heat on, without<a id="id577" class="indexterm"></a> compromising your player's doubtless lust for eye candy.</p><div class="mediaobject"><img src="/graphics/9781849695268/graphics/5268OT_07_12.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec81"></a>
<span class="emphasis"><em>What just happened – how does it work?</em></span>
</h3></div></div></div><p>The math behind this magic is simple ratio stuff that I, for one, conveniently forgot the moment I escaped the sixth grade and<a id="id578" class="indexterm"></a> ran away to become a kid who enjoys watching the circus. We converted the time elapsed into a percentage of the total time on the clock. Then, we used that percentage to figure out how wide the <code class="literal">clockFG</code> graphic should be. Percentage of time elapsed is to 100, as the width of the <code class="literal">clockFG</code> graphic is to its original width. It's simple algebra from there.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip34"></a>Tip</h3><p>
<span class="strong"><strong>The only math you need to know</strong></span>
</p><p>I often say that this dead-simple ratio stuff is the only math you need to know as a game developer. I'm half-kidding, of course. Developers with a firm grasp of trigonometry can create billiard and pinball games, while Developers who know differential calculus can create a tank game where the enemy AI knows which way to aim its turret, taking trajectory, wind, and gravity into account (hey, kids! Stay in school).</p><p>But, when people ask sheepishly about programming and how difficult it is to learn, it's usually because they think you can only create games by using complex mathematical equations. We've hopefully debunked this myth by creating two simple games so<a id="id579" class="indexterm"></a> far with equally simple math. <a id="id580" class="indexterm"></a>These ratio calculations are used ALL THE TIME in gaming, from figuring out health bars, to player positions on a mini-map, to level progress meters. If you're arithmophobic like I am, and you relearn only one piece of math from your long-forgotten elementary school days, make it this one.</p></div></div></div>