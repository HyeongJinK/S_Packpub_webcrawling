<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec199"></a>Time for action – commencing operation pie clock</h2></div></div><hr /></div><p>Let's lay down some code to<a id="id603" class="indexterm"></a> make those half-circle pieces rotate.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set up a conditional statement so that we can draw different things before and after the halfway point:</p><div class="informalexample"><pre class="programlisting">  GUI.DrawTexture(clockRect, back, ScaleMode.StretchToFill, true,
   0);
<span class="strong"><strong>   if(isPastHalfway)</strong></span>
<span class="strong"><strong>   {</strong></span>
<span class="strong"><strong>   } else {</strong></span>
<span class="strong"><strong>   }</strong></span>
</pre></div></li><li><p>If we're not past halfway, rotate the GUI around the <code class="literal">centerPoint</code>. Draw the right side half-circle piece on top of the rotated GUI. Then, rotate the GUI back to its start position:</p><div class="informalexample"><pre class="programlisting">if(isPastHalfway)
{
} else {
<span class="strong"><strong>  GUIUtility.RotateAroundPivot(-rot, centerPoint);</strong></span>
<span class="strong"><strong>  GUI.DrawTexture(clockRect, rightSide, ScaleMode.StretchToFill, true, 0);</strong></span>
<span class="strong"><strong>  GUI.matrix = startMatrix;</strong></span>
}</pre></div></li><li><p>Save the script and test your game. You should see the right side half-circle piece rotating around the clock. But, we know it's not really rotating—the entire GUI is rotating, and we're stamping the image on the screen before resetting the rotation:</p><div class="mediaobject"><img src="/graphics/9781849695268/graphics/5268OT_07_27.jpg" /></div></li><li><p>Draw the left half-circle once the GUI is back into position.</p><div class="informalexample"><pre class="programlisting">GUI.matrix = startMatrix;
<span class="strong"><strong>GUI.DrawTexture(clockRect, leftSide, ScaleMode.StretchToFill,</strong></span>
<span class="strong"><strong>   true, 0);</strong></span>
</pre></div></li><li><p>You can save and test at<a id="id604" class="indexterm"></a> this point, too. The right half-circle disappears behind the left half-circle as it rotates, creating the illusion we're after:</p><div class="mediaobject"><img src="/graphics/9781849695268/graphics/5268OT_07_28.jpg" /></div></li><li><p>It all comes crashing down after the halfway point, though. Let's fix that:</p><div class="informalexample"><pre class="programlisting">  if(isPastHalfway)
  {
<span class="strong"><strong>     GUIUtility.RotateAroundPivot(-rot-180, centerPoint);</strong></span>
<span class="strong"><strong>     GUI.DrawTexture(clockRect, leftSide, ScaleMode.StretchToFill,</strong></span>
<span class="strong"><strong>       true, 0);  </strong></span>
<span class="strong"><strong>     GUI.matrix = startMatrix;</strong></span>
</pre></div></li><li><p>Save and test. Once we're past the halfway point, the left half-circle does its thing, but the illusion is ruined because we see it rotating into the right side of the clock:</p><div class="mediaobject"><img src="/graphics/9781849695268/graphics/5268OT_07_29.jpg" /></div><p>We just need to draw that blue half-circle blocker graphic in front of it to complete the illusion:</p><div class="informalexample"><pre class="programlisting">  GUI.matrix = startMatrix;
<span class="strong"><strong>  GUI.DrawTexture(clockRect, blocker, ScaleMode.StretchToFill,</strong></span>
<span class="strong"><strong>    true, 0);   </strong></span>
</pre></div></li><li><p>Save and test one last time.<a id="id605" class="indexterm"></a> You should see your pie clock elapse exactly as described in the sales brochure.</p></li></ol></div><div class="mediaobject"><img src="/graphics/9781849695268/graphics/5268OT_07_30.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec83"></a>
<span class="emphasis"><em>What just happened – explaining away the loose ends</em></span>
</h3></div></div></div><p>Hopefully, the code is straightforward. Notice that in this line:</p><div class="informalexample"><pre class="programlisting">GUIUtility.RotateAroundPivot(-rot, centerPoint);</pre></div><p>We're sticking a minus sign on the <code class="literal">rot</code> value—that's like multiplying a number by negative one. If we don't do this, the half-circle will rotate in the opposite direction (try it yourself! Nix the minus sign and try out your game).</p><p>Similarly, in this line:</p><div class="informalexample"><pre class="programlisting">GUIUtility.RotateAroundPivot(-rot-180, centerPoint);</pre></div><p>We're using the negative <code class="literal">rot</code> value, and we're subtracting 180 degrees. That's because the left half-circle is on the other side of the clock. Again, try getting rid of the <code class="literal">-180</code> and see what effect that has on your clock.</p><p>Another thing that you may want to try is changing the <code class="literal">centerPoint</code> value. Our pie clock graphics are 128x128 pixels, so the center point is at 64, 64. Mess around with that value and check out the funky stuff the clock starts doing.</p><div class="informalexample"><pre class="programlisting">GUI.matrix = startMatrix;</pre></div><p>It's worth mentioning that this line <a id="id606" class="indexterm"></a>locks the GUI back into position, based on the <code class="literal">startMatrix</code> value we stored.</p><div class="informalexample"><pre class="programlisting">GUI.DrawTexture(clockRect, leftSide, ScaleMode.StretchToFill, true,  0);  </pre></div><p>Did I catch you wondering what <code class="literal">ScaleMode.StretchToFill</code> was all about? There are three different settings you can apply here, all of which fill the supplied rectangle with the texture in a different way. Try looking them up in the Script Reference to read about what each one does.</p></div></div>