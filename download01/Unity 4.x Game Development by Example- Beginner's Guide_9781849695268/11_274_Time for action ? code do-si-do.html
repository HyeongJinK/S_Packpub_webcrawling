<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec272"></a>Time for action – code do-si-do</h2></div></div><hr /></div><p>Because the needs of our game have changed, we might reconsider how and where our code is written. In The Break-Up, it made sense for the player character to detect all collisions. But in Shoot the Moon, all the significant collisions actually happen on the enemy ship. The enemy ship has to know when it hits the hero ship, and it needs to know when it hits a<a id="id873" class="indexterm"></a> bullet. So we can actually localize all of the collision code on the enemy ship. This makes a lot of sense, so let's make that change by transplanting some code:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>HeroShip</strong></span> Script, delete the <code class="literal">OnCollisionEnter</code> function.</p></li><li><p>Delete the <code class="literal">explosion</code> variable declaration from the top of the script.</p></li><li><p>Save the <span class="strong"><strong>HeroShip</strong></span> Script.</p><p>As we did with the <code class="literal">ResetPosition()</code> function, let's build a reusable <code class="literal">Explode()</code> function, and fold the explosion-related code into it.</p></li><li><p>In the <span class="strong"><strong>EnemyShip</strong></span> Script, create an <code class="literal">Explode()</code> function outside and apart from the other functions:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  function Explode()</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>  audio.PlayOneShot(audioClips[Random.Range(0,audioClips.length)]);</strong></span>
<span class="strong"><strong>   Instantiate(prefab, transform.position, Quaternion.identity);</strong></span>
<span class="strong"><strong>  }</strong></span>
</pre></div></li><li><p>Give the <span class="strong"><strong>EnemyShip</strong></span> an <code class="literal">OnCollisionEnter</code> function, and call the <code class="literal">Explode</code> and <code class="literal">ResetPosition</code> functions. The enemy ship will explode regardless of what it hits:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  function OnCollisionEnter(col : Collision) {</strong></span>
<span class="strong"><strong>     Explode();</strong></span>
<span class="strong"><strong>     ResetPosition();</strong></span>
<span class="strong"><strong>  }</strong></span>
</pre></div></li><li><p>Next, we'll set up a conditional statement in the <code class="literal">OnCollisionEnter</code> function to determine whether the enemy ship has hit a bullet, or the hero ship:</p><div class="informalexample"><pre class="programlisting">function OnCollisionEnter(col : Collision) {
  Explode();
  ResetPosition();
<span class="strong"><strong>  if(col.gameObject.tag == "bullet") {</strong></span>
<span class="strong"><strong>    Destroy(col.gameObject);</strong></span>
<span class="strong"><strong>  } else if (col.gameObject.tag == "heroShip") {</strong></span>
<span class="strong"><strong>    // This enemy ship hit the player!</strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div></li><li><p>At the very top of the <span class="strong"><strong>EnemyShip</strong></span> Script, rename the <code class="literal">prefab</code> variable <code class="literal">explosion</code>:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>  var explosion:GameObject;</strong></span>
</pre></div></li><li><p>Change the <code class="literal">Explode()</code> function to call the new variable:</p><div class="informalexample"><pre class="programlisting">    Instantiate(<span class="strong"><strong>explosion</strong></span>, transform.position, Quaternion.identity);</pre></div></li><li><p>Save the script.</p></li><li><p>Since <a id="id874" class="indexterm"></a>we changed the name of our <code class="literal">prefab</code> variable to <code class="literal">explosion</code>, we should duck out to the <span class="strong"><strong>Inspector</strong></span> panel and make sure that the <span class="strong"><strong>Explosion</strong></span> Prefab is still set as the proper value. Changing variable names like this can sometimes cause Unity to lose track of things. Drag and drop the <span class="strong"><strong>Explosion</strong></span> Prefab into the <code class="literal">explosion</code> variable's slot to bring Unity back up to its speed.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec107"></a>
<span class="emphasis"><em>What just happened – eat lead</em></span>
</h3></div></div></div><p>Try out the game. When the enemy ship hits either a bullet or the hero ship, it runs the <code class="literal">Explode()</code> function<a id="id875" class="indexterm"></a> and repositions itself at the top of the screen. Specifically, if it hits a bullet, the bullet gets destroyed. If it hits the hero ship, it looks like it's behaving properly. But if you try putting a <code class="literal">print</code> command inside the conditional that says <code class="literal">//This enemy ship hit the player!</code>, you'll realize that the code isn't getting executed.</p><p>This is because we haven't tagged the <span class="strong"><strong>HeroShip</strong></span>. Without that tag, our <span class="strong"><strong>EnemyShip</strong></span> Script has no idea that it hit the hero ship. It just knows that it's hit <span class="emphasis"><em>something</em></span>, so it shows an explosion and bounces back up to the top of the screen. You may notice a small but unwanted side effect of our code. Because we're instantiating the explosion using the enemy ship's <code class="literal">transform.position</code>, the explosion appears exactly where the enemy ship used to be. This makes sense when a bullet hits the enemy ship, but it doesn't quite make sense when the enemy ship hits the hero. It makes it seem as though the hero ship is impenetrable—that anything that crashes into it will burst into flames. It's actually the HERO ship's position that we need for that explosion.</p><p>Thankfully, this is a quick fix using the maaaagic of aaarguments.</p></div></div>