<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec59"></a>Background music</h2></div></div><hr /></div><p>The first <a id="id483" class="indexterm"></a>part of audio that we will cover will be the background music. Having music in your background can set the mood of a scene, keep the player entertained on a subconscious level, or even be gameplay mechanics that the player interacts with. We will create a dynamic system that will allow us to play songs randomly or in a playlist style.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec112"></a>Creating a random system</h3></div></div></div><p>The first <a id="id484" class="indexterm"></a>step in creating our background <a id="id485" class="indexterm"></a>music system will be to create a new C# script and name it <code class="literal">BG_Music_Manager</code>. Before we start scripting, add the <code class="literal">using</code> statement to the top of the script using the other <code class="literal">using</code> statements:</p><div class="informalexample"><pre class="programlisting">Using System.Collections.Generic;</pre></div><p>We will need<a id="id486" class="indexterm"></a> the <code class="literal">using</code> statement so that we can use lists. Next, we will create a few variables and add these to our script:</p><div class="informalexample"><pre class="programlisting">public List&lt;AudioClip&gt; SongList = new List&lt;AudioClip&gt;();
public float bgVolume = 1.00f;
public int curSong = 0;
public int ranMin, ranMax;
public bool playRandomly = false;</pre></div><p>Our first<a id="id487" class="indexterm"></a> variable is a list of audio clips, which <a id="id488" class="indexterm"></a>we will use to hold the songs that we want to play in our game. The next variable is <code class="literal">float</code>, which will determine how loud our music is. The <code class="literal">int</code> variable after that will be used as an iterator for the playlist system when we implement it. The next two integers will be used for our random music system. Finally, the last variable we have is a Boolean value that we will set to pick the system we want for our background music. Now, we will add the function that will play a random song from our list:</p><div class="informalexample"><pre class="programlisting">void PlayRandom()
{
  if(!audio.isPlaying)
  {
    audio.clip = SongList[Random.Range(ranMin, ranMax)];
    audio.Play();
  }
}</pre></div><p>Before we play a song, we check to see if there is a song playing currently. If there is no song playing, we select a song and play it. To select a song, we grab one from our <code class="literal">AudioClip</code> list randomly. To get the random number, we use the minimum and maximum variables we created earlier and place them inside the <code class="literal">Range</code> function of the <code class="literal">Random</code> class. Using this function will get us a random number between our variables. Once we have a song assigned, we play it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec113"></a>Adding a playlist system</h3></div></div></div><p>Next, we <a id="id489" class="indexterm"></a>will add our function that will run<a id="id490" class="indexterm"></a> the playlist:</p><div class="informalexample"><pre class="programlisting">void Playlist()
{
  if(!audio.isPlaying)
  {
    if(curSong &gt; SongList.Capacity)
    {
      curSong = 0;
    }
    else
    {
      curSong++;
    }
    audio.clip = SongList[curSong];
    audio.Play();
  }
}</pre></div><p>The first<a id="id491" class="indexterm"></a> thing that we check for when running this<a id="id492" class="indexterm"></a> function is if there is already a song playing. If there is a song playing, the code will wait until the song stops; if there is no song playing, our code gets executed. To execute the code, we use the iterator variable that we created earlier; if the value is higher than the number of songs we have, we reset it to zero.</p><p>If the value of the iterator variable is less than the number of songs we have, then we iterate it and move on to selecting our song. To select the next song to be played, we grab it from the <code class="literal">AudioClip</code> list and assign it to the <code class="literal">clip</code> property of the GameObject's <code class="literal">AudioSource</code> component. Lastly, we<a id="id493" class="indexterm"></a> call the <code class="literal">Play</code> function of <code class="literal">AudioSource</code> to play the song.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec114"></a>Implementing the audio systems</h3></div></div></div><p>Now that <a id="id494" class="indexterm"></a>we have created our two<a id="id495" class="indexterm"></a> systems to play music, we will need to finish off our script with a few other features. First, we will create the <code class="literal">Start</code> and <code class="literal">Update</code> functions as they will be needed for this script to work:</p><div class="informalexample"><pre class="programlisting">void Start()
{
  audio.volume = bgVolume;
  ranMax = SongList.Count;
}
  
void Update()
{
  if(playRandomly)
    PlayRandom();
  else
    Playlist();
}</pre></div><p>In the <code class="literal">Start</code> function, we assign the volume of <code class="literal">AudioSource</code> to our <code class="literal">volume</code> variable. Next, we <a id="id496" class="indexterm"></a>set the maximum value to<a id="id497" class="indexterm"></a> the variable for our random function to the amount of songs that we have in our list. In the <code class="literal">Update</code> function, we call the functions that actually<a id="id498" class="indexterm"></a> play the music. To do this, we check the <code class="literal">bool</code> variable that we created earlier to decide which system to use.</p><p>An added feature we can place in our script will allow us to play a single song repeatedly. Add this function to the script:</p><div class="informalexample"><pre class="programlisting">void PlayRepeat(AudioClip Song)
{
  audio.clip = Song;
  audio.loop = true;
  audio.Play();
}</pre></div><p>This function will take the <code class="literal">AudioClip</code> value, which will be the song to be played. Next, we assign the song to <code class="literal">AudioSource</code>, set its looping property to <code class="literal">true</code>, and finally, play it.</p><p>The last feature that we will add to our script will allow us to change the speed of the song by using <a id="id499" class="indexterm"></a>the <code class="literal">pitch</code> property. Add this function to the script:</p><div class="informalexample"><pre class="programlisting">void ChangeSpeed(float Speed)
{
  if(Speed &gt; 3)
    Speed = 3;

  if(Speed &lt; -3)
    Speed = -3;

  audio.pitch = Speed;
}</pre></div><p>This function takes a float variable, which will be used to determine the speed of the song. The maximum speed value is <code class="literal">3</code>, the minimum value is <code class="literal">-3</code>, and the default value is <code class="literal">1</code>. When the speed is changed with this function, we check to make sure that the new value is <a id="id500" class="indexterm"></a>within these boundaries. Once we check the value and it is correct, we set the pitch of <code class="literal">AudioSource</code> to the new speed.</p></div></div>