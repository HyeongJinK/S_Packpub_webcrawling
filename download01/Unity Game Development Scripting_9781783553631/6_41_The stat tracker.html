<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec43"></a>The stat tracker</h2></div></div><hr /></div><p>Our next <a id="id350" class="indexterm"></a>step is to give our stat tracker all the functionalities that we need. Here, we will create methods to set and reset stats, set and reset <code class="literal">PlayerPrefs</code>, and save <code class="literal">PlayerPrefs</code>. Finally, we create a way to show our stats on the screen. <code class="literal">Playerprefs</code> are functions built in Unity that allow storage of strings, integers, and floats <a id="id351" class="indexterm"></a>using a system similar to <code class="literal">Dictionary</code> or <code class="literal">KeyValuePair</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec82"></a>Setting the stats</h3></div></div></div><p>The first<a id="id352" class="indexterm"></a> function that we will create will allow us to set values<a id="id353" class="indexterm"></a> to specific stats. Add this function to your script:</p><div class="informalexample"><pre class="programlisting">void SetStat(string stat, int intValue = 0)
{
  switch(stat)
  {
  case "Kills":
    pKills+= intValue;

    float fKills = pKills;
    float fDeaths = pDeaths;if(fKills != 0)
      pKDR = fDeaths / fKills;
    break;
  case "Deaths":
    pDeaths+= intValue;

    float fKills2 = pKills;
    float fDeaths2 = pDeaths;if(fKills2 != 0)
      pKDR = fDeaths2 / fKills2;
    break;
  case "TotalGold":
    pTotalGold+= intValue;
    break;
  case "CurrentGold":
    pCurrentGold+= intValue;
    break;
  case "GoldSpent":
    pGoldSpent+= intValue;
    break;
  case "Level":
    pLevel+= intValue;
    break;
  case "RoundsWon":
    pRoundsWon+= intValue;

    float fWins = pRoundsWon;
    float fLosses = pRoundsLost;if(fWins != 0)
      pWLR = fLosses / fWins;
    break;
  case "RoundsLost":
    pRoundsLost+= intValue;

    float fWins2 = pRoundsWon;
    float fLosses2 = pRoundsLost;if(fWins2 != 0)
      pWLR = fLosses2 / fWins2;
    break;
  case "TimePlayed":
    pTimePlayed+= fltValue;
    break;
  }
}</pre></div><p>What this <a id="id354" class="indexterm"></a>function does is to first take two parameters, the stat we <a id="id355" class="indexterm"></a>want to modify and an integer value. The integer is set to <code class="literal">0</code> by default; this is to help avoid possible errors. Next, we run a <code class="literal">switch</code> statement based on the <code class="literal">stat</code> string that we passed to decide which of our stats we want to modify.</p><p>Kills, deaths, rounds won, and rounds lost have some unique properties. When we set them, we add the new value to the stat, and then we calculate a ratio. When we set kills and deaths, we also do a bit of math to assign the kill-death ratio stat. For rounds won and lost, we also set the rounds won-lost ratio.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec83"></a>Resetting the stats</h3></div></div></div><p>To reset <a id="id356" class="indexterm"></a>our stats, we will add a basic but important function<a id="id357" class="indexterm"></a> to our script, shown as follows:</p><div class="informalexample"><pre class="programlisting">void ResetStats()
{
  pKills = 0;
  pDeaths = 0;
  pTotalGold = 0;
  pCurrentGold = 0;
  pGoldSpent = 0;
  pLevel = 1;
  pRoundsWon = 0;
  pRoundsLost = 0;
  pKDR = 0.00f;
  pWLR = 0.00f;
  pTimePlayed = 0.00f;
}</pre></div><p>When this function is called, it will reset all of our stats to their base value. This value is <code class="literal">0</code> for <a id="id358" class="indexterm"></a>everything but the player's level, which is <code class="literal">1</code>. If we wanted <a id="id359" class="indexterm"></a>to reset a specific stat to its base value, we can call the previous function that we created, which is <code class="literal">SetStat</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec84"></a>Resetting all of our prefs</h3></div></div></div><p>To save<a id="id360" class="indexterm"></a> our stats, we will use Unity's <code class="literal">PlayerPrefs</code>. These are<a id="id361" class="indexterm"></a> a handy way to save small bits of data. They can be used across several platforms and are easy to use. Our first function that we'll create will let us reset our <code class="literal">PlayerPrefs</code> value. Add this function to the script:</p><div class="informalexample"><pre class="programlisting">void ResetAllPrefs()
{
  PlayerPrefs.SetInt("PlayerKills", 0);
  PlayerPrefs.SetInt("PlayerDeaths", 0);
  PlayerPrefs.SetInt("PlayerTotalGold", 0);
  PlayerPrefs.SetInt("PlayerCurrentGold", 0);
  PlayerPrefs.SetInt("PlayerGoldSpent", 0);
  PlayerPrefs.SetInt("PlayerLevel", 0);
  PlayerPrefs.SetInt("PlayerRoundsWon", 0);
  PlayerPrefs.SetInt("PlayerRoundsLost", 0);
  PlayerPrefs.SetFloat("PlayerKDR", 0.00f);
  PlayerPrefs.SetFloat("PlayerWLR", 0.00f);
  PlayerPrefs.SetFloat("PlayerTimePlayed", 0.00f);
  PlayerPrefs.Save();
}</pre></div><p>What this function does is set each <code class="literal">PlayerPref</code> value to its base value. When they are all reset, we call a native <code class="literal">Save</code> function within <code class="literal">PlayerPrefs</code> to save our new values.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec85"></a>Saving all of our prefs</h3></div></div></div><p>The next <a id="id362" class="indexterm"></a>function that we will create will allow us to save all<a id="id363" class="indexterm"></a> of our <code class="literal">PlayerPrefs</code> values. This will be done in a similar way to how we reset all <code class="literal">PlayerPrefs</code>. Let's add this new function now:</p><div class="informalexample"><pre class="programlisting">void SaveAllPrefs()
{
  PlayerPrefs.SetInt("PlayerKills", pKills);
  PlayerPrefs.SetInt("PlayerDeaths", pDeaths);
  PlayerPrefs.SetInt("PlayerTotalGold", pTotalGold);
  PlayerPrefs.SetInt("PlayerCurrentGold", pCurrentGold);
  PlayerPrefs.SetInt("PlayerGoldSpent", pGoldSpent);
  PlayerPrefs.SetInt("PlayerLevel", pLevel);
  PlayerPrefs.SetInt("PlayerRoundsWon", pRoundsWon);
  PlayerPrefs.SetInt("PlayerRoundsLost", pRoundsLost);
  PlayerPrefs.SetFloat("PlayerKDR", pKDR);
  PlayerPrefs.SetFloat("PlayerWLR", pWLR);
  PlayerPrefs.SetFloat("PlayerTimePlayed", pTimePlayed);
  PlayerPrefs.Save();
}</pre></div><p>This <a id="id364" class="indexterm"></a>function is essentially the same as the <code class="literal">ResetAllPrefs</code> function, except <a id="id365" class="indexterm"></a>we change the value at which we assign <code class="literal">PlayerPrefs</code>. We assign all of the <code class="literal">PlayerPrefs</code> functions their appropriate stats, and then at the end of the function, we save the <code class="literal">PlayerPrefs</code> values.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec86"></a>Setting a specific pref</h3></div></div></div><p>To set <a id="id366" class="indexterm"></a>a specific pref, we will create a function similar to<a id="id367" class="indexterm"></a> how we set a specific stat. Add this function to the script:</p><div class="informalexample"><pre class="programlisting">void SetPref(string Pref, int intValue = 0, float fltValue = 0.00f)
{
  if(intValue != 0)
  {
    if(PlayerPrefs.HasKey(Pref))
      PlayerPrefs.SetInt(Pref, intValue);
  }
  if(fltValue != 0.00f)
  {
    if(PlayerPrefs.HasKey(Pref))
      PlayerPrefs.SetFloat(Pref, fltValue);
  }
    
  PlayerPrefs.Save();
}</pre></div><p>This function will take the <code class="literal">PlayerPref</code> function we want to set and also a value that we want to set it to. Inside the function, we will check to see which value is not set to <code class="literal">0</code>. If one of the values are still <code class="literal">0</code>, we ignore that value type. If one of the values is not <code class="literal">0</code>, we check to see whether the <code class="literal">PlayerPref</code> function passed to the function exists. If that function exists, we then set the <code class="literal">PlayerPref</code> value accordingly and finish off by saving our <code class="literal">PlayerPrefs</code> values.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec87"></a>Resetting a specific pref</h3></div></div></div><p>What if <a id="id368" class="indexterm"></a>you wanted to reset a specific PlayerPref value? For<a id="id369" class="indexterm"></a> this, we will create a slightly different function that will allow us to do that. Add this new function to our script:</p><div class="informalexample"><pre class="programlisting">void ResetPref(string Pref)
{
  switch(Pref)
  {
  case "Kills":
    PlayerPrefs.SetInt("PlayerKills", 0);
    break;
  case "Deaths":
    PlayerPrefs.SetInt("PlayerDeaths", 0);
    break;
  case "TotalGold":
    PlayerPrefs.SetInt("PlayerTotalGold", 0);
    break;
  case "CurrentGold":
    PlayerPrefs.SetInt("PlayerCurrentGold", 0);
    break;
  case "GoldSpent":
    PlayerPrefs.SetInt("PlayerGoldSpent", 0);
    break;
  case "Level":
    PlayerPrefs.SetInt("PlayerLevel", 0);
    break;
  case "RoundsWon":
    PlayerPrefs.SetInt("PlayerRoundsWon", 0);
    break;
  case "RoundsLost":
    PlayerPrefs.SetInt("PlayerRoundsLost", 0);
    break;
  case "KDR":
    PlayerPrefs.SetFloat("PlayerKDR", 0.00f);
    break;
  case "WLR":
    PlayerPrefs.SetFloat("PlayerWLR", 0.00f);
    break;
  case "TimePlayed":
    PlayerPrefs.SetFloat("PlayerTimePlayed", 0.00f);
    break;
  }
    
  PlayerPrefs.Save();
}</pre></div><p>For this <a id="id370" class="indexterm"></a>function, we pass one variable that we want<a id="id371" class="indexterm"></a> to reset, which is <code class="literal">PlayerPref</code>. Then, we run a <code class="literal">switch</code> statement for the string that we passed to decide which <code class="literal">PlayerPref</code> function to reset. After we reset <code class="literal">PlayerPref</code>, we save it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec88"></a>Showing our stats on the screen</h3></div></div></div><p>Our<a id="id372" class="indexterm"></a> final <a id="id373" class="indexterm"></a>step <a id="id374" class="indexterm"></a>in creating our stats is to show them on the screen. To do this, we will need to first add a couple of more variables:</p><div class="informalexample"><pre class="programlisting">public bool showStats = false;
public Rect statsRect = new Rect(Screen.width / 2, Screen.height / 2, 400, 400);</pre></div><p>The new <code class="literal">bool</code> variable<a id="id375" class="indexterm"></a> will decide whether we can show the stats menu, and the <code class="literal">Rect</code> variable is the area in which the stats menu will be. Next, we will add the <code class="literal">OnGUI</code> function<a id="id376" class="indexterm"></a> that will draw our GUI on the screen:</p><div class="informalexample"><pre class="programlisting">void OnGUI()
{
  if(showStats)
  {
    statsRect = GUI.Window(0, statsRect, StatsGUI, "Stats");
  }
}</pre></div><p>In the <code class="literal">OnGUI</code> function, we check the <code class="literal">showStats</code> Boolean variable to see whether or not the stats menu will be seen on the screen. You can see that it calls a function named <code class="literal">StatsGUI</code>. This function is what draws everything to the screen; let's add that function now:</p><div class="informalexample"><pre class="programlisting">void StatsGUI(int ID)
{
  GUILayout.BeginArea(new Rect(15, 25, 400, 400));
    
  GUILayout.BeginVertical();
  GUILayout.Label("Level - " + pLevel);
  GUILayout.Label("Gold - " + pCurrentGold);
  GUILayout.Label("Kills - " + pKills);
  GUILayout.Label("Deaths - " + pDeaths);
  GUILayout.Label("Kill/Death Ratio - " + pKDR);
  GUILayout.Label("Rounds Won - " + pRoundsWon);
  GUILayout.Label("Rounds Loss - " + pRoundsLost);
  GUILayout.Label("Win/Loss Ratio - " + pWLR);
  GUILayout.Label("Time Played (in minutes) - " + (pTimePlayed / 60.00f));
  GUILayout.EndVertical();
    
  GUILayout.EndArea();
}</pre></div><p>To draw <a id="id377" class="indexterm"></a>our <a id="id378" class="indexterm"></a>stats<a id="id379" class="indexterm"></a> on the screen, we use labels to show some text as well as the associating variables. For the <code class="literal">Time Played</code> stat, we divide it by 60 so it will show how many minutes have passed. In Unity, time is tracked by seconds, so we show minutes instead so that there isn't a large and possibly confusing number shown to the player.</p><p>To give our script a quick test, create a new scene and place the script onto the camera. Be sure to set the <code class="literal">showStats</code> Boolean variable to <code class="literal">true</code> in the <span class="strong"><strong>Inspector</strong></span> window. You should see this on your screen:</p><div class="mediaobject"><img src="/graphics/9781783553631/graphics/3631OT_06_01.jpg" /></div><p>Each of the stats we wanted to track is now shown on the screen in a vertical list. Later in this book, when<a id="id380" class="indexterm"></a> we <a id="id381" class="indexterm"></a>put<a id="id382" class="indexterm"></a> everything together to finish our game, we will tie this into our menu system.</p></div></div>