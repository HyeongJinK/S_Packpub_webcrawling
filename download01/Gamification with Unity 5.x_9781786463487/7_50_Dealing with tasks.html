<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec49"></a>Dealing with tasks</h2></div></div><hr /></div><p>In this section, we are going to explore how the user can interact with Tasks, how he or she can visualize them, and how to create new ones as well.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec87"></a>A prefab as Task panel</h3></div></div></div><p>Since the user can create more than one task and we would like to show them in a nice way, we need to create a reusable Task panel. Prefabs are great for reusable objects; therefore, we are going to use one.</p><p>First of all, we have to actually create a Task panel in our <span class="strong"><strong>Scene</strong></span> before moving it into a prefab. The general idea is that the Task panel should show all the essential information about a task. This includes the name of the task, its icon, its priority, as well as the expire date. This is the overall design that we would like to achieve:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_024.jpg" /></div><p>
</p><p>Let's start by creating a new UI image, and use the background in <span class="strong"><strong>icons-task</strong></span> as a sprite. Rename it <code class="literal">Task Panel</code>. We should have something like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_025.jpg" /></div><p>
</p><p>We need to add a new image for the icon on the left, and another one for the priority on the right. Rename the <span class="strong"><strong>Icon</strong></span> and <code class="literal">Priority</code>. At the moment, you can just leave the default ones by properly scaling them, or use placeholder graphics, as in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_026.jpg" /></div><p>
</p><p>Of course, don't forget to parent them to <span class="strong"><strong>TaskPanel</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_027.jpg" /></div><p>
</p><p>Now, we need to add three text components. One is for the title, one is for the due date, and a third one is for the status. In fact, the status could be <span class="emphasis"><em>pending</em></span>, <span class="emphasis"><em>expired,</em></span> or <span class="emphasis"><em>completed</em></span>. Change the names of the text components to <span class="strong"><strong>Title</strong></span>, <span class="strong"><strong>Due</strong></span>, and <span class="strong"><strong>Status</strong></span>. Don't forget to change them to fit in the visual aspect you have in mind for your application. These changes may include the font and the color, as indicated in the game design document. At the moment, we can use some text placeholders to see how they will look. You need to place them as in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_028.jpg" /></div><p>
</p><p>To make it easier to visualize, here is a zoomed-in screenshot to see the placement within the Task panel:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_029.jpg" /></div><p>
</p><p>So far so good, but there is still a component missing. The Task panel will be a child of <span class="strong"><strong>TaskDiplayer</strong></span>, which contains a <span class="strong"><strong>Vertical Layout Group</strong></span> component. As a result, it will handle how the Task panel looks. However, we need to tell it how. To achieve this, we can use a <span class="strong"><strong>Layout Element</strong></span> component. Select the <span class="strong"><strong>Task Panel</strong></span>, and click on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Layout</strong></span> | <span class="strong"><strong>Layout Element</strong></span>. Then, we need to check <span class="strong"><strong>Min Width</strong></span>, <span class="strong"><strong>Min Height</strong></span>, <span class="strong"><strong>Preferred Width</strong></span>, and <span class="strong"><strong>Preferred Height</strong></span>. Based on the dimensions of the Task panel, insert its width and height, repeated for the four variables. In this case, we have a width of <code class="literal">282</code> and a height of <code class="literal">60</code>. The component should look as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_030.jpg" /></div><p>
</p><p>The next step is to create a script that updates all of these components with a task. Therefore, let's create a script. Right-click in the <span class="strong"><strong>Project</strong></span> panel and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>C# Script</strong></span>. You can rename it <code class="literal">TaskPanelScript</code>. Finally, add it to the <span class="strong"><strong>TaskPanel</strong></span> and double-click on the script to open it. We need to add the UI namespace to use the UI elements in our script. Therefore, let's add the following line at the beginning of the script:</p><pre class="programlisting">using UnityEngine.UI; 
</pre><p>Furthermore, we can remove both the <code class="literal">Start()</code> and <code class="literal">Update()</code> functions, since we don't need them. Then, we need to add a variable for the task that we want to represent, and hide it from the <span class="strong"><strong>Inspector</strong></span>, since we don't need to assign it from there:</p><pre class="programlisting">    [HideInInspector] 
    public Task task; 
</pre><p>In addition, we need a different variable for all the UI components that we created before in <span class="strong"><strong>TaskPanel</strong></span>:</p><pre class="programlisting">    public Image icon; 
    public Text title; 
    public Image priority; 
    public Text status; 
    public Text due; 
</pre><p>Since all of the icons and the images for the priority are stored in the Task manager, we need a reference to it as well, and to hide it from the <span class="strong"><strong>Inspector</strong></span>:</p><pre class="programlisting">    [HideInInspector] 
    public TaskManager taskManager; 
</pre><p>Now we have to create a function that retrieves all the data from the task and shows the task in the Task panel correctly. Therefore, we can write the following:</p><pre class="programlisting">    public void UpdateGraphics() { 
        title.text = task.title; 
        icon.sprite = taskManager.taskIcons[task.icon]; 
        priority.sprite = taskManager.taskPriorities[task.priority]; 
        status.text = "Status: " + task.Status(); 
        due.text = "Due: " + task.expireDate.Date.ToString("dd/MM/yy"); 
    } 
</pre><p>Plus, we also need a function to mark the task as completed and update the graphics again. So, we can have this:</p><pre class="programlisting">    public void taskCompleted() { 
        task.isCompleted = true; 
        UpdateGraphics(); 
    } 
</pre><p>Save the script, and come back to the <span class="strong"><strong>Inspector</strong></span>. Attach the script to the <span class="strong"><strong>Task Panel</strong></span> in the <span class="strong"><strong>Scene</strong></span>, and then assign all our variables, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_031.jpg" /></div><p>
</p><p>Once we have set all of these, we need to give the user the chance to mark this task as completed. Therefore, select the <span class="strong"><strong>Task Panel</strong></span> itself, at the root where the script is attached, and add a button component by clicking on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Button</strong></span>. As usual, change the <span class="strong"><strong>Transition</strong></span> to <span class="strong"><strong>None</strong></span>. Add a new event in the <span class="strong"><strong>On Click ()</strong></span> tab, and drag the script that we have just created into the object variable. For the function, select <span class="strong"><strong>TaskPanelScript</strong></span>.<span class="strong"><strong>taskCompleted</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_032.jpg" /></div><p>
</p><p>Now, it's time to create a new prefab. Right-click on the <span class="strong"><strong>Project</strong></span> panel and select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Prefab</strong></span>. We can rename it <code class="literal">TaskPanelPrefab</code>. Finally, drag and drop the <span class="strong"><strong>TaskPanel</strong></span> from our <span class="strong"><strong>Scene</strong></span> inside the prefab. It should now be blue, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_033.jpg" /></div><p>
</p><p>Now, we are ready to show single tasks, but first we need to handle all of them.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec88"></a>The Task manager</h3></div></div></div><p>We have defined what a Task is and created a <span class="strong"><strong>TaskPanel</strong></span> to display them; however, there is nothing that actually handles them. In our application, it's useful to create another script: a Task manager. As the name suggests, it helps to manage the tasks of the user in the application. It holds all the tasks of the user, keeps track of which ones are going to expire, and eventually removes them from the list.</p><p>Let's start by creating another script and naming it <code class="literal">TaskManager</code>. Here, we need to store all our tasks, and we can achieve it by using an <code class="literal">ArrayList</code> of tasks:</p><pre class="programlisting">    ArrayList tasks = new ArrayList(); 
</pre><p>Then, we need a reference to <code class="literal">taskDisplayer</code> as well as a reference to the prefab of the <span class="strong"><strong>TaskPanel</strong></span>:</p><pre class="programlisting">    public GameObject taskDisplayer; 
    public GameObject taskPanelPrefab; 
</pre><p>These last two variables must be set in the <span class="strong"><strong>Inspector</strong></span> in order to make our script work. Then, since <code class="literal">TaskManager</code> is the central hub for handling tasks, we need to also store the icons for the tasks as well as the images for the priority. So, let's add a couple of sprite arrays for them:</p><pre class="programlisting">    public Sprite[] taskIcons; 
    public Sprite[] taskPriorities; 
</pre><p>Now that we have defined our data, let's create a useful function to manipulate them. We can have a function that removes all completed tasks:</p><pre class="programlisting">    public void deleteCompleted() { 
        for (int i = tasks.Count - 1; i &gt;= 0; i--) { 
            if (((Task)tasks[i]).isCompleted) 
                tasks.RemoveAt(i); 
        } 
 
        OnEnable(); 
    } 
</pre><p>This function basically iterates in the <code class="literal">ArrayList</code> of Tasks and checks if they are completed. In this case, the function removes them from the array. First of all, you can see that the <code class="literal">for</code> loop is going backwards. The reason for this is that, when we remove from an array going backwards, it doesn't mess with the indexes while the script is looping on it. Second, at the end, we call the <code class="literal">OnEnable()</code> function, which basically resets the graphics. We are going to implement this function right now.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"></a>Note</h3><p>As an exercise, you can implement a function to remove expired tasks and update the graphics in a similar way. The logic is the same as before, the difference being that it checks for expired tasks rather than completed ones.</p></div><p>Every time <code class="literal">TaskManager</code> is enabled, it has to update the graphics. We can do this by implementing the <code class="literal">OnEnable()</code> function. Here, we need to remove all the previous <span class="strong"><strong>TaskPanels</strong></span> and create new ones parented to <code class="literal">taskDisplayer</code>. So, we can write the following:</p><pre class="programlisting">    void OnEnable() { 
        //Destroy all the previous tasks 
        for (int i = 0; i &lt; taskDisplayer.transform.childCount; i++) { 
            Destroy(taskDisplayer.transform.GetChild(i).gameObject); 
        } 
        if (tasks.Count &gt; 0) { 
            //Create a new task panel for each of them 
            foreach (Task t in tasks) { 
                GameObject temp = Instantiate(taskPanelPrefab); 
                temp.transform.SetParent(taskDisplayer.transform); 
                temp.GetComponent&lt;TaskPanelScript&gt;().task = t; 
                temp.GetComponent&lt;TaskPanelScript&gt;().taskManager = this; 
                temp.GetComponent&lt;TaskPanelScript&gt;().UpdateGraphics(); 
            } 
        } 
    } 
</pre><p>We have one more operation to implement! We need to provide the possibility of adding a new task to the tasks list. This can be done easily in the following way:</p><pre class="programlisting">    public void addTask(Task t) { 
        tasks.Add(t); 
    } 
</pre><p>Finally, we have completed the <code class="literal">TaskManager</code>. If you have followed this all through from start to finish, I now encourage you to take a break, and enjoy a nice beverage or something to eat, because you've earned it! In the next section, we will see how to allow the user to create new tasks.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec89"></a>Allowing the user to create new Tasks</h3></div></div></div><p>Now we have to create another page to allow the user to create a new task. As usual, it is a background image that is the root of our page. However, this time, the page should be on top of the lateral menu and its button. This is because we don't want the user to change the page while he or she is creating a task. At this stage, you should have acquired a good knowledge of the UI of Unity; therefore, this section explains what we need to do, but not step by step, as before. In fact, most of the steps needed are the same as when we created a button or an image.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec28"></a>Create Task button</h4></div></div></div><p>Near the bottom of the screen, place a button with the label <code class="literal">Create Task</code>. When the user clicks on this button, a new task will be created. As a result, the <code class="literal">TaskManager</code> list will be updated as well. It should be placed as in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_034.jpg" /></div><p>
</p><p>We need to create a new script in which the different variables will be set by the components we are going to create in the upcoming sections. Name the script <code class="literal">CreateTask</code> and open it.</p><p>To begin, we need to create four private variables, one for each aspect of a task:</p><pre class="programlisting">    private int priority; 
    private string title; 
    private string due; 
    private int icon; 
</pre><p>Since they are <code class="literal">private</code>, we need to create some functions to let the other components of the page update them:</p><pre class="programlisting">    public void setPriority(int p) { 
        priority = p; 
    } 
 
    public void setIcon(int i) { 
        icon = i; 
    } 
 
    public void setDue(string d) { 
        due = d; 
    } 
 
    public void setTitle(string t) { 
        title = t; 
    } 
</pre><p>Now, we also need a public variable, so set it in the <span class="strong"><strong>Inspector</strong></span>, to store the <code class="literal">TaskManager</code>:</p><pre class="programlisting">    public TaskManager taskManager; 
</pre><p>Finally, we need the function that will be called when the button is pressed. First, there is a series of checks (left as an exercise) to see if the data inserted by the user is valid. Then, a new task is created by using the data stored in the variables. In fact, these variables will be set while the user is inserting the data in the page to create the task. Therefore, we can write the following:</p><pre class="programlisting">    public void Create() { 
        //CHECKS! 
        DateTime date = DateTime.ParseExact(due, "dd/MM/yy", CultureInfo.InvariantCulture); 
        taskManager.addTask(new Task(title, icon, date, priority)); 
    } 
</pre><p>Save the script and attach it to the button. Don't forget to drag and drop <code class="literal">TaskManager</code> into the right variable as well.</p><p>Now, in the <span class="strong"><strong>On Click ()</strong></span> event tab, we need to add an event to trigger the last function we wrote in the script. Then, we need another couple of events to close the <span class="strong"><strong>Create Task Page</strong></span> and open the <span class="strong"><strong>Tasks Page</strong></span> again. This is the final result:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_035.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec29"></a>Delete task button</h4></div></div></div><p>What happens if the user doesn't want to create the task anymore? In this situation, we need to add a second button with the label <span class="strong"><strong>Cancel</strong></span>. In the <span class="strong"><strong>On Click ()</strong></span> event tab, just close the <span class="strong"><strong>New Task Page</strong></span> and open the <span class="strong"><strong>Tasks Page</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_036.jpg" /></div><p>
</p><p>The button should be placed here, next to <span class="strong"><strong>Create Task</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_037.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec30"></a>Adding the icon</h4></div></div></div><p>At the top of the page, we need to add a text label and an image, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_038.jpg" /></div><p>
</p><p>When the user clicks on the image, it changes, allowing the user to see the different options. Therefore, we need to add the button component to the image (<span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Button</strong></span>) and set the <span class="strong"><strong>Transition</strong></span> to <span class="strong"><strong>None</strong></span>.</p><p>Create a script named <code class="literal">SelectTaskIcon</code> and attach it to the image. Since we are going to use the UI image class, we need to add the following line at the beginning of our script:</p><pre class="programlisting">using UnityEngine.UI; 
</pre><p>In the script, we have two public variables to store <code class="literal">TaskManager</code> and <code class="literal">CreateTask</code>, and a private variable for a counter:</p><pre class="programlisting">    public TaskManager taskManager; 
    public CreateTask createTask; 
    private int counter; 
</pre><p>Then, we need to create a function that's called when the image is clicked. The counter is updated, the icon on the image is shifted, and the change is communicated to <code class="literal">CreateTask</code>. Please notice that the icons are taken from <code class="literal">TaskManager</code>:</p><pre class="programlisting">    public void OnClick() { 
        counter++; 
        if (counter == taskManager.taskIcons.Length) 
            counter = 0; 
        GetComponent&lt;Image&gt;().sprite = taskManager.taskIcons[counter]; 
        createTask.setIcon(counter); 
    } 
</pre><p>Save the script and set the two public variables in order to have the reference to <code class="literal">TaskManager</code> and <code class="literal">CreateTask</code>. Then, add a new event in the button component. Drag the script that we have just created into the object variable and select the function we created in the script from the drop-down menu, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_039.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec31"></a>Inserting the title</h4></div></div></div><p>Let's create a label, as before, and an input field where the user can insert the name of the task. Now, create a new event in the <span class="strong"><strong>End Edit (String)</strong></span> tab, and drag <code class="literal">CreateTask</code>. Select, in the dynamic parameters, the <span class="strong"><strong>setTitle()</strong></span> function, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_040.jpg" /></div><p>
</p><p>The final result in the <span class="strong"><strong>Scene</strong></span> view is shown here:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_041.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec32"></a>Inserting the Due date</h4></div></div></div><p>Similar to the previous section, we need to create a label and an input field where the user can insert the due date of the task. Then, we need to create a new event in the <span class="strong"><strong>End Edit (String)</strong></span> tab, then drag the <code class="literal">CreateTask</code> into it. Set the dynamic parameters in the <span class="strong"><strong>setDue()</strong></span> function, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_042.jpg" /></div><p>
</p><p>As a result, it should appear like the following in the <span class="strong"><strong>Scene</strong></span> view:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_043.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec33"></a>Selecting the Task priority</h4></div></div></div><p>For the task priority, we need to create four images, one for each priority: <span class="strong"><strong>Neutral</strong></span> (green), <span class="strong"><strong>Low</strong></span> (yellow), <span class="strong"><strong>Medium</strong></span> (orange), and <span class="strong"><strong>High</strong></span> (red). So, once we have used the sprite we want (you can choose the ones in the packages, or use one that you created in the previous chapter), we should place them as the following screenshot shows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_044.jpg" /></div><p>
</p><p>Add the button component to all of them, and set the <span class="strong"><strong>Transition</strong></span> to <span class="strong"><strong>None</strong></span>. Add a new event in the <span class="strong"><strong>On Click ()</strong></span> tab and drag <code class="literal">CreateTask</code> into the object variable. Finally, select <span class="strong"><strong>setPriority() </strong></span>as a function. However, we need to change the value for each priority. We have the value <code class="literal">0</code> for neutral, <code class="literal">1</code> for low, <code class="literal">2</code> for medium, and <code class="literal">3</code> for high.</p><p>If you want to, you can add another label to give some visual feedback to the user about the priority he or she has selected. In this case, you need to add another event to all the priorities and insert the label into the object variable. Then, select the text that the label will contain as a function and change the value for each priority. In the end, you should have all the event tabs set as follows, which, for the sake of simplicity, are combined into a single screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_045.jpg" /></div><p>
</p><p>By doing this, we have finished with the <span class="strong"><strong>Create a New Task</strong></span> page. Remember to save your file and take a break, because more exiting tasks await!</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec90"></a>Setting up the Tasks page</h3></div></div></div><p>Because you have already implemented the Task panel and the Task manager, it is simple to finish the Tasks page. First of all, attach the Task manager script to the page itself, if you didn't before. In fact, we have already placed a reference to it in the previous scripts. Therefore, before continuing, check if they are correct. Then, we need to assign its variables, such as the reference to <code class="literal">TaskDisplayer</code> and the prefab of the Task panel. Furthermore, remember to also assign icons in these variables that the user can select as icons for his or her tasks, and the priority. We should have something like the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_046.jpg" /></div><p>
</p><p>Now it's time to add some functionality to the two buttons on the page. In <span class="strong"><strong>Create Task</strong></span>, we just need to close the Tasks page and open the <span class="strong"><strong>Create Task Page</strong></span>, as shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_047.jpg" /></div><p>
</p><p>For the other button, we just need to call the function on the Task manager in order to delete all of the completed tasks, as in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_07_048.jpg" /></div><p>
</p><p>Finally, save the scene, and we should now have the entire task system working in our application.</p></div></div>