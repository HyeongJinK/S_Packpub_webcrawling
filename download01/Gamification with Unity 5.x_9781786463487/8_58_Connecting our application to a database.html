<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec56"></a>Connecting our application to a database</h2></div></div><hr /></div><p>In this section, we will explore the different options we have to connect our application to a database. Of course, we are going to see numerous options, but, for sure, this is a good start, especially for those who have never connected an application to a database before.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec107"></a>Why are databases important for playtesting?</h3></div></div></div><p>First of all, we need to understand why databases are important for playtesting. As we have seen in the previous sections, playtesting is mainly about collecting data from the players/users and using this data to improve our game. However, this data must to be stored somewhere, and that's why a database becomes handy.</p><p>In fact, we can store data locally, but this would limit the playtesting to only being in-studio, whereas having a database where our application can send data allows us to distribute beta or alpha versions among playtesters.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec108"></a>Services for databases</h3></div></div></div><p>Once we have decided to use a database for our application, we have two options: we develop a database on our own, or we use a service. Of course, the first solution is much more flexible, but it takes time, resources, and an entire other book to explain. For this reason, we will use an existing service. There are many different services for Unity, but for the project in this book, we are going to use a service called Playfab.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec109"></a>Playfab in Unity</h3></div></div></div><p>Playfab is a <span class="emphasis"><em>backend platform for games</em></span>. In fact, you can also handle more complex interactions rather than just being limited to storing and getting data. For instance, a user can register and get specific data, or analytics, that can be computed on your database.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_003.jpg" /></div><p>
</p><p>Another great thing is that Playfab is free. There are some paid plans that offer more features. However, for the sake of this book, the free plan is more than enough. You can download it from their site, <a class="ulink" href="https://playfab.com/" target="_blank">https://playfab.com/</a>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_004.jpg" /></div><p>
</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec48"></a>Downloading the SDK from the website</h4></div></div></div><p>Playfab is not limited to Unity, but also works with other different platforms or development environment. Therefore, the first thing to do is to download the SDK from the website. You can download it from the following link:</p><p>
<a class="ulink" href="https://playfab.com/unity-sdk-v2-released/" target="_blank">https://playfab.com/unity-sdk-v2-released/</a>
</p><p>You need to click on <span class="strong"><strong>SDK Here</strong></span>. For your convenience, it is highlighted in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_005.jpg" /></div><p>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec49"></a>Importing and setting the SDK in Unity for databases</h4></div></div></div><p>Be sure to have your project opened in Unity, and double-click on the file you have downloaded. Once you have done that, you should see the following import screen:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_006.jpg" /></div><p>
</p><p>Click on <span class="strong"><strong>Import</strong></span>, and wait for Unity to import everything. At the end, the package has added two additional folders, as shown in the following screenshot. One is called <span class="strong"><strong>PlayFabSdk</strong></span>, and the other one <span class="strong"><strong>Plugins</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_007.jpg" /></div><p>
</p><p>The <span class="strong"><strong>Plugins</strong></span> folder is a special folder in Unity, so you might already have it in the project. In any case, don't ever rename that folder or move the files within it. In fact, if you do, Unity is not able to detect the Playfab plugin anymore.</p><p>The next step is to register for a Playfab account. You can do it from this link:</p><p>
<a class="ulink" href="https://developer.playfab.com/en-us/sign-up" target="_blank">https://developer.playfab.com/en-us/sign-up</a>
</p><p>The whole process is pretty straightforward: all you need to do is provide your e-mail address, along with the password, twice, and accept the terms and conditions. Then, click on <span class="strong"><strong>CREATE A FREE ACCOUNT</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_008.jpg" /></div><p>
</p><p>Afterwards, Playfab gives you <span class="strong"><strong>Unnamed Studio</strong></span> with an <span class="strong"><strong>Unnamed Title</strong></span> as defaults. Feel free to change these to more meaningful names that suit your project:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781786463487/graphics/image_08_009.jpg" /></div><p>
</p><p>Furthermore, by clicking on the cog in the top right corner, you have access to the contextual menu.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec50"></a>Creating a login system for your users</h4></div></div></div><p>Now, that is everything set up, let's see how to create a login system using Playfab.</p><p>First, let's create a new C# script and name it <code class="literal">LoginWithPlayfab</code>. Then, double-click to open it. Every time we use Playfab, we need to specify this in our script by using the corresponding <code class="literal">using</code> statements. In our case, we need to add these two at the beginning of our script:</p><pre class="programlisting">using PlayFab; &#13;
using PlayFab.ClientModels; &#13;
</pre><p>Then, we need to initialize Playfab in the <code class="literal">Start()</code> function, by writing the following code:</p><pre class="programlisting">    void Start () { &#13;
        PlayFabSettings.TitleId = "YOUR TITLE ID"; &#13;
    } &#13;
</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note38"></a>Note</h3><p>Of course, instead of <code class="literal">YOUR TITLE ID</code>, insert yours. A quick note about <code class="literal">YOUR TITLE ID</code>: the ID will have been created when you registered your account.</p></div><p>Now, we need a variable to store the ID for the API calls after the login, so we can have the following code:</p><pre class="programlisting">public string PlayFabId; &#13;
</pre><p>Finally, we can write a function for the login, which takes the title id as a parameter. Here, we can write two functions/statements. The first one needs to create a data structure to send to the server, and the other one asks the server to log in. To make the data structure, we use <code class="literal">LoginWithCustomIDRequest()</code> and fill it up with <code class="literal">TitleId</code>, a flag to create a new account, and unique identifier. In our case, we can use the one given from <code class="literal">SystemInfo</code> as an identifier. Then, we need to make the call, and we check whether it is a new user or not with a couple of <code class="literal">if</code> statements:</p><pre class="programlisting">    void Login(string titleId) { &#13;
        LoginWithCustomIDRequest request = new LoginWithCustomIDRequest() { &#13;
            TitleId = titleId, &#13;
            CreateAccount = true, &#13;
            CustomId = SystemInfo.deviceUniqueIdentifier &#13;
        }; &#13;
 &#13;
        PlayFabClientAPI.LoginWithCustomID(request, (result) =&gt; { &#13;
            PlayFabId = result.PlayFabId; &#13;
            Debug.Log("The PlayFabID is: " + PlayFabId); &#13;
 &#13;
            if (result.NewlyCreated) { &#13;
                Debug.Log("new account has been created"); &#13;
            } &#13;
            else { &#13;
                Debug.Log("Logged in with an existing account"); &#13;
            } &#13;
        }, &#13;
        (error) =&gt; { &#13;
            Debug.Log("An error occured"); &#13;
            Debug.Log(error.ErrorMessage); &#13;
        }); &#13;
    } &#13;
</pre><p>Save the script, and if you wish, test it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec51"></a>Exchanging data</h4></div></div></div><p>Once we have the login working, the next step is to exchange data with the database. The Playfab API is extensive, and we cannot cover it all in this short paragraph. The following is a list of the common API calls:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>GetLeaderboard</p></li><li style="list-style-type: disc"><p>SendPushNotification</p></li><li style="list-style-type: disc"><p>GetPlayerStatistics</p></li><li style="list-style-type: disc"><p>GetCharacterInventory</p></li><li style="list-style-type: disc"><p>ConsumeItem</p></li><li style="list-style-type: disc"><p>AddFriend</p></li><li style="list-style-type: disc"><p>AddUserVirtualCurrency</p></li></ul></div><p>However, I encourage you to check out the official documentation, where you can find the basics of exchanging data with the database:</p><p>
<a class="ulink" href="https://api.playfab.com/docs/using-player-data" target="_blank">https://api.playfab.com/docs/using-player-data</a>
</p></div></div></div>