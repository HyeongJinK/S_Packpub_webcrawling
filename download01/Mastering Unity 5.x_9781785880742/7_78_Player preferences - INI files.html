<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec76"></a>Player preferences - INI files</h2></div></div><hr /></div><p>Now, let's consider the case of saving data using INI files instead of <code class="literal">PlayerPrefs</code>. INI files achieve a similar purpose to <code class="literal">PlayerPrefs</code>; storing key-value pairs. However, INI files contain all settings inside a single, human-readable text file. For this example, we'll work with the following INI file, which contains some basic settings for a sample game:</p><pre class="programlisting">[Player] 
; Basic Player Data 
Name=John Doe 
Gender=Male 
Level=50 
 
[Score] 
; Score information 
HighScore=8695088457694      
Player=John Doe 
LastScore=758596068896 
 
[Preferences] 
; Settings 
Resolution=1920x1080      
Volume=0.8 
FullScreen=true 
MouseSpeed=75 
</pre><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_07_008.jpg" /></div><p>
</p><p>INI Unity project included</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note51"></a>Note</h3><p>You can find a complete Unity project that works with INI files included in this book's companion files, in the INI files folder.</p></div><p>Unity offers no native functionality for reading and parsing INI files. Instead, you'll need to rely on third-party add-ons or external script files to read them. One example of a free script to read INI files is featured at <a class="ulink" href="http://blog.kennyist.com/?p=864" target="_blank">http://blog.kennyist.com/?p=864</a>. We'll use this script as a basis, and extend upon it to quickly and easily read an INI file. This script is included in the course companion files (<code class="literal">iniParser.cs</code>). It should be added to your project, and code comments follow.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec70"></a>Comments on iniParser.cs</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">iniParser</code> class is derived from <code class="literal">MonoBehaviour</code>. This means it can be attached to game objects as a component.</p></li><li style="list-style-type: disc"><p>The <code class="literal">iniFileName</code> public variable is a string representing the full name (minus path and extension) of the INI file to be saved and loaded.</p></li><li style="list-style-type: disc"><p>The <code class="literal">load</code> function opens an INI file, reads its contents, and parses those into an array of key-value pairs (<code class="literal">Keys</code> and <code class="literal">Vals</code>). This function is called once during <code class="literal">Awake</code>, as the level begins, to load the contents of a specified INI file.</p></li><li style="list-style-type: disc"><p>The Get function lets you search for an extant key by name, and then returns the associated value. This function should only be called after running <code class="literal">load,</code> to open the contents of an INI file into memory.</p></li><li style="list-style-type: disc"><p>The <code class="literal">Application.dataPath</code> native variable is provided by Unity and always represents a valid read-only storage location on the local computer where files can be loaded, regardless of operating system. If you need to save data permanently to the computer, the <code class="literal">Application.persistentDataPath</code> variable should be used instead. For more information on storage locations, see the online Unity documentation at: <a class="ulink" href="https://docs.unity3d.com/ScriptReference/Application-dataPath.html" target="_blank">https://docs.unity3d.com/ScriptReference/Application-dataPath.html</a>.</p></li><li style="list-style-type: disc"><p>The <code class="literal">load</code> function, in combination with the Set function, is where the magic happens. Together, these functions load the contents of the INI file into memory, parse the file line by line, and then construct an array of values in memory that are quickly and easily searchable.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note52"></a>Note</h3><p>The <code class="literal">#region</code> and <code class="literal">#endregion</code> directives of C# directives are used in code to group together related regions. You can further enhance your code editor and code display by using code folding.</p></div><p>Now drag and drop the script file onto an empty object in the scene, adding it as a component. Then use the filename field to specify an INI filename to load. This can refer to any sample INI file.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_07_009.jpg" /></div><p>
</p><p>Configuring the iniParser component</p><p>When testing from the Unity editor, the <code class="literal">Application.dataPath</code> variable normally refers to the project <code class="literal">Asset</code> folder, and for compiled runtime applications, it normally refers to the accompanying <code class="literal">Data</code> folder, alongside the executable file. For this reason, add an INI file to the <span class="strong"><strong>Project</strong></span> panel, inside the root <code class="literal">Asset</code> folder, to successfully test your project.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_07_010.jpg" /></div><p>
</p><p>Adding a testINI file to the project</p><p>Now run the application by pressing play on the toolbar, and you'll get a success message printed on the console, indicating that the INI file was properly loaded and its contents parsed into the arrays.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_07_011.jpg" /></div><p>
</p><p>Loading an INI file</p><p>Once loaded, you can access any key-value property with a call to the Get function. Simply specify the name of the key to retrieve. This function returns all values as strings; and it is not sensitive to variable type. This means you may need to convert the string to other data types, such asÂ integers and floats, depending on the data needed. This line can be called anywhere within the <code class="literal">iniParser</code> class:</p><pre class="programlisting">string Resolution = Get ("Resolution"); 
</pre><p>Excellent! You can now import and read user data from INI files, stored locally in either the <code class="literal">Data</code> or <code class="literal">PersistentData</code> paths. Great work! INI files offer a convenient and effective alternative to the <code class="literal">PlayerPrefs</code> class.</p></div></div>