<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec42"></a>Damage and feedback</h2></div></div><hr /></div><p>The <span class="strong"><strong>Health</strong></span> component allows objects to have health and therefore to take damage during attacks; but, we also want more UI feedback for the player during a battle. Specifically, when the player is attacked and hit by a zombie, the screen should throb or flash red, indicating that damage has been sustained. We can achieve this by using a colored sprite overlay whose opacity is animated from transparent to visible and then back again. To achieve this, create the colored overlay by choosing <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span> to create a new image object. Name this <code class="literal">Panel_Damage_Throbber</code>. Add this as a child object of the <code class="literal">Health UI Canvas</code> created previously. Select red for the <span class="strong"><strong>Color</strong></span> field to express danger, damage and pain, or you can use a custom texture.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_04_046.jpg" /></div><p>
</p><p>Creating a red, damage UI object</p><p>Use the <span class="strong"><strong>Rect </strong></span>Transform tool (<span class="emphasis"><em>T</em></span>), as shown in the following screenshot, to resize the image plane to fill the canvas, and thereby the screen. Then use anchoring to attach each corner anchor to the respective edges of the screen (stretch anchoring). This ensures the damage panel fully occupies screen space.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_04_047.jpg" /></div><p>
</p><p>Resize the damage panel overlay</p><p>To create the damage animation, simply open the <span class="strong"><strong>Animation</strong></span>
<span class="emphasis"><em> </em></span>window, add a new animation, and insert three key frames: one at the start of the animation, one in the middle, and one at the end. Each key frame animates the sprite color (alpha component). Start with an Alpha of <code class="literal">0</code>, move to <code class="literal">1</code>, and then back to <code class="literal">0</code> by the final frame. This creates a ping-pong, back and forth, for the alpha. Again, work within the <code class="literal">0</code>-<code class="literal">1</code> space for the animation duration, as the <span class="strong"><strong>Speed</strong></span> can always be tweaked from the mecanim graph.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_04_048.jpg" /></div><p>
</p><p>Creating a Throb animation</p><p>Flatten the key frame handles for the start and end frames, using the <span class="strong"><strong>Curves</strong></span> view in the animation editor to smooth out the fade, creating a more natural transition. You can also click and drag the handles in the editor to further refine the curve.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_04_049.jpg" /></div><p>
</p><p>Flattening keyframe handles to create smoother motion</p><p>Finally, add an animation controller to the damage object. This should begin in an idle node (empty state) and transition to the damage animation based on a trigger parameter: that is, by enabling a trigger parameter, the damage animation should play. The details of creating this kind of graph have been covered amply throughout this chapter and the previous chapter. The final graph should look like this:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_04_050.jpg" /></div><p>
</p><p>Creating an animation graph for the damage fader</p><p>To connect player health to the damage fader, select the <span class="strong"><strong>Player</strong></span> object and, from its health component, we can set the animation trigger for damage from the <span class="strong"><strong>OnHealthChanged</strong></span> event directly from the object <span class="strong"><strong>Inspector</strong></span>. Again, no additional code needed!</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_04_051.jpg" /></div><p>
</p><p>Link the OnHealthChanged event to the damage object</p><p>Great! Now health is linked to the damage effect. We can test this, if needed, by simply changing the player health at runtime.</p></div>