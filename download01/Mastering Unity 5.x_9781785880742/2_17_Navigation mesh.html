<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec21"></a>Navigation mesh</h2></div></div><hr /></div><p>Now it's time to explore NPC intelligence and, specifically, path finding. We'll need our NPC zombies to move around the scene intelligently; that is, to move without bumping into walls, floors, doors, and other obstacles, and without taking the most complex routes to nearby destinations. Our zombies must cleverly navigate their way around the environment, whatever its arrangement, finding their way toward the player to engage in combat, as though they really had brains! To achieve this, a navigation mesh is required. This is a nonvisible mesh asset, generated by Unity, to approximate the scene floor, for both exterior and interior environments. More accurately, it represents the total walkable floor of the scene-the area over which NPCs may maneuver for travelling from point to point. To access the navigation mesh features, click on <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Navigation</strong></span> from the application menu. This opens the <span class="strong"><strong>Navigation</strong></span> mesh window, which can be docked into the object <span class="strong"><strong>Inspector</strong></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_057.jpg" /></div><p>
</p><p>Accessing the navigation mesh features</p><p>The <span class="strong"><strong>Navigation</strong></span> mesh window is where you can generate a navigation mesh for the scene. At present, Unity allows you to generate only one navigation mesh per scene, and you cannot import a custom mesh. To get started, use the <span class="strong"><strong>Agent Radius</strong></span> and <span class="strong"><strong>Agent Height</strong></span> fields to specify the radius and height of the smallest possible agent for your game. These values are used by Unity to determine valid areas into which the navigation mesh can be generated. Openings shorter than, or narrower than, the minimum values cause the navigation mesh to break, preventing agents from travelling through. For Dead Keys, the <span class="strong"><strong>Agent Radius</strong></span> should be <code class="literal">0.5</code>, and the <span class="strong"><strong>Height</strong></span> should be <code class="literal">2</code>
<span class="strong"><strong>.</strong></span> For your own projects, these values may differ substantially.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_058.jpg" /></div><p>
</p><p>Specifying Agent Radius and Agent Height</p><p>Additionally, the <span class="strong"><strong>Max Slope</strong></span> field defines the angle (in degrees) of the maximum incline from ground level allowed. Inclines preceding this angle are classified as non-walkable areas and do not feature in the navigation mesh. The <span class="strong"><strong>Step Height</strong></span> works similarly, except it's based on height (in meters) rather than angle. That is, steps above the threshold are classified as too high for being walkable. For Dead Keys, the default values are acceptable, but for strongly vertical games you may need to tweak these. Having now defined these basic settings, click on the<span class="strong"><strong> Bake</strong></span> button from the <span class="strong"><strong>Navigation</strong></span> mesh window to generate a new navigation mesh.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_059.jpg" /></div><p>
</p><p>Baking a navigation mesh</p><p>Only objects with an active <span class="strong"><strong>Mesh Renderer</strong></span> component, and marked as <span class="strong"><strong>Navigation Static</strong></span>, are included in the navigation mesh bake. All other objects are excluded. To label an object as static, you can enable the <span class="strong"><strong>Static</strong></span> checkbox from the object <span class="strong"><strong>Inspector</strong></span>. You can also click on the static checkbox for a dropdown to be more precise about the applicability of static. This allows you to mark an object as static for navigation, but not for lightmapping, if necessary.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_060.jpg" /></div><p>
</p><p>Enabling Navigation Static</p><p>After the navigation mesh is generated, it appears inside the <span class="strong"><strong>Scene</strong></span> viewport as a blue mesh-based floor. This appears <span class="emphasis"><em>only if</em></span> the <span class="strong"><strong>Navigation</strong></span> window is open and the <span class="strong"><strong>Show NavMesh</strong></span> checkbox is enabled from the <span class="strong"><strong>Navmesh Display</strong></span> dialog. Remember, the navigation mesh is not visible to the player; it simply represents the walkable area of the scene for intelligent NPCs. A player controlled character is not restricted to the navigation mesh, and nor is an NPC that moves through its transform component.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_061.jpg" /></div><p>
</p><p>Previewing a navigation mesh</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>An important limitation of navigation meshes is that they are top-down based. That is, a navigation mesh is generated by projecting from the top downwards. In most cases, this works well. However, if you need characters to walk on walls and ceilings, then you'll need to develop a custom solution.</p></div><p>For Dead Keys, the floor is divided into only walkable and non-walkable areas, and all walkable areas are the same. This makes things simpler for us. But for some games, this simplicity is not applicable. In real-time strategy games, for example, there are many types of walkable areas, including sand, swamp, grass, rock, concrete, wood, and others. These terrain materials influence how easily a unit may walk on the terrain. In some cases, specific terrain types should be avoided, if preferable, even if it means taking a longer route. Lava is walkable, but dangerous compared to grass, for example. You can encode this preference behavior into a navigation mesh using Areas. By switching to the <span class="strong"><strong>Areas</strong></span> tab, you can define different terrain types, using a custom name, and assign a cost of travel to each type that is used to influence how a path is generated. Higher costs represents less desirable areas.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_062.jpg" /></div><p>
</p><p>Defining navigation mesh Areas</p><p>Having defined terrain types from the <span class="strong"><strong>Areas</strong></span> tab, you can assign specific types to meshes in the scene through the <span class="strong"><strong>Object</strong></span> tab. This tab lets you adjust navigation properties for the selected object in the scene. The <span class="strong"><strong>Navigation Area</strong></span> dropdown is where you assign a type to an object.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_063.jpg" /></div><p>
</p><p>Assign terrain types to objects</p><p>Great! We now have a navigation mesh in the scene. This exists as an independent asset of the project too, which can be found in the <span class="strong"><strong>Project</strong></span> panel<span class="emphasis"><em> </em></span>in the same folder as the saved scene. The navigation mesh does nothing in itself, that is, the existence of a navigation mesh has no tangible effect immediately on any game objects in the scene. Rather, it's an asset whose importance becomes apparent only as we add intelligent NPCs, such as zombies, to the level, which is covered in later chapters.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_02_064.jpg" /></div><p>
</p><p>Navmesh objects are saved as an asset</p></div>