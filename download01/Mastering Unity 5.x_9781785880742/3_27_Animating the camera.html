<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec29"></a>Animating the camera</h2></div></div><hr /></div><p>
<span class="emphasis"><em>Dead Keys</em></span> needs a first-person camera that's effectively on rails. The camera must slowly follow a pre determined path through the scene; its staggered movement from one location to the next is a sign of player progress. So far, a set of specific waypoints have been created (in the previous section), defining locations the camera stops at on its journey to engage with oncoming zombies. </p><p>To create this motion for the camera, multiple animations must be created; one for each journey between waypoints (one for A to B, then another for B to C, and then another for D to E, and so on). Before creating the animations, however, it's important to first structure your object hierarchy for the camera, as needed. Changes to your object hierarchy after creating an animation can invalidate how the animation works. I've used several empty objects nested in parent-child relationships, with camera objects as children, to create an organized and structured hierarchy. It takes the form of <span class="strong"><strong>Navigator</strong></span>
<span class="emphasis"><em> | </em></span>
<span class="strong"><strong>Player</strong></span>
<span class="emphasis"><em> | </em></span>
<span class="strong"><strong>Main Camera</strong></span>. The <span class="strong"><strong>Navigator</strong></span> and <span class="strong"><strong>Player</strong></span> objects are both empties and the <span class="strong"><strong>Navigator</strong></span> is the top-level player object that'll be animated through the level.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_006.jpg" /></div><p>
</p><p>Creating a player camera hierarchy</p><p>Now select the top most navigator object and display the <span class="strong"><strong>Animation</strong></span> window (not Animator) by choosing <span class="strong"><strong>Window</strong></span>
<span class="emphasis"><em> | </em></span>
<span class="strong"><strong>Animation</strong></span>. The <span class="strong"><strong>Animation</strong></span> window is a horizontal interface (viewed from left to right) and is best docked at the bottom of the editor.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_007.jpg" /></div><p>
</p><p>Showing the Animation window</p><p>Using the <span class="strong"><strong>Animation</strong></span> window, you can create, and then attach, multiple animations to the selected object. Click the <span class="strong"><strong>Create</strong></span> button from the <span class="strong"><strong>Animation</strong></span> window to make the first animation. Before clicking this, ensure the top-level navigator object is selected from the <span class="strong"><strong>Hierarchy</strong></span> panel. Unity prompts you to name the animation, which will be saved in the project as an animation clip asset. I've used the name <code class="literal">anim_Level01_camath_01</code>, as this specifies the asset type (<code class="literal">anim</code>), the scene applicability (<code class="literal">Level01</code>
<span class="emphasis"><em>)</em></span>, and the order it should be played in (<code class="literal">camath_01</code>). I recommend saving all animation clips to a dedicated <span class="strong"><strong>Animation</strong></span> folder in the <span class="strong"><strong>Project</strong></span> panel.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_008.jpg" /></div><p>
</p><p>Creating a new animation</p><p>Let's focus on the workflow for building our first travel animation, moving from Waypoint A to Waypoint B. To achieve this, use the <span class="strong"><strong>Animation</strong></span> window to create two new entries, listing the properties to be animated. In our case, the <span class="strong"><strong>Position</strong></span> and <span class="strong"><strong>Rotation</strong></span> of the player will be changed. Click the <span class="strong"><strong>Add Property</strong></span> button from the <span class="strong"><strong>Animation</strong></span> window, and then select <span class="strong"><strong>Transform</strong></span> | <span class="strong"><strong>
<span class="strong"><strong>Position</strong></span>
</strong></span> and <span class="strong"><strong>
<span class="strong"><strong>Transform</strong></span>
</strong></span>| <span class="strong"><strong>Rotation</strong></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_009.jpg" /></div><p>
</p><p>Adding properties for camera position and rotation</p><p>After adding both properties, key frames are auto generated for each, one for the first frame and one for the last. Key frames define the state of an object at a specified time. Initially, the generated frames hold the position and rotation for the player at the start and end of the animation. These key frames span the 0-1 range and their position should be left as is because we want key frames there. The time line is measured in seconds, thus 1 means 1 second after animation start, assuming the animation begins at 0. In general, always define animation key frames within the 0-1 range, unless you have an overriding reason not to, because it supports design elegance. Specifically, Unity lets you scale time in animations by a scalar, either up or down, to slow down and speed up animations. 0.5 means half speed, and 2 means double speed, and so on. Thus, by keeping animations within 0-1, you can always determine animation duration by scale alone; because <span class="emphasis"><em>1 x Scale = Scale</em></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_010.jpg" /></div><p>
</p><p>Keep key frames in 0-1 time</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note19"></a>Note</h3><p>Defining key frames outside 0-1 is acceptable and sometimes justifiable. You'll need times greater than 1 if your animation has lots of key frames, or if events have exact times.</p></div><p>Start by defining the position and rotation of the camera for the first key frame, using the established waypoints. Select <span class="strong"><strong>Waypoint_A</strong></span> in the level and, from its <span class="strong"><strong>Transform</strong></span> component in the object <span class="strong"><strong>Inspector</strong></span>, click the cog icon and choose <span class="strong"><strong>Copy Component</strong></span>. This copies the position, rotation, and scale values to the clipboard.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_011.jpg" /></div><p>
</p><p>Keep key frames in 0-1 time</p><p>Now paste the values to the destination: select the navigator object again and click and drag the time slider in the <span class="strong"><strong>Animation </strong></span>window, moving to the first frame. Finally, select the cog icon in the navigator <span class="strong"><strong>Transform</strong></span> component and choose <span class="strong"><strong>Paste Component </strong></span>Values to paste the copied values to the navigator object. You may want to tweak the <span class="strong"><strong>Y</strong></span> value for the navigator to position it where it should be at that time. On doing this, the position and rotation for the navigator is set at the first frame. Once completed, move the time slider to the last frame and set the navigator to <span class="strong"><strong>Waypoint_B</strong></span>. This defines where the navigator begins and ends for the animation.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_012.jpg" /></div><p>
</p><p>Defining start and end key frames</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note20"></a>Note</h3><p>Remember, you can auto size the <span class="strong"><strong>Animation</strong></span> window to fit all frames by selecting them all (using box selection with the mouse) and then pressing <span class="emphasis"><em>F </em></span>on the keyboard. This centers all frames into view.</p></div><p>Unity generates all frames between the key frames and these are known as <span class="strong"><strong>tweens </strong></span>(<span class="emphasis"><em>in-between</em></span>). The process by which tweens are generated is known as <span class="strong"><strong>interpolation</strong></span>. Interpolation uses a look-up line graph, with a curve to determine which values (along the horizontal axis) should be used for the position and rotation tweens as the animation plays back (reading from the vertical axis). By default, linear interpolation is used. This means the navigator will travel in a straight line, at a consistent speed, from <span class="strong"><strong>Waypoint_A</strong></span> to <span class="strong"><strong>Waypoint_B</strong></span>, even if that leads it to travel through walls and solids. This is clearly not the behavior we want, because the camera should take an intelligent and believable route through the scene, making turns where needed. </p><p>To achieve this, we'll need to insert additional key frames between the start and end keys to fix the position and rotation of the navigator at intermediary moments. This will necessarily change how Unity interpolates the tweens. Hence, move the time slider across the timeline in the <span class="strong"><strong>Animation</strong></span> window, previewing the camera route in the <span class="strong"><strong>Scene </strong></span>and <span class="strong"><strong>Game</strong></span> view port. Then, move the time slider to frames where the camera begins deviating from its intended course, repairing that course by repositioning and rotating the camera as appropriate. This auto generates key-frames for the camera at the selected times. Repeat this process until the route from <span class="strong"><strong>Waypoint_A</strong></span> to <span class="strong"><strong>Waypoint_B</strong></span> is correct over the complete time line.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_013.jpg" /></div><p>
</p><p>Creating camera path key-frames</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note21"></a>Note</h3><p>You can copy and paste key frames with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span> and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>V</em></span> respectively. And you can drag key frames over the time line to reposition them.</p></div><p>Preview the animation carefully by scrubbing the time slider back and forth in the timeline, ensuring the camera route is appropriate. In addition to creating the route as we've done, you'll probably want to change the interpolation curves for the start and end key frames, creating an <span class="emphasis"><em>ease-in</em></span> and <span class="emphasis"><em>ease-out</em></span> effect. Right now, the camera jumps into motion at in the first frame and comes to a sudden and complete stop at the end. While this is acceptable, it doesn't <span class="emphasis"><em>feel</em></span> smooth. Instead, we can use <span class="emphasis"><em>ease-in</em></span> to slowly bring the camera into motion at in the first frame, and <span class="emphasis"><em>ease-out</em></span> to gradually bring the camera to a stop at the end. To achieve this, start by opening the <span class="strong"><strong>Curves</strong></span> editor from the <span class="strong"><strong>Animation</strong></span> window; just click the <span class="strong"><strong>Curves</strong></span> button.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_014.jpg" /></div><p>
</p><p>Displaying the animation curve editor</p><p>The curve editor may initially display a mess of curves, or an otherwise indecipherable graph. This may be because the view is not appropriately zoomed in or out. You can click and drag a box selection around all points and curves, then press the <span class="emphasis"><em>F</em></span> key on the keyboard to frame all curves into the <span class="strong"><strong>Animation </strong></span>window.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>Remember, you can press <span class="emphasis"><em>Shift</em></span> + Space bar on the keyboard to maximize the <span class="strong"><strong>Animation</strong></span> window, making its contents full screen.</p></div><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_015.jpg" /></div><p>
</p><p>Maximizing the curve editor</p><p>Select the <span class="strong"><strong>Position</strong></span> field from the property list to filter the graph, viewing only the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span> and <span class="strong"><strong>Z</strong></span> position curves. Notice the straight lines that run from the first frame and terminate at the final frame, with no curve or damping to soften the motion. This represents sudden changes, from motionlessness to motion and from motion to motionlessness.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_016.jpg" /></div><p>
</p><p>Identifying sudden and inappropriate changes in motion</p><p>Right-click the first and last keys for the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> fields. From the context menu, choose the <span class="strong"><strong>Flat</strong></span> option to flatten the bezier handle for the key frame. This creates a soft transition in the curve, creating an <span class="emphasis"><em>ease-in</em></span> and <span class="emphasis"><em>ease-out</em></span> at the animation start and end respectively. The result is smoother, more believable camera motion.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_017.jpg" /></div><p>
</p><p>Creating ease-in and ease-out for camera movement</p><p>Now your first animation is complete, moving from <span class="strong"><strong>Waypoint_A</strong></span> to <span class="strong"><strong>Waypoint_B</strong></span>! You can test this from the <span class="strong"><strong>Scene</strong></span> view port, even in <span class="strong"><strong>Game </strong></span>mode. By default, Unity creates and applies an animator asset and component to the navigator object, which plays the created animation at level start up (we'll change that behavior later). You'll probably want to disable animation looping, as well as reducing the playback speed. The speed can be adjusted later. To disable looping, select the animation clip asset in the <span class="strong"><strong>Project</strong></span> panel and disable the <span class="strong"><strong>Loop Time</strong></span> check box.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_018.jpg" /></div><p>
</p><p>Creating play-once animation clips</p><p>Having created one travel animation, let's create the remaining ones. More animations can be easily added to the selected object via the <span class="strong"><strong>Animation</strong></span> window by clicking the <span class="strong"><strong>Animation</strong></span> name drop-down menu. This reveals a drop-down menu, including the option to <span class="strong"><strong>Create New Clip...</strong></span>. Select this option and Unity prompts you again to name and save the clip as an asset of the project.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_019.jpg" /></div><p>
</p><p>Adding animation clips</p><p>Great work! You've now created all camera animations. The next step consists of configuring a Mecanim graph to play them at appropriate times.</p></div>