<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec30"></a>Configuring an animator graph</h2></div></div><hr /></div><p>The animation clip defines an animation, in terms of key frames, graphs, and states. This includes all camera animations created so far. Specifically, an animation clip defines the content of an animation. However, the animation clip doesn't define when it should play during gameplay. To control playback, an <span class="strong"><strong>Animator</strong></span> component and animator controller is needed for the navigator object. Unity creates these assets automatically when you create your first animation clip. Additionally, Unity configures the assets and attaches them to the selected object so that it always plays the first animation when the level begins. However, this is not the behavior we actually want. We could easily tweak the generated assets to behave differently, to play when instructed, for example. But, let's start this process from scratch, deleting all the auto generated assets (the <span class="strong"><strong>Animator</strong></span> component and animator controller). This is not essential, but doing this demonstrates how an animator is configured manually. To remove all auto generated assets for animation, select the navigator object and remove the<span class="strong"><strong> </strong></span>
<span class="strong"><strong>Animator</strong></span> component from the object <span class="strong"><strong>Inspector</strong></span>. Click the cog icon and choose <span class="strong"><strong>Remove Component</strong></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_020.jpg" /></div><p>
</p><p>Removing the auto-generated Animator component</p><p>Next, find the generated animator controller asset in the <span class="strong"><strong>Project</strong></span> panel and delete it. This removes all auto generated assets for animation, allowing us to begin again from a clean slate.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_021.jpg" /></div><p>
</p><p>Removing animator controllers</p><p>To start again, create a new animator controller named <code class="literal">animControl_Navigator</code>, by right-clicking the <span class="strong"><strong>Project</strong></span> panel and choosing <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Animator Controller</strong></span> from the context menu.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_022.jpg" /></div><p>
</p><p>Creating an Animator Controller</p><p>You now need to add an <span class="strong"><strong>Animator</strong></span> component to the camera (or rather, to the <span class="strong"><strong>Navigator</strong></span>, which is a top-level object), and then drag and drop the newly created Animator Controller asset into the <span class="strong"><strong>Controller</strong></span> field of the <span class="strong"><strong>Animator</strong></span> component. This assigns an <span class="strong"><strong>Animator Controller</strong></span> to the <span class="strong"><strong>Animator</strong></span> component.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_023.jpg" /></div><p>
</p><p>Assigning an Animator Controller</p><p>Ensure <span class="strong"><strong>Apply Root Motion</strong></span> is not enabled and that <span class="strong"><strong>Update Mode</strong></span> is <span class="strong"><strong>Normal</strong></span> and <span class="strong"><strong>Culling Mode</strong></span> is <span class="strong"><strong>Always Animate</strong></span>. The <span class="strong"><strong>Culling Mode</strong></span> field, when set to <span class="strong"><strong>Cull Completely</strong></span>, effectively links animation playback to the visibility of the object's mesh renderer. This can enhance performance, as animations only play when the mesh is actually visible. But this, of course, doesn't apply to the camera object, which has no mesh renderer component. To configure the animator controller for animation playback, double-click it inside the <span class="strong"><strong>Project</strong></span>
<span class="emphasis"><em> </em></span>panel. This opens the controller by default in the animator window. This offers visual scripting control over high-level animation playback. By default, the node graph features two auto-created nodes; specifically, <span class="strong"><strong>AnyState</strong></span> and <span class="strong"><strong>Entry</strong></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_024.jpg" /></div><p>
</p><p>Accessing the animator graph</p><p>The <span class="strong"><strong>Entry</strong></span> node is fired once; for the first time the animator component becomes enabled on an active object. Unless an object is deactivated in the editor, through script, or the animator component is disabled, then the <span class="strong"><strong>Entry</strong></span> node will fire normally on level start up. The <span class="strong"><strong>Entry</strong></span> node is therefore useful for connecting to any other nodes, or states, that must execute as the level begins. For the camera object, however, we don't need an animation played; but we do need the camera to simply remain as it is until further notice. To achieve this, we'll create an empty node, which simply leaves the camera unchanged and remains this way in a loop (idle state). That is, it holds graph execution at that node and it remains there until a condition causes the state to change. Right-click inside the graph and choose <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span> from the context menu. This adds a new, empty node to the graph.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_025.jpg" /></div><p>
</p><p>Creating a new animator state for the camera</p><p>By default, the first added node becomes the default node and is highlighted in orange. The default node is always connected to the <span class="strong"><strong>Entry</strong></span> node. Select the newly created node by clicking on it and rename it <code class="literal">Idle</code>. The <span class="strong"><strong>Motion</strong></span> field should specify <span class="strong"><strong>None (Motion)</strong></span>. This represents the animation clip that should play when the node is activated. When this field is set to <span class="strong"><strong>None (Motion)</strong></span>, no animation clips play and the camera object will be left as is; that is, unchanged from its starting state. Remove the check mark from the <span class="strong"><strong>Write Defaults</strong></span> check box too (which resets the object's state back to its default settings when the animation clip completes playback).</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_026.jpg" /></div><p>
</p><p>Setting properties for the Idle state</p><p>The <span class="strong"><strong>Idle</strong></span> node represents the camera when it's neither animated nor moving through a path in the scene. It should always be active whenever the camera is motionless. This will usually be because the player is fighting zombies by matching words. Thus, the <span class="strong"><strong>Idle</strong></span> node is the first and neutral state in a <span class="strong"><strong>Finite State Machine </strong></span>(<span class="strong"><strong>FSM</strong></span>). More on FSMs later in this chapter, and later in this book. This means that all other nodes will, in some way, be connected to the <span class="strong"><strong>Idle</strong></span> node, as the camera changes from being in motion to being motionless. To start building the graph, drag and drop all camera animation clips from the <span class="strong"><strong>Project</strong></span> panel into the animator graph, where they will be added automatically as new nodes.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_027.jpg" /></div><p>
</p><p>Adding animation nodes to the animator graph</p><p>Once added, rename each clip appropriately and connect them in a sequence (or chain) to the <span class="emphasis"><em>Idle</em></span> state. Because the movement of the camera in <span class="emphasis"><em>Dead Keys</em></span> is linear (moving from point to point), the graph nodes can be connected one after another in an unbroken sequence. Specifically, the camera stops, the player attacks, and then the camera moves to the next destination, and so on. Although the potential exists for branching paths, the first level has only one possible route that may be taken. To create connections between nodes, simply right-click from the first node and choose <span class="strong"><strong>Make Transition</strong></span> from the context menu. Then, select the destination node to establish the connection.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_028.jpg" /></div><p>
</p><p>Mapping the camera path as a linear sequence of nodes</p><p>The linear sequence is made between the nodes, but the transitions themselves need configuring. A transition determines when one state should change to another. By default, all transitions are unconditional, they simply allow the first state to move to the second when playback is completed. Let's now configure some conditions for each transition. Start by creating an Int parameter, called <code class="literal">NavState</code>. The values of this variable will reflect the states of the camera (0 = starting state, 1 = travel to next location, 2 = travel to next location, and so on). To create the parameter, click the <span class="strong"><strong>+</strong></span> icon from the <span class="strong"><strong>Parameters</strong></span> list, and choose <span class="strong"><strong>Int</strong></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_029.jpg" /></div><p>
</p><p>Creating an Int parameter in the animator graph</p><p>The <span class="strong"><strong>Int</strong></span> parameter should have the default value of <code class="literal">0</code>. If not, it can be specified in the <span class="strong"><strong>Parameters</strong></span> list. Now select each transition in turn (the arrow connecting the nodes), and set the condition from the object <span class="strong"><strong>Inspector</strong></span> using the equals operation. Specifically, to transition from <span class="strong"><strong>Idle</strong></span> to <span class="strong"><strong>Move_01</strong></span>, the <code class="literal">NavState</code> parameter should be equal to <code class="literal">1</code>. A value of 2 transitions between <span class="strong"><strong>Move_01</strong></span> and <span class="strong"><strong>Move_02</strong></span>, and so on. By using an <span class="strong"><strong>Int</strong></span> parameter in this way, we have the ability to transition between any number of nodes.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_030.jpg" /></div><p>
</p><p>Specifying transition conditions</p><p>Each transition features a <span class="strong"><strong>Has Exit Time</strong></span> Boolean field. When enabled, as it is by default, the full length of the animation always plays when the node is activated, and the state can only change after the animation completes. Or, more accurately, the settings roll-out specifies an exit time field, defining animation duration in normalized time (between 0-1). When <span class="strong"><strong>Has Exit Time</strong></span> is enabled, the state can only exit or change after the specified exit time elapses. In our case, <span class="strong"><strong>Has Exit Time</strong></span> should be disabled, as there are some conditions (such as <span class="emphasis"><em>death</em></span>) which can potentially interrupt an animation at any time and must be allowed to do so.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_031.jpg" /></div><p>
</p><p>Disabling exit time</p><p>Finally, you'll probably want to tweak the <span class="strong"><strong>Speed</strong></span> value for each node. This determines how fast or slow the animation plays back. This value is expressed, again, in normalized time. Thus, a value of 1 means default (since <span class="emphasis"><em>time x 1 = time</em></span>), 2 means double speed (since <span class="emphasis"><em>time x 2 = 2 time</em></span>), and 0.5 means half speed (since <span class="emphasis"><em>time x 0.5 = time/2</em></span>), and so on. For my animations, I've specified a value of <span class="emphasis"><em>0.15</em></span>. I arrived at this value by trial and error; that is, by repeatedly playing back the animation at different speeds to observe the result.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785880742/graphics/image_03_032.jpg" /></div><p>
</p><p>Configuring animation speed by trial and error</p><p>Excellent! The animator graph is now fully configured for camera navigation. The nodes should be set up in a linear sequence, allowing the camera to move forward on its path as the <code class="literal">NavState</code> Int parameter is updated. Right now, nothing actually changes this parameter; this explains why the camera won't move or change as the level begins. We'll need to access the <code class="literal">NavState</code> and its value from script to gain control over camera movement.</p></div>