<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec15"></a>Level design</h2></div></div><hr /></div><p>Now that we have our game story on paper and have an idea of what we want to achieve, it is time to apply our skills to actually making it happen.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note8"></a>Note</h3><p>Since this book is targeting an audience who is already familiar with the basics of Unity, we are not going to cover the fundamental aspects of the software.</p></div><p>To get started, we need to launch Unity. I am using the <span class="emphasis"><em>64-bit edition</em></span> of <span class="emphasis"><em>Unity 5.3.x Pro</em></span>. You do not need to have the Pro version of Unity for completing the project in this book.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_001.jpg" /></div><p>
</p><p>Go ahead and select a location and a name you desire for your project and select the <span class="strong"><strong>Create project </strong></span>button. At this point Unity will create an empty project for you, and display the Unity IDE, it should look something like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_002.jpg" /></div><p>
</p><p>Your view might be a bit different, depending on how you have configured your Unity layout. If this is the first time you have launched Unity, you will need to get up to speed with the basics, since we are not going to be covering them in this book.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note9"></a>Note</h3><p>If you have not used Unity before, you should get familiar with the IDE before you continue on reading.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec24"></a>Setting the stage</h3></div></div></div><p>So the first things we would like to do is to create a landscape for our first level called <span class="emphasis"><em>Awakening</em></span>.</p><p>Unity itself has some good tools for creating terrains, but truth be told, it is not a practical means of achieving nice beautiful terrains for the game. For this purpose, we are going to use another set of tools called Terrain Toolkit and it was developed by <span class="emphasis"><em>Sander as part of the Unity Summer of Code 2009</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>The toolkit is available on Google code repository: <a class="ulink" href="https://code.google.com/archive/p/unityterraintoolkit/downloads" target="_blank">https://code.google.com/archive/p/unityterraintoolkit/downloads</a>
</p></div><p>I have also included the library as part of the download provided by this book, just in case the original link gets deprecated in the future.</p><p>Once you get the ZIP file containing the Terrain Toolkit, go ahead and unzip it to a desired location on your computer. Drill-down in the extracted folder to get to the Unity Package called <code class="literal">TerrainToolkit_1_0_2.unitypackage</code>
<span class="emphasis"><em>.</em></span>
</p><p>At this point let's take a moment and go back into Unity and actually create a Terrain GameObject and see the built-in tool for terrain modification. To create a Terrain, you will need to select the following from the Main Menu: <span class="strong"><strong>GameObject|3D Object|Terrain.</strong></span> This will create a default terrain in your scene which should look something like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_003.jpg" /></div><p>
</p><p>When you select the Terrain GameObject in the Hierarchy Window, you will see the Inspector Window displaying the properties and components that are accessible through the designer for the Terrain GameObject. As you can see, there are a lot of attributes that you can modify and by doing so create a nice looking terrain. When you start playing around with the terrain tool you will soon realize that it is not practical for large terrain models, or for natural looking terrains.</p><p>To enhance our terrain generation, we will use the Terrain Toolkit. The first thing we need to do is to import the unity package into our project, and this is done by selecting from the main menu: <span class="strong"><strong>Assets | Import Package | Custom</strong></span> Package which will open up your file explorer. Using the file explorer, you will need to navigate to the location where you extracted the ZIP file, and select the unity package to import.</p><p>If all goes well you will see the following screen displaying the assets that are included in the package we are trying to import. You can take a look at the content of the package before importing it. In our case, we want to import everything, so we can just click the <span class="strong"><strong>Import</strong></span> button.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_004.jpg" /></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p>Sometimes when you import older Unity Assets, Unity will prompt you to automatically upgrade it to the latest version. This is usually OK. So just accept it and let Unity do what it needs to do.</p></div><p>When Unity imports the Terrain Toolkit, you will notice a new folder under your Project Window called <span class="strong"><strong>TerrainToolkit</strong></span>. All the code will be listed under the folder if you want to make any modifications to it. There is also a readme file which you can use to get started.</p><p>You will also notice that a new Unity Editor feature has been added under the <span class="strong"><strong>Component Menu</strong></span> called <span class="strong"><strong>Terrain|Terrain Toolkit</strong></span>. All you need to do to apply the Terrain Toolkit to your existing Terrain is to select that option and it will automatically attach the correct component to the Terrain GameObject for you.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_005.jpg" /></div><p>
</p><p>You will notice a few options that are now available to you through the Terrain Toolkit for the generation of more natural and realistic terrains. You should take the time and get familiar with each attribute and play around with the values to get an idea of how they affect the terrain generation algorithm.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec25"></a>Terrain toolkit in a nutshell</h3></div></div></div><p>There are a number of predefined generators in the toolkit for the creation of the terrain. These are <span class="strong"><strong>Voronoi, Fractal, Perlin</strong></span>. The following is a brief explanation of each.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Voronoi</strong></span> generates a random height-map consisting of a series of mountain-like peaks using a Voronoi diagram and applies it to the terrain object.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Fractal</strong></span> generates a random height-map using the <span class="emphasis"><em>cloud</em></span> or <span class="emphasis"><em>plasma</em></span> fractal algorithm and applies it to the terrain object.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Perlin</strong></span> generates a random height-map using Perlin noise and applies it to the terrain object.</p></li></ul></div><p>There are also two filter types that can be applied after the generation of the terrain. These are the <span class="strong"><strong>Smooth</strong></span> and <span class="strong"><strong>Normalize</strong></span> filters.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Smooth</strong></span> is a filter which applies smoothing to the terrain object repeatedly over a number of iterations.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Normalize</strong></span> is a filter which normalizes the terrain object by setting the highest point in the current terrain height-map to the maximum and the lowest point to the minimum. All other points are interpolated between the maximum and minimum.</p></li></ul></div><p>The next step would be to apply some erosion to the terrain. There are three built in erosion types in the toolkit: <span class="strong"><strong>Thermal Erosion</strong></span>, <span class="strong"><strong>Hydraulic Erosion</strong></span>, and <span class="strong"><strong>Tidal Erosion</strong></span>. You can apply these erosion types either by a brush, or by the actual erosion filters.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Thermal Erosion</strong></span> removes material from areas with a slope greater than the minimum slope and deposits it further down the slope. This tends to smooth and flatten inclines in the terrain.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Hydraulic Erosion</strong></span> removes material from areas with a slope less than the maximum slope and deposits it further down the slope. This tends to steepen inclines in the terrain and further smooth and flatten other areas.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note12"></a>Note</h3><p>There are three different Hydraulic Erosion Types.</p></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Tidal Erosion</strong></span> applies smoothing at the chosen sea level, except in areas where the slope exceeds a given value. This simulates the erosive action of waves around a shoreline and creates beaches.</p></li></ul></div><p>Final step would be to apply texturing. This will give our terrain a more realistic look and feel at runtime. The toolkit provides procedural terrain texturing, which automatically textures the terrain object using the slope and altitude attributes of the terrain to determine which texture will be used.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec26"></a>The awakening</h3></div></div></div><p>The setting and the atmosphere of the level is going to be in a secluded area within the jungle. We are now going to generate our terrain using the Terrain Toolkit discussed in the previous section.</p><p>Let's create a new scene and call it Awakening. By default, the scene is just going to have a camera and a directional light GameObject defined.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>You can save your scenes and assets within the Asset folder without much thought. However, it is usually a good idea to have some file structure in place to make organization of your assets easier and be able to find them faster.</p></div><p>A preferred folder structure would include: scenes, prefabs, textures, audio, models. Within each folder you can then create subfolders and so forth for your own organizational purposes.</p><p>Now we are ready to add a Terrain GameObject to the scene. Go ahead and select <span class="strong"><strong>GameObject | 3D Object|Terrain</strong></span>. This will place a <span class="strong"><strong>Terrain GameObject</strong></span> in the scene, double click on the <span class="strong"><strong>Terrain GameObject</strong></span> in the Hierarchy Window to make it centered in the Scene View.</p><p>By default, the Terrain object will be very large, let's go ahead and make some adjustments before we do anything else.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_006.jpg" /></div><p>
</p><p>To make the adjustments to the terrain size, select the <span class="strong"><strong>Settings Icon</strong></span> as indicated in the preceding screenshot. This will display the basic attributes of the terrain. As you can see there are a bunch of properties that can be adjusted to make it behave to your liking. We are mostly concerned with the size of the terrain and also the maximum height that the terrain can raise to. Therefore, scroll down until you get to the <span class="strong"><strong>Resolution</strong></span> section.</p><p>Change the <span class="strong"><strong>Terrain Width</strong></span> and <span class="strong"><strong>Terrain Length</strong></span> to 50. Change the <span class="strong"><strong>Terrain Height</strong></span> to 50. This will change the dimension so that we can handle our scene easier. Our original terrain size was very large and it would have taken us a long time to decorate it.</p><p>Now, we have a good size terrain. Assuming you have already imported the Terrain Toolkit, go ahead and select <span class="strong"><strong>Component|Terrain|Terrain Toolkit</strong></span> from the main menu.</p><p>I have used the fractal terrain generator function with a <span class="strong"><strong>Delta</strong></span> of 0.4 and <span class="strong"><strong>Blend</strong></span> of 0.445. This will generate a nice looking terrain with a good proportion of hills and valleys. Since the terrain is randomly generated yours may not look exactly like mine, but it should look something similar to the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_007.jpg" /></div><p>
</p><p>I usually apply the <span class="strong"><strong>Smooth</strong></span> filter after my terrain generation to make things look even nicer. After applying the <span class="strong"><strong>Smooth</strong></span> filter, my terrain looks like the following:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_008.jpg" /></div><p>
</p><p>You can see the difference of the filter once it has been applied. Let's go ahead and now apply some textures to make it nice. Selecting the <span class="strong"><strong>Texture</strong></span> tab within the <span class="strong"><strong>Terrain Toolkit</strong></span>, you will have several options. We would like to apply at least two textures to give our terrain a more realistic look. You can apply up to four textures if you choose to!</p><p>Click the <span class="strong"><strong>Add Texture</strong></span> button twice to create the texture placeholder.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>Textures are very important in graphics and especially games. The better and higher resolution your textures, the better your scene will look. However, this is a catch-22. Usually higher resolution textures take up more resources. So you have to find the right balance for your game.</p></div><p>Once the placeholders have been added, you can click on the placeholder, a window will pop-up and you will be able to select your desired texture.</p><p>Now is a good time to stop and discuss one of the main advantages of Unity, the <span class="strong"><strong>Asset Store</strong></span>. The Asset Store is a great online community that Unity Developers can either acquire assets to be used in their games, or develop assets that will be used by other developers. You can either get free assets from the Asset Store or you can get better quality ones for a little bit of money.</p><p>For our game, I will be using some free assets and some paid assets. If you want to use the same assets that I am using in the book you will need to purchase them:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_009.jpg" /></div><p>
</p><p>The next thing I like to do is locate a position on the terrain where I will be using to create the scene objects necessary to play out the level. For this particular scene, I want to use an asset that represents an old cottage in the woods, where the hero will be awakening in the beginning of the game.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_010.jpg" /></div><p>
</p><p>I have found this nice asset in the Asset Store that I would like to use for my starting point of the game. The model itself does not have any interior. This fits in well, because I am not planning on having any game play inside the shelter. It is just an eye catching object in the scene and a point of reference.</p><p>In order for me to place the shack in the scene, I will need to first do some more adjustments to the terrain. If you notice, our terrain does not have any level areas where we can properly place the shack. We would need to use the terrain objects terrain components to make some more changes.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_011.jpg" /></div><p>
</p><p>Again select the Terrain GameObject in the Hierarchy View and use the Inspector Window to select the <span class="strong"><strong>Paint Height</strong></span> tab, shown as (1) in the preceding image, to enable the feature.</p><p>This is a great feature to sample the terrain height at a particular point, and apply the same height using the brush to any other region. This will level the terrain to the same height that was sampled. It's a great way to quickly level a region and place your items, if those items need to be on a level ground, like a house or a shelter.</p><p>The next step is to place some tree models on our terrain to create the jungle look and feel. To achieve this, we are going to need to select the terrain object in the scene and use the <span class="strong"><strong>Inspector Window</strong></span> to select the <span class="strong"><strong>Tree Placement</strong></span> feature. You will then need to select the <span class="strong"><strong>Edit Trees...</strong></span> button to add a Tree model.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_012.jpg" /></div><p>
</p><p>Using the Inspector Window, you will need to select the Tree Placement tab, select <span class="strong"><strong>Edit Tree... Add Tree</strong></span> feature, locate a Tree prefab and you are done!</p><p>Take a look at the settings, and change the brush size to meet your needs. In my case, I have changed it to 9.9. I have left the rest of the attributes at the default value, you can certainly change them as needed.</p><p>Now, when you move your mouse in the Scene View, you will notice a brush-like highlight. This is where the trees will be placed during design time.</p><p>The following screenshot will display how my scene looks after I have made some of the adjustments and placements of my trees and the building.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_013.jpg" /></div><p>
</p><p>The next step of the process would be filling the level with other environment assets such as rocks, vegetation, and other props to make the level come to life. The idea here is to make it interesting and at the same time functional. It is a good idea to have some sort of a sketch of your level design. This way you can have a good idea of how you will develop your level.</p><p>Keep in mind that this can also be used as a means of communication with your team; the level designers and artists, providing them a direction. The following diagram is a top-down view of our intended level design.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_014.jpg" /></div><p>
</p><p>I am going to now build my level based on the layout I have. Now is the time to get creative and use your imagination to design your level. This part of the exercise is free form, you are the designer, so you will decide how to go about placing and creating your level, as long as it meets the requirements.</p><p>Keep in mind the following important point, the player will be interacting with the environment or non-player characters at the designated points of interest. So make sure when you design your level, they have an easy way to access the areas where they need to get to, so that they can perform the given task.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_015.jpg" /></div><p>
</p><p>One thing to notice is the limitation of the terrain as we have it defined here. When the player goes to the edge of the terrain they will fall through! Yes, they will freefall forever! We don't want that to happen. So we will need to also incorporate some boundaries in the level design that will prevent the player from basically going overboard.</p><p>It is very simple to create some restrictions and boundaries in such cases. We can use wooden fences, or we can use the actual environment to restrict the level of access by the player to the danger zones in the level. This method can be very time consuming if your level is large.</p><p>Another way to solve this problem is to create four planes that will be used on each side of the terrain. The plains will have a special texture giving them an atmospheric look, but they will have colliders which will stop the player from moving forward upon contact. This is an easier method and will take less time to place in the scene.</p><p>Go ahead and create a plane by choosing  <span class="strong"><strong>Game Object | 3D Object | Plane</strong></span>. When the plane is placed in the scene, arrange it in a way that it will be the length of the terrain. The scale of my plane is <code class="literal">&lt;4,1,4&gt;</code> at position <code class="literal">&lt;25,20,25&gt;</code>, I have also rotated the plane 90 degree on the <span class="emphasis"><em>Z</em></span> axis.</p><p>You will need to also attach a collider to the plane object. The collider component will be used to detect collisions between the plane and other objects, in this case the player character, and stop the player from going through.</p><p>To attach a collider, select the Plane object and from the Inspector Window, use the <span class="strong"><strong>Add Component</strong></span> button to select  <span class="strong"><strong>Physics|Box Collider</strong></span>. The plane now will have a box collider that will be used for collision detection by the engine.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>A plane object will only render on one side. Therefore, when you apply your texture to the plane, make sure that the visible side is towards the inside of the level.</p></div><p>Once you are satisfied with the look and feel, you will need to duplicate it and place it on all the side edges to protect the player from falling.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_02_016.jpg" /></div><p>
</p><p>In the preceding screenshot, notice that the two planes on the far side are not visible. That is how the player will see the environment during gameplay. The player will collide and not be able to move forward, but they will see the skyline go far into the distance.</p><p>It is time to do a test run. We can use the 3<sup>rd</sup> person character controller provided in the Standard Assets to quickly drop our character placeholder and roam around the level to get a feel for it.</p></div></div>