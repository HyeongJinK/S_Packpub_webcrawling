<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec40"></a>Integrating the UI with the actual inventory system</h2></div></div><hr /></div><p>We have seen and implemented the concepts necessary to make our Inventory System UI work properly. Now it is time to actually fill the user interface with the actual data that is stored in the GameMaster.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec47"></a>Hooking the category buttons and displaying the data</h3></div></div></div><p>Using the <code class="literal">UIController.cs</code> script, we are going to create five new methods that will handle the proper visualization of our Inventory System. We are going to add the following five functions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">DisplayWeaponsCategory()</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">DisplayArmourCategory()</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">DisplayClothingCategory()</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">DisplayHealthCategory()</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">DisplayPotionsCategory()</code>
</p></li></ul></div><p>We also need to clear the existing inventory items from the panel when the user switches from one category to the next. This will require a private function named <code class="literal">ClearInventoryItemPanel()</code> that will just do that.</p><p>Here is the listing for the new <code class="literal">UIController.cs</code> script:</p><pre class="programlisting">using UnityEngine; &#13;
using UnityEngine.UI; &#13;
using System.Collections; &#13;
using System.Collections.Generic; &#13;
 &#13;
public class UIController : MonoBehaviour &#13;
{ &#13;
  public Canvas SettingsCanvas; &#13;
  public Slider ControlMainVolume; &#13;
 &#13;
  // the canvas object for inventory system &#13;
  public Canvas InventoryCanvas; &#13;
 &#13;
  public Transform PanelItem; &#13;
  public GameObject InventoryItemElement; &#13;
 &#13;
  public void Update() &#13;
  { &#13;
  } &#13;
 &#13;
  public void DisplaySettings() &#13;
  { &#13;
    GameMaster.instance.DISPLAY_SETTINGS = !GameMaster.instance.DISPLAY_SETTINGS; &#13;
    this.SettingsCanvas.gameObject.SetActive(GameMaster.instance.DISPLAY_SETTINGS); &#13;
  } &#13;
 &#13;
  public void MainVolume() &#13;
  { &#13;
    GameMaster.instance.MasterVolume(ControlMainVolume.value); &#13;
  } &#13;
 &#13;
  public void StartGame() &#13;
  { &#13;
    GameMaster.instance.StartGame(); &#13;
  } &#13;
 &#13;
  public void LoadLevel() &#13;
  { &#13;
    if (GameObject.FindGameObjectWithTag("BASE")) &#13;
    { &#13;
      GameMaster.instance.PC_CC = GameObject.FindGameObjectWithTag("BASE").GetComponent&lt;CharacterCustomization&gt;().PC_CC; &#13;
    } &#13;
    GameMaster.instance.LEVEL_CONTROLLER.LEVEL = 1; &#13;
    GameMaster.instance.LoadLevel(); &#13;
  } &#13;
 &#13;
  public void DisplayInventory() &#13;
  { &#13;
    this.InventoryCanvas.gameObject.SetActive(GameMaster.instance.DISPLAY_INVENTORY); &#13;
    Debug.Log("Display Inventory Function"); &#13;
  } &#13;
 &#13;
  private void ClearInventoryItemsPanel() &#13;
  { &#13;
    while(this.PanelItem.childCount&gt;0) &#13;
    { &#13;
      Transform t = this.PanelItem.GetChild(0).transform; &#13;
      t.parent = null; &#13;
      Destroy(t.gameObject); &#13;
    } &#13;
  } &#13;
 &#13;
  public void DisplayWeaponsCategory() &#13;
  { &#13;
    if(GameMaster.instance.DISPLAY_INVENTORY) &#13;
    { &#13;
      this.ClearInventoryItemsPanel(); &#13;
 &#13;
      foreach (InventoryItem item in GameMaster.instance.INVENTORY.WEAPONS) &#13;
      { &#13;
        GameObject newItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
        InventoryItemUI txtItem = newItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
        txtItem.txtItemElement.text = &#13;
          string.Format("Name: {0}, Description: {1}, Strength: {2}, Weight: {3}", &#13;
                                  item.NAME, &#13;
                                  item.DESCRIPTION, &#13;
                                  item.STRENGTH, &#13;
                                  item.WEIGHT); &#13;
 &#13;
        // button triggers &#13;
        txtItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button add for {0}", txtItem.txtItemElement.text)); &#13;
        }); &#13;
 &#13;
        txtItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button delete for {0}", txtItem.txtItemElement.text)); &#13;
          Destroy(newItem); &#13;
        }); &#13;
 &#13;
        newItem.transform.SetParent(this.PanelItem); &#13;
      } &#13;
 &#13;
    } &#13;
  } &#13;
 &#13;
  public void DisplayArmourCategory() &#13;
  { &#13;
    if (GameMaster.instance.DISPLAY_INVENTORY) &#13;
    { &#13;
      this.ClearInventoryItemsPanel(); &#13;
 &#13;
      foreach (InventoryItem item in GameMaster.instance.INVENTORY.ARMOUR) &#13;
      { &#13;
        GameObject newItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
        InventoryItemUI txtItem = newItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
        txtItem.txtItemElement.text = &#13;
          string.Format("Name: {0}, Description: {1}, Strength: {2}, Weight: {3}", &#13;
                                  item.NAME, &#13;
                                  item.DESCRIPTION, &#13;
                                  item.STRENGTH, &#13;
                                  item.WEIGHT); &#13;
 &#13;
        // button triggers &#13;
        txtItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button add for {0}", txtItem.txtItemElement.text)); &#13;
        }); &#13;
 &#13;
        txtItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button delete for {0}", txtItem.txtItemElement.text)); &#13;
          Destroy(newItem); &#13;
        }); &#13;
 &#13;
        newItem.transform.SetParent(this.PanelItem); &#13;
      } &#13;
    } &#13;
  } &#13;
 &#13;
  public void DisplayClothingCategory() &#13;
  { &#13;
    if (GameMaster.instance.DISPLAY_INVENTORY) &#13;
    { &#13;
      this.ClearInventoryItemsPanel(); &#13;
 &#13;
      foreach (InventoryItem item in GameMaster.instance.INVENTORY.CLOTHING) &#13;
      { &#13;
        GameObject newItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
        InventoryItemUI txtItem = newItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
        txtItem.txtItemElement.text = &#13;
          string.Format("Name: {0}, Description: {1}, Strength: {2}, Weight: {3}", &#13;
                                  item.NAME, &#13;
                                  item.DESCRIPTION, &#13;
                                  item.STRENGTH, &#13;
                                  item.WEIGHT); &#13;
 &#13;
        // button triggers &#13;
        txtItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button add for {0}", txtItem.txtItemElement.text)); &#13;
        }); &#13;
 &#13;
        txtItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button delete for {0}", txtItem.txtItemElement.text)); &#13;
          Destroy(newItem); &#13;
        }); &#13;
 &#13;
        newItem.transform.SetParent(this.PanelItem); &#13;
      } &#13;
    } &#13;
  } &#13;
 &#13;
  public void DisplayHealthCategory() &#13;
  { &#13;
    if (GameMaster.instance.DISPLAY_INVENTORY) &#13;
    { &#13;
      this.ClearInventoryItemsPanel(); &#13;
 &#13;
      foreach (InventoryItem item in GameMaster.instance.INVENTORY.HEALTH) &#13;
      { &#13;
        GameObject newItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
        InventoryItemUI txtItem = newItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
        txtItem.txtItemElement.text = &#13;
          string.Format("Name: {0}, Description: {1}, Strength: {2}, Weight: {3}", &#13;
                                  item.NAME, &#13;
                                  item.DESCRIPTION, &#13;
                                  item.STRENGTH, &#13;
                                  item.WEIGHT); &#13;
 &#13;
        // button triggers &#13;
        txtItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button add for {0}", txtItem.txtItemElement.text)); &#13;
        }); &#13;
 &#13;
        txtItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button delete for {0}", txtItem.txtItemElement.text)); &#13;
          Destroy(newItem); &#13;
        }); &#13;
 &#13;
        newItem.transform.SetParent(this.PanelItem); &#13;
      } &#13;
 &#13;
    } &#13;
  } &#13;
 &#13;
  public void DisplayPotionsCategory() &#13;
  { &#13;
    if (GameMaster.instance.DISPLAY_INVENTORY) &#13;
    { &#13;
      this.ClearInventoryItemsPanel(); &#13;
 &#13;
      foreach (InventoryItem item in GameMaster.instance.INVENTORY.POTIONS) &#13;
      { &#13;
        GameObject newItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
        InventoryItemUI txtItem = newItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
        txtItem.txtItemElement.text = &#13;
          string.Format("Name: {0}, Description: {1}, Strength: {2}, Weight: {3}", &#13;
                                  item.NAME, &#13;
                                  item.DESCRIPTION, &#13;
                                  item.STRENGTH, &#13;
                                  item.WEIGHT); &#13;
 &#13;
        // button triggers &#13;
        txtItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button add for {0}", txtItem.txtItemElement.text)); &#13;
        }); &#13;
 &#13;
        txtItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button delete for {0}", txtItem.txtItemElement.text)); &#13;
          Destroy(newItem); &#13;
        }); &#13;
 &#13;
        newItem.transform.SetParent(this.PanelItem); &#13;
      } &#13;
 &#13;
    } &#13;
  } &#13;
 &#13;
} &#13;
</pre><p>We had to also make some modifications to the <code class="literal">InventorySystem.cs</code> script to make it possible for us to access properties storing the data easier.</p><p>Here is the new listing of the script:</p><pre class="programlisting">using System; &#13;
using UnityEngine; &#13;
using System.Collections.Generic; &#13;
 &#13;
[Serializable] &#13;
public class InventorySystem &#13;
{ &#13;
  [SerializeField] &#13;
  private List&lt;InventoryItem&gt; weapons = new List&lt;InventoryItem&gt;(); &#13;
  [SerializeField] &#13;
  private List&lt;InventoryItem&gt; armour = new List&lt;InventoryItem&gt;(); &#13;
  [SerializeField] &#13;
  private List&lt;InventoryItem&gt; clothing = new List&lt;InventoryItem&gt;(); &#13;
  [SerializeField] &#13;
  private List&lt;InventoryItem&gt; health = new List&lt;InventoryItem&gt;(); &#13;
  [SerializeField] &#13;
  private List&lt;InventoryItem&gt; potion = new List&lt;InventoryItem&gt;(); &#13;
 &#13;
  public List&lt;InventoryItem&gt; WEAPONS &#13;
  { &#13;
    get { return this.weapons; } &#13;
  } &#13;
 &#13;
  public List&lt;InventoryItem&gt; ARMOUR &#13;
  { &#13;
    get { return this.armour; } &#13;
  } &#13;
 &#13;
  public List&lt;InventoryItem&gt; CLOTHING &#13;
  { &#13;
    get { return this.clothing; } &#13;
  } &#13;
 &#13;
  public List&lt;InventoryItem&gt; HEALTH &#13;
  { &#13;
    get { return this.health; } &#13;
  } &#13;
 &#13;
  public List&lt;InventoryItem&gt; POTIONS &#13;
  { &#13;
    get { return this.potion; } &#13;
  } &#13;
 &#13;
  //[SerializeField] &#13;
  private InventoryItem selectedWeapon; &#13;
  //[SerializeField] &#13;
  private InventoryItem selectedArmour; &#13;
 &#13;
  public InventoryItem SELECTED_WEAPON &#13;
  { &#13;
    get { return this.selectedWeapon; } &#13;
    set { this.selectedWeapon = value; } &#13;
  } &#13;
  public InventoryItem SELECTED_ARMOUR &#13;
  { &#13;
    get { return this.selectedArmour; } &#13;
    set { this.selectedArmour = value; } &#13;
  } &#13;
 &#13;
  public InventorySystem() &#13;
  { &#13;
    this.ClearInventory(); &#13;
  } &#13;
 &#13;
  public void ClearInventory() &#13;
  { &#13;
    this.weapons.Clear(); &#13;
    this.armour.Clear(); &#13;
    this.clothing.Clear(); &#13;
    this.health.Clear(); &#13;
    this.potion.Clear(); &#13;
  } &#13;
 &#13;
  // this function will add an inventory item &#13;
  public void AddItem(InventoryItem item) &#13;
  { &#13;
    switch(item.CATEGORY) &#13;
    { &#13;
      case BaseItem.ItemCategory.ARMOUR: &#13;
        { &#13;
          this.armour.Add(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.CLOTHING: &#13;
        { &#13;
          this.clothing.Add(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.HEALTH: &#13;
        { &#13;
          this.health.Add(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.POTION: &#13;
        { &#13;
          this.potion.Add(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.WEAPON: &#13;
        { &#13;
          this.weapons.Add(item); &#13;
          break; &#13;
        } &#13;
    } &#13;
  } &#13;
 &#13;
  // this function will remove an inventory item &#13;
  public void DeleteItem(InventoryItem item) &#13;
  { &#13;
    switch (item.CATEGORY) &#13;
    { &#13;
      case BaseItem.ItemCategory.ARMOUR: &#13;
        { &#13;
          this.armour.Remove(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.CLOTHING: &#13;
        { &#13;
          this.clothing.Remove(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.HEALTH: &#13;
        { &#13;
          this.health.Remove(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.POTION: &#13;
        { &#13;
          this.potion.Remove(item); &#13;
          break; &#13;
        } &#13;
      case BaseItem.ItemCategory.WEAPON: &#13;
        { &#13;
          this.weapons.Remove(item); &#13;
          break; &#13;
        } &#13;
    } &#13;
  } &#13;
 &#13;
} &#13;
</pre><p>Notice that I have removed the code from the <span class="emphasis"><em>Update()</em></span> function in the <span class="emphasis"><em>UIController.cs</em></span> script as it was only for testing reasons.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec48"></a>Testing the Inventory System</h3></div></div></div><p>For testing purposes, I have placed a number of Inventory Item Prefabs I have created earlier in this chapter:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_015.jpg" /></div><p>
</p><p>Start the game from the Main Menu and go through the Character Customization scene to save the character player and start the game. Once you are in the playable scene, go ahead and collect a few of the items that have been placed over the scene:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_016.jpg" /></div><p>
</p><p>Notice in the preceding screenshot that I have selected the <span class="strong"><strong>_GameMaster</strong></span> GameObject to display the <span class="strong"><strong>INVENTORY</strong></span> data in the <span class="strong"><strong>Inspector Window</strong></span>.</p><p>We have picked up two weapon types and two armour types. The weapon items we have picked up are <span class="strong"><strong>axe1</strong></span> and <span class="strong"><strong>club1</strong></span>. The armour items we have picked up are <span class="strong"><strong>HL02</strong></span> and <span class="strong"><strong>SP01</strong></span> as indicated in the <span class="strong"><strong>Inspector Window</strong></span>.</p><p>Notice that in the <span class="emphasis"><em>Game Window</em></span>, when we bring up the <span class="emphasis"><em>Inventory Window</em></span> for display and click the <span class="emphasis"><em>weapons</em></span> button, we get two listings. The listing displays the proper data for each inventory item in the category.</p><p>To list the armour items in the inventory, we will click the armour button. The following screenshot will display the items in the armour category in the inventory based on our data:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_017.jpg" /></div><p>
</p><p>To illustrate the <span class="strong"><strong>onClick()</strong></span> event for the add button, please see the following screenshot from the <span class="strong"><strong>Console Window</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_018.jpg" /></div><p>
</p><p>We have come a long way. Let's take a moment to put things in perspective.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note47"></a>Note</h3><p>
</p><p>We first created the following scripts to lay the foundation for our Inventory System in the game:</p><p>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>BaseItem.cs</p></li><li style="list-style-type: disc"><p>InventoryItem.cs</p></li><li style="list-style-type: disc"><p>InventoryItemAgent.cs</p></li><li style="list-style-type: disc"><p>InventorySystem.cs</p></li></ul></div><p>
</p><p>The next step was to create the prefab for each inventory item and add to it the <code class="literal">InventoryItemAgent.cs</code> script. This would in turn allow us to assign the necessary data to identify the prefab as an inventory item during game play.</p><p>
</p><p>Next, we started work on the design and development of the user interface for the inventory system. We created a sketch of how we would like the inventory window to look, and implemented the framework using the build in UI architecture.
Slowly adding to the UI and applying different concepts and new elements, we built the final user interface for the inventory system.</p><p>
</p><p>Finally, we used the prefabs to test the complete addition and removal of the inventory items from the user interface.</p><p>
</p></div><p>The next challenge we face is how to actually apply the inventory items to the player character.</p></div></div>