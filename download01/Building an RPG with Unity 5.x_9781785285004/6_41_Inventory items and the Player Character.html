<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec41"></a>Inventory items and the Player Character</h2></div></div><hr /></div><p>Now that we have seen how to create the Inventory System, we need to be able to utilize it during game play to apply changes to our player character. In this section, we are going to examine how to do just that!</p><p>Here are some of the new features we need to work on:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Applying selected inventory items to the player character</p></li><li style="list-style-type: disc"><p>Performing accounting on both the player character and the inventory system</p></li><li style="list-style-type: disc"><p>Updating the game state accordingly</p></li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec49"></a>Applying inventory items</h3></div></div></div><p>We need to make some design decisions about how we are going to handle applying the inventory items to the player character, and in turn how the system will handle the event. For instance, let's assume the player character has acquired several weapons, let's say weapons A, B, and C.</p><p>Let's also assume that, initially, the player does not have any active weapons. Now, the player selects to activate weapon A. For this scenario, we would just use the inventory item data and activate weapon A for the player, taking into consideration all of the accounting that comes with the weapon.</p><p>Now, the player wants to change his/her weapon to B because it is more powerful and they would need it to defeat the boss. Since the player already has Weapon A active, what are we going to do with it before we activate Weapon B? Do we put it back into the game world, or do we put it back into our inventory for later consumption?</p><p>In our case, once you have an item in the inventory, it will stay with you until you actually delete it from the inventory, in which case it will be destroyed. We need to make a few code modifications and also some prefab modifications to have everything working together.</p><p>Let's start with the <span class="emphasis"><em>InventoryItem.cs</em></span> script. We are going to add new data to store the type of the Inventory Item. This is necessary because we have a category and within the category we have different types of items. This is specifically true for the Armour category! For instance, we have a Helmet, a Shield, a Shoulder Pad, and so on.</p><p>Here is the code listing:</p><pre class="programlisting">using System; &#13;
using UnityEngine; &#13;
using System.Collections; &#13;
 &#13;
 &#13;
[Serializable] &#13;
public class InventoryItem : BaseItem &#13;
{ &#13;
  public enum ItemType &#13;
  { &#13;
    HELMET = 0, &#13;
    SHIELD = 1, &#13;
    SHOULDER_PAD = 2, &#13;
    KNEE_PAD = 3, &#13;
    BOOTS = 4, &#13;
    WEAPON = 5 &#13;
  } &#13;
 &#13;
  [SerializeField] &#13;
  private ItemCategory category; &#13;
  [SerializeField] &#13;
  private ItemType type; &#13;
  [SerializeField] &#13;
  private float strength; &#13;
  [SerializeField] &#13;
  private float weight; &#13;
 &#13;
  public ItemCategory CATEGORY &#13;
  { &#13;
    get { return this.category; } &#13;
    set { this.category = value; } &#13;
  } &#13;
 &#13;
  public ItemType TYPE &#13;
  { &#13;
    get { return this.type; } &#13;
    set { this.type = value; } &#13;
  } &#13;
 &#13;
  public float STRENGTH &#13;
  { &#13;
    get { return this.strength; } &#13;
    set { this.strength = value; } &#13;
  } &#13;
 &#13;
  public float WEIGHT &#13;
  { &#13;
    get { return this.weight; } &#13;
    set { this.weight = value; } &#13;
  } &#13;
 &#13;
  public void CopyInventoryItem(InventoryItem item) &#13;
  { &#13;
    this.CATEGORY = item.CATEGORY; &#13;
    this.TYPE = item.TYPE; &#13;
    this.DESCRIPTION = item.DESCRIPTION; &#13;
    this.NAME = item.NAME; &#13;
    this.STRENGTH = item.STRENGTH; &#13;
    this.WEIGHT = item.WEIGHT; &#13;
  } &#13;
} &#13;
</pre><p>When you make the update to your script, make sure to go back into the IDE and select the proper type for each prefab we have created, to represent your inventory items:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_019.jpg" /></div><p>
</p><p>You will need to update the <span class="strong"><strong>Type</strong></span> field for each prefab you have created for your inventory items.</p><p>We would also need to update the <code class="literal">PC.cs</code> script. We are going to make private the original data variables and create public properties to access them. This way, if we need to perform any extra work prior to or after setting or getting the property value, we can do so easily.</p><p>Here is the listing for the <code class="literal">PC.cs</code> script:</p><pre class="programlisting">using System; &#13;
using UnityEngine; &#13;
 &#13;
public delegate void WeaponChangedEventHandler(PC.WEAPON_TYPE weapon); &#13;
 &#13;
[Serializable] &#13;
public class PC : BaseCharacter &#13;
{ &#13;
  //public event WeaponChangedEventHandler PlayerWeaponChanged; &#13;
 &#13;
  public enum SHOULDER_PAD &#13;
  { &#13;
    none = 0, &#13;
    SP01 = 1, &#13;
    SP02 = 2, &#13;
    SP03 = 3, &#13;
    SP04 = 4 &#13;
  }; &#13;
 &#13;
  public enum BODY_TYPE { normal = 1, BT01 = 2, BT02 = 3 }; &#13;
 &#13;
  // Shoulder Pad &#13;
  [SerializeField] &#13;
  private SHOULDER_PAD selectedShoulderPad = SHOULDER_PAD.none; &#13;
  public SHOULDER_PAD SELECTED_SHOULDER_PAD &#13;
  { &#13;
    get { return this.selectedShoulderPad; } &#13;
    set { this.selectedShoulderPad = value; } &#13;
  } &#13;
 &#13;
  [SerializeField] &#13;
  private BODY_TYPE selectedBodyType = BODY_TYPE.normal; &#13;
  public BODY_TYPE SELECTED_BODY_TYPE &#13;
  { &#13;
    get { return this.selectedBodyType; } &#13;
    set { this.selectedBodyType = value; } &#13;
  } &#13;
 &#13;
  // Do we have a knee pad? &#13;
  private bool kneePad = false; &#13;
  public bool KNEE_PAD &#13;
  { &#13;
    get { return this.kneePad; } &#13;
    set { this.kneePad = value; } &#13;
  } &#13;
 &#13;
  // Do we have a leg plate? &#13;
  private bool legPlate = false; &#13;
  public bool LEG_PLATE &#13;
  { &#13;
    get { return this.legPlate; } &#13;
    set { this.legPlate = value; } &#13;
  } &#13;
 &#13;
  public enum WEAPON_TYPE &#13;
  { &#13;
    none = 0, &#13;
    axe1 = 1, &#13;
    axe2 = 2, &#13;
    club1 = 3, &#13;
    club2 = 4, &#13;
    falchion = 5, &#13;
    gladius = 6, &#13;
    mace = 7, &#13;
    maul = 8, &#13;
    scimitar = 9, &#13;
    spear = 10, &#13;
    sword1 = 11, &#13;
    sword2 = 12, &#13;
    sword3 = 13 &#13;
  }; &#13;
 &#13;
  // Store the selected weapon. In the future we might want to create a &#13;
  // event handler to raise an even when the weapon is being changed in the setter &#13;
  [SerializeField] &#13;
  private WEAPON_TYPE selectedWeapon = WEAPON_TYPE.none; &#13;
  public WEAPON_TYPE SELECTED_WEAPON &#13;
  { &#13;
    get { return this.selectedWeapon; } &#13;
    set &#13;
    { &#13;
      this.selectedWeapon = value; &#13;
      //if (PlayerWeaponChanged != null) &#13;
      //{ &#13;
      //  // All listeners will be invoked &#13;
      //  PlayerWeaponChanged(this.selectedWeapon); &#13;
      //} &#13;
    } &#13;
  } &#13;
 &#13;
 &#13;
  public enum HELMET_TYPE { none = 0, HL01 = 1, HL02 = 2, HL03 = 3, HL04 = 4 }; &#13;
 &#13;
  // do we have any helmet? Which one is selected if any? &#13;
  [SerializeField] &#13;
  private HELMET_TYPE selectedHelmet = HELMET_TYPE.none; &#13;
  public HELMET_TYPE SELECTED_HELMET &#13;
  { &#13;
    get { return this.selectedHelmet; } &#13;
    set { this.selectedHelmet = value; } &#13;
  } &#13;
 &#13;
  public enum SHIELD_TYPE { none = 0, SL01 = 1, SL02 = 2 }; &#13;
 &#13;
  // Do we have a shield on? Which shiled is active? &#13;
  [SerializeField] &#13;
  private SHIELD_TYPE selectedShield = SHIELD_TYPE.none; &#13;
  public SHIELD_TYPE SELECTED_SHIELD &#13;
  { &#13;
    get { return this.selectedShield; } &#13;
    set { this.selectedShield = value; } &#13;
  } &#13;
 &#13;
  public int SKIN_ID = 1; &#13;
 &#13;
  public enum BOOT_TYPE { none = 0, BT01 = 1, BT02 = 2 }; &#13;
 &#13;
  [SerializeField] &#13;
  private BOOT_TYPE selectedBoot = BOOT_TYPE.none; &#13;
  public BOOT_TYPE SELECTED_BOOT &#13;
  { &#13;
    get { return this.selectedBoot; } &#13;
    set { this.selectedBoot = value; } &#13;
  } &#13;
 &#13;
  [SerializeField] &#13;
  private InventoryItem selectedArmour; &#13;
  public InventoryItem SELECTED_ARMOUR &#13;
  { &#13;
    get { return this.selectedArmour; } &#13;
    set { this.selectedArmour = value; } &#13;
  } &#13;
} &#13;
</pre><p>The next code modification will be on the <code class="literal">CharacterCustomization.cs </code>script. Since this script has been used in the character customization scene, we can utilize the same script and expand it to apply the visual changes to our player character. But before we can utilize this script, we will need to copy the actual component from the <code class="literal">Base</code> GameObject defined in our Character Customization scene, and paste it into the <code class="literal">PC_CC</code> GameObject representing our player character!</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip48"></a>Tip</h3><p>When you copy a component using the gear menu in the <span class="emphasis"><em>Inspector Window</em></span>, all the configurations, links, and references stay intact! When you paste the component using again the gear menu in the <span class="emphasis"><em>Inspector Window</em></span>, you will have an exact copy of the component. This will eliminate the need for us to rewire all of the GameObjects to their references in the script.</p></div><p>The following two screenshots will illustrate the copy of the component from the Base GameObject to the <code class="literal">PC_CC</code> GameObject:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_020.jpg" /></div><p>
</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_021.jpg" /></div><p>
</p><p>This works because the script is actually referencing the different parts of the <code class="literal">PC_CC</code> GameObject hierarchy in the first place. The difference was that it used to be attached to the <code class="literal">Base</code> GameObject for the customization.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip49"></a>Tip</h3><p>Can they both be active at the same time in the same scene, at this point? Yes! However, if you have the time, you might want to redo your UI event triggers to use the <code class="literal">PC_CC</code> GameObject and then you can remove the <code class="literal">CharacterCustomization.cs</code> script from the <code class="literal">Base</code> GameObject.</p></div><p>Now we actually need to modify the <code class="literal">CharacterCustomization.cs</code> script to activate the different parts of the player character model using the data it will receive from the <code class="literal">GameMaster.cs</code> script.</p><p>Here is a partial listing of the <code class="literal">CharacterCustomization.cs</code> script:</p><pre class="programlisting">public void SetWeaponType(PC.WEAPON_TYPE id) &#13;
  { &#13;
    switch (System.Convert.ToInt32(id)) &#13;
    { &#13;
      case 0: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 1: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(true); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 2: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(true); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 3: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(true); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 4: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(true); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 5: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(true); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 6: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(true); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 7: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(true); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 8: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(true); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 9: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(true); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 10: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(true); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 11: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(true); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 12: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(true); &#13;
          this.SWORD_SHORT_LOD0.SetActive(false); &#13;
          break; &#13;
        } &#13;
      case 13: &#13;
        { &#13;
          this.AXE_01LOD0.SetActive(false); &#13;
          this.AXE_02LOD0.SetActive(false); &#13;
          this.CLUB_01LOD0.SetActive(false); &#13;
          this.CLUB_02LOD0.SetActive(false); &#13;
          this.FALCHION_LOD0.SetActive(false); &#13;
          this.GLADIUS_LOD0.SetActive(false); &#13;
          this.MACE_LOD0.SetActive(false); &#13;
          this.MAUL_LOD0.SetActive(false); &#13;
          this.SCIMITAR_LOD0.SetActive(false); &#13;
          this.SPEAR_LOD0.SetActive(false); &#13;
          this.SWORD_BASTARD_LOD0.SetActive(false); &#13;
          this.SWORD_BOARD_01LOD0.SetActive(false); &#13;
          this.SWORD_SHORT_LOD0.SetActive(true); &#13;
          break; &#13;
        } &#13;
 &#13;
    } &#13;
  } &#13;
</pre><p>I have not listed the whole script as it will take a lot of pages. But the basic concept is to overload the <code class="literal">SetXXXXX()</code> functions so that they will perform the necessary tasks based on the parameters coming in, such as, for the previous example, <code class="literal">PC.WEAPON_TYPE</code>.</p><p>The next scrip that needs to be modified is the <code class="literal">UIController.cs</code> script. This is where we are going to modify the five functions we created previously to actually apply the changes to the player character. Let's look at one of the functions that have been modified without listing the whole code:</p><pre class="programlisting">  public void DisplayWeaponsCategory() &#13;
  { &#13;
    if(GameMaster.instance.DISPLAY_INVENTORY) &#13;
    { &#13;
      this.ClearInventoryItemsPanel(); &#13;
 &#13;
      foreach (InventoryItem item in GameMaster.instance.INVENTORY.WEAPONS) &#13;
      { &#13;
        GameObject objItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
        InventoryItemUI invItem = objItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
        invItem.txtItemElement.text = &#13;
          string.Format("Name: {0}, Description: {1}, Strength: {2}, Weight: {3}", &#13;
                                  item.NAME, &#13;
                                  item.DESCRIPTION, &#13;
                                  item.STRENGTH, &#13;
                                  item.WEIGHT); &#13;
 &#13;
 &#13;
        invItem.item = item; &#13;
 &#13;
        // add button triggers &#13;
        invItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button add for {0}, {1}", invItem.txtItemElement.text, invItem.item.NAME)); &#13;
 &#13;
          // let's apply the selected item to the player character &#13;
          GameMaster.instance.PC_CC.SELECTED_WEAPON = (PC.WEAPON_TYPE)Enum.Parse(typeof(PC.WEAPON_TYPE), invItem.item.NAME); &#13;
          GameMaster.instance.PlayerWeaponChanged(); &#13;
        }); &#13;
 &#13;
        // delete button triggers &#13;
        invItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
        { &#13;
          Debug.Log(string.Format("You have clicked button delete for {0}", invItem.txtItemElement.text)); &#13;
          Destroy(objItem); &#13;
        }); &#13;
 &#13;
        objItem.transform.SetParent(this.PanelItem); &#13;
      } &#13;
 &#13;
    } &#13;
  }  &#13;
</pre><p>If you notice, we are also saving the <span class="emphasis"><em>item</em></span> from the <code class="literal">foreach</code> loop into the <code class="literal">invItem.item</code> variable. This is important to make sure the <code class="literal">OnClick()</code> listener is picking up the current <code class="literal">InventoryItem</code> from the list.</p><p>The bulk of the work is being done in the <code class="literal">onClick.AddListener()</code> for each button. We are basically setting the selected weapon using the <code class="literal">GameMaster.instance</code> to store and then we are calling the <code class="literal">PlayerWeaponChanged()</code> function to handle some more features. You will see that in the next code listing.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip50"></a>Tip</h3><p>You will need to handle each add button listener in similar fashion, based on how you have designed and implemented your code and your prefabs.</p></div><p>Finally, we are going to make some modifications to the <code class="literal">GameMaster.cs</code> script. Here is the listing:</p><pre class="programlisting">using UnityEngine; &#13;
using UnityEngine.UI; &#13;
using UnityEngine.SceneManagement; &#13;
 &#13;
using System.Collections; &#13;
using System; &#13;
 &#13;
public class GameMaster : MonoBehaviour &#13;
{ &#13;
  public static GameMaster instance; &#13;
 &#13;
  // let's have a reference to the player character GameObject &#13;
  public GameObject PC_GO; &#13;
 &#13;
  // reference to player Character Customization &#13;
  public PC PC_CC; &#13;
  public InventorySystem INVENTORY; &#13;
 &#13;
  public GameObject START_POSITION; &#13;
 &#13;
  public GameObject CHARACTER_CUSTOMIZATION; &#13;
 &#13;
  public LevelController LEVEL_CONTROLLER; &#13;
  public AudioController AUDIO_CONTROLLER; &#13;
 &#13;
  // Ref to UI Elements ... &#13;
  public bool DISPLAY_SETTINGS = false; &#13;
  public bool DISPLAY_INVENTORY = false; &#13;
 &#13;
  public UIController UI; &#13;
 &#13;
  void Awake() &#13;
  { &#13;
    // simple singleton &#13;
    if (instance == null) &#13;
    { &#13;
      instance = this; &#13;
 &#13;
      instance.DISPLAY_INVENTORY = false; &#13;
      instance.DISPLAY_SETTINGS = false; &#13;
 &#13;
      // initialize Level Controller &#13;
      instance.LEVEL_CONTROLLER = new LevelController(); &#13;
 &#13;
      // initialize Audio Controller &#13;
      instance.AUDIO_CONTROLLER = new AudioController(); &#13;
      instance.AUDIO_CONTROLLER.AUDIO_SOURCE = GameMaster.instance.GetComponent&lt;AudioSource&gt;(); &#13;
      instance.AUDIO_CONTROLLER.SetDefaultVolume(); &#13;
 &#13;
      // initialize Inventory System &#13;
      instance.INVENTORY = new InventorySystem(); &#13;
 &#13;
    } &#13;
    else if (instance != this) &#13;
    { &#13;
      Destroy(this); &#13;
    } &#13;
 &#13;
    // keep the game object when moving from &#13;
    // one scene to the next scene &#13;
    DontDestroyOnLoad(this); &#13;
  } &#13;
 &#13;
  #region Player Inventory Items Applied &#13;
  public void PlayerWeaponChanged() &#13;
  { &#13;
    Debug.Log(string.Format("Weapon changed to: {0}", instance.PC_CC.SELECTED_WEAPON.ToString())); &#13;
    GameMaster.instance.PC_GO.GetComponent&lt;CharacterCustomization&gt;().SetWeaponType(GameMaster.instance.PC_CC.SELECTED_WEAPON); &#13;
  } &#13;
 &#13;
  public void PlayerArmourChanged(InventoryItem item) &#13;
  { &#13;
    Debug.Log(string.Format("Armour changed to: {0} {1}", instance.PC_CC.SELECTED_ARMOUR.NAME, instance.PC_CC.SELECTED_ARMOUR.TYPE)); &#13;
     &#13;
    switch (item.TYPE.ToString()) &#13;
    { &#13;
      case "HELMET": &#13;
        { &#13;
          GameMaster.instance.PC_CC.SELECTED_HELMET = (PC.HELMET_TYPE)Enum.Parse(typeof(PC.HELMET_TYPE), instance.PC_CC.SELECTED_ARMOUR.NAME); &#13;
          GameMaster.instance.PC_GO.GetComponent&lt;CharacterCustomization&gt;().SetHelmetType(GameMaster.instance.PC_CC.SELECTED_HELMET); &#13;
          break; &#13;
        } &#13;
      case "SHIELD": &#13;
        { &#13;
          GameMaster.instance.PC_CC.SELECTED_SHIELD = (PC.SHIELD_TYPE)Enum.Parse(typeof(PC.SHIELD_TYPE), instance.PC_CC.SELECTED_ARMOUR.NAME); &#13;
          GameMaster.instance.PC_GO.GetComponent&lt;CharacterCustomization&gt;().SetShieldType(GameMaster.instance.PC_CC.SELECTED_SHIELD); &#13;
          break; &#13;
        } &#13;
      case "SHOULDER_PAD": &#13;
        { &#13;
          GameMaster.instance.PC_CC.SELECTED_SHOULDER_PAD = (PC.SHOULDER_PAD)Enum.Parse(typeof(PC.SHOULDER_PAD), instance.PC_CC.SELECTED_ARMOUR.NAME); &#13;
          GameMaster.instance.PC_GO.GetComponent&lt;CharacterCustomization&gt;().SetShoulderPad(GameMaster.instance.PC_CC.SELECTED_SHOULDER_PAD); &#13;
          break; &#13;
        } &#13;
      case "KNEE_PAD": &#13;
        { &#13;
          break; &#13;
        } &#13;
      case "BOOTS": &#13;
        { &#13;
          break; &#13;
        } &#13;
 &#13;
    } &#13;
  } &#13;
 &#13;
  #endregion &#13;
 &#13;
  // for each level/scene that has been loaded &#13;
  // do some of the preparation work &#13;
  void OnLevelWasLoaded() &#13;
  { &#13;
    GameMaster.instance.LEVEL_CONTROLLER.OnLevelWasLoaded(); &#13;
  } &#13;
 &#13;
  // Use this for initialization &#13;
  void Start() &#13;
  { &#13;
    // let's find a reference to the UI controller of the loaded scene &#13;
    if (GameObject.FindGameObjectWithTag("UI") != null) &#13;
    { &#13;
      GameMaster.instance.UI = GameObject.FindGameObjectWithTag("UI").GetComponent&lt;UIController&gt;(); &#13;
    } &#13;
 &#13;
    GameMaster.instance.UI.SettingsCanvas.gameObject.SetActive(GameMaster.instance.DISPLAY_SETTINGS); &#13;
  } &#13;
 &#13;
  // Update is called once per frame &#13;
  void Update() &#13;
  { &#13;
    // only when we are in the game level &#13;
    if(instance.LEVEL_CONTROLLER.CURRENT_SCENE.name==SceneName.Level_1) &#13;
    { &#13;
      if (Input.GetKeyUp(KeyCode.J)) &#13;
      { &#13;
        //Debug.Log("Pressing J"); &#13;
        instance.DISPLAY_INVENTORY = !instance.DISPLAY_INVENTORY; &#13;
        instance.UI.DisplayInventory(); &#13;
      } &#13;
    } &#13;
  } &#13;
 &#13;
  public void MasterVolume(float volume) &#13;
  { &#13;
    GameMaster.instance.AUDIO_CONTROLLER.MasterVolume(volume); &#13;
  } &#13;
 &#13;
  public void StartGame() &#13;
  { &#13;
    GameMaster.instance.LoadLevel(); &#13;
  } &#13;
 &#13;
  public void LoadLevel() &#13;
  { &#13;
    GameMaster.instance.LEVEL_CONTROLLER.LoadLevel(); &#13;
  } &#13;
 &#13;
  public void RPG_Destroy(GameObject obj) &#13;
  { &#13;
    Destroy(obj); &#13;
  } &#13;
} &#13;
</pre><p>The only function I want to have you take note of is the <code class="literal">PlayerArmourChanged()</code> function. It was because of this function that we have to add the new <span class="emphasis"><em>Type</em></span> data variable and datatype to the <span class="emphasis"><em>InventoryItem</em></span> class. We have a lot of different types of armour, and we needed a way to distinguish between them. Based on the armour type, we would then call the appropriate function to active them on the player character.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec50"></a>How It Looks</h3></div></div></div><p>This chapter was a bit involved in regard to configuring your GameObjects and prefabs, and more importantly the code that went along to glue everything together. I have tried to keep things as simple as possible.</p><p>Here is a screenshot illustrating the player character prior to picking up the inventory items placed on the level. Notice that the <code class="literal">INVENTORY</code> is empty in the <code class="literal">GameMaster</code> object and also there are no selected items in the <code class="literal">PC_CC</code> object:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_022.jpg" /></div><p>
</p><p>After I move the player character to pick up the inventory items, I will use the hot key programmed to bring up the Inventory Window, in my case, the <span class="strong"><strong>J </strong></span>key. The following screenshot captures the interaction:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_023.jpg" /></div><p>
</p><p>And now let's see how things change when we apply a few of the inventory items to the player character:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_024.jpg" /></div><p>
</p></div></div>