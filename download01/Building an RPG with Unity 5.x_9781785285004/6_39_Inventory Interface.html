<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec39"></a>Inventory Interface</h2></div></div><hr /></div><p>It is now time to think about how we are going to visualize our inventory during game play. Creating a user interface (UI) for any game is a challenging task. You need to have a balanced approach about the amount of information you want to display on the screen at playtime without interfering with the game play. In the meantime, you want to make sure that the player has the most crucial and important information necessary to complete their mission at hand.</p><p>With that said, let's see how we can design a simple user interface to enable the player with the basics of interacting with the inventory system. Here is a list of minimum features that the player should be able to perform:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Display the Inventory at any time during game play</p></li><li style="list-style-type: disc"><p>Navigate based on category</p></li><li style="list-style-type: disc"><p>See what items are listed under each category</p></li><li style="list-style-type: disc"><p>Be able to remove an item from the inventory</p></li><li style="list-style-type: disc"><p>Be able to consume an item from the inventory</p></li><li style="list-style-type: disc"><p>See what inventory items are already in use by the player</p></li></ul></div><p>This list will give us a good start for implementing our inventory interface. Let's start by identifying the categories that will need to be displayed. The categories are defined as an <span class="strong"><strong>enum</strong></span> named <code class="literal">ItemCategory</code> in the <code class="literal">BaseItem</code> class.</p><p>We have the following: weapons, armour, clothing, health, and potions:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_008.jpg" /></div><p>
</p><p>The preceding diagramÂ is a concept I am leaning towards for the implementation of the inventory interface. The interface can be constructed by utilizing the following UI elements:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Buttons</p></li><li style="list-style-type: disc"><p>Panels</p></li><li style="list-style-type: disc"><p>Text</p></li><li style="list-style-type: disc"><p>Images</p></li></ul></div><p>Each category will have a button and there will be one main panel that will contain the list of items per category as illustrated in the preceding diagram. Each item will be contained in its own panel that will contain an image of the inventory item, the item description, and two buttons that can be used to add or remove the item from the inventory system.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec44"></a>Creating the inventory UI framework</h3></div></div></div><p>Let's start by first implementing the initial framework for our inventory system graphical interface. In the main scene of your project, go ahead and create a new <span class="emphasis"><em>Canvas</em></span> GameObject if you have not done so already.</p><p>To do so, right-click on the <span class="strong"><strong>Hierarchy</strong></span>
<span class="emphasis"><em> Window</em></span> and select <span class="strong"><strong>UI | Panel</strong></span>. This will automatically create a <span class="strong"><strong>Canvas</strong></span> GameObject and a Panel UI Element as a child to the canvas.</p><p>Rename this panel <span class="strong"><strong>PanelInventory</strong></span>. This will be the main panel that will contain everything else. Now, let's go ahead and start building the buttons that will represent our main categories.</p><p>Similarly, right-click on the <span class="strong"><strong>PanelInventory</strong></span> GameObject and select <span class="strong"><strong>UI | Button</strong></span>. This will make sure that the newly created button becomes a child of the <span class="strong"><strong>PanelInventory</strong></span>. If, for whatever reason, this is not the case in the <span class="strong"><strong>Hierarchy Window</strong></span> after the creation of the button(s), simply drag the newly created button(s) under the <span class="strong"><strong>PanelInventory</strong></span> panel. Do this for all the five categories. Rename the buttons appropriately, for example, <span class="strong"><strong>butWeaponsCategory</strong></span> and so on.</p><p>Change the caption of the button so that it reflects the function of the button. Also, rename the <span class="strong"><strong>Text</strong></span> element to something like the following: <span class="strong"><strong>txtWeaponsCategory</strong></span> and so on.</p><p>Finally, add a new <span class="strong"><strong>Panel</strong></span> element to the <span class="strong"><strong>PanelInventory</strong></span> again by selecting the <span class="strong"><strong>PanelInventory</strong></span> GameObject and right-clicking and selecting <span class="strong"><strong>UI | Panel</strong></span>. Rename the newly created panel <span class="strong"><strong>PanelCategory</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_009.jpg" /></div><p>
</p><p>Your inventory user interface should look something like the screenshot shown. Before we get more involved, let's go ahead and hook up some of the basics for showing and hiding the inventory interface for the player. To do this, we will need to modify the <code class="literal">UIController.cs</code>
<span class="emphasis"><em>, </em></span>
<code class="literal">LevelController.cs</code>, and also the <code class="literal">GameMaster.cs</code> scripts.</p><p>I will not be listing the whole source file, as we will do that later on in the chapter. These are the changes for each script for now:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">UIController.cs</code>: Added a new function named <code class="literal">DisplayInventory()</code> and a new variable to reference the inventory canvas named <code class="literal">InventoryCanvas</code>:</p></li></ul></div><pre class="programlisting">  public void DisplayInventory() &#13;
  { &#13;
this.InventoryCanvas.gameObject.SetActive(GameMaster.instance.DISPLAY_INVENTORY); &#13;
    Debug.Log("Display Inventory Function"); &#13;
  } &#13;
</pre><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">LevelController.cs</code>: Updated the <code class="literal">OnlevelWasLoaded()</code> function to assign the <code class="literal">uiController </code>GameObject to the <code class="literal">GameMaster</code> instance if one is present:</p></li></ul></div><pre class="programlisting">    if(GameObject.FindGameObjectWithTag("UI")) &#13;
    { &#13;
      GameMaster.instance.UI = GameObject.FindGameObjectWithTag("UI").GetComponent&lt;UIController&gt;(); &#13;
    } &#13;
</pre><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">GameMaster.cs</code>: Modified the <code class="literal">Update()</code> function to check and see if the J key was pressed and released. This in turn toggled a Boolean variable to see if we are supposed to show or hide the inventory interface:</p></li></ul></div><pre class="programlisting">  void Update() &#13;
  { &#13;
    // only when we are in the game level &#13;
    if(instance.LEVEL_CONTROLLER.CURRENT_SCENE.name==SceneName.Level_1) &#13;
    { &#13;
      if (Input.GetKeyUp(KeyCode.J)) &#13;
      { &#13;
        Debug.Log("Pressing J"); &#13;
        instance.DISPLAY_INVENTORY = !instance.DISPLAY_INVENTORY; &#13;
        instance.UI.DisplayInventory(); &#13;
      } &#13;
    } &#13;
  } &#13;
</pre><p>If you test your scene from the main menu, you will be able to test out the interface and toggle it on and off.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip43"></a>Tip</h3><p>Don't forget that you will need to disable the Canvas for the Inventory System at design time or at runtime when the game loads initially.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec45"></a>Designing a Dynamic Item Viewer</h3></div></div></div><p>The next challenge for us is to create a method to dynamically populate the inventory items and displaying them properly on the user interface. We are going to use two new UI elements that we have not used before. We will be using a <span class="emphasis"><em>ScrollView</em></span> to give us the ability to scroll through the items when needed. We are also going to take a look at some of the <span class="emphasis"><em>Layout</em></span> UI elements that are available out of the box in Unity 5.x.</p><p>Let's first get the scroll view set up and also be able to add a simple UI prefab to the scroll view. Once this is done, we can go ahead and enhance the UI prefab to handle what we have outlined in the previous section.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec15"></a>Adding a Scroll View</h4></div></div></div><p>We need to make a way to display multiple inventory items on the screen. We now need to learn how to create a scrollable view for the Inventory UI:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_010.jpg" /></div><p>
</p><p>Go to the scene where you have created your Inventory UI, and select <span class="emphasis"><em>PanelCategory</em></span> in the <span class="emphasis"><em>Canvas</em></span>. Right-click and select <span class="emphasis"><em>UI | Scroll View</em></span> to add a scroll view UI element. You should now have a scroll view UI element with the associated children under your <span class="emphasis"><em>PanelCategory</em></span> panel. The children are going to be <span class="emphasis"><em>Viewport</em></span>, <span class="emphasis"><em>Scrollbar Horizontal</em></span>, and <span class="emphasis"><em>Scrollbar Vertical</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note44"></a>Note</h3><p>Make your adjustment to the Scroll View UI element before you delete the children.</p></div><p>We are going to make some modifications to the default Scroll View. Go ahead and delete the following from the <span class="emphasis"><em>Scroll View</em></span>: the <span class="emphasis"><em>Scrollbar Horizontal</em></span>, <span class="emphasis"><em>Scrollbar Vertical</em></span>, and <span class="emphasis"><em>Viewport</em></span> child elements. After you are done, your screen should look something like in the screenshot shown.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_011.jpg" /></div><p>
</p><p>Next, we need to add a <span class="strong"><strong>Panel</strong></span> element as a child to our <span class="strong"><strong>Scroll View</strong></span>. Go ahead and select the scroll view and right-click and select <span class="strong"><strong>UI | Panel</strong></span>. Rename the newly added panel <span class="strong"><strong>PanelItem</strong></span>. We need to add two Layout components to our <span class="strong"><strong>PanelItem</strong></span>. To do this, select the <span class="strong"><strong>PanelItem</strong></span>, and from the <span class="strong"><strong>Inspector Window</strong></span>, select <span class="strong"><strong>Add Component | Layout | Vertical Layout Group</strong></span> and once more select <span class="strong"><strong>Add Component | Layout | Content Size Filter</strong></span>.</p><p>Go ahead and modify the following attributes under the <span class="strong"><strong>Vertical Layout Group</strong></span> components. Set the <span class="strong"><strong>Left, Right, Top and Bottom Padding</strong></span> to <span class="strong"><strong>3</strong></span>. Set the <span class="strong"><strong>Spacing</strong></span> to <span class="strong"><strong>0</strong></span>, change the <span class="strong"><strong>Child Alignment </strong></span>to <span class="strong"><strong>Upper Left</strong></span>, and check the <span class="strong"><strong>Child Force Expand</strong></span> to <span class="strong"><strong>True</strong></span> for both <span class="strong"><strong>Width</strong></span> and <span class="strong"><strong>Height</strong></span>.</p><p>For the Content Size Filter component, set the <span class="strong"><strong>Horizontal Fit</strong></span> to <span class="strong"><strong>Unconstrained</strong></span> and the <span class="strong"><strong>Vertical Fit</strong></span> to <span class="strong"><strong>Min Size</strong></span>.</p><p>Finally, in the <span class="strong"><strong>Rect Transform</strong></span> component, change the <span class="strong"><strong>Anchor Point</strong></span> to <span class="strong"><strong>Top Center</strong></span>, and modify the <span class="strong"><strong>Pos Y</strong></span> to <span class="strong"><strong>-10</strong></span>.</p><p>At this point, we have the basic framework in place. The next step it to populate our newly created <span class="strong"><strong>Scroll</strong></span>
<span class="strong"><strong>View</strong></span>!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec16"></a>Adding Elements to PanelItem and Scroll View</h4></div></div></div><p>For starters, let's go ahead and add a <span class="emphasis"><em>Text</em></span> element under the <span class="strong"><strong>PanelItem</strong></span> panel. Again, select the <span class="strong"><strong>PanelItem</strong></span> element and right-click and select <span class="strong"><strong>UI | Text.</strong></span> Next, select the text element and rename it <span class="strong"><strong>txtItemElement</strong></span>. We need to add a new component to the Text element; from the <span class="strong"><strong>Inspector Window</strong></span>, go ahead and select <span class="strong"><strong>Add Component | Layout | Layout Element</strong></span>.</p><p>Modify the <span class="strong"><strong>Min Height</strong></span> attribute of the <span class="strong"><strong>Layout Element</strong></span> component to <span class="strong"><strong>20</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_012.jpg" /></div><p>
</p><p>We need a means to access and modify the <span class="strong"><strong>Text</strong></span> attribute of the new Text UI element. In order to do this, we need to create a new script called <span class="strong"><strong>InventoryItemUI.cs</strong></span>. The code will just have a public variable that will reference the Text element. Here is the listing:</p><pre class="programlisting">using UnityEngine; &#13;
using UnityEngine.UI; &#13;
 &#13;
public class InventoryItemUI : MonoBehaviour { &#13;
  public Text txtItemElement; &#13;
} &#13;
</pre><p>Finally, drag and drop the Text element from the Hierarchy Window into the <span class="strong"><strong>TextItemElement</strong></span> attribute of the <span class="strong"><strong>InventoryItemUI</strong></span> component attached to the <span class="strong"><strong>txtItemElement</strong></span> object. Refer to the preceding screenshot.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip45"></a>Tip</h3><p>The script is used to self-reference. We will use it to modify the text component of the Text UI element.</p></div><p>Now we will need to create a <span class="strong"><strong>Prefab</strong></span> of the <span class="strong"><strong>txtItemElement</strong></span> by dragging and dropping it into a designated folder. I have created a new folder under my <span class="strong"><strong>Prefabs</strong></span> folder, named it <span class="emphasis"><em>UI</em></span>, and created the prefab in that folder. Refer to the previous screenshot.</p><p>You can now delete the <span class="strong"><strong>txtItemElement</strong></span> from the <span class="strong"><strong>Hierarchy Window</strong></span> under the <span class="strong"><strong>PanelItem</strong></span> object. We will be adding them dynamically during runtime.</p><p>There is one last configuration you will need to do before we move forward. You will need to add a Mask component to the Scroll View UI element. Select the Scroll View from the <span class="strong"><strong>Hierarchy Window</strong></span> and from the <span class="strong"><strong>Inspector Window</strong></span>, select <span class="strong"><strong>Add Component | UI | Mask</strong></span>. After the addition of the <span class="strong"><strong>Mask</strong></span> component, make sure that <span class="strong"><strong>the Show Mask Graphics</strong></span> attribute is <span class="emphasis"><em>unchecked</em></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec17"></a>Adding txtItemElement Dynamically</h4></div></div></div><p>Now it is time to add our inventory item placeholder dynamically to the <code class="literal">PanelItem</code> UI element. To do so, we will use the <code class="literal">UIController.cs</code> scrip. Go ahead and open up the scrip and add the following variable to the class:</p><pre class="programlisting">  public Transform PanelItem; &#13;
  public GameObject InventoryItemElement; &#13;
</pre><p>In the designer, you will need to assign the <code class="literal">PanelItem</code> UI element from the <span class="emphasis"><em>Canvas</em></span> GameObject and the <code class="literal">txtItemElement</code> prefab from the prefab folder.</p><p>Next, we are going to modify the <code class="literal">Update()</code> function so that when we press the <span class="strong"><strong>H </strong></span>key on the keyboard, it will go ahead and instantiate a new <code class="literal">InventoryItemElement</code> and make it a child element of the <code class="literal">PanelItem</code> object.</p><p>Here is the listing of the code:</p><pre class="programlisting">  public void Update() &#13;
  { &#13;
    if(Input.GetKeyUp(KeyCode.H)) &#13;
    { &#13;
      GameObject newButton = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
      InventoryItemUI txtItem = newButton.GetComponent&lt;InventoryItemUI&gt;(); &#13;
      txtItem.txtItemElement.text = string.Format("Adding New Item {0}", Time.deltaTime); &#13;
      newButton.transform.SetParent(this.PanelItem); &#13;
    } &#13;
  } &#13;
</pre><p>The preceding code listing simply instantiates the prefab and makes it a child of the <code class="literal">PanelItem</code> element. We are also changing the caption of the element and placing it with a timestamp to see the uniqueness of each UI element.</p><p>The outcome is shown in the following screenshot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_013.jpg" /></div><p>
</p><p>At this point, we have put together the main elements to have our inventory interface list items dynamically and be able to scroll through them.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec46"></a>Building the Final Inventory Item UI</h3></div></div></div><p>To create the actual Inventory Item user interface, we are going to need to use several UI elements. We will need a panel to be the container of the item. Within the <span class="emphasis"><em>Panel</em></span>, we are going to need to use an <span class="emphasis"><em>Image</em></span>, a <span class="emphasis"><em>Text</em></span>, and two <span class="emphasis"><em>Button</em></span> UI elements:</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip46"></a>Tip</h3><p>I will not be going through the steps of how to put the Panel together. You should know how to create user interfaces by now.
Just make sure that you add the <span class="emphasis"><em>Layout Element</em></span> component and <span class="emphasis"><em>Inventory Item UI</em></span> script to the Panel that will be the base for the Inventory Item.</p></div><p>
</p><div class="mediaobject"><img src="/graphics/9781785285004/graphics/image_06_014.jpg" /></div><p>
</p><p>The preceding screenshot illustrates the UI component that has been developed for displaying the Inventory Item. Since the UI component has been modified, we also have to update the <code class="literal">InventoryItemUI.cs</code> script to contain a reference to all of the new UI elements in the <span class="emphasis"><em>Panel</em></span>.</p><p>Here is the listing of the new <code class="literal">InventoryItemUI.cs</code>:</p><pre class="programlisting">using UnityEngine; &#13;
using UnityEngine.UI; &#13;
 &#13;
public class InventoryItemUI : MonoBehaviour { &#13;
  public Image  imgItem; &#13;
  public Text   txtItemElement; &#13;
  public Button butAdd; &#13;
  public Button butDelete; &#13;
} &#13;
</pre><p>We also need to update the <code class="literal">UIController.cs</code> script to handle the new prefab accordingly.</p><p>Here is the listing for the new UI prefab in <code class="literal">UIController.cs</code>:</p><pre class="programlisting">  public void Update() &#13;
  { &#13;
    if(Input.GetKeyUp(KeyCode.H)) &#13;
    { &#13;
      GameObject newItem = GameObject.Instantiate(this.InventoryItemElement) as GameObject; &#13;
      InventoryItemUI txtItem = newItem.GetComponent&lt;InventoryItemUI&gt;(); &#13;
      txtItem.txtItemElement.text = string.Format("Adding New Item {0}", Time.deltaTime); &#13;
 &#13;
      // button triggers      txtItem.butAdd.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; { &#13;
        Debug.Log(string.Format("You have clicked button add for {0}", txtItem.txtItemElement.text)); &#13;
      }); &#13;
 &#13;
      txtItem.butDelete.GetComponent&lt;Button&gt;().onClick.AddListener(() =&gt; &#13;
      { &#13;
        Debug.Log(string.Format("You have clicked button delete for {0}", txtItem.txtItemElement.text)); &#13;
        Destroy(newItem); &#13;
        Debug.Log("Item removed from inventory ..."); &#13;
      }); &#13;
 &#13;
      newItem.transform.SetParent(this.PanelItem); &#13;
    } &#13;
  } &#13;
</pre><p>In the preceding listing, the main concept I want to point out is the implementation of the <code class="literal">onClick()</code> event handler for the buttons within the prefab.</p><p>Since we are dynamically generating our UI and hence the buttons, we need to be able to trigger the <code class="literal">onClick()</code> function somewhere; this is done by adding a listener as shown in the code.</p><p>For now, when you click the <span class="strong"><strong>butAdd</strong></span> button, you will get an output on the <span class="strong"><strong>Console Window</strong></span> with the appropriate caption. When you click the <span class="strong"><strong>butDelete</strong></span> button, you will get another output on the <span class="strong"><strong>Console Window</strong></span> with the appropriate caption. Then the item will be destroyed, in other words, removed from the inventory.</p></div></div>