<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec32"></a>Improving Game Master</h2></div></div><hr /></div><p>The code we have so far works, but it is not very clean. Let's go ahead and structure the code a little better. Let's go ahead and create a new script called <code class="literal">LevelController.cs</code>. This new script will be handling the logic for our level management.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec35"></a>Level controller</h3></div></div></div><p>Here is a listing of <code class="literal">LevelController.cs</code>:</p><pre class="programlisting">using UnityEngine; &#13;
using UnityEngine.SceneManagement; &#13;
using System.Collections; &#13;
 &#13;
/// &lt;summary&gt; &#13;
/// This class is used to make referencing easier in the code &#13;
/// &lt;/summary&gt; &#13;
public static class SceneName &#13;
{ &#13;
  public const string MainMenu = "MainMenu"; &#13;
  public const string CharacterCustomization = "CH4_CC"; &#13;
  public const string Level_1 = "CH5"; &#13;
} &#13;
 &#13;
public class LevelController &#13;
{ &#13;
  // let's have a reference to the current scene/level &#13;
  public Scene CURRENT_SCENE &#13;
  { &#13;
    get { return SceneManager.GetActiveScene(); } &#13;
  } &#13;
 &#13;
  // keep the numerical level value &#13;
  public int LEVEL = 0; &#13;
 &#13;
  public void OnLevelWasLoaded() &#13;
  { &#13;
    // if we are in the character customization scene,  &#13;
    // let's get a reference to the base game object for future use. &#13;
    if (this.CURRENT_SCENE.Equals(SceneName.CharacterCustomization)) &#13;
    { &#13;
      if (GameObject.FindGameObjectWithTag("BASE") != null) &#13;
      { &#13;
        GameMaster.instance.CHARACTER_CUSTOMIZATION = GameObject.FindGameObjectWithTag("BASE") as GameObject; &#13;
      } &#13;
    } &#13;
 &#13;
    // If we are at any other scene except character customization &#13;
    // let's go ahead and get reference to player and player &#13;
    // stat position &#13;
    if (this.CURRENT_SCENE.name.Equals(SceneName.CharacterCustomization)) &#13;
    { &#13;
      // let's get a reference to our player character &#13;
      if (GameMaster.instance.PC == null) &#13;
      { &#13;
        if (GameObject.FindGameObjectWithTag("Player") != null) &#13;
        { &#13;
          GameMaster.instance.PC = GameObject.FindGameObjectWithTag("Player") as GameObject; &#13;
        } &#13;
      } &#13;
 &#13;
      if (GameObject.FindGameObjectWithTag("START_POSITION") != null) &#13;
      { &#13;
        GameMaster.instance.START_POSITION = GameObject.FindGameObjectWithTag("START_POSITION") as GameObject; &#13;
      } &#13;
 &#13;
      if (GameMaster.instance.START_POSITION != null &amp;&amp; GameMaster.instance.PC != null) &#13;
      { &#13;
        GameMaster.instance.PC.transform.position = GameMaster.instance.START_POSITION.transform.position; &#13;
        GameMaster.instance.PC.transform.rotation = GameMaster.instance.START_POSITION.transform.rotation; &#13;
      } &#13;
    } &#13;
 &#13;
    // determine what level we are on &#13;
    this.DetermineLevel(); &#13;
  } &#13;
 &#13;
  // this function will set a numerical value for our levels &#13;
  private void DetermineLevel() &#13;
  { &#13;
    switch (this.CURRENT_SCENE.name) &#13;
    { &#13;
      case SceneName.MainMenu: &#13;
      case SceneName.CharacterCustomization: &#13;
        { &#13;
          this.LEVEL = 0; &#13;
          break; &#13;
        } &#13;
 &#13;
      case SceneName.Level_1: &#13;
        { &#13;
          this.LEVEL = 1; &#13;
          GameMaster.instance.PC.GetComponent&lt;IKHandle&gt;().enabled = true; &#13;
          break; &#13;
        } &#13;
      default: &#13;
        { &#13;
          this.LEVEL = 0; &#13;
          break; &#13;
        } &#13;
    } &#13;
  } &#13;
 &#13;
  // this function will be used to load our scenes &#13;
  public void LoadLevel() &#13;
  { &#13;
    switch (GameMaster.instance.LEVEL_CONTROLLER.LEVEL) &#13;
    { &#13;
      case 0: &#13;
        { &#13;
          SceneManager.LoadScene(SceneName.CharacterCustomization); &#13;
          break; &#13;
        } &#13;
 &#13;
      // load level 1 &#13;
      case 1: &#13;
        { &#13;
          GameMaster.instance.PC = GameObject.FindGameObjectWithTag("Player") as GameObject; &#13;
          SceneManager.LoadScene(SceneName.Level_1); &#13;
          break; &#13;
        } &#13;
    } &#13;
  } &#13;
} &#13;
</pre><p>So, what I have done is basically move all of the code that deals with level management into <code class="literal">LevelController.cs</code>. Our GameMaster drives the LevelController class. We will see this a bit later.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec36"></a>Audio controller</h3></div></div></div><p>The next code clean up I want to do is for the audio. Let's create a new script called <code class="literal">AudioController.cs</code>. Here is the code for the new script:</p><pre class="programlisting">using UnityEngine; &#13;
using System.Collections; &#13;
 &#13;
public class AudioController &#13;
{ &#13;
  // initial audio levels for background and &#13;
  // sound FX &#13;
  public float AUDIO_LEVEL = 0.33f; &#13;
  public float FX_LEVEL = 0.33f; &#13;
 &#13;
  public AudioSource AUDIO_SOURCE; &#13;
 &#13;
  public void SetDefaultVolume() &#13;
  { &#13;
    this.AUDIO_SOURCE.volume = AUDIO_LEVEL; &#13;
  } &#13;
 &#13;
  public void MasterVolume(float volume) &#13;
  { &#13;
    this.AUDIO_LEVEL = volume; &#13;
    this.AUDIO_SOURCE.volume = AUDIO_LEVEL; &#13;
  } &#13;
} &#13;
</pre><p>The code is pretty straight forward. Now, let's take a look at what our <code class="literal">GameMaster.cs</code> looks like.</p><pre class="programlisting">using UnityEngine; &#13;
using UnityEngine.UI; &#13;
using UnityEngine.SceneManagement; &#13;
 &#13;
using System.Collections; &#13;
 &#13;
public class GameMaster : MonoBehaviour &#13;
{ &#13;
  public static GameMaster instance; &#13;
 &#13;
  // let's have a reference to the player character &#13;
  // and start position of player character &#13;
  public GameObject PC; &#13;
  public GameObject START_POSITION; &#13;
 &#13;
  public GameObject CHARACTER_CUSTOMIZATION; &#13;
 &#13;
  public LevelController LEVEL_CONTROLLER; &#13;
  public AudioController AUDIO_CONTROLLER; &#13;
 &#13;
  // Ref to UI Elements ... &#13;
  public bool DISPLAY_SETTINGS = false; &#13;
  public UIController UI; &#13;
 &#13;
  void Awake() &#13;
  { &#13;
    // simple singleton &#13;
    if (instance == null) &#13;
    { &#13;
      instance = this; &#13;
 &#13;
      // initialize Level Controller &#13;
      instance.LEVEL_CONTROLLER = new LevelController(); &#13;
 &#13;
      // initialize Audio Controller &#13;
      instance.AUDIO_CONTROLLER = new AudioController(); &#13;
      instance.AUDIO_CONTROLLER.AUDIO_SOURCE = GameMaster.instance.GetComponent&lt;AudioSource&gt;(); &#13;
      instance.AUDIO_CONTROLLER.SetDefaultVolume(); &#13;
    } &#13;
    else if (instance != this) &#13;
    { &#13;
      Destroy(this); &#13;
    } &#13;
 &#13;
    // keep the game object when moving from &#13;
    // one scene to the next scene &#13;
    DontDestroyOnLoad(this); &#13;
  } &#13;
 &#13;
  // for each level/scene that has been loaded &#13;
  // do some of the preparation work &#13;
  void OnLevelWasLoaded() &#13;
  { &#13;
    GameMaster.instance.LEVEL_CONTROLLER.OnLevelWasLoaded(); &#13;
  } &#13;
 &#13;
  // Use this for initialization &#13;
  void Start() &#13;
  { &#13;
    // let's find a reference to the UI controller of the loaded scene &#13;
    if (GameObject.FindGameObjectWithTag("UI") != null) &#13;
    { &#13;
      GameMaster.instance.UI = GameObject.FindGameObjectWithTag("UI").GetComponent&lt;UIController&gt;(); &#13;
    } &#13;
 &#13;
    GameMaster.instance.UI.SettingsCanvas.gameObject.SetActive(GameMaster.instance.DISPLAY_SETTINGS); &#13;
  } &#13;
 &#13;
  // Update is called once per frame &#13;
  void Update() &#13;
  { &#13;
 &#13;
  } &#13;
 &#13;
  public void MasterVolume(float volume) &#13;
  { &#13;
    GameMaster.instance.AUDIO_CONTROLLER.MasterVolume(volume); &#13;
  } &#13;
 &#13;
  public void StartGame() &#13;
  { &#13;
    GameMaster.instance.LoadLevel(); &#13;
  } &#13;
 &#13;
  public void LoadLevel() &#13;
  { &#13;
    GameMaster.instance.LEVEL_CONTROLLER.LoadLevel(); &#13;
  } &#13;
} &#13;
</pre><p>As you can see, the code is easier to read and also it is better structured. The <code class="literal">GameMaster </code>is using the controllers for performing each specific task. This also makes it easier to maintain code for different tasks within our game. For instance, all of the audio-related code can be now implemented in the controller and so on.</p></div></div>