<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec21"></a>Using Vector geometry and physics</h2></div></div><hr /></div><p>If you are anything like me, you <a id="id90" class="indexterm"></a>found the title of this section intimidating. However, before <a id="id91" class="indexterm"></a>you decide to skip it or start looking for a new book about Unity, I assure you that it will not expose you to a single mathematical formula. Instead, it will use the Playmaker actions and explain what each of them does, which, in turn, will lead us to a conclusion about the science behind it.</p><p>Practically no 3D video game is possible without vector geometry and physics of some kind, and naturally both are instrumental in explaining how the mallet-puck interaction works in your new air hockey game.</p><p>To begin, let us select the <span class="strong"><strong>Push Puck</strong></span> state in the Mallet FSM by clicking on it in the FSM view of the <span class="strong"><strong>playMaker</strong></span> panel and open the <span class="strong"><strong>Variables</strong></span> tab on the right. There are three variables of type <span class="strong"><strong>Vector3</strong></span> and one of type <span class="strong"><strong>Float</strong></span> in the list. The following variables are of interest to us, since they are used for the calculation of push force and direction:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>hitPos</strong></span> is a <span class="strong"><strong>Vector3</strong></span> variable in which we store the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> coordinates of the collision point between the mallet and the puck</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>pushDir</strong></span> is a <span class="strong"><strong>Vector3</strong></span> variable we store the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> direction in which the puck is going to be pushed when it collides with the mallet</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>pushMag</strong></span> is a <span class="strong"><strong>Float</strong></span> variable that is currently equal to 20 and corresponds to the magnitude of the push</p></li></ul></div><p>To understand how things work in video games, you will have to be comfortable using <span class="strong"><strong>Vector3</strong></span> variables, because much of everything you will do is going to happen in 3D space. Each <span class="strong"><strong>Transform</strong></span> component has three <span class="strong"><strong>Vector3</strong></span> properties: <span class="strong"><strong>Position</strong></span>, <span class="strong"><strong>Rotation</strong></span>, and <span class="strong"><strong>Scale</strong></span>, each of which has its own <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> values.</p><p>Each point in 3D space has coordinates that can be written down in the form of three <span class="strong"><strong>Float</strong></span> variables: a position on the X axis, a position on the Y axis, and a position on the Z axis. A <span class="strong"><strong>Vector3</strong></span> variable can store these three position values at the same time.</p><p>You can <a id="id92" class="indexterm"></a>perform various actions over <span class="strong"><strong>Vector3</strong></span>, you can add it to another vector, you can <a id="id93" class="indexterm"></a>multiply it by a float (or an integer), you can store its <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> in separate <span class="strong"><strong>Float</strong></span> variables or write separate float values into its <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span>. Most of these actions are under the <span class="strong"><strong>Vector3</strong></span> category of the <span class="strong"><strong>Actions</strong></span> panel.</p><p>The first action that we use is called <span class="strong"><strong>Get Controller Hit Info</strong></span>, and it gets the position of the last collision that happened to a game object. If you look at the <span class="strong"><strong>Collision Event</strong></span> action in the <span class="strong"><strong>Move</strong></span> state that triggers the <span class="strong"><strong>Push</strong></span> event, you will see that this only happens when the mallet collides with the puck, so we do not have to worry about weeding out false collisions once we are already in the <span class="strong"><strong>Push Puck</strong></span> state. All we have to do is save the contact point in a variable, which is exactly what happens.</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_01.jpg" /></div><p>Next, we simply get the current position of the mallet and store it in the <span class="strong"><strong>pushDir</strong></span> variable, for the time being using the <span class="strong"><strong>GetPosition</strong></span> action. This variable is called <span class="strong"><strong>pushDir</strong></span>, because later it will contain the direction in which the mallet will be pushed. We get this position simply by accessing the <span class="strong"><strong>Position</strong></span> property of the mallet's <span class="strong"><strong>Transform</strong></span> component.</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_02.jpg" /></div><p>If these are all <a id="id94" class="indexterm"></a>positions, how do you get a direction? What is a direction and<a id="id95" class="indexterm"></a> how can you write it down in <span class="strong"><strong>Vector3</strong></span>? The answer is quite simple. A direction is the relative position of one point with respect to another point in space, which is another way of saying that it is the difference between <span class="strong"><strong>Position A</strong></span> and <span class="strong"><strong>Position B</strong></span>. The following figure shows two points and their relative directions.</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_03.jpg" /></div><p>So, in order to find the direction in which point B lies in relation to point A, you will have to subtract the position of point B from the position of point A. Then you need to normalize the result, which means writing it down as a <span class="strong"><strong>Vector3</strong></span> variable that has its <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> properties as numbers between <code class="literal">0</code> and <code class="literal">1</code> (that is, without a magnitude).</p><p>For example, if the original result of subtraction was (<code class="literal">-1</code>, <code class="literal">27</code>, <code class="literal">350</code>), the normalized vector of direction will be (<code class="literal">-0.00284867</code>, <code class="literal">0.076914</code>, <code class="literal">0.997034</code>), and the best part of it is that you do not need to know how this happens, because there is a Playmaker action that does it automatically for you. The following screenshot shows the two actions that are used to get the direction from the center of the mallet to the hit point:</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_04.jpg" /></div><p>Let us go through the <a id="id96" class="indexterm"></a>things we have covered so far:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>We need the <a id="id97" class="indexterm"></a>position of the mallet, because this is where we are going to push the puck from</p></li><li style="list-style-type: disc"><p>We need the point of the impact between the mallet and the puck in order to find where the puck lies in space in relation to the mallet when the mallet hits it</p></li><li style="list-style-type: disc"><p>Both of these values are saved as <span class="strong"><strong>Vector3</strong></span> variables, each of which contains an <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> position</p></li><li style="list-style-type: disc"><p>We can find out in which direction the puck lies in relation to the mallet by subtracting the position of the impact from the position of the mallet and normalizing the resulting vector, that is, writing down its <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> properties as numbers between <code class="literal">0</code> and <code class="literal">1</code></p></li></ul></div><p>Now that we know how to find the direction in which the puck lies in relation to the mallet, we want to push it in that direction, so this is exactly what we are going to do. However, we cannot just assign the direction vector as the puck's velocity, because the direction vector does not have a magnitude, which means that the velocity of the puck will be way smaller than we want it to be.</p><p>In order to control the force with which the puck is being pushed, we have to multiply the direction by a magnitude, which is stored in the <span class="strong"><strong>pushMag</strong></span> variable. This variable determines how fast the puck will move in the opposite direction once it meets the mallet.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip13"></a>Tip</h3><p>If you assign <span class="strong"><strong>pushMag</strong></span> a negative value, the puck will be pushed towards the mallet every time it collides with it, which, in turn, means that it will stick to it. This too can be a useful game mechanic, albeit not in this case.</p></div><p>The following screenshot shows the <span class="strong"><strong>Vector3 Multiply</strong></span> action that multiplies the <span class="strong"><strong>pushDir</strong></span> direction vector by <span class="strong"><strong>pushMag</strong></span> magnitude as well as the <span class="strong"><strong>Add Force</strong></span> action that applies the force to the puck at the impact point.</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_05.jpg" /></div></div>