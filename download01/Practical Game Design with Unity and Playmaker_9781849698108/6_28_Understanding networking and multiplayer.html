<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec30"></a>Understanding networking and multiplayer</h2></div></div><hr /></div><p>Explaining things like TCP/IP and <a id="id144" class="indexterm"></a>other low-level networking concepts<a id="id145" class="indexterm"></a> is beyond the scope of this book, and we are going to try and keep everything as close to practical application as possible. On the other hand, it will be much easier for you to build multiplayer if you are familiar with at least some theory.</p><p>The first thing that you need to know is what servers and clients are. In simple terms, a server<a id="id146" class="indexterm"></a> is a computer that responds to network requests from other computers, or more precisely, a system that responds to network requests from other systems, because you may have multiple servers and multiple clients on the same computer. This means that clients communicate with each other through a server. Typically, player systems are clients in multiplayer games, while servers are on computers that are accessed remotely. Sometimes, a player can <span class="emphasis"><em>host</em></span> a game, in which case the player either acts as a server or simply tells the server to reserve its resources for the game.</p><p>You may have heard about network architectures before. In games, the most popular architectures are arguably client-server and peer-to-peer. The former means that all the clients subscribe to a single server. The server hosts most of the important information about the game and distributes it between the players. The latter is about peers (players) connecting to one another directly, so all the clients are connected to each other, and the network workload is distributed evenly.</p><p>The advantage of client-server<a id="id147" class="indexterm"></a> is that it allows creating a more stable system that ensures that cheating is either impossible or very hard, as well as makes it easier for the developer to monitor everything and make changes to the game on the fly. This method, however, is generally expensive and relatively hard to implement yourself if you are just a solo developer who is learning to make his/her first multiplayer game.</p><p>Peer-to-peer<a id="id148" class="indexterm"></a> does not require having a powerful server hosting multiple game sessions at the same time, allowing players to connect to each other, distributing the network workload between them. The drawback of peer-to-peer is that it tends to be less stable, and it is relatively hard to monitor. On top of that, you still need a server if you want to keep track of game sessions, perform matchmaking, and let your players play on the Internet instead of just a local network.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip23"></a>Tip</h3><p>It is hard to connect to the Internet without having a server, because of something <a id="id149" class="indexterm"></a>called <span class="strong"><strong>Native Address Translation</strong></span> (<span class="strong"><strong>NAT</strong></span>). Without getting into much detail, it should be noted that it is something that network routers do, and most of us have routers these days. A process commonly called <span class="strong"><strong>NAT punchthrough</strong></span><a id="id150" class="indexterm"></a> is used in order to connect one computer to another, and this process requires a server acting as a mediator for the first connection between two computers.</p></div><p>In Unity, it is relatively easy to set up a <span class="strong"><strong>Local Area Network</strong></span> (<span class="strong"><strong>LAN</strong></span>)<a id="id151" class="indexterm"></a>, peer-to-peer<a id="id152" class="indexterm"></a> connection, or client-server connection with one of the players hosting the game without using any external plugins. A LAN connection means that all the players are connected to the same local computer network. Unfortunately, whatever you do, you will need a server to make sure that players can always connect to each other over the Internet, which is what we want to do. Photon takes client-server and wraps it in an extremely easy to use interface that allows anyone to create multiplayer games without any prior experience. On top of that, it is very affordable for what it is.</p><p>Some of the Photon services allow players to host their own servers, but those take some time to set up. What we are going to use in this book is Photon Cloud. As the name implies, all the game sessions happen in the cloud, thus on remote Photon servers. All you need to do is synchronize your game's data through them and make sure that players can find each other. You do not need to set up a server, and you do not have to worry about the problems involved in making peer-to-peer multiplayer.</p><p>The way the synchronization works is that there is something called <span class="strong"><strong>Network View</strong></span><a id="id153" class="indexterm"></a> (<span class="strong"><strong>Photon View</strong></span> in Photon), which is a component that makes one or more game object's properties synchronized over the network. When such a property changes in one client, it changes in all the clients, with the server keeping track of everything and sending commands to clients. For example, mallet's position can be such a property. This way, when player 1 moves their mallet, player 2 sees them move it and vice versa. The same goes for almost any other property.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip24"></a>Tip</h3><p>As we will show in this chapter's example, synchronizing positions can be okay for player objects (such as mallets in air hockey or characters in first person shooters), but objects that have physical behaviors (such as the puck), can experience serious network delays on remote computers. There is currently no easy solution for this problem apart from using Unity native networking.</p></div><p>There are objects that <a id="id154" class="indexterm"></a>can belong to the scene (like the walls and the background) and so are exactly the same and unchangeable throughout all clients, and then there are objects that belong to different clients, such as the mallets. Generally, you want to synchronize as little data over the network as possible in order to avoid high response times. Scene objects do not have to get synchronized since they do not change. Moreover, this way each player's mallet responds only to that player's input, which makes perfect sense gameplay-wise.</p><p>You are now ready to start setting up Photon. All this theory may sound complicated, but it really comes down to synchronizing variables over the network using a special Photon component called Photon View.</p></div>