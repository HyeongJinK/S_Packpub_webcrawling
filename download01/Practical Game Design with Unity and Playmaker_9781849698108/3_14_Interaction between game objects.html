<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec19"></a>Interaction between game objects</h2></div></div><hr /></div><p>Now that the mallet moves, we are <a id="id87" class="indexterm"></a>going to make it interact with a puck. When the mallet touches the puck, we are going to apply a force to it in the opposite direction.</p><p>You can click the Play button in the toolbar and see how the mallet moves based on the mouse position. You will notice that it collides with the walls, follows the mouse cursor smoothly, and changes its movement speed based on how fast and far you move your mouse.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create another cylinder called <span class="strong"><strong>Puck</strong></span> and place it in (<code class="literal">-3</code>, <code class="literal">0.85</code>, <code class="literal">0</code>). Set its scale to (<code class="literal">1</code>, <code class="literal">0.7</code>, <code class="literal">1</code>).</p></li><li><p>Add a <span class="strong"><strong>Rigidbody</strong></span> component to it (<span class="strong"><strong>Component | Physics | Rigidbody</strong></span>). Set the <span class="strong"><strong>Mass</strong></span> property to <code class="literal">0.1</code>, uncheck <span class="strong"><strong>Use Gravity</strong></span>, open the <span class="strong"><strong>Constraints</strong></span> section, and check <span class="strong"><strong>Freeze Position Y</strong></span> and <span class="strong"><strong>Freeze Rotation X</strong></span>, <span class="strong"><strong>Y</strong></span> and <span class="strong"><strong>Z</strong></span>.</p></li><li><p>Make a new dark grey (<code class="literal">65</code>, <code class="literal">60</code>, <code class="literal">60</code>) material (<span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Material</strong></span>) called <span class="strong"><strong>PuckMaterial</strong></span> and assign it to the puck's <span class="strong"><strong>Mesh Renderer</strong></span>.</p></li><li><p>Now that the puck is all set, we will make the mallet push it. Go to the mallet's <span class="strong"><strong>Move</strong></span> state in FSM and add an action called <span class="strong"><strong>Collision Event</strong></span> (under Physics) to it. Set the <span class="strong"><strong>Collision</strong></span> property to <span class="strong"><strong>On Controller Collider Hit</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_03_10.jpg" /></div></li><li><p>Open <span class="strong"><strong>TagManager</strong></span> by selecting the <span class="strong"><strong>Puck</strong></span> game object and choosing <span class="strong"><strong>Add Tag...</strong></span> from the <span class="strong"><strong>Tag</strong></span> drop-down menu in <span class="strong"><strong>Inspector</strong></span>. Create a tag called <span class="strong"><strong>Puck</strong></span> by adding a new tag the same way you did with a layer for the background. Tags are situated near the top of <span class="strong"><strong>TagManager</strong></span>. You can have as many as you want if you modify the <span class="strong"><strong>Size</strong></span> variable. Set the <span class="strong"><strong>Puck</strong></span> game object's tag to <span class="strong"><strong>Puck</strong></span>.</p></li><li><p>Go back to the <span class="strong"><strong>Move</strong></span> state in Mallet's FSM. Set the <span class="strong"><strong>Collide Tag</strong></span> property of the <span class="strong"><strong>Collision Event</strong></span> action to <span class="strong"><strong>Puck</strong></span>.</p></li><li><p>Open the <span class="strong"><strong>Events</strong></span> tab in the <span class="strong"><strong>playMaker</strong></span> panel, enter <code class="literal">Push</code> in the <span class="strong"><strong>Add Event</strong></span> field near the bottom of the tab, and press <span class="emphasis"><em>Return</em></span> on your keyboard.</p></li><li><p>Open the <span class="strong"><strong>State</strong></span> tab again and set the <span class="strong"><strong>Send Event</strong></span> property of the <span class="strong"><strong>Collision Event</strong></span> action to <span class="strong"><strong>Push</strong></span>.</p></li><li><p>Now we have to tell the FSM what will happen once the event is called. Create a new state in the Mallet's FSM by right-clicking anywhere in the FSM view and selecting <span class="strong"><strong>Add State</strong></span> from the context menu. Name the new state <code class="literal">Push Puck</code>. Right-click on the <span class="strong"><strong>Move</strong></span> state in the FSM view and select <span class="strong"><strong>Add Transition</strong></span> | <span class="strong"><strong>Push</strong></span> from the contextual menu. A new light label saying <span class="strong"><strong>Push</strong></span> should appear below the <span class="strong"><strong>Move</strong></span> state. Click on it and drag the line that appears to the <span class="strong"><strong>Push Puck</strong></span> state. This line is the transition that will happen once the <span class="strong"><strong>Push</strong></span> event is called in the <span class="strong"><strong>Move</strong></span> state. Add a <span class="strong"><strong>FINISHED</strong></span> event to the <span class="strong"><strong>Push Puck</strong></span> state the same way. You do not need to create it, because it is a default Playmaker event.</p></li><li><p>Make a transition from the <a id="id88" class="indexterm"></a>
<span class="strong"><strong>FINISHED</strong></span> event to the <span class="strong"><strong>Move</strong></span> state to make sure that when the puck is pushed the mallet will remain under the player's control. The following figure shows what your FSM is supposed to look like:</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_03_11.jpg" /></div></li><li><p>Add the following actions to the <span class="strong"><strong>Push Puck</strong></span> state in Mallet's FSM one-by-one: <span class="strong"><strong>Get Controller Hit Info</strong></span>, <span class="strong"><strong>Get Position</strong></span>, <span class="strong"><strong>Vector3 Subtract</strong></span>, <span class="strong"><strong>Vector3 Normalize</strong></span>, <span class="strong"><strong>Vector3 Multiply</strong></span>, and <span class="strong"><strong>Add Force</strong></span>. Keep in mind that the order of the actions matters, because the ones higher on the list will get executed earlier. The following screenshot shows the correct order of the actions.</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_03_13.jpg" /></div></li><li><p>Create the following variables using the <span class="strong"><strong>Variables</strong></span> tab of the <span class="strong"><strong>playMaker</strong></span> panel: <span class="strong"><strong>hitPos</strong></span> (<span class="strong"><strong>Vector3</strong></span>), <span class="strong"><strong>pushDir</strong></span> (<span class="strong"><strong>Vector3</strong></span>), <span class="strong"><strong>pushMag</strong></span> (<span class="strong"><strong>Float</strong></span>). Select <span class="strong"><strong>pushMag</strong></span> and set its <span class="strong"><strong>Float Value</strong></span> to <code class="literal">20</code>. This value will determine how hard the mallet pushes the puck.</p></li><li><p>Back in the <span class="strong"><strong>State</strong></span> tab, set the <span class="strong"><strong>Contact Point</strong></span> property of <span class="strong"><strong>Get Controller Hit Info</strong></span> action to <span class="strong"><strong>hitPos</strong></span>.</p></li><li><p>Drag the <span class="strong"><strong>Puck</strong></span> game object from <span class="strong"><strong>Hierarchy</strong></span> to the <span class="strong"><strong>Game Object</strong></span> slot of the <span class="strong"><strong>Get Position</strong></span> action, then set <span class="strong"><strong>Vector</strong></span> to <span class="strong"><strong>pushDir</strong></span>.</p></li><li>
In <span class="strong"><strong>Vector3 Subtract</strong></span> action, set <span class="strong"><strong>Vector3 Variable</strong></span> to <code class="literal">pushDir</code>. Click on the small option (<span class="inlinemediaobject"><img src="/graphics/9781849698108/graphics/8108OT_03_12.jpg" /></span>) icon next to <span class="strong"><strong>Subtract Vector</strong></span>. This will allow you to pick a variable from the list instead of using a numeric value. Set <span class="strong"><strong>Subtract Vector</strong></span> to <code class="literal">hitPos</code>.
</li><li><p>In <span class="strong"><strong>Vector3 Normalize</strong></span> action, set <span class="strong"><strong>Vector3 Variable</strong></span> to <span class="strong"><strong>pushDir</strong></span>.</p></li><li><p>In <span class="strong"><strong>Vector3 Multiply</strong></span> action, set <span class="strong"><strong>Vector3 Variable</strong></span> to <span class="strong"><strong>pushDir</strong></span> and <span class="strong"><strong>Multiply By</strong></span> to <span class="strong"><strong>pushMag</strong></span>. Click on the small option icon to show the FSM variables if needed.</p></li><li><p>Finally, in <span class="strong"><strong>Add Force</strong></span>, set the <span class="strong"><strong>Game Object</strong></span> property to <span class="strong"><strong>Specify Game Object</strong></span> and drag the <span class="strong"><strong>Puck</strong></span> game object into the slot that will appear below. Set <span class="strong"><strong>Vector</strong></span> to <span class="strong"><strong>pushDir</strong></span>. Click on the option icons next to <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> and leave them at <span class="strong"><strong>None</strong></span> to make sure they are not reset to <code class="literal">0</code> and are simply not assigned instead. Click the small option icon to show the <span class="strong"><strong>None</strong></span> option if needed. Then set <span class="strong"><strong>Space</strong></span> to <span class="strong"><strong>World</strong></span>.</p></li></ol></div><p>Your puck should now<a id="id89" class="indexterm"></a> become interactive if you click on play and make the Mallet collide with it. I realize that the last bit was a lot of actions at once, so we will discuss what exactly happens in those actions in the next chapter. This is an example of some complex logic that we will look into when we talk more about game mechanics. For now consider it an exercise to familiarize yourself with actions and variables and the way they are added and assigned in the <span class="strong"><strong>playMaker</strong></span> panel.</p><p>As another exercise, save your scene, create a few new game objects with FSMs, and try to experiment with different actions and variables, see how they are added and assigned. Don't worry if your actions do not do much. Try to familiarize yourself with the Playmaker interface and remember how to add, move, and remove actions, create new variables and events, and assign them.</p><p>Once you feel like you are comfortable with these actions, you can delete the objects you used for practice or simply reload the scene without saving it by double-clicking the <code class="literal">Scene1</code> file in the <span class="strong"><strong>Project</strong></span> panel.</p></div>