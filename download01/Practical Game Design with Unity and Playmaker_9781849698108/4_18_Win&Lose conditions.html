<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec22"></a>Win/Lose conditions</h2></div></div><hr /></div><p>While there are games where <a id="id98" class="indexterm"></a>win/lose conditions are not necessary, air hockey is definitely not one of them. In classic air hockey, there are two goal slots on the opposite sides of the table. If the puck gets into the goal of player 1, then player 2 gets a point and vice versa. The game ends when one of the players has 7 points.</p><p>There is the short-term win condition (score once) and the long-term win condition (score seven times before your opponent does). We will only implement the short-term win condition, although you are highly encouraged to try and implement the long-term one once you are done with this chapter.</p><p>Before we start implementing the win/lose conditions, let us make sure that the puck cannot get stuck in the corner, because this kind of behavior will prevent the win/lose condition from being triggered. Make four new walls, rotate them 45 degrees on the Y axis, and place them in the corners so as to get rid of the straight angles there, as shown in the next figure. This should solve the problem.</p><p>Now that this is taken care <a id="id99" class="indexterm"></a>of, let us make the goal slots. Change the puck's <span class="strong"><strong>Scale</strong></span> property to (<code class="literal">1</code>, <code class="literal">0.7</code>, <code class="literal">1</code>) and place it in (<code class="literal">-3</code>, <code class="literal">0.3</code>, <code class="literal">0</code>).</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Make one more wall on the left and one more wall on the right. The walls should be placed as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_06.jpg" /></div></li><li><p>Make two new cubes (<span class="strong"><strong>GoalLeft</strong></span> and <span class="strong"><strong>GoalRight</strong></span>) and place them in the gaps on the left and on the right, as shown in the next figure. Make the cube on the left green (<code class="literal">0</code>, <code class="literal">255</code>, <code class="literal">0</code>) and the cube on the right red (<code class="literal">255</code>, <code class="literal">0</code>, <code class="literal">0</code>) by making new materials for them. Both of them should be in <code class="literal">2.5</code> on the Y axis. These are there to block the mallet, but not the puck.</p></li><li><p>Make two more cubes. Call them <code class="literal">GoalTriggerLeft</code> and <code class="literal">GoalTriggerRight</code>. Place them just behind the game field on either side of the table. These objects will act as triggers to detect which goal the puck has scored. Check the <span class="strong"><strong>Is Trigger</strong></span> property of these game objects' <span class="strong"><strong>Box Collider</strong></span> component. This property of the collider component makes sure that the object does not do any physics collisions (as opposed to the puck or the walls), but instead acts as a trigger, detecting when rigidbodies enter, stay inside, and exit it. These objects are the actual goals that will trigger the win/lose conditions.</p></li><li><p>Your <span class="strong"><strong>Scene</strong></span> view should look something like the following screenshot at this point:</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_07.jpg" /></div></li><li><p>Select the <a id="id100" class="indexterm"></a>
<span class="strong"><strong>GoalTriggerLeft</strong></span> game object and add an FSM to it. Make two states and rename <span class="strong"><strong>State1</strong></span> to <code class="literal">Scored</code> and <span class="strong"><strong>State2</strong></span> to <code class="literal">LoadLevel</code>.</p></li><li><p>Right-click the <span class="strong"><strong>Scored</strong></span> state and go to <span class="strong"><strong>Add Transition</strong></span> | <span class="strong"><strong>System Events</strong></span> | <span class="strong"><strong>TRIGGER ENTER</strong></span> from the contextual menu.</p></li><li><p>Make a transition from <span class="strong"><strong>TRIGGER ENTER </strong></span>to <span class="strong"><strong>LoadLevel</strong></span>. When something enters the trigger (and it should only be the puck, because of the way things are placed in the scene), this event will get called, and the transition will be made.</p></li><li><p>Select the <span class="strong"><strong>LoadLevel</strong></span> state and add a <span class="strong"><strong>Load Level</strong></span> action to it. It should be located under the <span class="strong"><strong>Level</strong></span> category.</p></li><li><p>In the <span class="strong"><strong>Level Name</strong></span> property of the <span class="strong"><strong>Load Level</strong></span> action, type the name of your game scene. It should be called <code class="literal">Scene1</code> if you haven't changed anything. To make sure, look at the top of the <span class="strong"><strong>Unity Editor</strong></span> window. It always says <code class="literal">[SceneName].unity - [ProjectName] - [Platform]</code>, where the things in the brackets are <span class="strong"><strong>Scene1</strong></span>, <span class="strong"><strong>UPMTutorial</strong></span>, and <span class="strong"><strong>Web Player</strong></span> for me, but can differ for you.</p></li><li><p>Do the same thing for <span class="strong"><strong>GoalTriggerRight</strong></span>. For now, keep the FSM exactly the same.</p></li></ol></div><p>Now, we can add some finishing touches to our scene by importing a 3D model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Make sure <a id="id101" class="indexterm"></a>that you have downloaded the project archive from the Packt Publishing website. If you haven't, do it now and unpack the archive.</p></li><li><p>Right-click in the empty space under the file list in the <span class="strong"><strong>Project</strong></span> panel and select <span class="strong"><strong>Import New Asset...</strong></span> from the contextual menu. A file browser should pop up.</p></li><li><p>Locate the <code class="literal">WallVisual.fbx</code> file in the <code class="literal">UnityPlaymakerTutorial</code> directory and click on <span class="strong"><strong>Import</strong></span>. The file browser will close and a <code class="literal">WallVisual</code> file will appear in the <span class="strong"><strong>Project</strong></span> panel. Create a <code class="literal">Models</code> folder and drag it there.</p></li><li><p>Select the <code class="literal">WallVisual</code> file and have a look at <span class="strong"><strong>Inspector</strong></span>. There are three tabs in this <span class="strong"><strong>Inspector</strong></span>: <span class="strong"><strong>Model</strong></span>, <span class="strong"><strong>Rig</strong></span>, and <span class="strong"><strong>Animations</strong></span>. These are all responsible for changing import settings of your model.</p></li><li><p>Since the model that we have imported is not an animated one, only the <span class="strong"><strong>Model</strong></span> tab is of interest to us. Set <span class="strong"><strong>Scale Factor</strong></span> to <code class="literal">1.05</code> and uncheck <span class="strong"><strong>Import Materials</strong></span>. Leave the rest of the properties at their default values. <span class="strong"><strong>Scale Factor</strong></span> changes the scale of the model on import, meaning that the <span class="strong"><strong>Transform Scale</strong></span> property will be equal to (<code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">1</code>) while the actual size in 3D space may change. This is needed because the working scale in the 3D modeling software (such as Maya or 3DS Max) may differ from that in Unity. To make the model appear bigger, increase the scale factor. See the following screenshot to confirm that your import settings are set correctly:</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_15.jpg" /></div></li><li><p>Drag <a id="id102" class="indexterm"></a>
<span class="strong"><strong>WallVisual</strong></span> into <span class="strong"><strong>Hierarchy</strong></span> twice. Position the first instance in (<code class="literal">0</code>, <code class="literal">0.5</code>, <code class="literal">-3.5</code>) and the second one in (<code class="literal">0</code>, <code class="literal">0.5</code>, <code class="literal">3.5</code>). Set the first one's <span class="strong"><strong>Rotation</strong></span> to (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>) and the second one's to (<code class="literal">0</code>, <code class="literal">180</code>, <code class="literal">0</code>).</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip14"></a>Tip</h3><p>The difference between a prefab and an imported model is that you cannot apply the changes that you made to one of the instances. You also cannot add or remove any components from the model. You can make a prefab from one of the instances of the model to be able to do that.</p></div></li><li><p>Set the material of both <span class="strong"><strong>WallVisual</strong></span> game objects to <span class="strong"><strong>WallMaterial</strong></span> that you created previously to be used on walls. Select all of the <span class="strong"><strong>Wall</strong></span> objects and deactivate their <span class="strong"><strong>Mesh Renderer</strong></span> components. The following figure shows what you should see in the <span class="strong"><strong>Game</strong></span> view if you did everything right:</p><div class="mediaobject"><img src="/graphics/9781849698108/graphics/8108OT_04_16.jpg" /></div></li></ol></div><p>Now, when<a id="id103" class="indexterm"></a> you hit play, you should be able to score in both goals. Doing so will reload the currently loaded level. We also made sure that the puck does not get stuck in the corners of the table and imported a model that covers our cubic walls and makes the game look more like an actual air hockey table. This means that the game is finally playable, if, admittedly, not very fun yet.</p></div>