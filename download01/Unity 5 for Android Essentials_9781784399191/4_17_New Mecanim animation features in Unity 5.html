<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec20"></a>New Mecanim animation features in Unity 5</h2></div></div><hr /></div><p>Unity 5 contains some new awesome<a id="id227" class="indexterm"></a> possibilities for the Mecanim animation <a id="id228" class="indexterm"></a>system. Let's look at the new shiny features known in Unity 5.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec49"></a>State machine behavior</h3></div></div></div><p>Now, you can inherit<a id="id229" class="indexterm"></a> your classes from <code class="literal">StateMachineBehaviour</code> in <a id="id230" class="indexterm"></a>order to be able to attach them to your Mecanim animation states. This class has the following very important callbacks:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">OnStateEnter</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnStateUpdate</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnStateExit</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnStateMove</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">OnStateIK</code>
</p></li></ul></div><p>The<code class="literal"> StateMachineBehaviour</code> scripts behave like <code class="literal">MonoBehaviour</code> scripts, which you can attach on as many objects as you wish; the same is true for <code class="literal">StateMachineBehaviour</code>. You can use<a id="id231" class="indexterm"></a> this solution with or without any <a id="id232" class="indexterm"></a>animation at all.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec50"></a>State machine transition</h3></div></div></div><p>Unity 5 introduced a new <a id="id233" class="indexterm"></a>awesome feature for Mecanim animation systems known as <a id="id234" class="indexterm"></a>state machine transitions in order to construct a higher abstraction level. In addition, entry and exit nodes were created. By these two additional nodes to <code class="literal">StateMachine</code>, you can now branch your start or finish state depending on your special conditions and requirements.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>These mixes of transitions are possible: <code class="literal">StateMachine</code> | <code class="literal">StateMachine</code>, <code class="literal">State</code> | <code class="literal">StateMachine</code>, <code class="literal">State</code> | <code class="literal">State</code>.</p></div><p>In addition, you also can reorder your layers or parameters. This is the new UI that allows it by a very simple and useful drag-n-drop method.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec51"></a>Asset creation API</h3></div></div></div><p>One more awesome <a id="id235" class="indexterm"></a>possibility in Unity 5 was introduced <a id="id236" class="indexterm"></a>using scripts in Unity Editor in order to programmatically create assets, such as layers, controllers, states, <code class="literal">StateMachine</code>, and blend trees. You can use different solutions with a high-level API provided by Unity engine maintenance and a low-level API, where you should manage all your assets manually. You can find more about both API versions on Unity documentation pages.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec52"></a>Direct blend tree</h3></div></div></div><p>Another new <a id="id237" class="indexterm"></a>feature that was introduced with the <a id="id238" class="indexterm"></a>new <code class="literal">BlendTree</code> type is known as direct. It provides direct mapping and animator parameters to the weight of <code class="literal">BlendTree</code> children.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note09"></a>Note</h3><p>Possibilities with Unity 5 have been enhanced with two useful features for Mecanim animation system:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Camera can scale, orbit, and pan</p></li><li style="list-style-type: disc"><p>You can access your parameters in runtime</p></li></ul></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec53"></a>Programmatically creating assets by Unity 5 API</h3></div></div></div><p>The following<a id="id239" class="indexterm"></a> code snippets are <a id="id240" class="indexterm"></a>self-explanatory, pretty simple, and straightforward. I list them just as a very useful reminder.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec15"></a>Creating the controller</h4></div></div></div><p>To create a controller you<a id="id241" class="indexterm"></a> can use the following code:</p><div class="informalexample"><pre class="programlisting">var animatorController = UnityEditor.Animations.AnimatorController.CreateAnimatorControllerAtPath ("Assets/Your/Folder/Name/state_machine_transitions.controller");</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec16"></a>Adding parameters</h4></div></div></div><p>To add parameters<a id="id242" class="indexterm"></a> to the controller, you can use this code:</p><div class="informalexample"><pre class="programlisting">animatorController.AddParameter("Parameter1", UnityEditor.Animations.AnimatorControllerParameterType.Trigger);
animatorController.AddParameter("Parameter2", UnityEditor.Animations.AnimatorControllerParameterType.Trigger);
animatorController.AddParameter("Parameter3", UnityEditor.Animations.AnimatorControllerParameterType.Trigger);</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec17"></a>Adding state machines</h4></div></div></div><p>To add <a id="id243" class="indexterm"></a>state machines, you can use the following code:</p><div class="informalexample"><pre class="programlisting">var sm1 = animatorController.layers[0].stateMachine;
var sm2 = sm1.AddStateMachine("sm2");
var sm3 = sm1.AddStateMachine("sm3");</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec18"></a>Adding states</h4></div></div></div><p>To add states, you<a id="id244" class="indexterm"></a> can use the code given here:</p><div class="informalexample"><pre class="programlisting">var s1 = sm2.AddState("s1");
var s2 = sm3.AddState("s2");
var s3 = sm3.AddState("s3");</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec19"></a>Adding transitions</h4></div></div></div><p>To add transitions, you <a id="id245" class="indexterm"></a>can use the following code:</p><div class="informalexample"><pre class="programlisting">var exitTransition = s1.AddExitTransition();
exitTransition.AddCondition(UnityEditor.Animations.AnimatorConditionMode.If, 0, "Parameter1");
exitTransition.duration = 0;

var transition1 = sm2.AddAnyStateTransition(s1);
transition.AddCondition(UnityEditor.Animations.AnimatorConditionMode.If, 0, "Parameter2");
transition.duration = 0;

var transition2 = sm3.AddEntryTransition(s2);
transition2.AddCondition(UnityEditor.Animations.AnimatorConditionMode.If, 0, "Parameter3");
sm3.AddEntryTransition(s3);
sm3.defaultState = s2;

var exitTransition = s3.AddExitTransition();
exitTransition.AddCondition(UnityEditor.Animations.AnimatorConditionMode.If, 0, "Parameter3");
exitTransition.duration = 0;

var smt = rootStateMachine.AddStateMachineTransition(sm2, sm3);
smt.AddCondition(UnityEditor.Animations.AnimatorConditionMode.If, 0, "Parameter2");
sm2.AddStateMachineTransition(sm1, sm3);</pre></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec54"></a>Going deeper into new audio features</h3></div></div></div><p>Let's start with new amazing<a id="id246" class="indexterm"></a> Audio Mixer<a id="id247" class="indexterm"></a> possibilities.</p><p>Now, you can do true submixing of audio in Unity 5.</p><p>In the following figure, you can see a very simple example with different sound categories required in a game:</p><div class="mediaobject"><img src="/graphics/9781784399191/graphics/9191OT_04_01.jpg" /></div><p>Now in Unity 5, you <a id="id248" class="indexterm"></a>can mix different sound collections<a id="id249" class="indexterm"></a> within categories and tune up volume control and effects only once in a single place so that you can save a lot of time and effort. This new awesome audio feature in Unity 5 allows you to create a fantastic mood and atmosphere for your game.</p><p>Each Audio Mixer can have a hierarchy of AudioGroups:</p><div class="mediaobject"><img src="/graphics/9781784399191/graphics/9191OT_04_02.jpg" /></div><p>The Audio Mixer can not only do a lot of useful things, but also mix different sound groups in one place. Different audio effects are applied sequentially in each AudioGroup.</p><p>Now you're getting closer to the amazing, awesome, and shiny new features in Unity 5 for audio system! A callback script <code class="literal">OnAudioFilterRead</code>, which made possible the processing of samples directly into their scripts, previously was handled exclusively by the code.</p><p>Unity now also supports custom plugins to create different effects. With these innovations, Unity 5 for audio system now has its own applications synthesizer, which has become much easier and more flexible than possible.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec55"></a>Mood transitions</h3></div></div></div><p>As mentioned earlier, the <a id="id250" class="indexterm"></a>mood of the game can be controlled with a<a id="id251" class="indexterm"></a> mix of sound. This can be achieved with the involvement of new stems and music or ambient sounds. Another common way to accomplish this is to move the state of the mixture. A very effective way of taking mood where you want to go is by changing the volume section's mixture and transferring it to the different states of effect parameters.</p><p>Inside, everything is the Audio Mixer's ability to identify pictures. Pictures capture the status of all parameters in Audio Mixer. Everything from investigative wet levels to AudioGroup tone levels can be captured and moved between the various parameters.</p><div class="mediaobject"><img src="/graphics/9781784399191/graphics/9191OT_04_03.jpg" /></div><p>You can even create a complex mixture of states between a whole bunch of pictures in your game, creating all kinds of possibilities and goals.</p><p>Imagine installing all these things without having to write a line of code to the script.</p></div></div>