<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec70"></a>Waiting for audio to finish before auto-destructing an object</h2></div></div><hr /></div><p>An event may occur <a id="id469" class="indexterm"></a>(such as an object pickup, or the killing of an enemy) that we wish to notify to the player by playing an audio clip and an associated visual object (such as an explosion particle system, or a temporary object in the location of the event). However, as soon as the clip has finished playing, we want the visual object to be removed from the scene. This recipe provides a simple way to link the ending of an audio clip that's playing with the automatic destruction of its parent <code class="literal">GameObject</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec241"></a>Getting ready</h3></div></div></div><p>Try this with any audio clip that is one second or longer in duration.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec242"></a>How to do it...</h3></div></div></div><p>To wait for the audio to<a id="id470" class="indexterm"></a> finish before destroying an object, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create an empty game object named <code class="literal">AudioObject</code>, and add an audio source component to this object.</p></li><li><p>Drag an audio clip file from the <span class="strong"><strong>Project</strong></span> view to populate the <span class="strong"><strong>AudioClip</strong></span> parameter of the <span class="strong"><strong>AudioSource</strong></span> component of <span class="strong"><strong>AudioObject</strong></span>, and deselect the component's <span class="strong"><strong>Play On Awake</strong></span> checkbox.</p></li><li><p>Add the following script class to <span class="strong"><strong>AudioObject</strong></span>:</p><div class="informalexample"><pre class="programlisting">// file: AudioDestructBehaviour.cs
using UnityEngine;
using System.Collections;

public class AudioDestructBehaviour : MonoBehaviour {
  private void Update()
  {
    if( !audio.isPlaying ) 
      Destroy(gameObject);
  }
}</pre></div></li><li><p>Add the following script class to the <span class="strong"><strong>Main Camera</strong></span>:</p><div class="informalexample"><pre class="programlisting">// file: PlayDestroyButtonGUI.cs
using UnityEngine;
using System.Collections;

public class PlayDestroyButtonGUI : MonoBehaviour{
 public AudioDestructBehaviour myAudioDestructObect;
 
 private void OnGUI(){
  bool playButtonWasClicked = GUILayout.Button("play");
  bool destroyButtonWasClicked = GUILayout.Button("play then destroy");

  if( playButtonWasClicked ){
   myAudioDestructObect.audio.Play();
  }
  
  if( destroyButtonWasClicked ){
   myAudioDestructObect.audio.Play();
   myAudioDestructObect.enabled = true;
  }
 }
}</pre></div></li><li><p>With the <span class="strong"><strong>Main Camera</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> view, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>AudioSource</strong></span> variable <code class="literal">myAudioDestructObect</code>.</p></li><li><p>With the <span class="strong"><strong>AudioObject</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> view, disable the scripted component <code class="literal">AutoDestructBehaviour</code> (uncheck the box by this component).</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec243"></a>How it works...</h3></div></div></div><p>The game <a id="id471" class="indexterm"></a>object named <span class="strong"><strong>AudioObject</strong></span><a id="id472" class="indexterm"></a> contains an <span class="strong"><strong>AudioSource</strong></span> component, which stores and manages the playing of audio clips. <span class="strong"><strong>AudioObject</strong></span> also contains a scripted component, which is an instance of the <code class="literal">AudioDestructBehaviour</code> class. When enabled, in every frame this object (via its <code class="literal">Update()</code> method) tests whether the audio source is not playing (<code class="literal">!audio.isPlaying</code>). As soon as the audio is found not to be playing the game object is destroyed. While the audio source is playing, then no action is taken.</p><p>The <span class="strong"><strong>Main Camera</strong></span> scripted object <code class="literal">PlayDestroyButtonGUI</code> offers two buttons to the user, both buttons send a <code class="literal">Play()</code> message to the audio source component of the audio game object. However, when the <span class="strong"><strong>Play then destroy</strong></span> button is clicked, the scripted component is also enabled. By enabling the scripted object, it means the logic in its <code class="literal">Update()</code> method<a id="id473" class="indexterm"></a> will be tested each frame, and as soon as the audio clip has finished playing, then the parent game object will be destroyed.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec244"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Preventing the AudioClip from restarting if already playing</em></span> recipe.</p></li></ul></div></div></div>