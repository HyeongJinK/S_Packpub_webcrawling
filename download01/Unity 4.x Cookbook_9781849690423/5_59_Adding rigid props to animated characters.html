<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec61"></a>Adding rigid props to animated characters</h2></div></div><hr /></div><p>In case you<a id="id392" class="indexterm"></a> haven't included a sufficient <a id="id393" class="indexterm"></a>number of props for your character when modeling and animating it, you might want to give him the chance to collect new ones at runtime. In this recipe, we will learn how to instantiate a game object and assign it to a character, respecting the animation hierarchy.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec209"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared a project named <code class="literal">MixamoProject</code>, containing several assets such as levels, animated characters, and props. You can find it inside the <code class="literal">0423_05_codes</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec210"></a>How to do it...</h3></div></div></div><p>To add a rigid prop to an animated character at runtime, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open the <span class="strong"><strong>MixamoProject</strong></span> project, and then open the level named <span class="strong"><strong>05_05</strong></span> in the <span class="strong"><strong>Levels</strong></span> folder.</p></li><li><p>You should see Mixamo's animated S.W.A.T. soldier and two spheres. Those spheres will trigger the addition of new props for the character.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> view, create a new C# script named <code class="literal">AddProp.cs</code>.</p></li><li><p>Open the script and add the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class AddProp : MonoBehaviour {
    public GameObject prop;
    public string propName;
    public Transform targetBone;
    public Vector3 propOffset;
    public bool destroyTrigger = true;

    void OnTriggerEnter ( Collider collision){

          if (targetBone.IsChildOf(collision.transform)){
           bool checkProp = false;
           foreach(Transform child in targetBone){ 
               if (child.name == propName)
                    checkProp = true;
           }

          if(!checkProp){
           GameObject newprop;
       newprop = Instantiate(prop, targetBone.position, targetBone.rotation) as GameObject;
           newprop.name = propName;
           newprop.transform.parent = targetBone;
           newprop.transform.localPosition += propOffset;
           if(destroyTrigger)
               Destroy(gameObject);
              }
          }
    }
}</pre></div></li><li><p>Save and close the script.</p></li><li><p>Attach <a id="id394" class="indexterm"></a>the <span class="strong"><strong>AddProp.cs</strong></span> script by<a id="id395" class="indexterm"></a> dragging it from the <span class="strong"><strong>Project</strong></span> view onto the objects named <span class="strong"><strong>Sphere Blue</strong></span> and <span class="strong"><strong>Sphere Red</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> view.</p></li><li><p>Select each sphere, and select the <span class="strong"><strong>Is Trigger</strong></span> checkbox in the <span class="strong"><strong>Sphere Collider</strong></span> component (located in the <span class="strong"><strong>Inspector</strong></span> view).</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_36.jpg" /></div></li><li><p>Select <span class="strong"><strong>Sphere Blue</strong></span> and check out its <span class="strong"><strong>Add Prop</strong></span> component.</p></li><li><p>First, let's assign a Prefab to the <span class="strong"><strong>Prop</strong></span> field. In the <span class="strong"><strong>Project</strong></span> view, expand the <span class="strong"><strong>Props</strong></span> folder. Then, drag the Prefab named <span class="strong"><strong>Gun</strong></span> into the <span class="strong"><strong>Prop</strong></span> field.</p></li><li><p>In the <span class="strong"><strong>Prop Name</strong></span> field, type in <span class="strong"><strong>Gun</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Target Bone</strong></span> field, select the <span class="strong"><strong>swat:LeftUpLeg</strong></span> transform from the list (or drag it from the <span class="strong"><strong>Hierarchy</strong></span> view; it is a child of the <span class="strong"><strong>Character</strong></span> game object).</p></li><li><p>Expand the <span class="strong"><strong>Prop Offset</strong></span> field and type in the values of <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> as <code class="literal">-0.05</code>, <code class="literal">-0.15</code>, and <code class="literal">-0.06</code> respectively. Finally, deselect the <span class="strong"><strong>Destroy Trigger</strong></span> checkbox.</p></li><li><p>Select the <span class="strong"><strong>Sphere Red</strong></span> object and fill in the variables as follows: <span class="strong"><strong>Prop</strong></span>: <code class="literal">Badge</code>; <span class="strong"><strong>Prop Name</strong></span>: <code class="literal">Badge</code>; <span class="strong"><strong>Target Bone</strong></span>: <code class="literal">swat:Spine2</code>; <span class="strong"><strong>Prop Offset</strong></span>: <span class="strong"><strong>X</strong></span>: <code class="literal">-0.11</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">0.05</code>, <span class="strong"><strong>Z</strong></span>: <code class="literal">0.11</code>. Also, deselect the <span class="strong"><strong>Destroy Trigger</strong></span> checkbox.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_37.jpg" /></div></li><li><p>Play the <a id="id396" class="indexterm"></a>scene. Use the WASD keyboard <a id="id397" class="indexterm"></a>control scheme and direct the character to the spheres. Colliding with them will add a new handgun holster (to be attached to the character's left leg) and a badge (to be attached on the left-hand side of the character's chest).</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_38.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec211"></a>How it works...</h3></div></div></div><p>Once it's been triggered by the character, the script attached to the spheres instantiates the assigned Prefabs, making them children of the bones they have been placed into. The <span class="strong"><strong>Prop Offset</strong></span> field can be used to fine-tune the exact position of the prop (relative to its parent transform). <a id="id398" class="indexterm"></a>As the props become parented by<a id="id399" class="indexterm"></a> the bones of the animated character, they will follow and respect its hierarchy and animation. Note that the script checks for pre-existing props of the same name before actually instantiating new ones.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec212"></a>There's more...</h3></div></div></div><p>You could make a similar script to remove props. In that case, the function <code class="literal">OnTriggerEnter</code><a id="id400" class="indexterm"></a> would contain only the following code:</p><div class="informalexample"><pre class="programlisting">if (targetBone.IsChildOf(collision.transform)){
    foreach(Transform child in targetBone){
        if (child.name == propName)
            Destroy (child.gameObject);
    }
}</pre></div></div></div>