<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec24"></a>Making textures from screen content</h2></div></div><hr /></div><p>If you want <a id="id96" class="indexterm"></a>your game or player to take in-game snapshots and apply it as a texture, this recipe will show you how. This can be very useful if you plan to implement an in-game photo gallery or display a snapshot of a past key moment at the end of a level (Race Games and Stunt Sims use this feature a lot).</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec64"></a>Getting ready</h3></div></div></div><p>In order to follow this recipe, please import the <code class="literal">basicTerrain</code> package, available in the <code class="literal">0423_02_04_05</code> folder, into your project. The package includes a basic terrain and a camera that can be rotated via a mouse.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec65"></a>How to do it...</h3></div></div></div><p>To create textures from screen content, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the Unity package and open the <code class="literal">02_04_05</code> scene.</p></li><li><p>We need to create a script. In the <span class="strong"><strong>Project</strong></span> view, click on the <span class="strong"><strong>Create</strong></span> drop-down menu and choose <span class="strong"><strong>C# Script</strong></span>. Rename it <code class="literal">ScreenTexture</code> and open it in your editor.</p></li><li><p>Open your script and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ScreenTexture : MonoBehaviour {
    public int photoWidth = 50;
    public int photoHeight = 50;
    public int thumbProportion = 25;
    public Color borderColor = Color.white;
    public int borderWidth = 2;
    private Texture2D texture;
    private Texture2D border; 
    private int screenWidth;
    private int screenHeight;
    private int frameWidth;
    private int frameHeight;
    private bool  shoot = false;

    void  Start (){
        screenWidth = Screen.width;
        screenHeight = Screen.height;
        frameWidth = Mathf.RoundToInt(screenWidth * photoWidth * 0.01f);
        frameHeight = Mathf.RoundToInt(screenHeight * photoHeight * 0.01f);
        texture = new Texture2D (frameWidth,frameHeight,TextureFormat.RGB24,false);
        border = new Texture2D (1,1,TextureFormat.ARGB32, false);
        border.SetPixel(0,0,borderColor);
        border.Apply();
    }
    void  Update (){
        if (Input.GetKeyUp(KeyCode.Mouse0))
        	        StartCoroutine(CaptureScreen());
    }

    void  OnGUI (){
        GUI.DrawTexture(new Rect((screenWidth*0.5f)-(frameWidth*0.5f) - borderWidth*2,((screenHeight*0.5f)-(frameHeight*0.5f)) - borderWidth,frameWidth + borderWidth*2,borderWidth),border,ScaleMode.StretchToFill);
        GUI.DrawTexture(new Rect((screenWidth*0.5f)-(frameWidth*0.5f) - borderWidth*2,(screenHeight*0.5f)+(frameHeight*0.5f),frameWidth + borderWidth*2,borderWidth),border,ScaleMode.StretchToFill);
        GUI.DrawTexture(new Rect((screenWidth*0.5f)-(frameWidth*0.5f)- borderWidth*2,(screenHeight*0.5f)-(frameHeight*0.5f),borderWidth,frameHeight),border,ScaleMode.StretchToFill);
        GUI.DrawTexture(new Rect((screenWidth*0.5f)+(frameWidth*0.5f),(screenHeight*0.5f)-(frameHeight*0.5f),borderWidth,frameHeight),border,ScaleMode.StretchToFill);
        if(shoot){
            GUI.DrawTexture(new Rect (10,10,frameWidth*thumbProportion*0.01f,frameHeight*thumbProportion* 0.01f),texture,ScaleMode.StretchToFill);
        }
    }

    IEnumerator  CaptureScreen (){
        yield return new WaitForEndOfFrame();
        texture.ReadPixels(new Rect((screenWidth*0.5f)-(frameWidth*0.5f),(screenHeight*0.5f)-(frameHeight*0.5f),frameWidth,frameHeight),0,0);
        texture.Apply();
        shoot = true;
    }
}</pre></div></li><li><p>Save your script and apply it to the <span class="strong"><strong>Main Camera</strong></span> game object.</p></li><li><p>In the <a id="id97" class="indexterm"></a>
<span class="strong"><strong>Inspector</strong></span> view, change the values for the <span class="strong"><strong>Screen Capture</strong></span> component, leaving <span class="strong"><strong>Photo Width</strong></span> and <span class="strong"><strong>Photo Height</strong></span> as <span class="strong"><strong>25</strong></span> and <span class="strong"><strong>Thumb Proportion</strong></span> as <span class="strong"><strong>75</strong></span>, as shown here:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_02_13.jpg" /></div></li><li><p>Play the scene. You will be able to take a snapshot of the screen (and have it displayed on the top-left corner) by clicking the mouse button.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_02_14.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec66"></a>How it works...</h3></div></div></div><p>Clicking the <a id="id98" class="indexterm"></a>mouse triggers a function that reads pixels within the specified rectangle and applies them into a texture that is drawn by the GUI.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec67"></a>There's more...</h3></div></div></div><p>Apart from displaying the texture as a GUI element, you could use it in other ways.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec15"></a>Applying your texture to a material</h4></div></div></div><p>You apply<a id="id99" class="indexterm"></a> your texture to an existing object's material by adding a line similar to <code class="literal">GameObject.Find("MyObject").renderer.material.mainTexture = texture;</code> at the end of the <code class="literal">CaptureScreen</code> function.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec16"></a>Using your texture as a screenshot</h4></div></div></div><p>You can encode<a id="id100" class="indexterm"></a> your texture as a PNG image file and save it. Check out Unity's documentation on this feature at <a class="ulink" href="http://docs.unity3d.com/Documentation/ScriptReference/Texture2D.EncodeToPNG.html" target="_blank">http://docs.unity3d.com/Documentation/ScriptReference/Texture2D.EncodeToPNG.html</a>.</p></div></div></div>