<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec57"></a>Configuring a character's Avatar and Idle animation</h2></div></div><hr /></div><p>One of the features that make Unity's new animation system, <a id="id315" class="indexterm"></a>Mecanim, so flexible and powerful is the ability to quickly reassign animation clips from one character to another. This is made possible through the use of <span class="strong"><strong>Avatars</strong></span>; <a id="id316" class="indexterm"></a>an Avatar is basically a layer between your character's original rig and Unity's animation system.</p><p>In this recipe, we will learn how to configure an<a id="id317" class="indexterm"></a> Avatar skeleton on a <a id="id318" class="indexterm"></a>Mixamo character.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec193"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared a project named <code class="literal">MixamoProject</code>, containing several assets such as levels, animated characters, and props. You can find it inside the <code class="literal">0423_05_codes</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec194"></a>How to do it...</h3></div></div></div><p>To configure an Avatar skeleton, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open the project, and then open the level named <span class="strong"><strong>05_01</strong></span> (inside the folder <span class="strong"><strong>Levels</strong></span>).</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> view, inside the <span class="strong"><strong>Original_Character</strong></span> folder, select the <span class="strong"><strong>Swat</strong></span> model.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> view, under <span class="strong"><strong>Swat Import Settings</strong></span>, click on the <span class="strong"><strong>Rig</strong></span> tab. Then, change <span class="strong"><strong>Animation Type</strong></span> to <span class="strong"><strong>Humanoid</strong></span>. Leave <span class="strong"><strong>Avatar Definition</strong></span> as <span class="strong"><strong>Create From this Model</strong></span>, and also make sure that the option <span class="strong"><strong>Keep Additional Bones</strong></span> is selected. Finally, click on the <span class="strong"><strong>Configureâ€¦</strong></span> button.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_01.jpg" /></div></li><li><p>The <span class="strong"><strong>Inspector</strong></span> view will show the newly-created Avatar. Observe how Unity correctly<a id="id319" class="indexterm"></a> maps the bones of our character <a id="id320" class="indexterm"></a>onto its structure, assigning (for example) the <span class="strong"><strong>swat:LeftForeArm</strong></span> bone as the Avatar's <span class="strong"><strong>Lower Arm</strong></span>. We could, of course, reassign the bones if needed. For now, just click on the <span class="strong"><strong>Done</strong></span> button to close the view.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_02.jpg" /></div></li><li><p>Now that we have our Avatar ready, let's configure our animation for the Idle state. From the <span class="strong"><strong>Original_Character</strong></span> folder, select the <span class="strong"><strong>Swat@rifle_aiming_idle</strong></span> file.</p></li><li><p>Activate the <span class="strong"><strong>Rig</strong></span> section, change <span class="strong"><strong>Animation Type</strong></span> to <span class="strong"><strong>Humanoid</strong></span> and <span class="strong"><strong>Avatar Definition</strong></span> to <span class="strong"><strong>Copy From Other Avatar</strong></span>. Then, select <span class="strong"><strong>swatAvatar</strong></span> for <span class="strong"><strong>Source</strong></span>, by choosing it from the list or dragging it into the slot from the <span class="strong"><strong>Project</strong></span> view. Confirm your changes by clicking on <span class="strong"><strong>Apply</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_03.jpg" /></div></li><li><p>Now click on the <span class="strong"><strong>Animations</strong></span> tab. Select the <span class="strong"><strong>rifle_aiming_idle</strong></span> clip from the <span class="strong"><strong>Clips</strong></span> list <a id="id321" class="indexterm"></a>and select the <span class="strong"><strong>Loop Pose</strong></span> option. <a id="id322" class="indexterm"></a>Under <span class="strong"><strong>Root Transform Rotation</strong></span>, check <span class="strong"><strong>Bake into Pose</strong></span> and set <span class="strong"><strong>Body Orientation</strong></span> for <span class="strong"><strong>Baked Upon (at Start)</strong></span>; Under <span class="strong"><strong>Root Transform Position (Y)</strong></span>, check <span class="strong"><strong>Bake into Pose</strong></span> and set <span class="strong"><strong>Original</strong></span> for <span class="strong"><strong>Baked Upon (at Start)</strong></span>; <span class="strong"><strong>Under Root Transform Position (XZ)</strong></span>, check <span class="strong"><strong>Bake into Pose</strong></span> and set <span class="strong"><strong>Center of Mass</strong></span> for <span class="strong"><strong>Baked Upon (at Start)</strong></span>. Finally, click on the <span class="strong"><strong>Clamp Range</strong></span> button (see the following screenshot) to adjust the timeline. Click on <span class="strong"><strong>Apply</strong></span> to confirm changes.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_04.jpg" /></div></li><li><p>In order to access animation clips and play them, we need to create a controller. Do that<a id="id323" class="indexterm"></a> by clicking on the <span class="strong"><strong>Create</strong></span> button from the <span class="strong"><strong>Project</strong></span> view and selecting the option <span class="strong"><strong>Animator Controller</strong></span>. Name it <code class="literal">swatController01</code>.</p></li><li><p>Double-click on <span class="strong"><strong>Animator Controller</strong></span> to open the <span class="strong"><strong>Animator</strong></span> view.</p></li><li><p>In the <span class="strong"><strong>Animator</strong></span> view, <a id="id324" class="indexterm"></a>right-click on the grid to open a context menu. Then, select the <span class="strong"><strong>Empty</strong></span> option under <span class="strong"><strong>Create State</strong></span> (see the following screenshot). A new box named <span class="strong"><strong>New State</strong></span> will appear, which is orange in color, indicating that this is the default state.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_05.jpg" /></div></li><li><p>Select this box<a id="id325" class="indexterm"></a> and, <a id="id326" class="indexterm"></a>in the <span class="strong"><strong>Inspector</strong></span> view, change its name to <code class="literal">Idle</code>. Also, for the <span class="strong"><strong>Motion</strong></span> field, choose <span class="strong"><strong>rifle_aiming_idle</strong></span> by either selecting it from the list or dragging it from the <span class="strong"><strong>Project</strong></span> view.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_06.jpg" /></div></li><li><p>Drag the <span class="strong"><strong>Swat</strong></span> model <a id="id327" class="indexterm"></a>from the <span class="strong"><strong>Original_Character</strong></span> folder onto the <span class="strong"><strong>Hierarchy</strong></span> view, placing it into the scene.</p></li><li><p>Select the <span class="strong"><strong>Swat</strong></span> model <a id="id328" class="indexterm"></a>from the <span class="strong"><strong>Hierarchy</strong></span> view and observe its Animator component in the <span class="strong"><strong>Inspector</strong></span> view. Then, assign the newly created <span class="strong"><strong>swatController01</strong></span> to the <span class="strong"><strong>Controller</strong></span> field.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_05_07.jpg" /></div></li><li><p>Play your scene to see the character correctly animated.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec195"></a>How it works...</h3></div></div></div><p>As you might have noticed, we performed a variety of operations in order to have our character configured and animated in the scene. First, we set up its Avatar skeleton based on its original bone structure. Then, we applied the character's Avatar in the animation clip (which, like the character itself, is a <code class="literal">.fbx</code> file). After that, we adjusted the animation clip to better suit our character, which included making it loop. Finally, an Animator Controller was created, and the edited animation clip was made into its default animation state.</p><p>The concept of the Avatar is what makes Mecanim so flexible. Once you have a Controller, you can apply it to other humanoid characters as long as they have an Avatar body mask. If you want to try it yourself, import the <code class="literal">mascot.fbx</code> file (located inside the <code class="literal">0423_05_01</code> folder), perform steps 3 and 4 of this recipe for that character, place it on the scene, and use <span class="strong"><strong>swatController01</strong></span> as its <span class="strong"><strong>Controller</strong></span> in the Animator component. Then, play the scene to see the mascot playing the <span class="strong"><strong>rifle_aiming_idle</strong></span> animation clip.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec196"></a>There's more...</h3></div></div></div><p>To get more information about the Animator Controller<a id="id329" class="indexterm"></a>, check Unity's documentation at <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/class-AnimatorController.html" target="_blank">http://docs.unity3d.com/Documentation/Components/class-AnimatorController.html</a>.</p></div></div>