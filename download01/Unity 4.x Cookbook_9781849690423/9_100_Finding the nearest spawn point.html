<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec98"></a>Finding the nearest spawn point</h2></div></div><hr /></div><p>Rather than randomly choosing a<a id="id715" class="indexterm"></a> spawn point or waypoint in some cases, we will want to choose the closest point to the current position of the player or camera. This recipe builds on the previous one to move the player's red cube to the closest tagged <code class="literal">Respawn</code> object each time the Fire key is clicked.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec342"></a>Getting ready</h3></div></div></div><p>This recipe builds upon the previous one, so make a copy of that Unity project then follow the steps of this recipe.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec343"></a>How to do it...</h3></div></div></div><p>To find the nearest spawn point, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Remove the <code class="literal">SpawnBall</code> scripted component from the <span class="strong"><strong>Main Camera</strong></span>.</p></li><li><p>Enable the <span class="strong"><strong>Mesh Rendered</strong></span> components of your two spawn point capsules (so you can see these white capsules on the terrain).</p></li><li><p>Add the following C# script class to <code class="literal">Cube-player</code>:</p><div class="informalexample"><pre class="programlisting">// file: NearestSpawnpoint
using UnityEngine;
using System.Collections;

public class NearestSpawnpoint : MonoBehaviour {
  public GameObject[] respawns;
  public const float FIRE_DELAY = 0.25f;
  private float nextFireTime = 0f;
    
  private void Start(){
    respawns = GameObject.FindGameObjectsWithTag("Respawn");
  }

  void Update() {
    if( Time.time &gt; nextFireTime )
      CheckFireKey();
  }

  void CheckFireKey() {
    if( Input.GetButton("Fire1")) {
      MoveToNewPosition();
      nextFireTime = Time.time + FIRE_DELAY;
    }
  }

  private void MoveToNewPosition(){
    transform.position = NearestSpawnpointPosition();
  }

  private Vector3 NearestSpawnpointPosition(){
    if( respawns.Length &lt; 1) return transform.position;
    Vector3 pos = respawns[0].transform.position;
    float shortestDistance = Vector3.Distance( transform.position, pos);
    for(int i = 1; i &lt; respawns.Length; i++){
      Vector3 newPos = respawns[i].transform.position;
      float newDist = Vector3.Distance( transform.position, newPos);
      if( newDist &lt; shortestDistance){
        pos = newPos;
        shortestDistance = newDist;
      }
    }
    
    return pos;
  }
}</pre></div></li><li><p>Run your game. Move the red cube around with the arrow keys, and click on the mouse button. <a id="id716" class="indexterm"></a>The red cube should jump to the nearest capsule spawn point.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec344"></a>How it works...</h3></div></div></div><p>The <code class="literal">Start()</code> and <code class="literal">CheckFireKey()</code> methods are the same, except that <code class="literal">CheckFireKey()</code> now calls the<a id="id717" class="indexterm"></a> <code class="literal">MoveToNewPosition()</code> method.</p><p>The <code class="literal">MoveToNewPosition()</code> method has a single statement, setting the position of the (player cube's) transform to the <code class="literal">Vector3</code> location returned from the <a id="id718" class="indexterm"></a>
<code class="literal">NearestSpawnpointPosition()</code> method.</p><p>The <code class="literal">NearestSpawnpointPosition()</code> method has the job of finding and returning the position of the spawn point closest to the current location of the (player cube's) transform. First, a check is made in case no respawn points can be found, in which case the current position of the player's cube is returned. Then, the position of first element in the <code class="literal">respawns</code> array is chosen as the first closest spawn point and is stored in the <code class="literal">pos</code> variable. The distance from the player cube to this object is stored in the <code class="literal">shortestDistance</code> variable<a id="id719" class="indexterm"></a>. A <code class="literal">for</code> loop is used to loop through the remaining spawn points, and each time one is found to be closer than the distance in <code class="literal">shortestDistance</code>, then this closer position is stored into <code class="literal">pos</code> and the new closer distance stored in <code class="literal">shortestDistance</code>. Once all spawn points have been tested, the method returns the <code class="literal">Vector3</code> value in <code class="literal">pos</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec345"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Finding a random spawn point</em></span> recipe</p></li><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Following waypoints in a sequence</em></span> recipe</p></li></ul></div></div></div>