<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec34"></a>Using cookie textures to simulate a cloudy outdoor</h2></div></div><hr /></div><p>As it can be seen in <a id="id176" class="indexterm"></a>many first-person<a id="id177" class="indexterm"></a> shooters and survival horror games, lights and shadows can add a great deal of complexity to a scene, helping immensely to create the right atmosphere for the game. In this recipe, we will create a cloudy outdoor environment, lighting it using cookie textures.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec104"></a>Getting ready</h3></div></div></div><p>If you don't have access to a image editor or prefer to skip the texture map elaboration in order to focus on the implementation, please use the <code class="literal">cloudCookie.tga</code> image file provided in the <code class="literal">0423_03_05</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec105"></a>How to do it...</h3></div></div></div><p>To simulate a cloudy outdoor environment, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In your image editor, create a new 512 x 512 pixel image.</p></li><li><p>Using black as foreground color and white as background color, apply the <span class="strong"><strong>Render Clouds</strong></span> filter (in Photoshop, this is done by navigating to <span class="strong"><strong>Filter</strong></span> | <span class="strong"><strong>Render</strong></span> | <span class="strong"><strong>Clouds</strong></span>):</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_03_21.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>Image editors usually have a filter or command that renders clouds. If your image editor doesn't have such a capability, you can either paint it manually or use the <code class="literal">cloudCookie.tga</code> image file provided in the <code class="literal">0423_03_05</code> folder.</p></div></li><li><p>Select<a id="id178" class="indexterm"></a> your entire image and copy it.</p></li><li><p>Open the <span class="strong"><strong>Channels</strong></span> window (in Photoshop this can be done by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Channels</strong></span>).</p></li><li><p>There <a id="id179" class="indexterm"></a>should be three channels: <span class="strong"><strong>Red</strong></span>, <span class="strong"><strong>Green</strong></span>, and <span class="strong"><strong>Blue</strong></span>. Create a new channel. This will be the <span class="strong"><strong>Alpha</strong></span> channel.</p></li><li><p>In the <span class="strong"><strong>Channels</strong></span> window, select the <span class="strong"><strong>Alpha</strong></span> channel and paste your image into it:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_03_22.jpg" /></div></li><li><p>Save your image file as <code class="literal">cloudCookie.PSD</code> or <code class="literal">cloudCookie.TGA</code>.</p></li><li><p>Import<a id="id180" class="indexterm"></a> your image<a id="id181" class="indexterm"></a> file into Unity and select it in the <span class="strong"><strong>Project</strong></span> view.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> view, set <span class="strong"><strong>Texture Type</strong></span> to <span class="strong"><strong>Cookie</strong></span>, and <span class="strong"><strong>Light Type</strong></span> to <span class="strong"><strong>Directional</strong></span> (as shown in the following screenshot):</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_03_23.jpg" /></div></li><li><p>We will need a surface to actually see the lighting effect. You can either add a plane to your scene (via the <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other...</strong></span> | <span class="strong"><strong>Plane</strong></span> menu) or create a terrain (<span class="strong"><strong>Terrain</strong></span> | <span class="strong"><strong>Create Terrain</strong></span>) and edit it, if you wish.</p></li><li><p>Let's add a light to our scene. Since we want to simulate sunlight, the best option is to create a <span class="strong"><strong>Directional Light</strong></span>. You can do that through the drop-down menu named <span class="strong"><strong>Create</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> window.</p></li><li><p>Using<a id="id182" class="indexterm"></a> the <span class="strong"><strong>Transform</strong></span> component of the <span class="strong"><strong>Inspector</strong></span> view, reset the light's <span class="strong"><strong>Position</strong></span> to <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code> and its <span class="strong"><strong>Rotation</strong></span> to <code class="literal">90</code>, <code class="literal">0</code>, <code class="literal">0</code>.</p></li><li><p>In the <a id="id183" class="indexterm"></a>
<span class="strong"><strong>Cookie</strong></span> field, select the <span class="strong"><strong>cloudCookie</strong></span> image that you imported earlier. Change the <span class="strong"><strong>Cookie Size</strong></span> field to <span class="strong"><strong>80</strong></span>, or a number that you feel as more appropriate to the scene's dimension. Please leave the <span class="strong"><strong>Shadow Type</strong></span> as <span class="strong"><strong>No Shadows</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_03_24.jpg" /></div></li><li><p>Now, we need a script to translate our light and, consequently, the cookie projection. Using the drop-down menu in the <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>C# Script</strong></span> and rename it to <code class="literal">MovingShadows</code>.</p></li><li><p>Open your script and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class MovingShadows : MonoBehaviour
{
    public float windSpeedX;
    public float windSpeedZ;
    public float lightCookieSize; // make it equal to the light's Cookie Size parameter in the inspector

    private Vector3 initPos;

    void Start()
    {
        initPos = transform.position;
    }

    void Update()
    {
        if (Mathf.Abs(transform.position.x) &gt;= Mathf.Abs(initPos.x) + lightCookieSize)
        {
            Vector3 pos = transform.position;
            pos.x = initPos.x;
            transform.position = pos;
        }
        else
        {
            transform.Translate(Time.deltaTime * windSpeedX, 0, 0, Space.World);
        }


        if (Mathf.Abs(transform.position.z) &gt;= Mathf.Abs(initPos.z) + lightCookieSize)
        {
            Vector3 pos = transform.position;
            pos.z = initPos.z;
            transform.position = pos;
        }
        else
        {
            transform.Translate(0, 0, Time.deltaTime * windSpeedZ, Space.World);
        }
    }

}</pre></div></li><li><p>Save your script and apply it to the <span class="strong"><strong>Directional Light</strong></span>.</p></li><li><p>Select<a id="id184" class="indexterm"></a> the <span class="strong"><strong>Directional Light</strong></span>. In the <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Wind Speed X</strong></span> and <span class="strong"><strong>Wind Speed Z</strong></span> parameters <a id="id185" class="indexterm"></a>to <span class="strong"><strong>20</strong></span> (you can change these values as you wish). The <span class="strong"><strong>Light Cookie Size</strong></span> parameter has to be changed to the exact amount of the light's cookie size (in our case, <span class="strong"><strong>80</strong></span>):</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_03_25.jpg" /></div></li><li><p>Play your scene. The shadows should be moving.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec106"></a>How it works...</h3></div></div></div><p>With our <a id="id186" class="indexterm"></a>script, we are telling the <span class="strong"><strong>Directional Light</strong></span> to move across the x and z axis, causing the <span class="strong"><strong>Light Cookie</strong></span> texture to be displaced as well. Also, we reset the light object to its original position whenever it travels a distance equal to or greater than the <span class="strong"><strong>Light Cookie Size</strong></span> parameter. The light position must be reset to prevent it from travelling too far, causing problems in real time render and lighting. The <span class="strong"><strong>Light Cookie Size</strong></span> parameter is used to ensure a smooth transition.</p><p>The reason we are not enabling shadows is because the light angle for the x axis must be 90 degrees (or there will be a noticeable gap when the light resets to the original position). If you want dynamic shadows in your scene, please add a second directional light.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec107"></a>There's more...</h3></div></div></div><p>In this recipe we have applied a cookie texture to a directional light. But what if we were using Spot Light or Point Light cookies?</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec31"></a>Creating Spot Light cookies</h4></div></div></div><p>Unity documentation <a id="id187" class="indexterm"></a>has an excellent tutorial on how to make Spot Light cookies. This is great to simulate shadows coming from projectors, windows, and so on. You can check it out at <a class="ulink" href="http://unity3d.com/support/documentation/Manual/HOWTO-LightCookie.html" target="_blank">http://unity3d.com/support/documentation/Manual/HOWTO-LightCookie.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec32"></a>Creating Point Light cookies</h4></div></div></div><p>If you want<a id="id188" class="indexterm"></a> to use a cookie texture with a point light, you'll need to change the <span class="strong"><strong>Light Type</strong></span> in the <span class="strong"><strong>Texture Importer</strong></span> section of the <span class="strong"><strong>Inspector</strong></span>.</p></div></div></div>