<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec88"></a>Creating XML text data manually using XMLWriter</h2></div></div><hr /></div><p>One way to create<a id="id610" class="indexterm"></a> XML data structures from game objects and properties is by hand-coding a method to create each element and its<a id="id611" class="indexterm"></a> contents, using the <code class="literal">XMLWriter</code> class.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec308"></a>How to do it...</h3></div></div></div><p>To create XML text data using <code class="literal">XMLWriter</code>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add the following C# script to <span class="strong"><strong>Main Camera</strong></span>:</p><div class="informalexample"><pre class="programlisting">// file: CreateXMLString.cs
using UnityEngine;
using System.Collections;
using System.Xml;
using System.IO;

public class CreateXMLString : MonoBehaviour {
    private string output = "(nothing yet)";

    private void Start () {
        output = BuildXMLString();
    }

    private void OnGUI() {
        GUILayout.Label( output );
    }

    private string BuildXMLString() {
        StringWriter str = new StringWriter();
        XmlTextWriter xml = new XmlTextWriter(str);

        // start doc and root el.
        xml.WriteStartDocument();
        xml.WriteStartElement("playerScoreList");

        // data element
        xml.WriteStartElement("player");
        xml.WriteElementString("name", "matt");
        xml.WriteElementString("score", "200");
        xml.WriteEndElement();

        // data element
        xml.WriteStartElement("player");
        xml.WriteElementString("name", "jane");
        xml.WriteElementString("score", "150");
        xml.WriteEndElement();

        // end root and document
        xml.WriteEndElement();
        xml.WriteEndDocument();
        return str.ToString();
    }
}</pre></div></li><li><p>The XML text data should be visible when the game is run:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_08_02.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec309"></a>How it works...</h3></div></div></div><p>The <code class="literal">Start()</code> method <a id="id612" class="indexterm"></a>calls <code class="literal">BuildXMLString()</code><a id="id613" class="indexterm"></a> and <a id="id614" class="indexterm"></a>stores the returned string in the <code class="literal">output</code> variable. Our <code class="literal">OnGUI()</code> method displays the contents of <code class="literal">output</code>.</p><p>The <code class="literal">BuildXMLString()</code> method creates a <code class="literal">StringWriter</code> object, into which <code class="literal">XMLWriter</code> builds the string of XML elements. The XML document starts and ends with the <code class="literal">WriteStartDocument()</code><a id="id615" class="indexterm"></a> and <code class="literal">WriteEndDocument()</code> <a id="id616" class="indexterm"></a>methods. Elements start and end with <a id="id617" class="indexterm"></a>
<code class="literal">WriteStartElement(&lt;elementName&gt;)</code> and <a id="id618" class="indexterm"></a>
<code class="literal">WriteEndElement()</code>. String content for an element is added using <code class="literal">WriteElementString()</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec310"></a>There's more...</h3></div></div></div><p>Some details you don't want to miss:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec70"></a>Adding newlines to make XML strings more human readable</h4></div></div></div><p>After every instance<a id="id619" class="indexterm"></a> of the <code class="literal">WriteStartElement()</code> and <code class="literal">WriteElementString()</code> methods, you can add a newline character using <code class="literal">WriteWhiteSpace()</code><a id="id620" class="indexterm"></a>. These are ignored by XML parsing methods, but if you intend to display the XML string for a human to see, the presence of the newline characters makes it much more readable:</p><div class="informalexample"><pre class="programlisting">xml.WriteWhitespace("\n  ");</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec71"></a>Making data class responsible for creating XML from list</h4></div></div></div><p>The XML to be generated is <a id="id621" class="indexterm"></a>often from a list of objects, all of the same class. In this case, it makes sense to make the class of the objects responsible for generating the XML for a list of those objects.</p><p>The <code class="literal">CreateXMLFromArray</code> class<a id="id622" class="indexterm"></a> simply creates an instance of <code class="literal">ArrayList</code> containing <code class="literal">PlayerScore</code> objects, and then calls the (static) method <code class="literal">ListToXML()</code><a id="id623" class="indexterm"></a>, passing in the list of objects.</p><div class="informalexample"><pre class="programlisting">// file: CreateXMLFromArray.cs
using UnityEngine;
using System.Collections;

public class CreateXMLFromArray : MonoBehaviour {
    private string output = "(nothing yet)";
    private ArrayList myPlayerList;

    private void Start () {
        myPlayerList = new ArrayList();
        myPlayerList.Add (new PlayerScore("matt", 200) );
        myPlayerList.Add (new PlayerScore("jane", 150) );

        output = PlayerScore.ListToXML( myPlayerList );
    }

    private void OnGUI() {
        GUILayout.Label( output );
    }
}</pre></div><p>All the hard work is now the responsibility of the <code class="literal">PlayerScore</code> class. This class has two private variables for the players' name and score and a constructor that accepts values for these properties. <a id="id624" class="indexterm"></a>The <code class="literal">public static</code> method <code class="literal">ListToXML()</code> takes an <code class="literal">ArrayList</code> object as an argument, and uses <code class="literal">XMLWriter</code> to build the XML string, looping through each object in the list and calling the object's <code class="literal">ObjectToElement()</code> method. This method adds an XML element to the <code class="literal">XMLWriter</code> argument received for the data in that object.</p><div class="informalexample"><pre class="programlisting">// file: PlayerScore.cs
using System.Collections;
using System.Xml;
using System.IO;

public class PlayerScore {
    private string _name;
    private int _score;

    public PlayerScore(string name, int score) {
        _name = name;
        _score = score;
    }

    // class method
    static public string ListToXML(ArrayList playerList) {
        StringWriter str = new StringWriter();
        XmlTextWriter xml = new XmlTextWriter(str);

        // start doc and root el.
        xml.WriteStartDocument();
        xml.WriteStartElement("playerScoreList");

        // add elements for each object in list
        foreach (PlayerScore playerScoreObject in playerList) {
            playerScoreObject.ObjectToElement( xml );
        }

        // end root and document
        xml.WriteEndElement();
        xml.WriteEndDocument();

        return str.ToString();
    }

    private void ObjectToElement(XmlTextWriter xml) {
        // data element
        xml.WriteStartElement("player");
        xml.WriteElementString("name", _name);
        string scoreString = "" + _score; // make _score a string
        xml.WriteElementString("score", scoreString);
        xml.WriteEndElement();
    }
}</pre></div></div></div></div>