<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec28"></a>Displaying a mini-map</h2></div></div><hr /></div><p>In many games, <a id="id128" class="indexterm"></a>a broader view of the scene can be invaluable for navigation and information. Mini-maps are great for giving players that extra perspective they might need when in first- or third-person mode.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec80"></a>Getting ready</h3></div></div></div><p>In order to follow this recipe, please import the <code class="literal">miniMap</code> package, available in the <code class="literal">0423_02_08</code> folder, into your project. The package includes a scene containing a third-person controller inside a simple maze, and also a texture named <code class="literal">marker</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec81"></a>How to do it...</h3></div></div></div><p>To create a mini-map<a id="id129" class="indexterm"></a>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">miniMap</code> Unity package and open the scene named <code class="literal">thirdPerson</code>, available in the <code class="literal">02_08</code> folder.</p></li><li><p>Select the <span class="strong"><strong>3rd Person Controller</strong></span> option and, in the <span class="strong"><strong>Inspector</strong></span> view, add it to a new layer named <span class="strong"><strong>NoMap</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_02_24.jpg" /></div></li><li><p>Create a new camera. Rename it <span class="strong"><strong>Map Camera</strong></span> and, in the <span class="strong"><strong>Inspector</strong></span> view, change its parameters as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Clear Flags</strong></span>: <span class="strong"><strong>Depth Only</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Culling Mask</strong></span>: <span class="strong"><strong>Mixedâ€¦</strong></span> (unselect <span class="strong"><strong>NoMap</strong></span>)</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Projection</strong></span>: <span class="strong"><strong>Orthographic</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Depth</strong></span>: <span class="strong"><strong>1</strong></span> (also, uncheck the camera's <span class="strong"><strong>Audio Listener</strong></span> component)</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_02_25.jpg" /></div></li><li><p>In the <span class="strong"><strong>Project</strong></span> window, create a new <span class="strong"><strong>C# Script</strong></span> and name it <code class="literal">GenerateMap</code>. Open it <a id="id130" class="indexterm"></a>and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class GenerateMap : MonoBehaviour
{
   public Transform target;
   public Texture2D marker;
   public float camHeight = 1.0f;
   public bool freezeRotation = true;
   public float camDistance = 2.0f;
   public enum ha {left, center, right};
   public enum va {top, middle, bottom};
   public ha horizontalAlignment = ha.left;
   public va verticalAlignment = va.top;
   public enum sd {pixels, screen_percentage};
   public sd dimensionsIn = sd.pixels;
   public int width = 50;
   public int heigth = 50;
   public float xOffset = 0f;
   public float yOffset = 0f;
	
    void Start(){
        Vector3 angles = transform.eulerAngles;
        angles.x = 90;
        angles.y = target.transform.eulerAngles.y;
        transform.eulerAngles = angles;
        Draw();
    }

    void Update(){
        transform.position = new Vector3(target.transform.position.x, target.transform.position.y + camHeight, target.transform.position.z);
        camera.orthographicSize = camDistance;
        if (freezeRotation){
            Vector3 angles = transform.eulerAngles;
            angles.y = target.transform.eulerAngles.y;
            transform.eulerAngles = angles;
        }
    }
    
    void Draw()    {
        int hsize = Mathf.RoundToInt(width * 0.01f * Screen.width);
	    int vsize = Mathf.RoundToInt(heigth * 0.01f * Screen.height);
	    int hloc = Mathf.RoundToInt(xOffset * 0.01f * Screen.width);;
	    int vloc = Mathf.RoundToInt((Screen.height - vsize) - (yOffset * 0.01f * Screen.height));		
	    if(dimensionsIn == sd.screen_percentage){
	    	hsize = Mathf.RoundToInt(width * 0.01f * Screen.width);
	    	vsize = Mathf.RoundToInt(heigth * 0.01f * Screen.height);
	    } else {
		    hsize = width;
		    vsize = heigth;
	    }
		
		switch(horizontalAlignment){
		    case ha.left:
			    hloc = Mathf.RoundToInt(xOffset * 0.01f * Screen.width);
		    break;
		    case ha.right:
			    hloc = Mathf.RoundToInt((Screen.width - hsize) - (xOffset * 0.01f * Screen.width));
			break;
		    case ha.center:
			    hloc = Mathf.RoundToInt(((Screen.width * 0.5f) - (hsize * 0.5f)) - (xOffset * 0.01f * Screen.height));
			break;
		}
		switch(verticalAlignment){
			case va.top:
			    vloc = Mathf.RoundToInt((Screen.height - vsize) - (yOffset * 0.01f * Screen.height));
			break;
		    case va.bottom:
			    vloc = Mathf.RoundToInt(yOffset * 0.01f * Screen.height);
			break;
		    case va.middle:
			    vloc = Mathf.RoundToInt(((Screen.height * 0.5f) - (vsize * 0.5f)) - (yOffset * 0.01f * Screen.height));
			break;
		}
	    camera.pixelRect = new Rect(hloc,vloc,hsize,vsize);
	}
    void OnGUI(){
	    Vector3 markerPos = camera. camera.WorldToViewportPoint  (target.position);
	    int pointX =  Mathf.RoundToInt((camera.pixelRect.xMin + camera.pixelRect.xMax) * markerPos.x);
	    int pointY =  Mathf.RoundToInt(Screen.height - (camera.pixelRect.yMin + camera.pixelRect.yMax) * markerPos.y);
	    GUI.DrawTexture( new Rect(pointX-(marker.width * 0.5f),pointY-(marker.height * 0.5f),marker.width,marker.height), marker, ScaleMode.StretchToFill, true, 10.0f);
	}
}</pre></div></li><li><p>Save the<a id="id131" class="indexterm"></a> script and attach it to the <span class="strong"><strong>Map Camera</strong></span>. Then, in the <span class="strong"><strong>Inspector</strong></span> view, change parameters of the <span class="strong"><strong>Generate Map</strong></span> component as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Target</strong></span>: <span class="strong"><strong>3rd Person Controller</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Marker</strong></span>: <span class="strong"><strong>marker</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Cam Height</strong></span>: <span class="strong"><strong>6</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Cam Distance</strong></span>: <span class="strong"><strong>10</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Horizontal Alignment</strong></span>: <span class="strong"><strong>Right</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Vertical Alignment</strong></span>: <span class="strong"><strong>Bottom</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Dimensions In</strong></span>: <span class="strong"><strong>screen_percentage</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>XOffset</strong></span> and <span class="strong"><strong>YOffset</strong></span>: <span class="strong"><strong>0</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Width</strong></span>: <span class="strong"><strong>25</strong></span></p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Height</strong></span>: <span class="strong"><strong>25</strong></span></p></li></ul></div><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_02_26.jpg" /></div></li><li><p>Play the scene. You should be able to see the mini-map functioning in the bottom-right corner of the screen:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_02_27.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec82"></a>How it works...</h3></div></div></div><p>Our script performs<a id="id132" class="indexterm"></a> two main actions: it sets up the viewport according to the desired position and dimensions, and also adjusts the camera's transform settings, making it follow the main character from a top-view perspective. Plus, in order to make the map look cleaner, it hides our main character while displaying a marker where he should be.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec83"></a>There's more...</h3></div></div></div><p>If you want to experiment more with your mini-map, read on.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec20"></a>Using Render Texture (Pro only)</h4></div></div></div><p>If you use Unity Pro,<a id="id133" class="indexterm"></a> you could always use <span class="strong"><strong>Render Texture</strong></span> and display your map using <span class="strong"><strong>GUI.DrawTexture</strong></span><a id="id134" class="indexterm"></a> or <span class="strong"><strong>Graphics.DrawTexture</strong></span><a id="id135" class="indexterm"></a>. For more information on Render Texture, please check the Unity documentation at <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/class-RenderTexture.html" target="_blank">http://docs.unity3d.com/Documentation/Components/class-RenderTexture.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec21"></a>Adapting your mini-map to other styles</h4></div></div></div><p>You could easily <a id="id136" class="indexterm"></a>modify this recipe to make a top or isometric view of a racing game circuit map. Just position the camera manually and prevent it from following the character. Also, don't forget to add markers for all the vehicles!</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec84"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Creating a picture-in-picture effect</em></span> recipe.</p></li></ul></div></div></div>