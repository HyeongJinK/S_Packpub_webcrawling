<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec104"></a>Implementing slow motion</h2></div></div><hr /></div><p>Since Remedy Entertainment's <span class="emphasis"><em>Max Payne</em></span>, slow motion, or bullet-time, has become a popular feature in games. <a id="id755" class="indexterm"></a>For example, Criterion's <span class="emphasis"><em>Burnout</em></span> series has successfully<a id="id756" class="indexterm"></a> explored the slow-motion effect in the racing genre. In this recipe, we will implement slow motion while the player presses down the right mouse button or the <span class="emphasis"><em>Alt</em></span> key.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec361"></a>Getting ready</h3></div></div></div><p>For this recipe, we will use the same prepared package as the previous recipe: <code class="literal">BallShooterGame</code> from the <code class="literal">0423_10_01</code> folder. We will also need a texture for a time progress bar, which is named <code class="literal">barTexture.png</code> and can be found in the <code class="literal">0423_10_02</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec362"></a>How to do it...</h3></div></div></div><p>To implement slow-motion, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start a new Unity project and import the texture image file: <code class="literal">barTexture.png</code>.</p></li><li><p>Import the package named <code class="literal">BallShooterGame</code> into your project and open the level named <code class="literal">RoomLevel</code> (from the <code class="literal">Scenes</code> folder).</p></li><li><p>We need to replace all of the exiting C# <code class="literal">ShooterScript</code> with new code to implement slow motion time effects. Open <code class="literal">ShooterScript</code> and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">// file: ShooterScript.cs
using UnityEngine;
using System.Collections;

public class ShooterScript : MonoBehaviour
{
  public Rigidbody projectile;
  public float projectileForce = 5000.0f;
  public bool compensateBulletSpeed = true;
  public float slowMotionSpeed = 10.0f;
  public Texture2D slowMotionBar;
  public float slowMotionTotalTime = 10.0f;
  public float recoverTimeRate = 0.5f;
  
  private bool isSlowMotionMode = false;
  private float remainingSloMoTime;
  private float startSloMoTimestamp;
  private float elapsedTime = 0.0f;
  private float actualForce;

  private void Start() {
    Screen.showCursor = false;
    remainingSloMoTime = slowMotionTotalTime;
    actualForce = projectileForce;
  }

  private void Update() {
    CheckUserInput();

    if( isSlowMotionMode )
      SlowMotionModeActions();
    else
      NormalTimeActions();
  }

  private void CheckUserInput() {
    if (Input.GetButtonDown("Fire1")){
      Rigidbody clone = (Rigidbody) Instantiate(projectile, Camera.main.transform.position, Camera.main.transform.rotation);
      clone.AddForce(clone.transform.forward * actualForce);
   }
    if (Input.GetButtonDown("Fire2") &amp;&amp; remainingSloMoTime &gt; 0)
      ActivateSloMo();
<a id="id757" class="indexterm"></a>
    if (Input.GetButtonUp("Fire2"))
      DeactivateSloMo();
    }

  private void SlowMotionModeActions() {
    elapsedTime = (Time.time - startSloMoTimestamp) * slowMotionSpeed;
    remainingSloMoTime = slowMotionTotalTime - elapsedTime;

    if (elapsedTime &gt;= slowMotionTotalTime)
      DeactivateSloMo();
  }

  private void NormalTimeActions() {
    if( remainingSloMoTime &lt; slowMotionTotalTime )
      remainingSloMoTime += Time.deltaTime * recoverTimeRate;
    else
      remainingSloMoTime = slowMotionTotalTime;
  }

  private void ActivateSloMo() {
    Time.timeScale = 1.0f / slowMotionSpeed;
    Time.fixedDeltaTime = 0.02f / slowMotionSpeed;
    actualForce = projectileForce * slowMotionSpeed;
    isSlowMotionMode = true;

    float timeLeftToRefill = (slowMotionTotalTime - remainingSloMoTime)  / slowMotionSpeed;
    startSloMoTimestamp = (Time.time - timeLeftToRefill);
  }

  private void DeactivateSloMo() {
    Time.timeScale = 1.0f;
    Time.fixedDeltaTime = 0.02f;
    actualForce = projectileForce;
    isSlowMotionMode = false;
  }

  private void OnGUI() {
    float proportionRemaining = remainingSloMoTime / slowMotionTotalTime;
    float barDisplayWidth = slowMotionBar.width * proportionRemaining;
<a id="id758" class="indexterm"></a>
    int proportionRemaininInt = (int)(proportionRemaining * 100);
    string percentageString = proportionRemaininInt + "%";
    GUI.Label(new Rect(10, 15, 40, 20), percentageString);
    Rect newRect = new Rect(50, 10, barDisplayWidth, slowMotionBar.height);
    GUI.DrawTexture( newRect, slowMotionBar, ScaleMode.ScaleAndCrop, true, 10.0f);
  }
}</pre></div></li><li><p>With the <span class="strong"><strong>First Person Controller</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag the texture image <span class="strong"><strong>barTexture</strong></span> into the <span class="strong"><strong>Inspector</strong></span> for the <span class="strong"><strong>slowMotionBar</strong></span> public variable of the <span class="strong"><strong>ShooterScript</strong></span> component.</p></li><li><p>Play your<a id="id759" class="indexterm"></a> game. You should be able to activate slow motion by keeping the right mouse button or the <span class="emphasis"><em>Alt</em></span> key pressed. A <a id="id760" class="indexterm"></a>progress bar will slowly shrink to indicate how much slow motion time you have remaining.</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_10_02.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec363"></a>How it works...</h3></div></div></div><p>Basically, all we need<a id="id761" class="indexterm"></a> to do to have the slow motion effect is decrease the value of the <code class="literal">Time.timeScale</code> variable. In our script, we do that by dividing it by the <code class="literal">slowMotionSpeed</code> variable<a id="id762" class="indexterm"></a>. We do the same to the <code class="literal">Time.fixedDeltaTime</code> variable<a id="id763" class="indexterm"></a>, which updates the physics simulation of our game. The <code class="literal">ActivateSloMo()</code> method<a id="id764" class="indexterm"></a> sets values for slow motion effects, and the <code class="literal">DeactivateSloMo()</code> method<a id="id765" class="indexterm"></a> returns values for normal speed time.</p><p>In order to make the experience more challenging, we have also implemented a sort of "energy bar" to indicate how much bullet time the player has left (the initial value is given by the <code class="literal">slowMotionDuration</code> variable). Whenever the player is not using bullet time, he has his quota filled according to the <code class="literal">recoverTimeRate</code> variable<a id="id766" class="indexterm"></a>.</p><p>The GUI is implemented based on finding the proportion of slow motion time remaining, and sizing the width of the bar texture accordingly.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec364"></a>There's more...</h3></div></div></div><p>The following are some suggestions for you to improve your slow motion effect even further:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl3sec78"></a>Adding Motion Blur (Unity Pro only)</h4></div></div></div><p><span class="strong"><strong>Motion Blur</strong></span> is<a id="id767" class="indexterm"></a> an <a id="id768" class="indexterm"></a>image effect frequently identified with slow motion. Once attached to the camera, it could be enabled and disabled through the <code class="literal">ActivateSloMo()</code> and <code class="literal">DeactivateSloMo()</code> methods respectively. More information on the Motion Blur image effect can be found at <a class="ulink" href="http://docs.unity3d.com/Documentation/Components/script-MotionBlur.html" target="_blank">docs.unity3d.com/Documentation/Components/script-MotionBlur.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl3sec79"></a>Creating sonic ambience</h4></div></div></div><p><span class="emphasis"><em>Max Payne</em></span> famously <a id="id769" class="indexterm"></a>used a strong, heavy heartbeat sound as sonic ambience. <a id="id770" class="indexterm"></a>You could also try lowering the sound effects volume to convey the character "focus" when in slow motion. Plus, using audio filters on the camera could be an interesting option (provided you have Unity Pro).</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec365"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Pausing the game</em></span> recipe</p></li></ul></div></div></div>