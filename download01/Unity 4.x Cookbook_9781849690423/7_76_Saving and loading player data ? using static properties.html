<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec76"></a>Saving and loading player data – using static properties</h2></div></div><hr /></div><p>Keeping<a id="id509" class="indexterm"></a> track of the player's progress and user <a id="id510" class="indexterm"></a>settings during a game is vital to give your game a greater feel of depth and content. In this <a id="id511" class="indexterm"></a>recipe, we will learn how to make our game "remember" the player's name and score between different levels (scenes). Also, we will give the player the option of erasing his data.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec263"></a>Getting ready</h3></div></div></div><p>We have included <a id="id512" class="indexterm"></a>a complete project named <code class="literal">BlueSpheres</code> in the <code class="literal">0423_07_04</code> folder. In order to follow this recipe, make a copy of that folder as your starting point.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec264"></a>How to do it...</h3></div></div></div><p>To save and load player data, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open the <code class="literal">BlueSpheres</code> project and make yourself familiar with the game by playing<a id="id513" class="indexterm"></a> it a few times and examining the contents of the scenes. The game starts on the <code class="literal">menu_start</code> scene, inside the <code class="literal">Scenes</code> folder.</p></li><li><p>Create<a id="id514" class="indexterm"></a> a new <code class="literal">Player</code> C# script with the following code:</p><div class="informalexample"><pre class="programlisting">// file: Player.cs
using UnityEngine;
using System.Collections;

public class Player : MonoBehaviour {
  public static string username = null;
  public static int score = -1;
  
  public static void DeleteAll(){
    username = null;
    score = -1;
  }
}</pre></div></li><li><p>Replace the contents of the <code class="literal">MenuStart</code> C# script with the following code:</p><div class="informalexample"><pre class="programlisting">// file: MenuStart.cs
using UnityEngine;
using System.Collections;

public class MenuStart : MonoBehaviour
{
  const string DEFAULT_PLAYER_NAME = "PLAYER_NAME";
  private string playerNameField = DEFAULT_PLAYER_NAME;

  private void OnGUI() {
    string rules = "Easiest Game Ever -- Click the blue spheres to advance.";
    GUILayout.Label(rules);

    if(Player.username != null)
      WelcomeGUI();
    else
      CreatePlayerGUI();
  }
  
  private void WelcomeGUI() {
    string welcomeMessage = "Welcome, " + Player.username + ". You currently have " + Player.score + " points.";
        GUILayout.Label(welcomeMessage);
    
    bool playButtonClicked = GUILayout.Button("Play");
    bool eraseButtonClicked = GUILayout.Button("Erase Data");
    
    if( playButtonClicked )
      Application.LoadLevel(1);
    
    if( eraseButtonClicked )
      ResetGameData();
  }
  
  private void ResetGameData() {
    Player.DeleteAll();
    playerNameField = DEFAULT_PLAYER_NAME;
  }

  private void CreatePlayerGUI() {
      string createMessage = "Please, insert your username below and click on Create User";
    GUILayout.Label(createMessage);
  
      playerNameField = GUILayout.TextField(playerNameField, 25);
  
      bool createUserButtonClicked= GUILayout.Button("Create User");
    
    if( createUserButtonClicked ){
      Player.username = playerNameField;
      Player.score = 0;
    }
  }
}</pre></div></li><li><p>Replace <a id="id515" class="indexterm"></a>the<a id="id516" class="indexterm"></a> contents<a id="id517" class="indexterm"></a> of the <code class="literal">SphereClick</code> C# script with the following code:</p><div class="informalexample"><pre class="programlisting">// file: SphereClick.cs
using UnityEngine;
using System.Collections;

public class SphereClick : MonoBehaviour
{
  private void OnGUI(){
    GUILayout.Label( "Score: " + Player.score );
  }
  
  private void OnMouseDown() {
    if( gameObject.CompareTag("blue") )
      Player.score += 50;
     
    Destroy(gameObject);
    GotoNextLevel();
  }
  
  private void GotoNextLevel() {
    int level = Application.loadedLevel + 1;
    Application.LoadLevel(level);
  }
}</pre></div></li><li><p>Replace<a id="id518" class="indexterm"></a> the <code class="literal">OnGUI()</code> method <a id="id519" class="indexterm"></a>of the <code class="literal">MenuEnd</code> C# script with the following code:</p><div class="informalexample"><pre class="programlisting">private void OnGUI() {
  GUILayout.Label("Congratulations " + Player.username);
  GUILayout.Label("You have finished the game, score = " + Player.score);

  bool mainMenuButtonClicked = GUILayout.Button("Main Menu");
  if( mainMenuButtonClicked )
           Application.LoadLevel(0);
  }</pre></div></li><li><p>Save your scripts and play the game. As you progress from level (scene) to level, you should find that the score and player's name are "remembered" until you quit the application.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec265"></a>How it works...</h3></div></div></div><p>The <code class="literal">Player</code> class<a id="id520" class="indexterm"></a> uses static (class) properties <code class="literal">username</code> and <code class="literal">score</code> to store the current player's name and score. Since these are public static properties, any object from any scene can access these values (static properties are "remembered" from scene to scene). This class also provides the <code class="literal">DeleteAll()</code> public static method that resets <code class="literal">username</code> to <code class="literal">null</code> and <code class="literal">score</code> to <code class="literal">-1</code>.</p><p>The <code class="literal">MenuStart</code> class tests the value of <code class="literal">Player.username</code>. If it is <code class="literal">null</code>, then a textbox and button are provided to allow the user to enter a new username; which is then stored in <code class="literal">Player.username</code>. Once the value in <code class="literal">Player.username</code> is no longer <code class="literal">null</code>, the user is offered a button to start playing the game, or to erase the username and any score currently stored in <code class="literal">Player</code> class.</p><p>The three game-playing<a id="id521" class="indexterm"></a> scenes now include a <code class="literal">GUI</code> method to display the current value in the <code class="literal">Player.score</code> property, which has <code class="literal">50</code> added to it each time a sphere tagged <code class="literal">blue</code> is clicked.</p><p>The <code class="literal">MenuEnd</code> class congratulates the player by name (retrieving the name from <code class="literal">Player.username</code>), and tells them their score (from <code class="literal">Player.score</code>).</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec266"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Saving and loading player data – using PlayerPrefs</em></span> recipe.</p></li></ul></div></div></div>