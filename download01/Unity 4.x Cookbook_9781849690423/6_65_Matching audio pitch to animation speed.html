<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec66"></a>Matching audio pitch to animation speed</h2></div></div><hr /></div><p>Many <a id="id429" class="indexterm"></a>artifacts sound higher in pitch when <a id="id430" class="indexterm"></a>accelerated and lower when slowed down. Car engines, fan coolers, a Vinyl record player... the list goes on. If you want to simulate this kind of sound effect in an animated object that can have its speed changed dynamically, follow this recipe.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec224"></a>Getting ready</h3></div></div></div><p>For this recipe, you'll need an animated 3D object and an audio clip. Please use the <code class="literal">carousel.fbx</code> and <code class="literal">carouselSound.wav</code> files, available in the <code class="literal">0423_06_01</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec225"></a>How to do it...</h3></div></div></div><p>To change the pitch of an <a id="id431" class="indexterm"></a>audio clip according to the speed of an <a id="id432" class="indexterm"></a>animated object, please follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">carousel.fbx</code> file into your Unity project.</p></li><li><p>Select the <code class="literal">carousel.fbx</code> file in the <span class="strong"><strong>Project</strong></span> view. Then, in the <span class="strong"><strong>Inspector</strong></span> view, check its <span class="strong"><strong>Import Settings</strong></span>. Under <span class="strong"><strong>Animations</strong></span>, select the <span class="strong"><strong>Take 001</strong></span> clip and make sure to check the <span class="strong"><strong>Loop Pose</strong></span> option. Click the <span class="strong"><strong>Apply</strong></span> button to save changes:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_06_01.jpg" /></div></li><li><p>Add the carousel to the scene by dragging it from the <span class="strong"><strong>Project</strong></span> view into the <span class="strong"><strong>Hierarchy</strong></span> view.</p></li><li><p>Add a <span class="strong"><strong>Directional Light</strong></span> to the scene through the <span class="strong"><strong>Create</strong></span> drop-down menu on top of the <span class="strong"><strong>Hierarchy</strong></span> view.</p></li><li><p>Import the <code class="literal">carouselSound.wav</code> audio clip file.</p></li><li><p>Select the <span class="strong"><strong>carousel</strong></span> game object and drag <span class="strong"><strong>carouselSound</strong></span> from the <span class="strong"><strong>Project</strong></span> view into the <span class="strong"><strong>Inspector</strong></span> view, adding it as an audio source for that object.</p></li><li><p>In the <span class="strong"><strong>Audio Source</strong></span> <a id="id433" class="indexterm"></a>component of the <a id="id434" class="indexterm"></a>carousel, check the box for the <span class="strong"><strong>Loop</strong></span> option:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_06_02.jpg" /></div></li><li><p>We need to create a controller for our object. In the <span class="strong"><strong>Project</strong></span> view, click the <span class="strong"><strong>Create</strong></span> button and select <span class="strong"><strong>Animator Controller</strong></span>. Name it <code class="literal">CarouselController</code>.</p></li><li><p>Double click <span class="strong"><strong>CarouselController</strong></span> to open the <span class="strong"><strong>Animator</strong></span> view. Then, right-click the gridded area and select <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span> from the contextual menu:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_06_03.jpg" /></div></li><li><p>Name the<a id="id435" class="indexterm"></a> new state <span class="strong"><strong>spin</strong></span> and set <span class="strong"><strong>Take 001</strong></span> <a id="id436" class="indexterm"></a>as its motion in the <span class="strong"><strong>Motion</strong></span> field:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_06_04.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, select the carousel. Then, in the <span class="strong"><strong>Animator</strong></span> component (in the <span class="strong"><strong>Inspector</strong></span> view), set <span class="strong"><strong>CarouselAnimator</strong></span> as its <span class="strong"><strong>Controller</strong></span> and uncheck the <span class="strong"><strong>Apply Root Motion</strong></span> option:</p><div class="mediaobject"><img src="/graphics/9781849690423/graphics/0423_06_05.jpg" /></div></li><li><p>In the <a id="id437" class="indexterm"></a>
<span class="strong"><strong>Project</strong></span> window, create a new <a id="id438" class="indexterm"></a>C# script and rename it as <code class="literal">ChangePitch</code>.</p></li><li><p>Open the script in your editor and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class ChangePitch : MonoBehaviour{
   public float speed = 0.0f;
   public float minSpeed = 0.0f;
   public float maxSpeed = 2.0f;
   public float animationSoundRatio = 1.0f;
   private Animator animator;
 void Start(){
     animator =  GetComponent&lt;Animator&gt;();
 } 
    void Update(){
        animator.speed = speed;
        audio.pitch = speed * animationSoundRatio;
    }
    void OnGUI(){
        Rect rect = new Rect(10, 10, 100, 30);
        speed = GUI.HorizontalSlider(rect, speed, minSpeed, maxSpeed);
    }
}</pre></div></li><li><p>Save your script and add it as a component to the carousel.</p></li><li><p>Play the scene and change the animation speed, along with the audio pitch, using the slidebar.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec226"></a>How it works...</h3></div></div></div><p>The idea <a id="id439" class="indexterm"></a>behind the script and its <a id="id440" class="indexterm"></a>implementation are actually quite straightforward. It creates a slidebar from which the user can change the speed of the animator component. Then, it updates the audio pitch based on that number.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec227"></a>There's more...</h3></div></div></div><p>Here is some information on how to fine-tune and customize this recipe.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec51"></a>Changing the Animation / Sound Ratio parameter</h4></div></div></div><p>If you want the audio <a id="id441" class="indexterm"></a>clip pitch to be either more or less affected by the animation speed, change the value of the <span class="strong"><strong>Animation / Sound Ratio</strong></span> parameter.</p></div></div></div>