<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec57"></a>Moving the player</h2></div></div><hr /></div><p>The blue sphere represents<a id="id683" class="indexterm"></a> our player. We would like it to move when the ground—or an interactive element—is clicked on. The <code class="literal">PlayerController.cs</code> script attached to the <code class="literal">Player</code> GameObject already has a method to handle movement: <code class="literal">SetDestination()</code>.</p><p>We can use NGUI events to catch the <code class="literal">OnPress()</code> event on our ground and interactive elements and call the player's <code class="literal">SetDestination()</code> method to reach the clicked position.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec107"></a>Ground movement</h3></div></div></div><p>The <code class="literal">ApproachOnClick.cs</code> script included in the package we downloaded will help us with this. It simply has to be <a id="id684" class="indexterm"></a>added to any object that needs to be approached on left-click. Here's how you can accomplish this task:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> view, select <code class="literal">Assets/Resources/Prefabs/Ground</code>.</p></li><li><p>Click on the <span class="strong"><strong>Add Component</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> view.</p></li><li><p>Type in <code class="literal">app</code> to search for components with that name.</p></li><li><p>Select <span class="strong"><strong>Approach On Click</strong></span> and hit <span class="emphasis"><em>Enter</em></span> or click on it with your mouse.</p></li><li><p>Right-click on the newly added component's name.</p></li><li><p>Click on <span class="strong"><strong>Edit Script</strong></span> to open it.</p></li></ol></div><p>Once the script is open, you'll see that it already contains basic variables and methods. Add the following <code class="literal">OnPress()</code> method to handle player movement on left mouse release:</p><div class="informalexample"><pre class="programlisting">// If a Press event occurs on this object
<span class="strong"><strong>void OnPress(bool pressed)</strong></span>
{
  // If the object is pressed
  if(pressed)
  {
    // If it's a left click, it's a valid movement request
<span class="strong"><strong>    validMoveRequest = (UICamera.currentTouchID == -1);</strong></span>
  }
  // If the object is released
  else
  {
    // If the movement request is still valid 
    if(validMoveRequest)
    {
      // Set destination to the object's pivot
<span class="strong"><strong>      Vector3 destination = transform.position;</strong></span>
      
      // If the precise bool is checked...
      if(precise)
      {
        // ...Set destination to clicked position
<span class="strong"><strong>        destination = UICamera.lastWorldPosition;</strong></span>
      }
      
      // Request player to move with stopping distance
<span class="strong"><strong>      PlayerController.Instance.SetDestination(</strong></span>
<span class="strong"><strong>        gameObject, destination, stoppingDistance);</strong></span>
    }
  }
}</pre></div><p>Save the script and <a id="id685" class="indexterm"></a>go back to Unity. We need to configure the ground slightly, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select <code class="literal">Assets/Resources/Prefabs/Ground</code>.</p></li><li><p>For its attached <code class="literal">Approach On Click</code> component:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Check the <span class="strong"><strong>Precise</strong></span> option.</p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Stopping Distance</strong></span> to <code class="literal">0.5</code>.</p></li></ul></div></li><li><p>Click on the <span class="strong"><strong>Add Component</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> view.</p></li><li><p>Type in <code class="literal">box</code> with your keyboard.</p></li><li><p>Select <span class="strong"><strong>Box Collider</strong></span> and hit <span class="emphasis"><em>Enter</em></span> or click on it with your mouse.</p></li><li><p>Set its <span class="strong"><strong>Size</strong></span> to {<code class="literal">10</code>, <code class="literal">0.1</code>, <code class="literal">10</code>}.</p></li></ol></div><p>OK. We have now configured the <code class="literal">ApproachOnClick</code> component and its attached <span class="strong"><strong>Box Collider</strong></span> to catch events.</p><p>Hit Unity's play button. When you click on the ground, the player moves precisely to the clicked position, stopping at 0.5 units from the requested position.</p><p>This is because, in<a id="id686" class="indexterm"></a> the preceding code, if <code class="literal">precise</code> is set to <code class="literal">true</code> (which is the case for the <code class="literal">Ground</code> prefab), we set <code class="literal">UICamera.lastWorldPosition</code> as the destination.</p><p>Right now, if you click on an interactive element, such as a power source, the player does not try to reach it; that's simply because the object is on top of the ground and doesn't have the <code class="literal">ApproachOnClick</code> component. We can correct this now.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec108"></a>Reaching an object</h3></div></div></div><p>Now that the ground movement is done, let's handle the click on an interactive element. If the player clicks on a power <a id="id687" class="indexterm"></a>source, for example, we want the player to reach the object.</p><p>We'll achieve this by moving the player to the clicked object's pivot point, with a higher stopping distance than with the ground. In the <span class="strong"><strong>Project</strong></span> view, select both the <code class="literal">Resources/Prefabs/PowerSource</code> and <code class="literal">PowerFeed</code> prefabs:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <span class="strong"><strong>Add Component</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> view.</p></li><li><p>Type in <code class="literal">app</code> with your keyboard.</p></li><li><p>Select <span class="strong"><strong>Approach On Click</strong></span> and hit <span class="emphasis"><em>Enter</em></span> or click on it with your mouse.</p></li></ol></div><p>If you click on an interactive element that does not have the precise Boolean checked, the destination is set to the object's pivot point with the configured stopping distance.</p><p>The default values are suitable for the large power source's prefabs. Let's configure a smaller stopping distance for the power feeds since they are smaller objects:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> view, select <code class="literal">Resources/Prefabs/PowerFeed</code>.</p></li><li><p>Change <span class="strong"><strong>Stopping Distance</strong></span> of <span class="strong"><strong>Approach On Click</strong></span> to <code class="literal">2</code>.</p></li></ol></div><p>Now, hit Unity's play button. If you click on a power source or feed, the player moves towards it and stops at a reasonable distance to avoid hitting it.</p><p>We have a slight problem: if we drag a power source, the player moves towards it when it's dropped as if we clicked on it.</p><p>That occurs because we set the destination when the <code class="literal">OnPress(false)</code> event is triggered on the power source. We must cancel the movement if a drag occurs.</p><p>Open our <code class="literal">ApproachOnClick.cs</code> script, and add this <code class="literal">OnDrag()</code> method to it:</p><div class="informalexample"><pre class="programlisting">// If a drag event occurs on this object
<span class="strong"><strong>public void OnDrag(Vector2 delta)</strong></span>
{
  // If the object is draggable...
<span class="strong"><strong>  if(isDraggable)</strong></span>
  {
    // ...The object moves. Mark as invalid movement request
<span class="strong"><strong>    validMoveRequest = false;</strong></span>
  }
}</pre></div><p>Hit Unity's play<a id="id688" class="indexterm"></a> button. That's it. If you move a power source, the player is no longer moving towards it on release!</p><p>That's because, in the preceding code, as soon as the object is dragged, <code class="literal">validMoveRequest</code> is set to <code class="literal">false</code>, canceling the move request.</p><p>OK, now that we've seen how to catch <code class="literal">OnPress()</code> and <code class="literal">OnDrag()</code> events to move our character and make draggable objects, we can display the player's name above the character.</p></div></div>