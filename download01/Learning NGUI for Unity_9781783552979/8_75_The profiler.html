<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec74"></a>The profiler</h2></div></div><hr /></div><p>The <span class="strong"><strong>profiler</strong></span> is a Unity Pro feature. It's a great <a id="id913" class="indexterm"></a>help when optimizing your game. It can report the amount of time spent for rendering, animating, or code processing.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec141"></a>Functionalities</h3></div></div></div><p>Open the profiler <a id="id914" class="indexterm"></a>window by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Profiler</strong></span>. The following window appears (yours will be empty):</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_08_12.jpg" /><div class="caption"><p>Profiler window while in play mode</p></div></div><p>Here's an explanation <a id="id915" class="indexterm"></a>of the most important functions of the <span class="strong"><strong>Profiler</strong></span> window:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>
<span class="strong"><strong>Record</strong></span>: This enables or disables frame data recording.</p></li><li><p>
<span class="strong"><strong>Deep Profile</strong></span>: This records information for all scripts, giving your more script details for each frame. With it enabled, you'll have a deeper hierarchy of analyzed elements and know which method took how much of the processing time. Enabling it at runtime will prompt the game to restartâ€”it's recommended that you enable or disable this feature while the game isn't running.</p></li><li><p>
<span class="strong"><strong>Profile Editor</strong></span>: Enabling this will let the profiler run even out of play mode.</p></li><li><p>
<span class="strong"><strong>Active Profiler</strong></span>: This displays the profiler for either the editor or the connected device.</p></li><li><p>
<span class="strong"><strong>Clear</strong></span>: This clears all profiler data to have an empty window.</p></li><li><p>
<span class="strong"><strong>Frame</strong></span>: This shows the current frame number / total recorded frames.</p></li><li><p>
<span class="strong"><strong>Current</strong></span>: Click here to record the current frame and display information about it (real-time profiling).</p></li><li><p>
<span class="strong"><strong>CPU Usage</strong></span>: Here, you have the hardware category and color legend. This is currently viewing <span class="strong"><strong>CPU Usage</strong></span>. Scroll down to see other categories (GPU, rendering, audio, and so on).</p></li><li><p>
<span class="strong"><strong>Timeline</strong></span>: In this view, the rendering time of each frame is represented. The higher the time is, the slower your game is running. The goal is to avoid having too many spikes and irregularities. Click anywhere here to set the <span class="strong"><strong>frame cursor</strong></span> (10) and analyze the<a id="id916" class="indexterm"></a> specified frame.</p></li><li><p>
<span class="strong"><strong>Frame cursor</strong></span>: This shows the selected frame cursor.</p></li><li><p>
<span class="strong"><strong>Overview</strong></span>: This gives an overview of the currently selected frame by the cursor (10). You'll find here the different instructions that were executed at that frame. You can sort them by the amount of time they took to be processed or draw calls they requested by clicking on the table headings.</p></li><li><p>
<span class="strong"><strong>Details</strong></span>: This window displays more information about the selected thread in <span class="strong"><strong>Overview</strong></span> (11). You can see here the thread's nested instructions and know precisely how they<a id="id917" class="indexterm"></a> impacted the processing time and draw call they requested.</p></li></ol></div><p>The profiler records each frame's data and displays it as a timeline. You can view this recorded data separately for each frame by clicking anywhere in the timeline (9).</p><p>You should try to optimize your code, assets, scenes, and shaders to avoid having high time values. You should also avoid spikes like this one:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_08_13.jpg" /><div class="caption"><p>The preceding spike shows that the corresponding frame took twice as long (66 ms) to render than the others (33 ms)</p></div></div><p>The spike in the preceding screenshot means that your frame took longer than the others to render, leading to a frame-rate drop. By clicking on it, you'll retrieve information about which instructions took longer to process. By doing so, you'll gradually track down the different sources of your frame-rate drop.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec142"></a>Run the profiler on device</h3></div></div></div><p>Currently, the profiler is set<a id="id918" class="indexterm"></a> up to record information from Unity Editor and not the device. It is possible to record data directly from the device while it's running the build, but we have a slight setup procedure for the very first time.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note47"></a>Note</h3><p>If you are using a firewall, you should open its ports from 54,998 to 55,511 for the outbound rules.</p></div><p>Connect your Android device to your computer now. First, we'll check whether the device is detected by the <a id="id919" class="indexterm"></a>
<span class="strong"><strong>Android Debug Bridge</strong></span> (<span class="strong"><strong>ADB</strong></span>):</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Hit the Windows key +<span class="emphasis"><em> R</em></span> to open the <span class="strong"><strong>Execute</strong></span> window (or launch the <span class="strong"><strong>Terminal</strong></span> on Mac<a id="id920" class="indexterm"></a> and move directly to step 3).</p></li><li><p>Type <code class="literal">cmd</code> in the new window and hit <span class="emphasis"><em>Enter</em></span> or click on the <span class="strong"><strong>Ok</strong></span> button.</p></li><li><p>In the newly opened command window, type <code class="literal">cd</code> followed by your Android SDK's <code class="literal">platform-tools</code> folder location and hit <span class="emphasis"><em>Enter</em></span>. For example, in my case it is:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>cd C:\SDK\platform-tools</strong></span>
</pre></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip22"></a>Tip</h3><p>If your Android SDK isn't on the <code class="literal">C:</code> drive, you must request to change the current drive by entering the new drive letter followed by the <code class="literal">:</code> character. For example, if your SDK is on the <code class="literal">D:</code> drive, you have to first enter:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>d:</strong></span>
</pre></div><p>Only then can you point to your SDK folder.</p></div></li><li><p>Now, type <code class="literal">adb devices</code> and hit <span class="emphasis"><em>Enter</em></span> to display the detected device list. You should have at least one device listed, which should be similar to this:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>List of devices attached</strong></span>
<span class="strong"><strong>R32D103DCQA      device</strong></span>
</pre></div></li></ol></div><p>If your device list is empty, reconnect your device and try again. If it's still not detected, restart your computer. If it doesn't show in the list after a restart, reinstall your device's USB drivers and check your cable; some USB cables can only recharge your device but do not allow data transfers.</p><p>Once you have your device displayed in the device list, follow these steps to set up the profiler on the Android device:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Navigate to the <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build Settings</strong></span> window.</p></li><li><p>Check the <span class="strong"><strong>Development Build</strong></span> option.</p></li><li><p>Click on the <span class="strong"><strong>Build And Run</strong></span> button and select a location for the <code class="literal">.apk</code> file.</p></li></ol></div><p>Ok. When Unity has finished building and pushing the package to the device, open the profiler by navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Profiler</strong></span>.</p><p>Now, we must request to<a id="id921" class="indexterm"></a> display the connected device's profiler data:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_08_14.jpg" /></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <span class="strong"><strong>Active Profiler</strong></span> (<span class="strong"><strong>1</strong></span>) button in the <span class="strong"><strong>Profiler</strong></span> window.</p></li><li><p>Select your Android device in the list (<span class="strong"><strong>2</strong></span>).</p></li></ol></div><p>And that's it! You can now analyze the data fetched from the connected device. You can see that the <span class="strong"><strong>GPU Usage</strong></span> category in the profiler is empty; this is simply because GPU profiling isn't supported on mobile devices.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip24"></a>Tip</h3><p>You can now <a id="id922" class="indexterm"></a>enable Wi-Fi profiling by following the instructions at <a class="ulink" href="http://docs.unity3d.com/Manual/Profiler.html" target="_blank">http://docs.unity3d.com/Manual/Profiler.html</a>.</p></div></div></div>