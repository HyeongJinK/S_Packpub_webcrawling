<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec58"></a>Player name display</h2></div></div><hr /></div><p>Let's see<a id="id689" class="indexterm"></a> how to display the player's stored name above the character. It will look like this:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_06_02.jpg" /><div class="caption"><p>Player name displayed above character</p></div></div><p>In order to display<a id="id690" class="indexterm"></a> this name label, we'll need to configure the 2D <code class="literal">UI Root</code> element that will only render 2D UI elements and make sure it follows the player.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec109"></a>In-game 2D UI root</h3></div></div></div><p>We'll now add some in-game 2D user interface elements attached to 3D world objects. Let's create a new 2D UI root<a id="id691" class="indexterm"></a> element that will be<a id="id692" class="indexterm"></a> used exclusively for in-game 2D UI:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <code class="literal">2D UI</code> element by navigating to <span class="strong"><strong>NGUI</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>2D UI</strong></span>.</p></li><li><p>Select the new <code class="literal">UI Root (2D)</code> GameObject in the hierarchy.</p></li><li><p>Rename it to <code class="literal">InGame2DUI</code>.</p></li><li><p>For its attached <code class="literal">UIRoot</code> component:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Change <span class="strong"><strong>Scaling Style</strong></span> to <span class="strong"><strong>Constrained</strong></span>
<code class="literal">.</code>
</p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Content Width</strong></span> to <code class="literal">1920</code>.</p></li><li style="list-style-type: disc"><p>Set <span class="strong"><strong>Content Height</strong></span> to <code class="literal">1080</code>.</p></li><li style="list-style-type: disc"><p>Leave its height's <span class="strong"><strong>Fit</strong></span> option checked.</p></li></ul></div></li></ol></div><p>Now, let's create a new layer to hold all <code class="literal">2D UI</code> elements:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Navigate to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Tags and Layers</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip16"></a>Tip</h3><p>You can also click on the <span class="strong"><strong>Layers</strong></span> drop-down list in the top-right corner of the Unity window and click on <span class="strong"><strong>Edit Layers</strong></span>.</p></div></li><li><p>Next to <span class="strong"><strong>User Layer 9</strong></span>, enter <code class="literal">InGame2DUI</code> in the field.</p></li><li><p>Select our <code class="literal">InGame2DUI</code> GameObject.</p></li><li><p>Switch its layer to <span class="strong"><strong>InGame2DUI</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note37"></a>Note</h3><p>Unity will display a pop up asking you whether you want to change the layer for all child objects. Click on the <span class="strong"><strong>Yes, change children</strong></span> button.</p></div></li></ol></div><p>Now that we've set <a id="id693" class="indexterm"></a>our <code class="literal">InGame2DUI</code> GameObject in the <code class="literal">InGame2DUI</code> layer, we need to make sure this layer is<a id="id694" class="indexterm"></a> rendered by the user interface camera:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">InGame2DUI</code> | <code class="literal">Camera</code> GameObject.</p></li><li><p>For its attached <code class="literal">Camera</code> component:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Change <span class="strong"><strong>Culling Mask</strong></span> to display <span class="strong"><strong>InGame2DUI</strong></span> only.</p></li></ul></div></li></ol></div><p>OK, we're ready to display 2D widgets attached to 3D world objects! We can now create our player name widget.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec110"></a>The nickname prefab</h3></div></div></div><p>Let's create the <a id="id695" class="indexterm"></a>prefab to display our<a id="id696" class="indexterm"></a> player's nickname:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">InGame2DUI</code> GameObject.</p></li><li><p>Create a new child GameObject with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>N</em></span>.</p></li><li><p>Rename this new child to <code class="literal">Nickname</code>.</p></li><li><p>Select <code class="literal">InGame2DUI</code> | <code class="literal">Nickname</code></p></li><li><p>Create a new label with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>L</em></span>.</p></li></ol></div><p>OK, now let's configure <code class="literal">Nickname</code> | <code class="literal">Label</code>, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Set its font type to <span class="strong"><strong>NGUI</strong></span> (bitmap) and not <span class="strong"><strong>Unity</strong></span> (dynamic).</p></li><li><p>Change <span class="strong"><strong>Font</strong></span> to <span class="strong"><strong>Arimo20</strong></span>, with <span class="strong"><strong>Font Size</strong></span> of 40.</p></li><li><p>Change <span class="strong"><strong>Text</strong></span> to <code class="literal">PlayerName</code>
</p></li><li><p>Set the <span class="strong"><strong>Overflow</strong></span> parameter to <span class="strong"><strong>ResizeFreely</strong></span>.</p></li><li><p>Change <span class="strong"><strong>Color Tint</strong></span> to {R: <code class="literal">255</code>, G: <code class="literal">230</code>, B: <code class="literal">130</code>, A: <code class="literal">255</code>}.</p></li><li><p>Change <span class="strong"><strong>Depth</strong></span> to <code class="literal">1</code>.</p></li></ol></div><p>OK, we have a yellow label at the center of the <span class="strong"><strong>Game</strong></span> view. We can now create the background and <a id="id697" class="indexterm"></a>configure it to wrap this<a id="id698" class="indexterm"></a> label:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">InGame2DUI</code> | <code class="literal">Nickname</code> GameObject.</p></li><li><p>Create a new child sprite with <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>S</em></span>.</p></li><li><p>Change <span class="strong"><strong>Atlas</strong></span> to our <span class="strong"><strong>Game</strong></span> atlas.</p></li><li><p>Change <span class="strong"><strong>Sprite</strong></span> to the <span class="strong"><strong>Background_Button</strong></span> sprite.</p></li><li><p>Make sure <span class="strong"><strong>Type</strong></span> is set to <span class="strong"><strong>Sliced</strong></span>.</p></li><li><p>Set <span class="strong"><strong>Size</strong></span> to <code class="literal">255 x 60</code>.</p></li><li><p>Change <span class="strong"><strong>Color Tint</strong></span> to {R: <code class="literal">130</code>, G: <code class="literal">100</code>, B: <code class="literal">80</code>, A: <code class="literal">255</code>}.</p></li><li><p>Decrease <span class="strong"><strong>Depth</strong></span> to <code class="literal">0</code>.</p></li><li><p>Set <span class="strong"><strong>Anchors</strong></span> to <span class="strong"><strong>Unified</strong></span>.</p></li><li><p>Drag <code class="literal">Nickname</code> | <code class="literal">Label</code> in the <span class="strong"><strong>Target</strong></span> field.</p></li></ol></div><p>Good. You should now have a nickname display that looks like this:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_06_03.jpg" /></div><p>Now, we need to make sure it displays the player's stored nickname instead of <span class="strong"><strong>PlayerName</strong></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec111"></a>The PlayerName component</h3></div></div></div><p>In order to retrieve <a id="id699" class="indexterm"></a>and assign the player's nickname to the label, we'll create a custom <code class="literal">PlayerName.cs</code> script that we'll attach<a id="id700" class="indexterm"></a> to it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">InGame2DUI</code> | <code class="literal">Nickname</code> | <code class="literal">Label</code> GameObject.</p></li><li><p>Click on the <span class="strong"><strong>Add Component</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> view.</p></li><li><p>Type in <code class="literal">PlayerName</code> with your keyboard and hit <span class="emphasis"><em>Enter</em></span>.</p></li><li><p>Make sure <span class="strong"><strong>Language</strong></span> is set to <span class="strong"><strong>CSharp</strong></span>, and hit <span class="emphasis"><em>Enter </em></span>again.</p></li><li><p>Open the newly added <code class="literal">PlayerName.cs</code> script.</p></li></ol></div><p>Within this new <a id="id701" class="indexterm"></a>
<code class="literal">PlayerName.cs</code> script, replace the default methods with the following code</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>private void Start () {</strong></span>
  // Get the label
<span class="strong"><strong>  UILabel label = GetComponent&lt;UILabel&gt;();</strong></span>
  // Set its text to the saved PlayerPref
<span class="strong"><strong>  label.text = PlayerPrefs.GetString("PlayerName");</strong></span>
}</pre></div><p>Save the script and return to Unity. Hit Unity's play button, and you'll see that our nickname display changes to the player's entered nickname!</p><p>In our main menu, the nickname's input field has the <span class="strong"><strong>Save as</strong></span> parameter set to <code class="literal">PlayerName</code>, which means that the entered text is saved as a <code class="literal">string</code> in <code class="literal">PlayerPrefs</code> as the <code class="literal">PlayerName</code> key.</p><p>In the preceding code, we retrieve that player name <code class="literal">string</code> from <code class="literal">PlayerPrefs</code> by executing the <code class="literal">PlayerPrefs.GetString()</code> method with the <code class="literal">PlayerName</code> key.</p><p>Now, let's see how we can make that player name widget follow our character.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec112"></a>The FollowObject component</h3></div></div></div><p>For our nickname<a id="id702" class="indexterm"></a> display to follow<a id="id703" class="indexterm"></a> the player, we'll create a new <code class="literal">FollowObject.cs</code> script that will be attached to it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">InGame2DUI</code> | <code class="literal">Nickname</code> GameObject.</p></li><li><p>Click on the <span class="strong"><strong>Add Component</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> view.</p></li><li><p>Type in <code class="literal">FollowObject</code> with your keyboard and hit <span class="emphasis"><em>Enter</em></span>.</p></li><li><p>Make sure <span class="strong"><strong>Language</strong></span> is set to <span class="strong"><strong>CSharp</strong></span>, and hit <span class="emphasis"><em>Enter</em></span> again.</p></li><li><p>Open the newly added <code class="literal">FollowObject.cs</code> script.</p></li></ol></div><p>Within this new <code class="literal">FollowObject.cs</code> script, add these necessary variable declarations:</p><div class="informalexample"><pre class="programlisting">// The target you want to follow
<span class="strong"><strong>public Transform target;</strong></span>
// The final offset to apply
<span class="strong"><strong>public Vector3 offset;</strong></span>
// The main camera that views the object to follow
<span class="strong"><strong>public Camera mainCamera;</strong></span>
// The orthographic camera that renders the widget 
<span class="strong"><strong>public Camera uiCamera; </strong></span>
</pre></div><p>Save the script and<a id="id704" class="indexterm"></a> return to Unity. We'll assign these variables right now before we add more code:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">InGame2DUI</code> | <code class="literal">Nickname</code> GameObject.</p></li><li><p>Drag our <code class="literal">Player</code> GameObject in the <span class="strong"><strong>Target</strong></span> field.</p></li><li><p>Set <span class="strong"><strong>Offset</strong></span> to {<code class="literal">0</code>, <code class="literal">0.15</code>, <code class="literal">0</code>}.</p></li><li><p>Drag <code class="literal">GameCamera</code> in the <span class="strong"><strong>Main Camera</strong></span> field.</p></li><li><p>Drag <code class="literal">InGame2DUI</code> | <code class="literal">Camera</code> in the <span class="strong"><strong>UI Camera</strong></span> field.</p></li></ol></div><p>OK, now that we've <a id="id705" class="indexterm"></a>configured our <code class="literal">FollowObject</code> component, open the <code class="literal">FollowObject.cs</code> script and replace the default empty <code class="literal">Update()</code> method with the following one to update the widget's position:</p><div class="informalexample"><pre class="programlisting">// At each frame, update the widget's position
<span class="strong"><strong>void Update()</strong></span>
{
if(target != null)
  {
// Transpose target pos in maincam's screen coordinates
<span class="strong"><strong>Vector3 finalPos = </strong></span>
<span class="strong"><strong>mainCamera.WorldToScreenPoint(target.position);</strong></span>
// Now, transpose it in UI camera's world
<span class="strong"><strong>finalPos = uiCamera.ScreenToWorldPoint(finalPos);</strong></span>
// It's an orthographic camera, Z axis is no use here
<span class="strong"><strong>finalPos = new Vector3(finalPos.x, finalPos.y,</strong></span> <span class="strong"><strong>0);</strong></span>
// Apply the final position to target, with offset
<span class="strong"><strong>transform.position = finalPos + offset;</strong></span>
}
} </pre></div><p>In the preceding code, we first transpose the player's coordinates into screen coordinates from the main camera, and then we transpose it back into the UI camera's world coordinates.</p><p>Finally, we apply the calculated position to the object along with the required offset. By doing so, we might use<a id="id706" class="indexterm"></a> this component to display UI elements next to 3D world objects with a defined X, Y, or Z offset; here, the coordinates are {<code class="literal">0</code>, <code class="literal">0.15</code>, <code class="literal">0</code>} so that the nickname is displayed above the character.</p><p>Save the script and go back to Unity. Hit Unity's play button. Now, when our player moves, his nickname stays over his head, thanks to the Y offset of 0.15!</p><p>OK, now let's create<a id="id707" class="indexterm"></a> a user interface system to change the elemental source's type.</p></div></div>