<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec81"></a>Switching atlases</h2></div></div><hr /></div><p>Now<a id="id989" class="indexterm"></a> that our multiple atlases are ready with different qualities, we can write the code to switch between them at runtime. In order to achieve this, we will create a new <code class="literal">AtlasSwitchController</code> component, attached to our scene's <code class="literal">UI Root</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec150"></a>The AtlasSwitchController component</h3></div></div></div><p>Follow <a id="id990" class="indexterm"></a>these steps to create the new<a id="id991" class="indexterm"></a> <code class="literal">AtlasSwitchController</code> component:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select our <code class="literal">UI Root</code> GameObject.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, click on the <span class="strong"><strong>Add Component</strong></span> button.</p></li><li><p>Type in <code class="literal">AtlasSwitchController</code> and hit the <span class="emphasis"><em>Enter</em></span> key.</p></li><li><p>Make sure that <span class="strong"><strong>Language</strong></span> is set to <span class="strong"><strong>CSharp</strong></span> and hit <span class="emphasis"><em>Enter</em></span> again.</p></li></ol></div><p>Open our new <code class="literal">AtlasSwitchController.cs</code> script, and declare these global variables:</p><div class="informalexample"><pre class="programlisting">// The reference atlas
<span class="strong"><strong>public UIAtlas referenceAtlas;</strong></span>

// Screen width thresholds
<span class="strong"><strong>public int HDFromWidth = 800;</strong></span>
<span class="strong"><strong>public int SHDFromWidth = 1600;</strong></span>

// Atlases for all qualities
<span class="strong"><strong>public UIAtlas SDAtlas;</strong></span>
<span class="strong"><strong>public UIAtlas HDAtlas;</strong></span>
<span class="strong"><strong>public UIAtlas SHDAtlas;</strong></span>

// This will store the replacement atlas
<span class="strong"><strong>private UIAtlas replacementAtlas;</strong></span>
</pre></div><p>Now, add<a id="id992" class="indexterm"></a> the following <code class="literal">Awake()</code> method<a id="id993" class="indexterm"></a> that will switch atlases:</p><div class="informalexample"><pre class="programlisting">// Before anything happens
<span class="strong"><strong>void Awake ()</strong></span>
{
  // Retrieve the screen's width
<span class="strong"><strong>  int screenWidth = Screen.width;</strong></span>

  // Set replacementAtlas to SDAtlas by default
<span class="strong"><strong>  replacementAtlas = SDAtlas;</strong></span>

  // If the screen width exceeds SHD threshold
<span class="strong"><strong>  if(screenWidth &gt;= SHDFromWidth)</strong></span>
  {
    // Set the SHDAtlas as replacement
<span class="strong"><strong>    replacementAtlas = SHDAtlas;</strong></span>
  }
  // If the screen width exceeds HD threshold
<span class="strong"><strong>  else if(screenWidth &gt;= HDFromWidth)</strong></span>
  {
    // Set the HDAtlas as replacement
<span class="strong"><strong>    replacementAtlas = HDAtlas;</strong></span>
  }

  // Update the referenceAtlas with the replacement
<span class="strong"><strong>  referenceAtlas.replacement = replacementAtlas;</strong></span>
}</pre></div><p>Save the <a id="id994" class="indexterm"></a>script. The preceding <a id="id995" class="indexterm"></a>code first retrieves the screen's width and height. It then loads the corresponding atlas if the screen's width exceeds <code class="literal">HDFromWidth</code> and/or <code class="literal">SHDFromWidth</code> threshold values.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec151"></a>Configuration</h3></div></div></div><p>Okay, we <a id="id996" class="indexterm"></a>have the code to switch atlases. Go back to Unity, select our <code class="literal">UI Root</code> GameObject, and configure its <code class="literal">AtlasSwitchController</code> component, as follows:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_09_17.jpg" /></div><p>Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag <code class="literal">Assets/Resources/Atlas/ScreenAtlas</code> as <span class="strong"><strong>Reference Atlas</strong></span>.</p></li><li><p>Set <span class="strong"><strong>HDFrom Width</strong></span> to <code class="literal">800</code> and <span class="strong"><strong>SHDFromWidth</strong></span> to <code class="literal">1600</code>.</p></li><li><p>Drag the correct atlases in the fields: <span class="strong"><strong>SDAtlas</strong></span>, <span class="strong"><strong>HDAtlas</strong></span>, and <span class="strong"><strong>SHDAtlas</strong></span>.</p></li></ol></div><p>The preceding configuration results in the following behavior:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Screen width below 800 pixels: <code class="literal">SDAtlas</code> is used</p></li><li style="list-style-type: disc"><p>Screen width over 800 and below 1600 pixels: The script switches to <code class="literal">HDAtlas</code>
</p></li><li style="list-style-type: disc"><p>Screen width over 1600 pixels: <code class="literal">ScreenAtlas</code> points to <code class="literal">SHDAtlas</code>
</p></li></ul></div><p>Good. Let's try this out. Make sure that your Game view is maximized and its resolution setting is on <code class="literal">WVGA Landscape (800x480)</code>. Now, hit Unity's play button.</p><p>The button displays the 442 x 264 sprite from <code class="literal">HDAtlas</code>. Now, change the Game view's resolution to <code class="literal">HVGA Landscape (480x320)</code>, and hit Unity's play button.</p><p>You can notice that the button has been updated and now displays the 184 x 110 sprite! <code class="literal">SDAtlas</code> is now used.</p><p>Now, switch<a id="id997" class="indexterm"></a> the Game view's resolution <code class="literal">1920x1080</code> (you might need to add this one since it isn't a default preset), and hit Unity's play button again. You will now have the 588 x 351 sprite for the button.</p><p>Okay, so that means our three atlases are correctly switched depending on the screen's resolution. Great!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec152"></a>Pixel snapping</h3></div></div></div><p>The<a id="id998" class="indexterm"></a> current configuration works as intended: depending <a id="id999" class="indexterm"></a>on the screen's resolution, different sprites can be displayed.</p><p>However, if we want these sprites to always be as crisp as they can be, we should make them pixel-perfect once the correct atlas has been loaded. Making them pixel-perfect will display them at their actual original size.</p><p>In order to achieve this, open the <code class="literal">AtlasSwitchController.cs</code> script, and then add the following <code class="literal">MakeAllWidgetsPixelPerfect()</code> method:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>private void MakeAllWidgetsPixelPerfect()</strong></span>
{
  // Declare a widget array to store them
  UIWidget[] allWidgets;
  // Retrieve all widgets in scene
<span class="strong"><strong>  allWidgets = Object.FindObjectsOfType&lt;UIWidget&gt;();</strong></span>

  // For each of these widgets
  foreach(UIWidget widget in allWidgets)
  {
    // Make th widget pixel perfect
<span class="strong"><strong>    widget.MakePixelPerfect();</strong></span>
  }
}</pre></div><p>Now, add these lines at the very end of the <code class="literal">Awake()</code> method, just below the <code class="literal">referenceAtlas.replacement = replacementAtlas;</code> instruction:</p><div class="informalexample"><pre class="programlisting">// Make all widgets pixel perfect now
<span class="strong"><strong>MakeAllWidgetsPixelPerfect();</strong></span>
</pre></div><p>That's itâ€”we<a id="id1000" class="indexterm"></a> now make sure that all the widgets are<a id="id1001" class="indexterm"></a> pixel perfect just after the atlas has been changed. Now, if you hit Unity's play button, you'll notice that the sprite changes and is displayed at this original size.</p><p>We can now move on to see how we have a similar system for fonts.</p></div></div>