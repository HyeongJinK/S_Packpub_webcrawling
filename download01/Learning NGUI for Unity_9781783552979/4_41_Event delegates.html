<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec44"></a>Event delegates</h2></div></div><hr /></div><p>Many NGUI components broadcast events, for<a id="id511" class="indexterm"></a> which you can set an event delegate—also known as a callback method—executed when the event is triggered. We did it through the Inspector view by assigning the <span class="strong"><strong>Notify</strong></span> and <span class="strong"><strong>Method</strong></span> fields when buttons were clicked.</p><p>For any type<a id="id512" class="indexterm"></a> of tween, you can set a specific event delegate for when the tween is finished. We'll see how to do this through code. Before we continue, we must create our callback first. Let's create a callback that loads a new scene.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec83"></a>The callback</h3></div></div></div><p>Open our <code class="literal">MenuManager.cs</code> script, and<a id="id513" class="indexterm"></a> add this static <code class="literal">LoadGameScene()</code> callback method:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>public static void LoadGameScene()</strong></span>
{
//Load the Game scene now
Application.LoadLevel("Game");
}</pre></div><p>Save the script. The preceding code requests to load the <code class="literal">Game</code> scene. To ensure Unity finds our scenes at runtime, we'll need to create the <code class="literal">Game</code> scene and add both <code class="literal">Menu</code> and <code class="literal">Game</code> scenes to the build settings:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build Settings</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Add Current</strong></span> button (don't close the window now).</p></li><li><p>In Unity, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Scene</strong></span>.</p></li><li><p>Navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Save Scene as…</strong></span>
</p></li><li><p>Save the scene as <code class="literal">Game.unity</code>.</p></li><li><p>Click on the <span class="strong"><strong>Add Current</strong></span> button of the <span class="strong"><strong>Build Settings</strong></span> window and close it.</p></li><li><p>Navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open Scene</strong></span> and re-open our <code class="literal">Menu.unity</code> scene.</p></li></ol></div><p>Ok, now that both<a id="id514" class="indexterm"></a> scenes have been added to the build settings, we are ready to link our callback to our event.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec84"></a>Linking a callback to an event</h3></div></div></div><p>Now that our <code class="literal">LoadGameScene()</code> callback method is written, we must link it to our event. We have two solutions. First, we'll see how to assign it using<a id="id515" class="indexterm"></a> code exclusively, and<a id="id516" class="indexterm"></a> then we'll create a more flexible system using NGUI's <span class="strong"><strong>Notify</strong></span> and <span class="strong"><strong>Method</strong></span> fields.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec45"></a>Code</h4></div></div></div><p>In order to set a callback for a specific event, a generic solution exists for all NGUI events you might encounter: the <code class="literal">EventDelegate.Set()</code> method. You can also add multiple callbacks to an event using <code class="literal">EventDelegate.Add()</code>.</p><p>Add this line at the <a id="id517" class="indexterm"></a>end of the <code class="literal">OnClick()</code> method of <code class="literal">DisappearOnClick.cs</code>:</p><div class="informalexample"><pre class="programlisting">// Set the tween's onFinished event to our LoadGameScene callback
<span class="strong"><strong>EventDelegate.Set(tween.onFinished, MenuManager.LoadGameScene);</strong></span>
</pre></div><p>Instead of the preceding line, we can<a id="id518" class="indexterm"></a> also use the tween-specific <code class="literal">SetOnFinished()</code> convenience method to do this. We'll get the exact same result with fewer words:</p><div class="informalexample"><pre class="programlisting">// Another way to assign our method to the onFinished event
<span class="strong"><strong>tween.SetOnFinished(MenuManager.LoadGameScene);</strong></span>
</pre></div><p>Great. If you hit Unity's <span class="strong"><strong>play</strong></span> button and click on our main menu's <code class="literal">Play</code> button, you'll see that our <code class="literal">Game</code> scene is loaded as soon as the tween has finished!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note30"></a>Note</h3><p>It is possible to remove the link of an existing event delegate to a callback by calling <code class="literal">EventDelegate.Remove(eventDelegate, callback);</code>.</p></div><p>Now, let's see how to link an event delegate to a callback using the Inspector view.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec46"></a>Inspector</h4></div></div></div><p>Now that we have seen<a id="id519" class="indexterm"></a> how to set event delegates through code, let's see how we can create a variable to let us choose which method to call within the Inspector view, like this:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_04_12.jpg" /><div class="caption"><p>The method to call when the target disappears can be set any time without editing the code</p></div></div><p>The <span class="strong"><strong>On Disappear</strong></span> variable shown in the preceding screenshot is of the type <code class="literal">EventDelegate</code>. We can declare it right now with the following line as a global variable for our <code class="literal">DisappearOnClick.cs</code> script:</p><div class="informalexample"><pre class="programlisting">// Declare an event delegate variable to be set in Inspector
<span class="strong"><strong>public EventDelegate onDisappear;</strong></span>
</pre></div><p>Now, let's change the <code class="literal">OnClick()</code> method's last line to make sure the tween's <code class="literal">onFinished</code> event calls the defined <code class="literal">onDisappear</code> callback:</p><div class="informalexample"><pre class="programlisting">// Set the tween's onFinished event to the selected callback
<span class="strong"><strong>tween.SetOnFinished(onDisappear);</strong></span>
</pre></div><p>Ok. Great. Save the script and go to Unity. Select our main menu's <code class="literal">Play</code> button: a new <span class="strong"><strong>On Disappear</strong></span> field has appeared.</p><p>Drag <code class="literal">UI Root</code>—which holds our <code class="literal">MenuManager.cs</code> script—in the <span class="strong"><strong>Notify</strong></span> field. Now, try to select our <span class="strong"><strong>MenuManager</strong></span> | <span class="strong"><strong>LoadGameScene</strong></span> method. Surprisingly, it doesn't appear, and you can only select the script's <code class="literal">Exit</code> method… why is that?</p><p>That is simply because our <code class="literal">LoadGameScene()</code> method is currently static. If we want it to be available in the Inspector view, we need to remove its static property:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open our <code class="literal">MenuManager.cs</code> script.</p></li><li><p>Remove the <code class="literal">static</code> keyword from our <code class="literal">LoadGameScene()</code> method.</p></li></ol></div><p>Save the script and<a id="id520" class="indexterm"></a> return to Unity. You can now select it in the drop-down list:</p><div class="mediaobject"><img src="/graphics/9781783552979/graphics/2979OT_04_13.jpg" /></div><p>Great! We have set our callback through the Inspector view; the <code class="literal">Game</code> scene will be loaded when the menu disappears.</p><p>Now that we have learned how to assign event delegates to callback methods through code and the Inspector view, let's see how to assign keyboard keys to user interface elements.</p></div></div></div>