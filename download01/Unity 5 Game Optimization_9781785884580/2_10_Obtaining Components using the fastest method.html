<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec15"></a>Obtaining Components using the fastest method</h2></div></div><hr /></div><p>There are<a id="id96" class="indexterm"></a> several variations of the <code class="literal">GetComponent()</code> method, and it becomes prudent to call the fastest possible version of this method. The three overloads available are <code class="literal">GetComponent(string)</code>, <code class="literal">GetComponent&lt;T&gt;()</code>, and <code class="literal">GetComponent(typeof(T))</code>. It turns out that the fastest version depends on which version of Unity we are running.</p><p>In Unity 4, the <code class="literal">GetComponent(typeof(T))</code> method is the fastest of the available options by a reasonable margin. Let's prove this with some simple testing:</p><div class="informalexample"><pre class="programlisting">int numTests = 1000000;
TestComponent test;

using (new CustomTimer("GetComponent(string)", numTests)) {
  for (var i = 0; i &lt; numTests; ++i) {
    test = (TestComponent)GetComponent("TestComponent");
  }
}

using (new CustomTimer("GetComponent&lt;ComponentName&gt;", numTests)) {
  for (var i = 0; i &lt; numTests; ++i) {
    test = GetComponent&lt;TestComponent&gt;();
  }
}

using (new CustomTimer("GetComponent(typeof(ComponentName))", numTests))  {
  for (var i = 0; i &lt; numTests; ++i) {
    test = (TestComponent)GetComponent(typeof(TestComponent));
  }
}</pre></div><p>This code tests each of the <code class="literal">GetComponent()</code> overloads a million times. This is far more tests than<a id="id97" class="indexterm"></a> would be sensible for a typical project, but it is enough tests to prove the point.</p><p>Here is the result we get when the tests complete:</p><div class="mediaobject"><img src="/graphics/9781785884580/graphics/4939_02_01.jpg" /></div><p>As you can see, <code class="literal">GetComponent(typeof(T))</code> is significantly faster than <code class="literal">GetComponent&lt;T&gt;()</code>, which is around five times faster than <code class="literal">GetComponent(string)</code>. This test was performed against Unity 4.5.5, but the behavior should be equivalent all the way back to Unity 3.x.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note12"></a>Note</h3><p>
<code class="literal">GetComponent(string)</code> should not be used, since it is notoriously slow and is only included for completeness.</p></div><p>These results change when we run the exact same test in Unity 5. Unity Technologies made some performance enhancements to how <code class="literal">System.Type</code> references are passed around in Unity 5.0, and, as a result, <code class="literal">GetComponent&lt;T&gt;()</code> and <code class="literal">GetComponent(typeof(T))</code> become essentially equivalent:</p><div class="mediaobject"><img src="/graphics/9781785884580/graphics/4939_02_02.jpg" /></div><p>As you can <a id="id98" class="indexterm"></a>see, the <code class="literal">GetComponent&lt;T&gt;()</code> method is only a tiny fraction faster than <code class="literal">GetComponent(typeof(T))</code>, while <code class="literal">GetComponent(string)</code> is now around 30 times slower than the alternatives (interestingly, it became even slower than it was in Unity 4). Multiple tests will probably yield small variations in these results, but ultimately we can favor either of the type-based versions of <code class="literal">GetComponent()</code> when we're working in Unity 5, and the outcome will be about the same.</p><p>There is one caveat, however. If we're running Unity 4, then we still have access to a variety of quick accessor properties such as <code class="literal">collider</code>, <code class="literal">rigidbody</code>, <code class="literal">camera</code>, and so on. These properties behave like precached Component member variables, which are significantly faster than all of the traditional <code class="literal">GetComponent()</code> methods:</p><div class="informalexample"><pre class="programlisting">int numTests = 1000000;
Rigidbody test;

using (new CustomTimer("Cached reference", numTests))
{
  for (var i = 0; i &lt; numTests; ++i) {
    test = gameObject.rigidbody;
  }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>Note that this code is intended for Unity 4, and will not compile in Unity 5 due to the removal of the<a id="id99" class="indexterm"></a> <code class="literal">rigidbody</code> property.</p></div><p>Running this test in Unity 4 gives us the following result:</p><div class="mediaobject"><img src="/graphics/9781785884580/graphics/4939_02_03.jpg" /></div><p>In an effort to<a id="id100" class="indexterm"></a> reduce dependencies and improve code modularization in the engine's backend, Unity Technologies has deprecated all of these quick accessor variables in Unity 5. Only the <code class="literal">transform</code> property remains.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip15"></a>Tip</h3><p>Unity 4 users considering an upgrade to Unity 5 should know that upgrading will automatically modify any of these properties to use the <code class="literal">GetComponent&lt;T&gt;()</code> method. However, this will result in uncached <code class="literal">GetComponent&lt;T&gt;()</code> calls scattered throughout your code, possibly requiring you to revisit the techniques introduced in the earlier section, entitled <span class="emphasis"><em>Cache Component References</em></span>.</p></div><p>The moral of the story is that if we are running Unity 4, and the required Component is one of GameObject's built-in accessor properties, then we should use that version. If not, then we should favor <code class="literal">GetComponent(typeof(T))</code>. Meanwhile, if we're running Unity 5, then we can favor either of the type-based versions: <code class="literal">GetComponent&lt;T&gt;()</code> or <code class="literal">GetComponent(typeof(T))</code>.</p></div>