<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec33"></a>Lights</h2></div></div><hr /></div><p>Unity provides<a id="id268" class="indexterm"></a> a variety of light types for brightening the game world. They are <span class="strong"><strong>Directional Light</strong></span>, <span class="strong"><strong>Spotlight</strong></span>, <span class="strong"><strong>Point Light</strong></span>, and <span class="strong"><strong>Area Light</strong></span>. Each of these projects light in a different way; they are explained in detail as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Directional Light</strong></span>: This functions much like the sun. It projects all of its light in <a id="id269" class="indexterm"></a>a single direction. The position of the light does not matter, only the rotation does. Light is projected over the entire scene in one direction. This makes it perfect for initially adding light to a scene.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Spotlight</strong></span>: This <a id="id270" class="indexterm"></a>functions just like the lights on a stage. Light is projected in a cone-like shape in a specific direction. Because of this, it is also the most complex light type for the system to calculate. Unity has made significant improvements on how it calculates lights, but an overuse of these lights should be avoided.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Point Light</strong></span>: This<a id="id271" class="indexterm"></a> is the primary light type that will be used in your games. It emits light in every direction. This functions just like a light bulb.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Area Light</strong></span>: This is<a id="id272" class="indexterm"></a> a special-use light. It emits light in a single direction from a plane. Think of it as a big neon sign used to advertise a hotel or restaurant. Because of their complexity, these lights can only be used when baking shadows. There are too many calculations for them to be used when the game is running.</p></li></ul></div><p>The next obvious question when talking about lights concerns shadows, especially real-time shadows. While real-time shadows add a lot to a scene and are technically possible on any platform, they are very expensive. On top of that, they are a Unity Pro feature for all light types, except <span class="strong"><strong>Directional Lights</strong></span>. All in all, this makes them a bit too much for your average mobile game.</p><p>On the other hand, there are perfectly viable alternatives that do not cost nearly as much and often look more realistic than real-time shadows. The first alternative is for your environment. In general, the environment in a game never moves and never changes within a specific scene. For this, we have lightmaps. They are extra textures that contain shadow data. Using Unity, you can create these textures while making your game. Then, when the game is running, they are automatically applied and your shadows appear. This, however, does not work for dynamic objects (anything that moves).</p><p>For dynamic objects, we have cookies. These are not your grandmother's cookies. In lighting, a cookie is a black and white image that is projected onto meshes in the game. This is similar to shadow puppets. Shadow puppets use a cutout to block a part of the light, whereas cookies use black and white images to tell the light where it can cast its light.</p><p>Cookies can also be used to create other good effects, both static and dynamic, such as a cloud cover that pans across the scene or, perhaps, light projecting out from a cage. Or, you can use them to make the uneven focus point of a flashlight.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec32"></a>Adding more lights</h3></div></div></div><p>It is rather<a id="id273" class="indexterm"></a> simple to add additional lights to the scene. Also, as long as one sticks to point lights, the cost to render them stays low. Let's use these steps to light up our game:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>At the top of the Unity Editor, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Point Light</strong></span>.</p></li><li><p>With the new light selected, these are a few attributes that we should be concerned about in the <span class="strong"><strong>Inspector</strong></span> window:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Range</strong></span>: This is how far light will be emitted from the object. The light emitted from this point is brightest at the center and fades to nothing as it reaches the extent of the range. The range is additionally represented as a yellow-colored wire sphere in the <span class="strong"><strong>Scene</strong></span> view.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Color</strong></span>: This is simply the color of the light. By default, it is white; however, any color can be used here. This setting is shared between all the light types.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Intensity</strong></span>: This denotes the brightness of the light. The greater the intensity of the light, the brighter will be the light at its center. This setting is also shared between all the light types.</p></li></ul></div></li><li><p>Create and position several more lights, arranging them along the streets to add some more interesting elements to the environment.</p></li><li><p>Press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span> to duplicate the selected object. This can greatly speed up the creation process (like the one shown in the following screenshot):</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_04_06.jpg" /></div></li><li><p>While<a id="id274" class="indexterm"></a> adding these lights, you probably noticed one of their major drawbacks. There is a limit to the number of lights that will affect a surface in real time. It is possible to somewhat work around this by using more complex meshes. A better option is to use lightmaps, which we'll be seeing in the next section.</p></li><li><p>At the top of the Unity Editor again, navigate to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Spotlight</strong></span>.</p></li><li><p>Select a new light and take a look at it in the <span class="strong"><strong>Inspector</strong></span> window.</p><p><span class="strong"><strong>Spot Angle</strong></span>: This is unique to this type of light. It dictates how wide the cone of the emitted light will be. Together with <span class="strong"><strong>Range</strong></span>, it is represented by a yellow-colored wire cone in the <span class="strong"><strong>Scene</strong></span> view.</p></li><li><p>Add a few spotlights around the fountain in the center of our Tank Battle city, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_04_07.jpg" /></div></li><li><p>Having so<a id="id275" class="indexterm"></a> many objects in a scene clutters the <span class="strong"><strong>Hierarchy</strong></span> window, making it hard to find anything. To organize it, you can use empty GameObjects. Create a <span class="strong"><strong>GameObject</strong></span> and name it <code class="literal">PointLights</code>.</p></li><li><p>By making all of your point lights children of this empty <span class="strong"><strong>GameObject</strong></span>, the <span class="strong"><strong>Hierarchy</strong></span> window becomes significantly less cluttered.</p></li></ol></div><p>We added several lights to the game. By changing the colors of the lights, we make the scene much more interesting to look at and play in. However, a drawback of the lighting system is revealed. The city we are using is very simple and there is a limit to the number of lights that can affect a plane at one time. While the look of our scene is nevertheless improved, much of the impressiveness is stolen by this drawback.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec33"></a>Lightmaps</h3></div></div></div><p>Lightmaps are great for complex lighting setups that will be too expensive or simply won't work at<a id="id276" class="indexterm"></a> runtime. They also allow you to add detailed shadows to <a id="id277" class="indexterm"></a>your game world without the expense of real-time shadows. However, it will only work for objects that do not move over the course of a game.</p><p>Lightmaps are a great effect for any game environment, but we need to explicitly tell Unity which objects will not move and then create the lightmaps. The following steps will help us do this:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing to do is to make your environment meshes static. To do this, start by selecting a piece of your city.</p></li><li><p>In the top-right corner of the <span class="strong"><strong>Inspector</strong></span> window, to the right-hand side of the object name field, are a checkbox and a <span class="strong"><strong>Static</strong></span> label. Checking this box will make the object static.</p></li><li><p>Make all of the city's meshes static, as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Instead of selecting each checkbox one by one, if you have any sort of grouping (as we just did for the lights), this step can be completed much faster. Select the root object of your city, the one that is the parent to all the pieces of your city, buildings, and streets.</p></li><li style="list-style-type: disc"><p>Now, go and select the <span class="strong"><strong>Static</strong></span> checkbox.</p></li><li style="list-style-type: disc"><p>In the new popup, select <span class="strong"><strong>Yes, change children</strong></span> to cause all the subobjects to become static as well.</p></li></ul></div></li><li><p>Any mesh that is either not unwrapped or has UV positions outside the normalized UV space will be skipped when Unity generates a lightmap. In the <span class="strong"><strong>Model Import Settings</strong></span> window, there is an option to have Unity automatically generate lightmap coordinates, <span class="strong"><strong>Generate Lightmap UVs</strong></span>. If you are using <code class="literal">TankBattleCity</code> for your environment, this option should be turned on now.</p></li><li><p>Go to the top of the Unity Editor and select <span class="strong"><strong>Window</strong></span> and then click on <span class="strong"><strong>Lighting</strong></span>, near the bottom.</p></li><li><p>Most of your time will be spent on the <span class="strong"><strong>Scene</strong></span> page when looking at this window. Select <span class="strong"><strong>Scene</strong></span> at the top of the window to switch to that window.</p></li><li><p>The first thing you will notice about this page is that it has the same <span class="strong"><strong>Sky Light</strong></span> section that we saw in <span class="strong"><strong>Scene Render Settings</strong></span>, where we changed the skybox. We also have all the <span class="strong"><strong>Fog</strong></span> settings toward the bottom of the window.</p></li><li><p>The <a id="id278" class="indexterm"></a>section we are interested in is <span class="strong"><strong>General GI Settings</strong></span>, as<a id="id279" class="indexterm"></a> shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_04_09.jpg" /></div><p>The preceding screenshot has the following settings:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Workflow</strong></span>: This setting determines which method you are going to use in order to work with your lightmaps. By default, <span class="strong"><strong>Legacy</strong></span> is selected, which is the old method. We want to change it to <span class="strong"><strong>On Demand</strong></span>. (<span class="strong"><strong>Iterative</strong></span> is the same as <span class="strong"><strong>On Demand</strong></span>, but it attempts to update the lightmaps while you are adjusting settings. This is only recommended if you have a computer that is powerful enough to handle it.)</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Global Parameters</strong></span>: This setting lets you create settings that you might want<a id="id280" class="indexterm"></a> to be able to quickly select. This will be <a id="id281" class="indexterm"></a>especially useful if you have many scenes that need to be changed. However, we only have one scene, so we can ignore it for now.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Sky Light</strong></span>: This setting affects how much ambient light is in the scene. A lower value will make the overall scene darker, perhaps giving you a night scene. A higher value will make everything brighter, perhaps a daytime scene. The <span class="strong"><strong>Realtime Sky</strong></span> checkbox below this setting dictates whether this calculation is made while the game is running or only when you are baking the lightmaps. Unchecking the box will save on processing, but leaving it checked will allow you to change the brightness of your scene while the game is running. So, you can see your lights in the game, set <span class="strong"><strong>Sky Light</strong></span> to <code class="literal">0.2</code>, and uncheck <span class="strong"><strong>Realtime Sky</strong></span>.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Albedo Scale</strong></span>: This setting affects how much light bounces off of surfaces. The <span class="strong"><strong>Indirect Scale</strong></span> option affects how much light is in the overall scene from the light sources that do not point directly at an object. For our purposes, both of these can be left at their default values.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Realtime GI Settings</strong></span>: This section is only available with Unity's new lightmaping system. It holds the controls for lightmaps that are calculated while the game is running. The <span class="strong"><strong>Realtime Resolution</strong></span> and <span class="strong"><strong>Realtime Atlas Size</strong></span> options adjust how much detail is present in these lightmaps. The <span class="strong"><strong>CPU Usage</strong></span> option controls the amount of effort that the system will put into calculating the values you see while the game is running. Since we are working on a mobile platform, we need to keep our processing costs down, so leaving all of these at their low defaults works fine for us.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Baked GI Settings</strong></span>: These settings hold the controls for adjusting the precalculated lightmaps. This is where most of your adjustments will take place. Right off the bat, we have a <span class="strong"><strong>Directional Mode</strong></span> checkbox that dictates whether we are going to use a single set of lightmaps when unchecked. Or, if we are going to use two sets, where one set is for color and direct light and the second set is for indirect light. Using two sets of lightmaps can give you greater detail, especially in dark areas, but is more costly to calculate and use. So, we are going to leave it unchecked.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Baked Resolution</strong></span>: This setting controls how much detail is put into an object based on its size. After the number field, you can see the <span class="strong"><strong>texels per unit</strong></span> setting. A texel is just a fancy lightmap pixel. So, it is really <a id="id282" class="indexterm"></a>just the amount of pixel details in the lightmap<a id="id283" class="indexterm"></a> for each unit in the scene. For our purposes, a value of <code class="literal">30</code> will give us a good amount of detail without overloading our computers.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip09"></a>Tip</h3><p>The <span class="strong"><strong>Baked Resolution</strong></span> setting will most quickly affect how long it takes to actually bake your lightmaps. It is always better to start working with low values and only increase the values once your lighting setup comes close to what you want the final product to look like.</p></div></li><li style="list-style-type: disc"><p><span class="strong"><strong>Baked Atlas Size</strong></span>: This setting controls the ultimate resolution of the final lightmap images. Smaller resolution sizes will be easier to process, but you need to limit the overall details of the largest objects in your scene. No matter what resolution you have chosen, a single plane of your models cannot have more detail than a single lightmap atlas. The default of <span class="strong"><strong>1024</strong></span> is an excellent compromise between detail and processing cost.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Padding</strong></span>: The value of this setting adjusts the space in the lightmap between objects. A value that is too low will cause the shading to bleed onto the edges of other objects that share the lightmap. A value that is too high will lead to a great amount of wasted space in your lightmaps. Again, the default here will work just fine for us.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Direct Scale</strong></span>: This setting will scale the intensity of lights when baked into your lightmap. It will let you change the overall brightness of your scene. The default will work just fine here as well.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>AO Exponent</strong></span>: This setting adjusts the contrast of the ambient lighting. This will make the dark areas in your scene look darker and the light areas look brighter. Leaving it at the default of <code class="literal">1</code> will be fine for us.</p></li></ul></div></li><li><p>At the bottom of the page is a <span class="strong"><strong>Bake</strong></span> button. Clicking on this button will start the render process. A loading bar will appear in the bottom-right corner of Unity, so you can monitor the progress.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>Be warned as this process is likely to take a while. Especially as the complexity of the environment and the number of lights increases and the detail settings are ramped up, this will take longer and longer to run. Also, unless you have a superior computer, there isn't much you can do in Unity while it is running.</p></div></li><li><p>If you<a id="id284" class="indexterm"></a> clicked on the button and realized that you have made a<a id="id285" class="indexterm"></a> mistake, don't fret. After <span class="strong"><strong>Bake</strong></span> is selected, the button changes to <span class="strong"><strong>Cancel</strong></span>. At this time, it is possible to select it and stop the process from continuing. However, once the textures have been created and Unity starts to import them, there is no stopping it.</p></li><li><p>At the left-hand side of the <span class="strong"><strong>Bake</strong></span> button is <span class="strong"><strong>Clear</strong></span>. This button is the quickest and easiest way to delete and remove all of the lightmaps that are currently being used in the scene. This cannot be undone.</p></li><li><p>In order to add shadows to your buildings, select <span class="strong"><strong>Directional Light</strong></span> in your scene, from <span class="strong"><strong>Hierarchy</strong></span>, and take a look at the <span class="strong"><strong>Inspector</strong></span> window.</p></li><li><p>From the <span class="strong"><strong>Shadow Type</strong></span> drop-down list, select <span class="strong"><strong>Soft Shadows</strong></span>. This simply turns on the shadows for this light. It turns them on for both lightmaps and real-time lighting. The greater the number of lights with shadows turned on, the more expensive they become to render. It is a good idea to turn on the shadows for your lightmap, but be sure to turn them off afterwards. This will conserve processing in your final game, while still giving your static scene a good look.</p></li><li><p>When all your lights and settings match your expectations, select <span class="strong"><strong>Bake</strong></span> and once it has finished processing, gaze in wonder at the now beautiful scene before you, as shown here:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_04_08.jpg" /></div></li></ol></div><p>We added <a id="id286" class="indexterm"></a>lightmaps to our game world. The length of time it takes to just <a id="id287" class="indexterm"></a>process this step makes it difficult to make minor tweaks. However, our lighting has vastly improved with a few clicks. While earlier the lights were broken by the meshes, we now have smooth patches of color and light.</p><p>When playing a game, there is only one type of light that people will not question the source of: sunlight. Every other light looks weird if a source is not seen. Create a mesh and add it to the game in order to give a reason for the lights you are using. This can be something along the lines of torches, lamp posts, or even glowing alien goo balls. Whatever they end up being, having them adds that touch of completeness that makes the difference between an OK-looking game and a great-looking game.</p><p>As a second challenge, take a look at your lightmap's quality. Play with the various quality settings we discussed to see what the differences are. Also, find out how low the resolution can be before you notice any pixelation. Can the settings go even lower when running on smaller mobile device screens? Go find out.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec34"></a>Cookies</h3></div></div></div><p>Cookies are a great way to add interest to the lights in your game. They use a texture to adjust how<a id="id288" class="indexterm"></a> the light is emitted. This effect can cover a wide range of uses, from <a id="id289" class="indexterm"></a>sparkling crystals to caged industrial lights and, in our case, headlights.</p><p>By giving our tank headlights, we give the player the ability to control the light in their world. Using cookies, we can make them look more interesting than just circles of light. Let's add those lights with these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start by creating a spotlight.</p></li><li><p>Position the light in front of the tank and pointing away.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window, increase the value of the <span class="strong"><strong>Intensity</strong></span> attribute to <code class="literal">3</code>. This will make our headlights bright, like real headlights.</p></li><li><p>Now, we need some cookie textures. At the top of the Unity Editor, navigate to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Light Cookies</strong></span>.</p></li><li><p>In the new window, click on <span class="strong"><strong>Import</strong></span> and wait for the loading bar to finish.</p></li><li><p>We now have a few options to choose from. Inside the <code class="literal">Standard Assets</code> folder, a new folder was created, <code class="literal">Light Cookies</code>, that contains the new textures. Drag <span class="strong"><strong>Flashlight</strong></span> from the <span class="strong"><strong>Project</strong></span> window and drop it onto the <span class="strong"><strong>Cookie</strong></span> field on <span class="strong"><strong>Spotlight</strong></span> in the <span class="strong"><strong>Inspector</strong></span> window. It is as simple as that to add a cookie to a light.</p></li><li><p>You may still not be able to see your cookie in action. It is the result of the same issue we were having before; too many lights can't shade the same object. Unfortunately, a light that is meant to move around cannot be baked into the lightmaps. To fix this, change the light's <span class="strong"><strong>Render Mode</strong></span> attribute to <span class="strong"><strong>Important</strong></span> in the <span class="strong"><strong>Inspector</strong></span> panel. This will give the light priority and make it light an object before the other objects in the scene.</p></li><li><p>If you were to bake your lights again now, you would end up with the cookie shape stuck on the wall of a building. We need to change <span class="strong"><strong>GI Mode</strong></span> to <span class="strong"><strong>Realtime</strong></span> so that the light is ignored by the lightmaping process but is still able to affect the scene.</p></li><li><p>To finish off, duplicate the light for the second headlight and make them both children of the tank. What good is it to have headlights if they don't come with us?</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_04_10.jpg" /></div></li></ol></div><p>We <a id="id290" class="indexterm"></a>performed a few short steps and created a pair of headlights for our tank <a id="id291" class="indexterm"></a>using cookies. This is exactly how many other games, especially horror games, create flashlight effects.</p><p>Try making a script that will allow the player to turn the headlights on and off. It should be a simple button that toggles the lights. Take a look at the <code class="literal">enabled</code> variable that is supplied as part of the light.</p><p>As a simple challenge, create a lamp that sits on the turret of the tank. Give it a light as well. With this, the player can point a light to where they are shooting and not just in the direction in which their tank is pointing.</p></div></div>