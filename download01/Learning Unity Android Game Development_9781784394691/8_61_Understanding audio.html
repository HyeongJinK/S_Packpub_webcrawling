<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec61"></a>Understanding audio</h2></div></div><hr /></div><p>As with other assets, the Unity team has<a id="id466" class="indexterm"></a> worked hard to make working with audio easy and hassle-free. Unity is capable of importing and utilizing a broad range of audio formats, allowing you to keep your files in a format that you can edit in another program.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec50"></a>Import settings</h3></div></div></div><p>Audio clips have a<a id="id467" class="indexterm"></a> small assortment of important settings. They let you easily control the type and compression of files. The following screenshot shows the settings that we<a id="id468" class="indexterm"></a> have to work with while importing audio clips:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_08_01.jpg" /></div><p>The options <a id="id469" class="indexterm"></a>in the preceding screenshot are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Force To Mono</strong></span>: This checkbox will cause Unity to change a multichannel file to have a single channel of audio data.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Load In Background</strong></span>: This <a id="id470" class="indexterm"></a>will cause the initial loading of an audio file to not pause the whole game while it is loading the game into memory. It is best to use this for large files that do not need to be used right away.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Preload Audio Data</strong></span>: This will cause the audio information to be loaded as soon as possible. This is best for small files that need to be used almost immediately.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Load Type</strong></span>: This controls how the file is loaded when the game is being played; you can choose from the following three available options:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Decompress On Load</strong></span>: This removes compression from the file when it is first needed. The overhead for this option makes it a very poor choice for large files. This option is best for short sounds that you often hear, such as gunfire in a shooting game.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Compressed In Memory</strong></span>: This only decompresses the file as it is being played. When it is just being held in memory, the file remains compressed. This is a good option for short- and medium-length sounds that are not heard often.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Streaming</strong></span>: This loads in the audio as it is playing, such as streaming music or video from the Web. This option is best for things such as background music.</p></li></ul></div></li><li style="list-style-type: disc"><p><span class="strong"><strong>Compression Format</strong></span>: This allows you to select the kind of compression format to be used for reducing the size of your audio files. The <span class="strong"><strong>PCM</strong></span> format will give you the largest file size and the best audio quality. The <span class="strong"><strong>Vorbis</strong></span> format can give you the smallest file size, but the quality is reduced the smaller you go. The <span class="strong"><strong>ADPCM</strong></span> format adapts to how the audio file is laid out, in order to give you a file size somewhere in the middle.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Quality</strong></span>: This is only used when <span class="strong"><strong>Vorbis</strong></span> is selected as the compression format. A lower value will reduce the final size of the file in your project, but it will also introduce increasing amounts of artifacts to your audio.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Sample Rate Setting</strong></span>: This lets you determine how much detail from your audio files is maintained in Unity. The <span class="strong"><strong>Preserve Sample Rate</strong></span> option will maintain the setting that was used in your original file. The <span class="strong"><strong>Optimize Sample Rate</strong></span> option will allow Unity to choose a setting that works well for your file. The <span class="strong"><strong>Override Sample Rate</strong></span> option will let you access the value of <span class="strong"><strong>Sample Rate</strong></span> and select a specific setting for your audio. A smaller value will reduce the overall file size, at the cost of lowering the quality.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec51"></a>Audio Listener</h3></div></div></div><p>In order to actually hear anything in the game, every scene needs an <span class="strong"><strong>Audio Listener</strong></span> component in it. By default, the <code class="literal">Main Camera</code> object (included first in any new scene) and any new camera you might create has an <span class="strong"><strong>Audio Listener</strong></span> component attached. There can only be one <a id="id471" class="indexterm"></a>
<span class="strong"><strong>Audio Listener</strong></span> component in your scene at a time. If there is more than one component or you try to play a sound when there isn't one, Unity will fill your console log with complaints and warnings. The <span class="strong"><strong>Audio Listener</strong></span> component<a id="id472" class="indexterm"></a> also gives the precise position for any 3D sound effects to key off.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec52"></a>Audio Source</h3></div></div></div><p>The <a id="id473" class="indexterm"></a>
<span class="strong"><strong>Audio Source</strong></span> component <a id="id474" class="indexterm"></a>is like a speaker, and it controls the settings used to play any sound effect. If the clip is 3D, the position of this object to the <span class="strong"><strong>Audio Listener</strong></span> component and the mode chosen determine the volume of the clip. The following screenshot shows the various <a id="id475" class="indexterm"></a>settings for an <span class="strong"><strong>Audio Source</strong></span> component, followed by their explanation:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_08_02.jpg" /></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>AudioClip</strong></span>: This is the sound file that this <span class="strong"><strong>Audio Source</strong></span> component will play, by default.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Output</strong></span>: For complex <a id="id476" class="indexterm"></a>audio effects, one of Unity's new <span class="strong"><strong>Audio Mixer</strong></span> objects can be put here. These allow you to take specific control over the audio and over any effects or blending that might be applied to it, before it is finally played.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Mute</strong></span>: This is a quick way to toggle the volume of the sound that is playing on and off.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Bypass Effects</strong></span>: This allows you to toggle any special filters applied to the <span class="strong"><strong>Audio Source</strong></span> component.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Bypass Listener Effect</strong></span>: This allows the audio to ignore any special effects that might be applied to <span class="strong"><strong>Audio Listener</strong></span>. This is a good setting for background music that should not be warped by the world.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Bypass Reverb Zones</strong></span>: This allows you to control whether <span class="strong"><strong>Reverb Zones</strong></span>, which control the transition areas in ambient audio, affect the sound.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Play On Awake</strong></span>: This will cause the audio clip to immediately start playing when the scene loads or the object is spawned.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Loop</strong></span>: This <a id="id477" class="indexterm"></a>will cause the playing clip to repeat as it is played.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Priority</strong></span>: This dictates the relative importance of the files being played. The value <code class="literal">0</code> denotes the most important and best for music, while <code class="literal">256</code> denotes the least important file. Depending on the system, only so many sounds can be played at once. The list of files to be played starts with the most important and ends when this limit is reached, excluding those with the lowest values if there are more sounds than the limit will allow.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Volume</strong></span>: This decides how loud the clip will be played.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Pitch</strong></span>: This scales the playback speed of the clip.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Stereo Pan</strong></span>: This adjusts how evenly the sound comes out of each speaker, weighting it towards the left or right speaker.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Spatial Blend</strong></span>: This is the percentage of the 3D effects to be applied to the Audio Source component. This affects things such as the falloff and Doppler effects.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Reverb Zone Mix</strong></span>: (Reverb zones are used to create transitions in ambient audio effects.) This setting lets you adjust how much effect these zones will have on the audio from this audio source.</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_08_03.jpg" /></div></li></ul></div><p>The <a id="id478" class="indexterm"></a>settings in the preceding screenshot are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>3D Sound Settings</strong></span>: This contains the group of settings that are specific to the playing of 3D audio clips. The <span class="strong"><strong>Volume</strong></span>, <span class="strong"><strong>Spatial</strong></span>, <span class="strong"><strong>Spread</strong></span>, and <span class="strong"><strong>Reverb</strong></span> options can be adjusted by using the graph at the end of the group. This allows you to create more dynamic transitions as the player approaches an <span class="strong"><strong>Audio Source</strong></span> component:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Doppler Level</strong></span>: This decides how much Doppler effect needs to be applied to moving sounds. Doppler effect is the change in pitch experienced as a source of sound moves closer or further away from you. A classic example is a car blaring its horn as it rushes by.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Volume Rolloff</strong></span>: This controls how the volume fades with distance. There are three types of rolloffs:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="strong"><strong>Logarithmic Rolloff</strong></span>: This is a sudden and rapid falloff of the sound at a short distance from the source's center.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Linear Rolloff</strong></span>: This is an even falloff with distance, the loudest being at the <span class="strong"><strong>Min Distance</strong></span> value and the quietest at the <span class="strong"><strong>Max Distance</strong></span> value.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Custom Rolloff</strong></span>: This allows you to create a custom falloff by adjusting the graph at the end of the group. It is also automatically chosen when the graph is altered.</p></li></ul></div></li><li style="list-style-type: disc"><p>If the <span class="strong"><strong>Audio Listener</strong></span> component is closer than the <span class="strong"><strong>Min Distance</strong></span> value, the <a id="id479" class="indexterm"></a>audio will be played at the current volume level. Outside this distance, the sound will fall off, according to the <span class="strong"><strong>Rolloff</strong></span> mode.</p></li><li style="list-style-type: disc"><p><span class="strong"><strong>Spread</strong></span>: This adjusts the amount of area in speaker space that the sound covers. It becomes more important when working with more than one or two speakers.</p></li><li style="list-style-type: disc"><p>Beyond the <span class="strong"><strong>Max Distance</strong></span> value, the sound will stop transitioning, based on the graph at the bottom of the group.</p></li></ul></div></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec53"></a>Adding background music</h3></div></div></div><p>Now that we know<a id="id480" class="indexterm"></a> about the available audio settings, it is time to<a id="id481" class="indexterm"></a> put that knowledge into action. We will start by adding some background music. This will have to be a 2D sound effect so that we can hear it comfortably, no matter where the <span class="strong"><strong>Audio Source</strong></span> component is. We will also create a short script to fade-in the music, in order to reduce the suddenness with which sound effects bombard the player. We will use the following steps to do this:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We will start by creating a new script and name it <code class="literal">FadeIn</code>.</p></li><li><p>This script begins with four variables. The first variable is the goal volume that the script has to reach. The second is the number of seconds that the transition will take. The third variable is the time when the transition began. The last variable keeps track of the <span class="strong"><strong>Audio Source</strong></span> component attached to the same object as our script, allowing us to update it regularly, as follows:</p><div class="informalexample"><pre class="programlisting">public float maxVolume = 1f;
public float fadeLength = 1f;
private float fadeStartTime = -1f;
private AudioSource source;</pre></div></li><li><p>Next, we <a id="id482" class="indexterm"></a>make use of the <code class="literal">Awake</code> function. It begins<a id="id483" class="indexterm"></a> by checking for an attached <span class="strong"><strong>Audio Source</strong></span> component and filling our <code class="literal">source</code> variable with it. If one cannot be found, the <span class="strong"><strong>GameObject</strong></span> is destroyed and the function is exited:</p><div class="informalexample"><pre class="programlisting">public void Awake() {
  source = gameObject.GetComponent&lt;AudioSource&gt;();
  if(source == null) {
    Destroy(gameObject);
    return;
  }</pre></div></li><li><p>The <code class="literal">Awake</code> function ends by setting the audio's volume to <code class="literal">0</code> and starts playing it if it isn't already playing:</p><div class="informalexample"><pre class="programlisting">source.volume = 0;

if(!source.isPlaying)
  source.Play();
}</pre></div></li><li><p>To cause the transition over time, we use the <code class="literal">Update</code> function. It will check whether the value of the <code class="literal">fadeStartTime</code> variable is below zero and set it to the current time if it is. This allows you to avoid the hiccup that can be caused by the initialization of a scene starting:</p><div class="informalexample"><pre class="programlisting">public void Update() {
  if(fadeStartTime &lt; 0)
    fadeStartTime = Time.time;</pre></div></li><li><p>Next, the function checks whether the transition time has ended. If it has, the <span class="strong"><strong>Audio Source</strong></span> component's volume is set to <code class="literal">maxVolume</code> and the script is destroyed in order to free resources:</p><div class="informalexample"><pre class="programlisting">if(fadeStartTime + fadeLength &lt; Time.time) {
  source.volume = maxVolume;
  Destroy(this);
  return;
}</pre></div></li><li><p>Finally, the current progress is calculated by finding the amount of time that has passed since the fade started and dividing it by the length of the transition. The resulting percentage of progress is multiplied by the value of <code class="literal">maxVolume</code> and applied to the <span class="strong"><strong>Audio Source</strong></span> component's volume:</p><div class="informalexample"><pre class="programlisting">float progress = (Time.time – fadeStartTime) / fadeLength;
source.volume = maxVolume * progress;
}</pre></div></li><li><p>Back in <a id="id484" class="indexterm"></a>Unity, we<a id="id485" class="indexterm"></a> need to create a new empty <span class="strong"><strong>GameObject</strong></span> and name it <code class="literal">Background</code>.</p></li><li><p>Add our <code class="literal">FadeIn</code> script and an <span class="strong"><strong>Audio Source</strong></span> component to our object; these can be found by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span>.</p></li><li><p>If you have not done so already, create an <code class="literal">Audio</code> folder in your <span class="strong"><strong>Project</strong></span> panel and import the sound files included in the <code class="literal">Starting Assets</code> folder for the chapter. Because of the small size of these files and our current game, the default import settings for them will work just fine.</p></li><li><p>Select your <code class="literal">Background</code> object in the <span class="strong"><strong>Hierarchy</strong></span> window and drag the <code class="literal">Background</code> sound to the <span class="strong"><strong>AudioClip</strong></span> slot.</p></li><li><p>Make sure that the <span class="strong"><strong>Play On Awake</strong></span> and <span class="strong"><strong>Loop</strong></span> checkboxes are checked in the <span class="strong"><strong>Audio Source</strong></span> component. Both the <span class="strong"><strong>Volume</strong></span> and <span class="strong"><strong>Spatial Blend</strong></span> options also need to be set to <code class="literal">0</code> to make the file play throughout the game, but make no noise when starting.</p></li></ol></div><p>We added background music to our game. For the sound to be constant and not directional, we utilized the music as a 2D sound. We also created a script to fade in the music when the game starts. This eases the transition into the game for the player, preventing a sudden onslaught of sound. If your background music ends up being too loud to hear anything else in the game, reduce the <span class="strong"><strong>Max Volume</strong></span> value in the <span class="strong"><strong>Inspector</strong></span> panel of your <code class="literal">Background</code> object something more pleasing.</p><p>Background music adds a lot to a game's experience. A horror scene is not nearly as scary without some scary music. Bosses are much less intimidating without their daunting music. Look for some good background music for your other games. Something light and cheery will work well for <span class="emphasis"><em>Angry Birds</em></span>, while a piece that is more industrial and fast-paced will keep hearts racing through the Tank Battle game.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec54"></a>Poking bananas</h3></div></div></div><p>To <a id="id486" class="indexterm"></a>understand 3D audio effects, we are going to add a sound to the bananas, which will be triggered every time the player touches them. This will give the players extra feedback when they have successfully touched one of the bananas, while also giving some indication of the distance and direction of the banana that was touched. Let's use these steps to create this effect:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, we need a new script named <code class="literal">BananaPoke</code>.</p></li><li><p>This script has one variable, <code class="literal">source</code>, to keep track of the <span class="strong"><strong>Audio Source</strong></span> component attached to the object:</p><div class="informalexample"><pre class="programlisting">private AudioSource source;</pre></div></li><li><p>Just like in our previous script, we use the <code class="literal">Awake</code> function to find a reference to our <span class="strong"><strong>Audio Source</strong></span> component, saving us a little bit of work in the editor:</p><div class="informalexample"><pre class="programlisting">public void Awake() {
  source = gameObject.GetComponent&lt;AudioSource&gt;();
}</pre></div></li><li><p>When the player touches a banana on the screen, a message is sent to the banana that calls the <code class="literal">Touched</code> function. We used this function in our <code class="literal">BananaBounce</code> script to adjust its health, which we created in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Specialities of the Mobile Device</em></span>. We can again use it here to play our sound effect, if we have an <span class="strong"><strong>Audio Source</strong></span> component. The <code class="literal">PlayOneShot</code> function uses an <span class="strong"><strong>Audio Source</strong></span> component's position and settings to play a quick sound effect. Without this, we will be unable to play many sound effects from the same <span class="strong"><strong>Audio Source</strong></span> component in rapid succession. All we need to pass it is for the audio clip to be played. In this case, the audio clip is attached to the <span class="strong"><strong>Audio Source</strong></span> component itself:</p><div class="informalexample"><pre class="programlisting">public void Touched() {
  if(source != null)
    source.PlayOneShot(source.clip);
}</pre></div></li><li><p>Next, we need to add our new script and an <span class="strong"><strong>Audio Source</strong></span> component to the <code class="literal">Banana</code> prefab in our <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>The <code class="literal">BananaPoke</code> sound file needs to be dragged from the <code class="literal">Audio</code> folder to the new <span class="strong"><strong>Audio Source</strong></span> component's <span class="strong"><strong>AudioClip</strong></span> slot.</p></li><li><p>So that you don't hear an annoying pop at the very beginning of the game, uncheck the <span class="strong"><strong>Play On Awake</strong></span> box.</p></li><li><p>Next, we want to hear the difference in the distance of the bananas we touch. Set the <span class="strong"><strong>Spatial Blend</strong></span> setting to <code class="literal">1</code>, in order to turn it from a 2D sound effect to a 3D sound effect.</p></li><li><p>Finally, we need to change the value of <span class="strong"><strong>Volume Rolloff</strong></span> to <span class="strong"><strong>Linear Rolloff</strong></span> and set <span class="strong"><strong>Max Distance</strong></span> to <code class="literal">50</code>. This gives us a comfortable and easily heard change in the volume of our sound effect based on distance.</p></li></ol></div><p>Living in a 3D world, we<a id="id487" class="indexterm"></a> expect most sounds to come from a specific direction and to fall off with distance. By creating a similar effect in our 3D games, the player is able to easily judge where things are in the game world and how far away they might be. This is especially important for games where the player needs to be able to hear potential enemies, obstacles, or rewards so that they will be able to find or avoid them.</p><p>Our Tank Battle game has many enemies that can easily sneak up on us, because they make no noise as they approach. Tanks are not generally recognized as quiet machines. Go find an engine's rumble sound or make it and add it to the enemy tanks. This will give the player some indication of where the enemies might be and how far away they are. Also, different types of tanks have different types of engines. Every engine sounds a little bit different. So, while you're at it, find different engine noises for each type of tank you have, giving the player even more indication of what dangers may lie just around the corner.</p></div></div>