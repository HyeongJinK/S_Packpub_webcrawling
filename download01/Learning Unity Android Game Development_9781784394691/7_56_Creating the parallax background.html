<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec57"></a>Creating the parallax background</h2></div></div><hr /></div><p>A great<a id="id446" class="indexterm"></a> feature of many 2D games is a parallax scrolling background. This simply means that the background is created in<a id="id447" class="indexterm"></a> layers that scroll by at different speeds. Think of it as if you are looking out the window of your car. The objects that are far away appear to hardly move, while the ones that are near move by quickly. In a 2D game, it gives the illusion of depth and adds a nice touch to the look of the game. For this background, we will be layering several materials on a single plane. There are several other methods to create this same effect, but ours will make use of a single script that additionally allows you to control the speed of each layer. Let's create it with these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We will start this section with the creation of the <code class="literal">ParallaxScroll</code> script.</p></li><li><p>This script starts with three variables. The first two variables keep track of each material and how fast they should scroll. The third keeps track of the camera's last position, so we can track how far it moves in each frame:</p><div class="informalexample"><pre class="programlisting">public Material[] materials = new Material[0];
public float[] speeds = new float[0];

private Vector3 lastPosition = Vector3.zero;</pre></div></li><li><p>In the <code class="literal">Start</code> function, we record the camera's beginning position. We use <code class="literal">Start</code> instead of <code class="literal">Awake</code> here, in case the camera needs to do any special movement at the beginning of the game:</p><div class="informalexample"><pre class="programlisting">public void Start() {
  lastPosition = Camera.main.transform.position;
}</pre></div></li><li><p>Next, we use the <code class="literal">LateUpdate</code> function to make changes after the camera has moved about. It starts by finding the camera's new position and comparing the <span class="emphasis"><em>x</em></span> axis values to determine how far it has moved. Next, it loops through the list of materials. The loop first gathers the current offset of its texture using <code class="literal">mainTextureOffset</code>. Next, the camera's movement multiplied by the material's speed is subtracted from the offset's <span class="emphasis"><em>x</em></span> axis to find a new horizontal position. Then, the new offset is applied to the material. Finally, the function records the camera's last position for the next frame:</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  Vector3 newPosition = Camera.main.transform.position;
  float move = newPosition.x â€“ lastPosition.x;

  for(int i=0;i&lt;materials.Length;i++) {
    Vector2 offset = materials[i].mainTextureOffset;
    offset.x -= move * speeds[i];
    materials[i].mainTextureOffset = offset;
  }

  lastPosition = newPosition;
}</pre></div></li><li><p>Return to <a id="id448" class="indexterm"></a>Unity and create six new materials. One for each background texture: <code class="literal">sky</code>, <code class="literal">hills_tall</code>, <code class="literal">hills_short</code>, <code class="literal">grass_light</code>, <code class="literal">grass_dark</code>, and <code class="literal">fronds</code>. All the materials, except for <code class="literal">sky</code>, need to use <span class="strong"><strong>Transparent</strong></span> <span class="strong"><strong>Render Mode</strong></span>. If they do not, we will not be able to see all the textures when they are layered.</p></li><li><p>Before we <a id="id449" class="indexterm"></a>can tile the images in the background, we need to adjust their <span class="strong"><strong>Import Settings</strong></span>. Select each in turn and take a look at the <span class="strong"><strong>Inspector</strong></span> window. Because we chose to make a 2D game, Unity imports all the images as sprites by default, which clamps the edges of our images and keeps them from repeating. For all our background images, change the <span class="strong"><strong>Texture Type</strong></span> option to <span class="strong"><strong>Texture</strong></span> and the <span class="strong"><strong>Wrap Mode</strong></span> option to <span class="strong"><strong>Repeat</strong></span>. This will let us use them in a way that makes it look like an infinite scrolling background.</p></li><li><p>We also need to adjust the <span class="strong"><strong>Tiling</strong></span> option for each of these new materials. For all of them, leave the <span class="strong"><strong>Y</strong></span> axis as <code class="literal">1</code>. For the <span class="strong"><strong>X</strong></span> axis, set <code class="literal">5</code> for the <code class="literal">sky</code>, <code class="literal">6</code> for <code class="literal">hills_tall</code>, <code class="literal">7</code> for <code class="literal">hills_shot</code>, <code class="literal">8</code> for <code class="literal">grass_dark</code>, <code class="literal">9</code> for <code class="literal">fronds</code>, and <code class="literal">10</code> for <code class="literal">grass_light</code>. This will offset all the features of the textures, so a long pan does not see features regularly lining up.</p></li><li><p>Next, create a new plane. Name it <code class="literal">Background</code> and remove its <span class="strong"><strong>Mesh Collider</strong></span> component. Also, attach our <code class="literal">ParallaxScroll</code> script.</p></li><li><p>Position it at <code class="literal">30</code> on the <span class="strong"><strong>X</strong></span> axis, <code class="literal">7</code> on the <span class="strong"><strong>Y</strong></span> axis, and <code class="literal">10</code> on the <span class="strong"><strong>Z</strong></span> axis. Set its rotation to <code class="literal">90</code> for the <span class="strong"><strong>X</strong></span> axis, <code class="literal">180</code> for the <span class="strong"><strong>Y</strong></span> axis, and <code class="literal">0</code> for <span class="strong"><strong>Z</strong></span>. Also, set the scale to <code class="literal">10</code> for the <span class="strong"><strong>X</strong></span> axis, <code class="literal">1</code> for the <span class="strong"><strong>Y</strong></span> axis, and <code class="literal">1.5</code> for the <span class="strong"><strong>Z</strong></span> axis. Altogether, these position the plane to face the camera and fill the background.</p></li><li><p>In the plane's <span class="strong"><strong>Mesh Renderer</strong></span> component, expand the <span class="strong"><strong>Materials</strong></span> list and set the value of <span class="strong"><strong>Size</strong></span> to <code class="literal">6</code>. Add each of our new materials to the list slots in the order of <code class="literal">sky</code>, <code class="literal">hills_tall</code>, <code class="literal">hills_short</code>, <code class="literal">grass_dark</code>, <code class="literal">fronds</code>, and <code class="literal">grass_light</code>. Do the same for the <span class="strong"><strong>Materials</strong></span> list in the <span class="strong"><strong>Parallax Scroll</strong></span> script component.</p></li><li><p>Finally, in the <span class="strong"><strong>Parallax Scroll</strong></span> script component, set the value of <span class="strong"><strong>Size</strong></span> of the <span class="strong"><strong>Speeds</strong></span> list to <code class="literal">6</code> and input the following values in the order of <code class="literal">0.03</code>, <code class="literal">0.024</code>, <code class="literal">0.018</code>, <code class="literal">0.012</code>, <code class="literal">0.006</code>, and <code class="literal">0</code>. These values will move the materials gently and evenly.</p></li><li><p>At this point, turning the background into a prefab will make it easy to reuse later.</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_07_05.jpg" /></div></li></ol></div><p>We created a<a id="id450" class="indexterm"></a> parallax scroll effect. This <a id="id451" class="indexterm"></a>effect will pan a series of background textures, giving the illusion of depth in our 2D game. To easily see it in action, press the play button and grab the camera in the <span class="strong"><strong>Scene</strong></span> view, moving it from side to side in order to see the background change.</p><p>We have two other levels to add backgrounds to. Your challenge here is to create your own background. Use the techniques you learned in this section to create a night-style background. It can include a stationary moon, while everything else scrolls in the shot. For an added trick, create a cloud layer that slowly pans across the screen as well as with the camera and the rest of the background.</p></div>