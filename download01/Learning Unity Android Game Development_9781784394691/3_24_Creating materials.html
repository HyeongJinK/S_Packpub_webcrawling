<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec28"></a>Creating materials</h2></div></div><hr /></div><p>In Unity, the materials are the defining factor for how models are drawn on the screen. They can be as <a id="id185" class="indexterm"></a>simple as coloring it all blue or as complex as reflecting water with waves. In this section, we will cover the details of the controls<a id="id186" class="indexterm"></a> for a material. We will also create our city and some simple materials to texture it with.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec24"></a>The city</h3></div></div></div><p>Creating<a id="id187" class="indexterm"></a> a city gives our tanks and our players a good place <a id="id188" class="indexterm"></a>to play. Follow these steps to create our city:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>For the purpose of this section, no part of the city provided with the code bundle of this book was given a specific texture. It was just unwrapped and some tile-able textures were created. So, we need to start by importing the city and the textures to the <code class="literal">Environment</code> folder. Do this in the same the way in which we imported the tank.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note06"></a>Note</h3><p>The files are <code class="literal">TankBattleCity.blend</code>, <code class="literal">brick_001.png</code>, <code class="literal">brick_002.png</code>, <code class="literal">brick_003.png</code>, <code class="literal">dirt_001.png</code>, <code class="literal">dirt_003.png</code>, <code class="literal">pebbles_001.png</code>, <code class="literal">rocks_001.png</code>, <code class="literal">rubble_001.png</code>, and <code class="literal">water_002.png</code>.</p></div></li><li><p>As the city is unwrapped, Unity will still create a single material for it. However, textures were never applied in any modeling program. So, the material is plain white. We have several extra textures, so we are going to need more than just that one material for the whole city. Creating a new material is simple; it is done just like creating a new script. Right-click on the <code class="literal">Materials</code> folder inside the <code class="literal">Environment</code> folder, select <span class="strong"><strong>Create</strong></span>, and then click on <span class="strong"><strong>Material</strong></span>, which is about halfway down the menu.</p></li><li><p>This will create a new material in the folder and immediately allow us to name it. Name the material as <code class="literal">Pebbles</code>.</p></li><li><p>With your new material selected, take a look at the <span class="strong"><strong>Inspector</strong></span> window. When we have selected a material, we get the options that are needed to change its look:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_03_08.jpg" /></div></li><li><p>You can see the following things from the preceding screenshot:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>At the <a id="id189" class="indexterm"></a>very top of the <span class="strong"><strong>Inspector</strong></span> window, we have the material's name followed by a <span class="strong"><strong>Shader</strong></span> drop-down list. A shader is essentially a short script that tells the graphics card how to draw something on the screen. You will use the <span class="strong"><strong>Standard</strong></span> shader most often; it is essentially an all-inclusive shader, so it is always selected by default. This is where you would select any special effect or custom shaders.</p></li><li style="list-style-type: disc"><p>The <span class="strong"><strong>Rendering Mode</strong></span> drop-down <a id="id190" class="indexterm"></a>menu lets you pick whether or not this material will use any amount of transparency. <span class="strong"><strong>Opaque</strong></span> means it will be solid. The <span class="strong"><strong>Cutout</strong></span> option will render with a sharp edge around transparent areas of your texture, based on the value of <span class="strong"><strong>Alpha Cutoff</strong></span>. The <span class="strong"><strong>Transparent</strong></span> option will give you a smooth edge that is based on the alpha channel of your texture.</p></li></ul></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec34"></a>Main Maps</h4></div></div></div><p>The <span class="strong"><strong>Main Maps</strong></span> section<a id="id191" class="indexterm"></a> has the following options:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The<span class="strong"><strong> Main Maps</strong></span> section starts with <span class="strong"><strong>Diffuse,</strong></span> where you put your main color texture. It can be tinted with the color picker to the right of the slot.</p></li><li style="list-style-type: disc"><p>The<span class="strong"><strong> Specular</strong></span> option defines the shininess of your material; think of it like the glare from the light on your device's screen. You can either use an image to control it, or you can use the color picker to determine what color is reflected and the smoothness to control how sharp the glare is.</p></li><li style="list-style-type: disc"><p>The<span class="strong"><strong> Normal Map</strong></span> option lets you add a texture that controls shading across the surface of your material. These textures need to be specially imported. If the texture you pick hasn't been set properly, a warning box will appear where you can select <span class="strong"><strong>Fix Now</strong></span> to change it. A slider will also appear, giving you control over how much effect the texture has.</p></li><li style="list-style-type: disc"><p>The<span class="strong"><strong> Height Map</strong></span> option works in a manner similar to <span class="strong"><strong>Normal Map</strong></span>. It adjusts the bumpiness of your material and gives a slider to adjust it.</p></li><li style="list-style-type: disc"><p>The<span class="strong"><strong> Occlusion</strong></span> option lets you add an ambient occlusion texture to the material, controlling the darkness or lightness of the material based on the proximity of objects to each other in the model.</p></li><li style="list-style-type: disc"><p>The<span class="strong"><strong> Emission</strong></span> option gives you control over the projected light and color that a material gives off. This only affects lightmaps and the appearance of this material. To actually give off light dynamically, it has to be faked with the addition of a real-time light.</p></li><li style="list-style-type: disc"><p>The<span class="strong"><strong> Detail Mask</strong></span> option lets you control where the textures in <span class="strong"><strong>Secondary Maps</strong></span> appear on your material.</p></li><li style="list-style-type: disc"><p>The <a id="id192" class="indexterm"></a>values of <span class="strong"><strong>Tiling</strong></span> and <span class="strong"><strong>Offset</strong></span> control the size and position of the textures. The values of <span class="strong"><strong>Tiling</strong></span> dictate how many times the texture will repeat across the normalized UV space in the x and y directions. The <span class="strong"><strong>Offset</strong></span> parameter is how far from zero the texture starts in the normalized UV space. You can select the number fields and input values to modify them. By doing so, and paying attention to the <span class="strong"><strong>Preview</strong></span> window at the bottom, you will see how they change the texture. Tiling textures are most commonly used for large surfaces where the texture is similar across the surface and a particular texture just repeats.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch03lvl3sec35"></a>Secondary Maps</h4></div></div></div><p>The <span class="strong"><strong>Secondary Maps</strong></span> section<a id="id193" class="indexterm"></a> has the following options:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p><span class="strong"><strong>Secondary Maps</strong></span> starts with <span class="strong"><strong>Detail Diffuse x2</strong></span>, which is an extra diffuse texture to be blended on top of your main diffuse texture. It could be used to add a bumpy variation across the surface of your boulder.</p></li><li><p><span class="strong"><strong>Normal Map</strong></span> works like the main <span class="strong"><strong>Normal Map</strong></span> slot and controls the shading of the detail textures.</p></li><li><p>The second set of <span class="strong"><strong>Tiling</strong></span> and <span class="strong"><strong>Offset</strong></span> values work like the first and just control the detail textures. Usually these are set higher than the first to add extra interest across the surface of the material.</p></li><li><p><span class="strong"><strong>UV Set</strong></span> just lets you select the model unwrap set that the detail textures are going to use on the model to which the material is applied.</p></li><li><p>Add the <code class="literal">pebbles_001</code> texture to this material by dragging it from the <span class="strong"><strong>Project</strong></span> window and dropping it on the square to the right of the <span class="strong"><strong>Diffuse</strong></span> slot.</p></li><li><p>To make the color of the texture better, use the color picker to the right of the <span class="strong"><strong>Diffuse</strong></span> slot and pick a light tan color.</p></li><li><p>A value of <code class="literal">30</code> for both the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> values of the main <span class="strong"><strong>Tiling</strong></span> will make it easier to see when <span class="strong"><strong>Tiling</strong></span> is applied to our city streets.</p></li><li><p>To see our new material in action, first drag your city to the <span class="strong"><strong>Hierarchy</strong></span> window so that it is added to the <span class="strong"><strong>Scene</strong></span> view. By right-clicking and dragging, you can look around in your <span class="strong"><strong>Scene</strong></span> view, and by using <span class="emphasis"><em>W</em></span>, <span class="emphasis"><em>A</em></span>, <span class="emphasis"><em>S</em></span>, and <span class="emphasis"><em>D</em></span>, you can move around. Look over at the streets of the city.</p></li><li><p>Now, drag your new material from the <span class="strong"><strong>Project</strong></span> window into your <span class="strong"><strong>Scene</strong></span> view. While dragging the material around, you should see that the meshes change to appear as if they are using the material. Once you are over the streets, let go of your left mouse button. The material is now applied to the mesh.</p></li><li><p>However, we <a id="id194" class="indexterm"></a>currently have a whole quarter of a city to texture. So, create more materials and use the remaining textures on the rest of the city. Create a new material for each extra texture, and four extra textures of <code class="literal">brick_002</code>, so that we can have different colors for each building's height.</p></li><li><p>Apply your new materials to the city, either by looking at the following screenshot or through your own artistic sensibility:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_03_09.jpg" /></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>When you are trying to get to the center fountain, if your tank is in the way, select your tank in the <span class="strong"><strong>Hierarchy</strong></span> window and use the <span class="strong"><strong>Gizmo</strong></span> in the <span class="strong"><strong>Scene</strong></span> view to drag it out of the way.</p></div><p>If you were to try to play the game now, you might notice that we have a couple of problems. For starters, we only have a quarter of a city; perhaps you have more if you made your own city. In addition, there is still no collision on the city, so we will fall right through it when we move.</p></li><li><p>Changing<a id="id195" class="indexterm"></a> the size of our tank is pretty simple. Select it in the <span class="strong"><strong>Hierarchy</strong></span> window and look for the <span class="strong"><strong>Scale</strong></span> label in our <span class="strong"><strong>Transform</strong></span> component. Changing the <span class="strong"><strong>X</strong></span>, <span class="strong"><strong>Y</strong></span>, and <span class="strong"><strong>Z</strong></span> values under <span class="strong"><strong>Scale</strong></span> will change the size of our tank. Be sure to change them evenly or some weirdness will occur when we start rotating the tank. Values of <code class="literal">0.5</code> make the tank small enough to fit through the small streets.</p></li><li><p>Next up is collision for the city. For the most part, we will be able to get away with simple collision shapes that are faster to process. However, the circular center of the city will require something special. Start by double-clicking on the walls of one of the square buildings in the <span class="strong"><strong>Scene</strong></span> view.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>When dealing with prefabs, which the city still is, clicking on any object that makes up the prefab will select the root prefab object. Once a prefab is selected, clicking on any part of it will select that individual piece. Because this behavior is different from non-prefab objects; you need to be mindful of this when you select objects in the <span class="strong"><strong>Scene</strong></span> view.</p></div></li><li><p>With a set of walls selected, go to the top of the Unity Editor and select <span class="strong"><strong>Component</strong></span>, followed by <span class="strong"><strong>Physics</strong></span>, and finally select <span class="strong"><strong>Box Collider</strong></span>.</p></li><li><p>As we are adding the collider to a specific mesh, Unity does its best to automatically fit the collider to the shape. For us, this means that the new <code class="literal">BoxCollider</code> component is already sized to fit the building. Continue by adding <code class="literal">BoxCollider</code> components to the rest of the square buildings and the outer wall. Our streets are essentially just a plane, so a <code class="literal">BoxCollider</code> component will work just fine for them as well. Though it is pointed at the top, the obelisk at the center of the fountain is essentially just a box; so another <code class="literal">BoxCollider</code> will suit it fine.</p></li><li><p>We have one last building and the fountain ring to deal with. These are not boxes, spheres, or capsules. So, our simple colliders will not work. Select the walls of the last building, the one next to the center fountain. A few options down from where you selected <span class="strong"><strong>Box Collider</strong></span>, there is a <span class="strong"><strong>Mesh Collider</strong></span> option. This will add a <code class="literal">MeshCollider</code> component to our object. This component does what its name suggests; it takes a mesh and turns it into a collider. By adding it to a specific mesh, the <code class="literal">MeshCollider</code> component automatically selects that mesh to be "collideable". You should also add <code class="literal">MeshCollider</code> components to the short ledge around the center building and the ring wall around the fountain.</p></li><li><p>The<a id="id196" class="indexterm"></a> last problem to solve is the duplication of our city quarter. Start by selecting the root city object in your <span class="strong"><strong>Hierarchy</strong></span> window, select <code class="literal">TankBattleCity</code>, and remove the <code class="literal">Animator</code> component from it. The city is not going to animate, so it does not need this component.</p></li><li><p>Now, right-click on the city in the <span class="strong"><strong>Hierarchy</strong></span> window and click on <span class="strong"><strong>Duplicate</strong></span>. This creates a copy of the object that was selected.</p></li><li><p>Duplicate the city quarter two more times and we will have the four parts of our city. The only problem is that they will all be in the exact same position.</p></li><li><p>We need to rotate three of the pieces to make a full city. Select one and set the value of <span class="strong"><strong>Y Rotation</strong></span> in the <span class="strong"><strong>Transform</strong></span> component to <code class="literal">90</code>. This will rotate it 90 degrees around the vertical axis and give us half of a city.</p></li><li><p>We will complete the city by setting one of the remaining pieces to <code class="literal">180</code> and the other to <code class="literal">270</code>.</p></li><li><p>That leaves one last thing to do. We have four center fountains. In three of the four city pieces, select the three meshes that make up the center fountain (the <code class="literal">Obelisk</code>, <code class="literal">Wall</code>, and <code class="literal">Water</code>) and hit the <span class="emphasis"><em>Delete</em></span> key on your keyboard. Confirm that you want to break the prefab connection each time, and our city will be complete, as shown in the following figure:</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_03_10.jpg" /></div></li></ol></div><p>Try out the game now. We can drive the tank around the city and rotate its turret. This is so much fun. We created materials and textured the city, and after making it possible for the player to collide with the buildings and road, we duplicated the section so that we could have a whole city.</p><p>Now that you <a id="id197" class="indexterm"></a>have all the skills needed to import meshes and create materials, the challenge is to decorate the city. Create some rubble and tank traps and practice importing them to Unity and setting them up in the scene. If you really want to go above and beyond, try your hand at creating your own city; choose something from the world, or do something using your imagination. Once it is created, we can release the tanks in it.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec25"></a>Moving treads</h3></div></div></div><p>There is just <a id="id198" class="indexterm"></a>one thing left to do, and then we will be done with materials and can go on to make the game even more fun. Remember the <span class="strong"><strong>Offset</strong></span> value of the materials? It turns out that we can actually control it with a script. Perform these steps to make the treads move with our tank:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start by opening the <code class="literal">ChassisControls</code> script.</p></li><li><p>First, we need to add a few variables at the beginning of the script. The first two will hold <a id="id199" class="indexterm"></a>references to our tank tread renderers, the part of the mesh object that keeps track of the material that is applied to the mesh and actually does the drawing. This is similar to how the <code class="literal">characterControl</code> variable holds a reference to our <code class="literal">CharacterController</code> component:</p><div class="informalexample"><pre class="programlisting">public Renderer rightTread;
public Renderer leftTread;</pre></div></li><li><p>The next two variables will keep track of the amount of offset applied to each tread. We store it here because this is a faster reference than trying to look it up from the tread's material for each frame.</p><div class="informalexample"><pre class="programlisting">private float rightOffset = 0;
private float leftOffset = 0;</pre></div></li><li><p>To make use of the new values, the following lines of code need to be added at the end of the <code class="literal">MoveTank</code> function. The first line here adjusts the offset for the right tread as per our speed, and keeps in time with our frame rate. The second line utilizes the material value of a <code class="literal">Renderer</code> component to find our tank's tread material. The <code class="literal">mainTextureOffset</code> value of the material is the offset of the primary texture in the material. In the case of our diffuse materials, this is the only texture. Then, we have to set the offset to a new <code class="literal">Vector2</code> value that will contain our new offset value. <code class="literal">Vector2</code> is just like <code class="literal">Vector3</code>, which we used for moving around, but it works in 2D space instead of 3D space. A texture is flat; therefore, it is a 2D space. The last two lines of the code do the same thing as the other two, but for the tank's left tread instead:</p><div class="informalexample"><pre class="programlisting">rightOffset += speed * Time.deltaTime;
rightTread.material.mainTextureOffset = new Vector2(rightOffset, 0);
leftOffset += speed * Time.deltaTime;
leftTread.material.mainTextureOffset = new Vector2(leftOffset, 0);</pre></div></li><li><p>To make the connections to the <code class="literal">Renderer</code> components of our treads, do the same thing that we did for the pivot points: drag the tread meshes from the <span class="strong"><strong>Hierarchy</strong></span> window to the corresponding value in the <span class="strong"><strong>Inspector</strong></span> window. Once this is done, be sure to save it and try it out.</p></li></ol></div><p>We updated our <code class="literal">ChassisControls</code> script to make the tank's treads move. As the tank is driven around, the textures pan in the appropriate direction. This is the same type of functionality that is used to make waves in water and other textures that move.</p><p>The movement of the material doesn't quite match the speed of the tank. Figure out how to add an extra speed value for the tank's treads. In addition, it would be cool if they moved in opposite<a id="id200" class="indexterm"></a> directions when the tank is rotating. Real tanks turn by making one tread go forward and the other back.</p></div></div>