<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec40"></a>Making the enemy chase the player</h2></div></div><hr /></div><p>Our next task is to make our <a id="id316" class="indexterm"></a>enemy tank chase the player. We will need two scripts for this. The first will simply advertise the player's current position. The second will use that position and the <span class="strong"><strong>NavMeshAgent</strong></span> component that we set up earlier to find a path to the player.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec35"></a>Revealing the player's location</h3></div></div></div><p>With a very short script, we can easily<a id="id317" class="indexterm"></a> allow all our enemies to know the location of the player. A few short steps to create it are as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start by creating a new script in the <code class="literal">Scripts</code> folder of the <span class="strong"><strong>Project</strong></span> window. Name it <code class="literal">PlayerPosition</code>.</p></li><li><p>This script will start with a single static variable. This variable will simply hold the current position of the player. As it is static, we will be able to easily access it from the rest of our scripts.</p><div class="informalexample"><pre class="programlisting">public static Vector3 position = Vector3.zero;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note10"></a>Note</h3><p>We chose to use a static variable here for its simplicity and speed. Alternatively, we could have added a few extra steps to our enemy tank; it could have used the <code class="literal">FindWithTag</code> function when the game started to actually find the player tank and store it in a variable. Then, it could query that variable when it looks for the player's position. This is just one more way, among the multitude of ways, in which we could have gone about it.</p></div></li><li><p>For the next few lines of code, we make use of the <code class="literal">Start</code> function. This function is automatically called when a scene is first loaded. We use it so that the <code class="literal">position</code> variable can be filled and used as soon as the game starts.</p><div class="informalexample"><pre class="programlisting">public void Start() {
  position = transform.position;
}</pre></div></li><li><p>The last segment of the code simply updates the <code class="literal">position</code> variable in every frame to the player's current position. We also do this in the <code class="literal">LateUpdate</code> function so that the update is done after the player has moved. The <code class="literal">LateUpdate</code> function is called at the end of every frame. With this, the player is able to move during the <code class="literal">Update</code> function and their position is updated later.</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  position = transform.position;
}</pre></div></li><li><p>The last<a id="id318" class="indexterm"></a> thing to do with this script is to add it to the player's tank. So, return to Unity and drag and drop the script from the <span class="strong"><strong>Project</strong></span> window to the tank to add it as a component, just as we did it for all our other scripts.</p></li></ol></div><p>Here, we created the first script that is needed for our chase AI. This script simply updates a variable with the player's current position. We will make use of it in our next script where we will make the enemy tank move around.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec36"></a>Chasing the player</h3></div></div></div><p>Our next script will control our <a id="id319" class="indexterm"></a>simple chase AI. Since we are making use of the <span class="strong"><strong>NavMesh</strong></span> and <span class="strong"><strong>NavMeshAgent</strong></span> components, we can leave nearly all the difficult portions of pathfinding to Unity. Let's create the script by performing these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Again, create a new script. This time, name it <code class="literal">ChasePlayer</code>.</p></li><li><p>The first line of this script holds a reference to the <span class="strong"><strong>NavMeshAgent</strong></span> component that we set up earlier. We need access to this component in order to move the enemy tank.</p><div class="informalexample"><pre class="programlisting">public NavMeshAgent agent;</pre></div></li><li><p>The last segment of the code first makes sure that we have our <span class="strong"><strong>NavMeshAgent</strong></span> reference and then updates our goal destination. It uses the <code class="literal">PlayerPosition</code> script's variable that was set up earlier and the <code class="literal">SetDestination</code> function from the <span class="strong"><strong>NavMeshAgent</strong></span>. Once we tell the function where to go, the <span class="strong"><strong>NavMeshAgent</strong></span> component does all the hard work of getting us there. We update our goal destination in the <code class="literal">FixedUpdate</code> function because we do not need to update the destination in every frame. Updating this too often could cause a serious lag issue if there are a whole lot of enemies. The <code class="literal">FixedUpdate</code> function is called at regular intervals and is slower than the frame rate, so it is perfect.</p><div class="informalexample"><pre class="programlisting">public void FixedUpdate() {
  if(agent == null) return;

  agent.SetDestination(PlayerPosition.position);
}</pre></div></li><li><p>We now need to add the <a id="id320" class="indexterm"></a>script to our enemy tank. Select the prefab in the <span class="strong"><strong>Project</strong></span> window and drag and drop the script in the <span class="strong"><strong>Inspector</strong></span> panel, underneath the <span class="strong"><strong>NavMeshAgent</strong></span> component.</p></li><li><p>Be sure to connect the reference, as we did previously. Drag the <span class="strong"><strong>NavMeshAgent</strong></span> component to the <span class="strong"><strong>Agent</strong></span> value in the <span class="strong"><strong>Inspector</strong></span> window.</p></li><li><p>Play the game now to try it out. Irrespective of the location where the enemy starts, it finds its way around all the buildings and makes it to the player's position. As you drive around, you can watch the enemy follow. However, the enemy tank could end up going through our tank and we could drive through it as well.</p></li><li><p>The first step to fix this is to add some colliders. Add a <span class="strong"><strong>Box Collider</strong></span> component by using the <span class="strong"><strong>Physics</strong></span> option in the <span class="strong"><strong>Component</strong></span> menu for the turret, chassis, and each of the <span class="strong"><strong>TreadCase</strong></span> objects. Neither the cannon nor the treads need colliders. The tread casings already cover the area of the treads, and the cannon is too small a target to be shot at properly.</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_05_05.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note11"></a>Note</h3><p>If you are making any of these changes in the <span class="strong"><strong>Scene</strong></span> view, be sure to click on the <span class="strong"><strong>Apply</strong></span> button in the <span class="strong"><strong>Inspector</strong></span> window to update the root prefab object.</p></div></li><li><p>The last thing to<a id="id321" class="indexterm"></a> change is the <span class="strong"><strong>Stopping Distance</strong></span> property on the <span class="strong"><strong>NavMeshAgent</strong></span> component. When the tanks engage, they move into range and start firing. They do not try to occupy the same space as the enemy, unless that enemy is small and squishy. By setting <span class="strong"><strong>Stopping Distance</strong></span> to <code class="literal">10</code>, we will be able to replicate this behavior.</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_05_06.jpg" /></div></li></ol></div><p>In this section, we created a script that causes a <span class="strong"><strong>NavMeshAgent</strong></span> component, in this case our enemy tank, to chase the player. We added colliders to stop us from driving through the enemy. In addition, we adjusted the value of <span class="strong"><strong>Stopping Distance</strong></span> to give us a better tank behavior.</p><p>Try adding a blob shadow to the enemy tank. This will give it a better visual sense of being grounded. You can just copy the one that was made for the player's tank.</p></div></div>