<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec22"></a>Menus and victory</h2></div></div><hr /></div><p>Our <a id="id131" class="indexterm"></a>game <a id="id132" class="indexterm"></a>is nearly complete. The last things we need are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>An opening menu where players can start a new game</p></li><li style="list-style-type: disc"><p>A bit of code for checking whether anybody has won the game</p></li><li style="list-style-type: disc"><p>A game over menu for displaying who won the game</p></li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec16"></a>Setting up the elements</h3></div></div></div><p>Our two<a id="id133" class="indexterm"></a> new menus will be quite simple when compared to the game board. The opening menu will consist of our game's title graphic and a single button, while the game over menu will have a text element to display the victory message and a button to go back to the main menu. Let's perform the following steps to set up the elements:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's start with the opening menu by creating a new <span class="strong"><strong>Canvas</strong></span>, just like we did before, and rename it <code class="literal">OpeningMenu</code>. This will allow us to keep it separate from the other screens we have created.</p></li><li><p>Next, the menu needs an <span class="strong"><strong>Image</strong></span> element and a <span class="strong"><strong>Button</strong></span> element as children.</p></li><li><p>To make everything easier to work with, turn off the game boards with the checkbox at the top of their <span class="strong"><strong>Inspector</strong></span> windows.</p></li><li><p>For our image object, we can drag our <span class="strong"><strong>Title</strong></span> image to the <span class="strong"><strong>Source Image</strong></span> slot.</p></li><li><p>For the image's <span class="strong"><strong>Rect Transform</strong></span>, we need to set the <span class="strong"><strong>Pos X</strong></span> and <span class="strong"><strong>Pos Y</strong></span> values to <code class="literal">0</code>.</p></li><li><p>We also need to adjust the <span class="strong"><strong>Width</strong></span> and <span class="strong"><strong>Height</strong></span>. We are going to match the dimensions of the original image so that it will not be stretched. Put a value of <code class="literal">320</code> for <span class="strong"><strong>Width</strong></span> and <code class="literal">160</code> for <span class="strong"><strong>Height</strong></span>.</p></li><li><p>To move the image to the top half of the screen, put a <code class="literal">0</code> in the <span class="strong"><strong>Pivot Y</strong></span> slot. This changes where the position is based for the image.</p></li><li><p>For the button's <span class="strong"><strong>Rect Transform</strong></span>, we again need the value of <code class="literal">0</code> for both <span class="strong"><strong>Pos X</strong></span> and <span class="strong"><strong>Pos Y</strong></span>.</p></li><li><p>We again need a value of <code class="literal">320</code> for the <span class="strong"><strong>Width</strong></span>, but this time we want a value of <code class="literal">100</code> for the <span class="strong"><strong>Height</strong></span>.</p></li><li><p>To move <a id="id134" class="indexterm"></a>it to the bottom half of the screen, we need a value of <code class="literal">1</code> in the <span class="strong"><strong>Pivot Y</strong></span> slot.</p></li><li><p>Next up is to set the images for the button, just like we did earlier for the game board. Put the <code class="literal">ButtonNormal</code> image in the <span class="strong"><strong>Source Image</strong></span> slot. Change <span class="strong"><strong>Transition</strong></span> to <span class="strong"><strong>SpriteSwap</strong></span> and put the <code class="literal">ButtonActive</code> image in the <span class="strong"><strong>Pressed Sprite</strong></span> slot. Do not forget to change <span class="strong"><strong>Color</strong></span> to have an <span class="strong"><strong>A</strong></span> value of <code class="literal">255</code> in the color picker so that our button is not partially faded.</p></li><li><p>Finally, for this menu to change the button text, expand <span class="strong"><strong>Button</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> and select the <span class="strong"><strong>Text</strong></span> child object.</p></li><li><p>Right underneath <span class="strong"><strong>Text</strong></span> in the <span class="strong"><strong>Inspector</strong></span> panel for this object is a text field where we can change the text displayed on the button. A value of <code class="literal">New Game</code> here will work well. Also, change <span class="strong"><strong>Font Size</strong></span> to <code class="literal">45</code> so that we can actually read it.</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_02_05.jpg" /></div></li><li><p>Next, we need to create the game over menu. So, turn off our opening menu and create <a id="id135" class="indexterm"></a>a new canvas for our game over menu. Rename it <code class="literal">GameOverMenu</code> so that we can continue to be organized.</p></li><li><p>For this menu, we need a <span class="strong"><strong>Text</strong></span> element and a <span class="strong"><strong>Button</strong></span> element as its children.</p></li><li><p>We will set this one up in an almost identical way to the previous one. Both the text and button need values of <code class="literal">0</code> for the <span class="strong"><strong>Pos X</strong></span> and <span class="strong"><strong>Pos Y</strong></span> slots, with a value of <code class="literal">320</code> for <span class="strong"><strong>Width</strong></span>.</p></li><li><p>The text will use a <span class="strong"><strong>Height</strong></span> of <code class="literal">160</code> and a <span class="strong"><strong>Pivot Y</strong></span> of <code class="literal">0</code>. We also need to set its <span class="strong"><strong>Font Size</strong></span> to <code class="literal">80</code>. You can change the default text, but it will be overwritten by our code anyway.</p></li><li><p>To center our text in the menu, select the middle buttons from the two sets next to the <span class="strong"><strong>Alignment</strong></span> property.</p></li><li><p>The button will use a <span class="strong"><strong>Height</strong></span> of <code class="literal">100</code> and a <span class="strong"><strong>Pivot Y</strong></span> of <code class="literal">1</code>.</p></li><li><p>Also, be sure you set the <span class="strong"><strong>Source Image</strong></span>, <span class="strong"><strong>Color</strong></span>, <span class="strong"><strong>Transition</strong></span>, and <span class="strong"><strong>Pressed Sprite</strong></span> to the proper images and settings.</p></li><li><p>The last thing to set is the button's text child. Set the default text to <span class="strong"><strong>Main Menu</strong></span> and give it a <span class="strong"><strong>Font Size</strong></span> of <code class="literal">45</code>.</p><div class="mediaobject"><img src="/graphics/9781784394691/graphics/4691OT_02_06.jpg" /></div></li></ol></div><p>That is it for <a id="id136" class="indexterm"></a>setting up our menus. We have all the screens we need to allow the player to interact with our game. The only problem is we don't have any of the functionality to make them actually do anything.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec17"></a>Adding the code</h3></div></div></div><p>To <a id="id137" class="indexterm"></a>make our game board buttons work, we had to create a function in our script they could reference and call when they are touched. The main menu's button will start a new game, while the game over menu's button will change screens to the main menu. We will also need to create a little bit of code to clear out and reset the game board when a new game starts. If we don't, it will be impossible for the player to play more than one round before being required to restart the whole app if they want to play again.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open the <code class="literal">TicTacToeControl</code> script so that we can make some more changes to it.</p></li><li><p>We will start with the addition of three variables at the top of the script. The first two will keep track of the two new menus, allowing us to turn them on and off as per our need. The third is for the text object in the game over screen that will give us the ability to put up a message based on the result of the game.</p></li><li><p>Next, we <a id="id138" class="indexterm"></a>need to create a new function. The <code class="literal">NewGame</code> function will be called by the button in the main menu. Its purpose is to reset the board so that we can continue to play without having to reset the whole application:</p><div class="informalexample"><pre class="programlisting">public void NewGame() {</pre></div></li><li><p>The function starts by setting the game to start on the X player's turn. It then creates a new array of <code class="literal">SquareStates</code>, which effectively wipes out the old game board. It then sets the turn indicators for both the <span class="strong"><strong>Landscape</strong></span> and <span class="strong"><strong>Portrait</strong></span> sets of controls:</p><div class="informalexample"><pre class="programlisting">xTurn = true;
board = new SquareState[9];
turnIndicatorLandscape.text = "X's Turn";
turnIndicatorPortratit.text = "X's Turn";</pre></div></li><li><p>We next loop through the nine buttons and squares for both the <span class="strong"><strong>Portrait</strong></span> and <span class="strong"><strong>Landscape</strong></span> controls. All the buttons are turned on and the squares are turned off using <code class="literal">SetActive</code>, which is the same as clicking on the little checkbox at the top-left corner of the <span class="strong"><strong>Inspector</strong></span> panel:</p><div class="informalexample"><pre class="programlisting">for(int i=0;i&lt;9;i++) {
  buttonsPortrait[i].SetActive(true);
  squaresPortrait[i].gameObject.SetActive(false);

  buttonsLandscape[i].SetActive(true);
  squaresLandscape[i].gameObject.SetActive(false);
}</pre></div></li><li><p>The last three lines of code control which screens are visible when we change over to the game board. By default, it chooses to turn on the <span class="strong"><strong>Landscape</strong></span> board and makes sure that the <span class="strong"><strong>Portrait</strong></span> board is turned off. It then turns off the main menu. Don't forget the last curly bracket to close off the function:</p><div class="informalexample"><pre class="programlisting">  gameBoardGroupPortrait.SetActive(false);
  gameBoardGroupLandscape.SetActive(true);
  mainMenuGroup.SetActive(false);
}</pre></div></li><li><p>Next, we need to add a single line of code to the end of the <code class="literal">ButtonClick</code> function. It is a simple call to check whether anyone has won the game after the buttons and squares have been dealt with:</p><div class="informalexample"><pre class="programlisting">CheckVictory();</pre></div></li><li><p>The <code class="literal">CheckVictory</code> function<a id="id139" class="indexterm"></a> runs through the possible combinations for victory in the game. If it finds a run of three matching squares, the <code class="literal">SetWinner</code> function will be called and the current game will end:</p><div class="informalexample"><pre class="programlisting">public void CheckVictory() {</pre></div></li><li><p>A victory in this game is a run of three matching squares. We start by checking the column that is marked by our loop. If the first square is not <code class="literal">Clear</code>, compare it to the square below; if they match, check it against the square below that. Our board is stored as a list but drawn as a grid, so we have to add three to go down a square. The <code class="literal">else if</code> statement follows with checks of each row. By multiplying our loop value by three, we will skip down a row of each loop. We'll again compare the square to <code class="literal">SquareState.Clear</code>, then to the square to its right, and finally, with the two squares to its right. If either set of conditions is correct, we'll send the first square in the set to another function to change our game screen:</p><div class="informalexample"><pre class="programlisting">for(int i=0;i&lt;3;i++) {
  if(board[i] != SquareState.Clear &amp;&amp; board[i] == board[i + 3] &amp;&amp; board[i] == board[i + 6]) {
    SetWinner(board[i]);
    return;
  }
  else if(board[i * 3] != SquareState.Clear &amp;&amp; board[i * 3] == board[(i * 3) + 1] &amp;&amp; board[i * 3] == board[(i * 3) + 2]) {
    SetWinner(board[i * 3]);
    return;
  }
}</pre></div></li><li><p>The following code snippet is largely the same as the <code class="literal">if</code> statements we just saw. However, these lines of code check the diagonals. If the conditions are <code class="literal">true</code>, again send out to the other function to change the game screen. You have probably also noticed the returns after the function calls. If we have found a winner at any point, there is no need to check any more of the board. So, we'll exit the <code class="literal">CheckVictory</code> function early:</p><div class="informalexample"><pre class="programlisting">if(board[0] != SquareState.Clear &amp;&amp; board[0] == board[4] &amp;&amp; board[0] == board[8]) {
  SetWinner(board[0]);
  return;
}
else if(board[2] != SquareState.Clear &amp;&amp; board[2] == board[4] &amp;&amp; board[2] == board[6]) {
  SetWinner(board[2]);
  return;
}</pre></div></li><li><p>This is<a id="id140" class="indexterm"></a> the last little bit for our <code class="literal">CheckVictory</code> function. If no one has won the game, as determined by the previous parts of this function, we have to check for a tie. This is done by checking all the squares of the game board. If any one of them is <code class="literal">Clear</code>, the game has yet to finish and we exit the function. But, if we make it through the entire loop without finding a <code class="literal">Clear</code> square, we set the winner by declaring a tie:</p><div class="informalexample"><pre class="programlisting">for(int i=0;i&lt;board.Length;i++) {
  if(board[i] == SquareState.Clear)
    return;
}
SetWinner(SquareState.Clear);
}</pre></div></li><li><p>Next, we create the <code class="literal">SetWinner</code> function that is called repeatedly in our <code class="literal">CheckVictory</code> function. This function passes who has won the game, and it initially turns on the game over screen and turns off the game board:</p><div class="informalexample"><pre class="programlisting">public void SetWinner(SquareState toWin) {
  gameOverGroup.SetActive(true);
  gameBoardGroupPortrait.SetActive(false);
  gameBoardGroupLandscape.SetActive(false);</pre></div></li><li><p>The function then checks to see who won and picks an appropriate message for the <code class="literal">victorText</code> object:</p><div class="informalexample"><pre class="programlisting">  if(toWin == SquareState.Clear) {
    victorText.text = "Tie!";
  }
  else if(toWin == SquareState.XControl) {
    victorText.text = "X Wins!";
  }
  else {
    victorText.text = "O Wins!";
  }
}</pre></div></li><li><p>Finally, we have the <code class="literal">BackToMainMenu</code> function. This is short and sweet; it is simply called by the button on the game over screen to switch back to the main menu:</p><div class="informalexample"><pre class="programlisting">public void BackToMainMenu() {
  gameOverGroup.SetActive(false);
  mainMenuGroup.SetActive(true);
}</pre></div></li></ol></div><p>That is all<a id="id141" class="indexterm"></a> the code we have in our game. We have all the visual pieces that make up our game and now, we also have all the functional pieces. The last step is to put them together and finish the game.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec18"></a>Putting them together</h3></div></div></div><p>We have <a id="id142" class="indexterm"></a>our code and our menus. Once we connect them together, our game will be complete. To put it all together, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Go back to the Unity Editor and select the <span class="strong"><strong>GameControl</strong></span> object from the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>The three new properties in its <span class="strong"><strong>Inspector</strong></span> window need to be filled in. Drag the <span class="strong"><strong>OpeningMenu</strong></span> canvas to the <span class="strong"><strong>Main Menu Group</strong></span> slot and <span class="strong"><strong>GameOverMenu</strong></span> to the <span class="strong"><strong>Game Over Group</strong></span> slot.</p></li><li><p>Also, find the text object child of <span class="strong"><strong>GameOverMenu</strong></span> and drag it to the <span class="strong"><strong>Victor Text</strong></span> slot.</p></li><li><p>Next, we need to connect the button functionality for each of our menus. Let's start by selecting the button object child of our <span class="strong"><strong>OpeningMenu</strong></span> canvas.</p></li><li><p>Click on the little plus sign at the bottom right of its <span class="strong"><strong>Button (Script)</strong></span> component to add a new functionality slot.</p></li><li><p>Click on the circle in the center of the new slot and select <span class="strong"><strong>GameControl</strong></span> from the new pop-up window, just like we did for each of our game board buttons.</p></li><li><p>The drop-down list that currently says <span class="strong"><strong>No Function</strong></span> is our next target. Click on it and navigate to <span class="strong"><strong>TicTacToeControl</strong></span> | <span class="strong"><strong>NewGame ()</strong></span>.</p></li><li><p>Repeat these few steps to add the functionality to the Button child of <span class="strong"><strong>GameOverMenu</strong></span>. Except, select <span class="strong"><strong>BackToMainMenu()</strong></span> from the list.</p></li><li><p>The very last thing to do is to turn off both the game boards and the game over menu, using the checkbox in the top left of the <span class="strong"><strong>Inspector</strong></span>. Leave only the opening menu on so that our game will start there when we play it.</p></li></ol></div><p>Congratulations! This is our game. All our buttons are set, we have multiple menus, and we even created a game board that changes based on the orientation of the player's device. The last<a id="id143" class="indexterm"></a> thing to do is to build it for our devices and go show it off.</p></div></div>