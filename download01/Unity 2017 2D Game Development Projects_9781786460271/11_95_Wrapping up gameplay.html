<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec93"></a>Wrapping up gameplay</h2></div></div><hr /></div><p>To efficiently complete our game, we still need to insert a couple of gameplay components. This section will quickly go through them, to guide you. In fact, you have already seen most of this stuff in previous chapters and with the previous projects, so for an in-depth explanation, you can revise your work on the other projects.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec112"></a>Creating the user interface</h3></div></div></div><p>We have seen a lot of user interface in the past two projects. Thus, I won't bother repeating how to create a score or a lives counter along with their respective scripts. Rather, this is left as an exercise for you. In particular, you can challenge yourself with the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Game Over Screen</strong></span>: When the player falls in the water, a screen message should appear to the player saying that it's game over. Once you have created this screen, you can integrate it with the <strong class="userinput"><code>WaterZone</code></strong> script of the next section.</li><li style="list-style-type: disc"><span class="strong"><strong>Winning Screen</strong></span>: Very similar to the <span class="emphasis"><em>Game Over Screen</em></span>, this message appears to the player when he or she finishes the game (reaches the end of the level). Prepare this message, so you can integrate it with the <strong class="userinput"><code>WinningZone</code></strong> script a couple of sections ahead.</li><li style="list-style-type: disc"><span class="strong"><strong>Score System</strong></span>: Create a scoring system in which the player collects objects around the map and earns points doing so. The scoring system should have the following features:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Show the score on-screen</li><li style="list-style-type: disc">Save the score with the Save System we created before
</li><li style="list-style-type: disc">Keep between levels (meaning that the score needs to be loaded at the beginning of each level, or put into a persistent scene)</li></ul></div></li><li style="list-style-type: disc"><span class="strong"><strong>Main Menu</strong></span>: Create a main menu for your game, in which the player can load a previous save so the player can choose a slot. Otherwise, the player can choose a new slot and start a new game. However, before the game starts, the system should ask the player for the name.</li><li style="list-style-type: disc"><span class="strong"><strong>Leaderboard</strong></span>: If you are in the mood for a challenge, why not try implementing a leaderboard? Order the different players that you have for the slots in a leaderboard, showing first who has the highest score.</li></ul></div><p>Keep in mind that we're not yet done completely with the user interface. If you recall from <a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>Let's Get Physical</em></span>, the Movement Component can take input also from UI controllers, to adapt the game to run on mobile devices. This is something that we are going to explore and learn in the next chapter.</p><p>As for the moment, let’s finish up our gameplay!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec113"></a>Water zones</h3></div></div></div><p>In our level, like in the following screenshot, there is water. Therefore we need to decide what happens when the player falls into the water.</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/b6de01aa-5534-4cb5-a779-caded5e5d155.png" /></div><p>First of all, we need to adjust the water <strong class="userinput"><code>Sorting Layer</code></strong>, so that it appears preceding the player. So, select the child of <strong class="userinput"><code>Water</code></strong> from the <strong class="userinput"><code>Hierarchy</code></strong> panel, and change the <strong class="userinput"><code>Sorting Layer</code></strong> to <strong class="userinput"><code>2</code></strong> in the <strong class="userinput"><code>Sorting Layer Exposed (Script)</code></strong> component, shown as follows: </p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/5ba79aa4-678f-4870-91e6-ae7495c98c31.png" /></div><p>This is how it now appears in the game:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/d69c6bf5-a240-4c35-a7c3-597b61d36972.png" /></div><p>Water already has a collider, but we need to set it as <strong class="userinput"><code>Is Trigger</code></strong>, if it is not already:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/b18d1e93-7c6f-4e00-8ae7-61c5393c3ac6.png" /></div><p>Also, Unity comes with a <strong class="userinput"><code>Water</code></strong> layer as default, so we can just set it as <strong class="userinput"><code>Water</code></strong> for good practice, and so change all its children as well:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/a71a4c3f-388f-487b-92dc-b3a00176cbb0.png" /></div><p>Now, we need to create a script to restart the level once the player falls in the water (in our case, touches the water).</p><p>Let's start by creating a new C# script and naming it <code class="literal">WaterZone</code>. Let's add the requirement for a collider at the beginning of the class:</p><pre class="programlisting"><span class="strong"><strong>[RequireComponent(typeof(Collider2D))]</strong></span>
public class WaterZone : MonoBehaviour {
            //[...]
}</pre><p>Next, we need to add the <span class="emphasis"><em>using-statement</em></span> to use the Scene Manager (otherwise, as we did in our Space Shooter game, when we implement the lives counter, <span>we can reference it directly within the line of code)</span>:</p><pre class="programlisting"><span class="strong"><strong>using UnityEngine.SceneManagement;</strong></span>

[RequireComponent(typeof(Collider2D))]
public class WaterZone : MonoBehaviour {
            //[...]
}</pre><p>Afterwards, we can use the <code class="literal">OnTriggerEnter2D()</code> function to detect when the player touches the water. However, we don't want to immediately restart the scene as soon as the player touches the water, we need to insert a delay. To do so, let's implement a coroutine. Add a new variable to set how much delay should pass before restarting the level:</p><pre class="programlisting">   [SerializeField]
    private float timeDelay = 1.0f;</pre><p>Then, implement the coroutine. The first thing shown is a <strong class="userinput"><code>Game Over</code></strong> message (which is left as an exercise), then the script waits for <code class="literal">timeDelay</code> before restarting the scene:</p><pre class="programlisting">   private IEnumerator restartScene() {
        //Show a gameover message (left as exercise)

        //Wait timeDelay
        yield return new WaitForSeconds(timeDelay);

        //Restart Scene
        SceneManager.LoadScene("level1"); //substitute "level1" with 
        the name of your level, 
        also be sure to add the scene to the build settings
    }</pre><p>If you don't want to hardcode the name of your scene into the script, you can reload the same scene which is currently active in the <code class="literal">SceneManager</code>. Here is the code you need:</p><pre class="programlisting">//Get the name of the current scene (i.e. level)
string sceneName = SceneManager.GetActiveScene().name;
//(Re-)load the same scene / level.
SceneManager.LoadScene(sceneName);</pre><p>Finally, implement the <code class="literal">OnTriggerEnter2D()</code> function by starting the <code class="literal">restartScene()</code> coroutine:</p><pre class="programlisting">   private void OnTriggerEnter2D(Collider2D collision) {
        //If the player enters within the Water Zone, 
        then restart the scene
        if (collision.CompareTag("Player")) {
            StartCoroutine(restartScene());
        }
    }</pre><p>Save the script and add it to the <strong class="userinput"><code>Water</code></strong> game object. From now on, every time the player touches the water, the game will restart after a small delay.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec114"></a>Winning zone</h3></div></div></div><p>Similar to what we did for the Water zone, we need to create an endpoint for our map. Once the player reaches the endpoint, the game will show a message (left as an exercise) and load the next level. Since the structure is so similar to the Water zone, here is the direct script, which should be self-explanatory:</p><pre class="programlisting">using UnityEngine;
using UnityEngine.SceneManagement;

[RequireComponent(typeof(Collider2D))]
public class WinningZone : MonoBehaviour {

    [SerializeField]
    private float timeDelay = 1.0f;

    [SerializeField]
    private string nextLevelToLoad = "level2"; 
    //substitute with the next level to load. 
    Be sure it is included in the build settings.

    private IEnumerator loadNextLevel() {
        //Show a winning message (left as exercise)

        //Wait timeDelay
        yield return new WaitForSeconds(timeDelay);

        //Restart Scene
        SceneManager.LoadScene(nextLevelToLoad); 
       //load the level named as in the nextLevelToLoad variable.
    }

    private void OnTriggerEnter2D(Collider2D collision) {
        //If the player enters within the Water Zone, 
        then restart the scene
        if (collision.CompareTag("Player")) {
            StartCoroutine(loadNextLevel());
        }
    }
}</pre></div></div>