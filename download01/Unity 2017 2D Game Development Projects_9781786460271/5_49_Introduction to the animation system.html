<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec53"></a>Introduction to the animation system</h2></div></div><hr /></div><p>Unity has a brilliant and effective animation system named <span class="strong"><strong>Mecanim</strong></span>. It works wonderfully with 3D animation, as well as for 2D animations. However, we will use some basic features, since we are going to use just a couple of Sprite animations to begin with.</p><p>Of course, feel free to explore the official documentation by visiting <a class="ulink" href="https://docs.unity3d.com/Manual/AnimationSection.html" target="_blank">https://docs.unity3d.com/Manual/AnimationSection.html</a> or following the official video tutorial: <a class="ulink" href="https://unity3d.com/learn/tutorials/s/animation" target="_blank">https://unity3d.com/learn/tutorials/s/animation</a>.</p><p>When it comes to the animation system in Unity, we can talk about State Machines. Each animation is a node and the character can change animation according to certain variables of the State Machine. You can see an example of an animation State Machine in the following image. Keep in mind that, usually, animation state machines are much bigger and more complex in a real project than the ones used to explain how they work:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/88d9f954-17c4-421d-99cc-21727d2b7559.png" /></div><p>For our game, we will be implementing an explosion animation each time something is destroyed. It is a simple animation, but by showing you how to create it, you will be able to implement other types of animations for other elements of not only the games within this book but also your own projects. However, for our project, the animations will come into effect when the player's spaceship runs out of life, and when enemies' spaceships, planets, and comets are destroyed.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec73"></a>Concepts of Sprite animations</h3></div></div></div><p>Although the animation system in Unity is very powerful, and it is able to animate to a certain degree, often external programs are used. In the case of 3D animations, programs such as <span class="strong"><strong>3DStudioMax</strong></span>, <span class="strong"><strong>Maya</strong></span>, or <span class="strong"><strong>Blender</strong></span> are used. When it comes to 2D animations, the most-used technique is an animation Sprite Sheet. In short, it is a sprite sheet containing all the frames of the animation. They can be created with any program that manipulates 2D graphics. Some of these programs include Photoshop, GIMP, or Illustrator (in case you want vector graphics).</p><p>For instance, in our case, we've got two animation Sprite Sheets, one for each kind of explosion. Let us take one of them, for instance, <code class="literal">explosion02</code>. Here is what it looks like:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/75805802-79e8-40d6-8224-8a34a7ec5cc5.jpg" /></div><p>As you can see, there are 12 frames, and each one of them is properly spaced within the sheet. Having things properly spaced is essential to simplify the workflow in Unity. If you select the sheet in the <strong class="userinput"><code>Project</code></strong> window, we can see its <strong class="userinput"><code>Import Settings</code></strong> in the <strong class="userinput"><code>Inspector</code></strong>. We need to select <strong class="userinput"><code>Multiple</code></strong> for the <strong class="userinput"><code>Sprite Mode</code></strong>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/c12303b4-5955-4ae1-aa58-8ca803cf6284.png" /></div><p>After you have clicked <strong class="userinput"><code>Apply</code></strong>, we need to open the <strong class="userinput"><code>Sprite Editor</code></strong> by clicking the <strong class="userinput"><code>Sprite Editor</code></strong> button, so we can properly <strong class="userinput"><code>Slice</code></strong> the animation Sprite Sheet:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/be413259-629a-4e7f-af75-efd2024c16c7.png" /></div><p>On the top bar of the <strong class="userinput"><code>Sprite Editor</code></strong>, click <strong class="userinput"><code>Slice</code></strong>. Select <strong class="userinput"><code>Grid By Cell Count</code></strong> as the type, and insert <code class="literal">12</code> columns and <code class="literal">1</code> row. In case you have a different sprite sheet with a different number of frames, use the number of columns or rows of your animation. Here is what it should look like:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/157c02cb-73aa-439b-99d3-cbf355bd24dc.png" /></div><p>Then, press the <strong class="userinput"><code>Slice</code></strong> button at the bottom of the window. As a result, each frame of our animation is a different Sprite, and they are also numbered from zero in order (something that might be very useful in large projects). Click <strong class="userinput"><code>Apply</code></strong> in the top-right corner and close the <strong class="userinput"><code>Sprite Editor</code></strong>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec74"></a>Generating the animations from the sprites</h3></div></div></div><p>The last step to generate the animation is to expand the <strong class="userinput"><code>explosion</code></strong> sheet with all the frames as single Sprites in the <strong class="userinput"><code>Project</code></strong> panel, as shown here:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/9e9932fe-9a78-42e0-b0bb-2590b5045885.png" /></div><p>Select all the frames, and drag and drop them on the <strong class="userinput"><code>Scene</code></strong> view. Unity will ask you where you want to save the animation and under which name. Select the <code class="literal">animation</code> folder (if you do not have one, create it), and type <code class="literal">explosionAnimation</code> for the name. Finally, save it.</p><p>A few considerations now. If you hit play, you can see the animation playing continuously on the screen, but let us see how it works under the hood. First, navigate to the <code class="literal">animation</code> folder, and you will notice that two files have been created. One is the animation that we have just saved, and the other one is the animation State Machine we were discussing just before and it is named as the first frame of the animation Sprite Sheet, in this case, <code class="literal">explosion02_0</code><strong class="userinput"><code>,</code></strong> but you can rename it <code class="literal">explosion02_animator</code>. If you double-click the State Machine, the <strong class="userinput"><code>Animator</code></strong> window comes up showing you the State Machine, and here is how it looks:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/82ee2db9-763a-47c8-a7ff-ef38fab364b8.png" /></div><p>The important thing to pick up here is that, from the <span class="strong"><strong>Entry</strong></span> node, there is a link to our animation represented by another node. This means that as soon as the object running this machine plays, our animation is running, which is exactly what we want. We won't dig any further into animation during the development of this second project, but we will discuss the animation system more in the last project of this book.</p><p>Now, coming back to the <strong class="userinput"><code>Project</code></strong> panel, if we select the animation, we can see its properties in the <strong class="userinput"><code>Inspector</code></strong>. Since the explosion is not a continuous animation, but rather a one-shot animation, we need to uncheck <strong class="userinput"><code>Loop Time</code></strong>, as shown in the following image:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/8b674428-06d7-4e1a-85b2-e188826c1838.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec75"></a>Adding a state behavior for destroying the explosion</h3></div></div></div><p>If you hit play, the animation will play only once. However, the object won't be destroyed as we would expect. This can be done with a very simple script, which is a <code class="literal">StateMachineBehavior</code>. We take this script from the book <span class="emphasis"><em>Getting</em></span><span class="emphasis"><em>Started with Unity 5.x 2D Game Development</em></span> (<a class="ulink" href="https://www.packtpub.com/game-development/getting-started-unity-5x-2d-game-development" target="_blank">https://www.packtpub.com/game-development/getting-started-unity-5x-2d-game-development</a>), which, once again, I suggest you read to get more insight into 2D game development. Thus, for the detailed explanation of this script, check out <span class="emphasis"><em>Chapter 4, No Longer Alone - Sweet Toothed Pandas Strike</em></span>, of that book. Here, we will just see how to create and use that script, without explaining in detail how the <code class="literal">StateMachineBehavior</code> script works.</p><p>Create a new script, and name it <code class="literal">StateMachineBehaviour_DestroyOnExit</code>. Open it, erase all the code in it, and instead paste the following:</p><pre class="programlisting">using UnityEngine;
public class StateMachineBehaviour_DestroyOnExit : StateMachineBehaviour {
    override public void OnStateExit(Animator Animator, AnimatorStateInfo stateInfo, int layerIndex) {
        //Destroy the gameobject where the Animator is attached to
        Destroy(Animator.gameObject);
    }
}</pre><p>Save the script, and open the state machine of our explosion. Right-click the <strong class="userinput"><code>animation</code></strong> node, click <strong class="userinput"><code>Make Transition</code></strong>, then click the <strong class="userinput"><code>Exit</code></strong> node. As a result, you will see an arrow going toward the <strong class="userinput"><code>Exit</code></strong> state, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/7a8a39b7-8f2f-4ad5-95b2-7615dd2fc0d2.png" /></div><p>Now, click the <strong class="userinput"><code>animation</code></strong> node, and in the <strong class="userinput"><code>Inspector</code></strong>, you should see an <strong class="userinput"><code>Add</code></strong><strong class="userinput"><code>Behaviou</code></strong><span class="strong"><strong>r</strong></span> button click it and add the script we have just created. Then, select the only <strong class="userinput"><code>Transition</code></strong> under the <strong class="userinput"><code>Transitions</code></strong> tab, and some settings will appear. Set <strong class="userinput"><code>Exit Time</code></strong> to <code class="literal">1</code> and <strong class="userinput"><code>Transition Duration</code></strong> to <code class="literal">0</code>. Here is how it looks:</p><div class="mediaobject"><img src="/graphics/9781786460271/graphics/fe7117fd-e2ce-47c4-9858-d2e3fceac150.png" /></div><p>If we play the game now, the explosion should work. For more explanations of this process, you can read the book suggested before, but in any case, we will explore the animation system in the last project of this book.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec76"></a>Saving the explosion as a prefab</h3></div></div></div><p>We already talked about prefabs in the last project, so you should have a good understanding of their usefulness. The last step for creating this explosion is to save it within a prefab, so we can use it every time we need an explosion, and not only a random explosion every time the game starts.</p><p>In the <code class="literal">Prefab</code> folder, create a new prefab, and name it <code class="literal">ExplosionPrefab</code>. Then, simply drag and drop it on the <strong class="userinput"><code>Explosion</code></strong> object in the <strong class="userinput"><code>Hierarchy</code></strong> window. It should become blue after this process, so you will know that it has become a prefab, and you can remove it from the scene. As a result, we can use the explosion prefab any time we need one.</p></div></div>