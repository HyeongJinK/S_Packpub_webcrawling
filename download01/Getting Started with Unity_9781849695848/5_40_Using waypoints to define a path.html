<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec42"></a>Using waypoints to define a path</h2></div></div><hr /></div><p>We will<a id="id501" class="indexterm"></a> now create a new type of enemy that will patrol <a id="id502" class="indexterm"></a>the maze. This character will navigate on a predefined path delimited by waypoints:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate the animator labeled <code class="literal">zombieController</code> from the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter5</strong></span> by selecting this object and then navigating to <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Duplicate</strong></span>, and rename it <code class="literal">zombiePatrolController</code>.</p></li><li><p>Double-click on this animator so that it opens in the <span class="strong"><strong>Animator</strong></span> window.</p></li><li><p>Rename <a id="id503" class="indexterm"></a>the state <span class="strong"><strong>Idle</strong></span><a id="id504" class="indexterm"></a> to <span class="strong"><strong>Patrol</strong></span>.</p></li><li><p>Locate the animation <code class="literal">WalkForward</code> by selecting <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter5</strong></span> | <span class="strong"><strong>chapter5_pack</strong></span>, within the prefab <code class="literal">Zombie@walkForward</code> (its icon is a white triangle within a gray box), or search it using the <span class="strong"><strong>Search</strong></span> field in the <span class="strong"><strong>Project</strong></span> window.<a id="id505" class="indexterm"></a> Drag-and-drop it to the variable <code class="literal">Motion</code> for the state <span class="strong"><strong>Patrol</strong></span> as highlighted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_05_15.jpg" /></div></li></ol></div><p>At this stage, we have created a new default state for our new type of enemy. This enemy will be moving based on waypoints. We will create four waypoints and determine, using scripting, which waypoint the zombie patroller should walk toward. Open the script <code class="literal">controlZombie</code><a id="id506" class="indexterm"></a> and add the next lines to the start of the script:</p><div class="informalexample"><pre class="programlisting">public var patrolState:int = Animator.StringToHash("Base Layer.Patrol");
private var wayPointIndex:int = 1;</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 1 of the previous code, we create a new variable to monitor the state <span class="strong"><strong>Patrol</strong></span></p></li><li style="list-style-type: disc"><p>In statement 2 of the previous code, we create an index that will be used to determine the next way point to walk forward</p></li></ul></div><p>Next, let's add the<a id="id507" class="indexterm"></a> following lines inside the function <code class="literal">Update</code> within<a id="id508" class="indexterm"></a> the <code class="literal">switch</code> structure:</p><div class="informalexample"><pre class="programlisting">case patrolState:
  transform.LookAt(GameObject.Find("wayPoint"+wayPointIndex).transform);
  var distanceToWayPoint:float = Vector3.Distance(transform.position,
  GameObject.Find("wayPoint"+wayPointIndex).transform.position);
  if ( distanceToWayPoint&lt; 1.0f) wayPointIndex++;
  if (wayPointIndex &gt; 4) wayPointIndex = 1;
break;</pre></div><p>In the<a id="id509" class="indexterm"></a> previous code, we check whether the state <code class="literal">Patrol</code><a id="id510" class="indexterm"></a> is active. The character looks in the direction of the next waypoint. We then <a id="id511" class="indexterm"></a>calculate the distance between the zombie and the next waypoint; locate the corresponding waypoint, and if the next waypoint is close enough, a new waypoint is defined.</p><p>Last but not least, we need to create these waypoints, place them on the scene, and link them to the script as shown in the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create an empty object and rename it <code class="literal">wayPoint1</code>.</p></li><li><p>Duplicate this object three times, and rename the copies <code class="literal">wayPoint2</code>, <code class="literal">wayPoint3</code>, and <code class="literal">wayPoint4</code>.</p></li><li><p>Change the positions of these waypoints to (x=-22, y=0, z=7), (x=-21, y=0, z=22), (x=-7, y=0, z=22), and (x=-7, y=0, z=7).</p></li><li><p>Duplicate the object <code class="literal">zombie_hires</code><a id="id512" class="indexterm"></a> and rename the duplicate patroller.</p></li><li><p>Change the position of this object patroller to (x=-14, y=-0.5, z=7).</p></li><li><p>Drag-and-drop the animator <code class="literal">zombiePatrolController</code> from <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter5</strong></span> to the <span class="strong"><strong>Animator</strong></span> component<a id="id513" class="indexterm"></a> of the object patroller as highlighted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_05_16.jpg" /></div></li></ol></div><p>Test the scene and check that the object patroller walks on the path determined by our waypoints. Note that we could create more waypoints if necessary, and the process would be similar to the one already described in this section.</p><p>Finally, <a id="id514" class="indexterm"></a>we will create a prefab from this patroller<a id="id515" class="indexterm"></a> object: select the folder <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter5</strong></span>; then navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Prefab</strong></span> from the <span class="strong"><strong>Project</strong></span> window, drag-and-drop the object labeled <code class="literal">patroller</code> on this prefab, and rename it <code class="literal">zombie_patroller</code>.</p></div>