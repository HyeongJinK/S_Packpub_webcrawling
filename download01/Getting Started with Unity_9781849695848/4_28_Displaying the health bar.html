<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec31"></a>Displaying the health bar</h2></div></div><hr /></div><p>At present, the player's health is saved in the script <code class="literal">collisionDetection</code>; however, it is not<a id="id260" class="indexterm"></a> represented on the screen. We will create a new script that<a id="id261" class="indexterm"></a> displays a health bar symbolized by a rectangle in the top-left corner of the screen. Its length will be proportional to the player's health (that is, ranging from 0 to 100 percent), and the color will also vary accordingly. For example, it will be green when the health is between 67 percent and 100 percent, orange when the health is between 33 percent and 67 percent, and red when the health is between 0 percent and 33 percent. These visual cues will help the player to judge when it is time to look for and collect med packs. Follow these steps to display the health bar:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new folder labeled <code class="literal">Scripts</code> by selecting <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter4</strong></span>.</p></li><li><p>Create a new script (JavaScript) inside this folder, rename it <code class="literal">HealthBar</code>, and add the following code to it:</p><div class="informalexample"><pre class="programlisting">private var  currHealth : int = 45;
private var currentColor:Texture2D;
public var style:GUIStyle;
public var redTexture:Texture2D;
public var greenTexture:Texture2D;
public var orangeTexture:Texture2D;
public var blackTexture:Texture2D;</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Line 1 of the previous code shows how the current health value is stored. It will be used to display health levels onscreen.</p></li><li style="list-style-type: disc"><p>Line 2 of the previous code shows how the texture will be used when the health bar is declared.</p></li><li style="list-style-type: disc"><p>Line 3 of the previous code shows how a <code class="literal">style</code> variable<a id="id262" class="indexterm"></a> is defined and will be used later on.</p></li><li style="list-style-type: disc"><p>Lines 4-7 of the previous code show how four <code class="literal">Texture2D</code> variables are created for the health bar.</p></li></ul></div></li></ol></div><p>We <a id="id263" class="indexterm"></a>can now use each of these textures to draw the health bar. Add the following code to the script <code class="literal">HealthBar</code>:</p><div class="informalexample"><pre class="programlisting">function OnGUI()
{
  if (currHealth &gt; =67) 
currentColor = greenTexture;
  else if (currHealth &gt;= 34) 
currentColor = orangeTexture; 
  else currentColor = redTexture;
  style.normal.background = blackTexture;
  GUI.Box(Rect(0,0, 100,20),"", style);
  style.normal.background = currentColor;
  GUI.Box(Rect(0,0, currHealth,20),"",style);
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Line 1 of the previous code shows how the built-in function <code class="literal">OnGUI</code> is defined. It will be used for the GUITextures.</p></li><li style="list-style-type: disc"><p>Lines 3 to 7 of the previous code show how the color of the health bar is set according to the value of the variable <code class="literal">currHealth</code> (that is, red, orange, or green).</p></li><li style="list-style-type: disc"><p>Lines 8 and 9 of the previous code show how we can draw a black rectangle behind the health bar, so that it can be seen easily against the background.</p></li><li style="list-style-type: disc"><p>Line 9 of the previous code shows how the black rectangle is drawn. Its top-left corner is located at the position (x=0, y=0), and it is 100 pixels wide and 20 pixels high. No default text is displayed. The color used is black (that is, the texture <code class="literal">blackTexture</code>).</p></li><li style="list-style-type: disc"><p>Lines 10 to 11 of the previous code show how we choose the current color for the health bar (for example, green, orange, or red) and the health bar is drawn.</p></li></ul></div><p>We now need to create an empty object and link it to this script to be able to display the health bar:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create an empty object and rename it <code class="literal">healthBar</code>.</p></li><li><p>Attach <a id="id264" class="indexterm"></a>this object to the script <code class="literal">healthBar</code><a id="id265" class="indexterm"></a> that we created previously.</p></li><li><p>Locate the <span class="strong"><strong>Red</strong></span> texture by selecting to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter4</strong></span> | <span class="strong"><strong>chapter4_pack</strong></span>.</p></li><li><p>Select the object <span class="strong"><strong>healthBar</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> view, and drag-and-drop the <span class="strong"><strong>Red</strong></span> <a id="id266" class="indexterm"></a>texture to the right of the variable called <code class="literal">redTexture</code> in the component called <span class="strong"><strong>Health Bar</strong></span>.</p></li><li><p>Repeat the previous two steps for the textures <span class="strong"><strong>Green</strong></span>, <span class="strong"><strong>Orange</strong></span>, and <span class="strong"><strong>Black</strong></span> as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_1.jpg" /></div></li><li><p>Play the scene; we should see a health bar in the top-left corner as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_2.jpg" /></div></li></ol></div><p>So far, it sounds great. However, we need to modify the script <code class="literal">collisionDetection</code>, so that <a id="id267" class="indexterm"></a>when a med pack is collected, the health bar is updated accordingly and turns to green. For this, we need to create a function in the script <code class="literal">healthBar</code> that can be called from the script <code class="literal">collisionDetection</code> when we collide with <a id="id268" class="indexterm"></a>a med pack.</p><p>Open the script <code class="literal">healthBar</code><a id="id269" class="indexterm"></a> and add the following function to it:</p><div class="informalexample"><pre class="programlisting">public function setHealth(updatedValue:int)
{
  currHealth = updatedValue;
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In line 1 of the previous code, we create a function that will be accessible from outside the script. It takes one parameter that is the new value to be displayed for the player's health.</p></li><li style="list-style-type: disc"><p>In line 3 of the previous code, the variable health is updated accordingly.</p></li></ul></div><p>Open<a id="id270" class="indexterm"></a> the script <code class="literal">collisionDetection</code> and modify the conditional statement linked to the med pack as follows (that is, add the code that is highlighted):</p><div class="informalexample"><pre class="programlisting">if (c.gameObject.tag == "medpack")
<span class="strong"><strong>{</strong></span>
  health = 100;
  <span class="strong"><strong>GameObject.Find("healthBar").GetComponent(healthBar).setHealth(health);</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Statement 1 of the previous code already existed in this script, but we have added curly brackets, as two different sets of instructions will be performed if the med pack is collected</p></li><li style="list-style-type: disc"><p>In Statement 4 of the previous code, as in the previous sections, we access the function <code class="literal">setHealth</code><a id="id271" class="indexterm"></a> within the script called <code class="literal">healthBar</code>, and we pass the value of the variable health as a parameter</p></li></ul></div><p>Play the scene, collect a med pack, and check that the health bar turns to green (100 percent) as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_3.jpg" /></div></div>