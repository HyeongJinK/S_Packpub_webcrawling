<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec32"></a>Displaying a mini-map of the level</h2></div></div><hr /></div><p>In this<a id="id272" class="indexterm"></a> section, <a id="id273" class="indexterm"></a>we will create a mini-map of the level to help the player navigate and anticipate the position of collectable objects or enemies. First, let's create a top-down view of the maze. To add a different view of the maze, we will create a new camera and display its content in the<a id="id274" class="indexterm"></a> top-right corner of the screen as shown in the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new camera (<span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>Camera</strong></span>).</p></li><li><p>Rename this camera <code class="literal">camera1</code>.</p></li><li><p>Rotate this camera about 90 degrees around the x axis, so that its rotation properties are (x=90, y=0, z=0), and change its position to (x=0, y=50, z=0).</p></li><li><p>If we click on this camera in the <span class="strong"><strong>Hierarchy</strong></span> view<a id="id275" class="indexterm"></a>, and look at <a id="id276" class="indexterm"></a>the camera preview (that is, the rectangle in the bottom-right corner of the <span class="strong"><strong>Scene</strong></span> view), we should see our level from above.</p></li></ol></div><p>We will <a id="id277" class="indexterm"></a>now add this camera to the main view, so that the <a id="id278" class="indexterm"></a>user can see this top view as part of the user interface. This will be done using view ports:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click once on the camera labeled <code class="literal">camera1</code>.</p></li><li><p>Look at the <span class="strong"><strong>Inspector</strong></span> window<a id="id279" class="indexterm"></a> and click on the arrow to the left of the camera component to reveal its properties.</p></li><li><p>Change the attribute <code class="literal">Normalized View Port Rect</code>, as follows: x=0.75, y=0.75, w=0.25, and h=0.25.</p></li><li><p>Change the attribute <code class="literal">Depth</code> to <code class="literal">1</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>These changes affect the view port, or the area of the screen where the camera view will be displayed. The view port is defined by a rectangle and a depth parameter. The x, y, w, and h parameters correspond to the coordinates of the top-left corner (x and y), the width of the rectangle (w), and its height (h). However, all four parameters are expressed as a proportion of the screen (that is, from 0.0 to 1.0). In our example, the rectangle or view port will occupy an eighth of the surface of the screen. The last parameter (<code class="literal">Depth</code>) is set to 1, because we need it to be drawn on top of the camera used for the <span class="strong"><strong>First Person Controller</strong></span>, for which the <code class="literal">Depth</code> is <code class="literal">0</code> (the camera with the highest depth value will be drawn on top).</p></div></li><li><p>Delete<a id="id280" class="indexterm"></a> the components <span class="strong"><strong>Audio Listener</strong></span>, <span class="strong"><strong>GUILayer</strong></span><a id="id281" class="indexterm"></a>, and <span class="strong"><strong>Flare Layer</strong></span><a id="id282" class="indexterm"></a> (right-click on the component and select <span class="strong"><strong>Remove Component</strong></span> from the contextual menu), as we will not need these.</p></li></ol></div><p>If we play the game, we can see a top-down view displayed in the top-right corner of the screen. However, some of the information displayed on this screen is not relevant (for example, <span class="strong"><strong>GUI text</strong></span> or <span class="strong"><strong>GUItexture</strong></span>). We need to filter the content displayed through this camera, and this can be achieved through layers. Unity3D makes it possible to define and apply layers. For example, some objects can be added to a layer, and we can then define what layers each camera will display. First, let's define layers for all active cameras:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on<a id="id283" class="indexterm"></a> the object <code class="literal">camera1</code> from the <span class="strong"><strong>Hierarchy</strong></span> window.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id284" class="indexterm"></a>, click on the drop-down menu to the right of the <span class="strong"><strong>Layer</strong></span> label:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_4.jpg" /></div></li><li><p>Select the option <span class="strong"><strong>Add Layer</strong></span><a id="id285" class="indexterm"></a> from the drop-down menu.</p></li><li><p>This <a id="id286" class="indexterm"></a>should open a new window labeled <a id="id287" class="indexterm"></a>
<span class="strong"><strong>Tag Manager</strong></span>, which is the same window we used for the objects' tags. This window lists a series of built-in layers (for example, <span class="strong"><strong>Builtin Layer 0</strong></span> or <span class="strong"><strong>Builtin Layer 7</strong></span>) as well as user layers (for example, <span class="strong"><strong>User Layer 8</strong></span> or <span class="strong"><strong>User Layer 31</strong></span>).</p></li><li><p>Modify the first user layer by clicking on to the right of the label <span class="strong"><strong>User Layer 8</strong></span>.</p></li><li><p>Type <code class="literal">topView</code><a id="id288" class="indexterm"></a> and press <span class="emphasis"><em>Enter</em></span>. This should display the label <span class="strong"><strong>topView</strong></span> to the right of <span class="strong"><strong>User Layer 8</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_5.jpg" /></div></li><li><p>Select the object <code class="literal">camera1</code> in <span class="strong"><strong>Hierarchy</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id289" class="indexterm"></a>, within the component camera, modify the attribute <span class="strong"><strong>Culling Mask</strong></span>, so that only the layer labeled <span class="strong"><strong>topView</strong></span> is selected as illustrated in the following screenshot: select the option <span class="strong"><strong>Nothing</strong></span> and then the option <span class="strong"><strong>topView</strong></span>. This means that the camera <code class="literal">camera1</code> will only display objects that belong to this layer.</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_6.jpg" /></div></li></ol></div><p>Next, we will make sure that this top-view camera is always above the player:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Drag-and-drop the camera <code class="literal">camera1</code> on the <span class="strong"><strong>First Person Controller</strong></span> (top-most level; the <span class="strong"><strong>First Person Controller</strong></span> is located in the folder or empty object <code class="literal">maze</code>) as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_7.jpg" /></div></li><li><p>Change its position to (x=0, y=50, z=0).</p></li></ol></div><p>Now that we have set the top-view camera, we can set layers for the objects that we need to display on the map. We could decide to display the first-person controller and other<a id="id290" class="indexterm"></a> objects of interest; however, it would be great to <a id="id291" class="indexterm"></a>have a simplified representation of these on the mini-map, and only display dots with corresponding colors. For example, we could have a red dot for each enemy, orange dots for med packs and other collectables, and a green dot for the player. An easy way to do this is to create spheres that will be displayed above these objects and only visible from the top-view camera. Let's start with the main character:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new sphere.</p></li><li><p>Change its scale to (x=2, y=2, z=2).</p></li><li><p>Rename <a id="id292" class="indexterm"></a>this object <code class="literal">dot_fpc</code>.</p></li><li><p>Locate the texture labeled <span class="strong"><strong>Green</strong></span> by selecting <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter4</strong></span> | <span class="strong"><strong>chapter4_pack</strong></span> and apply this texture to the sphere.</p></li><li><p>Drag this object (<code class="literal">dot_fpc</code>) on the <span class="strong"><strong>First Person Controller</strong></span> as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_8.jpg" /></div></li><li><p>Change its position to (x=0, y=0, z=0).</p></li><li><p>This will include the sphere as a child of the first-person controller. In other words, any transformation applied to the first-person controller will be applied to the sphere. As a result, the sphere will move along with the character.</p></li></ol></div><p>Next, we need to set the layer for this object, so that it is only displayed on the top-view camera:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the object <code class="literal">dot_fpc</code><a id="id293" class="indexterm"></a> in the <span class="strong"><strong>Hierarchy</strong></span> window to select it.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id294" class="indexterm"></a>, click on the drop-down menu to the right of the <span class="strong"><strong>Layer</strong></span> label.</p></li><li><p>Select<a id="id295" class="indexterm"></a> the option <span class="strong"><strong>topView</strong></span> from the list.</p></li><li><p>Because we don't want the player to collide with these objects (although they will be invisible on the top view), we need to remove the colliders from this<a id="id296" class="indexterm"></a> sphere. In the <span class="strong"><strong>Inspector</strong></span> window, right-click<a id="id297" class="indexterm"></a> on the component <span class="strong"><strong>Sphere Collider</strong></span><a id="id298" class="indexterm"></a> for this object, and select the option <span class="strong"><strong>Remove Component</strong></span> from the contextual menu. This will remove the collider from the sphere.</p></li></ol></div><p>Finally, we will need to see this sphere regardless of the light around it and we will make it self-illuminated. This means that it will glow even in the absence of light. The following steps highlight what to do:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the object <code class="literal">dot_fpc</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window, open the component <span class="strong"><strong>Mesh Renderer</strong></span>, and change its <span class="strong"><strong>Shader</strong></span> property<a id="id299" class="indexterm"></a> to <span class="strong"><strong>Self-Illumin</strong></span> | <span class="strong"><strong>Diffuse</strong></span> (alternatively, using the unlit shaders may be more effective for game performance as they are less CPU/GPU resource-intense).</p></li><li><p>Leave the other options as default.</p></li></ol></div><p>Play the scene; we should see a green dot in the middle of the mini-map.</p><p>We <a id="id300" class="indexterm"></a>will <a id="id301" class="indexterm"></a>now create the dots for the other objects:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new sphere, change its scale to (x=2, y=2, z=2), and rename it <code class="literal">dot_medpack</code>.</p></li><li><p>Locate the texture labeled <span class="strong"><strong>Orange</strong></span> by selecting <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter4</strong></span> | <span class="strong"><strong>chapter4_pack</strong></span>, and apply this texture to the sphere.</p></li><li><p>Change the <code class="literal">shader</code> property<a id="id302" class="indexterm"></a> to <code class="literal">Self-Illumin</code>/<code class="literal">Diffuse</code>.</p></li><li><p>Remove <a id="id303" class="indexterm"></a>the <code class="literal">SphereCollider</code> component from this object.</p></li><li><p>Drag-and-drop the object (<code class="literal">dot_medpack</code>) on the object labeled <code class="literal">medpack</code>.</p></li><li><p>Change<a id="id304" class="indexterm"></a> the position of this object to (x=0, y=0, z=0).</p></li><li><p>Change<a id="id305" class="indexterm"></a> its <code class="literal">Layer</code> property to <code class="literal">topView</code>.</p></li><li><p>Repeat the previous steps to create two other spheres named <code class="literal">dot_key</code> and <code class="literal">dot_gun</code> for both the objects labeled <code class="literal">key</code> and <code class="literal">gun</code>.</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>If we look at the <code class="literal">scale</code> properties<a id="id306" class="indexterm"></a> of the dot for the objects <code class="literal">key</code>, <code class="literal">medpack</code>, or <code class="literal">gun</code>, we will see that the initial values that we have entered (x=2, y=2, z=2) have changed. This is because the parent objects of these dots (that is, the objects <code class="literal">key</code>, <code class="literal">medpack</code>, and <code class="literal">gun</code>) are scaled down, which means that to preserve the aspect of the dots, and compensate for the scaling of their parents, Unity3D has adjusted their <code class="literal">scale</code> properties. However, if we combine the scale of the dots and the scale of the parents, we should find that the overall size of these dots is (x=2, y=2, z=2). For example, the object <code class="literal">dot_gun</code> has the <code class="literal">scale</code> properties (x=10, y=4, z=4), and the <code class="literal">scale</code> property of its parent is (x=0.2, y=0.5, z=0.5). If we combine these two scaling properties (x=10*0.2, y=4*0.5, z=4 *0.5) you obtain an overall sale of (x=2, y=2, z=2).</p></div><p>At this stage, the top-view camera displays the dots that indicate the position of the player and other items; however, it would also be great to display part of the environment, including the walls, on the mini-map. We also need to display these walls in the main view <a id="id307" class="indexterm"></a>and we can only allocate one layer for this object. <a id="id308" class="indexterm"></a>The solution is to create a layer labeled <span class="strong"><strong>topAndMain</strong></span> that will be displayed by both the main camera and the top-view camera. Let's create this layer<a id="id309" class="indexterm"></a> and allocate it to the views:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select one of the walls in the scene.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id310" class="indexterm"></a>, click on the drop-down menu to the right of the label <span class="strong"><strong>Layer</strong></span>.</p></li><li><p>From the drop-down menu, select the option <span class="strong"><strong>Add Layer</strong></span>.</p></li><li><p>Create a layer, to the right of the label <span class="strong"><strong>User Layer 9</strong></span>, that we will label <span class="strong"><strong>topAndMain</strong></span>.</p></li></ol></div><p>Once this step is done, as we have seen in the previous sections, we will allocate this layer to the<a id="id311" class="indexterm"></a> corresponding objects:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select all the walls in the level (or select them one-by-one if needed) as well as all objects labeled <code class="literal">block</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window, click on the drop-down menu to the right of the label <span class="strong"><strong>Layer</strong></span>.</p></li><li><p>From the drop-down menu, select <span class="strong"><strong>topAndMain</strong></span>.</p></li><li><p>We may also apply this layer to other objects such as the rocks and platforms in the water area (that is, the objects labeled <code class="literal">bridge</code>).</p></li><li><p>Note that by selecting all walls at once, the new layer will be applied to all of them. Modifying the attributes of several objects at once can help us to save precious time when designing our game.</p></li></ol></div><p>We now need to ensure that each camera will display this layer:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on <code class="literal">camera1</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id312" class="indexterm"></a>, change the <span class="strong"><strong>Culling Mask</strong></span> attribute<a id="id313" class="indexterm"></a> of its <span class="strong"><strong>Camera</strong></span> component so that it includes both the layers <span class="strong"><strong>topView</strong></span> and <span class="strong"><strong>topAndMain</strong></span>.</p></li><li><p>Select the camera that is within the <span class="strong"><strong>First Person Controller</strong></span> and labeled <span class="strong"><strong>Main Camera</strong></span> as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_9.jpg" /></div></li><li><p>Change<a id="id314" class="indexterm"></a> the <span class="strong"><strong>Culling Mask</strong></span> attribute of its <span class="strong"><strong>Camera</strong></span> component<a id="id315" class="indexterm"></a> so that it displays everything but not the <span class="strong"><strong>topView</strong></span> layer<a id="id316" class="indexterm"></a> as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_10.jpg" /></div></li></ol></div><p>Play the scene and check the content displayed in the mini-map as highlighted in the following <a id="id317" class="indexterm"></a>screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_04_11.jpg" /></div></div>