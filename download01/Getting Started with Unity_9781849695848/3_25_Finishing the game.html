<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec29"></a>Finishing the game</h2></div></div><hr /></div><p>We should now have created four scripts as well as new objects: <code class="literal">GUIText_displayMessageToUser</code>, <code class="literal">GUIText_timer</code>, <code class="literal">GUITexture_gun</code>, <code class="literal">GUITexture_key</code>, <code class="literal">gun</code>, <code class="literal">key</code>, <code class="literal">medpack</code>, and <code class="literal">timer</code>. The player can navigate through the maze<a id="id249" class="indexterm"></a> and collect items. At this stage, we just need to detect when the player has reached the exit doors (that is, using tags) and open the doors only if the player has the key. To do so, we will create a tag for the door, attach an animation to it, and trigger this animation only when the player has collected the key as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the object labeled <code class="literal">exit_door</code> (within the empty object or folder <code class="literal">maze</code>).</p></li><li><p>Add an animation component to this object by selecting <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Miscellaneous</strong></span> | <span class="strong"><strong>Animation</strong></span>.</p></li><li><p>Locate the animation <code class="literal">open_door</code> from the folder <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter3</strong></span> | <span class="strong"><strong>chapter3_pack</strong></span>.</p></li><li><p>Drag-and-drop this animation on the <code class="literal">Animation</code> attribute for the <span class="strong"><strong>Animation</strong></span> component <a id="id250" class="indexterm"></a>of the object <code class="literal">exit_door</code> as highlighted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_03_3.jpg" /></div></li></ol></div><p>Uncheck the box for the option <span class="strong"><strong>Play Automatically</strong></span>, create a new tag titled <code class="literal">exit_door</code>, add this<a id="id251" class="indexterm"></a> tag to the object named <code class="literal">exit_door</code>, and modify the script <code class="literal">collisionDetection</code><a id="id252" class="indexterm"></a> by adding the following lines within the <a id="id253" class="indexterm"></a>function <code class="literal">OnControllerColliderHit</code>:</p><div class="informalexample"><pre class="programlisting">if (c.gameObject.tag == "exit_door") 
{
  if (hasKey) c.gameObject.animation.Play ("open_door");
  else   GameObject.Find("GUIText_displayMessageToUser").GetComponent(displayMessageToUser).displayText("Sorry, you need the key to open this door");
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 1 of the previous code, we test whether we are colliding with the exit door</p></li><li style="list-style-type: disc"><p>In statement 3 of the previous code, if the player has the key, the door (which is <a id="id254" class="indexterm"></a>the object we are colliding with) is open by playing the animation linked to its object (that is, <code class="literal">door_open</code>)</p></li><li style="list-style-type: disc"><p>In statement 5 of the previous code, if the player does not have the key, a message is displayed accordingly</p></li></ul></div><p>Test the scene. Try to open the door with and without the key.</p></div>