<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec40"></a>Sending messages to alert other close enemies</h2></div></div><hr /></div><p>Now <a id="id438" class="indexterm"></a>that we have created a relatively simple behavior for each enemy, we can add an additional AI feature. We will modify our code so that if there are several enemies in a similar location, those that have not detected the player will be alerted of its presence by other enemies, and also start walking toward the player. First, we will create a tag for each enemy. This will make it easier to identify any enemy within range:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the object <code class="literal">zombie_hires</code><a id="id439" class="indexterm"></a> from the <span class="strong"><strong>Hierarchy</strong></span> window<a id="id440" class="indexterm"></a>; in the <span class="strong"><strong>Inspector</strong></span> window, click <a id="id441" class="indexterm"></a>the on the drop-down menu to the right of the label <span class="strong"><strong>Tag</strong></span> <a id="id442" class="indexterm"></a>and click on the option <span class="strong"><strong>Add Tag</strong></span>.</p></li><li><p>Select the line from the last tag element (for example, <span class="strong"><strong>Element 7</strong></span>), and type the word <code class="literal">zombie</code>. This will create a new tag; once this is done, select our object (<code class="literal">zombie_hires</code>).</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window, click on the drop-down menu to the right of the label <span class="strong"><strong>Tag</strong></span>.</p></li><li><p>Select the label <span class="strong"><strong>zombie</strong></span> that we have just created.</p></li></ol></div><p>Next, <a id="id443" class="indexterm"></a>we will create a function that will be accessible from other objects and that will change the value of the parameter <code class="literal">walking</code><a id="id444" class="indexterm"></a> for the zombie animation. By changing this parameter to <code class="literal">true</code>, we will be able to change the state of any zombie, and in our case, make them walk toward the player. Let's add the following code to the script <code class="literal">controlZombie</code>:</p><div class="informalexample"><pre class="programlisting">function setWalking(newWalkingValue: boolean)
{
anim.SetBool("walking",newWalkingValue);
}</pre></div><p>In the previous<a id="id445" class="indexterm"></a> code, we declare a function labeled <code class="literal">setWalking</code>. This function takes one parameter (<code class="literal">newWalkingValue</code>) that will be used to trigger a transition between the states <code class="literal">Idle</code><a id="id446" class="indexterm"></a> and <code class="literal">WalkForward</code>. We set the<a id="id447" class="indexterm"></a> value of the parameter <code class="literal">walking</code> in the animation for the zombie<a id="id448" class="indexterm"></a> using the built-in function <code class="literal">anim.SetBool</code>.</p><p>Then, we need to detect whether there are any zombies around the one that has detected the player. We will achieve this by adding the following code within the function <code class="literal">Update</code><a id="id449" class="indexterm"></a> in the script <code class="literal">controlZombie</code>, within the code dedicated to the state <code class="literal">walkForward</code>, as highlighted in the following code snippet:</p><div class="informalexample"><pre class="programlisting">case:walkForwardState
<span class="strong"><strong>  var zombies:GameObject [] = GameObject.FindGameObjectsWithTag("zombie");</strong></span>
<span class="strong"><strong>  for (var zombie:GameObject in zombies)</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>    if (Vector3.Distance(transform.position, zombie.transform.position) &lt; 8.0f)</strong></span>
<span class="strong"><strong>zombie.GetComponent(controlZombie).setWalking(true);</strong></span>
<span class="strong"><strong>  }</strong></span>
  break;</pre></div><p>In the previous code, we create an array of objects. This array will be populated with all zombies' objects in our game. We loop through this array, and assess the distance between each of these objects and the current zombie. Any zombie within a distance of 8 meters from the zombie that has detected the player will also start to walk toward the player. To test this behavior, we could do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Duplicate the zombie character twice to obtain a total of 3. Change the position of the two new zombies to (x=-2, y=-0.5, z=0) and (x=-4, y=-0.5, z=0), and rename them <code class="literal">zombie_hires2</code> and <code class="literal">zombie_hires3</code>, respectively.</p></li><li><p>Rotate the first two instances so that they look away from the player.</p></li><li><p>Rotate the third instance so that it is facing the player.</p></li><li><p>Play the scene and move the player so that it is in front of the third instance (that is, so that it can be seen). We should see that this zombie starts to follow the player as well as the other zombies, although these are not directly facing the player.</p></li></ol></div><p>The <a id="id450" class="indexterm"></a>script could be improved by also checking that the message is sent to an enemy only if it is not already walking toward the player.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"></a>Note</h3><p>Note that the method <code class="literal">FindGameOBjectsWithTag</code><a id="id451" class="indexterm"></a> can become computer intensive if our game includes many zombie characters. We may instead detect other objects using the built-in method <code class="literal">Physics.OverlapSphere</code> that makes it possible to detect <a id="id452" class="indexterm"></a>colliders within a specific radius.</p></div><p>Once we have checked that this behavior works, we can delete or deactivate the two copies of the zombie.</p></div>