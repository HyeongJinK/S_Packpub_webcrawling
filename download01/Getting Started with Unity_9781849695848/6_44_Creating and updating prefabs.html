<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec45"></a>Creating and updating prefabs</h2></div></div><hr /></div><p>Let's add<a id="id585" class="indexterm"></a> a red dot to the prefab <code class="literal">zombie_idle</code>, so that any zombie can be detected <a id="id586" class="indexterm"></a>on the mini-map. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new sphere, rename it <code class="literal">dot_enemy</code>, set its size or scale to (x=2, y=2, z=2), remove its collider component, apply the <code class="literal">Red</code> texture to this object (this texture is located in <span class="strong"><strong>chapter4</strong></span> | <span class="strong"><strong>chapter4_pack</strong></span>), and set its <code class="literal">Layer</code> property to <code class="literal">topView</code>.</p></li><li><p>Set the <code class="literal">shader</code> of this object to <code class="literal">Self-Illumin/Diffuse</code> and duplicate this object.</p></li><li><p>Drop the first duplicate, <code class="literal">dot_enemy</code>, on the object labeled <code class="literal">zombie_hires</code> in the <span class="strong"><strong>Hierarchy</strong></span> view and change the position of the object <code class="literal">dot_enemy</code> to (x=0, y=0, z=0).</p></li><li><p>Drop the second duplicate, <code class="literal">dot_enemy</code>, on the object labeled <code class="literal">patroller</code> in the <span class="strong"><strong>Hierarchy</strong></span> view and change the position of the object <code class="literal">dot_enemy</code> to (x=0, y=0, z=0).</p></li><li><p>Drag-and-drop the object <code class="literal">zombie_hires</code> on the prefab <code class="literal">static_Enemy</code> located in <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter5</strong></span>; this will update the prefab with our latest changes.</p></li><li><p>Repeat the previous step with the object <code class="literal">patroller</code> and the prefab <code class="literal">zombie_patroller</code>.</p></li><li><p>Now that we have updated/created prefabs, we can deactivate the objects <code class="literal">patroller</code> and <code class="literal">zombie_hires</code> in the <span class="strong"><strong>Hierarchy</strong></span> view (using the Inspector and <a id="id587" class="indexterm"></a>unchecking the box to the right of the name of this object).</p></li></ol></div><p>We will need to create ammunitions<a id="id588" class="indexterm"></a> that the player will be able to collect:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new cube, rename it ammunitions, change its <code class="literal">scale</code> properties to (x=0.2, y=0.5, z=0.5), its position to (x=0, y=1, z=1), and apply the texture <code class="literal">texture_ammo</code> located in <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter6</strong></span> | <span class="strong"><strong>chapter6_pack</strong></span> to this object.</p></li><li><p>Create a new tag, <code class="literal">ammunitions</code>, and apply it to this object.</p></li><li><p>Duplicate the <a id="id589" class="indexterm"></a>object <code class="literal">dot_gun</code> from the <code class="literal">gun</code> object, rename it <code class="literal">dot_ammo</code>, drag-and-drop it to the object <code class="literal">ammunitions</code>, and set its position to (x=0, y=0, z=0).</p></li><li><p>Locate <a id="id590" class="indexterm"></a>the script <code class="literal">rotate.js</code> (<span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter3</strong></span>) and <a id="id591" class="indexterm"></a>attach <a id="id592" class="indexterm"></a>it to the object labeled <code class="literal">ammunitions</code>.</p></li></ol></div><p>Now that the ammunitions have been created, we will modify our scripts so that the variable used to track ammunitions is increased when ammunitions have been collected. Open the script <code class="literal">collisionDetection</code> and <a id="id593" class="indexterm"></a>modify the conditional statement at the start of the function <code class="literal">OnControllerColliderHit</code>, as highlighted<a id="id594" class="indexterm"></a> in the following code:</p><div class="informalexample"><pre class="programlisting">if (c.gameObject.tag == "medpack" || c.gameObject.tag == "key" || c.gameObject.tag == "gun" <span class="strong"><strong>|| c.gameObject.tag == "ammunitions"</strong></span>) 
  {</pre></div><p>Add the code highlighted in the following code snippet:</p><div class="informalexample"><pre class="programlisting">if (c.gameObject.tag == "gun")
  {
    hasGun = true; displayGUITexture(true, "gun");
    changeGUITexture("true",gun);
    GameObject.Find("GUITexture_crosshair").guiTexture.enabled =true;
    GetComponent(shootBullet).nbBullets = 40;
  }
<span class="strong"><strong>  if (c.gameObject.tag == "ammunitions") GameObject.FindWithTag("Player").GetComponent(shootBullet).nbBullets += 30;</strong></span>
}</pre></div><p>Based on the previous code (statement 8), if we collide with ammunitions, the number of bullets is increased to 40. Note that the ammunitions will be destroyed as for the objects <code class="literal">medpacks</code>, <code class="literal">keys</code>, and <code class="literal">gun</code> based on the code we have already included in this script. The player can now collect a wide range of objects, including a key, a med pack, a gun, and ammunitions. While these objects have been created manually, it would be great to be able to create them at run-time from a script, when the game starts, or even during the game. To do so, we need to create the corresponding prefabs, and instantiate them at run-time. Using scripting, we can then modify the properties of the new instances (that is, copies of the prefabs), including their position or rotation. Interestingly, we could also, based on the health of the user, create a script that instantiates med packs relatively close to him/her. Let's create prefabs for these objects.</p><p>Create <a id="id595" class="indexterm"></a>a <a id="id596" class="indexterm"></a>prefab for the med pack:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the object labeled <code class="literal">medpack</code> from the <span class="strong"><strong>Hierarchy</strong></span> view.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> window, locate the folder, <code class="literal">chapter6</code>, by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter6</strong></span> and select it.</p></li><li><p>Create a new prefab in this folder: select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Prefab</strong></span> from the <span class="strong"><strong>Project</strong></span> window.</p></li><li><p>Rename this prefab <code class="literal">medpack</code>.</p></li><li><p>Drag-and-drop the object called <code class="literal">medpack</code> from the <span class="strong"><strong>Hierarchy</strong></span> window to this new prefab.</p></li><li><p>Deactivate the object <code class="literal">medpack</code> in the <span class="strong"><strong>Hierarchy</strong></span> view (that is, uncheck the box to<a id="id597" class="indexterm"></a> the left of the label <code class="literal">medpack</code> in the <span class="strong"><strong>Inspector</strong></span> window).</p></li><li><p>Repeat steps 1-5 to create a prefab labeled <code class="literal">ammunitions</code> from the object labeled <code class="literal">ammunitions</code>.</p></li></ol></div><p>We can then use these prefabs and instantiate instances at different locations in the maze: check that the objects <code class="literal">medpack</code> and <code class="literal">ammunitions</code> are not active. Locate and open the script <code class="literal">initGame</code> that <a id="id598" class="indexterm"></a>is currently attached to the <span class="strong"><strong>First Person Controller</strong></span>, and add the following lines at the start of the script:</p><div class="informalexample"><pre class="programlisting">public var ammunitions:GameObject;
private var objectsInstantiated = new Array();
private var indexOfObjectInstantiated:int;</pre></div><p>In the previous script, we create a placeholder for our ammunitions. Because this variable is public, we will be able to drag-and-drop an object (for example, the <code class="literal">ammunitions</code> prefab) to this variable from the <span class="strong"><strong>Inspector</strong></span> window. We create an array for the new objects that will be created based on the prefabs (that is, instances) as well as an index for the previous array to be able to refer to all the new objects created.</p><p>Add the following code inside the function <code class="literal">Start</code>:</p><div class="informalexample"><pre class="programlisting">objectsInstantiated [indexOfObjectInstantiated++] = Instantiate(ammunitions, Vector3(0,1,1), Quaternion.Euler(0,0,0));
objectsInstantiated [indexOfObjectInstantiated++] = Instantiate(ammunitions, Vector3(3,1,-7), Quaternion.Euler(0,0,0));</pre></div><p>In the previous code, we create two new objects as part of the array defined earlier. Once the objects have been created, the index of the array is incremented by 1. The new objects are instances of the object <code class="literal">ammunitions</code> defined earlier. They will be located at the position (x=0, y=0, z=1) and (x=3, y=0, z=-7), with no rotation.</p><p>Finally, select the object <span class="strong"><strong>First Person Controller</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> window and locate the script component <code class="literal">initGame</code> for this object in the <span class="strong"><strong>Inspector</strong></span> window. We should see that it<a id="id599" class="indexterm"></a> includes a placeholder (variable) called <span class="strong"><strong>Ammunitions</strong></span>. Drag-and-drop<a id="id600" class="indexterm"></a> the prefab <span class="strong"><strong>ammunitions</strong></span> to this placeholder as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_06_7.jpg" /></div><p>Play the scene and check that the two ammunition packs are included in the scene.</p><p>Let's do <a id="id601" class="indexterm"></a>the same for the med packs. Add the following line to the start of the script <code class="literal">initGame</code>:</p><div class="informalexample"><pre class="programlisting">public var medpack:GameObject;</pre></div><p>Add the <a id="id602" class="indexterm"></a>following line within the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">objectsInstantiated [indexOfObjectInstantiated++] = Instantiate(medpack, Vector3(3,1,6), Quaternion.identity);</pre></div><p>Drag-and-drop the <a id="id603" class="indexterm"></a>prefab <code class="literal">medpack</code> to the placeholder <span class="strong"><strong>Medpack</strong></span> as described<a id="id604" class="indexterm"></a> in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_06_8.jpg" /></div><p>Finally, we need to generate several enemies at runtime. Add the following lines at the start <a id="id605" class="indexterm"></a>of the script <code class="literal">initGame</code>:</p><div class="informalexample"><pre class="programlisting">private var i:int;
private var j:int;
public var zombie_idle:GameObject;
public var breadCrumb:GameObject;
var newObject : GameObject;</pre></div><p>Add<a id="id606" class="indexterm"></a> the following lines within the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">GameObject.Find("GUIText_ammo").guiText.text="";
GameObject.Find("GUITexture_crossHair").guiTexture.enabled = false;
GameObject.Find("GUIText_displayMessageToUser").guiText.text="";
newObject = Instantiate(ammunitions, Vector3(0,1,1), Quaternion.identity);
newObject = Instantiate(ammunitions, Vector3(3,1,-7), Quaternion.identity);
newObject = Instantiate(medpack, Vector3(3,1,6), Quaternion.identity);
for (i = 0; i&lt;1; i++)
{
     for (j = 0; j&lt;2; j++)
     {
         print(i+":"+j);
          var orientation:float = Random.Range(0,180);
          newObject = Instantiate(zombie_idle, Vector3(-4+i,0.5,-4+j), Quaternion.Euler(0,orientation,0)) as GameObject;
          newObject.GetComponent(controlZombie).breadCrumb =  breadCrumb;
          newObject.GetComponent(controlZombie).setCharacterType(false);
          newObject.name = "zombie_a"+i+j;
          newObject = Instantiate(zombie_idle, Vector3(-4+i+7,0.5,-4+j), Quaternion.Euler(0,orientation,0)) as GameObject;
          newObject.GetComponent(controlZombie).breadCrumb =  breadCrumb;
          newObject.GetComponent(controlZombie).setCharacterType(Random.Rang e(0,10) &gt;5);
          newObject.name = "zombie_b"+i+j;
     }
}</pre></div><p>In the previous code, we create four zombie objects with a position that is partly defined by the<a id="id607" class="indexterm"></a> two looping variables <code class="literal">i</code> and <code class="literal">j</code>. Each new object has a random <a id="id608" class="indexterm"></a>orientation, and a breadcrumb prefab is attached so that the zombie can drop breadcrumbs. Move the <span class="strong"><strong>First Person Controller</strong></span> to the position (x=21, y=0.6, z=8), move the key to the position (x=-20, y=1, z=0) and test the scene. Next, select the object <span class="strong"><strong>First Person Controller</strong></span>, and drag-and-drop the prefabs <code class="literal">breadcrumb</code> (<span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter6</strong></span>) and <code class="literal">staticEnemy</code> (<span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter5</strong></span>) to their respective variables/placeholders <code class="literal">breadCrumb</code> and <code class="literal">zombie_idle</code> in the <span class="strong"><strong>Inspector</strong></span> window, located in the component <code class="literal">initGame</code>.</p></div>