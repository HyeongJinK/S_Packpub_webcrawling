<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec25"></a>Creating our first script</h2></div></div><hr /></div><p>Scripts <a id="id133" class="indexterm"></a>can be created in several ways in Unity3D, including from the main menu (<span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>JavaScript</strong></span>/<span class="strong"><strong>C# Script</strong></span>/<span class="strong"><strong>Boo Script</strong></span>) or from the <span class="strong"><strong>Project</strong></span> window (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>JavaScript</strong></span>/<span class="strong"><strong>C# Script</strong></span>/<span class="strong"><strong>Boo Script</strong></span>).</p><p>Once the script is created, it needs to be linked to an object.</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_03_1.jpg" /></div><p>From the scene we have created in the previous chapter, we will create a new script that displays a message in the console. Using scripts usually involves creating the script, and attaching the script to an object. The script is called (or executed) when the object is created in the scene; however, we won't be able to play the scene until all scripts included contain no errors (errors are displayed in the <span class="strong"><strong>Console</strong></span> window). Before creating a new script, we will create a new folder in the <code class="literal">project</code> folder, so that we can locate the scripts easily:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the folder <code class="literal">chapter3</code> that we created earlier.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> window<a id="id134" class="indexterm"></a>, select <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Folder</strong></span>.</p></li><li><p>Rename this folder <code class="literal">Scripts</code>.</p></li><li><p>Click once on this folder (so that the next script is created inside it).</p></li></ol></div><p>We can now <a id="id135" class="indexterm"></a>create a new script:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Check that the folder <code class="literal">Scripts</code> is selected.</p></li><li><p>From the top menu, select <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>JavaScript</strong></span>.</p></li><li><p>Doing so should create a new JavaScript script within the folder labeled <code class="literal">Scripts</code>.</p></li><li><p>Rename this script <code class="literal">timer</code>.</p></li></ol></div><p>When the script has been created, we can see its content in the <span class="strong"><strong>Inspector</strong></span> window.</p><p>Let's edit<a id="id136" class="indexterm"></a> its content as shown in the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Double-click on the script labeled <code class="literal">timer</code>. Doing so should open <code class="literal">MonoDevelop</code>, which is the default editor for Unity3D scripts. There are several advantages to using <code class="literal">MonoDevelop</code>, including code auto-completion, so that we don't have to remember all of Unity3D's built-in functions and variables. However, if we had preferred to use other editors, we could have changed Unity3D's preferences accordingly (for example, <span class="strong"><strong>Unity</strong></span> | <span class="strong"><strong>Preferences</strong></span> | <span class="strong"><strong>External Tool</strong></span>).</p></li><li><p>Once in <code class="literal">MonoDevelop</code><a id="id137" class="indexterm"></a>, we can see that there are two functions created in the <code class="literal">timer</code> script<a id="id138" class="indexterm"></a> by default: these are the functions <code class="literal">Start</code><a id="id139" class="indexterm"></a> and <code class="literal">Update</code>. The <code class="literal">Start</code> function is <a id="id140" class="indexterm"></a>called when the script is first called. For example, if this script is linked to an object, this function will be called when the object is created or added to the scene. The second function, <code class="literal">Update</code>, is called every frame (that is, when the screen is refreshed). It can be used to detect keystrokes or to create timers, as we will see later in this chapter.</p></li><li><p>Modify the <code class="literal">timer</code> script as follows:</p><div class="informalexample"><pre class="programlisting">private var time: float;
function Start ()
{
}
function Update ()
{
  time++;
  print(time);
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 1 of the previous code, we declare a new variable, <code class="literal">time</code>, of type <code class="literal">float</code>. It is only accessible within this script (that is, the type is <code class="literal">private</code>).</p></li><li style="list-style-type: disc"><p>In statement 7 of the previous code, the variable time is incremented by 1 every frame (that is, every time the screen is refreshed).</p></li><li style="list-style-type: disc"><p>In statement 8 of the previous code, the value of the variable <code class="literal">time</code><a id="id141" class="indexterm"></a> is displayed in the <span class="strong"><strong>Console</strong></span> window.</p></li></ul></div></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"></a>Tip</h3><p><span class="strong"><strong>Downloading the example code</strong></span></p><p>You can download the example code files for all Packt books you have purchased from your account at <a class="ulink" href="http://www.packtpub.com" target="_blank">http://www.packtpub.com</a>. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support" target="_blank">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div><p>To be able to run this script, it needs to be attached to an object:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In <a id="id142" class="indexterm"></a>Unity3D, create an empty object (<span class="strong"><strong>Game Object</strong></span> | <span class="strong"><strong>Empty Object</strong></span>) and rename it <code class="literal">timer</code>.</p></li><li><p>We can now attach the script by either dragging-and-dropping the script from the <code class="literal">Scripts</code> folder to the empty object labeled <code class="literal">timer</code>, or by selecting the object labeled <code class="literal">timer</code> and selecting <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Scripts</strong></span> | <span class="strong"><strong>timer</strong></span> from the top menu.</p></li><li><p>Once this step is done, if we click once on the <code class="literal">timer</code> object, the Inspector will reveal an additional component for this object, a script labeled <code class="literal">timer</code>.</p></li><li><p>Play the scene (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>P</em></span>). If we open the <span class="strong"><strong>Console</strong></span> window (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>S</em></span>) while the scene is being played, we can see that the counter is displayed and that its value increases over time.</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>You will also notice a message in the <span class="strong"><strong>Console</strong></span> window stating that <span class="strong"><strong>There are 2 audio listeners in the sceneâ€¦</strong></span> the reason being that each camera in the scene includes an <span class="strong"><strong>audio listener</strong></span><a id="id143" class="indexterm"></a>, which can be compared to a microphone. We currently have two cameras in the scene, each with an audio listener component. However, Unity3D requires that only one audio listener be active at any given time. To avoid this warning message, we could deactivate the audio listener for the camera attached to the <span class="strong"><strong>First Person Controller</strong></span> or the one for the other camera labeled <span class="strong"><strong>Main Camera</strong></span>.</p></div><p>This is great; however, the value displayed in the console is the number of frames since the game has started. Instead, we need to display the number of seconds and minutes. To do so, we can use a built-in variable called <code class="literal">Time.deltaTime</code>. This variable provides the number<a id="id144" class="indexterm"></a> of seconds elapsed since the last frame was displayed; effectively, the number of seconds is calculated every time the screen is refreshed. Let's modify our script accordingly as described in the following code snippet:</p><div class="informalexample"><pre class="programlisting">function Update ()
{
time = time +Time.deltaTime;
print(time);
}</pre></div><p>In the previous code, the <code class="literal">timer</code> is incremented by the number of seconds elapsed since the last frame was displayed. If we play the scene (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>P</em></span>), we should now see seconds displayed in the <span class="strong"><strong>Console</strong></span> window (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>C</em></span>). We are almost there and we need to create two variables (that is, for minutes and seconds), and calculate the minutes and seconds <a id="id145" class="indexterm"></a>elapsed based on the variable <code class="literal">timer</code>. Modify the script as follows:</p><div class="informalexample"><pre class="programlisting">private var time: float;
private var minutes:int;
private var seconds:int;
function Start () 
{
}
function Update () 
{
  time = time + Time.deltaTime;
  minutes = time/60;
  seconds = time%60;
  print(minutes+":"+ seconds);
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In <a id="id146" class="indexterm"></a>
<a id="id147" class="indexterm"></a>statements 1-3 of the <a id="id148" class="indexterm"></a>previous code, the variables <code class="literal">time</code>, <code class="literal">minutes</code>, and <code class="literal">seconds</code> are declared</p></li><li style="list-style-type: disc"><p>In statements 10-11 of the previous code, minutes and seconds are calculated (the operand <code class="literal">%</code> is called a modulo; it will provide the reminder of the division)</p></li><li style="list-style-type: disc"><p>In statement 12 of the previous code, both variables <code class="literal">minutes</code> and <code class="literal">seconds</code> are displayed in the console</p></li></ul></div><p>Play the scene and check that the minutes and seconds are displayed in the <span class="strong"><strong>Console</strong></span> window.</p><p>At this <a id="id149" class="indexterm"></a>stage, we have a script that displays the time in the console; however, for our game, it would be better if this script could be displayed on the screen using a graphical interface. As mentioned in the previous sections, Unity3D provides several game objects for the creation of graphical interface objects, including <code class="literal">GUIText</code> and <code class="literal">GUITexture</code>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a <code class="literal">GUIText</code> object<a id="id150" class="indexterm"></a>: select <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>GUI Text</strong></span>.</p></li><li><p>Doing so should create a new <code class="literal">GUIText</code> object. Rename it <code class="literal">GUIText_timer</code>.</p></li><li><p>If we switch to the game view, we should now see the text GUI Text in the middle of the screen (this is the default text).</p></li><li><p>Switch to the <span class="strong"><strong>Scene</strong></span> view<a id="id151" class="indexterm"></a>, select the object (<code class="literal">GUIText_timer</code>) in the <span class="strong"><strong>Hierarchy</strong></span> view<a id="id152" class="indexterm"></a>, and look at the <span class="strong"><strong>Inspector</strong></span> window<a id="id153" class="indexterm"></a>; we can see several components for this object, including its transform. Within this component, we can also see the position attributes of the object. The position of the <code class="literal">GUIText</code> objects is a proportion of width and height of the screen, and the origin (0,0) is located at the bottom-left corner of the screen, which means that a position (x=0.5, y=0.5) corresponds to the middle of the screen. For our game, we would like the time to be displayed in the top-left corner, so we will modify its coordinates to (x=0.02, y=0.9).</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window, open the <code class="literal">GUIText</code> component<a id="id154" class="indexterm"></a> of this object by clicking on the arrow to the left of the label <code class="literal">GUIText</code>. We can see several attributes including <code class="literal">Text</code> (that is, the text that will be displayed), <code class="literal">Anchor</code>, <code class="literal">Alignment</code>, <code class="literal">Font</code>, and <code class="literal">Font-size</code>. Change the <code class="literal">Font-size</code> attribute<a id="id155" class="indexterm"></a> to <code class="literal">30</code>.</p></li></ol></div><p>We can also<a id="id156" class="indexterm"></a> change the font of the text displayed by dragging-and-dropping a new font on this variable. Let's use a new font for our timer:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open the site <a class="ulink" href="http://www.dafont.com" target="_blank">www.dafont.com</a> in your web browser. This site offers free fonts that can be used for personal purposes (that is, non-commercial).</p></li><li><p>Look for the font <span class="strong"><strong>Oh The Horror</strong></span>.</p></li><li><p>Once you have found this font, make sure you read the terms and conditions.</p></li><li><p>Download this font using the <span class="strong"><strong>Download</strong></span> button located on the right-hand side <a id="id157" class="indexterm"></a>of the page and unzip the file (<code class="literal">OhTheHorror.ttf</code>).</p></li><li><p>Switch back to Unity3D, select the folder <code class="literal">chapter3</code>, and import the font into Unity3D (that is, select <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import New Asset</strong></span>). Doing so should create a new font in the <span class="strong"><strong>Project</strong></span> window (that is, <span class="strong"><strong>Oh the horror</strong></span>).</p></li><li><p>Select the <code class="literal">GUIText</code> object<a id="id158" class="indexterm"></a> labeled <code class="literal">GUIText_timer</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id159" class="indexterm"></a>, click on the small circle to the right of the label <span class="strong"><strong>Font</strong></span> as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695848/graphics/5848_03_2.jpg" /></div></li><li><p>This should open a window labeled <span class="strong"><strong>Select font</strong></span> that includes the new font <span class="strong"><strong>Oh The Horror</strong></span>. Select this font (that is, click once on the font) and close the font selection window. The new font should now appear in the <span class="strong"><strong>Font</strong></span> property of the<a id="id160" class="indexterm"></a> previous object.</p></li></ol></div><p>Last but not least, we need to link our timer script to the <code class="literal">GUIText</code>, so that the time is displayed onscreen. For this, we will use a new command called <code class="literal">GameObject.Find()</code>. This built-in function makes it possible to find an object and access its components and attributes <a id="id161" class="indexterm"></a>from a script. In our case, we need to access the object <code class="literal">GUIText_timer</code><a id="id162" class="indexterm"></a> and its <code class="literal">GUIText</code> component<a id="id163" class="indexterm"></a>, and modify its attribute <code class="literal">text</code>. The following code<a id="id164" class="indexterm"></a> illustrates how this can be done and how it can be added at the end of the function <code class="literal">Update</code><a id="id165" class="indexterm"></a> in <a id="id166" class="indexterm"></a>the script <code class="literal">timer</code>:</p><div class="informalexample"><pre class="programlisting">var textToDisplay:String = minutes+":"+seconds;
GameObject.Find("GUIText_timer").guiText.text=textToDisplay;</pre></div><p>In the<a id="id167" class="indexterm"></a> previous code snippet, we modify the <code class="literal">guiText</code> variable, which is in the component <code class="literal">GUIText</code><a id="id168" class="indexterm"></a>, attached to the object <code class="literal">GUIText_timer</code>. Accessing variables is done through a hierarchy: <span class="strong"><strong>Object</strong></span> | <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Attribute</strong></span>. Note that we use lowercase for the term <code class="literal">guiText</code> when referring to the <code class="literal">GUItext</code> from the object <code class="literal">GUITextTimer</code>. The first three <a id="id169" class="indexterm"></a>letters (that is, gui) are<a id="id170" class="indexterm"></a> in lower case, because we are accessing this particular <code class="literal">guiText</code> (it has been created).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note14"></a>Note</h3><p>If we create a script and link it to an object, all of the object's components and attributes are accessible from this script using the syntax <code class="literal">gameObject.GetComponent</code><a id="id171" class="indexterm"></a> or <code class="literal">GetComponent</code><a id="id172" class="indexterm"></a>. The later format does not include the keyword <code class="literal">gameObject</code>, as Unity3D assumes that we want to access a component from the current object (that is, the one linked to the script).</p></div><p>The full code for the function timer should look as follows:</p><div class="informalexample"><pre class="programlisting">private var time: float;
private var minutes:int;
private var seconds:int;
function Start () 
{
}
function Update () 
{
  time = time + Time.deltaTime;
  minutes = time/60;
  seconds = time%60;
  var textToDisplay : String = minutes + ":" + seconds;
  GameObject.Find("GUIText_timer").guiText.text = textToDisplay;

}</pre></div><p>Play the scene and we should now see the time on the screen.</p><p>Note that while the code we have created to update the object <code class="literal">GUIText_timer</code> (that is, time onscreen) is syntactically correct, it generates memory garbage, as the <code class="literal">GUITexture</code> is searched for every frame and stored over and over. The same applies to the variable <code class="literal">textToDisplay</code><a id="id173" class="indexterm"></a>. Instead, a better practice would be to look for this object once, store it, and refer to this object in the <code class="literal">Update</code> function (that is, without <a id="id174" class="indexterm"></a>calling <code class="literal">GameObject.Find</code> indefinitely. We could also declare the variable <code class="literal">textToDisplay</code><a id="id175" class="indexterm"></a> once.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>It is good <a id="id176" class="indexterm"></a>practice to use the function <code class="literal">GameObject.Find</code> and similar functions outside the <code class="literal">Update</code> function, as it may impact negatively on the performance of your game otherwise.</p></div><p>Let's modify our code accordingly:</p><p>Add two<a id="id177" class="indexterm"></a> new variables at the start of the script as follows:</p><div class="informalexample"><pre class="programlisting">private var guiTextToDisplayTime : GameObject;
private var textToDisplay : String;</pre></div><p>Add the following<a id="id178" class="indexterm"></a> code to the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">guiTextToDisplayTime = GameObject.Find("GUIText_timer");</pre></div><p>In the <code class="literal">Update</code> function, replace the following line:</p><div class="informalexample"><pre class="programlisting">GameObject.Find("GUIText_timer").guiText.text = textToDisplay;</pre></div><p>With this line:</p><div class="informalexample"><pre class="programlisting">guiTextToDisplayTime.guiText.text = textToDisplay;</pre></div><p>Replace the following line:</p><div class="informalexample"><pre class="programlisting">var textToDisplay : String = minutes + ":" + seconds;</pre></div><p>With this line:</p><div class="informalexample"><pre class="programlisting">textToDisplay = minutes + ":" + seconds;</pre></div><p>Play the scene and check that our code works properly.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"></a>Note</h3><p>It is good practice not to include any empty spaces in the name of a script, to end a statement with a semi-colon, and to be aware of case sensitivity: all variables, objects, and functions are case-sensitive, which means that if we refer to a variable but use the incorrect case, an error will be generated.</p></div></div>