<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec28"></a>Creating and displaying an inventory system</h2></div></div><hr /></div><p>In our game, in addition to med packs, we will be able to collect other types of objects. We will <a id="id201" class="indexterm"></a>then need to keep track of these objects using variables <a id="id202" class="indexterm"></a>and graphical representations. This can be done using a basic inventory system. Some objects will have an effect on the player (for example, increase health), while other objects will be used at a later stage. To keep track of these objects we will need to create corresponding variables, update these variables when the corresponding objects have been collected, display a graphical representation of the object(s) collected, and modify the players' attributes (for example, <code class="literal">its health</code>). We will be working with the script <code class="literal">collisionDetection</code>. First, let's create<a id="id203" class="indexterm"></a> variables for the objects to be collected and add the following lines at the start of the script:</p><div class="informalexample"><pre class="programlisting">private var hasKey : boolean;
private var hasGun : boolean;
private var health : int;</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In lines 1 and 2 of the previous code, the varibles <code class="literal">hasKey</code> and <code class="literal">hasGun</code> are declared as <a id="id204" class="indexterm"></a>Boolean variables to check whether the player <a id="id205" class="indexterm"></a>has collected the keys or the gun.</p></li><li style="list-style-type: disc"><p>In line 3 of the previous code, the variable <code class="literal">health</code><a id="id206" class="indexterm"></a> is declared as an integer. It will be used to track the health levels of the player. It will decrease when hit by enemies. The health levels will increase to 100 percent after collecting the med pack.</p></li></ul></div><p>Then, we need to specify what actions should be performed when these items have been collected. This will be done within the code dedicated to the collision detection. Let's add the following code to the script:</p><div class="informalexample"><pre class="programlisting">function OnControllerColliderHit(c : ControllerColliderHit)
{
  if (c.gameObject.tag == "medpack" || c.gameObject.tag ==   "key" || c.gameObject.tag == "gun") 
  {
    print("collided with "+c.gameObject.tag);
    Destroy(c.gameObject);
    gameObject.audio.Play();
    if (c.gameObject.tag == "medpack") health = 100;
    if (c.gameObject.tag == "key") hasKey = true;
    if (c.gameObject.tag == "gun") hasGun = true;
  }
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In <a id="id207" class="indexterm"></a>statement 3 of the previous code, we test<a id="id208" class="indexterm"></a> for any type of collectable objects, since all of them will be destroyed and a sound will be played upon collision</p></li><li style="list-style-type: disc"><p>In statements 6 and 7 of the previous code, as per the previous examples, the objects are destroyed and a sound is played</p></li><li style="list-style-type: disc"><p>In statement 8 of the previous code, in the case of a med pack, the health of the player is set to <code class="literal">100</code></p></li><li style="list-style-type: disc"><p>In statement 9 of the previous code, in the case of a key, the variable <code class="literal">hasKey</code> is set to <code class="literal">true</code></p></li><li style="list-style-type: disc"><p>In statement 10 of the previous code, in the case of a gun, the variable <code class="literal">hasGun</code> is set to <code class="literal">true</code></p></li></ul></div><p>Before we can test the scene, we need to create tags for the keys and gun.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select<a id="id209" class="indexterm"></a> the object labeled <code class="literal">gun</code> in the <span class="strong"><strong>Hierarchy</strong></span> window.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id210" class="indexterm"></a>, click on the drop-down menu to the right of the label <span class="strong"><strong>tag</strong></span>.</p></li><li><p>From<a id="id211" class="indexterm"></a> the drop-down menu, select the option <span class="strong"><strong>Add tag</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Tag Manager</strong></span> window<a id="id212" class="indexterm"></a>, click on the arrow to the left of the label <span class="strong"><strong>Tag</strong></span>.</p></li><li><p>Click to the right of the last elements listed (<span class="strong"><strong>Element1</strong></span>) and type <code class="literal">gun</code>.</p></li><li><p>Click on the object labeled <code class="literal">gun</code> in the <span class="strong"><strong>Hierarchy</strong></span> window and click on the drop-down menu to the right of the label <span class="strong"><strong>tag</strong></span><a id="id213" class="indexterm"></a> in the <span class="strong"><strong>Inspector</strong></span> window. Select the tag <code class="literal">gun</code>.</p></li><li><p>Repeats steps 1-6 for the object labeled <code class="literal">key</code>, that is, create and apply a new label named <code class="literal">key</code> for the key.</p></li></ol></div><p>Play the scene and check that when we collide with the key or gun, the <span class="strong"><strong>Console</strong></span> window displays a message accordingly (for example, <span class="strong"><strong>collided with gun</strong></span>).</p><p>At present, although we keep track of the different items collected, we need to look in the <span class="strong"><strong>Console</strong></span> window to receive feedback. It would be great to display this information on the screen as well as a notification message that disappears after 3 seconds. First, let's create a <a id="id214" class="indexterm"></a>script named <code class="literal">displayMessageToUser</code> that will display a notification message on the screen and hide it after few seconds. Add the following code to the script:</p><div class="informalexample"><pre class="programlisting">private var timer:float;
private var displayTime:float;
private var timerIsActive:boolean;
private var message: String;</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In <a id="id215" class="indexterm"></a>statement 1 of the previous code, the variable <code class="literal">timer</code><a id="id216" class="indexterm"></a> is declared; it will be used to measure time elapsed since the message <a id="id217" class="indexterm"></a>was first created.</p></li><li style="list-style-type: disc"><p>In statement 2 of the previous code, the variable <code class="literal">displayTime</code> is declared; it <a id="id218" class="indexterm"></a>will be used to specify for how long the message will be displayed.</p></li><li style="list-style-type: disc"><p>In statement 3 of the previous code, the variable <code class="literal">timerIsActive</code> is declared; it <a id="id219" class="indexterm"></a>will be used to specify whether the timer that controls the message is active.</p></li><li style="list-style-type: disc"><p>In <a id="id220" class="indexterm"></a>statement 4 of the previous code, the variable <code class="literal">message</code> is declared. This message will be displayed on the screen.</p></li></ul></div><p>Next, we will need to create a function that starts the timer and displays the message until the time is up. Include the following code to the script:</p><div class="informalexample"><pre class="programlisting">function startTimer()
{
  timer = 0.0f;
  guiText.text = message;
  timerIsActive = true;
  displayTime = 3.0f;
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In <a id="id221" class="indexterm"></a>statement 1 of the previous code, the function <code class="literal">startTimer</code> is declared</p></li><li style="list-style-type: disc"><p>In statement 3 of the previous code, the <code class="literal">timer</code> is set to <code class="literal">0</code></p></li><li style="list-style-type: disc"><p>In statement 4 of the previous code, the message is displayed on the screen (provided that the variable message was initially set; this will be explained in the next section)</p></li><li style="list-style-type: disc"><p>In statements 5-6 of the previous code, the <code class="literal">timer</code> is now active for 3 seconds</p></li></ul></div><p>After the timer has been activated, we need to update its value overtime by adding the code highlighted <a id="id222" class="indexterm"></a>in the next code snippet to the function <code class="literal">Update</code> as follows:</p><div class="informalexample"><pre class="programlisting">function Update() 
{
<span class="strong"><strong>  if (timerIsActive)</strong></span>
<span class="strong"><strong>  {</strong></span>
<span class="strong"><strong>    timer+=Time.deltaTime;</strong></span>
<span class="strong"><strong>    if (timer &gt; displayTime){ timerIsAcive=false;</strong></span>
<span class="strong"><strong>   guiText.text="";}</strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 3 of the previous code, we test whether the timer is active</p></li><li style="list-style-type: disc"><p>In statement 5 of the previous code, the value of the time is incremented by the number of seconds since the last frame was displayed</p></li><li style="list-style-type: disc"><p>In statement 6 of the previous code, if the timer has reached the time limit for the text to be displayed, the timer is made inactive and the text is deleted from the screen</p></li></ul></div><p>Then, we <a id="id223" class="indexterm"></a>need to create a function that displays the time:</p><div class="informalexample"><pre class="programlisting">function displayText(mes:String)
{
  message = mes;
  startTimer();
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 1<a id="id224" class="indexterm"></a> of the previous code, the function has one parameter, which corresponds to the text to be displayed onscreen</p></li><li style="list-style-type: disc"><p>In statements 3 and 4 of the previous code, the message to be displayed is initialized with the variable passed to this function and the timer is started</p></li></ul></div><p>After adding the code described in the previous section, the script <code class="literal">displayMessageTouser</code><a id="id225" class="indexterm"></a> should look as follows:</p><div class="informalexample"><pre class="programlisting">private var timer:float;
private var displayTime:float;
private var timerIsActive:boolean;
private var message: String;
function Start () 
{
}
function startTimer()
{
  timer=0.0f;
  guiText.text = message;
  timerIsActive = true;
  displayTime = 3.0f;
}
function Update () 
{
  if (timerIsActive)
  {
    timer+=Time.deltaTime;
    if (timer &gt; displayTime)
    { 
      timerIsActive= false; guiText.text="";
    }
  }
}
function displayText(mes:String)
{
  message = mes;
  startTimer();
}</pre></div><p>We just need to create the <code class="literal">GUIText</code> component<a id="id226" class="indexterm"></a> to display the information on the screen. Create a <code class="literal">GUIText</code> object<a id="id227" class="indexterm"></a>, rename it <code class="literal">GUIText_displayMessageToUser</code>, and change its position to (x=0.5, y=0.7, z=0). In the <code class="literal">GUIText</code> component<a id="id228" class="indexterm"></a>, change the <span class="strong"><strong>Anchor</strong></span> attribute to <span class="strong"><strong>middle center</strong></span> and <span class="strong"><strong>Font Size</strong></span> to <code class="literal">40</code>. Attach<a id="id229" class="indexterm"></a> the script <code class="literal">displayMessageToUser</code><a id="id230" class="indexterm"></a> to this object.</p><p>To complete<a id="id231" class="indexterm"></a> this functionality, we now need to call the function <code class="literal">displayText</code><a id="id232" class="indexterm"></a> whenever the player collects an item. To do so, let's modify the script <code class="literal">collisionDetection</code> and add the following code after <a id="id233" class="indexterm"></a>the line that starts with <code class="literal">Destroy(c.gameObject)</code>:</p><div class="informalexample"><pre class="programlisting">GameObject.Find("GUIText_displayMessageToUser").GetComponent(displayMessageToUser).displayText(c.gameObject.tag+" collected!");</pre></div><p>In the previous code, we<a id="id234" class="indexterm"></a> accessed the function <code class="literal">displayText</code> from the script <code class="literal">timer</code>. The text to display is a string that consists of the tag of the object collected (that is, <code class="literal">c.gameObject.tag</code>) followed by the text <span class="strong"><strong>collected</strong></span>!</p><p>Play<a id="id235" class="indexterm"></a> the scene (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>P</em></span>) and check that the message is displayed accordingly when we collect an item. We may notice that the text <span class="strong"><strong>GUI Text</strong></span> is displayed automatically when the scene starts; we can delete this text by adding <a id="id236" class="indexterm"></a>the following line of code in the <code class="literal">Start</code> function of the script <code class="literal">displayMessageToUser</code>.</p><div class="informalexample"><pre class="programlisting">guiText.text = "";</pre></div><p>Having displayed a notification text, we will display some of the items collected onscreen as part of our inventory system. Every time an item is collected, we will set the corresponding Boolean value to <code class="literal">true</code> and also display a texture onscreen. This will involve the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create <code class="literal">GuiTexture</code> objects<a id="id237" class="indexterm"></a> for each collectable item based on these textures.</p></li><li><p>Assign default textures.</p></li><li><p>Initially deactivate the assigned textures.</p></li><li><p>Activate these textures through JavaScript when the corresponding objects have been collected. Let's start by creating <code class="literal">GUITextures</code> for the keys:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <code class="literal">GUITexture</code> object (<span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>GUI Texture</strong></span>).</p></li><li><p>Rename this <code class="literal">GUITexture</code> object <code class="literal">GUITexture_key</code> and select this object; check that the <span class="strong"><strong>Inspector</strong></span> window is visible.</p></li><li><p>Locate the texture <code class="literal">icons_collectable_keys</code> in the folder <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter3</strong></span> | <span class="strong"><strong>chapter3_pack</strong></span>.</p></li><li><p>Drag-and-drop this texture in the <span class="strong"><strong>Inspector</strong></span> window, to the left of the label <span class="strong"><strong>Texture</strong></span> in the <span class="strong"><strong>GUITexture</strong></span> component of the object <code class="literal">GUITexture_key</code>.</p></li><li><p>Using the Inspector, change the position of this object to (x=0.05, y=0.1, z=0), this should display the texture in the bottom-left corner of the screen.</p></li><li><p>Repeat the previous steps for the gun; the new object will be named <code class="literal">GUITexture_gun</code>, its position should be (x=0.15, y=0.1, z=0), and the texture used will be <code class="literal">icons_collectable_gun</code>.</p></li></ol></div></li></ol></div><p>Now that<a id="id238" class="indexterm"></a> we have created the two <code class="literal">GUITextures</code>, we need to<a id="id239" class="indexterm"></a> make them visible only when the corresponding <a id="id240" class="indexterm"></a>object has been collected. To do so, we will update the script <code class="literal">collisionDetection</code>, which is linked to the <span class="strong"><strong>First Person Controller</strong></span>, by adding the following code:</p><div class="informalexample"><pre class="programlisting">function changeGUITexture(toBeDisplayed:boolean, label:String)
{
  GameObject.Find("GUITexture_"+label).guiTexture.enabled = toBeDisplayed;
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 1 of the previous code, the function is declared. It has two parameters: a <a id="id241" class="indexterm"></a>string variable (<code class="literal">label</code>) and a Boolean variable (<code class="literal">toBeDisplayed</code>). The first parameter determines whether a specific<a id="id242" class="indexterm"></a> texture needs to be displayed, whereas the second parameter will be used to identify which texture will be displayed. Depending on the value of the variable <code class="literal">toBeDisplayed</code>, the corresponding texture will be either displayed (<code class="literal">true</code>) or hidden (<code class="literal">false</code>).</p></li><li style="list-style-type: disc"><p>In statement 3 of the previous code, we use the built-in function <code class="literal">GameObject.Find</code><a id="id243" class="indexterm"></a> to identify the <code class="literal">GUItextutre</code> object with the corresponding label that we need to either hide or display (for example, <code class="literal">GUITexture_key</code> or <code class="literal">GUITexture_gun</code>).</p></li></ul></div><p>Next, we will need to specify when these textures will need to be hidden or displayed. Add the code<a id="id244" class="indexterm"></a> that is highlighted in the following code snippet:</p><div class="informalexample"><pre class="programlisting">function OnControllerColliderHit(c : ControllerColliderHit)
{
if (c.gameObject.tag == "medpack" || c.gameObject.tag == "key" || c.gameObject.tag == "gun")
    {
      if (c.gameObject.tag == "key") <span class="strong"><strong>{hasKey = true; changeGUITexture(true, "key");</strong></span>
    }
  if (c.gameObject.tag == "gun") <span class="strong"><strong>{hasGun = true; changeGUITexture(true, "gun");}</strong></span>
</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In <a id="id245" class="indexterm"></a>statement 5 of the previous code, if the key has been collected, the variable <code class="literal">hasKey</code> is set to <code class="literal">true</code> and the function <code class="literal">changeGUITexture</code><a id="id246" class="indexterm"></a> is called with the parameters <code class="literal">true</code> and <code class="literal">key</code>, which means that we will display the <code class="literal">GUITexture</code> for which the name includes the text <span class="strong"><strong>key</strong></span> (that is, <code class="literal">GUITexture_key</code>)</p></li><li style="list-style-type: disc"><p>In statement 7 of the previous code, we will display the <code class="literal">GUITexture</code> for which the name includes the text <span class="strong"><strong>gun</strong></span> in the same way as for the key</p></li></ul></div><p>Finally, we need to hide the <code class="literal">GUITextures</code> at the start of the scene. This can be done using the <code class="literal">Start</code> function<a id="id247" class="indexterm"></a> within the <code class="literal">collisionDetection</code> script; add <a id="id248" class="indexterm"></a>the following code:</p><div class="informalexample"><pre class="programlisting">function Start () 
{
  hasGun = false;
  hasKey = false;
  health = 0;
<span class="strong"><strong>  changeGUITexture(false, "key");</strong></span>
<span class="strong"><strong>  changeGUITexture(false, "gun");</strong></span>
}</pre></div><p>The highlighted statements in the previous code suggest that the <code class="literal">GUITextures</code> for the key and the gun are hidden.</p></div>