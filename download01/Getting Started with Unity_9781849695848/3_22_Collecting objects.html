<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec26"></a>Collecting objects</h2></div></div><hr /></div><p>So far, we have managed to implement navigation around the maze as well as a timer. As we<a id="id179" class="indexterm"></a> initially planned, we will now need to make it possible for the player to collect objects (for example, med packs and keys) to escape the maze. To collect the objects, we will use collision detection and a script that will destroy the objects collected. First, let's create some items and add them to the scene:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new cube, rename it <code class="literal">medpack</code>, then change its position to (x=3, y=1, z=6), and its scale to (x=0.5, y=0.5, z=0.2).</p></li><li><p>Locate the texture labeled <code class="literal">texture_medpack</code> in the folder <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter3</strong></span> | <span class="strong"><strong>chapter3_pack</strong></span>. Apply the texture <code class="literal">texture_medpack</code> to the cube.</p></li><li><p>Create a new script inside the folder <span class="strong"><strong>chapter3</strong></span> | <span class="strong"><strong>Scripts</strong></span> and rename it <code class="literal">rotate</code>.</p></li></ol></div><p>Open this script (double-click on it) and add the following code:</p><div class="informalexample"><pre class="programlisting">function Start () 
{
}
function Update () 
{
  transform.Rotate(Vector3(0,1,0), 180*Time.deltaTime);
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In statement 4 <a id="id180" class="indexterm"></a>of the previous code, the function <code class="literal">Update</code> will be called every frame and modify the rotation of the object attached to the script.</p></li><li style="list-style-type: disc"><p>In<a id="id181" class="indexterm"></a> statement 6 of the previous code, a rotation of 180 degrees per second around the y axis is applied to the transform of the object linked to this script. The y axis is specified as the axis of rotation using the syntax <code class="literal">Vector3(0,1,0)</code>. A transform component relates to any transformation applied to the object including translation, rotation, and scaling.</p></li></ul></div><p>Link the script to the object labeled <code class="literal">medpack</code>, and play the scene (either by dragging-and -dropping the script onto the object or by selecting the object and then <span class="strong"><strong>Component</strong></span> |<span class="strong"><strong> Scripts</strong></span> |<span class="strong"><strong> Rotate</strong></span>). Play the scene, and check that the med pack is rotating.</p><p>Now that we have made this med pack more visible, we need to detect collisions with the player as follows: objects will be given a tag (that is, a label), and when the collision occurs, a built-in function will be called to obtain information on the collider involved in the collision; we will then check the tag of the object we are colliding with based on the collider mentioned previously, and if this object can be collected, then we will destroy it and update the game information accordingly (for example, increase the score, update the inventory, or display a customized message).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>It is good practice to give a tag to the objects used in your game; it makes it easier to identify them, to group objects based on common properties, and to create custom behaviors or scripts accordingly.</p></div><p>To add a tag, we can proceed as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the object labeled <code class="literal">medpack</code> in the <span class="strong"><strong>Hierarchy</strong></span> window (click once on the object).</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> window<a id="id182" class="indexterm"></a>, click on the drop-down menu to the right of the label <span class="strong"><strong>Tag</strong></span>.</p></li><li><p>From the<a id="id183" class="indexterm"></a> drop-down menu, select the option <span class="strong"><strong>Add tag</strong></span>.</p></li><li><p>This should open a window called <span class="strong"><strong>Tag Manager</strong></span>.</p></li><li><p>In this window, click on the arrow to the left of the label <span class="strong"><strong>Tags</strong></span>; this will display a list of elements (or tags) available.</p></li><li><p>Click<a id="id184" class="indexterm"></a> to the right of the last elements listed (for example, <code class="literal">Element0</code>), type medpack, and press <span class="emphasis"><em>Enter</em></span>. This will create a new tag named <code class="literal">medpack</code>.</p></li><li><p>To apply this tag, click on the object labeled <code class="literal">medpack</code> in the <span class="strong"><strong>Hierarchy</strong></span> window <a id="id185" class="indexterm"></a>and click on the drop-down menu to the right of the label <span class="strong"><strong>Tag</strong></span> in the <span class="strong"><strong>Inspector</strong></span> window. This time the new tag <code class="literal">medpack</code> should appear.</p></li><li><p>Click on this tag to select it for our object.</p></li></ol></div><p>To handle the collision, we will now create a script to be added to the <span class="strong"><strong>First Person Controller</strong></span> object:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new script inside the folder <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>chapter3</strong></span> | <span class="strong"><strong>Scripts</strong></span> and rename it <code class="literal">collisionDetection</code>.</p></li><li><p>Add the following code to the script:</p><div class="informalexample"><pre class="programlisting">function OnControllerColliderHit(c : ControllerColliderHit)
{
  print("collided with "+c.gameObject.tag);
}</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In<a id="id186" class="indexterm"></a> statement 1 of the previous code, the function <code class="literal">OnControllerColliderHit</code> is declared. It is a built-in function that is used to handle collisions between a character controller and other objects. The parameter c is the collider of the object colliding with the controller.</p></li><li style="list-style-type: disc"><p>In statement 3 of the previous code, we print a message in the console that indicates the tag of the object the controller is colliding with. The tag is obtained from the object, which is obtained from the collider (that is, <span class="strong"><strong>collider</strong></span> | <span class="strong"><strong>object</strong></span> | <span class="strong"><strong>tag</strong></span>).</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p><code class="literal">OnControllerColliderHit</code> is a built-in function that Unity3D will call in case <a id="id187" class="indexterm"></a>of a collision between the controller and other objects. If we misspell the name of this function (for example, use a lowercase <code class="literal">o</code> for its initial instead of an uppercase <code class="literal">O</code>, the function may not generate any error, but collision will not be handled in this function. The collision will not be handled because Unity3D will assume that we created a function called <code class="literal">onControlerColliderHit</code> rather than the one it is expecting.</p></div></li></ol></div><p>Attach the script to the <span class="strong"><strong>First Person Controller</strong></span> object (that is, to the top-most level) located in the folder (or empty object) labeled <code class="literal">maze</code>, open the <span class="strong"><strong>Console</strong></span> window (<span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span>) and test the scene (<span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>P</em></span>). After colliding with the med pack, we should see a message in the <span class="strong"><strong>Console</strong></span> window saying <span class="strong"><strong>collided with medpack</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note19"></a>Note</h3><p>Because the player is constantly walking (and colliding with the ground), and that the ground has no tag assigned yet, the <span class="strong"><strong>Console</strong></span> window will display the message <a id="id188" class="indexterm"></a>
<span class="strong"><strong>collided with untagged</strong></span>. Because this collision happens constantly (unless the player is jumping), the <span class="strong"><strong>Console</strong></span> window may be flooded with messages. We may enable the option <span class="strong"><strong>collapse</strong></span> in the <span class="strong"><strong>Console</strong></span> window (button located at the top-left corner of the <span class="strong"><strong>Console</strong></span> window); this will prevent messages from being displayed repeatedly and collapse identical messages accordingly.</p></div><p>Press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>P</em></span> to return to the editing mode. We will now modify this script to destroy the med <a id="id189" class="indexterm"></a>pack by adding the following line to the script:</p><div class="informalexample"><pre class="programlisting">if (c.gameObject.tag == "medpack") Destroy(c.gameObject);</pre></div><p>In the previous line, we detect the tag of the object we are colliding with and then destroy this object accordingly. Test the scene by colliding with the med pack and check that it disappears.</p></div>