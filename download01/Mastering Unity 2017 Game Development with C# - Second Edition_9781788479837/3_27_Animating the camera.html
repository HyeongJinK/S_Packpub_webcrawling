<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec32"></a>Animating the camera</h2></div></div><hr /></div><p><span class="emphasis"><em>Dead Keys</em></span> needs a first-person camera that's effectively on rails. The camera must slowly follow a predetermined path through the scene; its staggered movement from one location to the next is a sign of player progress. So far, a set of specific waypoints have been created (in the previous section), defining locations the camera <span>stops</span> at on its journey to engage with the oncoming zombies.</p><p>To create this motion for the camera, multiple animations must be created, one for each journey between waypoints (one for A to B, another for B to C, then another for D to E, and so on). Before creating the animations, however, it's important to structure your object hierarchy for the camera, as needed. Changes to your object hierarchy after creating an animation can invalidate how the animation works. I've used several empty objects nested in parent-child relationships, with camera objects as children, to create an organized and structured hierarchy. It takes the form of <strong class="userinput"><code>Navigator</code></strong><span class="emphasis"><em>|</em></span><strong class="userinput"><code>Player</code></strong><span class="emphasis"><em>|</em></span><strong class="userinput"><code>Main Camera</code></strong>. The <strong class="userinput"><code>Navigator</code></strong> and <strong class="userinput"><code>Player</code></strong> objects are both empties and <strong class="userinput"><code>Navigator</code></strong> is the top-level player object that'll be animated through the level:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/05013d15-348a-40c5-a457-ed947e528da2.png" /></div><p>Creating a player camera hierarchy</p><p>Now, select the topmost navigator object and display the <strong class="userinput"><code>Animation</code></strong> window (not Animator) by choosing <strong class="userinput"><code>Window</code></strong><span class="emphasis"><em>|</em></span><strong class="userinput"><code>Animation</code></strong>. The <strong class="userinput"><code>Animation</code></strong> window is a horizontal interface (viewed from left to right), and is best docked at the bottom of the editor:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/fffb3379-56fa-46f5-b480-a2df0b32fe44.png" /></div><p>Showing the Animation window</p><p>Using the <strong class="userinput"><code>Animation</code></strong> window, you can create, and then attach, multiple animations to the selected object. Click on the <strong class="userinput"><code>Create</code></strong> button from the <strong class="userinput"><code>Animation</code></strong> window to make the first animation. Before clicking, ensure that the top-level navigator object is selected from the <strong class="userinput"><code>Hierarchy</code></strong> panel. Unity prompts you to name the animation, which will be saved in the project as an animation clip asset. I've used the name <code class="literal">anim_Level01_camath_01</code>, as this specifies the asset type (<code class="literal">anim</code>), the scene applicability (<code class="literal">Level01</code><span class="emphasis"><em>)</em></span>, and the order it should be played in (<code class="literal">camath_01</code>). I recommend saving all animation clips to a dedicated <strong class="userinput"><code>Animation</code></strong> folder in the <strong class="userinput"><code>Project</code></strong> panel:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/ade75f7f-02ac-42b9-9517-2984dd8812d1.png" /></div><p>Creating a new animation</p><p>Let's focus on the workflow for building our first <span>travel</span> animation, moving from Waypoint A to Waypoint B. To achieve this, use the <strong class="userinput"><code>Animation</code></strong> window to create two new entries, listing the properties to be animated. In our case, the <strong class="userinput"><code>Position</code></strong> and <strong class="userinput"><code>Rotation</code></strong> of the player will be changed. Click on the <strong class="userinput"><code>Add Property</code></strong> button from the <strong class="userinput"><code>Animation</code></strong> window, and then select <strong class="userinput"><code>Transform</code></strong> | <strong class="userinput"><code>Position</code></strong> and <strong class="userinput"><code>Transform</code></strong> | <strong class="userinput"><code>Rotation</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/5f139a2c-e5c3-4464-91f9-16568e6df4a9.png" /></div><p>Adding properties for camera position and rotation</p><p>After adding both properties, key frames are auto generated for each, one for the first frame and one for the last. Key frames define the state of an object at a specified time. Initially, the generated frames hold the position and rotation for the player at the start and end of the animation. These key frames span the 0-1 range, and their position should be left as is because we want key frames there. The time line is measured in seconds and thus 1 means 1 second after animation start, assuming that the animation begins at 0. In general, always define animation key frames within the 0-1 range, unless you have an overriding reason not to, because it supports design elegance. Specifically, Unity lets you scale time in animations by a scalar, either up or down, to slow down and speed up animations; 0.5 means half speed, 2 means double speed, and so on. Thus, by keeping animations within 0-1, you can always determine animation duration by scale alone; because <span class="emphasis"><em>1 x Scale = Scale</em></span>:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/0c1ff8d2-1a8a-422c-8d96-2c4bae7798da.png" /></div><p>Keep key frames in 0-1 time</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note20"></a>Note</h3><p>Defining key frames outside 0-1 is acceptable and sometimes justifiable. You'll need times greater than 1 if your animation has lots of key frames, or if events have exact times.</p></div><p>Start by defining the position and rotation of the <span>camera</span> for the first key frame, using the established waypoints. Select <strong class="userinput"><code>Waypoint_A</code></strong> in the level and, from its <strong class="userinput"><code>Transform</code></strong> component in the object <strong class="userinput"><code>Inspector</code></strong>, click on the cog icon and choose <strong class="userinput"><code>Copy Componen</code></strong><strong class="userinput"><code>t</code></strong>. This copies the position, rotation, and scale values to the clipboard:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/b50e34ca-d6a6-44e4-8e5f-71ccfc527e47.png" /></div><p>Keep key frames in 0-1 time</p><p>Now, paste the values to the destination; select the navigator object again, and click on and drag the time slider in the <strong class="userinput"><code>Animation</code></strong> window, moving to the first frame. Finally, select the cog icon in the navigator <strong class="userinput"><code>Transform</code></strong> component and choose <strong class="userinput"><code>Paste <strong class="userinput"><code>Component</code></strong> Values</code></strong> to paste the copied values to the navigator object. You may want to tweak the Y value for the navigator to position it where it should be at that time. On doing this, the position and rotation for the navigator is set at the first frame. Once completed, move the time slider to the last frame and set the navigator to <strong class="userinput"><code>Waypoint_B</code></strong>. This defines where the navigator begins and ends for the animation:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/bd4b861f-aa6f-416d-a434-96e68043e6ab.png" /></div><p>Defining start and end key frames</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note21"></a>Note</h3><p>Remember, you can autosize the <strong class="userinput"><code>Animation</code></strong> window to fit all frames by selecting them all (using box selection with the mouse) and then pressing <span class="emphasis"><em>F</em></span> on the keyboard. This centers all frames into view.</p></div><p>Unity generates all frames between the <span>key</span> frames and these are known as <span class="strong"><strong>tweens</strong></span> (<span class="emphasis"><em>in-between</em></span>). The process by which <span>tweens</span> are generated is known as <span class="strong"><strong>interpolation</strong></span>. Interpolation uses a look-up line graph, with a curve to determine which values (along the horizontal axis) should be used for the position and rotation tweens as the animation <span>plays</span> back (reading from the vertical axis). By default, linear interpolation is used. This means that the navigator will travel in a straight line, at a consistent speed, from <strong class="userinput"><code>Waypoint_A</code></strong> to <strong class="userinput"><code>Waypoint_B</code></strong>, even if that leads it to travel through walls and solids. This is clearly not the behavior we want, because the camera should take an intelligent and believable route through the scene, making turns where needed.</p><p>To achieve this, we'll need to insert additional key frames between the start and end keys to fix the position and rotation of the navigator at intermediary moments. This will necessarily change how Unity interpolates the tweens. Hence, move the time slider across the timeline in the <strong class="userinput"><code>Animation</code></strong> window, previewing the camera route in the <strong class="userinput"><code>Scene</code></strong> and <strong class="userinput"><code>Game</code></strong> viewport. Then, move the time slider to frames where the camera begins deviating from its intended course, repairing that course by repositioning and rotating the camera as appropriate. This auto generates key frames for the camera at the selected time. Repeat this process until the route from <strong class="userinput"><code>Waypoint_A</code></strong> to <strong class="userinput"><code>Waypoint_B</code></strong> is correct over the complete time line:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/bf0db567-c21e-4309-ba2b-8a4a7bb56b85.png" /></div><p>Creating camera path key frames</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>You can copy and paste key frames with <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>C</em></span> and <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>V</em></span>, respectively. Also, you can drag key frames over the time line to reposition them.</p></div><p>Preview the animation carefully by scrubbing the time slider back and forth in the timeline, ensuring that the camera route is appropriate. In addition to creating the route, as we've done, you'll probably want to change the interpolation curves for the start and end key frames, creating an <span class="emphasis"><em>ease-in</em></span> and <span class="emphasis"><em>ease-out</em></span> effect. Right now, the camera jumps into motion in the first frame and comes to a sudden and complete stop at the end. While this is acceptable, it doesn't <span class="emphasis"><em>feel</em></span> smooth. Instead, we can use <span class="emphasis"><em>ease-in</em></span> to slowly bring the camera into motion in the first frame, and <span class="emphasis"><em>ease-out</em></span> to gradually bring the camera to a stop at the end. To achieve this, start by opening the <strong class="userinput"><code>Curves</code></strong> editor from the <strong class="userinput"><code>Animation</code></strong> window; just click on the <strong class="userinput"><code>Curves</code></strong> button:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/94205cbb-97ec-40ea-bd33-6aaebb9f0669.png" /></div><p>Displaying the animation curve editor</p><p>The curve editor may initially display a mess of curves, or an otherwise indecipherable graph. This may be because the view is not appropriately zoomed in or out. You can click on and drag a box selection around all points and curves, and then press the <span class="emphasis"><em>F</em></span> key on the keyboard to frame all curves into the <strong class="userinput"><code>Animation</code></strong> window.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>Remember that you can press <span class="emphasis"><em>Shift</em></span> + <span class="emphasis"><em>spacebar</em></span> on the keyboard to maximize the <strong class="userinput"><code>Animation</code></strong> window, making its contents fullscreen.</p></div><div class="mediaobject"><img src="/graphics/9781788479837/graphics/cd2e3de9-50ba-43b7-ad3e-f0b52114e8c3.png" /></div><p><span>Maximizing the curve editor</span></p><p>Select the <strong class="userinput"><code>Position</code></strong> field from the property list to <span>filter</span> the graph, viewing only the X, Y, and Z position curves. Note the straight lines that run from the first frame and terminate at the final frame, with no curve or damping to soften the motion. This represents sudden changes, from motionlessness to motion and from motion to motionlessness:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/1d0d0102-f386-4ce8-99b5-26f7670b6b6c.png" /></div><p>Identifying sudden and inappropriate changes in motion</p><p>Right-click on the first and last keys for the X, Y, and Z fields. From the context menu, choose the <strong class="userinput"><code>Flat</code></strong> option to flatten the bezier handle for the key frame. This creates a soft transition in the curve, creating an <span class="emphasis"><em>ease-in</em></span> and <span class="emphasis"><em>ease-out</em></span> at the animation start and end respectively. The result is a smoother, more believable camera motion:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/b742a63d-7fcf-4ba2-9291-e05818aa78da.png" /></div><p>Creating ease-in and ease-out for camera movement</p><p>Your first animation, moving from <strong class="userinput"><code>Waypoint_A</code></strong> to <strong class="userinput"><code>Waypoint_B</code></strong>, is now complete! You can test this from the Scene view port, even in the Game mode. By default, Unity creates and applies an animator asset and component to the navigator object, which plays the created animation at level startup (we'll change that behavior later). You'll probably <span>want</span> to disable animation looping as well as reduce the playback speed. The speed can be adjusted later. To disable looping, select the animation clip asset in the <strong class="userinput"><code>Project</code></strong> panel and disable the <strong class="userinput"><code>Loop Time</code></strong> checkbox:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/bb42bd72-3069-4237-9093-2b95ae7ac2e7.png" /></div><p>Creating play-once animation clips</p><p>Having created one travel animation, let's create the remaining ones. More animations can be easily added to the selected object via the <strong class="userinput"><code>Animation</code></strong> window by clicking on the <strong class="userinput"><code>Animation</code></strong> name drop-down menu. This reveals a drop-down menu, including the option of <strong class="userinput"><code>Create New Clip...</code></strong>; select this option and Unity prompts you again to name and save the clip as an asset of the project:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/1f8612ff-192c-4de1-ba09-bcf5861fc9f6.png" /></div><p>Adding animation clips</p><p>Great work! You've now created all <span>camera</span> animations. The next step consists of configuring a Mecanim graph to play them at appropriate times.</p></div>