<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec45"></a>Damage and feedback</h2></div></div><hr /></div><p>The <strong class="userinput"><code>Health</code></strong> component allows objects to have <span>health</span> and therefore to take damage during attacks, but we also want more UI feedback for the player during a battle. Specifically, when the player is attacked and hit by a zombie, the screen should throb or flash red, indicating that damage has been sustained. We can achieve this using a colored sprite overlay whose opacity is animated from transparent to visible and then back again. To achieve this, create the colored overlay by choosing <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>UI</code></strong> | <strong class="userinput"><code>Image</code></strong> to create a new image object. Name this <code class="literal">Panel_Damage_Throbber</code>. Add this as a child object of the <code class="literal">Health UI Canvas</code> created earlier. Select red for the <strong class="userinput"><code>Color</code></strong> field to express danger, damage, and pain, or you can use a custom texture:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/472d0e30-3496-45f7-a243-9a8d59f124a0.png" /></div><p>Creating a red, damage UI object</p><p>Use the <strong class="userinput"><code>Rect</code></strong><strong class="userinput"><code>Transform</code></strong> tool (<span class="emphasis"><em>T</em></span>), as shown in the following screenshot, to resize the image plane to fill the canvas, and thereby the screen. Then, use anchoring to attach each corner anchor to the respective edges of the screen (stretch anchoring). This ensures that the damage panel fully occupies screen space:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/6ab04382-74ac-4dbf-b15a-9b9ceae65e05.png" /></div><p>Resize the damage panel overlay</p><p>To create the damage animation, simply open the <strong class="userinput"><code>Animation</code></strong> window, add a new animation, and insert three key frames: one at the start of the animation, one in the middle, and one at the end. Each key frame animates the sprite color (alpha component). Start with an Alpha of <code class="literal">0</code>, move to <code class="literal">1</code>, and then back to <code class="literal">0</code> by the final frame. This creates a ping-pong, back and forth, for the alpha. Again, work within the <code class="literal">0</code>-<code class="literal">1</code> space for the animation duration, as the <strong class="userinput"><code>Speed</code></strong> can always be tweaked from the Mecanim graph:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/b4e35e26-c31d-4fb8-a4e7-c95ecda04c6e.png" /></div><p>Creating a Throb animation</p><p>Flatten the key frame handles for the start and <span>end</span> frames using the <strong class="userinput"><code>Curves</code></strong> view in the animation editor to smooth out the fade, creating a more natural transition. You can also click on and drag the handles in the editor to further refine the curve:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/df351fe3-145e-428b-856b-bf65bf82c612.png" /></div><p>Flattening keyframe handles to create smoother motion</p><p>Finally, add an animation controller to the damage object. This should begin in an idle node (empty state) and transition to the damage animation based on a trigger parameter, that is, by enabling a trigger parameter, the damage animation should play. The details of creating this kind of graph have been covered amply throughout this and the last chapter. The final graph should look like this:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/81e53783-981e-48b8-a4d0-c269ec2aba2f.png" /></div><p>Creating an animation graph for the damage fader</p><p>To connect player health to the damage fader, select the <strong class="userinput"><code>Player</code></strong><span>object</span> and, from its health component, we can set the animation <span>Trigger parameter</span> for damage from the <strong class="userinput"><code>OnHealthChanged ()</code></strong> event directly from the object <strong class="userinput"><code>Inspector</code></strong>. Again, no additional code is needed:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/61053d98-dac0-41fc-b2df-a2c9acb67d32.png" /></div><p>Link the OnHealthChanged event to the damage object</p><p>Great! Now health is linked to the damage effect. We can test this, if needed, by simply changing the player health at runtime.</p></div>