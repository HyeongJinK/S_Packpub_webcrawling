<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec58"></a>Zombies and text input</h2></div></div><hr /></div><p>In addition to the FSM for <span>zombie</span> behaviors, such as Idle, Chase, Attack, and Death, zombies respond to player input. Specifically, the player may <span>attack</span> by typing letters on the keyboard, matching the complete word above the zombie's head:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/c07f0fcf-c66d-4255-aa83-094de2325f66.png" /></div><p>Attacking zombie with typed text input</p><p>To achieve this, we must firstly display a word above the zombie's head, then keep track of the word being typed, and finally determine whether a match has been made. We already have some code to achieve much of this, but we should now link it specifically to the zombie character. Let's start by creating a text object that hovers above the zombie's head. Select the zombie NPC and expand its hierarchy in the <span><strong class="userinput"><code>Hierarchy</code></strong></span> panel. Select the <code class="literal"><span>Armature</span></code> object and locate the <span>head</span> bone. This represents an empty game object used to move the character's head during animation. Any object attached to the head bone, therefore, moves with the character's head:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/16583e6b-32d3-4fee-b565-703ff7492f43.png" /></div><p>Selecting the character's head bone</p><p>Now, right-click on the selected head bone and navigate to <span><strong class="userinput"><code>UI </code></strong></span>|<span class="emphasis"><em> </em></span><span><strong class="userinput"><code>Canvas</code></strong></span> from the context menu. This creates a new UI canvas object that is a child of the <span>head</span> bone. Alternatively, you can navigate to <strong class="userinput"><code><span>GameObject </span></code></strong>| <strong class="userinput"><code><span>UI </span></code></strong>| <strong class="userinput"><code><span>Canvas</span></code></strong> from the application menu, and then drag and drop the newly created <span class="strong"><strong><strong class="userinput"><code>Canvas</code></strong></strong></span> to the <span>head</span> bone:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/a0c09fdc-d464-45a7-8025-910a50578e72.png" /></div><p>Creating a Canvas object as a child of the head bone</p><p>By default, a UI Canvas object is configured with a render mode of <span><strong class="userinput"><code>Screen <strong class="userinput"><code>Space - Overlay</code></strong></code></strong></span>. This means the interface will always appear on top of everything else in 2D screen space. For the head text, however, we'll need a <span>World Space</span> UI element, that is, a UI object existing as a 2D object in a 3D world (with its own position, rotation, and scale), as opposed to a flat object aligned in screen space. After selecting a <span><strong class="userinput"><code>World Space Render Mode</code></strong></span>, you'll need to select a camera for rendering the element. For our scene, choose the <span><strong class="userinput"><code>Main Camera</code></strong></span>:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/dd5773b1-5ad4-4483-bd63-a4e401b6b978.png" /></div><p>Creating a Canvas object as a child of the head bone</p><p>Next, create a <span><strong class="userinput"><code>Text</code></strong></span> object as a child of the <span><strong class="userinput"><code>World Space</code></strong></span> canvas simply by right-clicking on the <code class="literal"><span>Canvas</span></code> object in the <span><strong class="userinput"><code>Hierarchy</code></strong></span> panel and navigating to <span><strong class="userinput"><code>UI</code></strong></span> | <span><strong class="userinput"><code>Text</code></strong></span> from the context menu. Assign the text a yellow color to attract attention, and set the <span><strong class="userinput"><code>Font Size</code></strong></span> to <code class="literal"><span>20</span></code>. Ensure that <span><strong class="userinput"><code>Rich Text</code></strong></span> is enabled to allow for font color changes and other formatting effects, and to allow for text effects while the user is typing. In addition, change the <strong class="userinput"><code>Alignment</code></strong> to both vertical and horizontal center:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/a0d4748c-0ed9-44eb-b1b1-066250be7cba.png" /></div><p>Creating head text</p><p>The text object, though existing in world space above the zombie's head, should always face the camera' wherever it is located. This is to prevent the text from being shown at grazing angles, or from behind, where it becomes difficult to read. The player must always be able to see the text to enter the right combination of letters. To achieve this, we'll need to create a short but important script (<code class="literal">CameraFacing</code>), which should be attached to the text (and any other object) that must always face the camera. The following is the featured code:</p><pre class="programlisting">//------------------------------------ 
using UnityEngine; 
using System.Collections; 
//------------------------------------ 
public class CameraFacing : MonoBehaviour  
{ 
    //------------------------------------ 
    //Reference to local transform 
    private Transform ThisTransform = null; 
    //------------------------------------ 
    // Use this for initialization 
    void Awake () 
    { 
        ThisTransform = GetComponent&lt;Transform&gt; (); 
    } 
    //------------------------------------ 
    // Update is called once per frame 
    void LateUpdate ()  
    { 
        ThisTransform.LookAt (Camera.main.transform); 
    } 
    //------------------------------------ 
} </pre><p>The <code class="literal">CameraFacing</code> script should be attached specifically to the <code class="literal">Canvas</code> object:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/514bc4ed-e01c-4ec3-ac0e-55de476be9b0.png" /></div><p>Attaching the CameraFacing script to the zombie character</p><p>Now, we must refine the <code class="literal">EnemyAI</code> script further to <span>select</span> a word <span>from</span> the word list, at random, for the zombie character when the level begins. In addition, once the word is selected from the list, we'll update the zombie text to show the selected word. This is achieved by the <code class="literal">UpdateText</code> function. Consider the following code, for both the <code class="literal">Start</code> and <code class="literal">UpdateText</code> functions, included in the <code class="literal">EnemyAI</code> script:</p><pre class="programlisting">    //------------------------------------ 
    void Start() 
    { 
        //Set active state 
        ActiveState = mActiveState; 
        //Get random word 
        AssocWord = WordList.ThisInstance.GetRandomWord(); 
        UpdateText(); 
    } 
    //------------------------------------  
    public void UpdateText () 
    { 
        //Build UI String 
        NameTextComp.text = "&lt;color=red&gt;" + MatchedWord + "&lt;/color&gt;" + 
        AssocWord.Substring(MatchedWord.Length,AssocWord.Length-
        MatchedWord.Length); 
    } 
    //------------------------------------  </pre><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec58"></a>Comments</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">The <code class="literal">Start</code> function uses the <code class="literal">WordList</code> class to <span>select</span> a word at random from the word list. This list is loaded from a text file. The selected word is stored in the <code class="literal">AssocWord</code> string variable (which means associated word).</li><li style="list-style-type: disc">Next, the <code class="literal">UpdateText</code> function simply displays the selected word, from the <code class="literal">WordList</code>, in the text object attached to the zombie head. This function should be called whenever the zombie text changes. The <code class="literal">MatchedWord</code> variable, as we'll see, determines how much of the associated word has been successfully typed by the player:</li></ul></div><div class="mediaobject"><img src="/graphics/9781788479837/graphics/30084dd4-b571-4fb8-979f-d35945fbba9a.png" /></div><p>Stylizing the enemy text</p><p>The <code class="literal">UpdateText</code> function uses the <span><strong class="userinput"><code>Rich Text</code></strong></span> functionality in Unity to stylize the displayed text. Specifically, all typed letters in the associated word are shown in red, while all untyped letters remain in yellow. This is achieved by inserting HTML style tags within the string itself. When <span><strong class="userinput"><code>Rich Text</code></strong></span> is enabled for the text field, all HTML style tags are removed and replaced with corresponding stylizations. Unity supports the following tag types: <code class="literal">&lt;b&gt;</code> for bold, <code class="literal">&lt;i&gt;</code> for italic, <code class="literal">&lt;size&gt;</code> for font size, and <code class="literal">&lt;color&gt;</code> for font color. More information on <span><strong class="userinput"><code><span>Rich</span> Text</code></strong></span> can be found online in the Unity documentation, at <a class="ulink" href="https://docs.unity3d.com/Manual/StyledText.html" target="_blank">https://docs.unity3d.com/Manual/StyledText.html</a><span>.</span></p></div></div>