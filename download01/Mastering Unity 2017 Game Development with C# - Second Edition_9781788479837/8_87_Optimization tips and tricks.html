<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec87"></a>Optimization tips and tricks</h2></div></div><hr /></div><p>The <strong class="userinput"><code>Stats</code></strong> panel and the <strong class="userinput"><code>Profiler</code></strong> are solid <span>tools</span> for diagnosing performance problems in your game, as well as determining where those problems are in the script, thereby suggesting how they may be corrected. However, as mentioned, optimization should begin in the design phase of development and should persist throughout all subsequent stages. Consequently, there are some general tips, tricks, and workflows that can be followed, with proper consideration and limitations, to help optimize your game throughout development, minimizing the problems that can emerge later. This section explores some of these tips and tricks, in addition to those already mentioned in Chapter 1, <span class="emphasis"><em>Preparation and Asset Configuring</em></span>. Let's see these.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec74"></a>Strings and comparisons</h3></div></div></div><p>Working with strings in Unity is common. Game objects have names and tags, animations have parameters, and games feature many other <span>string</span> properties, including names, localization data, character dialog, and more. Consequently, we often need to compare two strings, checking to see whether two words match--such as searching for objects by name, or checking words typed by a player in a dictionary. There are many <span>ways</span> to compare strings in code, but these vary in performance and speed, and the fastest method has not always remained constant across versions. As of Unity 5.5, the optimal method for comparing two strings for equality is as follows:</p><pre class="programlisting">StringOne.Equals(StringTwo, StringComparison.Ordinal);</pre><p>The most important part of the preceding code is supplying <code class="literal">StringComparison.Ordinal</code> as a second argument. This ensures that the string comparison is based only on upper- and lowercase versions within the same character set, and assumes that the strings are within the same language.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec75"></a>Beware of functions in disguise</h3></div></div></div><p>C# properties are great language features <span>for</span> wrapping up access to variables through internal functions. This helps us validate values assigned to variables, and to detect when variables change. However, C# properties have a performance overhead that makes them expensive compared to direct variable access. For this reason, to optimize script performance, always seek to cache variables. This problem is most notable in Unity when using <code class="literal">MonoBehaviour</code> class variables, or static class variables, which provide shortcut access to other components or objects. Consider the following example:</p><pre class="programlisting">transform.position = new Vector3(0,0,0);</pre><p>Here, the <code class="literal">transform</code> variable provides syntax-quick access to the <code class="literal">Transform</code> component attached to the associated game object. However, <code class="literal">transform</code> is a C# property, which, as a hidden function call, is equivalent to the much slower <code class="literal">GetComponent&lt;Transform&gt;()</code> statement. For this reason, it is better to use the <code class="literal">Awake</code> event of a script to cache the <code class="literal">Transform</code> component to a class variable for quick access later. Consider this <span>example</span>:</p><pre class="programlisting">    void Awake() 
    {
     ThisTransform = GetComponent&lt;Transform&gt;();
    }</pre><p>Using this code, the <code class="literal">ThisTransform</code> variable should be used throughout to refer to the <code class="literal">Transform</code> component. Other variables that are really properties and that involve hidden function calls include <span>the following:</span></p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><code class="literal">transform</code></li><li><code class="literal">audio</code></li><li><code class="literal">rigidbody</code></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec76"></a>Debug cleaning</h3></div></div></div><p>Here's a great tip for cleaning your project and <span>code</span> of debug statements! We all use the <code class="literal">print</code> and <code class="literal">Debug.Log</code> functions to print debug messages to the console to validate our code and its execution. However, it's easy to add many debug statements, eventually spamming the console with many. Furthermore, when the time comes to build our game, we normally want to remove all debug statements to prevent our application from running code that isn't effective anymore. For example, consider the following statement:</p><pre class="programlisting">Debug.Log("Hello World");</pre><p>This code prints the following message to the console, which can be seen from the Unity editor, but not in a standalone build:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/1c6f6088-cb01-4f17-8d55-268f5b551bd5.png" /></div><p>Printing debug messages</p><p>It can be tedious having to remove every <code class="literal">Debug.Log</code> or <code class="literal">Print</code> statement from a final build. So, instead, you can use the <code class="literal">Conditional</code> C# attribute. Consider the following class, which is a <code class="literal">DebugManager</code> used for printing debug messages:</p><pre class="programlisting">using System.Collections; 
using System.Collections.Generic; 
using UnityEngine; 
using System.Diagnostics; //Namespace for conditional attribute 

public class DebugManager : MonoBehaviour 
{ 
   //This function is only valid when the DEBUG_MANAGER directive is enabled 
   [Conditional("DEBUG_MANAGER")] 
   public static void PrintMessage(string Message) 
   { 
         //Prints a message to the console 
         UnityEngine.Debug.Log (Message); 
   } 
} </pre><p>This code uses the <code class="literal">System.Diagnostics</code> namespace to mark the <code class="literal">PrintMessage</code> function with the <code class="literal">Conditional</code> attribute. The function is tagged as <code class="literal">DEBUG_MANAGER</code>. This means that the <code class="literal">PrintMessage</code> function is only valid and compiled with the project when the <code class="literal">DEBUG_MANAGER</code> directive is activated in the <strong class="userinput"><code>Player settings</code></strong> window. By default, this directive is not activated, and this means that both the <code class="literal">PrintMessage</code> function and any other lines that call this function are treated as comments by the compiler. Let's see that in action. First, check the player settings to ensure that the <code class="literal">DEBUG_MANAGER</code> directive is not specified. To do that, choose <strong class="userinput"><code>Edit</code></strong> | <strong class="userinput"><code>Project Settings</code></strong> | <strong class="userinput"><code>Player</code></strong> from the application menu:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/658f49e9-33bb-4b09-ac74-4d003134b19d.png" /></div><p>Accessing the Player settings window</p><p>The <strong class="userinput"><code>Player settings</code></strong> window displays a <span>range</span> of important game settings from the object <strong class="userinput"><code>Inspector</code></strong>. Expand the <strong class="userinput"><code>Other Settings</code></strong> tab and scroll down to the <strong class="userinput"><code>Scripting Define Symbols</code></strong> field. This field may be empty or may contain some symbols already defined. By default, the <code class="literal">DEBUG_MANAGER</code> symbol is missing:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/982ad52c-7933-44a9-b0a6-89ef739f8d6a.png" /></div><p>Viewing Scripting Define Symbols from the Player settings window</p><p>When the <code class="literal">DEBUG_MANAGER</code> define symbol is missing, all lines referring to any function marked with the <code class="literal">Conditional</code> attribute will be turned into comments, effectively removing them from your script files:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/325b62e9-c09f-44cc-95eb-2309bde298dc.png" /></div><p>Debug code is turned into comments using the Conditional attribute</p><p>Now, add the <code class="literal">DEBUG_MANAGER</code> define into the <span>symbols</span> list from the <strong class="userinput"><code>Player settings</code></strong> window. Each define should be separated by a semicolon (<code class="literal">;</code>). Thus, the <code class="literal">DEBUG_MANAGER</code> define can be added as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/db99713e-c4e4-448b-a20d-1a909071b918.png" /></div><p>Adding the DEBUG_MANAGER define symbol</p><p>On adding the <code class="literal">DEBUG_MANAGER</code> define symbol, all code associated with the <code class="literal">Conditional</code> attribute will be automatically activated in the code:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/212cd497-7dfb-42ab-ab3a-01c860c61fe3.png" /></div><p>Enabling Debug code</p><p>Voila! You now have an easy way to activate and deactivate the debug code for your applications.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec77"></a>Optimizing build size</h3></div></div></div><p>On compiling your game into a standalone executable, whether it's for PC, Mac, or mobiles, you'll always want the build to be as slimline as possible. Ideally, the final build should contain only release-relevant code (stripped of debug statements), and only assets (meshes and textures) used in the game, and these should also be formatted and compressed optimally for the target platform. This ensures that the build runs efficiently for the <span>target</span> hardware and is as small in file size as possible. This is especially important for mobile games and for Asset Store uploading, as many asset stores place limitations on acceptable file sizes for downloadable games. For this reason, we'll need a way to control the build file size.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note58"></a>Note</h3><p>By default, Unity removes all unused assets during a build operation. It does not remove them from the <strong class="userinput"><code>Project</code></strong> panel; rather, it removes the unused assets from the compiled build so that they do not increase its file size. This does not apply to assets in the <code class="literal">Resources</code> folder. For more information on the <code class="literal">Resources</code> folder, see the online documentation at: <a class="ulink" href="https://unity3d.com/learn/tutorials/topics/best-practices/resources-folder" target="_blank">https://unity3d.com/learn/tutorials/topics/best-practices/resources-folder</a>.</p></div><p>To start optimizing a build, it's good to assess how much of an impact each asset will have on the final build and where file size savings can be made. To do this, start by building your game. Select <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>Build Settings...</code></strong> from the application menu:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/d3b286e5-9e94-4963-aad1-308adf07f4a4.png" /></div><p>Accessing the Build Settings</p><p>From the Build dialog, ensure that the correct <span class="strong"><strong>Build Target Platform</strong></span> is selected, such as Windows or Mac. If it's not, then <span>select</span> the platform from the platform list, and then click on the <strong class="userinput"><code>Switch Platform</code></strong> button in the bottom-left of the dialog:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/fe3dde47-ff36-48ed-a390-50cd77d97acc.png" /></div><p>Selecting the Build Platform</p><p>Ensure that all levels are added to the <strong class="userinput"><code>Scenes In Build</code></strong> list and then choose the <strong class="userinput"><code>Build</code></strong> button from the dialog. This prompts you for a save location for the build. Choose a location on your computer, but avoid saving your build anywhere inside the Unity project folder. Saving the build inside the Unity project folder can result in errors that prevent your project from compiling:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/66e56a79-d618-4e65-99e7-a2c0b8b92725.png" /></div><p>Building for the Target Platform</p><p>After the build completes, open the <strong class="userinput"><code>Console</code></strong><span>window</span> and click on the context menu icon from the top right-hand side of the <strong class="userinput"><code>Console</code></strong>. From the context menu that appears, choose <strong class="userinput"><code>Open Editor Log</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/c97af5a8-8ad3-4f46-bfcb-4a10145e7cf3.png" /></div><p>Accessing the build log</p><p>By choosing <strong class="userinput"><code>Open Editor Log</code></strong>, you can view the most recently generated build log, which is a text file produced by the compiler indicating build statistics:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/d5a2ccc2-9b5e-4844-b65f-eb6b4ab05f0c.png" /></div><p>Viewing the build log</p><p>The build log lists all assets included in the compiled build, as well as their final memory consumption (in MB). Remember that the size of the asset file in the <strong class="userinput"><code>Project</code></strong> panel (such as an imported PNG or Mesh file) is not necessarily how large the asset will be in the final build. This is because Unity uses its own internal asset storage system, where the size of each imported asset is determined by its type, size, and import settings, as defined in the object <strong class="userinput"><code>Inspector</code></strong>. The build log lets you determine the compiled size of each asset and can guide you as to where improvements can be made to reduce size:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/733e7d56-97c8-40f9-b416-77efe1a3c80b.png" /></div><p>Assets sorted by size</p><p>One of the first strategies for reducing build size is to shrink textures, making them smaller in dimensions and in memory. This is especially effective for mobile platforms, where textures are shown on smaller screens. To achieve this, select the texture in the <strong class="userinput"><code>Project</code></strong> panel, and change the <strong class="userinput"><code>Max</code></strong><strong class="userinput"><code>Size</code></strong> setting to the smallest size consistent with your intended level of quality:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/cc65df90-283b-46f0-b785-5bc1db32620e.png" /></div><p>Changing texture size</p><p>Disable <strong class="userinput"><code>Generate Mip Maps</code></strong>, under the <strong class="userinput"><code>Advanced</code></strong> tab, for UI textures and other menu or HUD items, as this can result in several versions of the same texture being produced for different quality settings based on the camera viewing distance:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/1fb3ae4d-f815-4251-b324-2de2136951a5.png" /></div><p>Disabling Generate Mip Maps</p><p>You can also enable <strong class="userinput"><code>Mesh Compression</code></strong> for meshes, which reduces their file size within the build, but at the expense of mesh quality. Higher compression produces lower fidelity meshes. Select the mesh in the <strong class="userinput"><code>Project</code></strong> panel, and then select the compression type:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/38cce919-6f06-46ba-8afc-e5307aa5405d.png" /></div><p>Enabling Mesh Compression</p><p>If acceptable, you can try reducing the quality of audio files. Simply select an audio file from the <strong class="userinput"><code>Project</code></strong> panel, and then reduce the <strong class="userinput"><code>Quality</code></strong> slider. Ensure that you click on <strong class="userinput"><code>Apply</code></strong> after adjusting the setting to confirm the change:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/1ba1692d-b689-4961-8680-503bec650a9f.png" /></div><p>Reducing audio quality</p><p>In addition to adjusting settings for specific assets, you can change the supported API level. This defines the .NET (Mono) library of functions and classes used by your application. Most games use only a small subset of the .NET framework in their scripts  thus, can use a lighter version of the library. By using this, your games build to a smaller size. To use the smaller version, select <strong class="userinput"><code>Edit</code></strong> | <strong class="userinput"><code>Project Settings</code></strong> | <strong class="userinput"><code>Player</code></strong> from the application menu. This displays the Player settings window in the object <strong class="userinput"><code>Inspector</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/69758688-9edf-473c-b790-28904c34fac4.png" /></div><p>Editing Player Settings</p><p>From the <strong class="userinput"><code>Player settings</code></strong> window, expand the <strong class="userinput"><code><span>Other</span> Settings</code></strong> group and select <strong class="userinput"><code>.NET 2.0 Subset</code></strong> from the <strong class="userinput"><code>Api Compatibility Level</code></strong> drop-down menu:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/b4f98f57-4f0d-4c8d-8370-aa28de426b37.png" /></div><p>Setting the API level</p></div></div>