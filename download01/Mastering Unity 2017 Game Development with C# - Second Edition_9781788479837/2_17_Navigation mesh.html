<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec23"></a>Navigation mesh</h2></div></div><hr /></div><p>Now, it's time to explore NPC intelligence and, specifically, path finding. We'll need our NPC zombies to move around the scene intelligently, that is, to move without bumping into walls, floors, doors, and other obstacles, and without taking <span>the</span> most complex routes to nearby destinations. Our zombies must cleverly navigate their way around the environment, whatever its arrangement, finding their way toward the player to engage in combat, as though they really had brains! To achieve this, a navigation mesh is required. This is an invisible mesh asset, generated by Unity, to approximate the scene floor for both exterior and interior environments. More accurately, it represents the total walkable floor of the scene--the area over which NPCs may maneuver to travel from point to point. To access the navigation mesh features, click on <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Navigation</code></strong> from the application menu. This opens the <strong class="userinput"><code>Navigation</code></strong> mesh window, which can be docked into the object <strong class="userinput"><code>Inspector</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/ddbaa247-4e49-4d67-b548-2965a51600ad.png" /></div><p>Accessing the navigation mesh features</p><p>The <strong class="userinput"><code>Navigation</code></strong> mesh window is where you can generate a navigation mesh for the scene. At present, Unity allows you to generate only one navigation mesh per scene, and you cannot import a custom mesh. To get started, use the <strong class="userinput"><code>Agent Radius</code></strong> and <strong class="userinput"><code>Agent Height</code></strong> fields to specify the radius and height of the smallest possible agent for your game. These values are used by Unity to determine valid areas into which the navigation mesh can be generated. Openings shorter than, or narrower than, the minimum values cause the navigation mesh to break, preventing agents from traveling through. For <span class="emphasis"><em>Dead Keys</em></span>, the <strong class="userinput"><code>Agent Radius</code></strong> should be <code class="literal">0.5</code>, and the <strong class="userinput"><code>Agent Height</code></strong> should be <code class="literal">2</code>. For your own projects, these values may differ substantially:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/489a6d00-9385-4c21-a3f8-4f66cb2d093c.png" /></div><p>Specifying Agent Radius and Agent Height</p><p>Additionally, the <strong class="userinput"><code>Max Slope</code></strong> field defines the angle (in degrees) of the maximum incline from ground level allowed. Inclines preceding this angle are classified as non-walkable areas and do not feature in the navigation mesh. The <strong class="userinput"><code>Step Height</code></strong> works similarly, except that it's based on height (in meters) rather than angle, that is, steps above <span>the</span> threshold are classified as too high to be walkable. For <span class="emphasis"><em>Dead Keys</em></span>, the default values are acceptable, but for strongly vertical games, you may need to tweak these. Having now defined these basic settings, click on the <strong class="userinput"><code>Bake</code></strong> button from the <strong class="userinput"><code>Navigation</code></strong> mesh window to generate a new navigation mesh:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/6b720f67-f4cb-4041-833b-6b45ccc1c92d.png" /></div><p>Baking a navigation mesh</p><p>Only objects with an active <strong class="userinput"><code>Mesh Renderer</code></strong> component, and marked as <strong class="userinput"><code>Navigation Static</code></strong>, are included in the navigation mesh bake; all the other objects are excluded. To label an object as <strong class="userinput"><code>Static</code></strong>, you can enable the <strong class="userinput"><code>Static</code></strong> checkbox from the object <strong class="userinput"><code>Inspector</code></strong>. You can also click on the static checkbox for a dropdown to be more precise about the applicability of static. This allows you to mark an object as static for navigation, but not for lightmapping, if necessary:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/e52b7a44-437e-4ec4-bb4b-b2c91486f878.png" /></div><p>Enabling Navigation Static</p><p>After the navigation mesh is generated, it appears inside <span>the</span><strong class="userinput"><code>Scene</code></strong> viewport as a blue mesh-based floor. This appears <span class="emphasis"><em>only if</em></span> the <strong class="userinput"><code>Navigation</code></strong> window is open and the <strong class="userinput"><code>Show NavMesh</code></strong> checkbox is enabled from the <strong class="userinput"><code>Navmesh Display</code></strong> dialog. Remember that the navigation mesh is not visible to the player; it simply represents the walkable area of the scene for intelligent NPCs. A player-controlled character is not restricted to the navigation mesh, and nor is an NPC that moves through its transform component:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/e58715a6-a452-4e99-89d1-b415869dab44.png" /></div><p>Previewing a navigation mesh</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>An important limitation of navigation meshes is that they are top-down, that is, a navigation mesh is generated by projecting from the top downwards. In most cases, this works well. However, if you need characters to walk on walls and ceilings, then you'll need to develop a custom solution.</p></div><p>For <span class="emphasis"><em>Dead Keys</em></span>, the floor is divided into walkable and non-walkable areas, and all walkable areas are the same. This makes things simpler for us. However, for some games, this simplicity is not applicable. In real-time strategy games, for example, there are many types of walkable area, including sand, swamp, grass, rock, concrete, wood, and others. These terrain materials influence how easily a unit may walk on the terrain. In some cases, specific terrain types should be avoided, if possible, even if it means taking a longer route. Lava is walkable, but dangerous compared to grass, for example. You can encode this preference behavior into a navigation mesh using <strong class="userinput"><code>Areas</code></strong>. By switching to the <strong class="userinput"><code>Areas</code></strong> tab, you can define different terrain types using a custom name, and assign a cost of travel to each type that is used to influence how a path is generated. Higher costs represent less desirable areas:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/771d88b1-fe76-4009-8881-945d9e388b4d.png" /></div><p>Defining navigation mesh Areas</p><p>Having defined terrain types on <span>the</span><strong class="userinput"><code>Areas</code></strong> tab, you can assign specific types to meshes in the scene through the <strong class="userinput"><code>Object</code></strong> tab. This tab lets you adjust navigation properties for the selected object in the scene. The <strong class="userinput"><code>Navigation Area</code></strong> dropdown is where you assign a type to an object:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/1a3d16b1-730a-42f0-bef5-77749ae20c12.png" /></div><p>Assign terrain types to objects</p><p>Great! We now have a navigation mesh in the scene. This exists as an independent asset of the project too, which can be found in the <strong class="userinput"><code>Project</code></strong> panel in the same folder as the saved scene. The navigation mesh does nothing in itself, that is, the existence of a navigation mesh has no tangible effect immediately on any game objects in the scene. Rather, it's an asset whose importance becomes apparent only as we add intelligent NPCs, such as zombies, to the level, which is covered in the later chapters:</p><div class="mediaobject"><img src="/graphics/9781788479837/graphics/3f4addcd-26bc-4c32-bb9d-1c03110cb3e6.png" /></div><p>Navmesh objects are saved as an asset</p></div>