<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec37"></a>Making the camera move</h2></div></div><hr /></div><p>The first thing you hopefully noticed when we tested the scene in the previous chapter was that we were just <a id="id178" class="indexterm"></a>looking in to the distance at nothing. That <a id="id179" class="indexterm"></a>won't do for a game, traditionally the camera follows the player around the level and responds to their movements. The character in our game at the moment is represented by a blue cube, in our <code class="literal">BuildLevel</code> method <a id="id180" class="indexterm"></a>of our <code class="literal">Sokoban</code> script, we assign a name to the player when we instantiate it; to refresh your memory the code in question is as follows:</p><div class="informalexample"><pre class="programlisting">thePlayer = Instantiate(player,new Vector3 (i,0, j),Quaternion.identity) as Transform;
thePlayer.name = "Player";</pre></div><p>Giving the instantiated <code class="literal">GameObject</code> a name of <code class="literal">Player</code> means we will be able to address the <code class="literal">Player</code> game object from other scripts when we need to reference it.</p><p>Let's create a new script for making the Main Camera focus on the player and rotate according to the player's orientation. Right-click on the <code class="literal">Scripts</code> folder that you created earlier and then click on <span class="strong"><strong>Create</strong></span> and select <span class="strong"><strong>C# Script</strong></span>. Once you click on it, a script will appear in the <code class="literal">Scripts</code> folder, it should already be selected and asking you to type a name for the script, call it <code class="literal">UpdateCameraPosition</code>. Double-click on the script in Unity and it will open <a id="id181" class="indexterm"></a>
<span class="strong"><strong>MonoDevelop</strong></span>. The aim of this script will be to:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Find the player</p></li><li style="list-style-type: disc"><p>Move the Main Camera game object to a fixed distance from them</p></li><li style="list-style-type: disc"><p>Rotate to position the Main Camera game object behind the player</p></li></ul></div><p>Unity provides a method to find any <code class="literal">GameObject</code>, conveniently called <code class="literal">Find</code>, although it's a very expensive<a id="id182" class="indexterm"></a> operation to call. If no game object <a id="id183" class="indexterm"></a>with that name can be found, <code class="literal">null</code> is returned. The preferred usage is to find the game object, using <code class="literal">Find</code>, you want at the initial execution of the script and store a reference to the game object as a variable. Also, you should check that the result is not <code class="literal">null</code> before you try and use it.</p><p>Let's put what we've just learned in to practice and write our Main Camera movement script. As we are going to use <code class="literal">Find</code> and store the result for reuse later; we will need to create a variable above the <code class="literal">Start</code> method that has been added automatically for you:</p><div class="informalexample"><pre class="programlisting">Transform target;</pre></div><p>We will also add a method call to the <code class="literal">Start</code> and <code class="literal">ourUpdate</code> method, so add the following line in both methods:</p><div class="informalexample"><pre class="programlisting">PositionCamera();</pre></div><p>So, we've added the calls to the <code class="literal">PositionCamera</code> method but we still need to write it. As we have done previously, the code will be written in its entirety; later we can break it down to see what it's doing:</p><div class="informalexample"><pre class="programlisting">void PositionCamera () {
  
  // If we don't have it then try to find it
  if (target == null) {
    target = GameObject.Find("Player").transform;
  }
  
  // Is the target still no? If so, then you've named it   
  // incorrectly
  if (target == null) {
    return;
  }
  
  float angleToReach = Mathf.LerpAngle(transform.eulerAngles.y,target.eulerAngles.y,4 * Time.deltaTime);
  
  Quaternion currentRotation = Quaternion.Euler(0,angleToReach,0);
  
  transform.position += target.position + new Vector3(0, 9, 0);
  transform.position -= currentRotation * Vector3.forward * 4;
  transform.LookAt(target.position);
}</pre></div><p>As per the Unity documentation, we'll be storing a reference to our <code class="literal">GameObject</code> rather than calling <code class="literal">GameObject.Find</code> every frame. If our target variable is not set, we call <code class="literal">target = GameObject.Find("Player").transform</code>. We only store <code class="literal">transform</code> as that's all that's needed to adjust the Main Camera's position.</p><p>Next up is <code class="literal">angleToReach</code>, to set this variable we use <code class="literal">Mathf.LerpAngle</code> which will interpolate the <code class="literal">Vector3</code> rotation type of the camera's rotation to that of the target's rotation over a period of time. The third argument of <code class="literal">LerpAngle</code> is the position in <code class="literal">Lerp</code> (linear interpolation). While you can set an absolute of 0 or 1, for this argument you get a nicer effect<a id="id184" class="indexterm"></a> by using <code class="literal">Time.deltaTime</code>. This will normally be quite constant, but as the Main Camera's rotation will be <a id="id185" class="indexterm"></a>changing each frame, this will give you an easing effect as the Main Camera pans around. We want this to happen quite quickly so we are using <code class="literal">Time.deltaTime</code> for the position in <code class="literal">Lerp</code>, hence we are multiplying it by four.</p><p>We use the value in<code class="literal"> angleToReach</code> as a variable for the <code class="literal">currentRotation</code> quaternion and it's going to allow us to work out where the Main Camera game object should be positioned in relation to our target. This is done in a two-step process; first we need to move the Main Camera's position to be over the target and then we need move it along the line of the <code class="literal">angleToReach</code> float multiplied by <code class="literal">Vector3.forward</code>. This will give you a position around the target that eases in to place, but by multiplying it by four we can exaggerate the effect.</p><p>Finally, now that our Main Camera is orbiting our target and easing in to position, we have to make it actually look at the target. This is very simple in Unity, we just have to call <code class="literal">transform.LookAt(target.position)</code> and it's as easy as that. This will automatically modify <code class="literal">transform.rotation</code> of the <code class="literal">Vector3</code> rotation type to point at the <code class="literal">target.position</code>.</p><p>Close the script, go back to Unity and press the play icon at the top-middle of the Unity screen. If all has gone according to the plan, you should see the Main Camera game object much closer to the player.</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_04_01.jpg" /></div></div>