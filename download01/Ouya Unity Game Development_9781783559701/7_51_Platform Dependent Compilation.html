<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec51"></a>Platform Dependent Compilation</h2></div></div><hr /></div><p>Unity includes a feature called <span class="strong"><strong>Platform Dependent Compilation</strong></span>. It consists of some preprocessor <a id="id289" class="indexterm"></a>directives that let you partition your scripts to compile and execute sections of code for one of the supported platforms. This functionality is also supported within Editor, so you can compile the code specifically for your mobile or console and test it in Editor.</p><p>This is useful if you're branching code for things, such as In-App Purchase or control mechanisms. To use the Platform Dependent Compilation feature, you use the pound or hash symbol, as shown in the following code:</p><div class="informalexample"><pre class="programlisting">void Start () {
  
  #if UNITY_EDITOR
    Debug.Log("Unity Editor");
  #endif
  
  #if UNITY_ANDROID
    Debug.Log("Android");
  #endif
  
  #if UNITY_IPHONE
    Debug.Log("iPhone");
  #endif
  
  #if UNITY_STANDALONE_OSX
    Debug.Log("Stand Alone OSX");
  #endif
  
  #if UNITY_STANDALONE_WIN
    Debug.Log("Stand Alone Windows");
  #endif
}</pre></div><p>While this is <a id="id290" class="indexterm"></a>brilliant for coding between platforms, it doesn't actually help in our example. The Ouya and an Android phone might seem different, but they both run on the Android operating system, even though the Ouya does a good job at hiding that. It means our platform-dependent compilation is going to trigger for Android in both scenarios. Thankfully, the Ouya SDK thought of this and provided a method we can call instead. The method is <code class="literal">OuyaSDK.IsOUYA()</code> and it is called as shown in the following code:</p><div class="informalexample"><pre class="programlisting">if (OuyaSDK.IsOUYA()) {
  
  // Remove the In-App Purchase here as 
  // it's not needed for mobile
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec29"></a>Changing the TitleScreen scene</h3></div></div></div><p>Currently our title screen has <span class="strong"><strong>Press O to Play</strong></span> and <span class="strong"><strong>Press A to Purchase</strong></span> on it, neither of these will <a id="id291" class="indexterm"></a>apply to the Android version of the game, so let's <a id="id292" class="indexterm"></a>add something a little more fitting. How about <code class="literal">Tap to Start</code>? We're going to have three 3D text GameObjects on our screen and we'll need to toggle the visibility depending on if we are or are not on Ouya. The best way to do this is with a simple script. Create a new C# script and call it <code class="literal">ToggleVisibilityForOuya</code>. At the top of the script, where variables are defined, add the following code:</p><div class="informalexample"><pre class="programlisting">public bool visibleIfOuya;</pre></div><p>Change the <code class="literal">Start</code> method<a id="id293" class="indexterm"></a> to an <a id="id294" class="indexterm"></a>
<code class="literal">Awake</code> method and change it to the following code:</p><div class="informalexample"><pre class="programlisting">void Awake () {
  if (OuyaSDK.IsOUYA()) {
    this.gameObject.SetActive(visibleIfOuya);
  } else if (!OuyaSDK.IsOUYA()) {
    this.gameObject.SetActive(!visibleIfOuya);
  }
}</pre></div><p>The preceding code will make sure that when we run on the Ouya with the <code class="literal">visibleIfOuya</code> script, a Boolean set will show up and if we're not running on the Ouya then the<a id="id295" class="indexterm"></a> opposite will show up. Now perform the following<a id="id296" class="indexterm"></a> steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Save your script and go back to Unity. Rather than creating a new 3D text and setting all the parameters again, we can duplicate one of the existing ones. Make sure you're editing the <span class="strong"><strong>TitleScreen</strong></span> scene, click on the <span class="strong"><strong>Play Instructions</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> panel, and then click on <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Duplicate</strong></span>.</p></li><li><p>Now you'll have two copies of <span class="strong"><strong>Play Instructions</strong></span>, change the name of one of them to <code class="literal">Tap to Play</code>.</p></li><li><p>While it is selected, move over to the <span class="strong"><strong>Inspector</strong></span> panel and change the position of <span class="strong"><strong>Transform</strong></span> to <code class="literal">Y</code> to <code class="literal">0</code>, and the text of <span class="strong"><strong>Text Mesh</strong></span> to <code class="literal">Tap to Play</code>.</p></li><li><p>Click and drag your <code class="literal">ToggleVisibilityForOuya</code> script onto all three of the 3D text GameObjects, namely <span class="strong"><strong>Play Instructions</strong></span>, <span class="strong"><strong>Purchase Instructions</strong></span>, and <span class="strong"><strong>Tap to Play</strong></span>.</p></li><li><p>Click on <span class="strong"><strong>Play Instructions</strong></span> and, in the <span class="strong"><strong>Inspector</strong></span> panel, tick the <span class="strong"><strong>Visible If Ouya</strong></span> box.</p></li><li><p>Click on <span class="strong"><strong>Purchase Instructions</strong></span>, and in the <span class="strong"><strong>Inspector</strong></span> panel, tick the <span class="strong"><strong>Visible If Ouya</strong></span> box.</p></li><li><p>Click on <span class="strong"><strong>Tap to Play</strong></span>, and in the <span class="strong"><strong>Inspector</strong></span> panel, make sure the tick box is unticked.</p></li></ol></div><p>Run the game on your Android device and the title screen should just have <span class="strong"><strong>Tap to Play</strong></span> on. Let's add some code to make that actually happen. Double-click on your <code class="literal">ControlsTitleScreen</code> script<a id="id297" class="indexterm"></a> to edit it in MonoDevelop and change the <code class="literal">Update</code> method as follows:</p><div class="informalexample"><pre class="programlisting">void Update () {
  
  #if UNITY_ANDROID
  if (OuyaSDK.IsOUYA ()) {
    // Update the controllers here for best results
    OuyaInput.UpdateControllers();
    
    if (Input.GetKeyDown(KeyCode.Space) || OuyaInput.GetButtonDown(OuyaButton.O, player)) {
      Application.LoadLevel("GameScreen");
    } else 
    if (OuyaInput.GetButtonDown(OuyaButton.A, player)) {
      
      GameObject iap = GameObject.Find("IAP");
      OuyaShowProducts showProductsScript = iap.GetComponent&lt;OuyaShowProducts&gt;();
      showProductsScript.BuyFullGame();
    }
  } else {
    if (Input.touchCount &gt;= 1) {
      Application.LoadLevel("GameScreen");
    }
  }
  #endif
}</pre></div><p>You can <a id="id298" class="indexterm"></a>see that we now wrapped all the code in a platform-dependent compilation block, so it will only trigger on Android devices, this means we <a id="id299" class="indexterm"></a>can implement different control systems for different platforms. We then check if we are running on the Ouya or an Android phone with <code class="literal">OuyaSDK.IsOUYA</code>. If it returns <code class="literal">false</code> we just check for a tap anywhere on the screen to start the game.</p><p>Test the game on your Android device now to verify it's all working as it should for you.</p></div></div>