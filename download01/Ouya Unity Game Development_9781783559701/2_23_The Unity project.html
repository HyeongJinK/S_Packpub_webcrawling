<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec28"></a>The Unity project</h2></div></div><hr /></div><p>Instead of giving us developers a <code class="literal">unitypackage</code> file to download, the Ouya team give us a Unity project<a id="id87" class="indexterm"></a> and we need to build it ourselves. The benefit of this is that the Ouya team can update the files on GitHub and, if we have cloned the repository, we'll be able to pull an update easily and rebuild the packages. The following steps will guide you through creating the Ouya <code class="literal">unitypackage</code> file that, after importing, will enable us to configure the Ouya project settings and allow us to deploy to Ouya itself:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open Unity and navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Open Project</strong></span> | <span class="strong"><strong>Open Other</strong></span>. You'll need to navigate to where you unzipped the Ouya Unity files and press <span class="strong"><strong>Select Folder</strong></span>. Depending on how up-to-date the files are you may get a message from Unity about upgrading the project, if it asks for an upgrade, then let it proceed.</p></li><li><p>To generate the <code class="literal">unitypackage</code> file, we will need to configure the Ouya project settings which on importing will allow us to deploy to Ouya itself. Click on <span class="strong"><strong>OUYA</strong></span> | <span class="strong"><strong>Export Core Package</strong></span> and after a short delay a window will open and you should see a file named <code class="literal">OuyaSDK-Core</code>.</p></li><li><p>We're now going to create a new Unity project. We'll need to set it to be for the Android platform, set up the Android requirements, and then set up the Ouya-specific requirements. Create a new project in Unity, call it <code class="literal">Sokoban</code>, and navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build Settings</strong></span>, then click on <span class="strong"><strong>Android </strong></span>and click on <span class="strong"><strong>Switch Platform</strong></span>. Now click on the <span class="strong"><strong>Player Settings</strong></span> button from the same window. A tab should appear, click on <span class="strong"><strong>Other Settings</strong></span> and then click on the drop-down box next to <span class="strong"><strong>Minimum API Level</strong></span>, you will need to select <span class="strong"><strong>Android 4.1 'Jelly Bean' (API Level 16)</strong></span>. Next, click on <span class="strong"><strong>Resolution and Presentation</strong></span> and set the <span class="strong"><strong>Default Orientation</strong></span> to <span class="strong"><strong>Landscape Left</strong></span>.</p></li><li><p>Finally, navigate to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Custom Package…</strong></span> and select <a id="id88" class="indexterm"></a>the <code class="literal">OuyaSDK-Core</code> file that was created a moment ago. Import all the files and then, once they have processed, you will see a new menu item at the top of the screen: <span class="strong"><strong>OUYA</strong></span>.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec06"></a>The bundle identifier</h3></div></div></div><p>Each game for <a id="id89" class="indexterm"></a>Ouya must have a unique bundle identifier. A bundle identifier<a id="id90" class="indexterm"></a> is used to identify your app in the app store, link purchases from the app to your account, and let other processes know what is running.</p><p>Because Unity interfaces with Ouya as an Android app with a Java plugin it means there are three bundle identifiers: one for the Unity project, one for the <code class="literal">Android Manifest</code> file, and one for the Java plugin, if there are any mismatches your app won't deploy on to Ouya. The first step is coming up with your bundle identifier, they are normally created in reverse-domain notation, for example: <code class="literal">com.companyName.productName</code>. For the purposes of this book we'll use <code class="literal">com.generic.sokoban</code>.</p><p>Thankfully, Ouya now provides a way to sync the bundle identifier from Unity in to the two other places.</p><p>In the Player Settings menu, click on the Android icon and then click on <span class="strong"><strong>Other Settings</strong></span> and then type the bundle identifier in the textbox marked <span class="strong"><strong>Bundle Identifier*</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_02_09.jpg" /></div><p>Navigate to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Open Ouya Panel</strong></span>. A panel will appear and you will most likely see a <span class="strong"><strong>[error] (bundle mismatched)</strong></span> warning. Click on <span class="strong"><strong>Sync Bundle ID</strong></span> and after a few moment <a id="id91" class="indexterm"></a>that<a id="id92" class="indexterm"></a> warning should go away.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec07"></a>Setting up Ouya Panel</h3></div></div></div><p>The <a id="id93" class="indexterm"></a>following is the screenshot of <span class="strong"><strong>Ouya Panel</strong></span>, you <a id="id94" class="indexterm"></a>use it to configure all the paths that the Ouya Unity plugin requires.</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_02_02.jpg" /></div><p>Click on the third tab, <span class="strong"><strong>Java JDK</strong></span>, and then click on <span class="strong"><strong>Download JDK 6 32-bit</strong></span>. A browser will open and you will need to accept the license agreement and then click on <span class="strong"><strong>Windows x86</strong></span>. Oracle <a id="id95" class="indexterm"></a>will ask you to sign in, do so if you already <a id="id96" class="indexterm"></a>have an account, if not then create one and download the Java JDK. Run the installer and leave all the options as default, once it's finished head back over to Unity. Click on <span class="strong"><strong>Select SDK Path…</strong></span> and then navigate to the default install location of the <span class="strong"><strong>Java JDK</strong></span>, for me the location is <code class="literal">c:/Program Files (x86)/Java/jdk1.6.0_45</code>.</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_02_03.jpg" /></div><p>Now click on the fourth tab, <span class="strong"><strong>Android SDK</strong></span>, and then click on <span class="strong"><strong>Select SDK Path…</strong></span> and navigate to your root Android SDK folder.</p><p>For me the location is <code class="literal">c:/adt-bundle-windows-x86-20130729/sdk</code>. The labels at the top of the panel should go from gray to white. If the <span class="strong"><strong>APT Path</strong></span> is still gray then make sure you <a id="id97" class="indexterm"></a>copied the <code class="literal">aapt.exe</code> from (your root Android<a id="id98" class="indexterm"></a> SDK install folder)<code class="literal">/build-tools/17.0.0</code> to (your root Android SDK install folder)<code class="literal">/platform-tools</code>.</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_02_04.jpg" /></div><p>Finally, we have to set up the <span class="strong"><strong>Android NDK</strong></span> paths. Click on the fifth tab, <span class="strong"><strong>Android NDK</strong></span>, and then click on <span class="strong"><strong>Select NDK Path…</strong></span> and navigate to your root Android NDK folder. Now click on <span class="strong"><strong>Select NDK Make Path…</strong></span> and navigate to your (root Android NDK folder)<code class="literal">/prebuilt/windows/bin/make.exe</code>.</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_02_05.jpg" /></div><p>Now the Java JDK, Android SDK, and Android NKD have been set up, we need to compile everything. The <span class="strong"><strong>Ouya Panel</strong></span> makes this really easy. Click on the first tab, <span class="strong"><strong>OUYA</strong></span>, and you will see three buttons:</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_02_06.jpg" /></div><p>Press each<a id="id99" class="indexterm"></a> one in turn, you should see results in the <a id="id100" class="indexterm"></a>console, hopefully with no errors. If you do have errors, read them carefully as they usually explain what the issue is. It's normally to do with one of the tabs being set up incorrectly so check each tab in turn, ensuring all the fields that have path names are in white, not gray.</p><p>That's <span class="strong"><strong>Ouya Panel</strong></span>, set up and configured properly. While it does seem like a long process to set it up, it saves your configuration so you only need to do it the once.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec08"></a>Ouya required prefabs</h3></div></div></div><p>Open the <span class="strong"><strong>Projec</strong></span>t panel <a id="id101" class="indexterm"></a>in Unity and navigate to <span class="strong"><strong>Ouya</strong></span> | <span class="strong"><strong>SDK</strong></span> | <span class="strong"><strong>Editor</strong></span> | <span class="strong"><strong>Prefabs</strong></span> | <span class="strong"><strong>OuyaGameObject</strong></span>. Drag an instance of this prefab in to<a id="id102" class="indexterm"></a> the scene and select it. In the <span class="strong"><strong>Inspector</strong></span> panel you will see a <span class="strong"><strong>DEVELOPER_ID</strong></span> field, you will need to paste your Developer ID in there. If you don't know what yours is then log in at <a class="ulink" href="https://devs.ouya.tv/developers" target="_blank">https://devs.ouya.tv/developers</a>. You'll see <span class="emphasis"><em>Developer UUID (used for configuring in-app purchases)</em></span>. Copy the Developer ID from there and paste it in to the <span class="strong"><strong>DEVELOPER_ID</strong></span> field in Unity.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec09"></a>Building, running, and compiling an application</h3></div></div></div><p>We're now <a id="id103" class="indexterm"></a>ready to see all your hard work so far pay off.</p><p>If you have the <a id="id104" class="indexterm"></a>basic version of Unity then click on <span class="strong"><strong>Compile</strong></span> on <a id="id105" class="indexterm"></a>the <span class="strong"><strong>Ouya Panel</strong></span> and you'll see few command prompts open and close, when it's finished navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build &amp; Run</strong></span>.</p><p>If you have the pro version of Unity then you can use the <span class="strong"><strong>Build, Run and Compile Application</strong></span> button. Click on it and you'll see a few command prompts open and then close, followed by the Unity build progress bar.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>For the purposes of this book, if you see <span class="strong"><strong>Build, Run and Compile Application</strong></span> use the correct method for your version of Unity.</p></div><p>If all has <a id="id106" class="indexterm"></a>gone according to plan, in a few moments you'll see a Unity splash<a id="id107" class="indexterm"></a> screen followed by the blue hue of your <a id="id108" class="indexterm"></a>default scene and main camera.</p><p>Common fail points here are Unity not finding the Ouya or the app opening and then closing immediately. If Unity cannot find the Ouya make sure you have followed all the steps from the <span class="emphasis"><em>Connecting Ouya to your Windows/Mac computer</em></span> section of this chapter. If the app is opening and then immediately closing again, make sure you have added the required prefabs and entered your Developer ID in to the <span class="strong"><strong>OuyaGameObject</strong></span> prefab. If it is still opening and then immediately closing, make sure you have also compiled the Java JDK, the Android SDK, and the Android NDK, as described in the <span class="emphasis"><em>Setting up Ouya Panel</em></span> section of this chapter.</p><p>You can breathe a sigh of relief now, that's the boring bit over with.</p></div></div>