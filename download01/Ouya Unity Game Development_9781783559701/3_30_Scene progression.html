<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec34"></a>Scene progression</h2></div></div><hr /></div><p>We have to add <a id="id133" class="indexterm"></a>the scenes that we're going to use to the build settings before we <a id="id134" class="indexterm"></a>can test our code works, so click on <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build Settings</strong></span>, and then click on <span class="strong"><strong>Add Current</strong></span>. You'll see the scene name appear in the <span class="strong"><strong>Scenes In Build</strong></span> area, now drag the <span class="strong"><strong>TitleScreen</strong></span> and the <span class="strong"><strong>GameScreen</strong></span> scenes into the same window and their names will appear there too. Close the build settings window and click on the play icon in the top-middle of the Unity screen. If all has worked as expected you should be staring back at a plain blue screen. That's actually a good result as it means your <span class="strong"><strong>SetUp</strong></span> scene is working as expected and has loaded the <span class="strong"><strong>TitleScreen</strong></span> scene immediately, and the blue screen you see is from the background color of <span class="strong"><strong>Main Camera</strong></span> in that scene.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>Make sure you click on the play icon again to stop the play mode, this is important as any changes you make in play mode are not permanent and will reset to the default values when play mode is disabled.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec13"></a>The title screen menu</h3></div></div></div><p>Double-click on the <span class="strong"><strong>TitleScreen</strong></span> scene in the <code class="literal">Scenes</code> folder to load that scene. We're going to need <a id="id135" class="indexterm"></a>some kind of instructions on the <span class="strong"><strong>TitleScreen</strong></span> scene, let's keep it simple for now. Click on <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>3D Text</strong></span>. A new <span class="strong"><strong>Text Mesh</strong></span> component will appear in the <span class="strong"><strong>Hierarchy</strong></span> panel with the name <span class="strong"><strong>New Text</strong></span> and <span class="strong"><strong>Inspector</strong></span> panel will show <span class="strong"><strong>Text Mesh</strong></span>. <span class="strong"><strong>New Text</strong></span> should already be highlighted, so click it once more to rename it and call it <code class="literal">Play Instructions</code>, then click on <span class="strong"><strong>Return</strong></span>. Now drag it in to the <span class="strong"><strong>Main Camera</strong></span> to make it a child object of the <span class="strong"><strong>Main Camera</strong></span>. Click on the <span class="strong"><strong>Main Camera</strong></span> and in the <span class="strong"><strong>Inspector</strong></span> panel, and you should see <span class="strong"><strong>Background</strong></span> with a blue hue next to it, click on the blue color and a palette will appear in a new window. Move the blue hue to the black hue, and then close the window.</p><p>Select the text in the <span class="strong"><strong>Inspector</strong></span> panel and replace the text that's there, <span class="strong"><strong>Hello World</strong></span> with the text <code class="literal">Press O to Play</code>. Change the anchor from upper-left to middle-center and change the font size to <code class="literal">50</code>. The text has been set and added to the correct GameObject but we need to position it correctly, in the <span class="strong"><strong>Inspector</strong></span> panel set the position to <code class="literal">X: 0, Y: 0, Z: 50</code>, and then click on the play icon to test the scene. You should see something like the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559701/graphics/9701OS_03_03.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec14"></a>Advancing to the game</h3></div></div></div><p>We'll add <a id="id136" class="indexterm"></a>keyboard support first, and then once we know all our scripts are working, we'll add Ouya controller support.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip07"></a>Tip</h3><p>It's important to implement one feature at a time because if something goes wrong, it can make debugging much harder if there are multiple failure points.</p></div><p>Right-click on the <code class="literal">Scripts</code> folder in your <span class="strong"><strong>Project</strong></span> panel and navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>C# Script</strong></span>. Call the new script as <code class="literal">ControlsTitleScreen</code>, and then double-click on the script to edit it in MonoDevelop. You'll see that the <code class="literal">Start</code> and <code class="literal">Update</code> methods have already <a id="id137" class="indexterm"></a>been created. In the <code class="literal">Update</code> method, we're going to check if the <span class="emphasis"><em>Space</em></span> key has <a id="id138" class="indexterm"></a>been pressed to start the game. We'll break it down after, but the code we need to add now is as follows:</p><div class="informalexample"><pre class="programlisting">void Update () {
  if(Input.GetKeyDown(KeyCode.Space)){
    Application.LoadLevel("GameScreen");
  }
}</pre></div><p>The preceding code is going to check every frame, if the key with the <code class="literal">KeyCode</code> of <code class="literal">Space</code> has been pressed that frame. We are just using <code class="literal">Space</code> when testing in the editor; we'll be adding Ouya controller support in the next section. You can also use <code class="literal">GetKey()</code> to detect the key being held over multiple frames. We used <code class="literal">LoadLevel</code> earlier so that we should understand what that does but just to refresh your memory, it will simply destroy everything in the current scene, excluding GameObjects that have <code class="literal">DontDestroyOnLoad</code> set, and load the scene specified as a string. The string is the filename of the scene, in this case <span class="strong"><strong>GameScreen</strong></span>, which we created earlier. Save your script and go back to Unity, we're done for now.</p><p>Click on <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span>, and a new GameObject will appear in the <span class="strong"><strong>Hierarchy</strong></span> panel with the name <span class="strong"><strong>GameObject</strong></span>. It should already be highlighted, so click on it once more and the name will become editable, call it <code class="literal">Controls</code>. Drag the <code class="literal">ControlsTitleScreen</code> script from the <span class="strong"><strong>Project</strong></span> panel to the <code class="literal">Controls</code> GameObject.</p><p>Click on the play icon to test your scene. It should start off with a black screen with the text <span class="strong"><strong>Press O to Play</strong></span> on it, and then go to the blue screen when the <span class="emphasis"><em>Space</em></span> key is pressed.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec15"></a>Ouya controller support</h3></div></div></div><p>Assuming that everything now works as it should, let's get the title screen detecting Ouya input and <a id="id139" class="indexterm"></a>then giving it a run on the Ouya itself to check <a id="id140" class="indexterm"></a>everything is working as expected. The Ouya code examples are updated frequently, so are often hosted on GitHub for version control and ease of access. The code for accessing input is no different and can be found at <a class="ulink" href="https://github.com/rendermat/OuyaInputFramework" target="_blank">https://github.com/rendermat/OuyaInputFramework</a>. As before, if you are familiar with GitHub then you will be better in off cloning the repository, else click on the <span class="strong"><strong>Download ZIP</strong></span> button located on the right-hand side of the page. For the time being we're only interested in one file from the ZIP, namely <code class="literal">OuyaInput.unitypackage</code>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Double-click on <span class="strong"><strong>OuyaInput.unitypackage</strong></span> and it will open in Unity and ask you what you want to import.</p></li><li><p>Uncheck <span class="strong"><strong>Documentation</strong></span>, <span class="strong"><strong>Prefabs</strong></span>, and <span class="strong"><strong>Scenes</strong></span>, and then click on <span class="strong"><strong>Import</strong></span>. If you want to learn more you can import everything and load up the scene named <code class="literal">ControllerSimpleTest</code>. There you can see all input being handled from the Ouya controller.</p></li><li><p>After <a id="id141" class="indexterm"></a>the import has finished, you will see <a id="id142" class="indexterm"></a>a C# script named <span class="strong"><strong>OuyaInput</strong></span> in the <code class="literal">Plugins</code> folder. The code inside this script is defined as a static class, which means we do not have to attach it to a GameObject for it to work.</p></li><li><p>Double-click on your <span class="strong"><strong>ControlsTitleScreen</strong></span> script in the <span class="strong"><strong>Project</strong></span> panel to edit it in MonoDevelop and add the following code just above the <code class="literal">Start</code> method:</p><div class="informalexample"><pre class="programlisting">public bool continuousScan = true;
public OuyaPlayer player = OuyaPlayer.P01;</pre></div><p>The first variable, <code class="literal">continuousScan</code>, is going to be used a little further down, so we'll deal with that when we come to it.</p><p>The second variable, <code class="literal">player</code>, is being set to an integer value with a predefined name, this is called <code class="literal">enum</code>. This will be passed to the <code class="literal">GetButtonDown</code> method, so it knows what controller to read the values from.</p></li><li><p>Add the following <a id="id143" class="indexterm"></a>lines inside the <code class="literal">Start</code> method:</p><div class="informalexample"><pre class="programlisting">OuyaInput.SetContinuousScanning(continuousScan);
OuyaInput.UpdateControllers();</pre></div><p>Passing <code class="literal">true</code> to <code class="literal">SetContinuousScanning</code> will allow us to receive button up and down events from the controller. <code class="literal">UpdateControllers</code> will grab the initial state from the controllers.</p></li><li><p>At the top of <a id="id144" class="indexterm"></a>the <code class="literal">Update</code> method, add the following code:</p><div class="informalexample"><pre class="programlisting">OuyaInput.UpdateControllers();</pre></div></li><li><p>Update the <code class="literal">if</code> statement we used to check for the <span class="emphasis"><em>Space</em></span> key being pressed. Change that line to the following:</p><div class="informalexample"><pre class="programlisting">if (Input.GetKeyDown(KeyCode.Space) || OuyaInput.GetButtonDown(OuyaButton.O, player)){</pre></div><p>You can see we have added the OR operator, <code class="literal">||</code>, if you read the code now, it should all seem quite clear: if the <span class="emphasis"><em>Space</em></span> key or the <span class="emphasis"><em>O</em></span> key is down for player 1, then use the following code.</p><p>The final script should look like the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ControlsTitleScreen : MonoBehaviour {
  
  // Do we want to scan for trigger and d-pad button events?
  publicboolcontinuousScan = true;
  
  // The player we want to get input for
  publicOuyaPlayer player = OuyaPlayer.P01;
  
  // Use this for initialization
  void Start () {
    
    // Set button state scanning to receive input state events for trigger and d-pads
    OuyaInput.SetContinuousScanning(continuousScan);
    
    // Do a controller update here to get everything started as soon as possible
    OuyaInput.UpdateControllers();
  }
  
  // Update is called once per frame
  void Update () {
    
    // Update the controllers here for best results
    OuyaInput.UpdateControllers();
    
    if (Input.GetKeyDown(KeyCode.Space) || OuyaInput.GetButtonDown(OuyaButton.O, player)){
      Application.LoadLevel("GameScreen");
    }
  }
}</pre></div></li></ol></div><p>That's it <a id="id145" class="indexterm"></a>for the Ouya controller support for the <code class="literal">TitleScreen</code> at the <a id="id146" class="indexterm"></a>moment. Make sure your Ouya is turned on and connected to your computer, and click on <span class="strong"><strong>Build</strong></span>, <span class="strong"><strong>Run</strong></span>, and <span class="strong"><strong>Compile Application</strong></span> on the Ouya Panel. Your game should start and present a black screen <a id="id147" class="indexterm"></a>with <span class="strong"><strong>Press O to Play</strong></span> on it, press <span class="emphasis"><em>O</em></span> on your <a id="id148" class="indexterm"></a>controller and the screen should change from black to blue. Let's stop that screen being so bare.</p></div></div>