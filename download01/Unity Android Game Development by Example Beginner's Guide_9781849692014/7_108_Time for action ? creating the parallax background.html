<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec108"></a>Time for action – creating the parallax background</h2></div></div><hr /></div><p>There is an alternative method of creating and utilizing a second camera, but ours will make use of a single script that<a id="id516" class="indexterm"></a> additionally allows us to control the speed of each layer:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We will start this section with the creation of the <code class="literal">ParallaxScroll</code> script.</p></li><li><p>This script starts with three variables. The first two keep track of each material and how fast they should scroll. The third keeps track of the camera's last position, so we can track how far it moves in each frame.</p><div class="informalexample"><pre class="programlisting">public Material[] materials = new Material[0];
public float[] speeds = new float[0];

private Vector3 lastPosition = Vector3.zero;</pre></div></li><li><p>In the <code class="literal">Start</code> function, we record the camera's beginning position. We use <code class="literal">Start</code> instead of <code class="literal">Awake</code> here, in case the camera needs to do any special movement at the beginning of the game.</p><div class="informalexample"><pre class="programlisting">public void Start() {
  lastPosition = Camera.main.transform.position;
}</pre></div></li><li><p>Next, we use the <code class="literal">LateUpdate</code> function to make changes after the camera has moved about. It starts by finding the camera's new position and comparing the z axis values to determine how far it moved. Next, it loops through the list of materials. The loop first gathers the current offset of its texture using <code class="literal">mainTextureOffset</code>. Next, the camera's movement multiplied by the material's speed is subtracted from the offset's x axis to find a new horizontal position. Then, the new offset is applied to the material. Finally, the function records the camera's last position for the next frame.</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  Vector3 newPosition = Camera.main.transform.position;
  float move = newPosition.z – lastPosition.z;

  for(int i=0;i&lt;materials.Length;i++) {
    Vector2 offset = materials[i].mainTextureOffset;
    offset.x -= move * speeds[i];
    materials[i].mainTextureOffset = offset;
  }

  lastPosition = newPosition;
}</pre></div></li><li><p>Return to Unity and create six new materials. One for each of the background textures: <code class="literal">sky</code>, <code class="literal">hills_tall</code>, <code class="literal">hills_short</code>, <code class="literal">grass_light</code>, <code class="literal">grass_dark</code>, and <code class="literal">fronds</code>. All of the materials, except for the sky, need to use the <span class="strong"><strong>Diffuse</strong></span> shader under <span class="strong"><strong>Transparent</strong></span> in the <span class="strong"><strong>Shader</strong></span> drop-down list. If they do not, we will not be able to see all of the textures when they are layered.</p></li><li><p>We also need to adjust the <span class="strong"><strong>Tiling</strong></span> of each of these new materials. For all of them, leave the <span class="strong"><strong>Y</strong></span> axis<a id="id517" class="indexterm"></a> as <code class="literal">1</code>. For the <span class="strong"><strong>X</strong></span> axis, set <code class="literal">5</code> for the <code class="literal">sky</code>, <code class="literal">6</code> for <code class="literal">hills_tall</code>, <code class="literal">7</code> for <code class="literal">hills_short</code>, <code class="literal">8</code> for <code class="literal">grass_dark</code>, <code class="literal">9</code> for <code class="literal">fronds</code>, and <code class="literal">10</code> for <code class="literal">grass_light</code>. This will offset all of the features of the textures so a long pan does not see features regularly lining up.</p></li><li><p>Next, create a new plane. Name it <code class="literal">Background</code> and remove its <span class="strong"><strong>Mesh Collider</strong></span> component.</p></li><li><p>Position it at <code class="literal">-5</code> on the <span class="strong"><strong>X</strong></span> axis, <code class="literal">7</code> on the <span class="strong"><strong>Y</strong></span> axis, and <code class="literal">30</code> on the <span class="strong"><strong>Z</strong></span> axis. Set its rotation to <code class="literal">90</code> for both the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> axes and <code class="literal">0</code> for <span class="strong"><strong>Z</strong></span>. Also, set the scale to <code class="literal">10</code> for the <span class="strong"><strong>X</strong></span> axis, <code class="literal">1</code> for the <span class="strong"><strong>Y</strong></span> axis, and <code class="literal">1.5</code> for the <span class="strong"><strong>Z</strong></span> axis. Altogether, these position the plane as facing the camera and filling the background.</p></li><li><p>In the plane's <span class="strong"><strong>Mesh Renderer</strong></span> component, expand the <span class="strong"><strong>Materials</strong></span> list and set the <span class="strong"><strong>Size</strong></span> to <code class="literal">6</code>. Add each of our new materials to the list slots in the order of <code class="literal">sky</code>, <code class="literal">hills_tall</code>, <code class="literal">hills_short</code>, <code class="literal">grass_dark</code>, <code class="literal">fronds</code>, <code class="literal">grass_light</code>. Do the same for the <span class="strong"><strong>Materials</strong></span> list in the <span class="strong"><strong>Parallax Scroll</strong></span> script component.</p></li><li><p>Finally, in the <span class="strong"><strong>Parallax Scroll</strong></span> script component, set the <span class="strong"><strong>Size</strong></span> of the <span class="strong"><strong>Speeds</strong></span> list to <code class="literal">6</code> and input the following values in the order of <code class="literal">0.03</code>, <code class="literal">0.024</code>, <code class="literal">0.018</code>, <code class="literal">0.012</code>, <code class="literal">0.006</code>, <code class="literal">0</code>. These values will move the materials gently and evenly.</p></li><li><p>Turning the background into a prefab, at this point, will make it easy to reuse later.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_07_05.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec110"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created a parallax <a id="id518" class="indexterm"></a>scroll effect. This effect will pan a series of background textures, giving the illusion of depth in our 2D game. To easily see it in action, hit play and grab the camera in the <span class="strong"><strong>Scene</strong></span> view, moving it along the z axis to see the background change.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec111"></a>Have a go hero – dark of the night</h3></div></div></div><p>We have two other levels to add backgrounds to. Your challenge here is to create your own background. Use the techniques you learned in this section to create a night-style background. It could include a stationary moon while everything else scrolls in the shot. For an added trick, create a cloud layer that slowly pans across the screen as well as with the camera and the rest of the background.</p></div></div>