<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec93"></a>Time for action – touch to shoot</h2></div></div><hr /></div><p>For making use of the touch inputs, we will need to add a single script to our player's ship:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To give the player the ability to shoot, we need to first create a new script and call it <code class="literal">TouchShoot</code>.</p></li><li><p>This script begins with a <a id="id443" class="indexterm"></a>single variable. A <code class="literal">LayerMask</code> is used to selectively hit objects with a raycast. There are essentially a lot of layers that should be hit. This one will be used to determine what the player can or cannot shoot.</p><div class="informalexample"><pre class="programlisting">public LayerMask touchMask = -1;</pre></div></li><li><p>The <code class="literal">Update</code> function<a id="id444" class="indexterm"></a> is the only function in this script. It starts with a loop. The <code class="literal">Input</code> class provides us with the <code class="literal">touchCount</code> value, which is simply a counter for how many fingers are currently touching the device screen.</p><div class="informalexample"><pre class="programlisting">public void Update() {
  for(int i=0;i&lt;Input.touchCount;i++) {</pre></div></li><li><p>As we progress through the loop, we use the <code class="literal">Input.GetTouch</code> function to access information about each touch. This line of code checks the phase of the touch. Every touch has five potential phases: <span class="strong"><strong>Began</strong></span>, <span class="strong"><strong>Moved</strong></span>, <span class="strong"><strong>Stationary</strong></span>, <span class="strong"><strong>Ended</strong></span>, and <span class="strong"><strong>Cancelled</strong></span>:</p><div class="informalexample"><pre class="programlisting">if(Input.GetTouch(i).phase == TouchPhase.Began) {</pre></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Began</strong></span>: This phase of touch is when the user first touches the screen.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Moved</strong></span>: This phase of touch is when the user moves his/her finger across the screen.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Stationary</strong></span>: This phase<a id="id445" class="indexterm"></a> of touch is the opposite of the previous phase; it is when the finger is not moving across the screen.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Ended</strong></span>: This phase of touch is when the finger is lifted off the screen. This is the normal way for a touch to complete.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Cancelled</strong></span>: This phase of touch is when an error occurs while tracking the touch. This phase tends to occur most often when a finger is touching the screen, but not moving for too long. The touch system is not perfect, so it assumes it missed the finger being lifted off the screen and just cancels it.</p></li></ul></div></li><li><p>Next, we create a pair of variables. The first is a <code class="literal">Ray</code>, which is just a container for storing a point in space and a directional vector. The <code class="literal">ScreenPointToRay</code> function<a id="id446" class="indexterm"></a> is specially provided by the camera for converting touch positions from the 2D space of the screen to the 3D space of the game world. As with our tanks, the second is a holder for what was hit by our raycast.</p><div class="informalexample"><pre class="programlisting">Ray ray = Camera.main.ScreenPointToRay(Input.GetTouch(i).position);
RaycastHit hit;</pre></div></li><li><p>The last step for the function is to call the <code class="literal">Raycast</code> function. We pass the ray, and the tracking variable to the function. Next, we have to give it a distance, and finally the <code class="literal">LayerMask</code>. If an object is hit, it is destroyed. Also, there are several curly braces required to close off the if statements, loop, and function.</p><div class="informalexample"><pre class="programlisting">      if(Physics.Raycast(ray, out hit, Mathf.Infinity, touchMask)) {
        Destroy(hit.transform.gameObject);
      }
    }
  }
}</pre></div></li><li><p>To try the script out, simply add it to the <span class="strong"><strong>PlayerShipPivot</strong></span> GameObject. Be careful. At this point, if you were to touch the player's ship while testing, it would be destroyed.</p></li><li><p>In order to fix this issue,<a id="id447" class="indexterm"></a> we need to create a new layer. Start by going to the menu bar of Unity and clicking on <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Tags</strong></span>. This is just a second path to the same location where we created layers for the Tank Battle game.</p></li><li><p>Click on the right of <span class="strong"><strong>User Layer 8</strong></span> and input <code class="literal">Player</code> in the field. This will create the new layer.</p></li><li><p>Select the <span class="strong"><strong>PlayerShipPivot</strong></span> object in the <span class="strong"><strong>Hierarchy</strong></span> window.</p></li><li><p>In the top-right corner of the <span class="strong"><strong>Inspector</strong></span> window, select the layer we just created from the <span class="strong"><strong>Layers</strong></span> drop-down list.</p></li><li><p>When Unity asks whether you want to change the children objects as well, confirm that you do.</p></li><li><p>For the <code class="literal">TouchShoot</code> script, deselect the new layer from the <span class="strong"><strong>Touch Mask</strong></span> list. This will allow the player to shoot everything but themselves.</p></li><li><p>There is one last thing we need to do. Go to the menu bar of Unity and click on <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Physics</strong></span>. This opens a new set of controls in the <span class="strong"><strong>Inspector</strong></span> window that adjust how the Physics engine runs.</p></li><li><p>At the moment, we only care about the <span class="strong"><strong>Raycasts Hit Triggers</strong></span> checkbox<a id="id448" class="indexterm"></a>. Uncheck it. If we don't, the players will hit the trigger volume that is around the asteroid when they shoot, rather than the asteroid itself. It is not so great an issue for the asteroids. But, if we were to create something, such as an explosive mine, the trigger volume would be much larger. That would make it very odd-looking for shooting at the mine.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec89"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We gave the player the ability to shoot when they touch the screen. By looping through the list of touches, the player is able to use more than one finger for shooting at targets. The special <a id="id449" class="indexterm"></a>
<code class="literal">ScreenPointToRay</code> function provided by the camera allows us to change 2D screen touches into 3D game world interactions. By making use of the <code class="literal">LayerMask</code>, we also prevent the player from shooting and destroying themselves.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec90"></a>Have a go hero – healthy ships</h3></div></div></div><p>The challenge here is to give the enemy ships some health. When we created the enemy tanks in the previous chapter, we caused them to take a few shots from the player before they would be destroyed. Do the same thing here for the enemy ships.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec91"></a>Spawning in space</h3></div></div></div><p>So far, we have created a space game that allows the player to fly infinitely through space. The player never actually moves; instead, the objects in the scene move around it to fake the movement. We have asteroids that will fly in a random direction through space. We also created enemy spaceships that fly after the player and shoot at them. Finally, we have the ability to shoot at and destroy the objects in the scene. However, at this point we can quickly run out of things to shoot at. Either they get too far away, or we destroy them. To fix this, we will now create a system that will randomly spawn all that we have created around the player.</p></div></div>