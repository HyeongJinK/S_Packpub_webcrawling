<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec59"></a>Time for action â€“ creating the pointer</h2></div></div><hr /></div><p>We are going to start by creating an <a id="id297" class="indexterm"></a>object that will point at targets. We will be making a prefab that can be used repeatedly. However, you will need a model for the player to see. We will use a pie-slice type mesh. The size isn't particularly important; we will be adjusting the scale later. Let's perform the following steps to create the pointer:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Once you have created and imported your mesh, add it to the scene.</p></li><li><p>Create an empty <code class="literal">GameObject</code> and rename it to <code class="literal">IndicatorSlice</code>.</p></li><li><p>Make your mesh a child of <code class="literal">IndicatorSlice</code> and position it so that it points along the GameObject's z axis. <code class="literal">IndicatorSlice</code> will be centered in our indicator. Each slice that is created will have its z axis pointing in the direction of a target.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_04_02.jpg" /></div></li><li><p>Now, we need to create a new script that will control our indicator. Create a new script called <span class="strong"><strong>TargetIndicator</strong></span> in the <span class="strong"><strong>Project</strong></span> window.</p></li><li><p>We start this script off with a pair of variables. The first will hold a reference to the target that this<a id="id298" class="indexterm"></a> indicator piece will point at. The indicator is also going to grow and shrink based on how far away the target is. The second variable will control the distance at which the indicator will start to grow.</p><div class="informalexample"><pre class="programlisting">public Transform target;
public float range = 25;</pre></div></li><li><p>The next function will be used to set the <code class="literal">target</code> variable when the indicator piece is created.</p><div class="informalexample"><pre class="programlisting">public void SetTarget(Transform newTarget) {
  target = newTarget;
}</pre></div></li><li><p>The last set of code goes in the <code class="literal">LateUpdate</code> function<a id="id299" class="indexterm"></a>. The <code class="literal">LateUpdate</code> function is used so the indicator pieces can point at a target after our tank moves in the <code class="literal">Update</code> function. We start the function with a check to make sure the target variable has a value. If it is null, the indicator slice is destroyed. The <code class="literal">Destroy</code> function can be used to remove any object that exists from the game. The <code class="literal">gameObject</code> variable is automatically provided by the <code class="literal">MonoBehaviour</code> class<a id="id300" class="indexterm"></a> and holds a reference to the <code class="literal">GameObject</code> that the script component is attached to. Destroying it will also destroy everything that is a child of (or attached to) it.</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  if(target == null) {
    Destroy(gameObject);
    return;
  }</pre></div></li><li><p>The next bit of code sets the scale of the indicator slice. As you can see in the following code snippet, the first line of code uses <code class="literal">Vector3.Distance</code> to determine how far the two positions are from each other. The next code line determines the vertical scale, y axis, of the slice. It does so by using a bit of carefully applied math and the <code class="literal">Mathf.Clamp01</code> function<a id="id301" class="indexterm"></a>. This function limits the supplied value to be between zero and one. The last line of code sets the indicator slice's local scale. By adjusting the local scale, we can easily control how big the whole indicator is by just changing the scale of the parent object.</p><div class="informalexample"><pre class="programlisting">float distance = Vector3.Distance(transform.position, target.position);
float yScale = Mathf.Clamp01((range - distance) / range);
transform.localScale = new Vector3(1, yScale, 1);</pre></div></li><li><p>One last set of code for this script. The <code class="literal">transform.LookAt</code> function<a id="id302" class="indexterm"></a> is just a fancy, automatic way of rotating a <code class="literal">GameObject</code> so its z axis points to a specific spot in the world. However, we want all of the indicator slices to lay flat on the ground and not pointing into the air at any targets that might be above us. So, we collect the target's position. By setting the variable's Y value to the position of the slice, we ensure that the slice remains flat. That last line, of course, closes off the <code class="literal">LateUpdate</code> function.</p><div class="informalexample"><pre class="programlisting">Vector3 lookAt = target.position;
lookAt.y = transform.position.y;
transform.LookAt(lookAt);
}</pre></div></li><li><p>That is the last code for this script. Return to Unity and add the <code class="literal">TargetIndicator</code> script to the <code class="literal">IndicatorSlice</code> object in the scene.</p></li><li><p>To finish off the indicator, create a prefab of it.</p></li><li><p>Lastly, delete the <code class="literal">IndicatorSlice</code> object from the scene. We will be creating slices dynamically when the game starts. That requires the prefab, but not the one in the scene.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec50"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created a prefab of the object we will be using to indicate the direction of targets. The script that was created and attached will rotate each instance of the prefab to point at the target. It will also adjust the scale to indicate how far the target is from the player.</p></div></div>