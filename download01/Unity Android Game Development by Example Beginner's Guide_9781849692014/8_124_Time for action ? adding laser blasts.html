<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec123"></a>Time for action – adding laser blasts</h2></div></div><hr /></div><p>A muzzle flash generally consists of two parts. The first is a straight blast, forward along the barrel. The second is<a id="id645" class="indexterm"></a> a fan around the base of the first.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To begin, create a new <code class="literal">particleSystem</code> object and rename it as <code class="literal">LineBlast</code>; we will now proceed to make the first part.</p></li><li><p>The flash does not last for very long, so find the <span class="strong"><strong>Duration</strong></span> option in the <span class="strong"><strong>Initial</strong></span> module and set it to <span class="strong"><strong>0.1</strong></span>.</p></li><li><p>Next, we need to set the <span class="strong"><strong>Start Lifetime</strong></span> option to <span class="strong"><strong>0.1</strong></span> so the particles do not stay on screen for very long.</p></li><li><p>The flash does not move away from the muzzle, so set the <span class="strong"><strong>Start Speed</strong></span> option to <span class="strong"><strong>1</strong></span>, keeping the particles close.</p></li><li><p>The particles need to be sized to correspond with the size of our ship's muzzle. Set the <span class="strong"><strong>Start Size</strong></span> option to <span class="strong"><strong>0.2</strong></span> to keep them small.</p></li><li><p>It is no fun if our laser blasts are just white, so change the <span class="strong"><strong>Start Color</strong></span> value to an appropriate color for your lasers.</p></li><li><p>Last up for the <span class="strong"><strong>Initial</strong></span> module is to uncheck the <span class="strong"><strong>Play On Awake</strong></span> checkbox, keeping the system from triggering immediately when loaded.</p></li><li><p>Next we need to adjust the <span class="strong"><strong>Emission</strong></span> module. The flash occurs in a burst, so set the <span class="strong"><strong>Rate</strong></span> option to <span class="strong"><strong>0</strong></span>.</p></li><li><p>To make the burst, click on the <span class="strong"><strong>+</strong></span> sign to the right of the <span class="strong"><strong>Bursts</strong></span> list. A value of <span class="strong"><strong>5</strong></span> will work well.</p></li><li><p>Next we adjust the <span class="strong"><strong>Shape</strong></span> module to emit the particles along a straight line. To this end, set the <span class="strong"><strong>Angle</strong></span> option to <span class="strong"><strong>0</strong></span> and the <span class="strong"><strong>Radius</strong></span> option to <span class="strong"><strong>0.01</strong></span>.</p></li><li><p>Finally, we need to adjust the <span class="strong"><strong>Renderer</strong></span> module. To stretch out the particles, change the <span class="strong"><strong>Render Mode</strong></span> option to <span class="strong"><strong>Stretched Billboard</strong></span> and set the <span class="strong"><strong>Length Scale</strong></span> option to <span class="strong"><strong>-4.5</strong></span>.</p></li><li><p>Now that we are satisfied with the way this system looks, uncheck the <span class="strong"><strong>Looping</strong></span> checkbox<a id="id646" class="indexterm"></a> in the <span class="strong"><strong>Initial</strong></span> module.</p></li><li><p>Now create the second <code class="literal">particleSystem</code> object and rename it as <code class="literal">SpreadBlast</code>.</p></li><li><p>These particles should last for as long as those of the first system. So, in the <span class="strong"><strong>Initial</strong></span> module, set the <span class="strong"><strong>Duration</strong></span> option to <span class="strong"><strong>0.1</strong></span>, <span class="strong"><strong>Start Lifetime</strong></span> to <span class="strong"><strong>0.1</strong></span>, <span class="strong"><strong>Start Speed</strong></span> to <span class="strong"><strong>1</strong></span>, <span class="strong"><strong>Start Size</strong></span> to <span class="strong"><strong>0.2</strong></span>, and uncheck <span class="strong"><strong>Play On Awake</strong></span>.</p></li><li><p>To make these particles distinct from the line, set the <span class="strong"><strong>Start Color</strong></span> value to a slightly darker color.</p></li><li><p>Next, in the <span class="strong"><strong>Emission</strong></span> module, set the <span class="strong"><strong>Rate</strong></span> option to <span class="strong"><strong>0</strong></span> and add the <span class="strong"><strong>Bursts</strong></span> option with a <span class="strong"><strong>Particles</strong></span> value of <span class="strong"><strong>30</strong></span>.</p></li><li><p>For the <span class="strong"><strong>Shape</strong></span> module, set the <span class="strong"><strong>Angle</strong></span> option to <span class="strong"><strong>60</strong></span> and the <span class="strong"><strong>Radius</strong></span> option to <span class="strong"><strong>0.01</strong></span>. This causes the particles to fan out when spawned.</p></li><li><p>For the <span class="strong"><strong>Renderer</strong></span> module, set the <span class="strong"><strong>Render Mode</strong></span> option to <span class="strong"><strong>Stretched Billboard</strong></span> and the <span class="strong"><strong>Length Scale</strong></span> option to <span class="strong"><strong>-3</strong></span>.</p></li><li><p>Finally, once we are satisfied with the look of the system, again uncheck the <span class="strong"><strong>Looping</strong></span> checkbox in the <span class="strong"><strong>Initial</strong></span> module.</p></li><li><p>Before we put the particle systems in place, we need to create a script. Create a new one and name it <code class="literal">LaserBlast</code>. This script will trigger the particle systems and the audio clip to play.</p></li><li><p>This script starts with a single variable. This variable holds the list of systems to be triggered when the script is told to fire.</p><div class="informalexample"><pre class="programlisting">public ParticleSystem[] particles = new ParticleSystem[0];</pre></div></li><li><p>Next we have the only function in the script, <code class="literal">Fire</code>. It starts by making sure there is an <span class="strong"><strong>Audio Source</strong></span> component on the same <code class="literal">GameObject</code>. If it is present, <code class="literal">PlayOneShot</code> is called using the source's clip. This function plays the passed file once without blocking the playing of other clips.</p><div class="informalexample"><pre class="programlisting">public void Fire() {
  if(audio != null)
    audio.PlayOneShot(audio.clip);</pre></div></li><li><p>The function continues by looping through the list of particle systems and using <code class="literal">Play</code> to trigger them if they exist.</p><div class="informalexample"><pre class="programlisting">  for(int i=0;i&lt;particles.Length;i++) {
    if(particles[i] != null)
      particles[i].Play();
  }
}</pre></div></li><li><p>Next, we need to update the <code class="literal">TouchShoot</code> script. It needs to call the <code class="literal">Fire</code> function on the <code class="literal">LaserBlast</code> script when the player touches the screen. To that end, we<a id="id647" class="indexterm"></a> first add the <code class="literal">lasers</code> variable to hold the list of objects that need to be triggered.</p><div class="informalexample"><pre class="programlisting">public LaserBlast[] lasers = new LaserBlast[0];</pre></div></li><li><p>To the beginning of the <code class="literal">Update</code> function, we add the <code class="literal">didFire boolean</code> value. It will keep the lasers from being triggered more than once per frame.</p><div class="informalexample"><pre class="programlisting">bool didFire = false;</pre></div></li><li><p>We next set the Boolean to true after the <code class="literal">if</code> statement where we check to see if the touch's phase value is found to be equal to <code class="literal">TouchPhase.Began</code>.</p><div class="informalexample"><pre class="programlisting">didFire = true;</pre></div></li><li><p>At the end of the <a id="id648" class="indexterm"></a>
<code class="literal">Update</code> function, if the <code class="literal">didFire boolean</code> is true, the <code class="literal">Fire</code> function that we will be writing shortly is called.</p><div class="informalexample"><pre class="programlisting">if(didFire) Fire();</pre></div></li><li><p>Last up for the script, we add the <code class="literal">Fire</code> function. This function simply loops through the <code class="literal">lasers</code> array and calls their <code class="literal">Fire</code> function if they exist.</p><div class="informalexample"><pre class="programlisting">private void Fire() {
  for(int i=0;i&lt;lasers.Length;i++) {
    if(lasers[i] != null)
      lasers[i].Fire();
  }
}</pre></div></li><li><p>Now that we have all of the pieces, we need to put them together. Start by creating a new empty <code class="literal">GameObject</code> and naming it <code class="literal">LaserBlast</code>.</p></li><li><p>Next, make the <code class="literal">LineBlast</code> and <code class="literal">SpreadBlast</code> particle systems children of this new object. Be sure to set their positions and rotations to <code class="literal">0</code>.</p></li><li><p>Add our <code class="literal">LaserBlast</code> script to the object of the same name and add the two particle systems to the <span class="strong"><strong>Particles</strong></span> list on the script component.</p></li><li><p>Next, add an <span class="strong"><strong>Audio Source</strong></span> component to the object. Select the <span class="strong"><strong>Laser</strong></span> sound effect for the <span class="strong"><strong>Audio Clip </strong></span>value.</p></li><li><p>Finally for this object, expand the <span class="strong"><strong>3D Sound Settings</strong></span> group and select <span class="strong"><strong>Linear Rolloff</strong></span> for the <span class="strong"><strong>Volume Rolloff</strong></span> value; otherwise, we will not be able to hear it.</p></li><li><p>Position the laser blast in front of the muzzles of the player's ship. Duplicate it as needed to cover all the points. Also, make sure their local z axis points forward along the muzzles.</p></li><li><p>Next, make<a id="id649" class="indexterm"></a> all of your <code class="literal">LaserBlast</code> objects children of the player's ship so they keep moving with it.</p></li><li><p>Finally, add the objects to the <span class="strong"><strong>Lasers</strong></span> list on the <code class="literal">TouchShoot</code> script component.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_08_22.png.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec139"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created laser blasts for the player. Every time the player touches the screen, they are triggered. This way the player can tell that they are shooting even if they fail to hit anything. It is a quick and short effect, but adds a lot to the final experience.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec140"></a>Have a go hero – more types of lasers</h3></div></div></div><p>The player can shoot lasers, now the enemy needs to too. Add some laser blasts to the enemy ships. Also, it is time to replace their sphere bullets with something better. Create a plasma ball to replace the sphere bullets. A smaller, looping version of the explosion could work for the ball. An appropriately colored version of the engine trails could work for the ball's trail as it flies towards the player. It might also be a good idea to add the alarms to the bullets. This way the player knows when they are about to be blasted out of the game.</p></div></div>