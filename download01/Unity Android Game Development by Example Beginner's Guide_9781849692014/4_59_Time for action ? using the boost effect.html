<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec62"></a>Time for action – using the boost effect</h2></div></div><hr /></div><p>We will only be making a single script<a id="id314" class="indexterm"></a> in this section. It will move the tank in a similar manner to the <code class="literal">ChassisControls</code> script we created in the last chapter. The difference is, we won't have to hold down a button for the boost to work. Let's get to it.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start by creating a new script and calling it <code class="literal">TurboBoost</code>.</p></li><li><p>To start the script off, we need four variables. The first is a reference to <code class="literal">CharacterController</code>. We need this for movement. The second is how fast we will be moving while boosting. The third is how long, in seconds, we will be boosting. The last is used internally for whether or not we can boost and when we should stop.</p><div class="informalexample"><pre class="programlisting">public CharacterController controller;
public float boostSpeed = 50;
public float boostLength = 5;
public float startTime = -1;</pre></div></li><li><p>The next bit of code returns to our good friend, the <code class="literal">OnGUI</code> function<a id="id315" class="indexterm"></a>. Here we are just drawing a button on the screen, the same as we did several times before. If the button is pressed, it calls the <code class="literal">StartBoost</code> function that we will be writing in a moment.</p><div class="informalexample"><pre class="programlisting">public void OnGUI() {
  Rect turboRect = new Rect(10, Screen.height – 220, 75, 75);
  if(GUI.Button(turboRect, "Turbo"))
    StartBoost();
}</pre></div></li><li><p>The <code class="literal">StartBoost</code> function is pretty<a id="id316" class="indexterm"></a> simple. It checks to see if the<a id="id317" class="indexterm"></a> <code class="literal">startTime</code> variable is less than zero. If it is, the variable is set to the current time as provided by <code class="literal">Time.time</code>. Being less than zero means that we are not currently boosting.</p><div class="informalexample"><pre class="programlisting">public void StartBoost() {
  if(startTime &lt; 0)
    startTime = Time.time;
}</pre></div></li><li><p>The last function we are going to use is the <code class="literal">Update</code> function<a id="id318" class="indexterm"></a>. It begins with a check of <code class="literal">startTime</code> to see if we are currently boosting. If we are not boosting, the function is exited early. The next line of code checks to make sure we have our <code class="literal">CharacterController</code> reference. If the variable is empty, then we can't make the tank move.</p><div class="informalexample"><pre class="programlisting">public void Update() {
  if(startTime &lt; 0) return;
  if(controller == null) return;</pre></div></li><li><p>The next line of code should look familiar. This is the line that makes the tank move.</p><div class="informalexample"><pre class="programlisting">controller.Move(controller.transform.forward * boostSpeed * Time.deltaTime);</pre></div></li><li><p>The following few lines of code actually apply the camera effect. First is a check to see whether we are in the first half-second of the boost. If we are, we transition the camera by adjusting the <code class="literal">fieldOfView</code> value. The <code class="literal">Camera.main</code> value is just a reference provided by Unity to the main camera used in the scene. The<a id="id319" class="indexterm"></a> <code class="literal">Mathf.Lerp</code> function takes a starting value and moves it towards a goal value based on a third value between zero and one. Using this, the camera's <code class="literal">fieldOfView</code> is moved towards our goal over the half-second. The second half of this set of code checks for the last half-second of our boost and uses the same method to transition the <code class="literal">fieldOfView</code> value back to the default.</p><div class="informalexample"><pre class="programlisting">if(Time.time – startTime &lt; 0.5f)
  Camera.main.fieldOfView = Mathf.Lerp(Camera.main.fieldOfView, 130, (Time.time - startTime) * 2);
else if(Time.time – startTime &gt; boostLength - 0.5f)
  Camera.main.fieldOfView = Mathf.Lerp(Camera.main.fieldOfView, 60, (Time.time – startTime – boostLength + 0.5f) * 2);</pre></div></li><li><p>The last bit of code checks to see whether we are done boosting. If so, <code class="literal">startTime</code> is set to negative one to indicate that we can start another boost. That last curly brace, of course, closes off the <code class="literal">Update</code> function.</p><div class="informalexample"><pre class="programlisting">if(Time.time &gt; startTime + boostLength)
  startTime = -1;
}</pre></div></li><li><p>We are almost done. <a id="id320" class="indexterm"></a>Add the script to your tank and connect the <code class="literal">CharacterController</code> reference.</p></li><li><p>Try it out.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_04_05.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec55"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created a turbo boost. The<a id="id321" class="indexterm"></a> same method of movement used in the last chapter moves the tank here. By adjusting the <span class="strong"><strong>Field of View</strong></span> attribute of the camera, we make it look like the tank is moving even faster.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec56"></a>Have a go hero – styling and control</h3></div></div></div><p>The easy and obvious challenge here is to style the button. To spice it up, try changing it so there is a label while boosting and a button when not boosting. The label and button could each have their own style.</p><p>Another thing you might notice while playing the game is that you can still turn while boosting. Try adding a check to the <code class="literal">ChassisControls</code> script to lock the controls, if we are boosting. You are going to need to add a reference to the <code class="literal">TurboBoost</code> script.</p><p>For an added, extra challenge try adding a cooldown to the boost. Make it so the player can't constantly use the boost. Also, try canceling the boost if the tank runs into something. This is a big one, so you will start off with a hint: take a look at <code class="literal">OnControllerColliderHit</code>.</p></div></div>