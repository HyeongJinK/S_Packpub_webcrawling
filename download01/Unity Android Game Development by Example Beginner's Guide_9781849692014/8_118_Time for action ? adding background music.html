<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec117"></a>Time for action – adding background music</h2></div></div><hr /></div><p>Let's get started with a single<a id="id556" class="indexterm"></a> script to control our background music.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We will start by creating a new script and naming it <code class="literal">FadeIn</code>.</p></li><li><p>This script begins with three variables. The first is the goal volume that the script has to reach. The second is the number of seconds the transition will take. The last is the time when the transition began.</p><div class="informalexample"><pre class="programlisting">public float maxVolume = 1f;
public float fadeLength = 1f;
private float fadeStartTime = -1f;</pre></div></li><li><p>Next, we make use of the <code class="literal">Awake</code> function. It begins by looking at the <code class="literal">audio</code> variable, which is automatically supplied by Unity, to check for an attached <span class="strong"><strong>Audio Source</strong></span> component. If one cannot be found, the <code class="literal">gameObject</code> is destroyed and the function is exited.</p><div class="informalexample"><pre class="programlisting">public void Awake() {
  if(audio == null) {
    Destroy(gameObject);
    return;
  }</pre></div></li><li><p>The <code class="literal">Awake</code> function ends by setting its volume to <code class="literal">0</code> and playing it if it isn't already.</p><div class="informalexample"><pre class="programlisting">  audio.volume = 0;

  if(!audio.isPlaying)
    audio.Play();
}</pre></div></li><li><p>To cause the transition over time, we use the <code class="literal">Update</code> function. It will first check to see whether the <code class="literal">fadeStartTime</code> variable is below zero and set it to the current time if it is. This allows us to avoid the hiccup that can be caused by the initialization of a scene starting.</p><div class="informalexample"><pre class="programlisting">public void Update() {
  if(fadeStartTime &lt; 0)
    fadeStartTime = Time.time;</pre></div></li><li><p>The function next checks to see if the transition's time has ended. If it has, the <span class="strong"><strong>Audio Source</strong></span> component's volume is set to <code class="literal">maxVolume</code> and the script is destroyed to free resources.</p><div class="informalexample"><pre class="programlisting">if(fadeStartTime + fadeLength &lt; Time.time) {
  audio.volume = maxVolume;
  Destroy(this);
  return;
}</pre></div></li><li><p>Finally, the current progress is calculated by finding the amount of time that has passed<a id="id557" class="indexterm"></a> since the fade started and dividing it by the length of the transition. The resulting percentage of progress is multiplied by the value of <code class="literal">maxVolume</code> and applied to the <span class="strong"><strong>Audio Source</strong></span> component's volume.</p><div class="informalexample"><pre class="programlisting">  float progress = (Time.time – fadeStartTime) / fadeLength;
  audio.volume = maxVolume * progress;
}</pre></div></li><li><p>Back in Unity, we need to create a new empty <code class="literal">GameObject</code> and name it <code class="literal">Background</code>.</p></li><li><p>To this object, add our <code class="literal">FadeIn</code> script and an <span class="strong"><strong>Audio Source</strong></span> component.</p></li><li><p>If you have not already, create an <code class="literal">Audio</code> folder in your <span class="strong"><strong>Project</strong></span> panel and import the four sound files included in <span class="strong"><strong>Starting Assets</strong></span> for the chapter.</p></li><li><p>Select the <code class="literal">Background</code> sound file and uncheck the <span class="strong"><strong>3D Sound</strong></span> checkbox in the import settings.</p></li><li><p>Select your <code class="literal">Background</code> object in the <span class="strong"><strong>Hierarchy</strong></span> window and drag the <code class="literal">Background</code> sound to the <span class="strong"><strong>Audio Clip</strong></span> slot.</p></li><li><p>Make sure the <span class="strong"><strong>Play On Awake</strong></span> and <span class="strong"><strong>Loop</strong></span> checkboxes are checked on the <span class="strong"><strong>Audio Source</strong></span> component. The <span class="strong"><strong>Volume</strong></span> option also needs to be set to <span class="strong"><strong>0</strong></span>, all to make the file play throughout the game but make no noise when starting.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec126"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We added background music to our game. In order for the sound to be constant and not directional, we utilized the music as 2D sound. We also created a script to fade the music in when the game starts. This eases the transition into the game for the player, preventing a sudden onslaught of sound.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec127"></a>Have a go hero – setting some mood</h3></div></div></div><p>Background music adds a lot to a game's experience. A horror scene is not nearly as scary without some scary music. Bosses are much less intimidating without their daunting music. Look for some good background music for your other games. Something light and cheery would work nicely for Angry Birds, while a piece that is more industrial and fast-paced would keep hearts racing through the Tank Battle game.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec128"></a>Creating an alarm system</h3></div></div></div><p>To understand 3D audio effects, we are going to create an alarm system. As objects approach the ship, the alarm will increase in volume. The 3D effect will indicate the direction to the object<a id="id558" class="indexterm"></a> relative to the ship. This gives the player the needed feedback when they can't see everything around them. There are several ways this effect can be achieved, but this one will demonstrate our ability to adjust the <span class="strong"><strong>Audio Source</strong></span> component over time.</p></div></div>