<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec102"></a>Time for action – creating the pigs</h2></div></div><hr /></div><p>Let's get started with creating the pigs for the Angry Birds game:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The pigs are created in a manner similar to that of the the wood planks. Start by creating an empty <span class="strong"><strong>GameObject</strong></span> and naming it <code class="literal">Pig</code>.</p></li><li><p>Next, create a plane, <a id="id471" class="indexterm"></a>make it a child of the <code class="literal">Pig</code> object, and remove its <span class="strong"><strong>Mesh Collider</strong></span> component. We do this because of the rotation the plane will need to face the camera. Being a child of the empty <span class="strong"><strong>GameObject</strong></span> allows us to ignore that rotation when working with the pig.</p></li><li><p>Set the plane's local <span class="strong"><strong>Position</strong></span> to <code class="literal">0</code> on each axis and set its <span class="strong"><strong>Rotation</strong></span> to <code class="literal">90</code> on the <span class="strong"><strong>X</strong></span> axis, <code class="literal">270</code> on the <span class="strong"><strong>Y</strong></span> axis, and <code class="literal">0</code> on the <span class="strong"><strong>Z</strong></span> axis. This will make the plane face the camera.</p></li><li><p>Now, create two materials. Name one <code class="literal">Pig_Fresh</code> and the other <code class="literal">Pig_Damage</code>. From their <span class="strong"><strong>Shader</strong></span> drop-down list, select <span class="strong"><strong>Transparent</strong></span>, followed by <span class="strong"><strong>Cutout</strong></span>, and finally <span class="strong"><strong>Soft Edge Unlit</strong></span>. This allows us to make use of the the texture's alpha channel and provide some transparency.</p></li><li><p>Finish off the materials by adding the <code class="literal">pig_damage</code> and <code class="literal">pig_fresh</code> textures to them.</p></li><li><p>To the <code class="literal">Pig</code> object, add a <span class="strong"><strong>Sphere Collider</strong></span> component, a <span class="strong"><strong>Rigidbody</strong></span> component, and the <code class="literal">Plank</code> script. We make use of the <span class="strong"><strong>Sphere Collider</strong></span> component, rather than the <span class="strong"><strong>Mesh Collider</strong></span> component the plane came with, because the plane has zero thickness and will, therefore, have many issues colliding with other objects.</p></li><li><p>To complete the pig's creation, apply your material to the plane and connect the references in the <code class="literal">Plank</code> script. Finally, set the <span class="strong"><strong>Constraints</strong></span> parameters on the <span class="strong"><strong>Rigidbody</strong></span> component just as we did for the other planks.</p></li><li><p>Now, turn the pig<a id="id472" class="indexterm"></a> into a prefab and add it to your structure. Remember, leave them at zero on the x axis, but feel free to adjust their size, health, and score values to give them some variety.</p></li><li><p>Next, we need to expand the <code class="literal">LevelTracker</code> script. Open it up and we can add some more code.</p></li><li><p>First, we add some more variables at the beginning of the script. The first one, as its name suggests, will hold a list of all the pigs in our scene. Next is a flag for signaling that the game has ended. And finally, a string for telling the player why the game has ended.</p><div class="informalexample"><pre class="programlisting">public Transform[] pigs = new Transform[0];

private static gameOver = false;
private static string message = "";</pre></div></li><li><p>Next, we need to add a line to the <code class="literal">Awake</code> function. This simply makes sure that the <code class="literal">gameOver</code> flag is <code class="literal">false</code> when the level starts.</p><div class="informalexample"><pre class="programlisting">gameOver = false;</pre></div></li><li><p>We use the <code class="literal">OnGUI</code> function<a id="id473" class="indexterm"></a> to draw a Game Over screen when the game has ended, or for drawing the current score if it is still continuing.</p><div class="informalexample"><pre class="programlisting">public void OnGUI() {
  if(gameOver)
    DrawGameOver();
  else
    DrawScore();}</pre></div></li><li><p>The <code class="literal">DrawScore</code> function<a id="id474" class="indexterm"></a> takes the current score and uses <code class="literal">GUI.Label</code> to draw it in the top-right corner of the screen.</p><div class="informalexample"><pre class="programlisting">private void DrawScore() {
  Rect scoreRect = new Rect(Screen.width – 100, 0, 100, 30);
  GUI.Label(scoreRect, "Score: " + score);
}</pre></div></li><li><p>The <code class="literal">DrawGameOver</code> function<a id="id475" class="indexterm"></a> first uses the <code class="literal">GUI.Box</code> function to draw a dark box over the whole of the screen, simultaneously drawing the Game Over message on the screen. Next, it draws the player's final score in the middle of the screen. Below that, it draws a button. This button will save the player's current score and load the level-selection screen we will create later. The <code class="literal">Application.LoadLevel</code> function is used to load any other scene in your game. All of the scenes you intend to load have to be added to the <span class="strong"><strong>Build Settings</strong></span> window found in the <span class="strong"><strong>File</strong></span> menu and can be loaded by using either their name or their index, as used here:</p><div class="informalexample"><pre class="programlisting">private void DrawGameOver() {
  Rect boxRect =  new Rect(0, 0, Screen.width, Screen.height);
  GUI.Box(boxRect, "Game Over\n" + message);

  Rect scoreRect = new Rect(0, Screen.height / 2, Screen.width, 30);
  GUI.Label(scoreRect, "Score: " + score);

  Rect exitRect = new Rect(0, Screen.height / 2 + 50, Screen.width, 50);
  if(GUI.Button(exitRect, "Return to Level Select")) {
    Application.LoadLevel(0);
    SaveScore();
  }
}</pre></div></li><li><p>In the <code class="literal">LateUpdate</code> function, we call another function to check whether all the pigs have been destroyed if the game is not yet over.</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  if(!gameOver)
    CheckPigs();
}</pre></div></li><li><p>Next, we add the <code class="literal">CheckPigs</code> function<a id="id476" class="indexterm"></a>. This function loops through the list of pigs to see if they<a id="id477" class="indexterm"></a> are all destroyed. Should it find one that is still around, it exits the function. Otherwise, the game is flagged as being over and the message is set to tell the player that they succeeded in destroying all of the pigs.</p><div class="informalexample"><pre class="programlisting">private void CheckPigs() {
  for(int i=0;i&lt;pigs.Length;i++) {
    if(pigs[i] != null) return;
  }

  gameOver = true;
  message = "You destroyed the pigs!";
}</pre></div></li><li><p>The <code class="literal">OutOfBirds</code> function<a id="id478" class="indexterm"></a> will be called by the slingshot we are going to create later, when the player runs out of birds to launch at the pigs. If the game has not yet ended, the function ends the game and sets an appropriate message for the player.</p><div class="informalexample"><pre class="programlisting">public static void OutOfBirds() {
  if(gameOver) return;

  gameOver = true;
  message = "You ran out of birds!";
}</pre></div></li><li><p>Finally, we have the <code class="literal">SaveScore</code> function<a id="id479" class="indexterm"></a>. Here, we use the <code class="literal">PlayerPrefs</code> class. It lets us easily store and retrieve small amounts of data, perfect for our current needs. We just need to provide it with a unique key to save the data under. For that, we use a short string combined with the level's index as provided by <code class="literal">Application.loadedLevel</code>. Next, we use <code class="literal">PlayerPrefs.GetInt</code> to retrieve the last score that was saved. If there isn't one, the zero that we passed to the<a id="id480" class="indexterm"></a> function is returned as a default value. Finally, we compare the new score with the old score and use <code class="literal">PlayerPrefs.SetInt</code> to save the new score if it is higher.</p><div class="informalexample"><pre class="programlisting">private void SaveScore() {
  string key = "LevelScore" + Application.loadedLevel;
  int previousScore = PlayerPrefs.GetInt(key, 0);
  if(previousScore &lt; score) 
    PlayerPrefs.SetInt(key, score);
}</pre></div></li><li><p>Back in Unity, the pigs need to be added to the <code class="literal">LevelTracker</code> script's list. With the <code class="literal">LevelTracker</code> script selected, drag-and-drop each pig to the <code class="literal">Pigs</code> value in the <span class="strong"><strong>Inspector</strong></span> window to add them.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_07_03.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec102"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created the pigs and updated our <code class="literal">LevelTracker</code> script to track them. The pigs are really just like the<a id="id481" class="indexterm"></a> planks of wood, but are spheres instead of boxes. The updated <code class="literal">LevelTracker</code> script watches for the instance when all of the pigs are destroyed and triggers a Game Over screen when they are. It also handles the drawing of the score while the game is being played and the saving of that score when the level is over.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec103"></a>The ally</h3></div></div></div><p>Next, we need something to throw at the pigs and their fortification. Here, we will create the simplest of the birds. The red bird is essentially just a rock. He has no special powers and nothing particularly special about his code, besides health. You will also notice that the bird is a 3D model, giving it the shadows that the pigs are missing.</p></div></div>