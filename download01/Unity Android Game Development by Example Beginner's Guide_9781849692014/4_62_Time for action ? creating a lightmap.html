<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec65"></a>Time for action – creating a lightmap</h2></div></div><hr /></div><p>Lightmaps are a great effect for any game environment, but we need to explicitly tell Unity which objects will not<a id="id341" class="indexterm"></a> move and then use lightmaps.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing to do is make our environment meshes static. To do this start by selecting a piece of your city.</p></li><li><p>In the top-right corner of the <span class="strong"><strong>Inspector</strong></span> window to the right of the object name field are a checkbox and a <span class="strong"><strong>Static</strong></span> label. Checking this box will make the object static.</p></li><li><p>Make all of the city's meshes static.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip22"></a>Tip</h3><p>Instead of selecting each checkbox one by one, if you have any sort of grouping (as we just did for the lights), this step can be completed much faster.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the root object of your city, the one that is the parent to all the pieces of our city, the buildings, and streets.</p></li><li><p>Now go and select the <span class="strong"><strong>Static</strong></span> checkbox.</p></li><li><p>On the new pop-up, select <span class="strong"><strong>Yes, change children</strong></span> to cause all of the subobjects to become static as well.</p></li></ol></div></li><li><p>Any mesh that is either not unwrapped or has UV positions outside the normalized UV space will be skipped when Unity generates a lightmap. In the <span class="strong"><strong>Model Import Settings</strong></span> window, there is an option to have Unity automatically generate lightmap coordinates, <span class="strong"><strong>Generate Lightmap</strong></span>. If you are using <code class="literal">TankBattleCity</code> for your environment, this option should be turned on now.</p></li><li><p>Go to the top of the Unity Editor and select <span class="strong"><strong>Window</strong></span> followed by <span class="strong"><strong>Lightmapping</strong></span>, near the bottom.</p></li><li><p>Most of your time will be spent on the <span class="strong"><strong>Bake</strong></span> page looking at this window. Select <span class="strong"><strong>Bake</strong></span> at the top <a id="id342" class="indexterm"></a>of the window to switch to it.</p></li><li><p>
<span class="strong"><strong>Mode</strong></span> dictates what types of lightmaps will be rendered by the system. To save on processing speed and file size, select <span class="strong"><strong>Single Lightmaps</strong></span> from the <span class="strong"><strong>Mode</strong></span> drop-down list to the right. This means that only a <span class="strong"><strong>Far</strong></span> set of lightmaps is created rather than both <span class="strong"><strong>Near</strong></span> and <span class="strong"><strong>Far</strong></span>. Using <span class="strong"><strong>Dual Lightmaps</strong></span> also requires special shaders that you won't use most of the time.</p></li><li><p>
<span class="strong"><strong>Quality</strong></span> is a set of presets that dictates how good the lightmaps look. <span class="strong"><strong>High</strong></span> is obviously the best and <span class="strong"><strong>Low</strong></span> is the fastest to process. For our purposes, <span class="strong"><strong>Low</strong></span> will look good enough and should be selected.</p></li><li><p>
<span class="strong"><strong>Resolution</strong></span> is how much space an object will take up on a single lightmap. To the right of the input field, it reads texels per world unit. A texel is just a fancy type of pixel used for lightmaps. It is the number of pixels a single unit of space in the world will take up on the lightmap. A setting of 30 here will maintain the desired level of quality while making the whole thing run faster.</p></li><li><p>At the bottom of the page is a <span class="strong"><strong>Bake Scene</strong></span> button. Clicking on this button will start the render process. A loading bar will appear in the bottom-right corner of Unity so you can monitor the progress.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>If you are still adjusting lights and settings and desire to see what a portion of the game will look like, start by selecting the meshes you wish to see.</p></li><li><p>Next, click on the little arrow to the right of the <span class="strong"><strong>Bake Scene</strong></span> button.</p></li><li><p>From the new drop-down list, select <span class="strong"><strong>Bake Selected</strong></span>. This will run an identical process to <span class="strong"><strong>Bake Scene</strong></span>, except it will only be for the selected objects rather than the entire scene.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip23"></a>Tip</h3><p>Be warned, this process will likely take a while. Especially as the complexity of the environment and the number of lights increases, this will take longer and longer to run. And, unless you have a superior computer, there isn't much you can do in Unity while it is running.</p></div></li></ol></div></li><li><p>If you clicked on the button and realized you made a mistake, don't fret. After <span class="strong"><strong>Bake Scene</strong></span> is selected, the button changes to <span class="strong"><strong>Cancel</strong></span>. At this time it is possible to select it and stop the process from continuing. However, once the textures have been <a id="id343" class="indexterm"></a>created and Unity starts to import them, there is no stopping it.</p></li><li><p>To the left of <span class="strong"><strong>Bake Scene</strong></span> is <span class="strong"><strong>Clear</strong></span>. This button is the quickest and easiest way to delete and remove all of the lightmaps that are currently being used in the scene. This cannot be undone.</p></li><li><p>In order to add shadows to your buildings, select <span class="strong"><strong>Directional Light</strong></span> in your scene and take a look at the <span class="strong"><strong>Inspector</strong></span> window.</p></li><li><p>From the <span class="strong"><strong>Shadow Type</strong></span> drop-down list, select <span class="strong"><strong>Soft Shadows</strong></span>. This simply turns shadows on for this light. It also turns on real-time shadows for this light, if you are using Unity Pro. The more lights with shadows turned on, the more expensive they become to render.</p></li><li><p>When all of your lights and settings match your desires, select <span class="strong"><strong>Bake Scene</strong></span> and gaze in wonder at the now beautiful scene before you.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_04_08.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec59"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We added lightmaps to our game world. The length of time it takes to just process this step makes it difficult to<a id="id344" class="indexterm"></a> make minor tweaks. However, our lighting has vastly improved with a few clicks. While before the lights were broken by the meshes, we now have smooth patches of color and light.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec60"></a>Have a go hero – reason and speed</h3></div></div></div><p>When playing a game, there is only one light that people will not question the source of: the Sun. Every other light looks weird if a source cannot be seen. Create a mesh and add it to the game to give the lights you are using a reason. This could be something along the lines of torches, or lamp posts, or even glowing alien goo balls. Whatever they end up being, having them adds that touch of completeness that makes the difference between an alright OK-looking game and a great-looking game.</p><p>As a second challenge, take a look at your lightmap's quality. Play with the various quality settings we discussed to see what the differences are. Also, find out how low the resolution can go before you notice any pixelation. Can the settings go even lower when running on the smaller, mobile device screens? Go find out.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec61"></a>Cookies</h3></div></div></div><p>Cookies are a great way to add <a id="id345" class="indexterm"></a>interest to the lights in your game. They use a texture to adjust how the light is emitted. This effect can cover a wide range of uses from sparkling crystals to caged industrial lights and, in our case, headlights.</p></div></div>