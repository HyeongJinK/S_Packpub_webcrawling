<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec72"></a>Time for action – creating the NavMesh</h2></div></div><hr /></div><p>Unity can automatically <a id="id357" class="indexterm"></a>generate a NavMesh from any meshes that exist in a scene. To do so, the mesh must first be marked as static, just as we did for lightmaps. However, we do not want or need to be able to navigate the roofs of our city, so we make use of a special <a id="id358" class="indexterm"></a>list of settings for dictating what type of static each object will be:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the city from the <span class="strong"><strong>Hierarchy</strong></span> window and click on the down arrow to the right of <span class="strong"><strong>Static</strong></span> in the <span class="strong"><strong>Inspector</strong></span> window and we can take a look at the options available for static objects as follows:</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_05_01.jpg" /></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Nothing</strong></span>: This option is used to quickly deselect all the other options. If all the others are unchecked, this one will be checked.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Everything</strong></span>: Using this option, you can quickly select all the other options. When all of them are checked, this one will also be checked. The checkbox next to the <span class="strong"><strong>Static</strong></span> label in the <span class="strong"><strong>Inspector</strong></span> window performs the same function as checking and unchecking the <span class="strong"><strong>Everything</strong></span> checkbox.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Lightmap Static</strong></span>: This option needs to be checked, when working with lightmaps, in order for them to work. Any mesh that does not have this checked will not be lightmapped.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Occluder Static</strong></span>: This is an option for working with occlusion. <span class="strong"><strong>Occlusion</strong></span><a id="id359" class="indexterm"></a> is a method of runtime optimization that involves only rendering objects that can actually be seen whether or not they are within the camera's view space. An <a id="id360" class="indexterm"></a>
<span class="strong"><strong>Occluder</strong></span> is an object that will block other objects from being seen. It works in conjunction with the <span class="strong"><strong>Occludee Static</strong></span> option. The best object choices for this option are large and solid.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Batching Static</strong></span>: This is another option for runtime optimization. Batching is the act of grouping objects together before rendering them. It greatly increases the overall render speed of a game.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Navigation Static</strong></span>: This is the option we are primarily concerned with at this point. <a id="id361" class="indexterm"></a>Any mesh that has this option checked will be used when calculating the NavMesh.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Occludee Static</strong></span>: As mentioned a moment ago, this option works in conjunction with <span class="strong"><strong>Occluder Static</strong></span> for the good of occlusion. An Occludee is an object that will be obscured by other objects. When covered by an Occluder, this object will not be drawn.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Off Mesh Link Generation</strong></span>: This option also works with the NavMesh calculation. An Off Mesh Link is a connection between two parts of the NavMesh that aren't physically connected, such as the roof and the street. Using a few settings in the <span class="strong"><strong>Navigation</strong></span> window and this option, the links are automatically generated.</p></li></ul></div></li><li><p>In order to make the NavMesh work properly, we need to change the settings so that only the streets of the city can be navigated. When was the last time you saw a tank jump to or fall from the roof of a building? So, we need to change the <span class="strong"><strong>Static</strong></span> options so that only the streets have <span class="strong"><strong>Navigation Static</strong></span> checked. This can be done in one of the following two ways:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The first way is to go through and uncheck the option for each object we want changed.</p></li><li style="list-style-type: disc"><p>The second is to uncheck <span class="strong"><strong>Naviagation Static</strong></span> for the top-level object in the <span class="strong"><strong>Hierarchy</strong></span> window and, when Unity asks if we want to make the change for all children objects, reply with a yes. Then, go to just the objects that we want to navigate and recheck the option.</p></li></ul></div></li><li><p>Now, open the <span class="strong"><strong>Navigation</strong></span> window by going to Unity's toolbar and clicking on <span class="strong"><strong>Window</strong></span> followed by <span class="strong"><strong>Navigation</strong></span> at the bottom of the menu. The following screenshot displays the window where all the work of making the NavMesh happens:</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_05_02.jpg" /></div></li><li><p>This window consists of three pages and a variety of settings:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>When an object is selected, the settings will appear on the <span class="strong"><strong>Object</strong></span> page. The two checkboxes correspond directly with the <span class="strong"><strong>Static</strong></span> options of the same name that we set a moment ago. <a id="id362" class="indexterm"></a>The drop-down list in <span class="strong"><strong>Navigation Layer</strong></span> lets us use different layers for different parts of our NavMesh. These layers can be used to affect the pathfinding calculation. For example, a car can be set to only travel on a road layer and the human can follow the sidewalk layer.</p></li><li style="list-style-type: disc"><p>The <span class="strong"><strong>Bake</strong></span> page is the one <a id="id363" class="indexterm"></a>we are interested in; it is full of options to change how the NavMesh is generated.</p><p>
<span class="strong"><strong>Radius</strong></span>: This should be set to the size of the average character. It is used to keep characters from walking too close to the walls.</p><p>
<span class="strong"><strong>Height</strong></span>: This is the height of your characters. Using this, Unity can calculate and remove the areas that are too low for them to pass. Anything lower than this value is deemed too small.</p><p>
<span class="strong"><strong>Max Slope</strong></span>: Anything steeper than this value is ignored when calculating NavMesh.</p><p>
<span class="strong"><strong>Step Height</strong></span>: When making use of stairs, one must use this value. This is the maximum height of a stair that a character can step on.</p><p>
<span class="strong"><strong>Drop Height</strong></span>: This is the height from which characters can fall. With it, paths will include jumping off ledges, if it is faster to do so. As you can tell from the screenshot, this is a Unity Pro-only feature.</p><p>
<span class="strong"><strong>Jump Distance</strong></span>: Using this value, characters can jump across gaps in NavMesh. This value represents the longest distance that can be jumped. As you can tell from the screenshot, this is a Unity Pro only feature.</p><p>
<span class="strong"><strong>Min Region Area</strong></span>: If parts of the NavMesh are too small, anything smaller than this value, they will not be used in the final NavMesh.</p><p>
<span class="strong"><strong>Width Inaccuracy %</strong></span>: When doing the NavMesh calculations, Unity makes use of a number of approximations. This is not entirely accurate, but it is fast. This value represents how much inaccuracy is allowed for the horizontal.</p><p>
<span class="strong"><strong>Height Inaccuracy %</strong></span>: This is the same as the previous settings, the difference being that it works for the vertical.</p><p>
<span class="strong"><strong>Height Mesh</strong></span>: With this option checked, the original height information is maintained in NavMesh. Unless you have a special need of it, this option should remain off. It takes the system longer to calculate and requires more memory to store.</p></li><li style="list-style-type: disc"><p>The third page, <span class="strong"><strong>Layers</strong></span>, allows us to adjust the cost of movement for each of our layers. Essentially, how difficult is it to move through different parts of our game world. With cars, we could adjust the layers, so it is twice as costly for them to move through the field as it is to move along the road.</p><p>At the bottom of the window, we have two buttons:</p><p>
<span class="strong"><strong>Clear</strong></span>: This button removes the previously created NavMesh. After using this button, you will need to re-bake the NavMesh before you can make use of pathfinding again.</p><p>
<span class="strong"><strong>Bake</strong></span>: This button starts the work and creates the NavMesh.</p></li></ul></div></li><li><p>Our city is very simple, so the default values will suit us well enough. Hit <span class="strong"><strong>Bake</strong></span> and watch the progress bar in the bottom-right corner. Once it is done, a blue mesh will appear. This is the NavMesh and, of course, represents all of the area that a<a id="id364" class="indexterm"></a> character can move through.</p></li><li><p>There is one last thing we need to do. Our NavMesh is just right but, if you look closely, it goes through the fountain in the center of the city. It would just be wrong if enemy tanks start driving through the fountain. To fix this, start by selecting the mesh that forms the wall around the fountain.</p></li><li><p>In the toolbar of Unity, click on <span class="strong"><strong>Component</strong></span>, followed by <span class="strong"><strong>Navigation</strong></span>, and finally <span class="strong"><strong>NavMeshObstacle</strong></span>. This simply adds a component that tells the navigation system to go around when finding a path. Because we had the wall already selected, the new component is already sized to fit. You can see it represented as a wire cylinder in the <span class="strong"><strong>Scene</strong></span> view.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_05_07.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec66"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created the NavMesh. <a id="id365" class="indexterm"></a>We made use of the <span class="strong"><strong>Navigation</strong></span> window and the <span class="strong"><strong>Static</strong></span> options to tell Unity which meshes to use when calculating the NavMesh. The Unity team put a lot of work into making this process quick and easy.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec67"></a>Have a go hero – creating extra obstacles</h3></div></div></div><p>Remember, in <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>The Backbone of Any Game – Meshes, Materials, and Animation</em></span>, when the challenge was to create obstacles for the player, you were encouraged to create additional meshes, such as tank traps and rubble. It would be a bad idea to let the enemy tanks drive through these, as well. So, have a go at turning these into obstacles for the navigation system. This will be done just as with the fountain.</p></div></div>