<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec91"></a>Time for action – adding an enemy ship</h2></div></div><hr /></div><p>To make our enemy ships, we will need a script to turn our enemy ship into a prefab:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The first thing we need to do is create a <a id="id433" class="indexterm"></a>new script and call it <code class="literal">EnemyShip</code>. This script will control the movement and shooting of the enemy ships.</p></li><li><p>The script starts off with several variables. The first two define the speed with which the ship moves forward and how fast it turns.</p><div class="informalexample"><pre class="programlisting">public float moveSpeed = 8f;
public float turnSpeed = 0.5f;</pre></div></li><li><p>The next three variables are for controlling the shooting of the ship. First is the rate at which bullets are fired. It is followed by the range that the ship has to be within to fire at the player. Third is a holder for how long it has been since the last bullet was fired. This will work with the rate of fire to dictate when the ship can fire again.</p><div class="informalexample"><pre class="programlisting">public float fireRate = 1.5f;
public float fireRange = 60f;
private float fireTime = 0;</pre></div></li><li><p>The last two variables will hold a reference to the bullet prefab that will be fired and the point from which the bullet will be released. This is similar to how we made the<a id="id434" class="indexterm"></a> enemy tanks shoot in the previous chapter. The difference is that space games tend to have a lot of laser blasts flying around that force the player to dodge.</p><div class="informalexample"><pre class="programlisting">public GameObject bullet;
public Transform muzzlePoint;</pre></div></li><li><p>In the <code class="literal">Update</code> function, we will do the work of actually shooting. It starts by tracking how long it has been since a bullet was last fired. Then we check to see if it has been long enough since the last firing in order to fire again, and exit the function if it is not. The third line of code in the function checks the range. This is done in exactly the same way as we checked to see if the asteroids moved too far away from the player. Next, we check to make sure the ship is pointed at the player. This is done in the same way as we did when the enemy tanks were to shoot at the player. A comparison of the forward direction is done with the direction to the player to check the angle. If it is pointing close enough at the player, the ship can start shooting. The shooting is done with a call to the <code class="literal">Instantiate</code> function. By passing it the <code class="literal">muzzlePoint</code> variable's position and rotation, the new bullet is automatically rotated. A separate script will be handling the movement of the bullet. Finally, the time since the ship last fired is reset to zero.</p><div class="informalexample"><pre class="programlisting">public void Update() {
  fireTime += Time.deltaTime;
  if(fireTime &lt; fireRate) return;

  if(transform.position.sqrMagnitude &gt; fireRange * fireRange) return;

  if(Vector3.Angle(transform.forward, -transform.position) &gt; 10) return;

  Instantiate(bullet, muzzlePoint.position, muzzlePoint.rotation);
  fireTime = 0;
}</pre></div></li><li><p>The next function is the <code class="literal">LateUpdate</code> function<a id="id435" class="indexterm"></a>. We are going to use this function just as we did for the asteroid. The first line of code just calls out to the <code class="literal">PlayerShip</code> script to have the ship rotated and moved to fake the player's movement.</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  PlayerShip.Rotate(transform);</pre></div></li><li><p>The next line of code applies movement to the ship. The process is similar to how we made the enemy turrets rotate to face the player in the previous chapter. The <code class="literal">step</code> variable is used to dictate how fast the ship turns towards the player. We use<a id="id436" class="indexterm"></a> the <code class="literal">Slerp</code> function<a id="id437" class="indexterm"></a> to change the ship's current rotation towards the target rotation. In this case, the rotation is the one that looks at the player. Lastly, the ship is moved forward. Altogether, this results in movements similar to how a car turns.</p><div class="informalexample"><pre class="programlisting">float step = turnSpeed * Time.deltaTime;
Quaternion toPlayer = Quaternion.LookRotation(-transform.position);
transform.rotation = Quaternion.Slerp(transform.rotation, toPlayer, step);
transform.position += transform.forward * moveSpeed * Time.deltaTime;</pre></div></li><li><p>The last code snippet for the function and the script is the check to see if the ship is too far away. It is exactly the same as the one used by the asteroid.</p><div class="informalexample"><pre class="programlisting">  if(transform.position.sqrMagnitude &gt; 1e5) Destroy(gameObject);
}</pre></div></li><li><p>Before we can put our enemy ship together, we need to make one more short script. Create a new script and name it <code class="literal">Bullet</code>. As you might guess, this is the script that will control the movement of the enemy bullets.</p></li><li><p>This script starts with a single variable, that is, how fast the bullet will move through space.</p><div class="informalexample"><pre class="programlisting">public float speed = 20f;</pre></div></li><li><p>Next, we make use of the <code class="literal">LateUpdate</code> function<a id="id438" class="indexterm"></a> again. This function first uses <code class="literal">PlayerShip.Rotate</code> to reposition the bullet, just as with all the other objects in the game world. It then moves forward with speed. Last, it does the check for being out of range.</p><div class="informalexample"><pre class="programlisting">public void LateUpdate() {
  PlayerShip.Rotate(transform);

  transform.position += transform.forward * speed * Time.deltaTime;
  if(transform.position.sqrMagnitude &gt; 1e5) Destroy(gameObject);
}</pre></div></li><li><p>The last function for the script, <code class="literal">OnTriggerEnter</code>, works just like the one for the asteroid. If the bullet makes contact with a ship, it will destroy itself.</p><div class="informalexample"><pre class="programlisting">public void OnTriggerEnter(Collider other) {
  Destroy(gameObject);
}</pre></div></li><li><p>Now that we have our scripts, the next step is to create the enemy ship and bullet prefabs. To create the bullet, start by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Other</strong></span> | <span class="strong"><strong>Sphere</strong></span>.</p></li><li><p>Rename the new<a id="id439" class="indexterm"></a> sphere to <code class="literal">Bullet</code> and scale it to about half of its original size.</p></li><li><p>Next, add the <code class="literal">Bullet</code> script to the object and be sure to check the <span class="strong"><strong>Is Trigger</strong></span> checkbox in its <span class="strong"><strong>SphereCollider</strong></span> component. Without that box checked, the bullet won't work properly.</p></li><li><p>Finally, drag the object to the <code class="literal">Prefabs</code> folder to turn it into a prefab.</p></li><li><p>Next, we need to make the enemy ship. Start by creating an empty <span class="strong"><strong>GameObject</strong></span> and renaming it to <code class="literal">EnemyShipPivot</code>.</p></li><li><p>Add a copy of the <code class="literal">EnemyShip</code> model to the scene and make it a child of the pivot point we just created. Be sure to rotate it to face forward along the z axis, and position it to be centered on the pivot point.</p></li><li><p>Next, use simple colliders and empty <span class="strong"><strong>GameObject</strong></span> to create a collision shape for the ship. This is exactly like what we did for the player's ship. Be sure to make all of the colliders children of the enemy ship's pivot point.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_06_05.jpg" /></div></li><li><p>We need to create a muzzle point and position it in front of the enemy ship. Do it just as we did for the tanks. Be sure to also make it a child of the ship's pivot point.</p></li><li><p>Now, add the <code class="literal">EnemyShip</code> script and a <span class="strong"><strong>Rigidbody</strong></span> component to the pivot point.</p></li><li><p>Almost done. Drag the muzzle point from the <span class="strong"><strong>Hierarchy</strong></span> window and drop it on the appropriate slot in the script component in the <span class="strong"><strong>Inspector</strong></span>. Also, drag-and-drop the <span class="strong"><strong>Bullet</strong></span> <a id="id440" class="indexterm"></a>prefab from the <span class="strong"><strong>Project</strong></span> window to the waiting slot.</p></li><li><p>Finally, make the ship into a prefab by dragging it from the <span class="strong"><strong>Hierarchy</strong></span> window to the <code class="literal">Prefabs</code> folder.</p></li><li><p>Add a couple of extra ships to the scene and try it out.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_06_06.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec87"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created an enemy space ship. The ships will fly after the player and begin shooting when within range. Like the asteroids, they move around the player to fake the player's movement. However, instead of moving in a random direction, the enemy ships turn towards the player. By slowing down how fast the ships can turn, they move in arcs rather than pivoting quickly in place. Also, because of the <span class="strong"><strong>Rigidbody</strong></span> component attached to the enemy ships, they can collide with the asteroids that are in the scene.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec88"></a>Have a go hero – skybox and fog</h3></div></div></div><p>Now that we have several objects flying<a id="id441" class="indexterm"></a> around in space, it is a good idea to make the scene look a little better. For our Tank Battle game, we added a skybox to make the scene look like it is actually on a planet. However, we are flying around in space. The challenge is for you to find or make a skybox that looks like outer space. Also, adding some distant fog will obscure objects as they move too far away from the player. If the fog is black, it will look like the objects are swallowed by the blackness of deep space.</p></div></div>