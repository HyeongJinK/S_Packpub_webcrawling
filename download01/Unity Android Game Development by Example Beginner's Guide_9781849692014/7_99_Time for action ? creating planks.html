<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec99"></a>Time for action â€“ creating planks</h2></div></div><hr /></div><p>Each of the blocks we will be<a id="id461" class="indexterm"></a> creating will be largely similar:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, we will create the plank of wood. To do this, we need another cube. Rename it <code class="literal">Plank_Wood</code>.</p></li><li><p>Set the plank's <span class="strong"><strong>Scale</strong></span> to <code class="literal">2</code> for the <span class="strong"><strong>X</strong></span> and <span class="strong"><strong>Y</strong></span> axes, and <code class="literal">0.25</code> for the <span class="strong"><strong>Z</strong></span> axis. Its scale on the y and z axis define its size as seen by the player. The scale on the x axis makes sure that it will be hit by other physics objects in the scene.</p></li><li><p>Next, create a new material using the <code class="literal">plank_wood</code> texture and apply it to the cube.</p></li><li><p>To convert this new wood plank into a physics object, add a <span class="strong"><strong>Rigidbody</strong></span> component. Make sure your plank is selected, go to the menu bar of Unity and click on <span class="strong"><strong>Component</strong></span>, followed by <span class="strong"><strong>Physics</strong></span>; finally, click on <span class="strong"><strong>Rigidbody</strong></span>.</p></li><li><p>We need to keep the plank from moving along the x axis and out of alignment with our other physics objects as well as keeping it from rotating to show its other sides to the player. To do this, we make use of the <span class="strong"><strong>Constraints</strong></span> group of checkboxes on the <span class="strong"><strong>Rigidbody</strong></span> component. Check the checkbox for the <span class="strong"><strong>X</strong></span> axis next to <span class="strong"><strong>Freeze Position</strong></span> and the <span class="strong"><strong>Y</strong></span> and <span class="strong"><strong>Z</strong></span> checkboxes next to <span class="strong"><strong>Freeze Rotation</strong></span>. These will keep the object from moving in ways we don't want it to.</p></li><li><p>To make the plank function properly within our game, we need to create a new script and name it <code class="literal">Plank</code>.</p></li><li><p>This script begins with a<a id="id462" class="indexterm"></a> bunch of variables. The first two are for tracking the health of the plank. We need to separate the total amount of health from the current health, so we will be able to detect when the object has been reduced to half health. At that point, we will make use of our next three variables to change the object's material to one that shows damage. The last variable is used when the object runs out of health and is destroyed. We will use it to increase the player's score.</p><div class="informalexample"><pre class="programlisting">public float totalHealth = 100f;
private float health = 100f;

public Material damageMaterial;
public Renderer plankRenderer;
private bool didSwap = false;

public int scoreValue = 100;</pre></div></li><li><p>For the script's first function, we use <code class="literal">Awake</code> for initialization. We make sure the object's current health is the same as its total health, and we make sure the <code class="literal">didSwap</code> flag is set to <code class="literal">false</code>.</p><div class="informalexample"><pre class="programlisting">public void Awake() {
  health = totalHealth;
  didSwap = false;}</pre></div></li><li><p>Next, we make use of the <code class="literal">OnCollisionEnter</code> function<a id="id463" class="indexterm"></a>. This is a special function, triggered by the <span class="strong"><strong>Rigidbody</strong></span> component, that gives us information about what the object collided with and how. We use this information to find <code class="literal">collision.relativeVelocity.magnitude</code>. This is the speed at which the objects collided, and we use it as damage to reduce the current health. Next, the function checks to see if the health has been reduced to half and calls the <code class="literal">SwapToDamaged</code> function if it has. By using the <code class="literal">didSwap</code> flag, we make sure the function will only be called once. Finally, for the function, it checks to see if the health has dropped below zero. If it has, the object is destroyed and we call the <code class="literal">LevelTracker</code> script, which we will soon be making, to add to the player's score.</p><div class="informalexample"><pre class="programlisting">public void OnCollisionEnter(Collision collision) {
  health -= collision.relativeVelocity.magnitude;

  if(!didSwap &amp;&amp; health &lt; totalHealth / 2f) {
    SwapToDamaged();
  }

  if(health &lt;= 0) {
    Destroy(gameObject);
    LevelTracker.AddScore(scoreValue);
  }
}</pre></div></li><li><p>Finally for the script, we have the <code class="literal">SwapToDamaged</code> function<a id="id464" class="indexterm"></a>. It starts by setting the <code class="literal">didSwap</code> flag to <code class="literal">true</code>. Next, it checks to make sure the <code class="literal">plankRenderer</code> and <a id="id465" class="indexterm"></a>
<code class="literal">damageMaterial</code> variables have references to other objects. Ultimately, it uses the <code class="literal">plankRenderer.sharedMaterial</code> value to change to the damaged looking material.</p><div class="informalexample"><pre class="programlisting">public void SwapToDamaged() {
  didSwap = true;
  if(plankRenderer == null) return;
  if(damageMaterial == null) return;

  plankRenderer.sharedMaterial = damageMaterial;
}</pre></div></li><li><p>Before we can add our <code class="literal">Plank</code> script to our objects, we need to create the <code class="literal">LevelTracker</code> script that was mentioned earlier. Create it now.</p></li><li><p>This script is fairly short and starts with a single variable. The variable will track the player's score for the level and is <code class="literal">static</code> so that it can be easily changed as objects are destroyed for points.</p><div class="informalexample"><pre class="programlisting">private static int score = 0;</pre></div></li><li><p>Next, we use the <code class="literal">Awake</code> function to make sure the player starts at zero when beginning a level.</p><div class="informalexample"><pre class="programlisting">public void Awake() {
  score = 0;
}</pre></div></li><li><p>Finally for the script, we add the <code class="literal">AddScore</code> function<a id="id466" class="indexterm"></a>. This function simply takes the amount of points passed to it and increases the player's score. It is also <code class="literal">static</code>, so that it can be called by any object in the scene without needing a reference to the script.</p><div class="informalexample"><pre class="programlisting">public static void AddScore(int amount) {
  score += amount;
}</pre></div></li><li><p>Back in Unity, we need to create a new material using the <code class="literal">plank_wood_damaged</code> texture. This will be the material that the script will swap to.</p></li><li><p>Add the <code class="literal">Plank</code> script to our <code class="literal">Plank_Wood</code> object. Connect the <span class="strong"><strong>Damaged Material</strong></span> reference to the new material and the <span class="strong"><strong>Plank Renderer</strong></span> reference to the object's <span class="strong"><strong>Mesh Renderer</strong></span> component.</p></li><li><p>As we create different types of planks, we can adjust the <span class="strong"><strong>Total Health</strong></span> value to give them different strengths. A value of <code class="literal">25</code> works pretty well for the wood planks.</p></li><li><p>Next, create an empty <span class="strong"><strong>GameObject</strong></span> and rename it <code class="literal">LevelTracker</code>.</p></li><li><p>Add the <code class="literal">LevelTracker</code> script to the object and it will begin to track the player's score.</p></li><li><p>If you want to see the wood plank in action, position it above the ground and hit the play button. As soon as the game starts, Unity's physics will take over and drop the plank with gravity. If it started out high enough, you will be able to see it switch textures as it loses health.</p></li><li><p>To make the other two <a id="id467" class="indexterm"></a>planks that we need, select the <code class="literal">Plank_Wood</code> object and press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span> twice to duplicate it. Rename one to <code class="literal">Plank_Glass</code> and the other to <code class="literal">Plank_Rubber</code>.</p></li><li><p>Next, create three new materials. One should be purple for the rubber plank, one should use the <code class="literal">plank_glass</code> texture for the glass plank, and the last material should use the <code class="literal">plank_glass_damaged</code> texture for when the glass plank is damaged. Apply the new materials to the proper locations for the new planks.</p></li><li><p>As for the health of the new planks, a value of <code class="literal">15</code> for the glass and <code class="literal">100</code> for the rubber will work well.</p></li><li><p>Finally, turn your three planks into prefabs and use them to build a structure for us to knock down. Feel free to scale them to make different-sized blocks, but leave the x axis alone. Also, all of the blocks should be positioned at zero on the x axis and your structure should be centered around about <code class="literal">30</code> on the z axis.</p><div class="mediaobject"><img src="/graphics/9781849692014/graphics/2014OT_07_02.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec97"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created the building blocks<a id="id468" class="indexterm"></a> we needed for the structures that are going to be knocked down in our game. We used a <span class="strong"><strong>Rigidbody</strong></span> component to tie them into the physics engine. Also, we created a script that keeps track of their health and swaps materials when it drops below half.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec98"></a>Have a go hero â€“ creating a stone block</h3></div></div></div><p>Wood and glass work well as basic blocks. But, if we are going to make harder levels, we need something a little stronger. Try your hand at making a stone block. Create two textures and materials for it to show its pristine and damaged states.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec99"></a>Physics materials</h3></div></div></div><p>Physics materials are special types <a id="id469" class="indexterm"></a>of materials that specifically tell the physics engine how two objects should interact. This does not affect the appearance of an object. It defines the friction and bounciness of a collider. We will use them to give our rubber plank some bounce and the glass plank some slide.</p></div></div>