<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec106"></a>Time for action – controlling the camera</h2></div></div><hr /></div><p>We will only need one, fairly short script to control and manage our camera:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To start and to keep everything organized, create a new empty <span class="strong"><strong>GameObject</strong></span> and name it <code class="literal">CameraRig</code>. Also, to keep it simple, set its position to zero on each axis.</p></li><li><p>Next, create three more <a id="id507" class="indexterm"></a>empty <span class="strong"><strong>GameObject</strong></span> and name them <code class="literal">LeftPoint</code>, <code class="literal">RightPoint</code>, and <code class="literal">TopPoint</code>. Set their <span class="strong"><strong>X</strong></span> axis positions to <code class="literal">5</code>. Position the <code class="literal">LeftPoint</code> to be in front of the slingshot and at <code class="literal">3</code> on the <span class="strong"><strong>Y</strong></span> axis. The <code class="literal">RightPoint</code> needs to be positioned in front of the <code class="literal">pig</code> structure you created. The <code class="literal">TopPoint</code> can be over the slingshot, but needs to set to <code class="literal">8</code> on the <span class="strong"><strong>Y</strong></span> axis. These three points will define the limits of where our camera can move when being dragged and following birds.</p></li><li><p>Make all three points, and the <code class="literal">Main Camera</code> object, children of the <code class="literal">CameraRig</code> object.</p></li><li><p>Now, we create the <code class="literal">CameraControl</code> script. This script will control all of the movement and interaction with the camera.</p></li><li><p>Our variables for this script start with a reference to the slingshot; we need this so we can follow the current bird when it is fired. Next are the references to the points we just created. The next group of variables control how long the camera will sit without input before returning to look at the slingshot and how fast it will return. The <code class="literal">dragScale</code> variable controls how fast the camera actually moves when the player drags their finger across the screen, allowing us to keep the scene moving with the finger. The last group is to control whether the camera can follow the current bird and how fast it can do so.</p><div class="informalexample"><pre class="programlisting">public Slingshot slingshot;

public Transform rightPoint;
public Transform leftPoint;
public Transform topPoint;

public float waitTime = 3f;
private float headBackTime = -1;
private Vector3 waitPosition;
public float headBackDuration = 3f;

public float dragScale = 0.075f;

private bool followBird = false;
private Vector3 followVelocity = Vector3.zero;
public float followSmoothTime = 0.1f;</pre></div></li><li><p>In the <code class="literal">Awake</code> function<a id="id508" class="indexterm"></a>, we first make certain the camera is not following a bird and make it wait before heading to look at the slingshot. This allows us to initially point the camera to the pig fortress when the level starts and move to the slingshot after giving the<a id="id509" class="indexterm"></a> player a chance to see what they are up against.</p><div class="informalexample"><pre class="programlisting">public void Awake() {
  followBird = false;
  StartWait();
}</pre></div></li><li><p>The <code class="literal">StartWait</code> function<a id="id510" class="indexterm"></a> sets the time when it will start to head back to the slingshot and records the position that it is heading back from. This allows us to create a smooth transition.</p><div class="informalexample"><pre class="programlisting">public void StartWait() {
  headBackTime = Time.time + waitTime;
  waitPosition = transform.position;
}</pre></div></li><li><p>Next, we have the <a id="id511" class="indexterm"></a>
<code class="literal">Update</code> function. This one starts by checking whether the slingshot has fired. If it hasn't, it checks to see whether the player has started aiming, signaling that the bird should be followed and zeroing out the velocity if they have. If they have not, the <code class="literal">followBird</code> flag is cleared. Next, the function checks whether it should follow and does so if it should, also calling the <code class="literal">StartWait</code> function in case this is the frame in which the bird is destroyed. If it should not follow the bird, it checks for touch input and drags the camera if it finds any. The wait is again started in case the player removes their finger in this frame. Finally, it checks to see if the slingshot is done firing the current bird and if it is time to head back. Should both be true, the camera moves back to pointing at the slingshot.</p><div class="informalexample"><pre class="programlisting">public void Update() {
  if(!slingshot.didFire) {
    if(slingshot.isAiming) {
      followBird = true;
      followVelocity = Vector3.zero;
    }
    else {
      followBird = false;
    }
  }
  
  if(followBird) {
    FollowBird();
    StartWait();
  }
  else if(Input.touchCount &gt; 0) {
    DragCamera();
    StartWait();
  }

  if(!slingshot.didFire &amp;&amp; headBackTime &lt; Time.time) {
    BackToLeft();
  }
}</pre></div></li><li><p>The <code class="literal">FollowBird</code> function <a id="id512" class="indexterm"></a>starts by making sure there is a bird to follow by checking the <code class="literal">toFireBird</code> variable on the <code class="literal">Slingshot</code> script and stops following if a bird is not found. Should there be a bird, the function then determines a new point to move to that will look directly at the bird. It then uses the <code class="literal">Vector3.SmoothDamp</code> function to smoothly follow the bird. This function works similar to a spring—the farther away it is from its target position, the faster it moves the object. The <code class="literal">followVelocity</code> variable is used to keep it moving smoothly. Finally, it calls another function to limit the camera's position within those bounding points we set up earlier.</p><div class="informalexample"><pre class="programlisting">private void FollowBird() {
  if(slingshot.toFireBird == null) {
    followBird = false;
    return;
  }

  Vector3 targetPoint = slingshot.toFireBird.position;
  targetPoint.x = transform.position.x;

  transform.position = Vector3.SmoothDamp(transform.position, targetPoint, ref followVelocity, followSmoothTime);
  ClampPosition();
}</pre></div></li><li><p>In the <code class="literal">DragCamera</code> function<a id="id513" class="indexterm"></a>, we use the <code class="literal">deltaPosition</code> value of the current touch to determine how far it has moved since the last frame. By scaling this value and subtracting the vector from the camera's position, the function moves the camera as the player drags across the screen. This function also calls upon the function to clamp the camera's position.</p><div class="informalexample"><pre class="programlisting">private void DragCamera() {
  transform.position -= new Vector3(0, 0, Input.GetTouch(0).deltaPosition.x * dragScale);
  ClampPosition();
}</pre></div></li><li><p>The <code class="literal">ClampPosition</code> function<a id="id514" class="indexterm"></a> starts by taking the camera's current position. It then clamps the z position to be between those of the <code class="literal">leftPoint</code> and <code class="literal">rightPoint</code> variables' <code class="literal">z</code> positions. Next, the <code class="literal">y</code> position is clamped between the <code class="literal">leftPoint</code> and <code class="literal">topPoint</code> variables' positions. Finally, the new position is reapplied to the camera's transform.</p><div class="informalexample"><pre class="programlisting">private void ClampPosition() {
  Vector3 clamped = transform.position;
  clamped.z = Mathf.Clamp(clamped.z, leftPoint.position.z, rightPoint.position.z);
  clamped.y = Mathf.Clamp(clamped.y, leftPoint.position.y, topPoint.position.y);
  transform.position = clamped;
}</pre></div></li><li><p>Finally, we have the <code class="literal">BackToLeft</code> function<a id="id515" class="indexterm"></a>. It starts by using the time and our duration variable to determine how much progress in returning to the slingshot the camera will have made. It records the camera's current position and uses <code class="literal">Mathf.SmoothStep</code> on both the z and y axes to find a new position that is the appropriate distance between the <code class="literal">waitPosition</code> variable and the <code class="literal">leftPoint</code> variable. Finally, the new position is applied.</p><div class="informalexample"><pre class="programlisting">private void BackToLeft() {
  float progress = (Time.time – headBackTime) / headBackDuration;
  Vector3 newPosition = transform.position;
  newPosition.z = Mathf.SmoothStep(waitPosition.z, leftPoint.position.z, progress);
  newPosition.y = Mathf.SmoothStep(waitPosition.y, leftPoint.position.y, progress);
  transform.position = newPosition;
}</pre></div></li><li><p>Next, return to Unity and add the new script to the <code class="literal">Main Camera</code> object. Connect the references to the slingshot and each of the points to finish it off.</p></li><li><p>Position the camera to point at your pig fortress and turn the whole rig into a prefab.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec108"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>We created the camera rig that will let the player watch all of the action as they play the game. The camera will now follow the birds as they are fired from the slingshot and can now be dragged by the player. By keying off the positions of a few objects, this movement is limited to keep the player from seeing things we don't want them to. If the camera is left idle long enough, it will also return to look at the slingshot.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec109"></a>Have a go hero – more levels</h3></div></div></div><p>Now that we have all of the pieces needed to make a complete level, we need some more levels. We need at least two more levels. You can use the blocks and pigs to create any level you might want. It is a good idea to keep the pig structures centered at about <code class="literal">30</code> on the <span class="strong"><strong>Z</strong></span> axis. Also, think about the difficulty of the level while making it, so that you can end up with an easy, medium, and hard level.</p></div></div>