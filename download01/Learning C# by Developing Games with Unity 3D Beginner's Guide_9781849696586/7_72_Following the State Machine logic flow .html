<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec73"></a>Following the State Machine logic flow </h2></div></div><hr /></div><p>The heart of <a id="id221" class="indexterm"></a>the State Machine is the<a id="id222" class="indexterm"></a> <code class="literal">StateManager</code> script. This is a Unity class, so it inherits from the<a id="id223" class="indexterm"></a> <code class="literal">MonoBehaviour</code> class. The script is attached to a GameObject to become a Component. The following are the three core<a id="id224" class="indexterm"></a> features that the <code class="literal">StateManager</code> script handles:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Delegating game control to a State</p></li><li style="list-style-type: disc"><p>Switching to another State when called to do so</p></li><li style="list-style-type: disc"><p>Keeping track of the active State</p></li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec104"></a>Delegating game control to a State</h3></div></div></div><p>The <code class="literal">StateManager</code> script is <a id="id225" class="indexterm"></a>like any other Unity script. It is<a id="id226" class="indexterm"></a> attached to a GameObject and becomes a <a id="id227" class="indexterm"></a>Component object. The <code class="literal">StateManager</code> script uses the <code class="literal">Update()</code> method to pass the game control to the active State as shown in the following diagram:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"></a>Note</h3><p>The following diagram does not show complete code statements.</p></div><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_07_02.jpg" /></div><p>The game control code that's usually in an <code class="literal">Update()</code> method is instead delegated to the <code class="literal">StateUpdate()</code> method<a id="id228" class="indexterm"></a> on the <code class="literal">activeState</code> object. So every time Unity calls the <code class="literal">Update()</code> method on the <code class="literal">StateManager</code> Component, the <code class="literal">StateUpdate()</code> method is called on the currently active State object.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note37"></a>Note</h3><p>Please understand this principle of delegating, or transferring, responsibility from the <code class="literal">Update()</code> method of the <code class="literal">StateManager</code> script to the <code class="literal">StateUpdate()</code> method on the current active State. Believe it or not, that little bit of code is the primary driver of the State Machine's operation.</p></div><p>No matter how many States you may use to control your game, always remember the following points:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Every State will have the <code class="literal">StateUpdate()</code> method, guaranteed</p></li><li style="list-style-type: disc"><p>The code block logic will be different for each <code class="literal">StateUpdate()</code> method on every State, depending on what you want each State to accomplish</p></li><li style="list-style-type: disc"><p>Only one State is active at any time</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec105"></a>Switching to another State when called to do so</h3></div></div></div><p>Each State determines <a id="id229" class="indexterm"></a>why and when to switch to another State. You could have an almost unlimited number of reasons to switch to another State, such as losing the game, winning the game, touching some special GameObject, solving a puzzle, or the user pressing a button. No matter what the reason is, it's the code in the active State that will trigger the switch to another State.</p><p>The <code class="literal">SwitchState()</code> method on the <code class="literal">StateManager</code> script is called to accomplish this.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note38"></a>Note</h3><p>The following diagram does not show complete code statements.</p></div><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_07_03.jpg" /></div><p>When the active State has been determined, it is time to switch to another State; the <code class="literal">SwitchState()</code> method on the <code class="literal">StateManager</code> is called. <code class="literal">SwitchState()</code> takes an argument of the new State, which will become active next.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec106"></a>Keeping track of the active State</h3></div></div></div><p>This newly created <a id="id230" class="indexterm"></a>State is then assigned to the <code class="literal">activeState</code> variable. Why?</p><p>In order for a State to control a game, <code class="literal">StateManager</code> needs to know about it. A reference of the active State<span class="strong"><strong> </strong></span>object is stored in the <code class="literal">activeState</code> variable.</p><p>So when Unity calls <code class="literal">Update()</code> on the <code class="literal">StateManager</code> script, control is passed to the newly created State that's stored in <code class="literal">activeState</code> by calling its <code class="literal">StateUpdate()</code> method. The State Machine cycle of changing to a new State is complete.</p><p>Review the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>The active State determines when it's time to switch to a new State.</p></li><li><p>A new State object is created and passed to the <code class="literal">StateManager</code> script using the <code class="literal">SwitchState()</code> method.</p></li><li><p>This new State object is assigned to the <code class="literal">activeSt</code>
<code class="literal">ate</code> variable.</p></li><li><p>When <code class="literal">Update()</code> is called on <code class="literal">StateManager</code>, the <code class="literal">Update()</code> method delegates control to the <code class="literal">StateUpdate()</code> method on the new State.</p></li><li><p>Now go <a id="id231" class="indexterm"></a>back to step 1.</p></li></ol></div></div></div>