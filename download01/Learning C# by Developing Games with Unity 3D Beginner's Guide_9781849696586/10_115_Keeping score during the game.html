<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec113"></a>Keeping score during the game</h2></div></div><hr /></div><p>We have a simple system that increases <span class="strong"><strong>Score</strong></span> of <span class="strong"><strong>Player</strong></span> as it touches <span class="strong"><strong>Good Orbs</strong></span> and takes <span class="strong"><strong>Lives</strong></span> from <span class="strong"><strong>Player</strong></span> as it crashes into <span class="strong"><strong>Bad Orbs</strong></span>. When the <span class="strong"><strong>Score</strong></span> reaches a set number, we win. When <span class="strong"><strong>Player Lives</strong></span> decreases to zero, we lose.</p><p>When we lose, we have the option to retry the <span class="strong"><strong>Scene</strong></span>. To do this, the system needs to remember what the <span class="strong"><strong>Score</strong></span> and <span class="strong"><strong>Player Lives</strong></span> were when first entering the <span class="strong"><strong>Scene</strong></span> so they can be reset back to these values.</p><p>The following two <a id="id447" class="indexterm"></a>screenshots show the code for initializing the score:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_13.jpg" /></div><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_14.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec159"></a>Initializing the scoring system</h3></div></div></div><p>The following steps <a id="id448" class="indexterm"></a>occur while the game is in the setup State of the game.</p><p>An analysis of the code shown in the preceding two screenshots is as follows:</p><p>In the <code class="literal">GameData</code> file:</p><p>Step 1:</p><p>From <a class="link" href="#" linkend="ch09">Chapter 9</a>, <span class="emphasis"><em>Start Building a Game and Get the Basic Structure Running</em></span>, we already have the variables for keeping track of the <span class="strong"><strong>Score</strong></span> and <span class="strong"><strong>Player Lives</strong></span> during gameplay:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">playerLives</code> variable on line 16</p></li><li style="list-style-type: disc"><p>The <code class="literal">score</code> variable on line 18</p><p>We need two more variables to remember the values stored in <code class="literal">score</code> and <code class="literal">playerLives</code>:</p><p>Line 12: <code class="literal">private int playerLivesSelected = 2;</code>
</p></li><li style="list-style-type: disc"><p>The <code class="literal">playerLivesSelected</code> variable stores the <span class="strong"><strong>Player Lives</strong></span> selected in <code class="literal">SetupState</code>
</p></li><li style="list-style-type: disc"><p>This resets <code class="literal">playerLives</code> back to the value it was before a <span class="strong"><strong>Scene</strong></span> is lost, or to reset <code class="literal">playerLives</code> before <span class="strong"><strong>Scene2</strong></span> is started</p></li></ul></div><p>Line 13: <code class="literal">private int sceneBeginningScore;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">sceneBeginningScore</code> variable stores the <span class="strong"><strong>Score</strong></span> before a <span class="strong"><strong>Scene</strong></span> is started</p></li><li style="list-style-type: disc"><p>This is used to reset <code class="literal">score</code> back to the value it was before a <span class="strong"><strong>Scene</strong></span> GameObject was lost, or to remember the <span class="strong"><strong>Score</strong></span> earned in <span class="strong"><strong>Scene1</strong></span> before starting <span class="strong"><strong>Scene2</strong></span>
</p></li></ul></div><p>Step 2:</p><p>Line 22: <code class="literal">playerLives = playerLivesSelected;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>When the game is started, the default value of <code class="literal">2</code> is assigned to <code class="literal">playerLives</code>
</p></li></ul></div><p>In the <code class="literal">SetupState</code> file:</p><p>Step 3:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The user has the option to select more <span class="strong"><strong>Player Lives</strong></span>
</p></li><li style="list-style-type: disc"><p>Dot Syntax is used to call the <code class="literal">SetPlayer()</code> method in <code class="literal">GameData</code>
</p></li><li style="list-style-type: disc"><p>The <code class="literal">SetPlayer()</code> method<a id="id449" class="indexterm"></a> takes an argument of <code class="literal">5</code>, <code class="literal">10,</code> or <code class="literal">1000</code> to pass to <code class="literal">GameData</code> in line 31</p></li></ul></div><p>In the <code class="literal">GameData</code> file:</p><p>Step 4: </p><p>Line 31: <code class="literal">public void SetPlayerLives(int livesSelected)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The value received is assigned to the parameter variable <code class="literal">livesSelected</code>
</p></li></ul></div><p>Line 33: <code class="literal">playerLivesSelected = livesSelected;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The value is assigned to <code class="literal">playerLivesSelected</code>
</p></li><li style="list-style-type: disc"><p>The value now in <code class="literal">playerLivesSelected</code> is remembered for the whole game</p></li></ul></div><p>Line 34: <code class="literal">playerLives = livesSelected;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">livesSelected</code> variable<a id="id450" class="indexterm"></a> is also assigned to <code class="literal">playerLives</code> to be displayed on screen</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec160"></a>Keeping score in the Scene1 play State</h3></div></div></div><p>The user has now switched from the setup State to playing the game in <span class="strong"><strong>Scene1</strong></span>.</p><p>There are two possible play <a id="id451" class="indexterm"></a>States in <span class="strong"><strong>Scene1</strong></span>. For the scoring<a id="id452" class="indexterm"></a> system, they both have the exact same code in their <code class="literal">StateUpdate()</code> methods, so I will only explain the code in <code class="literal">PlayStateScene1_1</code>.</p><p>The following screenshot shows the code for checking the <span class="strong"><strong>Score</strong></span> to see if we win, and checking <span class="strong"><strong>Player Lives</strong></span> to see if we lose:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_15.jpg" /></div><p>An analysis of the code shown in the preceding screenshot is given in the following subsections:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl3sec11"></a>Losing the game in Scene1</h4></div></div></div><p>In <code class="literal">PlayStateS</code>
<code class="literal">cene1_1</code> file:</p><p>Step 5:</p><p>This step is<a id="id453" class="indexterm"></a> executed if we lost in <span class="strong"><strong>Scene1</strong></span>.</p><p>Line 32: <code class="literal">if(manager.gameDataRef.playerLives &lt;= 0)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This <code class="literal">if</code> statement <a id="id454" class="indexterm"></a>checks to see if <code class="literal">playerLives</code> has decreased to zero</p></li></ul></div><p>Line 34: <code class="literal">manager.SwitchState(new LostStateScene1(manager));</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Since we lost, the State Machine switches to <code class="literal">LostStateScene1</code>
</p></li></ul></div><p>Line 36: <code class="literal">player.rigidbody.isKinematic = true;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="strong"><strong>Is Kinematic</strong></span> option is checked to stop <span class="strong"><strong>Player</strong></span> from being affected by physics</p></li></ul></div><p>Line 37: <code class="literal">player.transform.position = new Vector3(50, .5f, 40);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="strong"><strong>Player</strong></span> GameObject is repositioned back to the beginning position for <span class="strong"><strong>Scene1</strong></span> to be replayed</p></li></ul></div><p>Line 35: <code class="literal">manager.gameDataRef.ResetPlayer();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>To replay <span class="strong"><strong>Scene1</strong></span>, the <code class="literal">score</code> and <code class="literal">playerLives</code> variables need to be reset to the values they<a id="id455" class="indexterm"></a> were when first starting <span class="strong"><strong>Scene1</strong></span>
</p></li><li style="list-style-type: disc"><p>The <code class="literal">ResetPlayer()</code> method<a id="id456" class="indexterm"></a> in <code class="literal">GameData</code> is called in line 25</p></li></ul></div><p>In <code class="literal">GameData</code> file:<a id="id457" class="indexterm"></a>
</p><p>Step 6:</p><p>Line 25: <code class="literal">public void ResetPlayer()</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This resets the <code class="literal">score</code> and <code class="literal">playerLives</code> values</p></li></ul></div><p>Line 27: <code class="literal">playerLives = playerLivesSelected;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">playerLivesSelected</code> is restoring <code class="literal">playerLives</code>
</p></li></ul></div><p>Live 28: <code class="literal">score = sceneBeginningScore;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">SceneBeginningScore</code> had a value of 0 (zero) when <span class="strong"><strong>Scene1</strong></span> started</p></li><li style="list-style-type: disc"><p>This is resetting <code class="literal">score</code> back to 0</p></li></ul></div><p>The scoring system<a id="id458" class="indexterm"></a> has been reset and <span class="strong"><strong>Player</strong></span> repositioned, ready to replay <span class="strong"><strong>Scene1</strong></span>
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch10lvl3sec12"></a>Winning the level in Scene1</h4></div></div></div><p>In <code class="literal">PlayStateScene1_1</code> file:</p><p>Step 7:</p><p>This step is<a id="id459" class="indexterm"></a> executed if we win in <span class="strong"><strong>Scene1</strong></span>.</p><p>Line 40: <code class="literal">if(manager.gameDataRef.score &gt;= 2)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This if statement<a id="id460" class="indexterm"></a> checks to see if <code class="literal">score</code> has increased to 2</p></li></ul></div><p>Line 43: <code class="literal">player.rigidbody.isKinematic = true;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="strong"><strong>Is Kinematic</strong></span> option is checked to stop <span class="strong"><strong>Player</strong></span> from being affected by physics</p></li></ul></div><p>Line 44: <code class="literal">player.transform.position = new Vector3(50, .5f, 40);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The<span class="strong"><strong> Player</strong></span> GameObject is positioned for <span class="strong"><strong>Scene2</strong></span>
</p></li></ul></div><p>Line 42: <code class="literal">manager.SwitchState(new WonStateScene1(manager));</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Since we <a id="id461" class="indexterm"></a>won, the State Machine switches to <code class="literal">WonStateScene1:</code>
</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_16.jpg" /></div></li></ul></div><p>In <code class="literal">WonStateScene1</code> file:</p><p>Step 8:</p><p>Line 16: <code class="literal">manager.gameDataRef.SetScore();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This is in<a id="id462" class="indexterm"></a> the <span class="strong"><strong>constructor</strong></span>, so as soon as the State Machine enters <code class="literal">WonStateScene1</code>, the <code class="literal">SetScore()</code> method in <code class="literal">GameData</code> is called</p></li></ul></div><p>In <code class="literal">GameData</code> file:</p><p>Step 9:</p><p>Line 37: <code class="literal">public void SetScore()</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This method is called from <code class="literal">WonStateScene1</code> line16</p></li></ul></div><p>Line 39: <code class="literal">sceneBeginningScore = score;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">score</code> variable has the value earned in <span class="strong"><strong>Scene1 </strong></span>and is the starting point for <span class="strong"><strong>Scene2</strong></span>
</p></li></ul></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec161"></a>Determining how to win or lose</h3></div></div></div><p>We still need to discover the code that will increase the <span class="strong"><strong>Score</strong></span>, or take <span class="strong"><strong>Player Lives</strong></span>.</p><p>
<span class="strong"><strong>Player</strong></span> will be interacting with two simple GameObjects made using Unity's primitives, two flattened <span class="strong"><strong>Cylinders</strong></span> and two <span class="strong"><strong>Spheres</strong></span>.</p><p>Two versions<a id="id463" class="indexterm"></a> are created, a bad GameObject with a red glowing material, and a good GameObject with a green glowing material.</p></div></div>