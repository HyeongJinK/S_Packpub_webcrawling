<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec92"></a>Time for action â€“ adding the Awake method to StateManager</h2></div></div><hr /></div><p>In the code block of the <code class="literal">Awake()</code> method, we're going to check if the <span class="strong"><strong>GameManager</strong></span> GameObject<a id="id337" class="indexterm"></a> already exists. If it doesn't, we'll save it to a variable and tell Unity not to destroy it when any other <span class="strong"><strong>Scene</strong></span> level is loaded. If it does already exist, we'll tell Unity to destroy any new <span class="strong"><strong>GameManager</strong></span> <a id="id338" class="indexterm"></a>GameObjects created.</p><p>Insert the new code as shown in the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a new <code class="literal">static</code> variable on line 9.</p></li><li><p>Add the <code class="literal">Awake()</code> method at lines 11 through 22 as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_08_19.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec130"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>An analysis of the code shown in the preceding screenshot is as follows:On the  <code class="literal">StateManager</code> class</p><p>Line 9: <code class="literal">private static StateManager instanceRef;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This variable named <code class="literal">instanceRef</code> stores a <code class="literal">StateManager</code> type which is a reference to the <code class="literal">StateManager</code> object in the memory</p></li><li style="list-style-type: disc"><p>This is also a <code class="literal">static</code> variable</p></li><li style="list-style-type: disc"><p>This means, that in this example, each instance of the <code class="literal">StateManager</code> Component object that's created will share and see the same value</p></li><li style="list-style-type: disc"><p>It is <code class="literal">private</code> so<a id="id339" class="indexterm"></a> it can't be changed from outside the <code class="literal">StateManager</code> class</p></li></ul></div><p>Line 11: <code class="literal">void Awake()</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Unity<a id="id340" class="indexterm"></a> calls the <code class="literal">Awake()</code> method once after all objects in the game are loaded into memory, and before the game actually plays</p></li></ul></div><p>Line 13: <code class="literal">if(instanceRef == null)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This <code class="literal">if</code> statement is checking whether the <code class="literal">instanceRef</code> already stores a reference to a <code class="literal">StateManager</code> Component object in the memory</p></li><li style="list-style-type: disc"><p>If the value is equal to <code class="literal">null</code>, meaning no reference is stored, the <code class="literal">if</code> code block is executed</p></li><li style="list-style-type: disc"><p>If the value is not <code class="literal">null</code>, meaning there is already a reference to a <code class="literal">StateManager</code> Component in the memory, the <code class="literal">else</code> code block is executed</p></li></ul></div><p>Line 15: <code class="literal">instanceRef = this;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Since there's no <code class="literal">StateManager</code> Component reference stored, <code class="literal">this</code>, which stores a reference to this <code class="literal">StateManager</code>, is assigned to <code class="literal">instanceRef</code>
</p></li><li style="list-style-type: disc"><p>This will be the case when the game has just started and the <code class="literal">StateManager</code> Component is created for the first time</p></li></ul></div><p>Line 16: <code class="literal">DontDestroyOnLoad(gameObject);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This method tells Unity to not destroy the <span class="strong"><strong>GameManager</strong></span> GameObject, which the <code class="literal">StateManager</code> Component is attached to when changing to another <span class="strong"><strong>Scene</strong></span> level</p></li></ul></div><p>Line 20: <code class="literal">DestroyImmediate(gameObject);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>When <span class="strong"><strong>BeginningScene</strong></span> is reloaded, another <span class="strong"><strong>GameManager</strong></span> GameObject is created</p></li><li style="list-style-type: disc"><p>Since <code class="literal">instanceRef</code> is not null, this second instance needs to be destroyed so that only the original <span class="strong"><strong>GameManager</strong></span> exists</p></li><li style="list-style-type: disc"><p>The <code class="literal">DestroyImmediate(gameObject)</code> method destroys the second copy that was just created</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec131"></a>Changing the Scenes</h3></div></div></div><p>Now let's write<a id="id341" class="indexterm"></a> the code that will change from <span class="strong"><strong>BeginningScene</strong></span> to <span class="strong"><strong>Scene1</strong></span>, and back to <span class="strong"><strong>BeginningScene</strong></span>.</p></div></div>