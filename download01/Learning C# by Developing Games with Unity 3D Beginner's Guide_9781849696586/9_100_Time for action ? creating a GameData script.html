<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec99"></a>Time for action – creating a GameData script</h2></div></div><hr /></div><p>We could create a regular C# class for this, but we want to be able to assign some values in Unity's <span class="strong"><strong>Inspector</strong></span>, so we'll <a id="id383" class="indexterm"></a>create a Unity C# Script instead. There are times when you will want to use the <span class="strong"><strong>Inspector</strong></span>, and other times, when assignin<a id="id384" class="indexterm"></a>g values in code is better.</p><p>To start, we are going to create three variables to store the images used for the three splash screens in <code class="literal">BeginState</code>, <code class="literal">WonStates</code>, and <code class="literal">LostStates</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note61"></a>Note</h3><p>By now, you should know how to create a C# Script in Unity or in MonoDevelop. From now on, you should simply create the script using whichever is most convenient at the time.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <code class="literal">Scripts</code> folder, create a new <span class="strong"><strong>C# Script</strong></span> named <code class="literal">GameData</code>, containing the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class GameData : MonoBehaviour
{
  public Texture2D beginStateSplash;
  public Texture2D lostStateSplash;
  public Texture2D wonStateSplash;
    
  void Start ()
  {
  }
  
  void Update ()
  {
  }
}</pre></div></li><li><p>Attach this <code class="literal">GameData</code> script to the <span class="strong"><strong>GameManager</strong></span> to make it a Component. All the data in all the variables will also persist through Scene changes.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec143"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>Three variables are created to store the images for the splash screens. The variables store values of type <code class="literal">Texture2D</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl4sec06"></a>Understanding images as textures in Unity</h4></div></div></div><p>You have to understand that Unity <a id="id385" class="indexterm"></a>treats images as textures. Have a look at <span class="strong"><strong>Unity Manual</strong></span> | <span class="strong"><strong>User Guide</strong></span> | <span class="strong"><strong>Asset Import and Creation</strong></span> | <span class="strong"><strong>Importing Assets</strong></span>. Here's a quote:</p><div class="blockquote"><blockquote class="blockquote"><p>
<span class="strong"><strong>Textures</strong></span>
</p><p>Unity supports all image formats. Even when working with layered Photoshop files, they are imported without disturbing the Photoshop format. This allows you to work with a single texture file for a very care-free and streamlined experience.</p></blockquote></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl4sec07"></a>Using splash screens between game levels</h4></div></div></div><p>In the <span class="strong"><strong>Unity Manual</strong></span>, there's a description on how to make a splash screen. Look in <span class="strong"><strong>Unity Manual</strong></span> | <span class="strong"><strong>FAQ</strong></span> | <span class="strong"><strong>Graphics Questions</strong></span> | <span class="strong"><strong>How do I make a Splash Screen?</strong></span>
</p><p>However, there is an <a id="id386" class="indexterm"></a>easier way by using the <span class="strong"><strong>GUI</strong></span> system. Since an image is a texture, we'll just display our images using the <code class="literal">GUI.DrawTexture()</code> method. This draws a texture in a rectangle. We will simply make the rectangle fullscreen.</p><p>In the previous code, the three variables will each store a <code class="literal">Texture2D</code>, an image. The images are assigned to these variables by dragging the images into the <span class="strong"><strong>Inspector</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note62"></a>Note</h3><p>This is an example of why assigning variable values in the <span class="strong"><strong>Inspector</strong></span> is preferred over assigning the images using code. If you ever want to change the image, it's simple in the <span class="strong"><strong>Inspector</strong></span>, as opposed to editing code.</p></div><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_09_04.jpg" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec144"></a>Displaying the splash screens</h3></div></div></div><p>The first thing to do is <a id="id387" class="indexterm"></a>import the three images you have. If you don't have anything specific already, pictures of friends or family will do nicely.</p><p>Once you have them imported, just drag them to the three variable properties in the <span class="strong"><strong>Inspector</strong></span>. We have these texture images for our splash screens in the <code class="literal">GameData</code> Component, how do we get them to be displayed in the States we desire? By using Dot Syntax, of course. We could have each State that needs to display a splash screen, call <code class="literal">GetComponent()</code> to get the <code class="literal">GameData</code> Component.</p><p>That wouldn't be too bad with just five States needing splash screens. However, the <code class="literal">GameData</code> Component is for storing many types of data, not just splash screen images. This means that <code class="literal">GameData</code> will be accessed often for data, and calling <code class="literal">GetComponent()</code> repeatedly will slow down a game.</p><p>There is a more efficient <a id="id388" class="indexterm"></a>way. Just call <code class="literal">GetComponent()</code> one time and store the <code class="literal">GameData</code> object reference that's retrieved into a variable. In fact, this is exactly what Unity suggests you do. Here's a quote from <span class="strong"><strong>Scripting Reference</strong></span> | <span class="strong"><strong>Overview: Performance Optimization</strong></span>:</p><div class="blockquote"><blockquote class="blockquote"><p>3. Cache component lookups</p><p>Another optimization is caching of components. This optimization unfortunately requires a bit of coding effort and is not always worth it. But if your script is really used a lot and you need to get the last bit of performance out of it, this can be a very good optimization.</p><p>Whenever you access a component through GetComponent or an accessor variable, Unity has to find the right component from the game object. This time can easily be saved by caching a reference to the component in a private variable.</p></blockquote></div><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_09_05.jpg" /></div><p>Since every <a id="id389" class="indexterm"></a>State already contains a reference to <code class="literal">StateManager</code>, we will have <code class="literal">StateManager</code> call <code class="literal">GetComponent()</code> and store the <code class="literal">GameData</code> reference in a variable named <code class="literal">gameDataRef</code>. Let us have a look a the code in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_09_06.jpg" /></div><p>An analysis of the <a id="id390" class="indexterm"></a>preceding code screenshot is given below:</p><p>In <code class="literal">StateManager</code>:</p><p>Line 10: <code class="literal">public GameData gameDataRef;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">gameDataRef</code> object reference stores a reference to a <code class="literal">GameData</code> Component object</p></li><li style="list-style-type: disc"><p>Therefore the type is <code class="literal">GameData</code>
</p></li><li style="list-style-type: disc"><p>It is also <code class="literal">public</code> since other classes will be accessing this variable</p></li></ul></div><p>Line 30: <code class="literal">gameDataRef = GetComponent&lt;GameData&gt;();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In the <code class="literal">Start()</code> method, we call <code class="literal">GetComponent()</code> to get a reference to the <code class="literal">GameData</code> Component object</p></li><li style="list-style-type: disc"><p>The reference is assigned to the <code class="literal">gameDataRef</code> variable</p></li></ul></div><p>Line 9: <code class="literal">[HideInInspector]</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This is a Unity attribute that will prevent a <code class="literal">public</code> variable from showing in the <span class="strong"><strong>Inspector</strong></span>
</p></li><li style="list-style-type: disc"><p>Since we want the <code class="literal">gameDataRef</code> variable to only store a reference to <code class="literal">GameData</code>, there's no reason to allow it to be changed in the <span class="strong"><strong>Inspector</strong></span>, so <code class="literal">HideInInspector</code> prevents the variable from showing</p></li></ul></div><p>Here's the code in <code class="literal">BeginState</code> that gets the <code class="literal">Texture2D</code> image from <code class="literal">GameData</code>, then displays it on screen. It's just one line of code. I have it on three lines to fit the page:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_09_07.jpg" /></div><p>In <code class="literal">BeginState</code>:</p><p>Line 19: Code removed.</p><p>Line 23: The <code class="literal">GUI.DrawTexture</code> method.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">GUI.DrawTexture()</code> method draws a<a id="id391" class="indexterm"></a> <code class="literal">Texture2D</code> in a rectangle that is the size of the game screen</p></li><li style="list-style-type: disc"><p>The <code class="literal">manager.gameDataRef.beginStateSplash</code> statement is the Dot Syntax used to retrieve the image stored in the <code class="literal">GameData</code> Component</p></li><li style="list-style-type: disc"><p>The <code class="literal">manager</code> object reference stores a reference to the <code class="literal">StateManager</code> Component</p></li><li style="list-style-type: disc"><p>The <code class="literal">gameDataRef</code> variable in <code class="literal">StateManager</code> stores the reference to the <code class="literal">GameData</code> Component</p></li><li style="list-style-type: disc"><p>The <code class="literal">beginStateSplash</code> variable in <code class="literal">GameData</code> stores the <code class="literal">Texture2D</code> image</p></li><li style="list-style-type: disc"><p>This is a direct retrieval of the image since there was no need to call <code class="literal">GetComponent()</code>
</p></li></ul></div><p>Line 27: The <code class="literal">if</code> statement.</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This <code class="literal">if</code> statement is checking if a GUI button is clicked or if any keyboard key is pressed</p></li><li style="list-style-type: disc"><p>If either one happens, then <code class="literal">SwitchState()</code> is called to switch to <code class="literal">SetupState</code>
</p></li></ul></div><p>Here is the result when you click on <span class="strong"><strong>Play</strong></span>, a fullscreen splash screen with a GUI button:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_09_08.jpg" /></div><p>For our little game demonstration, the <code class="literal">BeginState</code> code is complete. There's not much to it, a little State Machine code, one line of code to display the splash screen, and a line of code to detect when to switch to <code class="literal">SetupState</code>.</p><p>The following<a id="id392" class="indexterm"></a> code is the complete code of <code class="literal">BeginState</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using Assets.Code.Interfaces;

namespace Assets.Code.States
{
  public class BeginState : IStateBase
  {
    private StateManager manager;
    
    public BeginState (StateManager managerRef)
    {
      manager = managerRef;
      if(Application.loadedLevelName != "Scene0")
        Application.LoadLevel("Scene0");
    }
    
    public void StateUpdate ()
    {
    }
    
    public void ShowIt ()
    {
      GUI.DrawTexture(new Rect(0, 0, 
        Screen.width, Screen.height), 
        manager.gameDataRef.beginStateSplash, 
        ScaleMode.StretchToFill);
      
      if (GUI.Button(new Rect(10, 10, 250, 60), 
        "Press Here or Any Key to Continue") || 
          Input.anyKeyDown)
      {
        manager.SwitchState (new SetupState (manager));
      }
    }
  }
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec145"></a>Have a go hero – adjusting the button size and placement</h3></div></div></div><p>You may find that <a id="id393" class="indexterm"></a>the button size and placement isn't very good for the image you're using for the splashscreen. Try changing the button code to place it on different areas of the screen. </p></div></div>