<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec89"></a>Time for action – creating a timer in BeginState</h2></div></div><hr /></div><p>I've modified <code class="literal">BeginState</code>
<a id="id322" class="indexterm"></a> quite a bit just for the timer. There are now three examples of ways to switch to <code class="literal">PlayState</code>. Plus, there's a timer countdown displayed in the upper right corner. I also put code that I had to write more than once into a new <code class="literal">Switch()</code> method.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Edit <code class="literal">BeginState</code> as shown in the following screenshot.</p></li><li><p>Save and play in Unity.</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_08_17.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec126"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>I'm not going<a id="id323" class="indexterm"></a> to walk you through the State switching code, I already did that previously.</p><p>An analysis of the code shown in the preceding screenshot is as follows: On the <code class="literal">BeginState </code> class</p><p>For lines 9, 10, and 11:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Three member variables are declared for use in the countdown timer</p></li><li style="list-style-type: disc"><p>These will be explained later when they are used in code</p></li><li style="list-style-type: disc"><p>The reason they are declared here as member variables is that they need to be used in more than one method</p></li><li style="list-style-type: disc"><p>Remember<a id="id324" class="indexterm"></a> the variable scope, variables are only visible within the code block they reside in</p></li></ul></div><p>Line 16: <code class="literal">futureTime = screenDuration + Time.realtimeSinceStartup;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">Time</code> class is a Unity class</p></li><li style="list-style-type: disc"><p>The Dot Syntax is used to access the value stored in the variable <code class="literal">realtimeSinceStartup</code>
</p></li><li style="list-style-type: disc"><p>This variable is constantly updated with the amount of seconds the game has been running</p></li><li style="list-style-type: disc"><p>It stores a <code class="literal">float</code> type of value (decimal number)</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note53"></a>Note</h3><p>The <span class="strong"><strong>Scripting Reference</strong></span> has a good description of <code class="literal">realtimeSinceStartup</code>, which is exactly the reason we are using it.</p></div></li><li style="list-style-type: disc"><p>The current elapsed time is retrieved from <code class="literal">realtimeSinceStartup</code> and is added with the value in the <code class="literal">screenDuration</code> variable<a id="id325" class="indexterm"></a>
</p></li><li style="list-style-type: disc"><p>The <code class="literal">screenDuration</code> variable was declared on line 11 with a value of 8 seconds, which is the length of time <code class="literal">BeginState</code> will be active before switching to <code class="literal">PlayState</code>
</p></li><li style="list-style-type: disc"><p>The result of the addition is assigned to the variable <code class="literal">futureTime</code>
</p></li><li style="list-style-type: disc"><p>Adding 8 seconds to the current elapsed time means I've set a time of 8 seconds into the future</p></li><li style="list-style-type: disc"><p>The <code class="literal">futureTime</code> variable was declared as a <code class="literal">float</code> type on line 9</p></li></ul></div><p>Line 17: <code class="literal">Time.timeScale = 0;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Assigning <code class="literal">0</code> to the <code class="literal">timeScale</code> variable causes time in the game to standstill, thus pausing the game</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note54"></a>Note</h3><p>Both the lines 16 and 17 are executed in the <code class="literal">BeginState</code> constructor because it's only called once each time an instance object of <code class="literal">BeginState</code> is created. We want to pause the game at the instant <code class="literal">BeginState</code> is created. We also want to set the timer as well.</p></div></li></ul></div><p>Line 22: <code class="literal">float rightNow = Time.realtimeSinceStartup;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The variable <code class="literal">rightNow</code> is declared and assigned the current elapsed time</p></li><li style="list-style-type: disc"><p>So we have <code class="literal">futureTime</code> with a value of 8 seconds into the future, and <code class="literal">rightNow</code>
<a id="id326" class="indexterm"></a> with a value of the actual seconds right now, which is updated constantly</p></li><li style="list-style-type: disc"><p>The value is updated constantly because the line of code is in the <code class="literal">StateUpdate()</code> method which is called constantly</p></li></ul></div><p>Line 23: <code class="literal">countDown = (int)futureTime – (int)rightNow;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The difference is stored in the variable <code class="literal">countDown</code> which was declared on line 10</p></li><li style="list-style-type: disc"><p>Since <code class="literal">rightNow</code> is constantly updated, so in 8 seconds the values in <code class="literal">futureTime</code> and <code class="literal">rightNow</code> will be equal to each other</p></li><li style="list-style-type: disc"><p>Therefore, the value in <code class="literal">countdown</code> starts at 8 and decreases to 0, in 8 seconds</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note55"></a>Note</h3><p>Notice the <code class="literal">(int)</code> in front of each variable. The two variables are of type <code class="literal">float</code>, while countdown is of type <code class="literal">int</code>. I want it to be of type <code class="literal">int</code> when used later in line 38. The <code class="literal">(int)</code> type takes the <code class="literal">float</code> value, strips off the decimal part of the number, and leaves just an integer. A <code class="literal">float</code> is being cast (changed) to an <code class="literal">int</code>.</p></div></li></ul></div><p>Line 25: <code class="literal">if(Input.GetKeyUp(KeyCode.Space) || countDown &lt;= 0)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This line was modified to check two conditions using an <code class="literal">OR</code> operator</p></li><li style="list-style-type: disc"><p>When <code class="literal">countDown</code> reaches 0, this condition becomes true</p></li><li style="list-style-type: disc"><p>The code block is executed to switch to the <code class="literal">PlayState</code>
</p></li></ul></div><p>Line 27: <code class="literal">Switch();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The code that used to be here was moved to the new <code class="literal">Switch()</code> method on line 41</p></li><li style="list-style-type: disc"><p>This line calls the <code class="literal">switch()</code> method</p></li><li style="list-style-type: disc"><p>The code flow now jumps to line 43</p></li></ul></div><p>Line 43:: <code class="literal">Time.timeScale = 1;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This line assigns the value <code class="literal">1</code> to <code class="literal">timeScale</code>
</p></li><li style="list-style-type: disc"><p>Now the time in the game is back to normal</p></li><li style="list-style-type: disc"><p>Remember, we had set it to <code class="literal">0</code> on line 17</p></li></ul></div><p>Line 44: <code class="literal">manager.SwitchState (new PlayState (manager));</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This is the same switching code we always had to switch to <code class="literal">PlayState</code>, it's just in this <a id="id327" class="indexterm"></a>
<code class="literal">Switch()</code> method now</p></li><li style="list-style-type: disc"><p>Code flow now returns to line 27 where <code class="literal">Switch()</code> was called</p></li></ul></div><p>Line 27: <code class="literal">}</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The code block is finished</p></li></ul></div><p>The following<a id="id328" class="indexterm"></a> is the code flow of <code class="literal">BeginState</code> GUI:</p><p>Line 33: <code class="literal">if (GUI.Button(new Rect(10, 10, 150, 100), "Press to Play"))</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Look up <code class="literal">GUI.Button</code> in the <span class="strong"><strong>Scripting Reference</strong></span>
</p></li><li style="list-style-type: disc"><p>It returns a Boolean (<code class="literal">bool</code>) of true when clicked</p></li><li style="list-style-type: disc"><p>Therefore, we use an <code class="literal">if</code> statement to detect when it's clicked</p></li><li style="list-style-type: disc"><p>The <code class="literal">Button()</code> method has the following two parameters:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A <code class="literal">Rect</code> object (rectangle) is created which specifies its position on the screen and its size</p></li><li style="list-style-type: disc"><p>The <code class="literal">string</code> text that will be on the button</p></li></ul></div></li></ul></div><p>Line 35: <code class="literal">Switch();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This line calls the <code class="literal">Switch()</code> method on line 41</p></li></ul></div><p>Line 38: <code class="literal">GUI.Box (new Rect (Screen.width – 60,10,50,25), countDown.ToString());</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">Box()</code> method creates a visible rectangle box in the <span class="strong"><strong>Scene</strong></span> to display the timer counting down</p></li><li style="list-style-type: disc"><p>Because I wanted the box on the right side of the screen no matter what resolution the screen may be, <code class="literal">Screen.width</code> provides the pixel position of the right side of the <span class="strong"><strong>Scene</strong></span>. Then I moved <code class="literal">60</code> pixels to the left of the right edge of the <span class="strong"><strong>Scene</strong></span>.</p></li><li style="list-style-type: disc"><p>The <code class="literal">60</code> mean: from the last pixel on the right, come back 60 pixels to the left, and that's where to start drawing the rectangle box.</p></li><li style="list-style-type: disc"><p>The <code class="literal">countDown.ToString()</code> method takes an integer value stored in <code class="literal">countDown</code> and converts it to a <code class="literal">string</code> value.</p></li><li style="list-style-type: disc"><p>It converts it to the string value because the second parameter of the <code class="literal">Box()</code> method requires a <code class="literal">string</code> type of value.</p></li></ul></div><p>Considering how much is going on in the <span class="strong"><strong>Scene</strong></span>, and that there are three ways to change to <code class="literal">PlayState</code>, there really isn't very much code in <code class="literal">BeginState</code>.</p><p>When you know the syntax, how to use variables and methods, and the concept of working with objects, coding is actually quite simple to learn because you're doing the same types of thing over and over. The most difficult part of coding is trying to discover all the features that Unity provides in the <span class="strong"><strong>Scripting Reference</strong></span>, and how they work.</p><p>You could get to know C# to the point where you dream in code, but then you have to apply that coding knowledge to Unity. So you look in the <span class="strong"><strong>Scripting Reference</strong></span> and think what is a <span class="strong"><strong>EulerAngle</strong></span> or a <span class="strong"><strong>Quaternion</strong></span>? What takes time is doing the research, and not necessarily writing the code.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec127"></a>Have a go hero – changing the State switching order</h3></div></div></div><p>Assuming that<a id="id329" class="indexterm"></a> <code class="literal">BeginState</code> will appear when the game starts and again after you lose, change <code class="literal">WonState</code> to switch to <code class="literal">PlayState</code> instead of starting over with <code class="literal">BeginState</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note56"></a>Note</h3><p>Hint: you have to change only one word in the <a id="id330" class="indexterm"></a>
<code class="literal">WonState</code> class.</p></div></div></div>