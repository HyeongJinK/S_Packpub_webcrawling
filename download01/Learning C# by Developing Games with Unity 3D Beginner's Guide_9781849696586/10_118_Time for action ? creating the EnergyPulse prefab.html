<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec116"></a>Time for action – creating the EnergyPulse prefab</h2></div></div><hr /></div><p>We need to create a prefab <a id="id470" class="indexterm"></a>of our <span class="strong"><strong>EnergyPulse</strong></span> projectile. Use the following screenshot of the <span class="strong"><strong>Inspector</strong></span> as a guide for these steps.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new prefab by navigating to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Prefab</strong></span> and name it <code class="literal">EnergyPulse</code>.</p></li><li><p>Add a <span class="strong"><strong>Sphere</strong></span> to the <span class="strong"><strong>Scene</strong></span>.</p></li><li><p>Position its <span class="strong"><strong>Transform</strong></span> to <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>.</p></li><li><p>Scale its <span class="strong"><strong>Transform</strong></span> to <code class="literal">0.5</code>, <code class="literal">0.5</code>, <code class="literal">0.5</code>.</p></li><li><p>On the <span class="strong"><strong>Sphere Collider</strong></span>, check <span class="strong"><strong>Is Trigger</strong></span>.</p></li><li><p>Uncheck <span class="strong"><strong>Mesh Renderer</strong></span>.</p></li><li><p>Add a <span class="strong"><strong>Rigidbody</strong></span> Component.</p></li><li><p>Turn off <span class="strong"><strong>Gravity</strong></span>.</p></li><li><p>Add the script <code class="literal">EnergyPulsePower</code> (see <a class="link" href="#" linkend="appB">Appendix B</a>).</p></li><li><p>Add a <span class="strong"><strong>Trail Renderer</strong></span> Component by navigating to<span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Effects</strong></span> | <span class="strong"><strong>Trail Renderer</strong></span>.</p></li><li><p>Drag a <span class="strong"><strong>GoodOrb</strong></span> prefab to the <span class="strong"><strong>Good Orb</strong></span> property on the <span class="strong"><strong>Energy Pulse Power (Script)</strong></span>.</p></li><li><p>Set the <span class="strong"><strong>Trail Renderer</strong></span> properties as shown in the following screenshot.</p></li><li><p>Drag <span class="strong"><strong>Sphere</strong></span> onto the newly created, empty <span class="strong"><strong>EnergyPulse</strong></span> prefab.</p></li><li><p>Now delete <span class="strong"><strong>Sphere</strong></span> from <span class="strong"><strong>Scene</strong></span>
</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_19.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec163"></a>
<span class="emphasis"><em>What just happened?</em></span>
</h3></div></div></div><p>Now that we have<a id="id471" class="indexterm"></a> our <span class="strong"><strong>EnergyPulse</strong></span> to shoot, we can shoot them in two States: <code class="literal">PlayStateScene1_2</code> and <code class="literal">PlayStateScene2</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec164"></a>Shooting a single-shot EnergyPulse</h3></div></div></div><p>
<code class="literal">PlayStateScene1_2</code> only allows a <a id="id472" class="indexterm"></a>single shot to be fired for each press of the key.</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_20.jpg" /></div><p>An analysis of the code we saw in the preceding code screenshot is as follows:</p><p>Line 44: <code class="literal">if(Input.GetKeyDown(KeyCode.LeftControl))</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">GetKeyDown() </code>method means one shot will be fired every time the left <span class="emphasis"><em>Ctrl</em></span> key is pressed</p></li></ul></div><p>Line 46: <code class="literal">controller.FireEnergyPulse();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">FireEnergyPulse()</code> in <code class="literal">PlayerControl</code>, line 56, is called to fire an <span class="strong"><strong>EnergyPulse</strong></span>
</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec165"></a>Shooting rapid-fire EnergyPulses</h3></div></div></div><p>
<code class="literal">PlayStateScene2</code> allows for<a id="id473" class="indexterm"></a> continuous firing by holding the Left <span class="emphasis"><em>Ctrl</em></span> key down.</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_21.jpg" /></div><p>An analysis of the code we saw in the preceding code screenshot is as follows:</p><p>Line 47: <code class="literal">if(Input.GetKey(KeyCode.LeftControl))</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">GetKey() </code>method means shots will be fired continuously when the left <span class="emphasis"><em>Ctrl</em></span> key is pressed down</p></li></ul></div><p>Line 49: <code class="literal">controller.FireEnergyPulse();</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">FireEnergyPulse()</code> method<a id="id474" class="indexterm"></a>
<a id="id475" class="indexterm"></a> in <code class="literal">PlayerControl</code>, line 56, is called to fire an <span class="strong"><strong>EnergyPulse</strong></span>
</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec166"></a>The EnergyPulse is fired</h3></div></div></div><p>In <code class="literal">PlayerControl</code>, the <span class="strong"><strong>EnergyPulse</strong></span> is instantiated in front of <span class="strong"><strong>Player</strong></span>, and force is used to propel it forward. The <span class="strong"><strong>EnergyPulse</strong></span> has to be instantiated in front of <span class="strong"><strong>Player</strong></span> so that the <span class="strong"><strong>EnergyPulse Collider </strong></span>doesn't detect<a id="id476" class="indexterm"></a> the <span class="strong"><strong>Player Collider</strong></span> immediately after being instantiated. If it does detect it, the <span class="strong"><strong>EnergyPulse</strong></span> will be destroyed immediately.</p><p>The <code class="literal">PlayerControl</code> script needs to know about the <span class="strong"><strong>EnergyPulse</strong></span> prefab so that it can be created in code. Drag the <span class="strong"><strong>EnergyPulse</strong></span> prefab to the <span class="strong"><strong>Projectile</strong></span> variable property in the <span class="strong"><strong>Inspector</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_22.jpg" /></div><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_23.jpg" /></div><p>An analysis of the code <a id="id477" class="indexterm"></a>we saw in the preceding code screenshot is as follows:</p><p>Line 10: <code class="literal">public Rigidbody proj</code>
<code class="literal">ectile;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">projectile</code> stores the <span class="strong"><strong>EnergyPulse</strong></span> prefab so it can be instantiated</p></li></ul></div><p>Line 56: <code class="literal">public void FireEnergyPulse()</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This is called by <code class="literal">PlayStateScene1_2</code>, line 46, or <code class="literal">PlayStateScene2</code>, line 49</p></li></ul></div><p>Line 58: <code class="literal">Rigidbody clone;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">clone</code> stores a reference to the new <code class="literal">Rigidbody</code> object about to be created</p></li><li style="list-style-type: disc"><p>Since we will be using physics force to propel the <span class="strong"><strong>EnergyPulse</strong></span> forward, the variable <code class="literal">clone</code> is of type <code class="literal">Rigidbody</code>
</p></li></ul></div><p>Line 59: <code class="literal">clone = Instantiate(projectile, transform.position, transform.rotation) as Rigidbody;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">Instantiate()</code> method<a id="id478" class="indexterm"></a> takes the <span class="strong"><strong>Prefab</strong></span> stored in the variable <code class="literal">projectile</code> and creates an <span class="strong"><strong>EnergyPulse</strong></span> GameObject</p></li><li style="list-style-type: disc"><p>The method also places in it at the same position as <span class="strong"><strong>Player</strong></span> but we'll fix this</p></li><li style="list-style-type: disc"><p>Since the variable <code class="literal">clone</code> stores a <code class="literal">Rigidbody</code> type of object, and <span class="strong"><strong>EnergyPulse</strong></span> is of type <code class="literal">GameObject</code>, <span class="strong"><strong>EnergyPulse</strong></span> has to be converted to a <code class="literal">Rigidbody</code> type</p></li><li style="list-style-type: disc"><p>The <code class="literal">as</code> operator will cast (convert) the GameObject to a Rigidbody</p></li></ul></div><p>Line 60: <code class="literal">clone.transform.Translate(0, .5f, 2.1f);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Since we can't have the <span class="strong"><strong>EnergyPulse</strong></span> object at the same position as <span class="strong"><strong>Player</strong></span>, <code class="literal">Translate()</code>moves it in front of <span class="strong"><strong>Player</strong></span> before the frame is ready to display</p></li></ul></div><p>Line 61: <code class="literal">clone.velocity = transform.TransformDirection(Vector3.forward * 50);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This sets the <code class="literal">force</code> of <code class="literal">Rigidbody</code> being applied to move <span class="strong"><strong>EnergyPulse</strong></span> forward</p></li></ul></div><p>We now have our <a id="id479" class="indexterm"></a>
<span class="strong"><strong>EnergyPulse</strong></span> being fired. Now we need to make things happen when it hits something.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec167"></a>Controlling EnergyPulse objects</h3></div></div></div><p>So <span class="strong"><strong>Player</strong></span> shoots out this <span class="strong"><strong>EnergyPulse</strong></span>, what happens next? Does it just go on forever? What happens if it hits <a id="id480" class="indexterm"></a>something?</p><p>We certainly don't want these instantiated <span class="strong"><strong>EnergyPulse</strong></span> Gameobjects hanging around forever. Once they've served their purpose, they should be destroyed. That's exactly what we do. After a set time, they simply disappear.</p><p>The <span class="strong"><strong>EnergyPulse</strong></span> is meant to do two things:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Increase <span class="strong"><strong>Player Lives</strong></span>
</p></li><li style="list-style-type: disc"><p>Convert a <span class="strong"><strong>BadOrb</strong></span> into a <span class="strong"><strong>GoodOrb</strong></span>
</p></li></ul></div><p>Anything else they hit is immune to the effects of the <span class="strong"><strong>EnergyPulse</strong></span>. The following screenshot shows how this is done:</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_24.jpg" /></div><p>An analysis of the <a id="id481" class="indexterm"></a>code we saw in the preceding code screenshot is as follows:</p><p>The <code class="literal">EnergyPulsePower</code> script is attached to the <span class="strong"><strong>EnergyPulse</strong></span> GameObject.</p><p>Line 6: <code class="literal">public float pulseDuration = 1f;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This sets how long an <span class="strong"><strong>EnergyPulse</strong></span> will exist</p></li><li style="list-style-type: disc"><p>This time is adjustable in the <span class="strong"><strong>Inspector</strong></span>
</p></li></ul></div><p>Line 12: <code class="literal">pulseDuration -= Time.deltaTime;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This is a countdown timer that operates at the rate of <code class="literal">1.0</code> per second</p></li></ul></div><p>Line 14: <code class="literal">if(pulseDuration &lt;= 0)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>When the value in <code class="literal">pulseDuration</code> reaches <code class="literal">0</code>, line 15 is executed</p></li></ul></div><p>Line 15: <code class="literal">Destroy(gameObject);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Since this script is attached to the <span class="strong"><strong>EnergyPulse</strong></span> GameObject, this <span class="strong"><strong>EnergyPulse</strong></span> is destroyed when the timer reaches 0</p></li></ul></div><p>That makes sure an <span class="strong"><strong>EnergyPulse</strong></span> does not last forever.</p><p>Now we look into increasing <span class="strong"><strong>Player Lives</strong></span> and converting <span class="strong"><strong>BadOrbs</strong></span> into <span class="strong"><strong>GoodOrbs</strong></span>. What happens is that a <span class="strong"><strong>BadOrb</strong></span> collides with an <span class="strong"><strong>EnergyPulse</strong></span>. The <span class="strong"><strong>BadOrb</strong></span> is destroyed and disappears. <a id="id482" class="indexterm"></a>A new <span class="strong"><strong>GoodOrb</strong></span> is instantiated and placed exactly where the <span class="strong"><strong>BadOrb</strong></span> used to be, giving the appearance that it was converted.</p><div class="mediaobject"><img src="/graphics/9781849696586/graphics/6586OT_10_25.jpg" /></div><p>Line 8: <code class="literal">public Transform goodOrb;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">goodOrb</code> variable stores the <span class="strong"><strong>GoodOrb </strong></span>prefab so it can be instantiated</p></li></ul></div><p>Line 18: <code class="literal">void OnTriggerEnter(Collider other)</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This method is called by Unity when the <span class="strong"><strong>Sphere Collider</strong></span> of the <span class="strong"><strong>EnergyPulse</strong></span> hits any GameObject with a <span class="strong"><strong>Collider</strong></span>
</p></li><li style="list-style-type: disc"><p>The <code class="literal">other</code> variable now stores a reference to the <span class="strong"><strong>Collider</strong></span> of the GameObject that was hit</p></li></ul></div><p>Line 20: <code class="literal">if(other.gameObject.tag == "BadOrb")</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If the hit GameObject's tag is <code class="literal">BadOrb</code>, then the code block is executed</p></li><li style="list-style-type: disc"><p>If it does not have a tag of <code class="literal">BadOrb</code>, then line 28 is executed</p></li></ul></div><p>Line 22: <code class="literal">Instantiate(goodOrb, other.transform.position, other.transform.rotation);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>GoodOrb</strong></span> is instantiated and placed right where <span class="strong"><strong>BadOrb</strong></span> is located</p></li></ul></div><p>Line 23: <code class="literal">GameObject.Find("GameManager"). GetComponent&lt;GameData&gt;().playerLives += 1;</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This finds the variable <code class="literal">playerLives</code> in <code class="literal">GameData</code> and adds 1 to it, increasing <span class="strong"><strong>Player Lives</strong></span>
</p></li></ul></div><p>Line 24: <code class="literal">Destroy(other.gameObject);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>This destroys the <span class="strong"><strong>BadOrb</strong></span> gameObject</p></li></ul></div><p>Line 25: <code class="literal">Destroy(ga</code>
<code class="literal">meObject);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>EnergyPulse</strong></span>
<a id="id483" class="indexterm"></a> hit something, so it is destroyed and disappears</p></li></ul></div><p>Line 28: <code class="literal">Destroy(gameObject);</code>
</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>When <span class="strong"><strong>EnergyPulse</strong></span> hits something it is destroyed and disappears</p></li><li style="list-style-type: disc"><p>This is executed when <span class="strong"><strong>EnergyPulse</strong></span> hits anything other than a <code class="literal">BadOrb</code> GameObject</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec168"></a>Have a go hero – analyzing the code for the second level of play</h3></div></div></div><p>
<span class="strong"><strong>Scene2</strong></span> is very similar to <span class="strong"><strong>Scene1</strong></span>. It's included to show the ability to have a game with more than one level of play. Switching to the <code class="literal">PlayStateScene2</code> State is just as easy as switching to any other State. I did not explain the code for <span class="strong"><strong>Scene2</strong></span> because it would be redundant analysis. You already know all the fundamentals and concepts to be able to look at the code and know how it works. The challenge for you is to analyze the classes and code for <span class="strong"><strong>Scene2</strong></span>, and in the process realize that you now have the ability to do just that, read and understand code.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec169"></a>Pop quiz – knowing which Unity methods to call</h3></div></div></div><p>Q1. Using code, what are the two ways to move a GameObject in a game?</p><p>Q2. When applying a force to a GameObject to move it, what method should be used? (Hint: it's not <code class="literal">Update()</code>).</p><p>Q3. When wanting to fire a projectile that doesn't even exist in the scene, how do you get one to appear in the game?</p><p>Q4. To display buttons and text on the game screen, what Unity method is used?</p></div></div>