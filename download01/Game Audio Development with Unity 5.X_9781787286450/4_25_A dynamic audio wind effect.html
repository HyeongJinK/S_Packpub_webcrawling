<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="04lvl1sec28"></a>A dynamic audio wind effect</h2></div></div><hr /></div><p>One of the sounds we <span>avoided</span> or missed up until now is the sound of the wind. The wind certainly has an affect in our scene. Run the game and walk up to a torch, and you will notice the smoke blows in a direction away from the water. Here is a screenshot showing the smoke blowing away from the torch by the rock in the scene:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/3f2e67a9-35d5-494f-94db-c0cdc764cd97.png" /></div><p>Showing the direction of the wind in our village scene</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip60"></a>Note</h3><p>The smoke may be faint to see if you are too close; so stand back a little from the torch.</p></div><p>If you run the game for a while, you will even notice that the smoke (particles) is blown around in what looks like gusts of wind. So ideally, if we want to add a natural wind sound, we want the audio controlled by the same element that is blowing the smoke particles, which is exactly what we are going to do in the next exercise:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up Unity and direct your attention to the <strong class="userinput"><code>Hierarchy</code></strong> window. Search for or see if you can spot the <code class="literal">Wind Zone</code> object near the top of the list. After you find the object, double-click on it to focus it in the <strong class="userinput"><code>Scene</code></strong> view as shown here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/737df68c-8e53-43c6-9efc-ecd8333888c4.png" /></div><p>Showing the Wind Zone focused in the Scene view</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>That big blue arrow is <span>called</span> a Wind Zone, which represents a special environmental effect in Unity. A Wind Zone can be used to blow particles, such as smoke, or even trees and grass. Notice how the direction of the arrow exactly matches the direction the torch smoke was blowing. With the Wind Zone still selected, look at the <strong class="userinput"><code>Wind Zone</code></strong> component parameters as shown in the <strong class="userinput"><code>Inspector</code></strong> window. We won't go into what each of those settings does; you can look at the Unity documentation for that, but just know that the current values represent just casual breeze. However, for our example, we want a wind with more force and gusto.</li></ol></div><p>Set the <strong class="userinput"><code>Wind Zone</code></strong> component parameters to match those in the screenshot here:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/05da6cd5-3abf-4b01-bd47-0426de0be0be.png" /></div><p>Editing the Wind Zone parameters for a more gusty wind</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>If you run the game again, you will now see puffs of smoke blown though the air in the direction of the wind. Yet, we are still missing the wind sound, so let's add one to the scene. First, open up the <strong class="userinput"><code>Audio Mixer</code></strong> window at the bottom of the editor and make sure the <strong class="userinput"><code>Master</code></strong> mixer is loaded and the <strong class="userinput"><code>Master</code></strong> group is selected in the <strong class="userinput"><code>Groups</code></strong> list. Click the <strong class="userinput"><code>+</code></strong> icon next to the <strong class="userinput"><code>Groups</code></strong> to create a new child group, and then name this group <strong class="userinput"><code>Wind</code></strong> as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/e03a5cd8-c19b-4e17-88c2-97e86fcdbe0e.png" /></div><p>Adding a new Wind group to the Master mixer
</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Go back to the <strong class="userinput"><code>Hierarchy</code></strong> window and select the Wind Zone object again. Then in the <strong class="userinput"><code>Inspector</code></strong> window, click on the <strong class="userinput"><code>Add Component</code></strong> to open the component <span>context</span> menu. Enter <code class="literal">audiosource</code> into the search field and then select the <strong class="userinput"><code>Audio Source</code></strong> component from the list to add it. Configure the <strong class="userinput"><code>Audio Source</code></strong> to match the screenshot here:<div class="mediaobject"><img src="/graphics/9781787286450/graphics/f12b1bb1-7d5b-4b46-bfd8-8560c62bf9a9.png" /></div><p>Setting the Audio Source on the Wind Zone game object</p></li><li>Press play to run the scene. You should immediately notice the addition of a constant wind sound now. This is not what we want. We want the sound of the wind to gust and match the intensity of the blowing smoke particles. Stop the scene and continue with the exercise.</li><li>Select the <code class="literal">Wind</code> group in the <strong class="userinput"><code>Audio Mixer</code></strong> window. Then in the Inspector window, right-click (<span class="emphasis"><em>Ctrl</em></span> + click on Mac) on the <strong class="userinput"><code>Volume</code></strong> parameter and select the <strong class="userinput"><code>Expose 'Volume (of Wind)' to script</code></strong> option from the context menu. Then, open the E<strong class="userinput"><code>xposed Parameters</code></strong> menu at the top right of the <strong class="userinput"><code>Audio Mixer</code></strong> window. Double-click on the new <span>parameter</span> called <strong class="userinput"><code>MyExposedParam</code></strong> to rename it <code class="literal">windVolume</code>. We are just repeating the last exercise on creating an exposed parameter. If you get lost, just review the steps and screenshots from the last exercise.</li><li>From the menu, select <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Create Empty</code></strong>. Select the new <strong class="userinput"><code>GameObject</code></strong> in the <strong class="userinput"><code>Hierarchy</code></strong> window and rename it <code class="literal">AudioWeatherVane</code>. In the <strong class="userinput"><code>Inspector</code></strong> window, click on the <strong class="userinput"><code>Add Component</code></strong> menu, and in the component menu, enter <code class="literal">audioweathervane</code> in the search field. Then, select the <strong class="userinput"><code>Audio Weather Vane</code></strong> component from the list as shown in the following screenshot:
</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/ac6ec60e-9f69-4903-a1a4-52d99949d167.png" /></div><p>Adding the Audio Weather Vane component</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>This will add the <strong class="userinput"><code>Audio Weather Vane</code></strong> component to the new object. Click on the target icon next to the <strong class="userinput"><code>Particle Tracker</code></strong> setting. This will <span>open</span> the <strong class="userinput"><code>Select ParticleSystem</code></strong> dialog; just select one of the <code class="literal">fx_smoke</code> items in the list and close the dialog. Then, set the other parameters on the component to match the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/e9cbf31c-6c4e-425d-85a8-7063ba65c162.png" /></div><p>Setting the Audio Weather Vane parameters</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note61"></a>Note</h3><p>The reason we need a particle effect in the Audio Weather Vane script is to to be able to track the force of the wind. Unfortunately, the Unity API can be a black box at times and this is especially true of the Wind Zone component. There isn't actually a direct way of querying the Wind Zone to determine the wind velocity during runtime. Instead, we use an indirect hack to track the velocity of particles being affected by the Wind Zone.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Press the play button to run the scene. Notice how the wind sound now is much more dynamic and matches the intensity of the wind as it blows the smoke particles around the scene. We will explore the details of the <code class="literal">AudioWeatherVane</code> script next, but try adjusting the multiplier and offset parameters to see the effect it has on the volume changes. You can also try adjusting the Wind Zone component parameters as well, if you would like to see what effect that has. When you are done testing, stop the scene and save your changes.</li></ol></div><p>This <span>dynamic</span> wind effect we just created uses the exposed <code class="literal">windVolume</code> parameter to set the volume of the wind based on the current velocity of the wind. All of this magic occurs within the <code class="literal">AudioWeatherVane</code> script, so let's open that script up and take a closer look at the interesting points here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the <code class="literal">AudioWeatherVane</code> script in your favorite editor of choice. For review, the entire script is shown here:</li></ol></div><pre class="programlisting">using UnityEngine;
using UnityEngine.Audio;

public class AudioWeatherVane : MonoBehaviour
{
    public ParticleSystem particleTracker;  //ParticleSystem must have External Forces set
    public AudioMixer masterMixer;
    public string volumeControl = "windVolume";
    public float multiplier = 1f;
    public float offset = -20f;
    public float avgWindMagnitude;
    private ParticleSystem.Particle[] particles;

    void Start()
    {
        particles = new ParticleSystem.Particle[10];
    }

     //FixedUpdate runs every physics update
     void FixedUpdate()
     {
         var magnitude = 0f;
         if (particleTracker.GetParticles(particles) &gt; 0)
         {
             for (int i = 0; i &lt; particles.Length; i++)
             {
                 magnitude += particles[i].velocity.magnitude;
             }
             avgWindMagnitude = magnitude / particles.Length;
             masterMixer.SetFloat(volumeControl, avgWindMagnitude * multiplier + offset);
       }
    } 
}</pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Now, we will cover the highlights, changes, or differences of this script here:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">public ParticleSystem particleTracker;</code>: This is the particle system we will use to track the strength of the wind. It is <code class="literal">public,</code> so it can be set in the editor.</li></ul></div></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note62"></a>Note</h3><p>The <strong class="userinput"><code>External Forces</code></strong> setting is a particle system setting that allows wind to affect the particle when it is enabled. This setting needs to be enabled on the particle system in order for it to be used as a tracker.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">public AudioMixer masterMixer;</code>: This is the mixer that has the exposed parameter we want to control. We called it the master, but just realize it could be any mixer with exposed parameters.</li><li style="list-style-type: disc"><code class="literal">public string volumeControl = "windVolume";</code>: Instead of using a hardcoded setting for the exposed parameter, we are going to use a string, set to a default value. That way, in the future, we can change the parameter name to some other value we want to control.</li><li style="list-style-type: disc"><code class="literal">public float avgWindMagnitude;</code>: Unlike the other two public float fields, we have this one made public for convenience. Making this field public allows us to monitor the value during runtime from the editor. If you were following the preceding exercise closely, you are already likely to notice this.</li><li style="list-style-type: disc"><code class="literal">particles = new ParticleSystem.Particle[10];</code>: This is just an initialization of an array of <code class="literal">10</code> particles. Essentially, this is the rolling array of particles we track in order to determine velocity changes.</li><li style="list-style-type: disc"><code class="literal">void FixedUpdate()</code>: We use <code class="literal">FixedUpdate</code> instead of <code class="literal">Update</code> in this script to run our code. <code class="literal">FixedUpdate</code> runs every physics calculation cycle of the game, whereas <code class="literal">Update</code> runs every graphics frame update. We won't get into why there needs to be two different update methods, but just understand that the physics timing is different than the graphics timing. Needless to say, we use the physics update cycle in this script, because we are tracking the physical properties of particles.
</li></ul></div></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note63"></a>Note</h3><p>The bulk of the other code in the <code class="literal">FixedUpdate</code> is to track the effect of the wind on the particle system particles. We won't review the details of that code since it is a hack or workaround.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">masterMixer.SetFloat(volumeControl, avgWindMagnitude * multiplier + offset);</code>: Finally, just as we have seen in the earlier example, we use the <code class="literal">SetFloat</code> method on the mixer to adjust the volume of the exposed parameter. This allows us to quickly adjust the parameter for every physics update and provides for that dynamic audio wind effect.</li></ul></div></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note64"></a>Note</h3><p>For this example, we use <code class="literal">FixedUpdate</code> to execute <code class="literal">SetFloat</code>, but just realize that we could also do something similar in the regular Update method as well.</p></div><p>Feel <span>free</span> to reuse the <code class="literal">AudioWeatherVane</code> script wherever you want to track the wind and be able to adjust the mixer parameters for whatever effects suit you. Perhaps a creaky door sound or leaves rustling based on the strength of the wind, the possibilities are endless here. Before completing this example, we are just going to add one more tie-in effect to the <code class="literal">Ambient</code> audio group.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>We are going to add a <strong class="userinput"><code>Duck Volume</code></strong> effect to the <strong class="userinput"><code>Ambient</code></strong> group in order for the ambient sounds to duck when the wind audio volume increases. Start by selecting the <strong class="userinput"><code>Ambient</code></strong> group in the <strong class="userinput"><code>Audio Mixer</code></strong> window and clicking on the <strong class="userinput"><code>Add</code></strong> button. Select the <strong class="userinput"><code>Duck Volume</code></strong> effect from the context menu in order to add it to the group.</li><li>In the <strong class="userinput"><code>Inspector</code></strong> window, select and drag the <strong class="userinput"><code>Duck Volume</code></strong> effect above the <strong class="userinput"><code>Send</code></strong> effect that is already in the <strong class="userinput"><code>Ambient</code></strong> group. Then, set the parameters on the <strong class="userinput"><code>Duck Volume</code></strong> to match those as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/40b6a15b-1c93-4007-a0aa-34e47b9b37b9.png" /></div><p>Setting the Duck Volume effect parameters on the Ambient group</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip65"></a>Note</h3><p>You may notice that the suggested audio settings may not always sound the way you think they should. This could come from a number of differences in the way your audio is playing and the system you are using. In fact, this is something you should be especially mindful of. Be sure to try and listen to your game audio through multiple different system and mediums, such as headphones, speakers, and so on. Then, adjust your settings to match what you feel sounds best overall or what works best on each system. Perhaps, even using snapshots, if there are major differences.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Next, <span>select</span> the <strong class="userinput"><code>Wind</code></strong> group and add a <strong class="userinput"><code>Send</code></strong> effect to it by clicking on the <strong class="userinput"><code>Add Effect</code></strong> button in the <strong class="userinput"><code>Inspector</code></strong> window. Set the effect to point to the <strong class="userinput"><code>AmbientDuck Volume</code></strong> Receive level and adjust the <strong class="userinput"><code>Send level</code></strong> to max as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/6351af79-b170-44f7-b1bc-4fc2d4a546ff.png" /></div><p>Setting the Wind group Send effect Receive and Send level
</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Press play to run the scene and listen to the changes in audio. As always, feel free to adjust the audio to suit your needs. When you are done editing, stop the scene and save your changes.</li></ol></div><p>If you ever walked around on a windy day, you probably will have noticed how the sound of rushing air around you blocks out other noises. That is the effect we wanted to achieve by adding that additional Duck Volume effect. We didn't add a ducking effect to the <strong class="userinput"><code>Direct group of audio, but if you feel that would make the wind sound more natural, go ahead.</code></strong></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip66"></a>Note</h3><p>If you talk to any experienced sound engineers or mixers, one thing they will generally point out is don't be afraid to do your own thing. Audio mixing and sound design are after all artistic endeavors, and as such there may come a time where breaking rules makes sense. In general, don't be afraid to break the rules and always do the best you can to see your vision through.</p></div><p>In the next section, we will continue by demonstrating another practical effect you could use in other game development efforts by looking at environmental audio zones.</p></div>