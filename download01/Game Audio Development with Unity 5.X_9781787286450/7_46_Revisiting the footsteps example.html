<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="07lvl1sec46"></a>Revisiting the footsteps example</h2></div></div><hr /></div><p>In order to give us more <span>experience</span> of the capabilities with FMOD and introduce some very simple adaptive audio techniques, we will revisit another earlier example, the footsteps example. If you recall, in that example we added footstep sounds to the game character. Those sounds also responded to a set of adaptive or transition areas we made for our scene. We used those adaptive areas to control the adaptive level, which in turn set the mood for our characters, movements, footsteps audio, and music. If you need to revisit how those areas work, consult <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Using the Audio Mixer for Adaptive Audio</em></span>. In that chapter, we discuss the why, what, and how for setting up those areas in much more detail.</p><p>By now you should be very familiar with Unity and FMOD, so this should be a quick example. Follow the instructions here to start updating the footsteps example:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up FMOD and right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the <strong class="userinput"><code>Events</code></strong> tab; from the menu, select <strong class="userinput"><code>New 2D Event</code></strong>. Rename the event <code class="literal">footsteps</code>. Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the event, and from the menu, select <strong class="userinput"><code>Assign to Bank</code></strong> | <strong class="userinput"><code>Master Bank</code></strong> and the event.</li><li>Go back to the Unity project and search for <code class="literal">footstep</code> in the <strong class="userinput"><code>Project</code></strong> window. Select the group of four audio footstep sounds, as shown in the screenshot here, and drag them as a group to the FMOD <strong class="userinput"><code>Event Editor</code></strong> window:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/52a1e8ca-0837-435a-a1c6-b1dc953f7443.png" /></div><p>Selecting and dragging the four audio footstep sounds from Unity to FMOD
</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Drop the group of audio clips into the <strong class="userinput"><code>footsteps</code></strong> event <strong class="userinput"><code>Audio 1</code></strong> track. This will create a <strong class="userinput"><code>Multi Sound</code></strong> source clip, as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/4b895c20-fe0c-4b23-9fbd-4ffb4b6215ae.png" /></div><p>Creating a Multi Sound audio event</p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Confirm that the <strong class="userinput"><code>Randomize Playlist</code></strong> button is enabled by selecting the <strong class="userinput"><code>Multi Sound</code></strong> clip and looking in the <strong class="userinput"><code>Playlist</code></strong> area, and as shown in the preceding screenshot. Click on the <strong class="userinput"><code>loop playback</code></strong> button, also shown earlier, and then play the event by pressing play. As the event plays and loops, you should see and hear the various footstep sounds play.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note124"></a>Note</h3><p>If you recall, we had to write code in our footsteps script to randomize the playback of the various clips. With FMOD that can all be handled with just a couple clicks.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Click on the <strong class="userinput"><code>Master</code></strong> track and <span>then</span> look to the bottom right of the window. Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the <strong class="userinput"><code>Pitch</code></strong> control and select <strong class="userinput"><code>Add Automation</code></strong> from the menu. This will add an automation track just below the <strong class="userinput"><code>Master</code></strong>.
</li><li>Click the <strong class="userinput"><code>+</code></strong> button beside the <strong class="userinput"><code>Timeline</code></strong> tab, and from the menu, select <strong class="userinput"><code>Add Parameter</code></strong>. When prompted with the <strong class="userinput"><code>Add Parameter</code></strong> dialog, name the parameter <code class="literal">Adaptive_Level</code> and set the range from [<span class="strong"><strong><strong class="userinput"><code>1-5</code></strong></strong></span>]. Yes, this does break our rule about normalizing, but in this case it simplifies our understanding. Since we already set the parameter to work with a range of 1-5, select the <code class="literal">Adaptive_Level</code> parameter and then adjust the <strong class="userinput"><code>Pitch</code></strong> curve to around [-2.25 - +5], or something similar to what is shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/d749e783-678f-4530-a1ae-eb59caee144b.png" /></div><p>Adjusting the Pitch automation control for the Adaptive_Level parameter</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>After you have finished making your changes, build the project and then save.</li></ol></div><p>That completes our updates to FMOD for our footsteps example. As you have seen, FMOD again offers us a couple of shortcuts and more control over parameters. You should note that in our previous example, we also didn't add any fine tuned parameter control. This was done more to simplify the example when we developed it for Unity. Speaking of Unity, let's jump back into the editor and get this example completed by following the exercise here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the editor and search for the <code class="literal">AdaptiveAudioManager.prefab</code> in the <strong class="userinput"><code>Project</code></strong> window. Remember a prefab is denoted by a blue box icon so try not to confuse for the script of the same name. Drag the prefab into the bottom of the <strong class="userinput"><code>Hierarchy</code></strong> window to add it to the scene. Double-click on the <strong class="userinput"><code>AdaptiveAudioManager</code></strong> in the scene. This zoom out/in is to display the colored zones in the <strong class="userinput"><code>Scene</code></strong> view.
</li><li>Locate the <strong class="userinput"><code>FlyingRigidBodyFPSController_HighQuality</code></strong> object in the <strong class="userinput"><code>Hierarchy</code></strong> window and select it. Then, add the <code class="literal">FootstepsAudio</code> script to the component using the <strong class="userinput"><code>Add Component</code></strong> button in the <strong class="userinput"><code>Inspector</code></strong> menu. After the component is added, set the parameters to match what is shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/0415f931-ca31-4ec7-9e62-eda75e604da4.png" /></div><p>Setting the parameters for the Footsteps Audio script component</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>When you are <span>done</span> editing, save the scene and then press play. Move around the scene and listen to how the footstep audio changes. Remember that as the player moves through the various adaptive audio areas, they will experience various forms of time compression based on the danger level of the area. Now, with our updated script, the footstep audio playback speed (<span class="strong"><strong>pitch</strong></span>) is more inline with that time compression.</li></ol></div><p>If you recall from <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Using the Audio Mixer for Adaptive Audio,</em></span> where we discussed the premise of our pretend game, we described our character as the forced and very apprehensive hero. As such, we wanted to express those emotions through basic game mechanics in the form of time compression or distortion. Now that we have the footsteps sounding, the effect is working better. However, we can still add more cues or perhaps even vocal cues to enhance this effect. We will get into more detail about vocal cues in <a class="link" href="#" linkend="ch09">Chapter 9</a>, <span class="emphasis"><em>Character Lip Syncing and Vocals</em></span>.</p><p>Before we complete this example, we want to cover the scripting changes we need to perform in order to get this example to work. Open up the <code class="literal">FootstepsAudio</code> script in your favorite editor. Since we have already covered this script and the majority of other changes, we are only going to focus our attention on one method that has been updated, see here:</p><pre class="programlisting">private void PlayFootStepAudio()
{
   if (characterController.Grounded == false)
   {
      return;
   }
<span class="strong"><strong>footstepsEvent.setParameterValue(parameterName, </strong></span>
<span class="strong"><strong>                        AdaptiveAudioManager.Instance.currentAdaptiveLevel );</strong></span>
<span class="strong"><strong>   footstepsEvent.start();</strong></span>
}</pre><p>The two highlighted lines of code show the major differences. The first one we already covered in the previous section and is just an example called <code class="literal">setParameterValue</code>. The second line of code shows the use of the <strong class="userinput"><code>start()</code></strong> method to play an event.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip125"></a>Note</h3><p>An excellent source for learning the FMOD API and how to use the library is the code itself. The complete FMOD Unity integration source code is written in C# and available. You only need to spend time to look through it and learn. Of course if you are not a developer, this may not concern you and you likely have more mixing to do anyway.</p></div><p>We really have only touched the surface of what is possible in scripting the FMOD audio system from within Unity. In the next section, we will dive back into adaptive music development with FMOD.</p></div>