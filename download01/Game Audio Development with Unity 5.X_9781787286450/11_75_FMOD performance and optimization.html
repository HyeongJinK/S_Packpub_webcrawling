<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="11lvl1sec71"></a>FMOD performance and optimization</h2></div></div><hr /></div><p>The <span>FMOD</span> Studio audio system we worked with in <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Introduction to FMOD</em></span> and <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>FMOD for Dyanmic and Adaptive Audio</em></span>, is external to Unity. It is helpful to remember that Unity actually uses FMOD for its core audio system. Therefore, many of the optimization strategies we have already discussed will apply equally well when working with FMOD Studio. What we will cover in this section is how to profile with FMOD and where to tweak settings in order to optimize performance.</p><p>This section on working with FMOD Studio will require you to have reviewed <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Introduction to FMOD</em></span> and <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>FMOD for Dyanmic and Adaptive Audio</em></span>, at the least. Ideally, you should have worked through the FMOD Studio set up to install the software and be able to find your way around the interface.</p><p>We will start with getting the Unity and FMOD projects set up by following the instructions:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note191"></a>Note</h3><p>If you have worked through to the end of <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>FMOD for Dyanmic and Adaptive Audio</em></span>, and not modified those projects, you can jump ahead to the next exercise.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open Unity and create a new project called <code class="literal">GameAudio_FMOD</code>.</li><li>From the menu, select <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Asset Store</code></strong>. To open the store page, find the <code class="literal">Viking Village</code> Unity asset and download and/or import it.</li><li>From the menu, select <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Import Package</code></strong> | <strong class="userinput"><code>Custom Package</code></strong> and use the dialog to locate the FMOD Unity integration package you previously downloaded from FMOD. If you are unable to locate the package, you will need to go to <a class="ulink" href="http://fmod.com" target="_blank">FMOD.com</a>, login, and then download the package again.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note192"></a>Note</h3><p>Be sure you have installed the FMOD Unity integration package into your Unity project before continuing.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>From the menu, select <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Import Package</code></strong> | <strong class="userinput"><code>Custom Package</code></strong> and use the Import dialog to open the <code class="literal">Chapter_11_FMOD</code> folder from the book's downloaded source code. Then, select and import the <strong class="userinput"><code>Chapter_11_FMOD.unitypackage</code></strong>.
</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Located within the <code class="literal">Chapter_11_FMOD</code> from the book's source code is another folder called <code class="literal">GameAudio_FMOD</code>. You will need to copy that entire folder to your Unity <code class="literal">GameAudio_FMOD</code> project folder. After you copy the folder, the contents of your project folder should look similar to the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/c6c43f6b-740a-4fed-9b81-6962ba0b4730.png" /></div><p>Copying the GameAudio_FMOD folder into the Unity project folder</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Launch FMOD Studio and from the menu and select <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>Open</code></strong>. Use the dialog to locate and open the <code class="literal">GameAudio_FMOD</code> folder you just copied. Select the <code class="literal">GameAudio_FMOD.fspro</code> to open it in FMOD Studio.</li><li>From the menu, select <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>Build</code></strong> to build the project.</li><li>Return to Unity and from the menu select <strong class="userinput"><code>FMOD</code></strong> | <strong class="userinput"><code>Edit Settings</code></strong> and set the <strong class="userinput"><code>Studio Project Path</code></strong> using the <strong class="userinput"><code>Browse</code></strong> button to locate the <span>FMOD</span> project file and set it as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/f0542d03-af46-4f35-a45c-25bf56af0d42.png" /></div><p>Setting the Studio Project Path in the FMOD Settings</p><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Locate the <code class="literal">Chapter_11_FMOD</code> scene in the <strong class="userinput"><code>Project</code></strong> window and double-click on it to load it. At this point, you can run and test the scene to make sure everything works as expected.</li></ol></div><p>With the project set up, we can now look at how to profile and implement some performance optimization strategies by following the directions:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>By default, a <strong class="userinput"><code>FMOD Studio Debug</code></strong> overlay will be shown within the <strong class="userinput"><code>Game</code></strong> view when you run the scene. This overlay will look like the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/882e6d1f-f00d-4048-a7f1-a9da85b61459.png" /></div><p>FMOD Studio Debug overlay showing performance profiling stats</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note193"></a>Note</h3><p>Try not to directly compare the values in this window with the project running the Unity audio system. If you recall, we did not implement all the effects or ambient sounds in the FMOD project.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>From the menu, select <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Profiler</code></strong> to open the <strong class="userinput"><code>Profiler</code></strong>. Select the <strong class="userinput"><code>Audio</code></strong> panel again to look at the stats, and you will see everything is running at minimal levels. What is happening is that, for the most part, FMOD is running external to the Unity audio system; we already knew that.
</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Keep the scene running in Unity and then open FMOD. From the <span>FMOD</span> menu, select <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Profiler</code></strong>. This will open the <strong class="userinput"><code>Profiler</code></strong> window. Switch to the <strong class="userinput"><code>Profiler</code></strong> window, and from the menu, navigate to <strong class="userinput"><code>File</code></strong> | <strong class="userinput"><code>Connect to Game</code></strong>. You will be prompted with a <strong class="userinput"><code>Connect to Game</code></strong> dialog. Just use the defaults and click on the <strong class="userinput"><code>Connect</code></strong> button. Nothing will happen until you click on record.</li><li>Click on the <strong class="userinput"><code>Record</code></strong> button as identified in the following screenshot and watch as the <strong class="userinput"><code>Profiler</code></strong> comes to life and starts capturing data:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/2129fe27-ea8e-4ca0-9607-9b3ccfd86374.png" /></div><p>FMOD Profiler window capturing performance stats from a running game</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note194"></a>Note</h3><p>There is a lot of information being captured here, and it is important not to be overwhelmed. Just remember the stats are going to be similar to the Unity stats we already looked at.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Look through the interface as the game keeps running. You can always go back to Unity and move around the scene returning to the <strong class="userinput"><code>Profiler</code></strong> window, when you want to see how the performance has changed. This is best done with multiple monitors or moving the Unity and FMOD windows beside each other.</li><li>When you are done profiling, stop the scene in Unity and then stop the profiling session in the FMOD <strong class="userinput"><code>Profiler</code></strong>.</li></ol></div><p>While we won't have time to review every detail about the FMOD Profiler, there is some very helpful profiling that can identify potential problem areas immediately. If you go back to the profiling session and look through each of the tracks, you should immediately notice that one of the tracks is showing especially high usage, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/415c8e37-540a-427f-b0dd-108d23ecf699.png" /></div><p>Profiler performance for a torch showing possible performance issues</p><p>While we know the <span>torch</span> uses a spatial effect, should the CPU usage be this high? We definitely were not seeing this an issue in Unity, so let's look at the following torch event:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/868d3087-c6c9-40e6-a7af-2f7846294431.png" /></div><p>Torch event showing a Reverb return effect added</p><p>We only have to look at this event for a few seconds to quickly realize that this <strong class="userinput"><code>Reverb</code></strong> effect is the likely culprit. If you look back at our optimization strategies, one of our rules was to be careful not to overuse delay effects like reverb. What we did here is apply a reverb effect to every single torch event. The simple way to fix this is to remove the <strong class="userinput"><code>Reverb</code></strong> effect here and instead apply it through a group mixer. We will leave the reader to figure out how to do that on their own.</p><p>Before we leave this section on FMOD, we want to cover managing audio resources by following the instructions:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up <span>the</span> FMOD <strong class="userinput"><code>Event Viewer</code></strong> and select the <strong class="userinput"><code>Assets</code></strong> tab. This will show the list of project assets and a summary of how the resource is managed. Click on the <strong class="userinput"><code>torch</code></strong> asset and look to the settings at the bottom of the panel as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/6f4f6f18-90ae-4a0d-8e8e-05723d113440.png" /></div><p>Examining the project audio resources in the Assets panel
</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>What you will see here are the same options for optimizing the audio resources in your project. You will also notice that as you add new resources, FMOD is a little smarted on the options it chooses for the default settings. From here, you can override the settings using the previously discussed optimization strategies.</li></ol></div><p>
There is of course much more we could cover about FMOD performance but for most readers this will be a great starting point. In the next section, we complete the chapter by talking about troubleshooting tips.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note195"></a>Note</h3><p><strong class="userinput"><code>QUIZ TIME</code></strong>
Answer the following questions:
What type of compression should you use for short frequently played audio resources?
a) ADPCM
b) Vorbis
c) PCM
d) MP3
What type of loading would be best suited for long running audio clips?
a) Compressed in Memory
b) Vorbis
c) Decompress on Load
d) Streaming
What does DSP stand for?
a) Digital Sound Processing
b) Dynamic Sound Processing
c) Dynamic Signal Processing
d) Digital Signal Processing
Answers will be provided before the end of the chapter.</p></div></div>