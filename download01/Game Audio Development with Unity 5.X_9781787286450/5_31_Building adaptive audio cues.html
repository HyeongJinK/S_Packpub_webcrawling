<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="05lvl1sec33"></a>Building adaptive audio cues</h2></div></div><hr /></div><p>As you learned from the last section, there are a <span>number</span> of ways of triggering adaptive audio changes. For our purposes, we are going to use two strategies that we mentioned earlier, the event and proximity triggers. Both of these triggers are good for general use and will transition well when we start to compare adaptive audio implementations for Unity in later chapters.</p><p>Thus far, we have omitted mentioning any elements of gameplay with our demo game. There really wasn't a need when all we were doing is talking about technical implementation. However, as part of our adaptive audio implementation, we need good definitions of gameplay elements so that we can create our triggers and audio to match. Therefore, in order to provide context for our gameplay, we will assume the following imaginary game design statement:</p><p>The player will assume the role of a not-so-fierce Viking warrior who has become abandoned in his village, with a ravaging dragon. All the other villagers have fled into the mountains to leave our lonely hero to defeat the dragon of his own accord. Playing the role of the hero, players must search the level for items that will help them defeat the dragon. As they move around, the level they may feel threatened and even potentially attacked by the dragon.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip79"></a>Note</h3><p>If you like the game design statement and want to develop this whole game concept further, by all means go ahead and do so.</p></div><p>Before we get into <span>implementing</span> the event triggers, let's take a look at what we want to accomplish. Here is an image of our level and how we propose to place our event triggers to control the adaptive audio:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/52a8254e-138a-4f8f-828f-2302b51fe544.png" /></div><p>Event trigger area placement to control adaptive audio</p><p>The preceding map shows the placement of each type of trigger we plan to place. Notice how on the left side of the image there is a progression from areas numbered 1 to 5. That progression is relevant to our theme so let's review what each area color represents here:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span class="strong"><strong>Green</strong></span> (1): This represents an area where the player is comfortable and not threatened. The player can move silently through these areas and not fear an attack by the dragon. All the audio in this area should give an uplifting tone and positive mood.</li><li style="list-style-type: disc"><span class="strong"><strong>Black</strong></span> (2): This is the global zone or all other areas not marked with an identified area trigger. The audio in this area should feel neutral. These are areas the player is not very likely to be attacked.</li><li style="list-style-type: disc"><span class="strong"><strong>Yellow</strong></span> (3): This area represents an area of exposure which will be identified with an audio tone of apprehension and caution. The player may be seen and attacked, but they are close to other areas they can move to cover quickly.</li><li style="list-style-type: disc"><span class="strong"><strong>Purple</strong></span> (4): The purple areas are even more exposed and further represent areas of tension and expectation of attack at any moment.</li><li style="list-style-type: disc"><span class="strong"><strong>Red</strong></span> (5): There most certainly will be an attack at any moment. The audio will be dramatic and full of anticipation. The player will need to run quickly through these areas in order to avoid attack.</li></ul></div><p>Okay, now that we have our plans <span>laid</span> out, lets, get to it and create those audio triggers on the level by following the directions here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the Unity editor and load up the <code class="literal">GameAudioBasics</code> project. If you jumped here from another part of the book, create a new project and then import the Viking Village Unity project from the asset store.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip80"></a>Note</h3><p>If you have made significant changes to your previous chapter's work and want to save those changes, then either start a fresh by creating a new project or duplicate your project folder to a new location.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Import the <code class="literal">Chapter_5_Start.unitypackage</code> from the downloaded source code in the <code class="literal">Chapter_5_Assets</code> folder by selecting <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Import Package</code></strong> | <strong class="userinput"><code>Custom Package</code></strong> from the menu. Then, use the <strong class="userinput"><code>Import package</code></strong> dialog to navigate to the <code class="literal">Chapter_5_Assets</code> folder and select the package. Click on the <strong class="userinput"><code>Open</code></strong> button to load and begin import of the package. Click on the <strong class="userinput"><code>Import</code></strong> button on the <strong class="userinput"><code>Import</code></strong> dialog to import all the package contents.</li><li>From the menu, select <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Create New</code></strong>. Select and rename the new object to <code class="literal">AdaptiveAudioManager</code> in the <strong class="userinput"><code>Hierarchy</code></strong> menu. Reset the objects, <strong class="userinput"><code>Transform position</code></strong> to <code class="literal">0</code> in the <strong class="userinput"><code>Inspector</code></strong> window. Click on the <strong class="userinput"><code>Add Component</code></strong> button, and in the search field, type <code class="literal">adaptiveaudiomanager</code>. From the filtered list, select the <strong class="userinput"><code>Adaptive Audio Manager</code></strong> to add the component.</li><li>Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the <code class="literal">AdativeAudioManager</code> in the <strong class="userinput"><code>Hierarchy</code></strong> window and then select <strong class="userinput"><code>Create Empty</code></strong> from the context menu to create a new child object. Rename the new object <code class="literal">AAT_1_1</code> (AAT = Adaptive Audio Trigger, level 1, #1) in the <strong class="userinput"><code>Inspector</code></strong> window.</li><li>From the menu, select <strong class="userinput"><code>Component</code></strong> | <strong class="userinput"><code>Physics</code></strong> | <strong class="userinput"><code>Box Collider</code></strong> to add a collider to the object. Click the <strong class="userinput"><code>Add Component</code></strong> button and then in the search field type <code class="literal">adaptiveaudiotrigger</code> to filter the component list. Select the <strong class="userinput"><code>Adaptive Audio Trigger</code></strong> component to add it to the object. While still in the <strong class="userinput"><code>Inspector</code></strong> window, carefully set the <strong class="userinput"><code>Transform</code></strong>, <strong class="userinput"><code>Box Collider,</code></strong> and <strong class="userinput"><code>Adaptive Audio Trigger</code></strong> component parameters to match the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/12a8378d-de46-4009-bf8c-f543caf3bd8c.png" /></div><p>Setting the first triggers parameters</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Select the <code class="literal">AAT_1_1</code> object in the <strong class="userinput"><code>Hierarchy</code></strong> window and then press <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span> to duplicate it. Rename the duplicate object <code class="literal">AAT_1_2</code> and set its parameters to <span>match</span> those in the table here:
<div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Name</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Component</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Parameter</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_1_2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = 36.6, Position.Z = 5, Rotation.Y = -9.16</p><p>Size.X = 35, Size.Y = 25, Size.Z = 40</p><p>Trigger Level = 1</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_3_1</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = -31.5, Position.Z = 8, Rotation.Y = 19</p><p>Size.X = 11, Size.Y = 25, Size.Z = 75</p><p>Trigger Level = 3</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_3_2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = -13.2, Position.Z = 5.3, Rotation.Y = -9.16</p><p>Size.X = 8, Size.Y = 25, Size.Z = 70</p><p>Trigger Level = 3</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_4_1</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = -7.4, Position.Z = 33.3, Rotation.Y = 8.5</p><p>Size.X = 12, Size.Y = 25, Size.Z = 12</p><p>Trigger Level = 4</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_4_2</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = -52.1, Position.Z = 7.4, Rotation.Y = 19</p><p>Size.X = 25, Size.Y = 25, Size.Z = 60</p><p>Trigger Level = 4</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_4_3</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = 41.2, Position.Z = -26, Rotation.Y = -9.16</p><p>Size.X = 37, Size.Y = 25, Size.Z = 20</p><p>Trigger Level = 4</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>AAT_4_4</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style="border-bottom: 0.5pt solid ; "><p>Position.X = -7.9, Position.Z = -33.9, Rotation.Y = -9.16</p><p>Size.X = 37, Size.Y = 25, Size.Z = 20</p><p>Trigger Level = 4</p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>AAT_5_1</p></td><td style="border-right: 0.5pt solid ; "><p>Transform</p><p>Box Collider</p><p>Adaptive Audio Trigger</p></td><td style=""><p>Position.X = -81.9, Position.Z = 23.3, Rotation.Y = 19</p><p>Size.X = 36, Size.Y = 25, Size.Z = 60</p><p>Trigger Level = 5</p></td></tr></tbody></table></div></li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Continue duplicating the objects using <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>, renaming them, and entering the parameters to match all the objects in the table. After you are done, double-click on the <strong class="userinput"><code>AdaptiveAudioManager</code></strong> object in the <strong class="userinput"><code>Hierarchy</code></strong> window, then adjust your camera view (zoom or pan) and your triggers should resemble something close to the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/dedb77d3-c7fa-43fd-8c6a-b37aaa556a67.png" /></div><p>Village set up with various adaptive audio triggers added</p><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Press play to run the scene. As you move through the scene, notice how the <strong class="userinput"><code>Current Adaptive Level</code></strong> setting on the <strong class="userinput"><code>Adaptive Audio Manger</code></strong> component changes as you move through the various triggers. Try to move outside an area where you know a trigger should be and see what the level gets set to.</li><li>When you are done testing the scene, press <span class="emphasis"><em>Esc</em></span> to unlock your mouse and then press play again to stop the scene. From the menu, select <strong class="userinput"><code>Save Scene</code></strong> to save your changes.
</li></ol></div><p>Before we move on to adding the adaptive <span>audio</span> elements that will be cued off our trigger levels, lets, take a closer look at the Adaptive Audio Trigger script by following the exercise here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Locate the <strong class="userinput"><code>Adaptive Audio Trigger</code></strong> component in the <strong class="userinput"><code>Inspector</code></strong> window as it is attached to one of the <code class="literal">AAT</code> objects. Click on the slot showing the <code class="literal">AdaptiveAudioTrigger</code> script. The script will become highlighted in yellow in the <strong class="userinput"><code>Project</code></strong> window as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/376c3ace-546e-4e4a-8021-82ae165e4f40.png" /></div><p>Highlighting the AdaptiveAudioTrigger script in the Project window</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Double-click on the script to open it in your preferred code editor. The code for the <code class="literal">AdaptiveAudioTrigger</code> script is shown here for reference:</li></ol></div><pre class="programlisting">using UnityEngine;

<span class="strong"><strong>[RequireComponent(typeof(BoxCollider))]</strong></span>
public class AdaptiveAudioTrigger : MonoBehaviour 
{ 
    public int triggerLevel; 

    <span class="strong"><strong>void OnDrawGizmosSelected()</strong></span>
    {
       Gizmos.color = GetGizmoColor();
       Gizmos.matrix = transform.localToWorldMatrix;
       Gizmos.DrawWireCube(Vector3.zero, GetComponent&lt;BoxCollider&gt;().size); 
    }

    private Color GetGizmoColor()
    {
       switch (triggerLevel)
       {
           case 0:
           case 2:
              return Color.black; //default is black
           case 1:
              return Color.green;
           case 3:
              return Color.yellow;
           case 4:
              return new Color(.4f, .1f, .6f); //purple
           case 5:
              return Color.red;
        }
           return Color.black;
    }
 
    <span class="strong"><strong>void OnTriggerEnter(Collider collider)</strong></span>
    {
       <span class="strong"><strong>AdaptiveAudioManager.Instance.AdjustAudioLevel(triggerLevel);</strong></span>
    }

    <span class="strong"><strong>void OnTriggerExit(Collider collider)</strong></span>
    {
       <span class="strong"><strong>AdaptiveAudioManager.Instance.AdjustAudioLevel(2);</strong></span>
    } 
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>The script is fairly simple, but as you may <span>have</span> noticed it doesn't follow our typical format. Let's take a closer look at the highlighted lines of code in more detail as follows:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">[RequireComponent(typeof(BoxCollider))]</code> : This line defines a special attribute, which makes it mandatory that this script be only used on an object that already has a <code class="literal">BoxCollider</code> attached. If you tried to add the <code class="literal">AdaptiveAudioTrigger</code> to an object, without a <code class="literal">BoxCollider</code>, the editor would throw an error and block you from doing so.</li><li style="list-style-type: disc"><code class="literal">void OnDrawGizmosSelected()</code> : This method is called by the Unity editor to draw the component when it is selected. It is this section of code that allows us to color our areas based on our trigger level. If you look at the <code class="literal">GetGizmoColor</code> method, which is just a <code class="literal">switch</code> statement; this is the bit of code that determines what color is used for what trigger level.</li><li style="list-style-type: disc"><code class="literal">void OnTriggerEnter(Collider collider)</code>: This is a special method that is triggered, when the boundaries of a collider are entered by another game object also with a collider (our player object). The collider, in our case a <code class="literal">BoxCollider</code>, needs to have the <code class="literal">Is Trigger</code> option set on its component properties as shown in the screenshot here:
</li></ul></div></li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/f70667a2-06cd-41bf-966c-21c228814062.png" /></div><p>Setting the Is Trigger setting on a Box Collider</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note81"></a>Note</h3><p>If a colliders Is Trigger, the property is not set and the object will function as any other collider, meaning it will prevent any other object from passing through it that has a collider attached to it. The majority of objects in the scene will not be triggers.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li><code class="literal">AdaptiveAudioManager.Instance.AdjustAudioLevel(triggerLevel);</code>: This line of code is activated inside the <code class="literal">OnTriggerEnter</code> method. It sets the current trigger level on the <code class="literal">AdaptiveAudioManager</code> using the <code class="literal">AdjustAudioLevel</code> method. Don't worry about the strange way we are calling the method just yet, we will cover that later when we cover the manager script.</li><li><code class="literal">void OnTriggerExit(Collider collider)</code> : This method is called when a collider exits from the boundaries of the trigger collider.</li><li><code class="literal">AdaptiveAudioManager.Instance.AdjustAudioLevel(2);</code> : This method is called inside the <code class="literal">OnTriggerExit</code> method as a way of setting the trigger level back to our global level of <span class="strong"><strong>2</strong></span>. Ideally, you would want to script this value but for simplicity we hardcoded it. Thus, when a player exits a trigger area, then the level will be set to <span class="strong"><strong>2</strong></span>, our global level.</li></ol></div><p>We are using triggers to cue up our adaptive audio changes but just understand that we could have just as easily used the environmental zone method we used from <a class="link" href="#" linkend="ch04">Chapter 4</a>, <span class="emphasis"><em>Advanced Audio Mixing</em></span>. Alternatively, we could have just as easily used triggers to create the environmental zones. However, that would have given us less control for how our environmental sounds transitioned. For our needs, the hard boundary trigger zones will work well with the way we are going to implement the scenes, adaptive music. In the next section, we will discuss other options for controlling adaptive music and then use one of those methods to add music to our scene.</p></div>