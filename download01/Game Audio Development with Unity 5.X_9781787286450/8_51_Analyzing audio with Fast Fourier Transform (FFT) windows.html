<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="08lvl1sec50"></a>Analyzing audio with Fast Fourier Transform (FFT) windows</h2></div></div><hr /></div><p>Unity is inherently built with the <span>capability</span> to analyze a playing <span>audio</span> source and determining the various output frequency signal levels. While the mathematics behind this are quite advanced, understanding the theory and background of how this all works will only benefit us later when we build an audio visualizer. Therefore, we are going to cover the theory on how audio can be analyzed for visualization. Starting in the next section, we will look at what comprises an audio signal.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="08lvl2sec24"></a>Audio spectrum</h3></div></div></div><p>Fourier's theorem <span>states</span> that all signals are the sum of sines. This is another way of saying that all audio signals are comprised of component sound waves, called sine waves. Let's look at an example of this in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/1e5bf82b-b93a-4aab-aa1e-7c4da9f42890.png" /></div><p>Two different frequency sine waves combined into a signal</p><p>The preceding diagram <span>shows</span> an example of two different frequency sound waves (sine waves) being combined into a single signal. Unfortunately, you still may not understand what makes one sine wave different from another aside from frequency. So, let's hear some examples of the audio frequency range we are capable of hearing in the form of single sine waves, given in the following table:</p><p>Â </p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Frequency range</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Frequency values</p></td><td style="border-bottom: 0.5pt solid ; "><p>Sample sine wave</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Sub-bass</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>20 to 60 Hz</p></td><td style="border-bottom: 0.5pt solid ; "><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/sine-wave-50hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/sine-wave-50hz.wav</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Bass</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>60 to 250 Hz</p></td><td style="border-bottom: 0.5pt solid ; "><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/100hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/100hz.wav</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Low midrange</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>250 to 500 Hz</p></td><td style="border-bottom: 0.5pt solid ; "><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/300hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/300hz.wav</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Midrange</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>500 Hz to 2 kHz</p></td><td style="border-bottom: 0.5pt solid ; "><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/1000hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/1000hz.wav</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Upper midrange</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>2 to 4 kHz</p></td><td style="border-bottom: 0.5pt solid ; "><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/3000hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/3000hz.wav</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Presence</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>4 to 6 kHz</p></td><td style="border-bottom: 0.5pt solid ; "><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/5000hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/5000hz.wav</a></p></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>Brilliance</p></td><td style="border-right: 0.5pt solid ; "><p>6 to 20 kHz</p></td><td style=""><p><a class="ulink" href="https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/10000hz.wav" target="_blank">https://packt-type-cloud.s3.amazonaws.com/uploads/sites/1086/2017/03/10000hz.wav</a></p></td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note135"></a>Note</h3><p>If you are unable to hear the audio files in your reader or book, go to this page: <a class="ulink" href="http://www.teachmeaudio.com/mixing/techniques/audio-spectrum" target="_blank">http://www.teachmeaudio.com/mixing/techniques/audio-spectrum</a>. Be sure to take the time and visit that page and listen to the audio spectrum of the sine waves.</p></div><p>Each of the sound files in the preceding table represents a single sine wave within the audio spectrum or frequency range of human hearing. Recall from <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Scripting Audio</em></span>, when we discussed effects and equalization, that the audio spectrum starts with the sub-bass range. This is represented by those low tones often associated with a kick drum or tribal drum sounds that you can feel. Up to the range of brilliance or those very high piercing tones that can hurt your ears and everything in between. The following screenshot shows an excerpt from FMOD showing each of those sine waves in the order of increasing frequency:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/4e8a7019-2d24-4007-9bfc-bab18640d453.png" /></div><p>Each sine wave clip represented as a wave form in FMOD</p><p>Every sound we hear is <span>composed</span> of those various tones or sine waves all added up together to produce audio such as music or sound effects. Working through this book, you have seen multiple examples of sound wave forms within Unity or FMOD. Yet, to demonstrate a couple of points, we will refer to the picture of an audio clip from FMOD:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/da618a5b-1c5c-4d16-bd56-dc57aa073ebc.png" /></div><p>Zoomed in view of audio clip in FMOD showing combined wave form</p><p>The preceding image was again taken from FMOD but this time shows a zoomed-in view of a music file. Notice how at the start of the clip you can clearly see what looks like a single sine wave. That quickly changes though to what is obviously a combined mix of multiple waves of varying frequency.</p><p>Okay, so now we have a basic understanding of what the audio spectrum is and how audio signals are composed. What does this have to do with visualizing sound? Well, what if there was a way to decompose an audio signal back to its individual sine waves that could be measured. We will look at how that problem can be solved in the next section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="08lvl2sec25"></a>Deconstructing signals using FFT and windowing</h3></div></div></div><p>As you can well imagine, <span>breaking</span> down an audio signal back to its component waves is not mathematically simple. The process is based on the study of representing complex <span>functions</span> using simpler trigonometric functions, which is called Fourier analysis. It is named after Joseph Fourier who first demonstrated these concepts. The algorithm we use to break down a signal is called a Fast Fourier Transform (FFT) and many different forms have been developed. Of course, we won't go into the maths here, but it will be helpful to understand how the algorithm works.</p><p>An FFT algorithm <span>essentially</span> works by breaking down a signal based on <span>time</span> into its frequency component amplitudes as shown in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/5bc98efc-cbee-403f-af5b-ff8689384ef9.png" /></div><p>FFT of audio signal into frequency and amplitude</p><p>The preceding diagram shows the FFT algorithm transforms our audio signal into frequency amplitudes or essentially into the amplitude of the individual component waves. However, as you can see in the diagram, it may still be difficult to measure specific data points. This can be caused by leakage or aberrations in the data and/or transformation. Fortunately, this is solved by a technique called <span class="strong"><strong>windowing,</strong></span> which is <span>essentially</span> applying another function to transform our data into more measurable containers or windows. The following is an example of the <code class="literal">Hanning window</code> function being applied to an FFT:</p><div class="mediaobject"><img src="/graphics/9781787286450/graphics/b293e36d-0b64-41d9-941f-0e6a04a6c1d2.png" /></div><p>Hanning window being applied to FFT magnitudes</p><p>By applying this window function, we now have the data divided into distinct channels we can measure. This allows us to read the frequency signature of an audio signal at any point in time. In the next section, we will look at how all this theory is put into practice when we examine an example of audio signal visualization.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note136"></a>Note</h3><p>If you are interested in understanding the mathematics, there is plenty of information available online about the subject of FFT and windowing. Here is a great link that explains the basic mathematics of FFT:<a class="ulink" href="https://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/" target="_blank">https://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/</a>.</p></div></div></div>