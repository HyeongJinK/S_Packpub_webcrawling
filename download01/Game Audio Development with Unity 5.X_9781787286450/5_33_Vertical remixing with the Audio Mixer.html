<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="05lvl1sec35"></a>Vertical remixing with the Audio Mixer</h2></div></div><hr /></div><p>Fortunately, the Unity Audio Mixer <span>provides</span> us with an excellent toolset in order to perform vertical remixing of the adaptive music we want in our scene. In fact, the current Unity mixer (at the time of writing) would really provide little use if we wanted to do some form of horizontal re-sequencing. This is what we will look at in <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>FMOD for Dyanmic and Adaptive Audio</em></span>, when we will learn to use horizontal re-sequencing techniques for our scenes, adaptive music.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note82"></a>Note</h3><p>Just for clarification, it's not that the Unity Audio Mixer could not implement any of the horizontal re-sequencing techniques, it just isn't well suited to do so.</p></div><p>The capabilities of the mixer allow us to easily breakup our music into distinct layers using snapshots. Just as we did at the end of <a class="link" href="#" linkend="ch04">Chapter 4</a>, <span class="emphasis"><em>Advanced Audio Mixing</em></span>, when we created the dynamic music mix. After we have the snapshots of the different music changes, as we have already seen in previous chapters, it is a simple matter to do transitions. As we will see, the tricky part in vertical remixing is just choosing your reference and control points. Let's take a look at how we can compose some vertical remixed layers with the Audio Mixer here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the editor and search for the <code class="literal">MusicMix</code> scene in the <strong class="userinput"><code>Project</code></strong> window. After you find the scene, double click on the scene to open it up. If you are prompted to save your current scene, then do so.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip83"></a>Note</h3><p>You can search for any asset, game object, or component in the various windows by just using the search box at the top of the window. Just start typing your search term and the window will automatically filter its contents.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>From the menu, select <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Audio Mixer</code></strong> to open or focus on the mixer window. Select the <strong class="userinput"><code>MusicMix</code></strong> mixer from the list of mixers and then the <strong class="userinput"><code>level1</code></strong> snapshot from the list of snapshots. Your window should match the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/af71462e-a011-4cbf-a859-1243f3d2911e.png" /></div><p>Viewing the MusicMix mixer and level1 Snapshot in the Audio Mixer window
</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Notice how the <code class="literal">MusicMix</code> mixer already has the level or snapshot layers we need to define. If you click through the various snapshots, you will see the settings change as well.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note84"></a>Note</h3><p>As much as some readers may have wanted hands-on experience mixing the various layers, explaining the numerous amounts of group changes could have filled almost an entire section on its own.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Click on the <span>play</span> button to start the scene. Then, press <span class="emphasis"><em>Esc</em></span> to unlock the mouse while the scene is running and then click on the <strong class="userinput"><code>Edit in Play Mode</code></strong> button at the top of the <strong class="userinput"><code>Audio Mixer</code></strong> window. Switch between the various snapshots to hear the change in music. Notice how the snapshots have multiple variations, including tempo (BPM) and changes in instrument focus.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip85"></a>Note</h3><p>In order to change tempo, we used the same pitch adjustment trick from <a class="link" href="#" linkend="ch04">Chapter 4</a>, <span class="emphasis"><em>Advanced Audio Mixing</em></span>. Recall, the trick is to adjust the pitch by a ratio of the desired BPM over the actual recorded BPM. The formula is shown again for reference:</p><p><span class="emphasis"><em>pitch% = Desired BPM / Actual BPM * 100</em></span></p></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>As you move through the snapshots, also click on each of the instrument groups and pay attention to the effects, volume, and pitch settings. Pay particular attention to the way the <code class="literal">beat</code> group is set and used throughout the various layers (snapshots) as shown in the combined image here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/b2d1828d-6dc3-4eec-8971-abed5729769d.png" /></div><p>Vertical remixing of the beat group through the various layers or levels</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note86"></a>Note</h3><p>For the example, we use the beat and drum groups to provide our reference or control points for transitioning between layers. The beating of the drums in both mixes also works to cover harsh changes as we will see later. We will dig more into adaptive music composition and techniques for vertical remixing in <a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>Composing Music</em></span>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Be careful and avoid making any changes to the settings, since they will be saved to the mixer. Instead, listen to the music and remember how each of the snapshots needs to match the trigger levels we defined earlier in the chapter. When you are done listening, stop the scene.</li></ol></div><p>We won't get into <span>any more</span> specific details of the how of vertical remixing at this time. Our intention in this chapter is just to identify the use and implementation of adaptive audio and music. Describing how to vertically remix audio using just the Audio Mixer would be difficult, if not painful. The Audio Mixer lacks the visual display of audio that we would need to talk about with these reference or control points. Instead, we will cover a section on <span>vertical remixing in</span><a class="link" href="#" linkend="ch10">Chapter 10</a>, <span class="emphasis"><em>Composing Music</em></span>. <span>In that chapter, we will work with a tool that can provide us with visual references and cues for vertical mixing. Having said all that, you are still encouraged after we get everything set up in the village scene to try and vertically remix on your own.</span></p><p>So now that we have seen how the vertical remix is composed, let's take a look at setting up the village scene by following the directions here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Find the scene <code class="literal">The_Viking_Village_Chapter_5_Start</code> and drag it onto the <strong class="userinput"><code>Hierarchy</code></strong> window so that both scenes are loaded, as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/516307ca-145c-42dd-b4ec-835aec5560b0.png" /></div><p>Working with two scenes in the Hierarchy window</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Drag the <code class="literal">Instruments</code> object from the <strong class="userinput"><code>MusicMix</code></strong> scene and drop it onto the <code class="literal">BackgroundMusic</code> object in the village scene (as shown in the screenshot).</li><li>Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the <strong class="userinput"><code>MusicMix</code></strong> scene, and from the context menu, select <strong class="userinput"><code>Remove Scene</code></strong>. You will be prompted to save your changes, but don't save your changes. You may want to come back and work with the mix scene later.
</li></ol></div><p> </p><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Select the <code class="literal">AdaptiveAudioManager</code> object in the <strong class="userinput"><code>Hierarchy</code></strong> window. Then in the <strong class="userinput"><code>Inspector</code></strong> window, expand the <strong class="userinput"><code>Snapshot Levels</code></strong> list and enter a size of <code class="literal">5</code>. This will expand the list to five items or elements. Set each of the levels to the appropriate level snapshot of the <code class="literal">MusicMixer</code> as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/5e63a7e8-b71b-4899-a19f-07d4426a89ab.png" /></div><p>Setting up the Snapshot levels on the Adaptive Audio Manager
</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Open up the <strong class="userinput"><code>Audio Mixer</code></strong> window and <span>select</span> the <strong class="userinput"><code>MusicMix</code></strong> mixer. Then, right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the <code class="literal">level2</code> snapshot. Then from the context menu, select <strong class="userinput"><code>Set as start Snapshot</code></strong> as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/f76b1b3e-c169-431c-9039-bd91e3331e59.png" /></div><p>Setting the MusicMix mixer starting snapshot to level2</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Press play to start the scene. Move around the scene while paying special attention to how the music changes as you move from trigger level area to area. Try and get to all of the five different areas. As you do, pay special attention to how the music transitions from one layer/level to the next.</li><li>At this point, if you want to change the mix in a particular area, press <span class="emphasis"><em>Esc</em></span> to unlock the mouse and then click on the <strong class="userinput"><code>Edit in Play Mode</code></strong> button to turn on editing. Make the changes you feel are appropriate to the area and when you are done, click on the <strong class="userinput"><code>Edit in Play Mode</code></strong> button again to turn off editing. Then, you can move around the scene more.
</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip87"></a>Note</h3><p>When you click on the Edit in Play Mode button and engage editing, mixer transitions become disabled. Therefore, when making edits to dynamic or adaptive mixes, such as the music and wind, be sure to keep the audio listener (the player) in the scene stationary while making edits. Turn off editing, and move the listener (player) when you want to edit the settings of a different area of the scene. Otherwise, if you move around while in edit mode, you won't hear the correct dynamic/adaptive transitions and your mix will sound off in actual play mode.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>After you are done <span>making</span> your own edits, stop the scene and of course save your changes.</li></ol></div><p>As you can see, setting up that exercise was quite simple. After all, most of the work had already been done in mixing the instruments into the layers or levels. You would think that there certainly must be a lot of code doing the work in the <code class="literal">AdaptiveAudioanager</code> script. We will open up the script to see how all those adaptive changes take place:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the editor and find the <code class="literal">AdaptiveAudioManager</code> script in the <strong class="userinput"><code>Project</code></strong> window. Double-click on the script to open it in your preferred code editor and it is also shown here for review:</li></ol></div><pre class="programlisting">using UnityEngine;
using UnityEngine.Audio;

<span class="strong"><strong>public class AdaptiveAudioManager : Singleton&lt;AdaptiveAudioManager&gt;</strong></span> 
{
    public int currentAdaptiveLevel;
    <span class="strong"><strong>public AudioMixerSnapshot[] snapshotLevels;</strong></span>
    public float transitionTime = 1;

    public void AdjustAudioLevel(int level)
    {
        currentAdaptiveLevel = level;

        <span class="strong"><strong>snapshotLevels[currentAdaptiveLevel-1].TransitionTo(transitionTime);</strong></span>
    }
}</pre><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Here is a breakdown of the <span>highlighted</span> sections of code that are the most important:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">public class AdaptiveAudioManager : Singleton&lt;AdaptiveAudioManager&gt;</code> : Notice how we are extending the <code class="literal">AdaptiveAudioManager</code> not from <code class="literal">MonoBehaviour</code> but rather a class called <code class="literal">Singleton</code>. <code class="literal">Singleton</code> is a programming pattern that essentially says we only ever want to have one type of object and that object should be globally accessible from all our code. By extending <code class="literal">AdaptiveAudioManager</code> from <code class="literal">Singleton</code>, we are only allowing one object of its type to be created and it will be accessible from everywhere in other parts of our code using a special <code class="literal">Instance</code> property. Remember when we passed the level from the trigger to the audio manager with this line of code: <code class="literal">AdaptiveAudioManager.Instance.AdjustAudioLevel(triggerLevel)</code>.</li><li style="list-style-type: disc"><code class="literal">public AudioMixerSnapshot[] snapshotLevels;</code>: This line of code is just a definition for the array or list of snapshot levels we want the audio manager script to control.</li><li style="list-style-type: disc"><code class="literal">snapshotLevels[currentAdaptiveLevel-1].TransitionTo(transitionTime);</code>: This line of code is what indexes into the list of snapshot levels and calls the <code class="literal">TransitionTo</code> method of the <code class="literal">Snaphot</code>. The reason we subtract 1 from the <code class="literal">currentAdaptiveLevel</code> is because we always start counting at zero in programming. So, the first element in the snapshot levels array is actually at index 0. Aside from that, we have already covered the <code class="literal">TransitionTo</code> method in the last chapter.</li></ul></div></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip88"></a>Note</h3><p>Be aware that most of the samples in this book are used to demonstrate concepts and are not a how to on writing robust production code. In some cases, some robust error checking has been done but only for the safety of the demo. If you will be scripting code for your game, do yourself a favor and read a book or blog on coding best practices.</p></div><p>Hopefully, as you looked at the simplicity of the preceding code, and the code we needed for setting up the triggers, you can realize how well Unity is suited for quick development. It also goes to show how well suited the Unity Audio Mixer is for supporting adaptive music with vertical remixing. For the next section, we are going to look at how well the Audio Mixer can support adaptive sound.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip89"></a>Note</h3><p><strong class="userinput"><code>Q</code></strong><strong class="userinput"><code>UIZ TIME</code></strong>
Which adaptive music technique would best match each of these situations:
a) <span class="strong"><strong>Horizontal re-sequencing</strong></span>
b) <span class="strong"><strong>Horizontal re-sequencing with Stingers</strong></span>
c) <span class="strong"><strong>Vertical remixing</strong></span>
1) Your team is fairly new to game development so it is decided to outsource the music for your game. Which means the music will come in completely composed and each piece will change dramatically. Which option works best: a, b, or c?
2) Your team has experience working with the Audio Mixer and have found a number of instrumental sounds they like. Which option works best: a, b, or c?
3) The game you are developing needs event-driven full changes to the music (tempo, harmony, and instrumentation). Which option works best: a, b, or c?
The answers to the quiz will be provided at the end of the chapter.</p></div></div>