<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="07lvl1sec47"></a>Adaptive music with FMOD</h2></div></div><hr /></div><p>As the last part of this <span>journey</span> to replicate the Unity Audio Mixer examples, we will look at how <span>FMOD</span> can be used to develop adaptive music. If you recall, in our adaptive music example, we altered the tune depending on what area the player was in or moving through. With Unity, we did this using a system of area triggers that matched the footstep system and an adaptive music technique called vertical remixing. In <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Using the Audio Mixer for Adaptive Audio</em></span>, we used vertical remixing because the technique paired well with the capabilities of the Audio Mixer. As we discussed, the Unity mixer was not well suited for the other horizontal re-sequencing techniques that we also discussed in <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Using the Audio Mixer for Adaptive Audio</em></span>. Fortunately, FMOD is particularly well suited for using horizontal re-sequencing techniques and this is something we will spend a lot of time working with in the last sections of this chapter.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note126"></a>Note</h3><p>If you only glanced over <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Using the Audio Mixer for Adaptive Audio</em></span>, then it is strongly recommended at this point that you review that chapter thoroughly before continuing. Of course, it still may not be a bad idea for readers that did work through that chapter to quickly review it, as well.</p></div><p>Before we start pulling in assets and laying audio tracks, let's look to some of the sources and techniques we used to derive the music pieces for the adaptive music. First off, the music we are using for our game will be a couple of tracks from <a class="ulink" href="http://freemusicarchive.org" target="_blank">freemusicarchive.org</a> , which represent the taste and theme proposed by the designer. Second, we don't want to use the entire tracks and actually just want to use elements from each track to represent the five different levels of audio we need. Fortunately, FMOD gives us the capability for us to spliting out those elements, and example of how this is done is shown here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open FMOD <strong class="userinput"><code>Event Editor</code></strong> and right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the <strong class="userinput"><code>Events</code></strong> tab, and from the menu, select <strong class="userinput"><code>New 2D Event and</code></strong> rename the new event <code class="literal">music</code>.</li><li>Locate and open the <code class="literal">Chapter_7_Music</code> folder from the book's downloaded source code using your file explorer. Select the <code class="literal">Artofescapism_-_Watching_from_Red_Hill.mp3</code> file and drag it into the <strong class="userinput"><code>Event Editor</code></strong> and drop it onto the new events <code class="literal">Audio 1</code> track. Make sure to align the clip so that it starts at <code class="literal">0</code>.</li><li>Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] in the black region above the track, and from the menu, select <strong class="userinput"><code>Add Tempo Marker</code></strong>. This will add a marker with a BPM number and time signature. Double-click on the number <strong class="userinput"><code>120</code></strong> and change it to <code class="literal">99</code>. Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] again in the black region to create a new loop region. Move the <strong class="userinput"><code>Tempo</code></strong> marker and <strong class="userinput"><code>Loop Region</code></strong> marker to the start of the audio, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/6e5f61e1-e352-4cf7-a9ac-cc63ec58ee09.png" /></div><p>Moving the Tempo and Loop markers to the start of the audio
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip127"></a>Note</h3><p>You may find it helpful to zoom into the tracks view by using the menu <strong class="userinput"><code>View</code></strong> | <strong class="userinput"><code>Zoom In</code></strong>, <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>]</em></span> (<span class="emphasis"><em>command</em></span> + <span class="emphasis"><em>]</em></span> on Mac) or the mouse to shrink the overview window in order to position the markers at the start of the sound, as shown in the preceding screenshot.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Select the <strong class="userinput"><code>BEATS</code></strong> timing on the <span>timing</span> control, as shown in the <span>preceding</span> screenshot. This will switch the timing from seconds to beats, which is especially useful when looping and sub-mixing music. If you previously zoomed in, be sure to zoom out to the entire clip now (<strong class="userinput"><code>View</code></strong> | <strong class="userinput"><code>Zoom To Fit</code></strong>). Move the end of the loop region marker using your mouse to the five or fifth measure and then play the event.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip128"></a>Note</h3><p>There are plenty of free tools out there that will allow you to quickly find the BPM or tempo of a song. As previously mentioned, BPM Counter for Windows works well. There are also plenty of free bpm counters available for Mac, Android, and iOS. Just use your favorite search engine or app store to find one.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>The end result should be a very good loop of the first part of the clip. If the timing sounds off, make sure you set the tempo marker to the start of the audio. Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the loop marker line on the clip and from the menu select <strong class="userinput"><code>Split</code></strong>. Do this again for the end of the clip as well. This is shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/2bf4b582-e3df-4efa-b314-7ffaed1150c9.png" /></div><p>Extracting a trimmed looping clip from the original clip</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on the new clip, and from the menu, select <strong class="userinput"><code>Replace Audio with Trimmed Copy</code></strong>. This will create a new trimmed down version of the extracted loop.
</li><li>When you are done, delete the <code class="literal">music</code> event and then recreate. This will quickly clean up the work area, so we can prepare for the real music setup. Be sure to also assign the <code class="literal">music</code> event to the <strong class="userinput"><code>Master Bank</code></strong>.</li></ol></div><p>The example exercise is the same process that was used to extract all the looping clips we will use to build our adaptive audio example. Unfortunately, we won't have time to create all those examples within the book, but the preceding exercise should show you a useful technique if you have to work with music tracks in the future.</p><p>Now that we understand how the various looping clips were isolated and extracted from the two music tracks our designer selected, we can proceed to add them to our <code class="literal">music</code> event here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Return to the <code class="literal">Chapter_7_Music</code> folder and this time drag in the <code class="literal">Music_Level_1.wav</code> file and drop it onto the <code class="literal">music</code> events <code class="literal">Audio 1 track</code>. Adjust the clip so that it starts at the beginning of the track.</li><li>Continue step 1 for each of the other <code class="literal">Music_Level</code> clips in the folder by their respective order as defined by the ending number. Then, after you drag all the files in your track, your view should resemble the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/deb5a28f-a827-4ad3-8609-17f94ebbdcfb.png" /></div><p>Aligning the Music_Level clips on the Audio 1 track</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Play the event and listen to how the music plays through the various levels. Don't worry about the messy transition point between level 3 and 4, we will take care of that later. What we want to do next is create a control parameter that will set which music level clip plays at each adaptive level we have <span>created</span> in our game.</li><li>Click the <strong class="userinput"><code>+</code></strong> button <span>beside</span> the <strong class="userinput"><code>Timeline</code></strong> and from the menu select <strong class="userinput"><code>Add Parameter</code></strong>. When prompted by the <strong class="userinput"><code>Add Parameter</code></strong> dialog, name the parameter <code class="literal">Adaptive_Level</code> and set the range from [<span class="strong"><strong>1-5</strong></span>] just as you did in the footsteps example.
</li></ol></div><p>Â </p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Select the <strong class="userinput"><code>Timeline</code></strong> tab again to return to the view of the clips. Right-click [<span class="emphasis"><em>Ctrl</em></span> + click on Mac] on each of the clips, and from the menu, select <strong class="userinput"><code>New Loop Region</code></strong>. Do this for all five clips. Then, drag each of the loop regions down in the marker region so that the loops are staggered vertically. This is shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/7d99c463-6a9f-4752-9c24-d3c0ecf9d8e0.png" /></div><p>Adding and adjusting the loop regions</p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Select the first loop region above the <code class="literal">Music_Level_1</code> clip and then look to the <strong class="userinput"><code>Conditions</code></strong> panel of the deck region. Click on the <strong class="userinput"><code>Add Condition</code></strong> button, and from the menu, select <strong class="userinput"><code>Add Parameter Condition</code></strong> | <strong class="userinput"><code>Adaptive_Level</code></strong>. Set the <strong class="userinput"><code>Adaptive_Level</code></strong> conditions bar to the range of 1 - 1.5<span class="strong"><strong>,</strong></span> as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/c23409f7-f4ec-4566-9ba4-aec01d9e8fa7.png" /></div><p>Adding a looping parameter condition to the loop region
</p><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Of course you will need to do this for each of the other looping regions except be sure to the condition range to encompass the level. For instance, the looping region for level 2 would have a conditional range from 1.5 - 2.5. Level 3 would be 2.5 - 3.5 and so on. After you are done setting the looping condition for each region, build and save the project.</li><li>Go to the Unity editor now and locate the <code class="literal">AdaptiveAudioManager</code> object in the <strong class="userinput"><code>Hierarchy</code></strong> window. Add an <strong class="userinput"><code>FMOD Studio Event Emitter</code></strong> component to the object and set its parameters to match those in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/7a720bdf-450a-4470-8446-8857f52fcca9.png" /></div><p>Setting up the Event Emitter and Adaptive Audio Manager components</p><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>After you are done <span>setting</span> the parameters, run the scene by pressing play. Wander <span>around</span> the scene as you normally would and pay particular attention to the music changes. After you are done testing, stop the scene and then save all your changes.</li></ol></div><p>Did you notice how the music continues looping depending on the different area of the level you are wandering? This is what we want; however, you may have also noticed that the music never goes back down in levels and it easily gets out of sequence. We will fix those issues in the next section.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note129"></a>Note</h3><p><strong class="userinput"><code>QUIZ TIME</code></strong></p><p>Which of the following adaptive music techniques can FMOD support:
a) Vertical remixing
b) Cross fading
c) Phrase branching
d) Musical demarcation branching
e) Bridge transitions
f) Singer-based sequencing</p><p>Answers as always we be provided before the end of the chapter. Hint, you may want to refer back to <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Using the Audio Mixer for Adaptive Audio.</em></span></p></div></div>