<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="08lvl1sec52"></a>Visualization performance and windowing</h2></div></div><hr /></div><p>As we have seen, we are calling <code class="literal">GetSpectrumData</code> in the <code class="literal">Update</code> method, not once but twice. Now that you understand some of what is happening under the covers, you can likely appreciate that those calls are quite expensive, which they are. Of course, there are some things we can do to make those calls run quicker, but as always there are trade-offs and your visualizations could suffer. Although, if your game scene is running at a poor frame-rate that really is not much better.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip139"></a>Note</h3><p>If you wanted to run an audio visualization through a game you built for a mobile platform, such as phone, you would likely want to turn the number of samples down to 64.</p></div><p>Let's look at some settings we can <span>tweak</span> to improve the performance of the visualizer and the effect they have on the audio visualizations by following the instructions given here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go to Unity and set the <strong class="userinput"><code>AudioClip</code></strong> of the <strong class="userinput"><code>Audio Source</code></strong> component to the music track we started with. Then, press play to run the scene. This will be our base or control we will refer back to. Look and listen for a while, and when you are happy or you have seen enough, stop the scene.</li><li>This time change the <strong class="userinput"><code>Sample No</code></strong> to <code class="literal">64</code> on the <strong class="userinput"><code>Visualize Sound Manager</code></strong> component. Run the scene again and look at the differences in the way the visualization has changed. You will likely see a more responsive visualization but the cubes to the left (red, magenta, and purple) will almost always be active. This is because the lower frequency bins had to grow in size to encompass more of the spectrum. You can see this by expanding the <strong class="userinput"><code>Bin Range</code></strong> parameter as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/506e0285-1768-476a-9dea-661cc17ef66c.png" /></div><p>Bin Range when Sample No is set to 64
</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Stop the scene now and change the value back to <code class="literal">512</code>. Run the scene again and notice the difference in <strong class="userinput"><code>Bin Range</code></strong> sizes and how this affects the visualization. Stop the scene after you are done reviewing.</li><li>Now, set the <strong class="userinput"><code>Sample No</code></strong> to <code class="literal">4096</code> and run the scene. Depending on your system, you may notice two things. First, the visualizer is barely crawling along now and the frame-rate is low. Second, you are now seeing the opposite visualization to what we saw with a setting of <code class="literal">64</code>. You can confirm this by looking at the <strong class="userinput"><code>Bin Range</code></strong> again, and this time, you will see very small ranges. So small, that the left cubes in the visualization don't even move.</li><li>At this point, you can try different settings in between 64-4096 for the <strong class="userinput"><code>Sample No</code></strong> and run the scene again. Just remember that the <strong class="userinput"><code>Sample No</code></strong> needs to be a power of two (that is, 64, 128, 256, 512...).</li></ol></div><p>
As you have seen, the <strong class="userinput"><code>Sample No</code></strong> can have a significant affect on how the visualization looks and runs, so it is important you understand how to set or adjust that parameter. Of course, there is one last parameter that we need to cover that also can influence the visualization and, to a lesser extent, performance, and that is the FFT window setting.</p><p>If you remember back to our <span>discussion</span> about how FFT transforms the signal, there was one last step we did to make the data more readable called windowing. You can think of windowing as just applying a smart filter function that cleans up the data. However, a windowing function typically is specialized to a frequency range and different window functions will clean the data differently. As well, the various window functions will perform differently depending on the type of signal being processed. While this all sounds quite complicated, and it is, fortunately we can quickly see the differences of this by just changing the FFT window parameter on the visualizer. Follow the directions, to test the changes to the FFT window parameter:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Go back and change the <strong class="userinput"><code>AudioClip</code></strong> on the <strong class="userinput"><code>Audio Source</code></strong> to the <code class="literal">sine-wave-50hz</code> file. For this example, it will be easier to see the differences by starting out with just a simple audio signal.</li><li>Change the <strong class="userinput"><code>FFT Window</code></strong> parameter on the V<strong class="userinput"><code>isualize Audio Manager</code></strong> component to <strong class="userinput"><code>Rectangular</code></strong>. Then, run the scene and notice how the visualization looks. Stop the scene.</li><li>Repeat step 2 for each of the different windowing functions (from <strong class="userinput"><code>Triangle</code></strong> to <strong class="userinput"><code>Blackman Harris)</code></strong> and notice how they alter the visualization.
</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note140"></a>Note</h3><p>As you can see, the differences can be quite substantial and you may want to alter the <strong class="userinput"><code>FFT Window</code></strong> to produce different behaviors based on song or something else entirely.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now, repeat step 3 again, but this time also adjust the <strong class="userinput"><code>Sample No</code></strong> to a value of <span class="strong"><strong>64</strong></span>, <span class="strong"><strong>512,</strong></span> or <span class="strong"><strong>1024</strong></span> and run them all again.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip141"></a>Note</h3><p>Depending on your system, you may notice differences in performance between the various windowing functions by turning on the <strong class="userinput"><code>Stats</code></strong> window. Just click on the <strong class="userinput"><code>Stats</code></strong> button at the top of the <strong class="userinput"><code>Game</code></strong> view to turn the window on as the scene is running. Then, look for the Graphics / FPS (frames per second) performance stat. Ideally, you never want your FPS to drop below 30.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Go back and try the same exercise with different sine waves or music clips. At this point, there is no right and wrong answers to what setting choices you make as it will come down to your visual preference or style choice.</li></ol></div><p>We have spent a significant amount of time explaining an advanced concept in this chapter. However, spending the time now to understand the internals of how the audio visualization works will help us when we go to build new visualizations later. In the next section, we will extend our growing cubes sample with a bit of dramatic lighting.</p></div>