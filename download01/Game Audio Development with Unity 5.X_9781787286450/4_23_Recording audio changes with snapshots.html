<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="04lvl1sec26"></a>Recording audio changes with snapshots</h2></div></div><hr /></div><p>An Audio Mixer snapshot is a <span>way</span> to record and save the <span>complete</span> state and settings of the mixer. A snapshot can then be restored later during editing or at runtime, and it is also possible to transition between multiple snapshots. You can use snapshot transitions for changes in a level, different rooms, or other effects. Let's take a look at how we can record and save a snapshot and then use it in play mode by following the example here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open up the Unity editor and load the <code class="literal">Viking Village</code> project. If you have been following along through the book, you can continue using the <code class="literal">GameAudio</code> project where we left it in the last chapter.</li><li>From the menu, select <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Import Package</code></strong> | <strong class="userinput"><code>Custom Package;</code></strong> this will open the <strong class="userinput"><code>Import package</code></strong> dialog. Use the dialog to find where you downloaded the book's source code to and open the <code class="literal">Chapter_4_Assets</code> folder. Inside that folder, select the <strong class="userinput"><code>Chapter_4_Start.unitypackage</code></strong> and click on <strong class="userinput"><code>Open</code></strong> to load the package. Follow the import dialog to load all the assets into Unity.</li><li>Open the <strong class="userinput"><code>Project</code></strong> window <code class="literal">Assets/GameAudio/Scenes</code> folder and double-click on the <strong class="userinput"><code>The_Viking_Village_Chapter4_Start.scene</code></strong> to open the scene in Unity.</li><li>From the <strong class="userinput"><code>Project</code></strong> window, select and double-click to open the <strong class="userinput"><code>Master</code></strong> mixer from the <code class="literal">Mixers</code> folder. This should open the <strong class="userinput"><code>Audio Mixer</code></strong> window if it is not already open at the bottom of the editor. Select the Master mixer from the Mixers list. Your window should match the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/b9e79d59-d927-4e06-87bc-4317f6dc2d57.png" /></div><p>Audio Mixer loaded with sub mixers</p><p>If you cannot see the group connectors on in the mixer view, you can enable/disable them by opening the window menu and selecting the Show group connections option.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Click on the plus icon next to the <strong class="userinput"><code>Snapshots</code></strong> list to create a new <strong class="userinput"><code>Snapshot</code></strong>. Name the new snapshot, <code class="literal">Snapshot1</code>. Select the <strong class="userinput"><code>Snapshot1</code></strong> entry in the list and then set the Ambient group to <code class="literal">20 dB</code>. Click on the top Snapshot in the list and notice how the Ambient group volume drops immediately.</li><li>Press play to run the scene. Unlock the mouse by typing <span class="emphasis"><em>Esc</em></span> and then click on the <strong class="userinput"><code>Edit in Play Mode</code></strong> button at the top of the <code class="literal">Audio Mixer</code> window. Click on the <strong class="userinput"><code>Snapshot1</code></strong> and notice the immediate change in the ambient sound volume.</li><li>At this point, you can make other changes to the mixer settings using the new snapshot as they will automatically be saved. Try switching back and <span>forth</span> between the original and new snapshot as you move around the scene.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note58"></a>Note</h3><p>The one thing you will immediately notice as you make changes is that you don't have to do anything besides selecting a snapshot and then making changes. These changes will be saved automatically. This ability to quickly make edits can, and likely will, get you into trouble. This makes it likely that you will overwrite changes you thought you were saving into different snapshots, for instance. The best way to overcome this is to be aware of which snapshot you have selected whenever you make edits. It also helps if you save your scene at points where you are happy with a particular mix.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>When you are done making changes and recording them to <code class="literal">Snapshot1</code>, press the play button to stop the scene.</li></ol></div><p>Well, as you can see, creating a snapshot and saving the mixer state is quite easy; in some ways, perhaps too easy. In the next section, we will look at how you can programmatically recall the state of a snapshot at runtime.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="04lvl2sec22"></a>Pausing the scene</h3></div></div></div><p>Now that we have seen <span>how</span> easy it is to create a snapshot, we can see a real-world example of how to recall a saved snapshot programmatically and at runtime, by building a pause feature. If you have played any single-player game, you will certainly be familiar with some form of pause button that pauses or freezes game play. In our example, the pause button will freeze the game, but will also adjust the audio to let the player know the game is paused. Let's see this in action by following the exercise here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the <strong class="userinput"><code>Audio Mixer</code></strong> window and click on the on the <code class="literal">Snapshot</code> in the <strong class="userinput"><code>Snapshots</code></strong> list. Rename the snapshot, <code class="literal">Unpaused</code>. Click on the <strong class="userinput"><code>Snapshot1</code></strong> item from the <strong class="userinput"><code>Snapshots</code></strong> list and rename it <code class="literal">Paused</code>.</li><li>From the menu, select <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Create Empty</code></strong>. This will create a new object in the <strong class="userinput"><code>Hierarchy</code></strong> window. Select this object, and then in the <strong class="userinput"><code>Inspector</code></strong> window, rename the object <code class="literal">GameMenu</code> and reset the <strong class="userinput"><code>Transform</code></strong> to <code class="literal">0</code>, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/24b4ae71-01c0-48ab-842e-ccc566846e59.png" /></div><p>GameMenu with zero Transform</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Click on the <strong class="userinput"><code>Add Component</code></strong> button at the bottom of the <strong class="userinput"><code>Inspector</code></strong> and type <code class="literal">Game Menu</code> in the search field. Select the <strong class="userinput"><code>Game Menu</code></strong> component from the list to add it to the object.</li><li>Then, click on the target icon beside the <strong class="userinput"><code>Unpaused</code></strong> slot of the <strong class="userinput"><code>Game Menu</code></strong> component, and then select the <code class="literal">Unpaused</code> Audio Mixer snapshot from the <strong class="userinput"><code>Select AudioMixerSnapshot</code></strong> dialog as shown in the screenshot here:
</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/c13c25de-6c59-455e-b2d2-d139540098c6.png" /></div><p>Setting the Unpaused snapshot slot</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Repeat the <span>procedure</span> for the <strong class="userinput"><code>Paused</code></strong> slot on the <strong class="userinput"><code>Gamemenu</code></strong> component. Set the slot to use the <strong class="userinput"><code>Paused</code></strong> snapshot we renamed earlier.</li><li>Run the scene by pressing the play button. Pause the scene by pressing the <span class="emphasis"><em>P</em></span> key. This will pause the game but the audio will still play, and you should notice a change in the ambient sounds becoming louder.</li><li>Obviously, having the ambient sound grow louder as we enter pause is not what we want. We probably want the audio overall to be more quiet. Click on the <strong class="userinput"><code>Edit in Play Mode</code></strong> button at the top of the <strong class="userinput"><code>Audio Mixer</code></strong> window.</li><li>Select the <code class="literal">Paused</code> snapshot from the <strong class="userinput"><code>Snapshots</code></strong> list. Reset the <strong class="userinput"><code>Ambient</code></strong> group attenuation (volume) to around -9 to -12 dB and set the <strong class="userinput"><code>Master</code></strong> volume to be around <code class="literal">-20</code>.</li><li>Now, press the <span class="emphasis"><em>P</em></span> key to activate the pause mode and notice that the scene becomes much quieter. Feel free to adjust the <strong class="userinput"><code>Paused</code></strong> snapshot audio levels or other <strong class="userinput"><code>Audio Mixer</code></strong> settings to your preference. When you are done editing, stop running the scene and save your changes.</li></ol></div><p>Now that we have seen the full example run, let's open up the <strong class="userinput"><code>Game Menu (Script)</code></strong> to see how the snapshots are switched at runtime by following the directions here:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Open the <code class="literal">Game Menu</code> script in your preferred code editor by selecting the gear icon beside the component and then selecting <strong class="userinput"><code>Edit Script</code></strong> from the context menu as shown in the screenshot here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787286450/graphics/371c9806-cb21-441a-ac84-21454c74251d.png" /></div><p>Opening the component context menu and selecting Edit Script</p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>This will <span>open</span> your script in your preferred editor. The script is shown here for a quick review as well:</li></ol></div><pre class="programlisting">using UnityEngine;
using UnityEngine.Audio;  //addition of Audio namespace

public class GameMenu : MonoBehaviour {
    public AudioMixerSnapshot paused;
    public AudioMixerSnapshot unpaused;

    void Start()
    {
        if(paused == null || unpaused == null)
        {
            this.enabled = false;  //disable the component if missing snapshots
        }
     }

     // Update is called once per frame
     void Update () {
         if (Input.GetKeyDown(KeyCode.P))
         {
             Pause();
         }
      }

      private void Pause()
      {
          Time.timeScale = Time.timeScale == 1 ? 0 : 1;
          if (Time.timeScale &gt; 0) //if time is not paused
          {
              unpaused.TransitionTo(.01f);
          }
          else
          {
               paused.TransitionTo(.01f);
          }
      }
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>As we covered in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Scripting Audio</em></span>, this script is consistent with the standard Unity script. How about we go through and <span>discuss</span> the main points of interest here:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><code class="literal">using UnityEngine.Audio;</code>: This helps to add in or use the Audio library in order to work with snapshots.</li><li style="list-style-type: disc"><code class="literal">this.enabled = false;</code>: This line of code will disable the component. We do this if either the paused or unpaused snapshots are missing, since the reset of our code will just break. Disabling a component means that the <code class="literal">Update</code> method will never run.</li><li style="list-style-type: disc"><code class="literal">Pause();</code>: This calls the <code class="literal">Pause</code> method, which is listed after the <code class="literal">Update</code> method.</li><li style="list-style-type: disc"><code class="literal">Time.timeScale = Time.timeScale == 1 ? 0 : 1;</code>: The <code class="literal">?</code> denotes a ternary operator, which you can think of as just a shortened form of an if statement. In the line, if the B expression before the <code class="literal">?</code> is true, the value <code class="literal">1</code> is returned. Otherwise, if the expression is false, it returns the value after the <span class="strong"><strong>:</strong></span> or in this case <code class="literal">1</code>.</li><li style="list-style-type: disc"><code class="literal">unpaused.TransitionTo(.01f);</code>: This calls the <code class="literal">TransitionTo</code> method on the <code class="literal">AudioMixerSnapshot</code>, which takes a <code class="literal">float</code> parameter to denote the transition time. In the example, <code class="literal">.01f</code> is used to mean the transition to the <code class="literal">unpaused</code> snapshot should take <code class="literal">.01</code> seconds.</li><li style="list-style-type: disc"><code class="literal">paused.TransitionTo(.01f);</code>: This is exactly the same as the preceding point, except this time it is transitioning to the <code class="literal">paused</code> snapshot.</li></ul></div></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note59"></a>Note</h3><p>The <span class="emphasis"><em>P</em></span> key was used for the pause function, but it is also typical to use the <span class="emphasis"><em>Esc</em></span> key. Since this key is already bound to unlocking the mouse, it only made sense to use the <span class="emphasis"><em>P</em></span> key for our pause action.</p></div><p>The <code class="literal">Game Menu</code> script is really just the start of a game menu script that would manage other things besides pause. Feel free to expand on this script and add other functionality such as displaying a menu interface, for instance. In the next section, we will continue to go into further scripting functionality with the Audio Mixer.</p></div></div>