<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec40"></a>Creating mirrors and reflective surfaces</h2></div></div><hr /></div><p>Specular materials reflect lights <span>when</span><a id="id325209569" class="indexterm"></a> objects are <span>viewed</span><a id="id325209577" class="indexterm"></a> from certain angles. Unfortunately, even the Fresnel reflection, which is one of the most accurate models, does not correctly reflect lights from nearby objects. The lighting models examined in the previous chapters took into account only light sources, but ignored light that is reflected from other surfaces. With what you've learned about shaders so far, making a mirror is simply not possible.</p><p>Global illumination makes this possible by providing PBR shaders with information about their surroundings. This allows objects to have not just specular highlights, but also real reflections, which depend on the other objects around them. Real-time reflections are very costly and require manual setting up and tweaking in order to work. When done properly, they can be used to create mirror-like surfaces, as seen in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/3cdf1d04-3fd6-4d99-b2de-234d060b90e3.png" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec90"></a>Getting ready</h3></div></div></div><p>This recipe will not feature any <span>new</span><a id="id325209606" class="indexterm"></a> shader. Quite the opposite; most of the <span>work</span><a id="id325209614" class="indexterm"></a> is done directly in the editor. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a new scene.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Create a quad (<strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>3D Object</code></strong> | <strong class="userinput"><code>Quad</code></strong>), which will serve as a mirror. I've rotated it to -65 in the Y axis to make it easy to see.</li><li>Create a new material (<code class="literal">MirrorMat</code>) and attach it to the mirror.</li><li>Place the quad in a scene with other objects.</li><li>Create a new reflection probe from <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Light</code></strong> | <strong class="userinput"><code>Reflection Probe</code></strong> and place it in front of the quad:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/f7d57ac0-197c-4693-8f70-7c193e30b6e8.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec91"></a>How to do it...</h3></div></div></div><p>If the preceding steps have been followed correctly, you should have a quad in the middle of your scene, close to a reflection probe. In order to make it in a mirror, some changes need to be made:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Change the <span>shader</span><a id="id325453768" class="indexterm"></a> of the <span>material</span><a id="id325453777" class="indexterm"></a> to <strong class="userinput"><code>Standard</code></strong> and its <strong class="userinput"><code>Rendering Mode</code></strong> to <strong class="userinput"><code>Opaque</code></strong>.</li><li>Change its <strong class="userinput"><code>Metallic</code></strong> and <strong class="userinput"><code>Smoothness</code></strong> properties to one. You should see the material reflecting the sky more clearly.</li><li>Select the reflection probe and change its <strong class="userinput"><code>Size</code></strong> and <strong class="userinput"><code>Probe Origin</code></strong> until it is in front of the quad and it encloses all the objects that you want to reflect.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>To make the item more clear under the <strong class="userinput"><code>Cubemap capture settings</code></strong>, change the <strong class="userinput"><code>Resolution</code></strong> to <code class="literal">2048</code><strong class="userinput"><code>.</code></strong></li><li>Finally, change its <strong class="userinput"><code>Type</code></strong> to <strong class="userinput"><code>Realtime</code></strong> and the <strong class="userinput"><code>Refresh Mode</code></strong> to <strong class="userinput"><code>Every frame</code></strong>. Also, make sure that <strong class="userinput"><code>Culling Mask</code></strong> is set to <strong class="userinput"><code>Everything</code></strong>.</li><li>Your reflection probe should be configured, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/2ee6b822-331a-44fe-be19-a8471f4c0102.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Using <span>these</span><a id="id325454832" class="indexterm"></a> settings, you should <span>see</span><a id="id325454840" class="indexterm"></a> something similar to this:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/2de2fe5e-9d72-4859-babf-d525be5796e0.png" /></div><p>You may notice that the bunny seems larger in the reflection rather than what's beside it. If your probe is used for a real mirror, you should check the <strong class="userinput"><code>Box Projection</code></strong> flag (in this example, setting the box size to <code class="literal">1</code>, <code class="literal">1</code>, <code class="literal">1</code> does a pretty good job of looking like a mirror). If it is used for other reflective surfaces, such as shiny pieces of metal or glass tables, you can uncheck it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec92"></a>How it works...</h3></div></div></div><p>When a shader wants information about its surroundings, it is usually provided in a <span>structure</span><a id="id325454880" class="indexterm"></a> called <span class="strong"><strong>cube</strong></span><span class="strong"><strong>maps</strong></span>. They have been briefly mentioned in <a class="link" href="#" linkend="ch02"><span><span>Chapter 2</span></span></a>, <span class="emphasis"><em>Creating Your First Shader</em></span>, as one of the shader property types, among <code class="literal">Color</code>, <code class="literal">2D</code>, <code class="literal">Float</code>, and <code class="literal">Vector</code>. Loosely speaking, cube maps are the 3D equivalent of 2D textures; they represent a 360-degree view of the world, as seen from a center point.</p><p>Unity previews cube <span>maps</span><a id="id325460893" class="indexterm"></a> with a <span>spherical</span><a id="id325460902" class="indexterm"></a> projection, as seen in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/5be07638-58f1-449b-b112-660aed835983.png" /></div><p>When cube maps are attached with a camera, they are <span>referred</span><a id="id325460923" class="indexterm"></a> to as <span class="strong"><strong>skyboxes</strong></span>, as they are used to provide a way to reflect the sky. They can be used to reflect geometries that are not in the actual scene, such as nebulae, clouds, and stars.</p><p>The reason why they are called cube maps is because of the way they are created: a cube map is made up of six different textures, each one attached to the face of a cube. You can create a cube map manually or <span>delegate</span><a id="id325463134" class="indexterm"></a> it to a <span class="strong"><strong>reflection probe</strong></span>. You can imagine a reflection probe as a collection of six cameras, creating a <span>360-</span>degree mapping of the surrounding area. This also gives you an idea as to why probes are so expensive. By creating one in our scene, we allow Unity to know which objects are around the mirror. If you need more reflective surfaces, you can add multiple probes. You need no further action for the reflection probes to work. The Standard Shaders will use them automatically.</p><p>You should notice that when they are set to <strong class="userinput"><code>Realtime</code></strong>, they render their cube map at the beginning of every frame. There is a trick to make this faster; if you know that part of the geometry that you want to reflect does not move, you can bake the reflection. This means that Unity can calculate the reflection before starting the game, allowing more precise (and computationally expensive) calculations. In order to do this, your reflection probe must be set to <strong class="userinput"><code>Baked</code></strong> and will work only for objects that are flagged as <strong class="userinput"><code>Static</code></strong>. Static objects cannot move or change, which makes them perfect for terrain, buildings, and props. Every time a static object is moved, Unity will regenerate the cube <span>maps</span><a id="id325463165" class="indexterm"></a> for its baked <span>reflection</span><a id="id325463174" class="indexterm"></a> probes. This might take a few minutes to several hours.</p><p>You can mix <strong class="userinput"><code>Realtime</code></strong> and <strong class="userinput"><code>Baked</code></strong> probes to <span>increase</span><a id="id325465002" class="indexterm"></a> the realism of your game. Baked probes will <span>provide</span><a id="id325465009" class="indexterm"></a> very high-quality reflections, environmental reflections, while the real-time ones can be used to move objects such as cars or mirrors. The <span class="emphasis"><em>Baking lights in your scene</em></span> section will explain in detail how light baking works.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec93"></a>See also</h3></div></div></div><p>If you are interested in <span>learning</span><a id="id325209648" class="indexterm"></a> more about reflection probes, you should check these links:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Unity manual about the Reflection Probe: <span><a class="ulink" href="http://docs.unity3d.com/Manual/class-ReflectionProbe.html" target="_blank">http://docs.unity3d.com/Manual/class-ReflectionProbe.html</a></span></li><li style="list-style-type: disc">Box projection and other advanced Reflection Probe settings: <a class="ulink" href="https://docs.unity3d.com/Manual/AdvancedRefProbe.html" target="_blank">https://docs.unity3d.com/Manual/AdvancedRefProbe.html</a></li></ul></div></div></div>