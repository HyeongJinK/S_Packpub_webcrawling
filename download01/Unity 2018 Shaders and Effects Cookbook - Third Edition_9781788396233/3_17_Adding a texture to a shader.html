<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec24"></a>Adding a texture to a shader</h2></div></div><hr /></div><p>Textures can bring our shaders to life very quickly in <span>terms</span><a id="id325209443" class="indexterm"></a> of achieving very realistic effects. In order to effectively use textures, we need to understand how a 2D image is <span>mapped</span><a id="id325209452" class="indexterm"></a> to a 3D model. This process is called texture mapping, and it requires some work to be done on the shader and 3D model that we want to use. Models, in fact, are made out of triangles, which are often referred to as polygons; each vertex on the model can store data that shaders can access and use to determine what to draw.</p><p>One of the most important pieces of information that are stored in vertices is the <span class="strong"><strong>UV data</strong></span>. It <span>consists</span><a id="id325209467" class="indexterm"></a> of two coordinates, <span class="emphasis"><em>U</em></span> and <span class="emphasis"><em>V</em></span>, ranging from 0 to 1. They represent the <span class="emphasis"><em>XY</em></span> position of the pixel in the 2D image that will be mapped to the vertices. UV data is present only for vertices; when the inner points of a triangle have to be texture-mapped, the GPU interpolates the closest UV values to find the right pixel in the texture to be used. The following diagram shows you how a <span class="strong"><strong>2D Texture</strong></span> is <span>mapped</span><a id="id325209488" class="indexterm"></a> to a triangle from a 3D model:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/6f320ac2-a8fe-4a9d-a7aa-be514a24868d.png" /></div><p>The UV data is stored in the 3D model and requires modeling software to be edited. Some models lack the UV component, hence they cannot support texture mapping. The Stanford bunny, for example, was not originally provided with one. </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec40"></a>Getting ready</h3></div></div></div><p>For this recipe, you'll need a 3D model with UV data and its texture. They both need to be imported to Unity before starting. You can do this simply by dragging them to the editor. As the Standard Shader supports texture mapping by default, we'll use this and then explain how it works in detail.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec41"></a>How to do it...</h3></div></div></div><p>Adding a texture to your <span>model</span><a id="id325453533" class="indexterm"></a> using the Standard Shader is <span>incredibly</span><a id="id325453542" class="indexterm"></a> simple, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the Sample Code for this chapter that's provided with this book, you can find the <code class="literal">basicCharacter</code> model which, by default, has UV information embedded into it, making it so that when we attach a material, it will draw the texture using that information.</li><li>Create a new Standard Surface Shader called <code class="literal">TexturedShader</code> by going to the <strong class="userinput"><code>Project</code></strong> tab and then selecting <strong class="userinput"><code>Create </code></strong>| <strong class="userinput"><code>Shaders</code></strong> | <strong class="userinput"><code>Standard Surface Shader</code></strong>. Once created, you can type in a new name for the shader and then press <span class="emphasis"><em>Enter</em></span>. </li><li>For organization's sake, open the shader and change the first line to the following:</li></ol></div><pre class="programlisting">Shader "CookbookShaders/Chapter03/TexturedShader" {</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li> This will allow us to find the shader inside of the organization we have been using so far for this book.</li><li>Create a new material called <code class="literal">TexturedMaterial</code> by going to the <strong class="userinput"><code>Project</code></strong> tab and then selecting <strong class="userinput"><code>Create </code></strong>| <strong class="userinput"><code>Material</code></strong>. Once created, you can type in a new name for the material and then press <span class="emphasis"><em>Enter</em></span> to confirm the change. </li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Assign the shader to the material by going to the <strong class="userinput"><code>Inspector</code></strong> tab and then clicking on the <strong class="userinput"><code>Shader</code></strong> dropdown before selecting <code class="literal">CookbookShaders/Chapter 03/TexturedShader</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/b6edf8f8-58ae-43eb-9e90-3926914b0498.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip28"></a>Note</h3><p>You may also do this by first selecting the material and then dragging the shader file over it in the <strong class="userinput"><code>Project</code></strong> tab.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>After <span>selecting</span><a id="id325453499" class="indexterm"></a> the material, drag your <span>texture</span><a id="id325453508" class="indexterm"></a> to the empty rectangle called <strong class="userinput"><code>Albedo (RGB)</code></strong>. If you are missing some, there are textures located in this chapter's example code that can be used. If you have followed all of these steps correctly, your material <strong class="userinput"><code>Inspector</code></strong> tab should look like this:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/3765816f-7649-49b9-b6a9-87daeab12509.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"></a>Note</h3><p>The Standard Shader knows how to map a 2D image to a 3D model using its UV models and textures used in this example were created by Kenney Vleugels and Casper Jorissen. You can find these and many other public domain game assets at <a class="ulink" href="http://Kenney.nl" target="_blank">Kenney.nl</a>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>To see the UV data in action, in the example code's <code class="literal">Models</code> folder, drag and drop the model into the <strong class="userinput"><code>Hierarchy</code></strong> tab. Once there, double-click on the <span>newly</span><a id="id325209572" class="indexterm"></a> created <span>object</span><a id="id325209580" class="indexterm"></a> to zoom in so that you can see the object:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/d6867234-ae05-4fef-a5b8-df171bbf3861.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Once there, you may go to the <strong class="userinput"><code>Project</code></strong> tab and open up the <code class="literal">Chapter 3 </code>| <code class="literal">Materials</code> folder and drag and drop our <code class="literal">Textured Material</code> onto the character. Note that the model consists of different objects, each of which provides direction to draw in a particular place. This means that you will need to drop the material on each part of the model (<code class="literal">ArmLeft1</code>, <code class="literal">ArmRight1</code>, <code class="literal">Body1</code>, and so on); trying to apply this to the top level of the hierarchy only (<code class="literal">basicCharacter</code>) will not work:</li></ol></div><p></p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/0bd629fe-037a-49d1-b54e-d5e7feaffc6d.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>It is also possible to change <span>what</span><a id="id325209649" class="indexterm"></a> the <span>object</span><a id="id325209657" class="indexterm"></a> looks like by changing the texture that's being used. For instance, if we use the other texture provided (<code class="literal">skin_womanAlternative</code>), we have a very different looking character:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/9d89d4ec-f5f7-4714-8dd9-2876f0d0ef03.png" /></div><p></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip30"></a>Note</h3><p>This is often used in games to provide different kinds of characters with minimal cost. </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec42"></a>How it works...</h3></div></div></div><p>When the Standard Shader is used from the <strong class="userinput"><code>Inspector</code></strong> of a material, the process behind texture mapping is completely transparent to developers. If we want to <span>understand</span><a id="id325453681" class="indexterm"></a> how it works, it's necessary to take a closer look at <code class="literal">TexturedShader</code>. From the <code class="literal">Properties</code> section, we can see that the <code class="literal">Albedo (RGB)</code> texture is <span>actually</span><a id="id325453699" class="indexterm"></a> referred to in the code as <code class="literal">_MainTex</code>:</p><pre class="programlisting">_MainTex ("Albedo (RGB)", 2D) = "white" {} </pre><p>In the <code class="literal">CGPROGRAM</code> section, this texture is defined as <code class="literal">sampler2D</code>, the standard type for 2D textures:</p><pre class="programlisting">sampler2D _MainTex; </pre><p>The following line shows a <code class="literal">struct</code> called <code class="literal">Input</code>. This is the input parameter for the surface function and contains a packed array called <code class="literal">uv_MainTex</code>:</p><pre class="programlisting">struct Input { 
  float2 uv_MainTex; 
}; </pre><p>Every time the <code class="literal">surf()</code> function is called, the <code class="literal">Input</code> structure will contain the UV of <code class="literal">_MainTex</code> for the specific point of the 3D model that needs to be rendered. The Standard Shader recognizes that the name <code class="literal">uv_MainTex</code> refers to <code class="literal">_MainTex</code> and initializes it automatically. If you are interested in understanding how the UV is actually mapped from a 3D space to a 2D texture, you can check out <a class="link" href="#" linkend="ch04"><span>Chapter 5</span></a>, <span class="emphasis"><em>Understanding Lighting Models</em></span>.</p><p>Finally, the UV data is used to sample the texture in the first line of the surface function:</p><pre class="programlisting">fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color; </pre><p>This is done using the <code class="literal">tex2D()</code> function of Cg; it takes a texture and UV and returns the color of the pixel at that position.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"></a>Note</h3><p>The <span class="emphasis"><em>U</em></span> and <span class="emphasis"><em>V</em></span> coordinates go from <span class="emphasis"><em>0</em></span> to <span class="emphasis"><em>1</em></span>, where (0,0) and (1,1) correspond to two opposite corners. Different implementations associate UV with different corners; if your texture happens to appear reversed, try inverting the V component.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec43"></a>There's more...</h3></div></div></div><p>When you import a texture to Unity, you are setting up some of the properties that <code class="literal">sampler2D</code> will use. The most important is the <strong class="userinput"><code>Filter</code></strong> mode, which <span>determines</span><a id="id325453884" class="indexterm"></a> how colors are <span>interpolated</span><a id="id325453893" class="indexterm"></a> when the texture is sampled. It is very unlikely that the UV data will point exactly to the center of a pixel; in all other cases, you might want to interpolate between the closest pixels to get a more uniform color. The following is a screenshot of the <strong class="userinput"><code>Inspector</code></strong> tab of an example texture:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/ec115b70-7dda-4de6-9d15-7f5b57b31b62.png" /></div><p>For most applications, <strong class="userinput"><code>Bilinear</code></strong> provides an inexpensive, yet effective, way to smooth the texture. If you are creating a 2D game, however, <strong class="userinput"><code>Bilinear</code></strong> might produce blurred tiles. In this case, you can use <strong class="userinput"><code>Point</code></strong> to remove any interpolation from the texture sampling.</p><p>When a texture is seen from a <span>steep</span><a id="id325453929" class="indexterm"></a> angle, texture sampling is likely to produce visually unpleasant artifacts. You can reduce them by setting the <strong class="userinput"><code>Aniso Level</code></strong> to a higher value. This is <span>particularly</span><a id="id325453942" class="indexterm"></a> useful for floor and ceiling textures, where glitches can break the illusion of continuity.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec44"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">If you would like to know more about the inner workings of how textures are mapped to a 3D surface, you can read the information <span>available</span><a id="id325453960" class="indexterm"></a> at <span><a class="ulink" href="http://http.developer.nvidia.com/CgTutorial/cg_tutorial_chapter03.html" target="_blank">http://developer.nvidia.com/CgTutorial/cg_tutorial_chapter03.html</a></span>.</li><li style="list-style-type: disc">For a complete list of the options available when importing a 2D texture, you can refer to the following website: <span><a class="ulink" href="http://docs.unity3d.com/Manual/class-TextureImporter.html" target="_blank">http://docs.unity3d.com/Manual/class-TextureImporter.html</a></span></li></ul></div></div></div>