<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec18"></a>Creating a basic Standard Shader</h2></div></div><hr /></div><p>In Unity, when we create a game object, we <span>then</span><a id="id325209450" class="indexterm"></a> attach additional functionality through the <span>use</span><a id="id325209459" class="indexterm"></a> of <span class="strong"><strong>components</strong></span>. In fact, every game object is required to have a Transform component; there are a number of components included in Unity already, and we create components of our own when we write scripts that extend from <code class="literal">MonoBehaviour</code>. </p><p>All the objects that are part of a game contain a number of components that affect their look and behavior. While scripts determine how objects should behave, renderers decide how they should appear on the screen. Unity comes with several renderers, depending on the type of object that we are trying to visualize; every 3D model typically has a <code class="literal">MeshRenderer</code> component attached to it. An object should have only one renderer, but the renderer itself can contain several materials. Each material is a wrapper for a single shader, the final ring in the food chain of 3D graphics. The relationships between these <span>components</span><a id="id325209481" class="indexterm"></a> can be seen in the following diagram:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/98660611-cceb-4786-aa86-f9a536551744.png" /></div><p>Understanding the difference between these components is essential for understanding how shaders work.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec22"></a>Getting ready</h3></div></div></div><p>To get started with this recipe, you will <span>need</span><a id="id325219390" class="indexterm"></a> to have Unity running and must have a project opened. As mentioned before, there will also be a Unity project included with this cookbook, so you can use that one as well and simply add your own custom shaders to it as you step through each recipe. With this completed, you are now ready to step into the wonderful world of real-time shading!</p><p>Before getting into our first shader, let's create a small scene for us to work with:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Let's create a scene by navigating to <strong class="userinput"><code>File </code></strong>| <strong class="userinput"><code>New Scene.</code></strong></li><li>Once you create the scene, create a plane to act as the ground by going to <strong class="userinput"><code>GameObject </code></strong>| <strong class="userinput"><code>3D Objects</code></strong> | <strong class="userinput"><code>Plane</code></strong> in the Unity editor. Next, select the object in the <strong class="userinput"><code>Hierarchy</code></strong> tab and then go into the <strong class="userinput"><code>Inspector</code></strong> tab. From there, right-click on the <strong class="userinput"><code>Transform</code></strong> component and select the <strong class="userinput"><code>Reset Position</code></strong> option:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/e936c127-ee49-4459-8dcd-dcd7ee43503d.png" /></div><p> This will reset the position property of the object to be at <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>:</p><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>To make it easier to see what our shaders will look like when applied, let's add some shapes to visualize what each of our shaders will do. Create a sphere by going to <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>3D Objects</code></strong> | <strong class="userinput"><code>Sphere</code></strong>. Once created, select it and go to the <strong class="userinput"><code>Inspector</code></strong> tab. Next, change the <strong class="userinput"><code>Position</code></strong> to <code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">0</code> so it is <span>above</span><a id="id325209658" class="indexterm"></a> the origin of the <span>world</span> (which is at <code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>) and our previously created plane:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/3477f94c-67e3-4008-9b4e-c5b88a83c872.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Once this sphere is created, create two more spheres, placing <span>them</span><a id="id325209697" class="indexterm"></a> to the left and right of the spheres at positions <code class="literal">-2</code>, <code class="literal">1</code>, <code class="literal">0</code> and <code class="literal">2</code>, <code class="literal">1</code>, <code class="literal">0</code> respectively:</li></ol></div><p></p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/ed897fd9-8a00-4695-9e85-7aadd61d71f1.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Lastly, confirm that you have a directional light (it should be seen in the Hierarchy tab). If not, you can add one by selecting <strong class="userinput"><code>GameObject | Light | Directional Light</code></strong> <span>to make it easier to see the effect of your changes</span> and how your shaders react to light.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>If you are using the Unity project that came with the cookbook, you can open up the <code class="literal">Chapter 2</code> | <code class="literal">Starting Point</code> scene instead as it has been set up already.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec23"></a>How to do it...</h3></div></div></div><p>With our scene generated, we can move on to the <span>shader</span><a id="id325454094" class="indexterm"></a> writing steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Project</code></strong> tab in your Unity editor, right-click on the <code class="literal">Chapter 2</code> folder and select <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>Folder</code></strong>.</li><li><span>Rename</span> the folder that you created as <code class="literal">Shaders</code> by right-clicking on it and selecting <strong class="userinput"><code>Rename</code></strong> from the drop-down list, or by selecting the folder and hitting <span class="emphasis"><em><span class="strong"><strong>F2</strong></span></em></span> on the keyboard.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Create another folder and rename it as <code class="literal">Materials</code>.</li><li>Right-click on the <code class="literal">Shaders</code> folder and select <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>Shader</code></strong> | <strong class="userinput"><code>Standard Surface Shader</code></strong>. Then, right-click on the <code class="literal">Materials</code> folder and select <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>Material</code></strong>.</li><li>Rename both the shader and material as <code class="literal">StandardDiffuse</code>.</li><li>Launch the <code class="literal">StandardDiffuse</code> shader by double-clicking on the file. This will automatically launch a scripting editor for you and display the shader's code.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"></a>Note</h3><p>You will see that Unity has already populated our shader with some basic code. This, by default, will get you a basic shader that accepts one texture in the Albedo (RGB) property. We will be modifying this base code so that you can learn how to quickly start developing your own custom shaders.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Now let's give our shader a custom folder from which it's selected. The very first line of code in the shader is the custom description that we have to give the shader so that Unity can make it available in the shader drop-down list when <span>assigning to</span> materials. We have renamed our path as <code class="literal">Shader "CookbookShaders/StandardDiffuse"</code>, but you can name it whatever you want and rename it at any time so don't worry about any dependencies at this point. Save the shader in your script editor and return to the Unity editor. Unity will automatically compile the shader when it recognizes that the file has been updated. This is what your <span>shader</span><a id="id325454279" class="indexterm"></a> should look like at this point:</li></ol></div><pre class="programlisting">Shader "CookbookShaders/StandardDiffuse" {
  Properties {
    _Color ("Color", Color) = (1,1,1,1)
    _MainTex ("Albedo (RGB)", 2D) = "white" {}
    _Glossiness ("Smoothness", Range(0,1)) = 0.5
    _Metallic ("Metallic", Range(0,1)) = 0.0
  }
  SubShader {
    Tags { "RenderType"="Opaque" }
    LOD 200

    CGPROGRAM
    // Physically based Standard lighting model, and enable shadows on all light types
    #pragma surface surf Standard fullforwardshadows

    // Use shader model 3.0 target, to get nicer looking lighting
    #pragma target 3.0

    sampler2D _MainTex;

    struct Input {
      float2 uv_MainTex;
    };

    half _Glossiness;
    half _Metallic;
    fixed4 _Color;

    // Add instancing support for this shader. You need to check 'Enable Instancing' on materials that use the shader.
    // See https://docs.unity3d.com/Manual/GPUInstancing.html for more information about instancing.
    // #pragma instancing_options assumeuniformscaling
    UNITY_INSTANCING_BUFFER_START(Props)
      // put more per-instance properties here
    UNITY_INSTANCING_BUFFER_END(Props)

    void surf (Input IN, inout SurfaceOutputStandard o) {
      // Albedo comes from a texture tinted by color
      fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color;
      o.Albedo = c.rgb;
      // Metallic and smoothness come from slider variables
      o.Metallic = _Metallic;
      o.Smoothness = _Glossiness;
      o.Alpha = c.a;
    }
    ENDCG
  }
  FallBack "Diffuse"
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Technically speaking, this is a Surface Shader <span>based</span><a id="id325453449" class="indexterm"></a> on <span class="strong"><strong>physically-based rendering</strong></span> (<span class="strong"><strong>PBR</strong></span>). As the name suggests, this type of shader achieves realism by simulating how light physically behaves when hitting objects.</li><li>After your shader is created, we need to connect it to a material. Select the material called <code class="literal">StandardDiffuse</code> that we created in <span class="emphasis"><em>step 4</em></span> and look at the <strong class="userinput"><code>Inspector</code></strong> tab. From the <strong class="userinput"><code>Shader</code></strong> drop-down list, select <strong class="userinput"><code>CookbookShaders</code></strong> | <strong class="userinput"><code>StandardDiffuse</code></strong>. (Your shader path might be different if you chose to use a different path name.) This will assign your shader to your material and make it ready for you to assign to an object.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>To assign material to an object, you can simply click and drag your material from the <strong class="userinput"><code>Project</code></strong> tab to the object in your scene. You can also drag material to the <strong class="userinput"><code>Inspector</code></strong> tab of an object in the Unity editor in order to assign it.</p></div><p>The screenshot of an example is as follows:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/cc82d399-24e0-422c-8d03-7ecbbaf223d0.png" /></div><p>Not much to look at at this point, but our shader development environment is set up and we can now start to modify the shader to suit our needs.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec24"></a>How it works...</h3></div></div></div><p>Unity has made the task of getting your shader <span>environment</span><a id="id325453523" class="indexterm"></a> up and running very easy for you. It is simply a matter of a few clicks and you are good to go. There are a lot of elements working in the background with regard to the Surface Shader itself. Unity has taken the Cg shader language and made it more efficient to write by doing a lot of the heavy Cg code lifting for you. The Surface Shader language is a more component-based way of writing shaders. Tasks such as processing your own texture coordinates and transformation matrices have already been done for you, so you don't have to start from scratch any more. In the past, we would have to start a new shader and rewrite a lot of code over and over again. As you gain more experience with Surface Shaders, you will naturally want to explore more of the underlying functions of the Cg language and how Unity is processing all of the low-level <span class="strong"><strong>graphics</strong></span><span class="strong"><strong>processing unit</strong></span> (<span class="strong"><strong>GPU</strong></span>) tasks <span>for</span><a id="id325453543" class="indexterm"></a> you.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>All the files in a Unity project are referenced independently from the folder that they are in. We can move shaders and materials from within the editor without the risk of breaking any connection. Files, however, should never be moved from outside the editor as Unity will not be able to update their references.</p></div><p>So, by simply changing the shader's path name to a name of our choice, we have got our basic diffuse shader working in the Unity environment, with lights and shadows and all that, just by changing one line of code!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec25"></a>There's more...</h3></div></div></div><p><span>The source code of the built-</span>in shaders is typically hidden in Unity. You cannot open this from the editor as you do with your own shaders. For more information on where to find a large portion of the built-in Cg functions for Unity, go to your Unity install directory and navigate to the <code class="literal">Editor</code> <span>| </span><code class="literal">Data</code> | <code class="literal">CGIncludes</code> folder:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/42fd0490-e3d2-4276-9f9e-adb4a359a66e.png" /></div><p>In this folder, you can find the source code of the shaders shipped with Unity. Over time, they have changed a lot; you can visit the<span class="strong"><strong> Unity download archive</strong></span> (<span><a class="ulink" href="https://unity3d.com/get-unity/download/archive" target="_blank">https://unity3d.com/get-unity/download/archive</a></span>) if you <span>need</span><a id="id325453607" class="indexterm"></a> to access the source codes of a shader used in a different version of Unity. After choosing the right version, select <strong class="userinput"><code>Built in <span>shaders</span><a id="id325453619" class="indexterm"></a></code></strong> from the drop-down list, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/f86503a2-0a26-4d08-a9d9-a64fd41e378b.png" /></div><p>There are three files that are of note at this point: <code class="literal">UnityCG.cginc</code>,  <code class="literal">Lighting.cginc</code>, and <code class="literal">UnityShaderVariables.cginc</code>. Our current shader is making use of all these files at the moment. In <span><a class="link" href="#" linkend="ch11">Chapter 11</a></span>, <span class="emphasis"><em>Advanced Shading Techniques</em></span>, we will explore in depth how to use CGInclude for a modular approach to shader coding.</p></div></div>