<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec41"></a>Baking lights in your scene</h2></div></div><hr /></div><p>Rendering lighting is a very expensive process. Even with state-of-the-art GPUs, accurately <span>calculating</span><a id="id325209371" class="indexterm"></a> the <span class="strong"><strong>light transport</strong></span> (which is how light bounces between surfaces) can take hours. In order to make this process feasible for games, real-time rendering is essential. Modern engines compromise between realism and efficiency; most of the computation is done beforehand in a <span>process</span><a id="id325209382" class="indexterm"></a> called <span class="strong"><strong>light baking</strong></span>. This recipe will <span>explain</span><a id="id325209395" class="indexterm"></a> how light baking works and how you can get the most out of it.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec94"></a>Getting ready</h3></div></div></div><p>Light baking requires you to have a scene ready. It should have geometries and, obviously, lights. For this recipe, we will rely on Unity's standard features so there is no need to create additional shaders or materials. We will be reusing the map that we used previously in <span><a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em><span><span>Post Processing Stack</span></span></em></span></span>. For better control, you might want to access the <strong class="userinput"><code>Lighting</code></strong> window. If you don't see it, select <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Lighting | Settings</code></strong> from the menu and dock it where it is more convenient for you.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec95"></a>How to do it...</h3></div></div></div><p>Light baking requires some manual configuration. There are three essential, yet independent, steps that you need to take.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec4"></a>Configuring the static geometry</h4></div></div></div><p>These steps <span>must</span><a id="id325209458" class="indexterm"></a> be followed for the configuration:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Identify all the objects in your scene that do not change position, size, and material. Possible candidates are buildings, walls, terrain, props, trees, and others. In our case, it will be all of the objects aside from the <code class="literal">FPSController</code> and its children.</li><li>Select these objects and check the <strong class="userinput"><code>Static</code></strong> box from the <strong class="userinput"><code>Inspector</code></strong> tab, as shown in the following screenshot. If any of the selected objects have children, Unity will ask if you want them to be considered static as well. If they meet the requirements (fixed position, size, and material), select <strong class="userinput"><code>Yes, change children</code></strong> in the pop-up box:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/118e1eac-cadf-430c-9298-b35f555ad907.png" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip54"></a>Note</h3><p>If a light qualifies as a static object but illuminates non-static geometry, make sure that its <strong class="userinput"><code>Baking</code></strong> property is set to <strong class="userinput"><code>Mixed</code></strong>. If it will affect only static objects, set it to <strong class="userinput"><code>Baked</code></strong>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec5"></a>Configuring the light probes</h4></div></div></div><p>There are objects in your game that will move, such as the main character, enemies, and the other <span class="strong"><strong>non-playable characters</strong></span> (<span class="strong"><strong>NPCs</strong></span>). If they enter a static region that is illuminated, you <span>might</span><a id="id325219388" class="indexterm"></a> want to surround it with <span>light</span><a id="id325219402" class="indexterm"></a> probes. To do this, follow the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>From the menu, navigate to <strong class="userinput"><code>GameObject</code></strong> | <strong class="userinput"><code>Light</code></strong> | <strong class="userinput"><code>Light Probe Group</code></strong>. A new object called <strong class="userinput"><code>Light Probe Group</code></strong> will appear in <strong class="userinput"><code>Hierarchy</code></strong>.</li><li>Once selected, eight interconnected spheres will appear. Click and move them around the scene so that they enclose the static region in which your characters can enter. The following screenshot shows an example of how light probes can be used to enclose the volume of a static office space:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/c044cbe4-f53d-47d7-b187-d91d27e82e39.png" /></div><p><span>   For our example, it would just be the center area the player is able to enter</span>:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/55605811-94e3-4ffc-b5eb-a2c1446e29db.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Select the moving <span>objects</span><a id="id325445070" class="indexterm"></a> that will enter the light probe region. </li><li>From their <strong class="userinput"><code>Inspector</code></strong>, expand their <span class="strong"><strong>renderer component</strong></span> (usually <strong class="userinput"><code>Mesh Renderer</code></strong>) and make sure that <strong class="userinput"><code>Light Probes</code></strong> is not set to <strong class="userinput"><code>Off checked</code></strong> (see <span>the</span><a id="id325445176" class="indexterm"></a> following screenshot):</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/a726ef4d-ee7a-43aa-9fe3-eaa3ffdcd61b.png" /></div><p>Deciding where and when to use light <span>probes</span><a id="id325445195" class="indexterm"></a> is a critical problem; more information about this can be found in <span>the <span class="emphasis"><em>How it works... </em></span>section for this recipe.</span></p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec6"></a>Baking the lights</h4></div></div></div><p>To bake the lights, follow the <span>given</span><a id="id325445219" class="indexterm"></a> steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, select the lights you'd like to bake. Confirm from the <strong class="userinput"><code>Inspector</code></strong> tab that the <strong class="userinput"><code>Mode</code></strong> is set to <strong class="userinput"><code>Baked </code></strong>in the<strong class="userinput"><code> Light </code></strong>component:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/56293b06-a08a-48f3-a676-f8c094dcfb65.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>To finally bake the lights, open the <strong class="userinput"><code>Lighting</code></strong> window by going to <strong class="userinput"><code>Window</code></strong> | <strong class="userinput"><code>Lighting</code></strong> | <strong class="userinput"><code>Settings</code></strong>. Once there, select the <strong class="userinput"><code>Global Maps</code></strong> tab.</li><li>If the <strong class="userinput"><code>Auto Generate</code></strong> checkbox is enabled, Unity will <span>automatically</span><a id="id325453390" class="indexterm"></a> execute the baking process in the background. If not, click on <strong class="userinput"><code>Generate Lighting</code></strong>.</li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note55"></a>Note</h3><p>Light baking can take several hours even for a relatively small scene. If you are constantly moving static objects or lights, Unity will restart the process from scratch, causing a severe slowdown in the editor. You can uncheck the <strong class="userinput"><code>Auto</code></strong> checkbox from the <strong class="userinput"><code>Lighting</code></strong> | <strong class="userinput"><code>Lightmaps | Settings</code></strong> tab to prevent this so that you can decide when to start the process manually.</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec96"></a>How it works...</h3></div></div></div><p>The most complicated part of rendering is the light transport. During this phase, the GPU calculates how the rays of light bounce between objects. If an object and its lights don't move, this calculation can be done only once as it will never change during the game. Flagging an object as <strong class="userinput"><code>Static</code></strong> is how to tell Unity that such an optimization can be made.</p><p>Loosely speaking, light baking refers to the process of calculating the global illumination of a static object and saving it in what is called a <span class="strong"><strong>lightmap</strong></span>. Once <span>baking</span><a id="id325453629" class="indexterm"></a> is completed, lightmaps can be seen in the <strong class="userinput"><code>Global Maps</code></strong> tab of the <strong class="userinput"><code>Lighting</code></strong> window:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/83ffa6c8-81a8-40f8-909b-e8435bf17918.png" /></div><p>Light baking comes at a great expense: memory. Every static surface is, in fact, retextured so that it already includes its lighting condition. Let's imagine that you have a forest of trees, all <span>sharing</span><a id="id325453729" class="indexterm"></a> the same texture. Once they are made static, each tree will have its very own texture. Light baking not only increases the size of your game, but can take a lot of texture memory if used indiscriminately.</p><p>The second aspect introduced in this recipe is <span class="strong"><strong>light probing</strong></span>. Light <span>baking</span><a id="id325453745" class="indexterm"></a> produces extremely high-quality results for static geometries, but does not work on moving objects. If your character is entering a static region, it can look somehow <span class="emphasis"><em>detached</em></span> from the environment. Its shading will not match the surroundings, resulting in an aesthetically unpleasant result. Other objects, such as <span class="strong"><strong>skinned mesh renderers</strong></span>, will not <span>receive</span><a id="id325453760" class="indexterm"></a> global illumination even if made static. Baking lights in real-time is not possible, although light probes offer an effective alternative. Every light probe samples the global illumination at a specific point in space. A light probe group can sample several points in space, allowing the interpolation of global illumination within a specific volume. This allows us to cast a better light on moving objects, even despite the fact that global illumination has been calculated only for a few points. It is important to remember that light probes need to enclose a volume in order to work. It is best to place light probes in regions where there is a sudden change in light conditions. Similar to lightmaps, probes consume memory and should be placed wisely; remember that they exist only for non-static geometry. Since there are no visible objects in the demoscene, this was done purely for demonstration purposes.</p><p>Even while using light probes, there are a few aspects that Unity's global illumination cannot capture. Non-static objects, for instance, cannot reflect light on other objects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec97"></a>See also</h3></div></div></div><p>You can read more <span>about</span><a id="id325453796" class="indexterm"></a> light probes at <span><a class="ulink" href="http://docs.unity3d.com/Manual/LightProbes.html" target="_blank">http://docs.unity3d.com/Manual/LightProbes.html</a></span>.</p><p> </p></div></div>