<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec35"></a>Creating a BlinnPhong Specular type</h2></div></div><hr /></div><p><span class="strong"><strong>Blinn</strong></span> is another <span>more</span><a id="id325209374" class="indexterm"></a> efficient way of <span>calculating</span><a id="id325209381" class="indexterm"></a> and estimating specularity. It is done by getting the half vector from the view direction and light direction. It was brought into the world of Cg by Jim Blinn. He found that it was much more efficient to just get the half vector instead of calculating our own reflection vectors. It cut down on the code and processing time. If you actually look at the built-in BlinnPhong lighting model included in the <code class="literal">UnityCG.cginc</code> file, you will notice that it is using the half vector as well, hence it is named BlinnPhong. It is just a simpler version of the full Phong calculation.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec76"></a>Getting ready</h3></div></div></div><p>To start with this recipe, perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>This time, instead of creating a whole new scene, let's just use the objects and scene that we have by using <strong class="userinput"><code>File </code></strong>| <strong class="userinput"><code>Save Scene As...</code></strong>, and create a new shader (BlinnPhong) and material (<code class="literal">BlinnPhongMat</code>):</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/7d7bea74-248c-4edd-b4c0-2feb78a20d5f.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Once you have a <span>new</span><a id="id325209443" class="indexterm"></a> shader, double-click on it to launch your IDE of choice so that you can start editing your shader.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec77"></a>How to do it...</h3></div></div></div><p>Perform the following steps to create a BlinnPhong lighting model:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, let's remove all of the current properties with their definitions in the <code class="literal">SubShader</code> block. Then we need to add our own properties to the <code class="literal">Properties</code> block so that we can control the look of the Specular highlight:</li></ol></div><pre class="programlisting">Properties 
{ 
  _MainTint ("Diffuse Tint", Color) = (1,1,1,1) 
  _MainTex ("Base (RGB)", 2D) = "white" {} 
  _SpecularColor ("Specular Color", Color) = (1,1,1,1) 
  _SpecPower ("Specular Power", Range(0.1,60)) = 3 
} </pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Then we need to make sure that we have created the corresponding variables in our <code class="literal">CGPROGRAM</code> block so that we can access the data from our <code class="literal">Properties</code> block, in our subshader:</li></ol></div><pre class="programlisting">sampler2D _MainTex; 
float4 _MainTint; 
float4 _SpecularColor; 
float _SpecPower; </pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Now it's time to create our custom lighting <span>model</span><a id="id325209632" class="indexterm"></a> that will process our Diffuse and Specular calculations. The code is as follows:</li></ol></div><pre class="programlisting">fixed4 LightingCustomBlinnPhong (SurfaceOutput s, 
                  fixed3 lightDir, 
                  half3 viewDir, 
                  fixed atten) 
{ 
  float NdotL = max(0,dot(s.Normal, lightDir)); 

  float3 halfVector = normalize(lightDir + viewDir); 
  float NdotH = max(0, dot(s.Normal, halfVector)); 
  float spec = pow(NdotH, _SpecPower) * _SpecularColor; 

  float4 color; 
  color.rgb = (s.Albedo * _LightColor0.rgb * NdotL) + 
        (_LightColor0.rgb * _SpecularColor.rgb * spec) * atten; 
  color.a = s.Alpha; 
  return color; 
} </pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Then update the <code class="literal">surf</code> function to the following:</li></ol></div><pre class="programlisting">void surf (Input IN, inout SurfaceOutput o) 
{
 half4 c = tex2D (_MainTex, IN.uv_MainTex) * _MainTint;
 o.Albedo = c.rgb;
 o.Alpha = c.a;
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>To complete our shader, we will need to tell our CGPROGRAM block to use our custom lighting model rather than a built-in one by modifying the <code class="literal">#pragma</code> statement with the following code:</li></ol></div><pre class="programlisting">CPROGRAM 
#pragma surface surf CustomBlinnPhong </pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>The following screenshot <span>demonstrates</span><a id="id325442718" class="indexterm"></a> the results of our BlinnPhong lighting model:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/4408dd71-342d-468c-b49f-00ee3d27795e.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec78"></a>How it works...</h3></div></div></div><p>The BlinnPhong Specular is almost exactly like the Phong Specular, except that it is more efficient because it uses less code to achieve almost the same effect. Before the introduction of physically-based rendering, this approach was the default choice for Specular reflection in Unity 4.</p><p>Calculating the reflection vector <span class="strong"><strong>R</strong></span> is generally expensive. The BlinnPhong Specular <span>replaces</span><a id="id325445074" class="indexterm"></a> it with the half vector <span class="strong"><strong>H</strong></span> between the view direction <span class="strong"><strong>V</strong></span> and light direction <span class="strong"><strong>L</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/99958073-b626-4dba-971a-37868e055b1c.png" /></div><p>Instead of calculating our own reflection vector, we are simply going to get the vector halfway between the view direction and light direction, basically simulating the reflection vector. It has actually been found that this approach is more physically accurate than the last approach, but we thought it necessary to show you all the possibilities:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/18123245-de4e-4b94-aec6-0900e0fd5737.png" /></div><p>According to vector algebra, the half vector can be calculated as follows:</p><div class="mediaobject"><img src="/graphics/9781788396233/graphics/3a9dddd9-c8bc-498c-9d58-655bacb9497a.png" /></div><p><span>Here |V+L| is</span> the length of the vector V+L. In Cg, we simply need to add the view direction and light direction together and then normalize the result to a unity vector:</p><pre class="programlisting">float3 halfVector = normalize(lightDir + viewDir); </pre><p>Then, we simply need to dot the vertex normal with this new half vector to get our main Specular value. After this, we just take it to a power of <code class="literal">_SpecPower</code> and multiply it by the Specular color variable. It's much lighter on the code and math, but still gives us a nice Specular highlight that will work for <span>many</span><a id="id325451162" class="indexterm"></a> real-time situations.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec79"></a>See also</h3></div></div></div><p>The light models seen in this chapter are extremely simple; no real material is perfectly matte or perfectly specular. Moreover, it is not uncommon for complex materials such as clothing, wood, and skin to require knowledge of how light scatters in the layers beneath the surface. Use the following table to recap the different lighting models encountered so <span>far</span>:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col /><col /><col /></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Technique</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Type</strong></span></p></td><td style="border-bottom: 0.5pt solid ; "><p><span class="strong"><strong>Light Intensity (I)</strong></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Lambertian</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Diffuse</p></td><td style="border-bottom: 0.5pt solid ; "><div class="mediaobject"><img src="/graphics/9781788396233/graphics/349983d9-3feb-48c0-b415-05795c840cd3.png" /></div></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p><code class="literal">Phong</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "><p>Specular</p></td><td style="border-bottom: 0.5pt solid ; "><div class="mediaobject"><img src="/graphics/9781788396233/graphics/f483ad3d-c718-48d0-8d8f-ad4424e133d7.png" /></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/6665cd4e-aecc-4333-91c5-c47072130e9e.png" /></div></td></tr><tr><td style="border-right: 0.5pt solid ; "><p>BlinnPhong</p></td><td style="border-right: 0.5pt solid ; "><p>Specular</p></td><td style=""><div class="mediaobject"><img src="/graphics/9781788396233/graphics/36650473-280f-45cf-8302-fced0fd1cf84.png" /></div><div class="mediaobject"><img src="/graphics/9781788396233/graphics/3a9dddd9-c8bc-498c-9d58-655bacb9497a.png" /></div></td></tr></tbody></table></div><p> </p><p>There are other interesting models <span>such</span><a id="id325454759" class="indexterm"></a> as the Oren-Nayar lighting model <span>for</span><a id="id325454768" class="indexterm"></a> rough surfaces: <span><a class="ulink" href="https://en.wikipedia.org/wiki/Oren%E2%80%93Nayar_reflectance_model" target="_blank">https://en.wikipedia.org/wiki/Oren%E2%80%93Nayar_reflectance_model</a>.</span></p></div></div>