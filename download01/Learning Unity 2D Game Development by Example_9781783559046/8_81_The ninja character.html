<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec80"></a>The ninja character</h2></div></div><hr /></div><p>Our ninja<a id="id513" class="indexterm"></a> character needs to be an animated sprite that loops infinitely. The position of the ninja will remain static as we will move the background and foreground to give the illusion of movement.</p><p>To create<a id="id514" class="indexterm"></a> our character, we execute the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a folder to <span class="strong"><strong>Assets</strong></span> within the Project Browser named <code class="literal">Ninja</code>.</p></li><li><p>Download<a id="id515" class="indexterm"></a> and unzip the image <code class="literal">NinjaSpriteSheet.png</code> from <a class="ulink" href="http://freeartsprites.com/free-art/endless-runner/" target="_blank">http://freeartsprites.com/free-art/endless-runner/</a>.</p></li><li><p>Slice the sprite sheet into individual animation sprites.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_01.jpg" /></div></li><li><p>Name the GameObject <code class="literal">Ninja</code>.</p></li><li><p>We then go to <span class="strong"><strong>Add component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec71"></a>Running</h3></div></div></div><p>As we <a id="id516" class="indexterm"></a>are creating an endless runner, we, of course, need our ninja to run! To create a run animation, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the ninja from the hierarchy.</p></li><li><p>Go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span>.</p></li><li><p>Click on <span class="strong"><strong>Create New Clip</strong></span>.</p></li><li><p>Save it as <code class="literal">Run.anim</code>.</p></li><li><p>Drag the following images into the timeline:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_02.jpg" /></div></li><li><p>Set <a id="id517" class="indexterm"></a>the sample to <code class="literal">10</code> to speed up the animation so that the ninja is running quickly.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec72"></a>Jump and Slide</h3></div></div></div><p>Our ninja <a id="id518" class="indexterm"></a>needs to be agile, and he, therefore, needs to be able to jump over and slide under any obstacle in his way.</p><p>To create his jump animation, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the ninja from the hierarchy.</p></li><li><p>Go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span>.</p></li><li><p>Click on <span class="strong"><strong>Create New Clip</strong></span>.</p></li><li><p>Save it as <code class="literal">Jump.anim</code>.</p></li><li><p>Drag the following images into the time frame:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_03.jpg" /></div></li><li><p>Set the sample to 5 to slow down the jump animation.</p></li></ol></div><p>To ensure<a id="id519" class="indexterm"></a> that the ninja is not jumping on the same spot, we need to increase his height while he jumps. To achieve this, we go to <span class="strong"><strong>Add Curve</strong></span> | <span class="strong"><strong>Transform</strong></span> | <span class="strong"><strong>Position</strong></span> and increase the <span class="emphasis"><em>y</em></span> position by 1 unit on each frame for the first three frames. The following table will help us to get a clearer picture of this:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /></colgroup><thead><tr><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Frame</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Position.y</p>
</th></tr></thead><tbody><tr><td style="" align="left" valign="top">
<p>0:0</p>
</td><td style="" align="left" valign="top">
<p>-3</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>0:1</p>
</td><td style="" align="left" valign="top">
<p>-2</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>0:2</p>
</td><td style="" align="left" valign="top">
<p>-1</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>0:3</p>
</td><td style="" align="left" valign="top">
<p>-2</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>0:4</p>
</td><td style="" align="left" valign="top">
<p>-3</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>1:0</p>
</td><td style="" align="left" valign="top">
<p>-3</p>
</td></tr></tbody></table></div><p>To create<a id="id520" class="indexterm"></a> this slide animation we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Select the ninja from the hierarchy.</p></li><li><p>Go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span>.</p></li><li><p>Click on <span class="strong"><strong>Create New Clip</strong></span>.</p></li><li><p>Save it as <code class="literal">Slide.anim</code>.</p></li><li><p>Drag the following image into the time frame:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_04.jpg" /></div></li><li><p>We <a id="id521" class="indexterm"></a>can leave the sample at the default <code class="literal">60</code> as we are only using one key frame for the slide animation.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec73"></a>Add Animator parameters</h3></div></div></div><p>We<a id="id522" class="indexterm"></a> now need to add the Animator parameters by doing the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Go to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span>.</p></li><li><p>We add the following Boolean parameters to the <span class="strong"><strong>Parameters</strong></span> box within the Animator View by clicking on the <span class="strong"><strong>+</strong></span> sign, selecting <span class="strong"><strong>Bool</strong></span>, and then naming them as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">jump</code>
</p></li><li style="list-style-type: disc"><p>
<code class="literal">slide</code>
</p></li></ul></div></li></ol></div><p>Ensure that both parameters are unchecked as they need to start as false by default, since the character will neither be jumping nor sliding but instead running by default.</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_05.jpg" /></div><p>We will also add the <code class="literal">run</code> parameter in a similar way.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec74"></a>Animator states and transitions</h3></div></div></div><p>Before we can detect a jump or slide in the script and then output the corresponding animation, we<a id="id523" class="indexterm"></a> first need to <a id="id524" class="indexterm"></a>set the states and order the transitions between the multiple animations by using the Animator. To do this, we can execute the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We assign the Animator component to the ninja GameObject within the Inspector. We generally do this by going to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Miscellaneous</strong></span> | <span class="strong"><strong>Animator</strong></span>.</p></li><li><p>In the Inspector, within the Animator component, we set our controller. Click on <span class="strong"><strong>Controller</strong></span> and select <span class="strong"><strong>Ninja</strong></span>.</p></li><li><p>We now select the Animator View by going to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span>.</p></li><li><p>In the Animator View, order the animation states that we created by right-clicking and adding transitions with directions that match the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_06.jpg" /></div></li></ol></div><p>Ensure that <span class="strong"><strong>run</strong></span> is set as default and is orange; if not, then right-click on it, and select <span class="strong"><strong>Set As Default</strong></span>. We click on each transition individually and check the Inspector.</p><p>At the bottom of the Inspector, we set the condition to match the direction the transition arrow is pointing at, with the name of the corresponding parameter. The following are the conditions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If the arrow is going from <span class="strong"><strong>jump</strong></span> and pointing towards <span class="strong"><strong>slide</strong></span>, then we select the <span class="strong"><strong>slide</strong></span> parameter</p></li><li style="list-style-type: disc"><p>Similarly, if the transition is going from <span class="strong"><strong>run</strong></span> to <span class="strong"><strong>slide</strong></span>, then we select the <span class="strong"><strong>slide</strong></span> parameter</p></li><li style="list-style-type: disc"><p>However, if the transition is going from <span class="strong"><strong>slide</strong></span> to <span class="strong"><strong>run</strong></span>, then we select the <span class="strong"><strong>run</strong></span> parameter</p></li></ul></div><p>The <a id="id525" class="indexterm"></a>following screenshot<a id="id526" class="indexterm"></a> displays the location of the condition within the Inspector:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_08_07.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec75"></a>Movement controls</h3></div></div></div><p>We <a id="id527" class="indexterm"></a>are going to set up <a id="id528" class="indexterm"></a>the movement controls that enable us to move the Ninja character. Now that we have set up the movement animations, we need to detect input in order to trigger each animation.</p><p>For our endless runner, we only need a jump control and a slide control.</p><p>We will use the <span class="emphasis"><em>W</em></span> key to jump and the <span class="emphasis"><em>S</em></span> key to slide.</p><p>To use these controls, we need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a script and call it <code class="literal">Ninja.js</code>.</p></li><li><p>Assign the script to the <span class="strong"><strong>ninja</strong></span> GameObject by going to <span class="strong"><strong>Add component</strong></span> | <span class="strong"><strong>New Script</strong></span>.</p></li></ol></div><p>Within <a id="id529" class="indexterm"></a>the script, we <a id="id530" class="indexterm"></a>add the pieces of code following the information boxes:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note87"></a>Note</h3><p>This is used to ensure strict typing—if you use the same variable for different data types, then an error will be thrown when building the script. This prevents bugs from occurring. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">#pragma strict </pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note88"></a>Note</h3><p>Declare a variable to store the Animator component attached to the ninja GameObject. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">var animator: Animator; </pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note89"></a>Note</h3><p>At the start of our game, we get the Animator component attached to our ninja GameObject and assign it to our <code class="literal">animator</code> variable that we declared, so that we can access the parameters within the Animator.</p></div><div class="informalexample"><pre class="programlisting">function Start()
{
animator = GetComponent("Animator");
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note90"></a>Note</h3><p>We call our <code class="literal">MoveCharacter</code> function within <code class="literal">FixedUpdate</code> instead of <code class="literal">Update</code> as we are using a rigid body—when using the Physics engine, we need to ensure that the updates occur in sync with the Physics engine as using <code class="literal">Update</code> could cause inconsistencies depending on the frame rate of the game. Also, the Physics engine updates rigid bodies at a fixed rate per second, whereas the rendering engine updates as many times as possible per second (or is limited to monitor the refresh rate). Have a look at the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">function FixedUpdate () 
{
  MoveCharacter();
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note91"></a>Note</h3><p>The <a id="id531" class="indexterm"></a>function to move the ninja is given next.</p></div><div class="informalexample"><pre class="programlisting">function MoveCharacter()
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note92"></a>Note</h3><p>Detect<a id="id532" class="indexterm"></a> whether the input key from the keyboard is <span class="emphasis"><em>W</em></span>. Next, you will see how this can be done.</p></div><div class="informalexample"><pre class="programlisting">if (Input.GetKey(KeyCode.W))
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note93"></a>Note</h3><p>If the <span class="emphasis"><em>W</em></span> key is pressed, then we call the <code class="literal">animator</code> function and set the <code class="literal">jump</code> parameter of the Animator's <code class="literal">bool</code> function to <code class="literal">true</code> in order to trigger the jump transition so that the run animation or slide animation transitions to the jump animation. This can be done by adding the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">    animator.SetBool("jump", true);
}
else 
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note94"></a>Note</h3><p>If the <span class="emphasis"><em>W</em></span> key is not pressed and, therefore, <code class="literal">false</code>, then the ninja should not jump, and we set the <code class="literal">jump</code> parameter of the Animator's <code class="literal">bool</code> function to <code class="literal">false</code>. Have a look at the following line of code.</p></div><div class="informalexample"><pre class="programlisting">animator.SetBool("jump", false);
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note95"></a>Note</h3><p>Detect whether the input key from the keyboard is <span class="emphasis"><em>S</em></span>. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">if (Input.GetKey(KeyCode.S))
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note96"></a>Note</h3><p>If <a id="id533" class="indexterm"></a>true, then<a id="id534" class="indexterm"></a> we call the <code class="literal">animator</code> function and set the <code class="literal">slide</code> parameter of the Animator's <code class="literal">bool</code> function to <code class="literal">true</code> to trigger the jump transition so that the run animation or jump animation transitions to the slide animation. Have a look at the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">    animator.SetBool("slide", true);
}
else
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note97"></a>Note</h3><p>If the <span class="emphasis"><em>S</em></span> key is not pressed and, therefore, false, then the ninja should not slide, and we set the <code class="literal">slide</code> parameter of the Animator's <code class="literal">bool</code> function to <code class="literal">false</code>. Have a look at the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">    animator.SetBool("slide", false);
  }
}</pre></div></div></div>