<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec94"></a>Let's simulate the world</h2></div></div><hr /></div><p>Now that we have a better understanding of the basics of physics and we know about the new Physics 2D in Unity as well as Box2D, we are ready to make use of all these faculties to<a id="id640" class="indexterm"></a> create our very own physics game.</p><p>We will create a very simple physics game similar to Angry Birds. We will have a cannon that shoots out cannonballs.</p><p>We can<a id="id641" class="indexterm"></a> shoot out cannonballs by pressing the Space bar, and we can control where the ball lands by increasing or decreasing the power of the cannonball using the <span class="emphasis"><em>W</em></span> and <span class="emphasis"><em>S</em></span> keys.</p><p>The aim of the game is to shoot the crates and planks in the scene. We won't need to set up animations since the physics will take care of all the movements in the game.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec77"></a>The environment</h3></div></div></div><p>The first<a id="id642" class="indexterm"></a> thing we will do is create our scene with the background, foreground, and props that populate our environment.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec31"></a>Creating the scene</h4></div></div></div><p>To<a id="id643" class="indexterm"></a> create the scene, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>To create a new scene, go to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>New Scene</strong></span>.</p></li><li><p>Name it <code class="literal">Scene</code> and make sure you save it.</p></li><li><p>Within the Project Browser, under <span class="strong"><strong>Assets</strong></span>, create a folder and name it <code class="literal">Scenes</code>.</p></li><li><p>Move the scene into the folder.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec32"></a>Creating the background</h4></div></div></div><p>To create<a id="id644" class="indexterm"></a> our background, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Under <span class="strong"><strong>Assets</strong></span>, create a folder and name it <code class="literal">Background</code>.</p></li><li><p>Add <code class="literal">PhysicsBG.png</code> as a sprite into the folder from the <code class="literal">Chapter09_art bundle</code> folder in the <code class="literal">Code&amp;ColoredImages</code> bundle included with the book.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_11.jpg" /></div></li><li><p>Rename <a id="id645" class="indexterm"></a>it to <code class="literal">Background</code> in the hierarchy.</p></li><li><p>Position the background so that it fits perfectly in the Camera View.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec33"></a>The foreground</h4></div></div></div><p>Our<a id="id646" class="indexterm"></a> environment is also going to need foreground flooring so that all our objects can be placed in the scene; if we add our objects without a floor, then they will fall out of the scene.</p><p>This would not occur if we used static objects for our game or if we used physics with zero gravity. However, we are using objects that make use of physics as this is a physics game and we are simulating the world with the laws of gravity.</p><p>To create our foreground, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Under <span class="strong"><strong>Assets</strong></span>, create a folder and name it <code class="literal">Foreground</code>.</p></li><li><p>Add <code class="literal">PhysicsFloor.png</code> as a sprite into the folder, from the <code class="literal">Chapter09_art bundle</code> folder in the <code class="literal">Code&amp;ColoredImages</code> bundle included with the book.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_12.jpg" /></div></li><li><p>Rename it to <code class="literal">Foreground</code> in the hierarchy.</p></li><li><p>Position <code class="literal">Foreground</code> so that it fits perfectly in the Camera View at the very bottom.</p></li><li><p>Go<a id="id647" class="indexterm"></a> to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li></ol></div><p>This will ensure the objects in our game collide with the ground when they fall.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec34"></a>Adding the props</h4></div></div></div><p>We will<a id="id648" class="indexterm"></a> add props in our screen, such as crates and planks, which will provide the targets for the cannonballs to collide with.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch09lvl4sec03"></a>Adding the crate</h5></div></div></div><p>To add the <a id="id649" class="indexterm"></a>crate to our scene, we perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Under <span class="strong"><strong>Assets</strong></span>, create a folder and name it <code class="literal">Props</code>.</p></li><li><p>Add <code class="literal">Crate.png</code> as a sprite into the folder, from the <code class="literal">Chapter09_art bundle</code> folder in the <code class="literal">Code&amp;ColoredImages</code> bundle included with the book.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_13.jpg" /></div></li><li><p>Rename<a id="id650" class="indexterm"></a> it to <code class="literal">Crate</code> in the hierarchy.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Rigidbody 2D</strong></span>.</p></li><li><p>Create a few duplicates by pressing <span class="emphasis"><em>Ctrl</em></span> + <span class="emphasis"><em>D</em></span>. We can position them as we want.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch09lvl4sec04"></a>Adding the plank</h5></div></div></div><p>To add a <a id="id651" class="indexterm"></a>plank to our scene, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <span class="strong"><strong>Props</strong></span> folder.</p></li><li><p>Add <code class="literal">Plank.png</code> as a sprite into the folder from the <code class="literal">Chapter09_art bundle</code> folder in the <code class="literal">Code&amp;ColoredImages</code> bundle included with the book.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_14.jpg" /></div></li><li><p>Rename it to <code class="literal">Plank</code> in the hierarchy.</p></li><li><p>Create a few duplicates.</p><p>We can position them however we want.</p></li><li><p>Go<a id="id652" class="indexterm"></a> to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Rigidbody 2D</strong></span>.</p></li></ol></div></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec78"></a>Shooting the cannonballs</h3></div></div></div><p>We need a <a id="id653" class="indexterm"></a>cannon that will shoot out cannonballs. To <a id="id654" class="indexterm"></a>create our cannon, we need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add a folder to <span class="strong"><strong>Assets</strong></span> within the Project Browser, and name it <code class="literal">Sprites</code>.</p></li><li><p>Add the <code class="literal">Cannon.png</code> sprite from the <code class="literal">Chapter09_art bundle</code> folder in the <code class="literal">Code&amp;ColoredImages</code> bundle included with the book.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_15.jpg" /></div></li><li><p>Name the GameObject <code class="literal">Cannon</code>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name it <code class="literal">Cannon.js</code>.</p></li><li><p>Assign the script to the cannon.</p></li><li><p>In the Project Browser, add a folder named <code class="literal">Scripts</code> and move <code class="literal">Cannon.js</code> into it.</p></li><li><p>Add the <a id="id655" class="indexterm"></a>following code to the script:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note113"></a>Note</h3><p>The<a id="id656" class="indexterm"></a> first line of code is used to ensure strict typing—if you use the same variable for different data types then an error will be thrown when building the script.</p><p>This prevents bugs from occurring. </p></div><div class="informalexample"><pre class="programlisting">#pragma strict</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note114"></a>Note</h3><p>Declare our <code class="literal">cannonball</code> variable, and set its data type to <code class="literal">Rigidbody2D</code> as shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">var cannonball:Rigidbody2D;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note115"></a>Note</h3><p>Declare our <code class="literal">power</code> variable, set it to a decimal type, and assign it an initial default value of <code class="literal">30.0</code> that it will start with.</p><p>We may need to adjust this value depending on our scene. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">var power:float = 30.0;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note116"></a>Note</h3><p>Call the <code class="literal">OnGUI</code> function provided by Unity to create GUI objects.</p></div><div class="informalexample"><pre class="programlisting">function OnGUI()
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note117"></a>Note</h3><p>We use the <a id="id657" class="indexterm"></a>
<code class="literal">GUI.box</code> function to create the Power GUI for our game using a rectangle. The first parameter we pass is the rectangle:</p><p>We create the rectangle using four parameters within the rectangle function with the starting (<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>) coordinates for the top-left corner of the rectangle followed by the ending bottom-right corner (<span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>) coordinates of the rectangle.</p><p>The next parameter we pass to the <code class="literal">GUI.Box</code> function is the <code class="literal">"Power:"</code> string we would like to display as output feedback within our box, and we add the power value to our string so that it is also displayed.</p></div><div class="informalexample"><pre class="programlisting">  GUI.Box (Rect (10,10,100,30), "Power: "+power);
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note118"></a>Note</h3><p>We<a id="id658" class="indexterm"></a> call our <code class="literal">Cannonballs</code> function<a id="id659" class="indexterm"></a> within <code class="literal">FixedUpdate</code> instead of <code class="literal">Update</code> as we are using a Rigidbody. When using physics, we need to ensure that the updates occur in sync with the physics engine as using <code class="literal">Update</code> could cause inconsistencies depending on the frame rate of the game.</p></div><div class="informalexample"><pre class="programlisting">function FixedUpdate()
{

  Cannonballs();
}

function Cannonballs()
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note119"></a>Note</h3><p>Detect whether the input key from keyboard is <span class="emphasis"><em>W</em></span>.</p></div><div class="informalexample"><pre class="programlisting">  if (Input.GetKey(KeyCode.W))
  {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note120"></a>Note</h3><p>We want to limit the power between 40 and 20 because if the power is too low, then the ball will not be able to blast out of the cannon, and if the power is too high, then the ball will go off screen.</p><p>Here, we limit the upper boundary of 40, so we only increase the power incrementally by 1 when pressing the <span class="emphasis"><em>W</em></span> key if the power is less than or equal to 39. This is shown in the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">    if (power &lt;= 39)
    {

      power = power + 1;
    }
  }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note121"></a>Note</h3><p>Detect whether the input key from the keyboard is <span class="emphasis"><em>S</em></span>. This can be done as shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">  if (Input.GetKey(KeyCode.S))
  {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note122"></a>Note</h3><p>Here, we<a id="id660" class="indexterm"></a> limit the lower boundary to 20, so we<a id="id661" class="indexterm"></a> only decrease the power incrementally by 1 when pressing the <span class="emphasis"><em>S</em></span> key if the power is more than or equal to 21. This can be done as shown in the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">    if (power &gt;= 21)
    {

      power = power - 1;
    }
  }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note123"></a>Note</h3><p>Detect whether the input key from the keyboard is the Space bar, and if it is, then we call the function that spawns cannonballs. This is shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">  if (Input.GetKeyDown("space"))
  {

    SpawnCannonballs();
  }

}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note124"></a>Note</h3><p>The function to spawn cannonballs from the cannon is shown next.</p></div><div class="informalexample"><pre class="programlisting">function SpawnCannonballs()
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note125"></a>Note</h3><p>To <a id="id662" class="indexterm"></a>spawn cannonballs from the cannon <a id="id663" class="indexterm"></a>when pressing Space bar in the game, we create an instance of our cannonball GameObject in the scene.</p><p>As our cannonball GameObject that we assign to our instance is a Rigidbody 2D (we have done so to abide by the laws of physics), we use the Rigidbody 2D data type.</p></div><div class="informalexample"><pre class="programlisting">var cannonballInstance:Rigidbody2D;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note126"></a>Note</h3><p>We use Unity's <code class="literal">Instantiate()</code> function to create an instance of the cannonball <a id="id664" class="indexterm"></a>Rigidbody 2D GameObject in our scene, and assign it to our <code class="literal">cannonballInstance</code> variable.</p><p>The first parameter is the cannonball GameObject, the second parameter is the position we want the instance to spawn, in this case, the <span class="emphasis"><em>xyz</em></span> position of our cannon, and the third parameter is the rotation of the instance that we spawn.</p></div><div class="informalexample"><pre class="programlisting">  cannonballInstance = Instantiate(cannonball, Vector3(-84,-40,72), Quaternion.Euler(new Vector3(0,0,0)));</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note1000"></a>Note</h3><p>We need to make sure that we either position our cannon at the preceding coordinates (<code class="literal">-84</code>,<code class="literal">-40</code>,<code class="literal">72</code>) or, if our coordinates are different, then use the <span class="emphasis"><em>x</em></span>, <span class="emphasis"><em>y</em></span>, <span class="emphasis"><em>z</em></span> positions of our cannon's position.</p><p>We rotate the cannonball instance's <span class="emphasis"><em>z</em></span> rotation so that it looks right when it spawns and shoots out at the correct angle from the cannon. The <span class="emphasis"><em>z</em></span> axis is the axis that points out from the screen towards you.</p></div><div class="informalexample"><pre class="programlisting">  cannonballInstance.transform.Rotate(0,0,54);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note128"></a>Note</h3><p>As <a id="id665" class="indexterm"></a>pretty much all the physics has been <a id="id666" class="indexterm"></a>simplified and is taken care for us with the Physics 2D component and the Box2D engine, we need only set the velocity of the <code class="literal">cannonballInstance</code> variable. We want the ball to travel up and to the right-hand side equally, and then with the cannonball's mass and the gravity pulling it down, we get the ball moving at a curve. This is shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">  cannonballInstance.velocity = new Vector2(power,power);
}</pre></div></li><li><p>Build the script.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec79"></a>Creating the cannonballs</h3></div></div></div><p>Now <a id="id667" class="indexterm"></a>what fun is a cannon without any cannonballs? We<a id="id668" class="indexterm"></a> now need to create the cannonballs that will shoot out of our cannon.</p><p>To create our cannonball, we need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Within the <code class="literal">Sprites</code> folder, add the <code class="literal">Cannonball.png</code> sprite from the <code class="literal">Chapter09_art bundle</code> folder in the <code class="literal">Code&amp;ColoredImages</code> bundle included with the book.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_16.jpg" /></div></li><li><p>Name the GameObject <code class="literal">Cannonball</code>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Circle Collider 2D</strong></span>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Rigidbody 2D</strong></span>.</p></li><li><p>Select <a id="id669" class="indexterm"></a>the cannon in the hierarchy, and <a id="id670" class="indexterm"></a>within the cannon script in the Inspector, add the Cannonball Rigidbody 2D to the <code class="literal">Cannonball</code> variable.</p><p>We need to make sure that all the GameObjects in the scene are the same <span class="emphasis"><em>z</em></span> distance from the camera as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_09_17.jpg" /></div></li></ol></div></div></div>