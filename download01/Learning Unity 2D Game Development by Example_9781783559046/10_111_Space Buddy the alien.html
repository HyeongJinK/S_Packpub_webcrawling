<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec108"></a>Space Buddy the alien</h2></div></div><hr /></div><p>We now <a id="id724" class="indexterm"></a>add the main character in our game, which is the<a id="id725" class="indexterm"></a> little alien named Space Buddy. To add the alien, we do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Download <a id="id726" class="indexterm"></a>the <code class="literal">alien.png</code> image from the following URL:</p><p>
<a class="ulink" href="http://freeartsprites.com/platformer" target="_blank">http://freeartsprites.com/platformer</a>
</p></li><li><p>Move it to the sprites folder.</p></li><li><p>Create a sprite GameObject using the following image:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_10_07.jpg" /></div></li><li><p>Name the GameObject <code class="literal">SpaceBuddy</code>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Rigidbody 2D</strong></span>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li><li><p>Go to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>New Script</strong></span> and name the script <code class="literal">SpaceBuddy.js</code>.</p></li><li><p>In the Project Browser, add a folder named <code class="literal">Scripts</code> and move <code class="literal">SpaceBuddy.js</code> into it.</p></li><li><p>Add<a id="id727" class="indexterm"></a> the following code to the script:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note129"></a>Note</h3><p>The first line of code is used to ensure strict typing—if you use the same variable for different data types, then an error will be thrown when building the script.</p><p>This prevents bugs related to incorrect data types from occurring. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">#pragma strict</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note130"></a>Note</h3><p>Next, we define the vertical velocity of the character's jump as shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">var power:float = 20.0;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note131"></a>Note</h3><p>Next, we define the speed or horizontal velocity that the character moves at when it moves towards the left-hand side or the right-hand side. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">var speed:float = 3.0;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note132"></a>Note</h3><p>In the next line of code, we define the vertical velocity that the camera travels at.</p></div><div class="informalexample"><pre class="programlisting">var camSpeed:float = 100.0;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note133"></a>Note</h3><p>In the next line of code, we set the vertical velocity that the lose trigger travels at.</p></div><div class="informalexample"><pre class="programlisting">var lavaSpeed:float = 100.0;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note134"></a>Note</h3><p>In <a id="id728" class="indexterm"></a>the next code, we declare the main character as a Rigidbody.</p></div><div class="informalexample"><pre class="programlisting">var spacebuddy:Rigidbody2D;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note135"></a>Note</h3><p>In the next line of code, we create a camera GameObject.</p></div><div class="informalexample"><pre class="programlisting">var cam:GameObject;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note136"></a>Note</h3><p>In the next code, we declare the lose trigger GameObject.</p></div><div class="informalexample"><pre class="programlisting">var lava:GameObject;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note137"></a>Note</h3><p>We declare a variable that will store the audio clip of the jump sound effect that we would like to play in the game.</p></div><div class="informalexample"><pre class="programlisting">var jumpclip:AudioClip;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note138"></a>Note</h3><p>In the next code, we declare a variable that will store the audio clip of the win sound effect that we would like to play in the game.</p></div><div class="informalexample"><pre class="programlisting">var winclip: AudioClip;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note139"></a>Note</h3><p>Then, in the next code, we declare a variable that will store the audio clip of the lose sound effect that we would like to play in the game.</p></div><div class="informalexample"><pre class="programlisting">var loseclip:AudioClip;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note140"></a>Note</h3><p>We declare a variable to store the score in the game.</p></div><div class="informalexample"><pre class="programlisting">var score : float = 0.0;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note141"></a>Note</h3><p>We <a id="id729" class="indexterm"></a>use the <code class="literal">Start</code> function when we want to enable a script before any of the <code class="literal">Update</code> functions are called. In this case, we want to use the conditional <code class="literal">if</code> statement to check that the current scene we are in is scene 2.</p><p>We use the Unity function <code class="literal">Application.LoadLevelName</code> to retrieve the name of the level that is currently loaded. We use the <code class="literal">==</code> operator to check that it matches with scene 2.</p><p>If there is no match, then it means that we are in scene 1 (the first level of the game) and, therefore, we do not need to play the success audio. However, when we do load the second scene, there will be a match, and thus, the success sound effect will play in the second level.</p><p>We call the audio now instead of at the end of level 1 because there is no time as the second level gets loaded instantly as soon as the first level has been passed. As is always the case, there are many ways of doing it, and another option would have been to add a delay before loading the next scene. Have a look at the next code.</p></div><div class="informalexample"><pre class="programlisting">function Start()
{
  if (Application.loadedLevelName == "scene2")
  {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note142"></a>Note</h3><p>To play the win sound effect, we use the <code class="literal">AudioSource.PlayClipAtPoint</code> Unity function. The first parameter that we pass is the <code class="literal">winclip</code> variable that holds the audio clip of the win sound effect, and then the second parameter we pass is the location from which the sound plays. Have a look at the next code.</p></div><div class="informalexample"><pre class="programlisting">  AudioSource.PlayClipAtPoint(winclip, transform.position);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note143"></a>Note</h3><p>We only load our saved score from the previous level. If this is the first level, there will be no match in the preceding <code class="literal">if</code> statement and this script will <a id="id730" class="indexterm"></a>not get called as we want to start the first level from 0. To load our score, we use the Unity function <code class="literal">PlayerPrefs.GetFloat</code> because our score is of the float data value. As the first parameter, we pass the same name that we used when we saved the data for that value, and then for the second parameter, we use the value that we set, should no pre-existing data be saved.</p><p>It is very important to assign this function to a variable as it returns the loaded value. Thus, we assign this to our <code class="literal">score</code> variable as we have loaded the saved score from the first level and want to carry it across to the next level. Have a look at the next code.</p></div><div class="informalexample"><pre class="programlisting">    score = PlayerPrefs.GetFloat("score",0);
  }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note144"></a>Note</h3><p>For this game, we would like to display the player's score. Using the existing Unity <code class="literal">GUI</code> function that gets called automatically, we create a rectangle with a size that we specify, consisting of the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates denoting the starting position of the rectangle, followed by the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates denoting the ending position.</p><p>We then add the string of text that we would like to display within the box followed by the <code class="literal">+</code> sign and the variable.</p><p>The <code class="literal">+</code> sign concatenates (joins) the variable into a string so that it can be displayed as a string as the <code class="literal">GUI.Box</code> method can only display string types. Have a look at the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">function OnGUI()
{
  GUI.Box (Rect (10,10,100,30), "Score: "+score);
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note145"></a>Note</h3><p>We call our <code class="literal">MoveCharacter</code> function within <code class="literal">FixedUpdate</code> instead of <code class="literal">Update</code> as we are using a Rigidbody—when using physics, we need to ensure<a id="id731" class="indexterm"></a> that the updates occur in sync with the physics engine since using <code class="literal">Update</code> could cause inconsistencies depending on the frame rate of the game. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">function FixedUpdate()
{
  MoveCharacter();
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note146"></a>Note</h3><p>In the next code snippet, we define a function to move the character.</p></div><div class="informalexample"><pre class="programlisting">function MoveCharacter()
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note147"></a>Note</h3><p>In the next code, we detect if the input key from the keyboard is <span class="emphasis"><em>A</em></span>.</p></div><div class="informalexample"><pre class="programlisting">    if (Input.GetKey(KeyCode.A))
    {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note148"></a>Note</h3><p>Move the character to the left-hand side using <code class="literal">transform.Translate</code>, which is the function that moves a GameObject's position based on direction and distance.</p><p>The first parameter passes the direction and the next two parameters, being speed and time, pass the distance since distance is speed over time. We use <code class="literal">vector3.left</code>, which is the shorthand for a predefined vector moving to the left-hand side, which is (-1,0,0).</p><p>We then multiply by the speed that we want the character to move to the left-hand side at, and then the amount of time we want the character to be moving to the left-hand side, which in this case is for as long as the player is pressing down the <span class="emphasis"><em>A</em></span> key.</p><p>We use <code class="literal">Time.deltaTime</code> for this as it makes the movement frame-independent, allowing the character to move a certain distance per second instead of per frame because it calculates the seconds that have passed since the last frame. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">        transform.Translate(Vector3.left * speed * Time.deltaTime);
    }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note149"></a>Note</h3><p>In<a id="id732" class="indexterm"></a> the next code, we detect if the input key from the keyboard is <span class="emphasis"><em>D</em></span>.</p></div><div class="informalexample"><pre class="programlisting">    if (Input.GetKey(KeyCode.D))
    {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note150"></a>Note</h3><p>Move the character to the right-hand side using <code class="literal">transform.Translate</code>, which is the function that moves a GameObject's position based on direction and distance.</p><p>The first parameter passes the direction and the next two parameters, being the speed and time, pass the distance since distance is speed over time. We use <code class="literal">vector3.right</code>, which is the shorthand for a vector moving to the right-hand side.</p><p>We then multiply by the speed that we want the character to move to the right-hand side and by the amount of time we want the character to be moving to the right-hand side, which in this case is for as long as the player is pressing down the <span class="emphasis"><em>D</em></span> key.</p><p>We use <code class="literal">Time.deltaTime</code> for this as it makes the movement frame-independent, allowing the character to move a certain distance per second instead of per frame because it calculates the seconds it took to complete the last frame. Have a look at the next code snippet.</p></div><div class="informalexample"><pre class="programlisting">        transform.Translate(Vector3.right * speed * Time.deltaTime);
    }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note151"></a>Note</h3><p>In all our previous games, we made use of collision and the <code class="literal">OnCollisionEnter2D</code> function. However, this time, we are using a trigger instead, because we don't want the character to collide with the platforms, but instead pass through them; although, when the character passes <a id="id733" class="indexterm"></a>through the platforms, we want the character to jump. Therefore, we use a trigger to check when the player is on a platform to trigger the jump, and thus we use the <code class="literal">OnTriggerEnter2D</code> function.</p><p>For the parameter of the function, we pass the collider of the GameObject that passes through the trigger to check which GameObject has collided with the trigger and therefore triggered it. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">function OnTriggerEnter2D(other:Collider2D)
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note152"></a>Note</h3><p>We use the conditional <code class="literal">if</code> statement to check whether the GameObject <code class="literal">other</code>, that was passed through the function as a parameter, is a platform.</p><p>We check the name of the GameObject to check whether its name matches with the platform GameObject that is named <code class="literal">Platform</code>. Have a look at the next line of code</p></div><div class="informalexample"><pre class="programlisting">    if(other.gameObject.name=="Platform")
    {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note153"></a>Note</h3><p>The player increases their score by jumping. Each jump awards the player with 50 points. Therefore, since we know that Space Buddy has collided with the platform because the name of the collider matches, we assign our score variable the current score added with the 50 points.</p><p>We also play the jump sound effect on Space Buddy's collision with a platform. To play the jump sound effect, we use the <code class="literal">AudioSource.PlayClipAtPoint</code> Unity function.</p><p>The first parameter that we pass is the <code class="literal">jumpclip</code> variable that holds the audio clip of the jump sound effect, and then the second parameter we pass is the location from which the sound plays. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">score=score+50.0;
AudioSource.PlayClipAtPoint(jumpclip, transform.position);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note154"></a>Note</h3><p>Each<a id="id734" class="indexterm"></a> time that we award the player points to their score, we need to save the data, because if the game crashes or is interrupted, then we would lose the score. This way, we keep track of their progress. Also, we need to save the score to load it in the next level. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">      PlayerPrefs.SetFloat("score", score);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note155"></a>Note</h3><p>If the other GameObject's name is <code class="literal">Platform</code>, then that means that the character has collided with a platform and can jump on it. Thus, we move (accelerate) the character vertically in the <span class="emphasis"><em>y</em></span> axis using a 2D vector.</p><p>We assign a new velocity to the character in the <span class="emphasis"><em>y</em></span> axis by passing the <code class="literal">power</code> variable that we declared as the second parameter to the <code class="literal">vector2</code> function. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">        spacebuddy.velocity = new Vector2(0,power);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note156"></a>Note</h3><p>As the character is jumping up, it is only a matter of time until the character will jump off screen. Therefore, we need to find the camera in the scene and move it together with the character whenever the character jumps on a platform so that the character always remains in view.</p><p>To do this, we find the camera in the scene using the <code class="literal">Find</code> function and look for a match. Once the camera is found, we assign it to our <code class="literal">cam</code> variable to be used within our function. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">        cam = GameObject.Find("Camera");</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note157"></a>Note</h3><p>When the character falls to the bottom, hits the lava, and dies, it is game over. Thus, we have a trigger that we name <code class="literal">lava</code> below the camera to check that they <a id="id735" class="indexterm"></a>have fallen and hit the lava. We use the <code class="literal">Find</code> function to find the <code class="literal">lava</code> trigger within the scene. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">        lava = GameObject.Find("Lava");</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note158"></a>Note</h3><p>We move the camera up together with the character whenever the character jumps on a platform so that the character always remains onscreen. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">        cam.transform.Translate(Vector3.up * camSpeed * Time.deltaTime);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note159"></a>Note</h3><p>We move the lava trigger up whenever the character jumps on a platform and the camera moves up.</p><p>If we didn't move the lava trigger up, and if a character fell below the camera, there is a chance that the character may land on a platform and not reach the lava trigger's initial position, therefore never ending the game.</p><p>Thus, we raise the lava trigger up together with the character and camera on a platform jump so that it is always in the correct location (just below the camera and above any platforms) and cannot be missed. It also adds to the immersion having the lava rise up. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">lava.transform.Translate(Vector3.up * lavaSpeed * Time.deltaTime);
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note160"></a>Note</h3><p>We use the conditional <code class="literal">if</code> statement to check whether the GameObject <code class="literal">other</code>, that was passed through the function as a parameter, is the lava trigger. We check the name of the GameObject to check whether its name matches with the lava GameObject that is named <code class="literal">Lava</code>. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">    if(other.gameObject.name=="Lava")
    {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note161"></a>Note</h3><p>If the <code class="literal">other</code> GameObject's name is <code class="literal">Lava</code>, then that means that the character has collided with the lava trigger and thus triggered it. To play the sound <a id="id736" class="indexterm"></a>effect for losing, we use the <code class="literal">AudioSource.PlayClipAtPoint</code> Unity function. The first parameter that we pass is the <code class="literal">loseclip</code> variable that holds the audio clip of the lose sound effect, and then the second parameter we pass is the location from which the sound plays.</p><p>Triggering the lava trigger means that we can stop the game since it is game over. To stop the game, we use <code class="literal">Time.timescale</code> as it sets the amount of time at which time is passing. Setting it to <code class="literal">0</code> slows it to a stop. Have a look at the next code.</p></div><div class="informalexample"><pre class="programlisting">    AudioSource.PlayClipAtPoint(loseclip, transform.position);
        Time.timeScale = 0;
    }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note162"></a>Note</h3><p>To successfully complete a level, the player must get Space Buddy safely into the UFO beam at the very top of the level.</p><p>We use the conditional <code class="literal">if</code> statement to check whether the GameObject <code class="literal">other</code>, that was passed through the function as a parameter, is the <code class="literal">UFObeam</code> trigger.</p><p>We check the name of the GameObject to check whether its name matches with the <code class="literal">UFObeam</code> GameObject that is named <code class="literal">UFObeam</code>. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">    if(other.gameObject.name=="UFObeam")
    {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note163"></a>Note</h3><p>If the <code class="literal">other</code> GameObject's name is <code class="literal">UFObeam</code> instead of <code class="literal">Lava</code>, then that means that the character has collided with the <code class="literal">UFObeam</code> trigger, and thus triggered it.</p><p>Triggering the <code class="literal">UFObeam</code> trigger means that the player has completed level 1 successfully, and we can therefore load level 2. To load level 2, we use the Unity function <code class="literal">Application.LoadLevel</code> and pass the name of the level <a id="id737" class="indexterm"></a>that we want to load as its parameter. We then check the name of the GameObject to check whether its name matches with the <code class="literal">UFObeam2</code> GameObject that is named <code class="literal">UFObeam2</code>.</p></div><div class="informalexample"><pre class="programlisting">Application.LoadLevel("Scene2");
    }

  if(other.gameObject.name=="UFObeam2")
    {</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note164"></a>Note</h3><p>Triggering the <code class="literal">UFObeam2</code> trigger (which we will make later on in the chapter) means we can play the winning sound effect and stop the game since the game has been completed successfully. To play the win sound effect, we use the <code class="literal">AudioSource.PlayClipAtPoint</code> Unity function.</p><p>The first parameter that we pass is the <code class="literal">winclip</code> variable that holds the audio clip of the win sound effect, and then the second parameter we pass is the location from which the sound plays.</p><p>To stop the game, we use <code class="literal">Time.timescale</code> as it sets the amount of time at which time is passing. Setting it to <code class="literal">0</code> slows it to a stop. Have a look at the next line of code.</p></div><div class="informalexample"><pre class="programlisting">      AudioSource.PlayClipAtPoint(winclip, transform.position);
      Time.timeScale = 0;
    }
}</pre></div></li></ol></div><p>We can now build the script.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec88"></a>Space Buddy script</h3></div></div></div><p>The<a id="id738" class="indexterm"></a> following screenshot shows all the variables that we created in our script:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_10_08.jpg" /></div><p>We may <a id="id739" class="indexterm"></a>need to adjust (decrease) the power field for our level. The higher the power, the higher the character's jump! Try changing the power until it suits your needs. Do not be afraid of experimenting since game creation takes a fair amount of iteration to ensure that we get exactly what we are looking for.</p><p>We need to make sure that none of the fields are empty and there is no missing data.</p><p>In the Inspector, our Space Buddy script needs to match the preceding screenshot, and thus if the assets are not already assigned to the correct GameObject, we need to assign them so that they can be used in the script.</p><p>We need to assign assets to the following variables:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Spacebuddy Rigidbody 2D—to control our character</p></li><li style="list-style-type: disc"><p>Camera—so that we can move it</p></li><li style="list-style-type: disc"><p>Lava—so that we can raise it</p></li><li style="list-style-type: disc"><p>Audio clips—to play them</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec89"></a>Positioning</h3></div></div></div><p>We <a id="id740" class="indexterm"></a>position the first scene's game objects to match the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046OT_10_09.jpg" /></div></div></div>