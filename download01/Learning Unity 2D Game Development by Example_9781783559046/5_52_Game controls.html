<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec54"></a>Game controls</h2></div></div><hr /></div><p>In the previous chapter, we learned how to move a character left and right using input from our keyboard. However, many games make use of virtual controls instead, which are onscreen <a id="id397" class="indexterm"></a>controls. Therefore, it is worth creating our own game controls onscreen as opposed to entering input on the keyboard.</p><p>To do this, we will make use of sprites for the HUD to display the virtual controls and raycasting to detect when the player touches a control for input.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec55"></a>Raycasting</h3></div></div></div><p>Raycasting is a <a id="id398" class="indexterm"></a>query on the scene that returns objects that<a id="id399" class="indexterm"></a> intersect with a given ray (which is a point in space with a direction). If we cast a ray from the main 2D camera in a straight line into the screen (specified by where the player is touching/clicking), we can then check if a collider has been hit.</p><p>If a collider has been hit, then we can check the name of the collider's GameObject. Depending on which GameObject has been hit, we can call the appropriate script to move the character GameObject in the corresponding direction. Let's use raycasting by executing the given steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>We <a id="id400" class="indexterm"></a>download some public domain art from the following URL:</p><p>
<a class="ulink" href="http://freeartsprites.com/free-art/Space-Pack/" target="_blank">http://freeartsprites.com/free-art/Space-Pack/</a>
</p></li><li><p>Splice the image so that each control has been separated and the left, right, up, and down portions have become separate sprites.</p></li><li><p>Convert each of these into a GameObject, and name them so that they are identical to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_05_09.jpg" /></div><p>It is essential that they match as we will be calling those exact names in the script.</p></li><li><p>Add a Box Collider 2D to each control by going to <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li><li><p>We are going to check if a collider overlaps a point using <code class="literal">Physics2D.OverlapPoint</code>.</p></li><li><p>Assign<a id="id401" class="indexterm"></a> the following script to the right control:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note24"></a>Note</h3><p>We <a id="id402" class="indexterm"></a>check which platform the player is using as shown in the next line of code. We also declare a string variable by the name of control to store the control object's name.</p></div><div class="informalexample"><pre class="programlisting">var platform : RuntimePlatform = Application.platform;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note25"></a>Note</h3><p>We create a function to check for input as shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">function checkTouch(pos)
{</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"></a>Note</h3><p>We use raycasting to detect if the player's finger is overlapping with the virtual onscreen controls. The first variable is the ray as a 3D vector as shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">    var wp : Vector3 = Camera.main.ScreenToWorldPoint(pos);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"></a>Note</h3><p>The next variable consists of the <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span> coordinates of the player's finger, which is shown in the next line of code.</p></div><div class="informalexample"><pre class="programlisting">    var touchPos : Vector2 = new Vector2(wp.x, wp.y);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"></a>Note</h3><p>The final variable returns whether or not the player's finger coordinates overlap with a Physics 2D collider.</p></div><div class="informalexample"><pre class="programlisting">    var hit = Physics2D.OverlapPoint(touchPos);</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"></a>Note</h3><p>If <code class="literal">hit</code> returns true, then we move the ship. We also detect which control has received input by checking the name of the object that has received a collision on its collider. We then print it to our log to keep track and then check if the whether it was the right control that was pressed so that we move the ship to the right.</p></div><div class="informalexample"><pre class="programlisting">if(hit){
    control = hit.transform.name;
    print(""+control);
    if (control == "right")
    {
    move();
    }
    }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note30"></a>Note</h3><p>We <a id="id403" class="indexterm"></a>check to see the device the player is using<a id="id404" class="indexterm"></a> for input. For instance, if they are using a mobile device, then we use the touch functions for input detection; otherwise, we use the mouse functions for a PC.</p><p>With the respective functions, we check when a finger touches the screen for a mobile, or the mouse is pressed down for a PC, and then check the position in coordinates of the finger or mouse.</p></div><div class="informalexample"><pre class="programlisting">function Update()
{
 if(platform == RuntimePlatform.Android || platform == RuntimePlatform.IPhonePlayer){
       if(Input.touchCount &gt; 0) {
         if(Input.GetTouch(0).phase == TouchPhase.Began){
          checkTouch(Input.GetTouch(0).position);
         }
       }
    }else if(platform == RuntimePlatform.WindowsEditor){
       if(Input.GetMouseButtonDown(0)) {
         checkTouch(Input.mousePosition);
       }
    }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"></a>Note</h3><p>To move our ship, we find the Ship GameObject in the scene by its name. We then move it using <code class="literal">transform.Translate</code>, which moves the transform in the direction and at the distance of the translation relative to something.</p><p>In this case, we translate the ship's position using a 3D vector moving to the right direction multiplied by the distance of 10 units per second moving relative to the camera.</p></div><div class="informalexample"><pre class="programlisting">function move()
{
  
  ship = GameObject.Find("Ship");
  
  ship.transform.Translate(Vector3.right * (Time.deltaTime*10), Camera.main.transform);
  
}</pre></div></li><li><p>We <a id="id405" class="indexterm"></a>will use the ship we used in the previous <a id="id406" class="indexterm"></a>chapter.</p></li><li><p>When we click on play, the ship should move in the corresponding direction.</p></li><li><p>We copy the script three more times and use exactly the same script that we used before for the left, up, and down controls by simply replacing the direction: <code class="literal">ship.transform.Translate(Vector3.right * (Time.deltaTime*10), Camera.main.transform);</code>
</p></li><li><p>We build our code by going to <span class="strong"><strong>Build</strong></span> | <span class="strong"><strong>Build All</strong></span> and click on the play button in Unity to test it.</p></li></ol></div><p>The following screenshot displays our ship with virtual controls:</p><div class="mediaobject"><img src="/graphics/9781783559046/graphics/9046_05_10.jpg" /></div></div></div>