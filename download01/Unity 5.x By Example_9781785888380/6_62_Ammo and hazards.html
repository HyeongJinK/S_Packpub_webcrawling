<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec63"></a>Ammo and hazards</h2></div></div><hr /></div><p>Level 2 is a <a id="id390" class="indexterm"></a>hazardous place. It should feature not only pits and holes leading to kill zones, but also fixed dangers such as gun turrets that can shoot the player. This section focuses on their creation. To get started, let's make a gun turret. Now, the course companion files don't include a texture or image for the gun turrets, but when using the dark silhouette style as we are here, we can easily make a consistent turret prop from primitives. In particular, create a new cube object (<span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Cube</strong></span>), rescale it to approximate a gun turret, and then position it to the upper ledge in the scene where it will appear as part of the scenery. See <span class="emphasis"><em>Figure 6.22</em></span>. Note that you can also use the <span class="strong"><strong>Rect Transform</strong></span> tool to resize primitives!</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_22.jpg" /><div class="caption"><p>Figure 6.22: Creating a prop for a gun turret</p></div></div><p>Of course, the gun turret created so far is a conspicuous and obvious grey color. To solve this, create a new black material. Right-click in the <span class="strong"><strong>Project</strong></span> panel and choose <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Material</strong></span> from the context menu. Assign the material a black color from the <span class="strong"><strong>Object Inspector</strong></span> in the <span class="strong"><strong>Albedo</strong></span> field, and then drag and drop the material from the <span class="strong"><strong>Project</strong></span> panel to the <span class="strong"><strong>Turret</strong></span> object in the scene. Make sure that the <span class="strong"><strong>Smoothness</strong></span> field for the black material is <a id="id391" class="indexterm"></a>reduced to <code class="literal">0</code> to prevent a shiny or glowing appearance. After the material is assigned, the turret will mix with the scene and its color scheme will be much better! See <span class="emphasis"><em>Figure 6.23</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_23.jpg" /><div class="caption"><p>Figure 6.23: Assigning a black material to the turret</p></div></div><p>Now, the turret must fire ammo. To achieve this, it'll need an empty game object to spawn ammo. Let's create this now by choosing <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span> and drag and drop the object in the <span class="strong"><strong>Hierarchy</strong></span> panel to the Turret Cube in order to make it a child of the turret. Then, position the empty object to the tip of the cannon. Once positioned, assign an icon representation to the empty to make it visible in the viewport. Ensure that the empty is selected and, from the Inspector, click on the cube icon (beside the object name) to assign it a graphical representation. See <span class="emphasis"><em>Figure 6.24</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_24.jpg" /><div class="caption"><p>Figure 6.24: Assigning an icon to the Turret Spawn Point</p></div></div><p>Before moving further with ammo spawning, we'll actually need some ammo to spawn. That is, the turret must fire something, and now it's time to create this something. The ammo should appear as a glowing and pulsating plasma ball. To build this, create a new particle system by choosing <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>ParticleSystem</strong></span> from the application menu. Remember that a particle system is useful to create special effects such as rain, fire, dust, smoke, sparkles, and more. When you create a new particle system from the main menu, a new object is <a id="id392" class="indexterm"></a>created in the scene and is automatically selected. When selected, you can preview how the particle system works and looks in the <span class="strong"><strong>Scene</strong></span> viewport. By default, the system will be spawning small blob-like particles. See <span class="emphasis"><em>Figure 6.25</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_25.jpg" /><div class="caption"><p>Figure 6.25: Creating a particle system</p></div></div><p>Sometimes, on creating a particle system for a 2D game, the particles themselves may not be visible because they appear behind other 2D objects in the scene, such as the background and characters. You can control the depth order of the particle system from the <span class="strong"><strong>Object Inspector</strong></span>. Scroll down in the <span class="strong"><strong>Object Inspector</strong></span> and click on the <span class="strong"><strong>Renderer</strong></span> roll-out title to expand more options, bringing them into view. From the <span class="strong"><strong>Renderer</strong></span> group, set the <span class="strong"><strong>Order In Layer</strong></span> field to a higher value, above the order of other objects to render the particles in front. See <span class="emphasis"><em>Figure 6.26</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_26.jpg" /><div class="caption"><p>Figure 6.26: Controlling the render order of particles</p></div></div><p>Excellent, we should now see particles in the viewport. Getting a particle system to look and behave correctly takes some tweaking and trial and error. It involves testing settings, previewing their effects in the viewport, making judgments about what is needed, and then tweaking and amending as needed. To start creating a more believable ammo object, I want <a id="id393" class="indexterm"></a>particles to spawn slowly in multiple directions and not just one direction. To achieve this, expand the <span class="strong"><strong>Shape</strong></span> field from the <span class="strong"><strong>Object Inspector</strong></span> to control the shape of the spawn surface. Change the <span class="strong"><strong>Shape</strong></span> from <span class="strong"><strong>Cone</strong></span> to <span class="strong"><strong>Sphere</strong></span> and set <span class="strong"><strong>Radius</strong></span> to <code class="literal">0.01</code>. On doing this, particles will spawn and travel in all directions emitted from a Sphere surface. See <span class="emphasis"><em>Figure 6.27</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_27.jpg" /><div class="caption"><p>Figure 6.27: Changing the shape of the particle system emitter</p></div></div><p>Now, adjust the main particle system properties to create the energy ball effect. From the <span class="strong"><strong>Object Inspector</strong></span>, set <span class="strong"><strong>Start Lifetime</strong></span> to <code class="literal">0.19</code>, <span class="strong"><strong>Start Speed</strong></span> to <code class="literal">0.88</code>, and <span class="strong"><strong>Start Size</strong></span> to <code class="literal">0.59</code>. Then, set <span class="strong"><strong>Start Color</strong></span> to <span class="strong"><strong>teal (light blue)</strong></span>. See <span class="emphasis"><em>Figure 6.28</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_28.jpg" /><div class="caption"><p>Figure 6.28: Configuring the particle system main properties</p></div></div><p>Great! The particle system should now look just as we need it. However, if we press play on the toolbar, it doesn't move. Ammo should, of course, hurtle through the air and collide with its target. So, let's make a <code class="literal">Mover</code> script that should be attached to the object. The <a id="id394" class="indexterm"></a>following is the code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
//--------------------------------
public class Mover : MonoBehaviour 
{
    //--------------------------------
    public float Speed = 10f;
    private Transform ThisTransform = null;
    //--------------------------------
    // Use this for initialization
    void Awake() 
    {
        ThisTransform = GetComponent&lt;Transform&gt;();
    }
    //--------------------------------
    // Update is called once per frame
    void Update () 
    {
        //Update object position
        ThisTransform.position += ThisTransform.forward * Speed * Time.deltaTime;
    }
    //--------------------------------
}
//-------------------------------- </pre></div><p>The Mover features nothing that we haven't seen before many times already. It moves an object (the ammo) in direction of its forward vector. For this reason, as our game is two-dimensional, the particle system object may need to be rotated in order to turn the forward <a id="id395" class="indexterm"></a>vector along the <span class="emphasis"><em>X</em></span> axis. See <span class="emphasis"><em>Figure 6.29</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_29.jpg" /><div class="caption"><p>Figure 6.29: Aligning the forward vector to the X axis</p></div></div><p>Next, in addition to moving through the level, the ammo object must collide with and damage the player character on impact. To achieve this, several steps must be taken. First, a Rigidbody component must be attached to the ammo, allowing it to collide with other objects. To add Rigidbody, select the Ammo object in the scene and, from the application menu, choose <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Rigidbody2D</strong></span>. Once added, enable the <span class="strong"><strong>Is Kinematic</strong></span> checkbox from the Rigidbody component in the <span class="strong"><strong>Object Inspector</strong></span>. This ensures that the object will travel based on the Mover script and still interact with physical objects without being affected by gravity. See <span class="emphasis"><em>Figure 6.30</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_30.jpg" /><div class="caption"><p>Figure 6.30: Marking Rigidbody with Is Kinematic</p></div></div><p>Now for a Circle Collider to the ammo object to give the ammo some shape, form, and size in terms of physics, allowing collisions to be detected between the ammo and its target. To do this, choose <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics 2D CircleCollider</strong></span> from the application menu. Once <a id="id396" class="indexterm"></a>added, mark the collider as Trigger and change <span class="strong"><strong>Radius</strong></span> until it approximates the size of the ammo object. See <span class="emphasis"><em>Figure 6.31</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_31.jpg" /><div class="caption"><p>Figure 6.31: Configuring the Circle Collider for the Ammo object</p></div></div><p>The ammo should support two final and additional behaviors. First, the ammo should damage and perhaps destroy any target it collides with, and second, the ammo should destroy itself, both after an elapsed time and if it collides with the target. To achieve this, two additional <a id="id397" class="indexterm"></a>scripts will be created; specifically, <code class="literal">CollideDestroy.cs</code> and <code class="literal">Ammo.cs</code>. The following code lists the <code class="literal">Ammo.cs</code> file:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
//-----------------------------------------
public class Ammo : MonoBehaviour
{    
    //-----------------------------------------
    //Damage inflicted on Player
    public float Damage = 100f;

    //Lifetime for ammo
    public float LifeTime = 1f;
    //-----------------------------------------
    void Start()
    {
        Invoke ("Die", LifeTime);
    }//-----------------------------------------

    void OnTriggerEnter2D(Collider2D other)
    {
        //If not player then exit
        if(!other.CompareTag("Player"))return;
        
        //Inflict damage
        PlayerControl.Health -= Damage;
    }
    //-----------------------------------------
    public void Die()
    {
        Destroy(gameObject);
    }
}
//-----------------------------------------</pre></div><p>The following code lists the <code class="literal">CollideDestroy.cs</code> file:</p><div class="informalexample"><pre class="programlisting">//--------------------------------
using UnityEngine;
using System.Collections;
//--------------------------------
public class CollideDestroy : MonoBehaviour
{
    //--------------------------------
    //When hit objects with associated tag, then destroy
    public string TagCompare = string.Empty;
    //--------------------------------
    void OnTriggerEnter2D(Collider2D other)
    {
        if(!other.CompareTag(TagCompare))return;

        Destroy(gameObject);
    }
    //--------------------------------
}
//-------------------------------- </pre></div><p>The code spanning across these files is functionality that we encountered before when making the <a id="id398" class="indexterm"></a>Twin-stick Space Shooter. Both the files should be attached to the ammo object in the scene. Once completed, just drag and drop the ammo object from the scene viewport to the <span class="strong"><strong>Project</strong></span> panel in the <span class="strong"><strong>Prefabs</strong></span> folder. This makes an Ammo prefab, ready to add to any scene. See <span class="emphasis"><em>Figure 6.32</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_32.jpg" /><div class="caption"><p>Figure 6.32: Adding the Destroy and Ammo components to the Ammo and then making a prefab</p></div></div><p>Excellent work! You now have an ammo object that fires, moves, and collides with the player. By setting the <span class="strong"><strong>Damage</strong></span> setting high enough, you will be able to destroy the player on impact. Give this a test now by adding an ammo object to the scene and pressing the play icon. Of course, right now, nothing in the scene actually fires the ammo. We'll explore that next.</p></div>