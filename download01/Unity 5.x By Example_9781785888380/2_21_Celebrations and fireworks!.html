<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec26"></a>Celebrations and fireworks!</h2></div></div><hr /></div><p>The coin collection <a id="id152" class="indexterm"></a>game is nearly finished. Coins can be collected and <a id="id153" class="indexterm"></a>a timer expires, but the win condition itself is not truly handled. That is, when all coins are collected before time expiry, nothing actually happens to show the player that they've won. The countdown still proceeds and even restarts the level as though the win condition hadn't been satisfied at all. Let's fix this now. Specifically, when the win scenario happens, we should delete the timer object to prevent further countdown and show visual feedback to signify that the level has been completed. In this case, I'll add some fireworks! So, let's start by creating the fireworks. You can add these <a id="id154" class="indexterm"></a>easily from the Unity 5 <span class="strong"><strong>Particle System</strong></span> packages. Navigate to the <code class="literal">Standard Assets</code> | <code class="literal">ParticleSystems</code> | <code class="literal">Prefabs</code> folder. Then, drag and drop the <code class="literal">Fireworks</code> particle system in <span class="strong"><strong>Scene</strong></span>. Add a second or even a third one if you want.</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_29.jpg" /><div class="caption"><p>Figure 2.29: Adding two Fireworks prefabs</p></div></div><p>By default, all firework particle systems will play when the level begins. You can test this by pressing play on the toolbar. This is not the behavior that we want. We only want the fireworks to play when the win condition has been satisfied. To disable playback on level startup, select the <span class="strong"><strong>Particle System</strong></span> object in the <span class="strong"><strong>Scene</strong></span> and, from the <span class="strong"><strong>Object Inspector</strong></span>, disable the <span class="strong"><strong>Play On Awake</strong></span> checkbox, which can be found in the <span class="strong"><strong>Particle System</strong></span> component. See <span class="emphasis"><em>Figure 2.30</em></span>, Disabling <span class="strong"><strong>Play On Awake</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_30.jpg" /><div class="caption"><p>Figure 2.30: Disabling Play On Awake</p></div></div><p>Disabling <span class="strong"><strong>Play On Awake</strong></span> prevents particle systems playing automatically at level startup. This is fine, but if they are ever to play at all, something must manually start them at the right time. We can achieve this through code. Before resorting to a coding solution, however, we'll first mark all firework objects with an appropriate tag. The reason for this is that, in code, we'll want to search for all firework objects in the scene and trigger them to play when needed. To isolate the firework objects from all other objects, we'll use tags. So, let's create a new <span class="strong"><strong>Fireworks</strong></span> tag and assign them to the firework objects only in the <span class="strong"><strong>Scene</strong></span>. Tags were created earlier in this chapter when configuring the player character for coin collisions. See <span class="emphasis"><em>Figure 2.31</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_31.jpg" /><div class="caption"><p>Figure 2.31: Tagging firework objects</p></div></div><p>With the firework objects now tagged, we can refine the <code class="literal">Coin.cs</code> script class to handle a win condition for the scene, as shown in <span class="emphasis"><em>Code Sample 2.7</em></span>. Comments follow:</p><div class="informalexample"><pre class="programlisting">//-------------------------
using UnityEngine;
using System.Collections;
//-------------------------
public class Coin : MonoBehaviour
{
  //-------------------------
  public static int CoinCount = 0;
  //-------------------------
  // Use this for initialization
  void Awake () 
  {
    //Object created, increment coin count
    ++Coin.CoinCount;
  }
  //-------------------------
  void OnTriggerEnter(Collider Col)
  {
    //If player collected coin, then destroy object
    if(Col.CompareTag("Player"))
      Destroy(gameObject);
  }
  //-------------------------
  void OnDestroy()
  {
    --Coin.CoinCount;

    //Check remaining coins
    if(Coin.CoinCount &lt;= 0)
    {
      //Game is won. Collected all coins
      //Destroy Timer and launch fireworks
      <span class="strong"><strong>GameObject Timer = GameObject.Find("LevelTimer");</strong></span>
      <span class="strong"><strong>Destroy(Timer);</strong></span>

      <span class="strong"><strong>GameObject[] FireworkSystems = </strong></span>        <span class="strong"><strong>GameObject.FindGameObjectsWithTag("Fireworks");</strong></span>
      <span class="strong"><strong>foreach(GameObject GO in FireworkSystems)</strong></span>
      <span class="strong"><strong>GO.GetComponent&lt;ParticleSystem&gt;().Play();</strong></span>
    }
  }
  //-------------------------
}
//-------------------------</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec10"></a>Code Sample 2.7</h3></div></div></div><p>The following points summarize the code sample:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">OnDestroy</code> <a id="id155" class="indexterm"></a>function is critical. It occurs when a coin is collected and features an <code class="literal">if</code> statement to determine when all coins are collected (the win scenario).</p></li><li style="list-style-type: disc"><p>When a win scenario happens, the <code class="literal">GameObject.Find</code> function is called to search the complete scene hierarchy for any active object named <code class="literal">LevelTimer</code>. If found, the object is deleted. This happens to delete the timer and prevent any further countdown when the level is won. If the scene contains multiple objects of a matching name, then only the first object is returned. This is one reason why the scene should contain one and only one timer.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note12"></a>Note</h3><p>Avoid using the <code class="literal">GameObject.Find</code> function wherever possible. It's slow for performance. Instead, use <code class="literal">FindGameObjectsWithTag</code>. It's been used here only to demonstrate its existence and purpose. Sometimes, you'll need to use it to find a single, miscellaneous object that has no specific tag.</p></div></li><li style="list-style-type: disc"><p>In addition to deleting the <code class="literal">LevelTimer</code> object, the <code class="literal">OnDestroy</code> function finds all firework objects in the scene and initiates them. It finds all objects of a matching tag using the <code class="literal">GameObject.FindGameObjectsWithTag</code> function. This function returns an array of all objects with the <span class="strong"><strong>Fireworks</strong></span> tag and the <code class="literal">ParticleSystem</code> is initiated for each object by calling the <code class="literal">Play</code> function.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note13"></a>Note</h3><p>As mentioned, each <code class="literal">GameObject</code> in Unity is really made from a collection of attached <a id="id156" class="indexterm"></a>and related components. An object is the sum of its components. For example, a standard cube (created using <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Cube</strong></span>) is made from a <span class="strong"><strong>Transform</strong></span> component, <span class="strong"><strong>Mesh Filter</strong></span> component, <span class="strong"><strong>Mesh Renderer</strong></span> component, and <span class="strong"><strong>Box Collider</strong></span> component. These components together make the cube what it is and behave how it does.</p><p>The <code class="literal">GetComponent</code> function can be called in script to retrieve a reference to any specified component, giving you direct access to its public properties. The <code class="literal">OnDestroy</code> function in the preceding code uses <code class="literal">GetComponent</code> to retrieve a reference to the <code class="literal">ParticleSystem</code> component attached to the object. <code class="literal">GetComponent</code> is a highly useful and important function. More information on <a id="id157" class="indexterm"></a>
<code class="literal">GetComponent</code> can be found at the online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/GameObject.GetComponent.html" target="_blank">http://docs.unity3d.com/ScriptReference/GameObject.GetComponent.html</a>.</p></div></li></ul></div></div></div>