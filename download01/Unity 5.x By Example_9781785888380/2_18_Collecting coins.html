<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec23"></a>Collecting coins</h2></div></div><hr /></div><p>Previously, we <a id="id118" class="indexterm"></a>developed a coin counting variable telling us how many coins are <a id="id119" class="indexterm"></a>in the scene. However, regardless of the count, the player still can't collect the coins during gameplay. Let's fix this now. To start, we need to think about collisions. Thinking carefully, we know that a coin is considered collected whenever the player walks into it, that is, a coin is collected when the player and the coin intersect or collide.</p><p>To determine when a collision happens like that, we must approximate the volume of both the player and coin in order to determine when the two volumes overlap in space. This is achieved in Unity through colliders. Colliders are special physics objects attached to meshes. They tell us when two meshes intersect. The <code class="literal">FPSController</code> object (First-person controller) already has a collider on it, through its <span class="strong"><strong>Character Controller</strong></span> component. This approximates the physical body of a generic person. This can be confirmed by selecting <code class="literal">FPSController</code> in the <span class="strong"><strong>Scene</strong></span> and examining the green wireframe cage surrounding the main camera. It is capsule-shaped. See <span class="emphasis"><em>Figure 2.15</em></span>, the <span class="strong"><strong>Character Controller</strong></span> features a Collider to approximate the player body:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_15.jpg" /><div class="caption"><p>Figure 2.15: The Character Controller features a collider to approximate the player body</p></div></div><p>
<code class="literal">FPSController</code> features a <span class="strong"><strong>Character Controller</strong></span> component attached, which is configured by default with <span class="strong"><strong>Radius</strong></span>, <span class="strong"><strong>Height</strong></span>, and <span class="strong"><strong>Center</strong></span> settings, defining the physical extents of the character <a id="id120" class="indexterm"></a>in the scene. See <span class="emphasis"><em>Figure 2.16</em></span>, <code class="literal">FPSController</code> features <span class="strong"><strong>Character Controller</strong></span>. These settings can be left unchanged for our game:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_16.jpg" /><div class="caption"><p>Figure 2.16: FPSController features a Character Controller</p></div></div><p>The <code class="literal">Coin</code> object, in contrast, features only a <span class="strong"><strong>Capsule Collider</strong></span> component, which was added automatically when we created the <span class="strong"><strong>Cylinder</strong></span> primitive earlier to resemble a coin. This approximates the coin's physical volume in the scene without adding any additional features specific to characters and motion as found in the <span class="strong"><strong>Character Controller</strong></span> component. This is fine, because the coin is a <span class="strong"><strong>Static</strong></span> object as opposed to a moving and dynamic object like the <a id="id121" class="indexterm"></a>
<code class="literal">FPSController</code>. See <span class="emphasis"><em>Figure 2.17</em></span>, <span class="strong"><strong>Cylinder</strong></span> primitives <a id="id122" class="indexterm"></a>feature a <span class="strong"><strong>Capsule Collider</strong></span> component:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_17.jpg" /><div class="caption"><p>Figure 2.17: Cylinder primitives feature a Capsule Collider component</p></div></div><p>For this project, I'll stick to using a <span class="strong"><strong>Capsule Collider</strong></span> component for the <code class="literal">Coin</code> object. However, if you want to change the attached collider to a different shape instead, such as a box or sphere, you can do this by first removing any existing collider components on the coinâ€”click on the cog icon of the component in the <span class="strong"><strong>Object Inspector</strong></span> and then select <span class="strong"><strong>Remove Component</strong></span> <a id="id123" class="indexterm"></a>from the context menu. See <span class="emphasis"><em>Figure 2.18</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_18.jpg" /><div class="caption"><p>Figure 2.18: Removing a component from an object</p></div></div><p>You can then add a new collider component to the selected object by choosing <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> <a id="id124" class="indexterm"></a>from the application menu and then choosing a suitably shaped collider. See <span class="emphasis"><em>Figure 2.19</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_19.jpg" /><div class="caption"><p>Figure 2.19: Adding a component to the selected object</p></div></div><p>Regardless of the collider type used, there's a minor problem. If you play the game now and try to run through the coin, it'll block your path. The coin acts as a solid, physical object through which <code class="literal">FPSController</code> cannot pass. However, for our purposes, this isn't how the coin should behave. It's supposed to be a collectible object. The idea is that when we walk through it, the coin is collected and disappears. We can fix this easily by selecting the <code class="literal">Coin</code> object and enabling the <span class="strong"><strong>Is Trigger</strong></span> checkbox in the <span class="strong"><strong>Capsule Collider</strong></span> component, in the <a id="id125" class="indexterm"></a>
<span class="strong"><strong>Object Inspector</strong></span>. The <span class="strong"><strong>Is Trigger</strong></span> setting appears for almost all collider types. It lets us detect collisions and intersections with other colliders while allowing them to pass through. See <span class="emphasis"><em>Figure 2.20</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_20.jpg" /><div class="caption"><p>Figure 2.20: The Is Trigger setting allows objects to pass through colliders</p></div></div><p>If you play the game now, <code class="literal">FPSController</code> will easily walk through all coin objects in the scene. This is a good start. However, the coins don't actually disappear when touched; they still don't get collected. To achieve this, we'll need to add more script to the <code class="literal">Coin.cs</code> file. Specifically, we'll add an <code class="literal">OnTriggerEnter</code> function. This function is called automatically <a id="id126" class="indexterm"></a>when an object, like the player, enters a collider. For now, we'll add a <code class="literal">Debug.Log</code> statement to print a debug message when the player enters the <a id="id127" class="indexterm"></a>collider, just for test purposes. See <span class="emphasis"><em>Code Sample 2.4</em></span>:</p><div class="informalexample"><pre class="programlisting">//-------------------------
using UnityEngine;
using System.Collections;
//-------------------------
public class Coin : MonoBehaviour 
{
  //-------------------------
  public static int CoinCount = 0;
  //-------------------------
  // Use this for initialization
  void Start () {
    //Object created, increment coin count
    ++Coin.CoinCount;
  }
  //-------------------------
  <span class="strong"><strong>void OnTriggerEnter(Collider Col)</strong></span>
  <span class="strong"><strong>{</strong></span>
    <span class="strong"><strong>Debug.Log ("Entered Collider")</strong></span>;
  <span class="strong"><strong>}</strong></span>
  //-------------------------
  //Called when object is destroyed
  void OnDestroy()
  {
    //Decrement coin count
    --Coin.CoinCount;
    
    //Check remaining coins
    if(Coin.CoinCount &lt;= 0)
    {
      //We have won
    }
  }
  //-------------------------
}
//-------------------------</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note08"></a>Note</h3><p>More <a id="id128" class="indexterm"></a>information on the <code class="literal">OnTriggerEnter</code> function can be found at the online Unity documentation here:</p><p>
<a class="ulink" href="http://docs.unity3d.com/ScriptReference/MonoBehaviour.OnTriggerEnter.html" target="_blank">http://docs.unity3d.com/ScriptReference/MonoBehaviour.OnTriggerEnter.html</a>
</p></div><p>Test the <span class="emphasis"><em>Code Sample 2.4</em></span> by pressing play on the toolbar. When you run into a coin, the <code class="literal">OnTriggerEnter</code> function will be executed and the message displayed. However, the question remains as to <a id="id129" class="indexterm"></a>what object initiated this function in the first place. It's true that something collided with the coin, but what exactly? Was it the player, an enemy, a falling brick, or something else? To check this, we'll use <span class="strong"><strong>Tag</strong></span>. The <span class="strong"><strong>Tag</strong></span> feature lets you mark specific objects in the scene with specific tags or labels, allowing these objects to be easily identified in code so that we can check quickly that the player, rather than other objects, are colliding with the coins. After all, it should only be the player that can <a id="id130" class="indexterm"></a>collect coins. So, firstly, we'll tag the player object with a tag called <span class="strong"><strong>Player</strong></span>. To do this, select the <code class="literal">FPSController</code> object in the scene and then click on the <span class="strong"><strong>Tag</strong></span> drop-down box in the <span class="strong"><strong>Object Inspector</strong></span>. From here, select the <span class="strong"><strong>Player</strong></span> tag. This marks <code class="literal">FPSController</code> as the <code class="literal">Player</code> object. See <span class="emphasis"><em>Figure 2.21</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_02_21.jpg" /><div class="caption"><p>Figure 2.21: Tagging FPSController as Player</p></div></div><p>With <code class="literal">FPSController</code> now tagged as <span class="strong"><strong>Player</strong></span>, we can refine the <code class="literal">Coin.cs</code> file, as shown in <span class="emphasis"><em>Code Sample 2.5</em></span>. This <a id="id131" class="indexterm"></a>handles coin collection, making the coin disappear on touch and decreasing the coin count.</p><div class="informalexample"><pre class="programlisting">//-------------------------
using UnityEngine;
using System.Collections;
//-------------------------
public class Coin : MonoBehaviour 
{
  //-------------------------
  public static int CoinCount = 0;
  //-------------------------
  // Use this for initialization
  void Start () {
    //Object created, increment coin count
    ++Coin.CoinCount;
  }
  //-------------------------
  void OnTriggerEnter(Collider Col)
  {
    //If player collected coin, then destroy object
    <span class="strong"><strong>if(Col.CompareTag("Player"))</strong></span>
      <span class="strong"><strong>Destroy(gameObject);</strong></span>
  }
  //-------------------------
  //Called when object is destroyed
  void OnDestroy()
  {
    //Decrement coin count
    --Coin.CoinCount;
    
    //Check remaining coins
    if(Coin.CoinCount &lt;= 0)
    {
      //We have won
    }
  }
  //-------------------------
}
//-------------------------</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec08"></a>Code Sample 2.5</h3></div></div></div><p>The following points summarize the code sample:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">OnTriggerEnter</code> is called once automatically by Unity each time <code class="literal">FPSController</code> <a id="id132" class="indexterm"></a>intersects the <code class="literal">Coin</code> collider</p></li><li style="list-style-type: disc"><p>When <code class="literal">OnTriggerEnter</code> is called, the <code class="literal">Col</code> argument contains information about the object that entered the collider on this occasion</p></li><li style="list-style-type: disc"><p>The <code class="literal">CompareTag</code> function is used to determine if the colliding object is the <code class="literal">Player</code> as opposed to a different object</p></li><li style="list-style-type: disc"><p>The <code class="literal">Destroy</code> function is called to destroy the <code class="literal">Coin</code> object itself, represented internally by the inherited member variable, <code class="literal">gameObject</code>
</p><p>When the <code class="literal">Destroy</code> function is called, the <code class="literal">OnDestroy</code> event is invoked automatically, which decrements the <code class="literal">Coin</code> count</p></li></ul></div><p>Excellent work! You've just created your first working coin. The player can now run into the coin, collect it, and remove it from the scene. This is a great beginning, but the scene should contain more than one coin. We could solve this by duplicating the existing coin many times and repositioning each duplicate to a different place. However, there's a better way, as we'll see next.</p></div></div>