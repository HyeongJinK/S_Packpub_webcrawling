<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec71"></a>Building an NPC</h2></div></div><hr /></div><p>Now we'll build <a id="id439" class="indexterm"></a>an NPC character that'll display artificial intelligence. To get started, we'll use the Ethan mesh included in the Unity native <a id="id440" class="indexterm"></a>companion assets. This can be found in the <span class="strong"><strong>Project</strong></span> panel under the <span class="strong"><strong>Standard Assets</strong></span> | <span class="strong"><strong>Characters</strong></span> | <span class="strong"><strong>ThirdPersonCharacter</strong></span> | <span class="strong"><strong>Models</strong></span> folder. From here, drag and drop the Ethan model to the scene and position it on the terrain. We'll refine and edit this model and, eventually, create a prefab from it to represent an NPC character. See <span class="emphasis"><em>Figure 7.25</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_25.jpg" /><div class="caption"><p>Figure 7.25: Starting an NPC character</p></div></div><p>When adding the Ethan model to the level, ensure that the blue forward vector of the character is pointing forward, facing the direction in which the character is actually looking. If the forward vector is not front-aligned, then create an empty object and align the character model to that as a child object so that the forward vector of the parent is pointing straight ahead, along the character's line of sight. That is, the blue forward vector should align with the character's eye (be looking in the same direction). This is highly important to make your character move around believably. See <span class="emphasis"><em>Figure 7.26</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_26.jpg" /><div class="caption"><p>Figure 7.26: Forward vector (blue arrow) pointing forward at the character's feet</p></div></div><p>The NPC <a id="id441" class="indexterm"></a>should navigate and walk around the terrain intelligently using the Navigation Mesh generated for the level. For this, a NavMesh <a id="id442" class="indexterm"></a>agent component should be attached to the character. Select the Ethan model in the level and, from the application menu, choose <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Navigation NavMesh Agent</strong></span>. The NavMesh Agent component contains both Path-Finding and Steering (Navigation) behaviors that allow a GameObject to move around a Navigation Mesh. See <span class="emphasis"><em>Figure 7.27</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_27.jpg" /><div class="caption"><p>Figure 7.27: Attaching a NavMeshAgent component to an NPC</p></div></div><p>By default, the Navigation Mesh assigns a Cylinder Collision volume to the Agentâ€”the object that will navigate and move around. This is not a true collider that acts with the physics system but a pseudo-collider used to determine when the character nears the edge of a navigation mesh. Select the Ethan NPC and, from the <span class="strong"><strong>Inspector</strong></span> in the NavMesh Agent component, set the <span class="strong"><strong>Height</strong></span> to <code class="literal">1.66</code> and <span class="strong"><strong>Radius</strong></span> to <code class="literal">0.22</code>. This approximates the mesh more <a id="id443" class="indexterm"></a>closely. See <span class="emphasis"><em>Figure 7.28</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_28.jpg" /><div class="caption"><p>Figure 7.28: Sizing the Agent Collider</p></div></div><p>For test purposes, let's make the mesh move; just to see that everything is working as it should be. To do this, we'll need to make a new script. First, create a new empty object, which will act as a <span class="emphasis"><em>Destination</em></span>, that is, a target object that the NPC should reach, wherever it is. Select <a id="id444" class="indexterm"></a>
<span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span> from the application menu. Name it <code class="literal">Destination</code>, and then assign it a Gizmo icon to make it visible in the viewport. See <span class="emphasis"><em>Figure 7.29</em></span>. Simply click on the cube icon at the top left of the <span class="strong"><strong>Object Inspector</strong></span> with the object selected, and then choose an icon representation.</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_29.jpg" /><div class="caption"><p>Figure 7.29: Creating a Destination object</p></div></div><p>Next, create a new C# script file (<code class="literal">FollowDestination.cs</code>) and attach it to the NPC object in <a id="id445" class="indexterm"></a>the scene. The code is included in <a id="id446" class="indexterm"></a>
<span class="emphasis"><em>Code Sample 7.1</em></span>, and comments, which is as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class FollowDestination : MonoBehaviour
{
  private NavMeshAgent ThisAgent = null;
  public Transform Destination = null;

  // Use this for initialization
  void Awake () 
  {
    ThisAgent = GetComponent&lt;NavMeshAgent&gt;();
  }
  
  // Update is called once per frame
  void Update () 
  {
    ThisAgent.SetDestination(Destination.position);
  }
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec28"></a>Code Sample 7.1</h3></div></div></div><p>The following points summarize the code sample:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <a id="id447" class="indexterm"></a>
<code class="literal">FollowDestination</code> class can be attached to any object with a NavMeshAgent. This object should follow the destination object as it moves.</p></li><li style="list-style-type: disc"><p>The <code class="literal">Destination</code> variable maintains the destination object to follow.</p></li></ul></div><p>Once attached to the NPC object, drag and drop the destination empty object to the <span class="strong"><strong>Destination</strong></span> slot for the FollowDestination component in the <span class="strong"><strong>Inspector</strong></span>. This assigns a destination <a id="id448" class="indexterm"></a>for the script. See <span class="emphasis"><em>Figure 7.30</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_30.jpg" /><div class="caption"><p>Figure 7.30: Configuring a FollowDestination object</p></div></div><p>Now give the game a test run. During gameplay, move the destination object around via the <span class="strong"><strong>Scene</strong></span> tab and see how the NPC responds. The NPC should continually chase the destination object. In addition, if you play the game with the <span class="strong"><strong>Navigation</strong></span> window open in the <span class="strong"><strong>Inspector</strong></span> and with the NPC selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, the <span class="strong"><strong>Scene</strong></span> view will display diagnostic information and gizmos, allowing you to preview and visualize the route calculated by the NPC. See <span class="emphasis"><em>Figure 7.31</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_31.jpg" /><div class="caption"><p>Figure 7.31: Testing NPC Navigation</p></div></div></div></div>