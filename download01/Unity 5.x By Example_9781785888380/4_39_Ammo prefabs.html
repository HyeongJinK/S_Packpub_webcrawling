<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec42"></a>Ammo prefabs</h2></div></div><hr /></div><p>When the player presses <a id="id241" class="indexterm"></a>the fire button, the spaceship should shoot ammo objects in the scene. These objects will be based on an <code class="literal">Ammo</code> <a id="id242" class="indexterm"></a>prefab. Let's create this prefab now. To start, we'll configure the texture to be used as an ammo graphic. Open the <code class="literal">Textures</code> folder in the <span class="strong"><strong>Project</strong></span> panel, and select the <code class="literal">Ammo</code> texture. This texture features several different versions of an ammo sprite, aligned in a row side by side. See <span class="emphasis"><em>Figure 4.3</em></span>. When ammo is fired, we don't want to show the complete texture; instead, we want to show either just one of the images or the images played as an animation sequence, frame by frame.</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_03.jpg" /><div class="caption"><p>Figure 4.3: Preparing to create an Ammo prefab</p></div></div><p>Presently, Unity recognizes the texture (and each ammo element) as a complete unit. We can use Sprite Editor, however, to separate each part. To do this, select the <span class="strong"><strong>Texture</strong></span> in the project (if it's not already <a id="id243" class="indexterm"></a>selected), and then (from the <span class="strong"><strong>Object Inspector</strong></span>) change <a id="id244" class="indexterm"></a>the <span class="strong"><strong>Sprite Mode</strong></span> drop-down from <span class="strong"><strong>Single</strong></span> to <span class="strong"><strong>Multiple</strong></span>. This signifies that more than one sprite is contained within the texture space. See <span class="emphasis"><em>Figure 4.4</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_04.jpg" /><div class="caption"><p>Figure 4.4: Select multiple sprites for textures featuring more than one sprite</p></div></div><p>Click on the <span class="strong"><strong>Apply</strong></span> button, and then click on the <span class="strong"><strong>Sprite Editor</strong></span> button from the <span class="strong"><strong>Object Inspector</strong></span>. This opens the Sprite Editor, allowing you to separate each sprite. To do this, click and drag your mouse to select each sprite, making sure that the <span class="strong"><strong>Pivot</strong></span> is aligned to the object <a id="id245" class="indexterm"></a>
<span class="strong"><strong>Center</strong></span>. See <span class="emphasis"><em>Figure 4.5</em></span>. Then, click on <span class="strong"><strong>Apply</strong></span> to accept the changes.</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_05.jpg" /><div class="caption"><p>Figure 4.5: Separating multiple sprites in the Sprite Editor</p></div></div><p>After accepting the changes in the Sprite Editor, Unity automatically cuts the relevant sprites into separate units, each of which can now be selected as a separate object in the <span class="strong"><strong>Project</strong></span> panel. Click on the right arrow at the side of the texture, and all sprites within will expand outwards. See <span class="emphasis"><em>Figure 4.6</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_06.jpg" /><div class="caption"><p>Figure 4.6: Expand all sprites within a texture</p></div></div><p>Now, drag and drop one of the sprites from the <span class="strong"><strong>Project</strong></span> panel to the <span class="strong"><strong>Scene</strong></span> via the <span class="strong"><strong>Hierarchy</strong></span> panel. On doing this, it will be added as a sprite object. This represents the beginning of our <code class="literal">Ammo</code> prefab. The sprite itself may not initially be oriented to face upward at the game <a id="id246" class="indexterm"></a>camera. If so, rotate the sprite by <span class="strong"><strong>90</strong></span> degrees until it looks correct. See <span class="emphasis"><em>Figure 4.7</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_07.jpg" /><div class="caption"><p>Figure 4.7: Aligning the ammo sprite</p></div></div><p>Now create a new, empty game object in the scene (<span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span> from the application menu) and rename it <code class="literal">Ammo</code>. Make this new object a parent of <code class="literal">Ammo_Sprite</code> and ensure that its local forward vector is pointing in the direction that the ammo should travel. We'll soon reuse the <code class="literal">Mover</code> script (created in the previous chapter) on the ammo to make it move.</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_08.jpg" /><div class="caption"><p>Figure 4.8: Building an ammo object</p></div></div><p>Drag and drop the <code class="literal">Mover.cs</code> script from the <span class="strong"><strong>Project</strong></span> panel to the <code class="literal">Ammo</code> parent object via the <span class="strong"><strong>Hierarchy</strong></span> panel in order to add it as a component. Then, select the <code class="literal">Ammo</code> object and, from the <span class="strong"><strong>Object Inspector</strong></span>, change the ammo's <span class="strong"><strong>Max Speed</strong></span> in the <span class="strong"><strong>Mover</strong></span> component to <code class="literal">7</code>. Finally, add a <span class="strong"><strong>Box Collider</strong></span> to the object to approximate its volume (<span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Box Collider</strong></span> from the application menu), and then test this all in the viewport by pressing play on the <a id="id247" class="indexterm"></a>toolbar. The <code class="literal">Ammo</code> object should shoot forward as though fired from a weapon. If it moves up or down incorrectly, then make sure that the parent object is rotated so that its blue forward vector really is pointing forward. See <span class="emphasis"><em>Figure 4.9</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_09.jpg" /><div class="caption"><p>Figure 4.9: Moving forward with an Ammo prefab (Mover and Collider)</p></div></div><p>Next, add a <span class="strong"><strong>Rigidbody</strong></span> component to the ammo to make it part of the Unity physics system. To do this, select the <code class="literal">Ammo</code> object and navigate to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Rigidbody</strong></span> from the application menu. Then, from the <span class="strong"><strong>Rigidbody</strong></span> component in the <span class="strong"><strong>Inspector</strong></span>, disable the <span class="strong"><strong>Use Gravity</strong></span> checkbox to prevent the ammo from falling to the ground during gameplay. For our purposes, gravity need not apply to the ammo as it should simply travel along and eventually be destroyed. This highlights an important point in game <a id="id248" class="indexterm"></a>development generally: real-world physics need not apply to every object accurately. We only need enough physics to make objects appear correct to the player when they're looking. See <span class="emphasis"><em>Figure 4.10</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_10.jpg" /><div class="caption"><p>Figure 4.10: Removing gravity from the Ammo object</p></div></div><p>In addition to adding a <code class="literal">Mover</code> script and physics components, we also need the ammo to behave distinctly. Specifically, it should damage the objects with which it collides, and it should also destroy or disable itself on collision. To achieve this, a new script file must be created, <code class="literal">Ammo.cs</code>. The entire code for this is included in <span class="emphasis"><em>Code Sample 4.1</em></span> as follows:</p><div class="informalexample"><pre class="programlisting">//------------------------------
using UnityEngine;
using System.Collections;
//------------------------------
public class Ammo : MonoBehaviour
{
  public float Damage = 100f;
  public float LifeTime = 2f;
  //------------------------------
  void OnEnable()
  {
    CancelInvoke();
    Invoke("Die", LifeTime);
  }
  //------------------------------
  // Update is called once per frame
  void OnTriggerEnter(Collider Col)
  {
    //Get health component
      <span class="strong"><strong>Health H = Col.gameObject.GetComponent&lt;Health&gt;();</strong></span>

    if(H == null)return;

    H.HealthPoints -= Damage;
  }
  //------------------------------
  void Die()
  {
    gameObject.SetActive(false);
  }

  //------------------------------
}
//------------------------------</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec19"></a>Code Sample 4-1</h3></div></div></div><p>The following points summarize the code sample:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <code class="literal">Ammo</code> <a id="id249" class="indexterm"></a>class should be attached to the <code class="literal">Ammo</code> prefab object and will be instantiated for all ammo objects created. Its main purpose is to damage any objects with which it collides.</p></li><li style="list-style-type: disc"><p>The <code class="literal">OnTriggerEnter</code> function is invoked for the ammo when it enters a trigger attached to a movable unit, such as the player or enemies. Specifically, it retrieves the <code class="literal">Health</code> component attached to the object, if it has one, and reduces its health by the <code class="literal">Damage</code> amount. The <code class="literal">Health</code> component was created in the previous chapter.</p></li><li style="list-style-type: disc"><p>Notice that each ammo object will have a Lifetime. This represents the amount of time in seconds for which the ammo should remain alive and active after it is fired and generated in the scene. After the lifetime expires, the ammo should either be destroyed entirely or deactivated (more on this shortly).</p></li><li style="list-style-type: disc"><p>The <code class="literal">Invoke</code> function is used to deactivate the ammo object after the <code class="literal">LifeTime</code> interval. This happens during the <code class="literal">OnEnable</code> event. This is called automatically by Unity each time an object is activated (that is, changed from being disabled to enabled).</p></li></ul></div><p>Now, drag and drop the <code class="literal">Ammo</code> script file from the <code class="literal">Scripts</code> folder in the <span class="strong"><strong>Project</strong></span> panel to the <code class="literal">Ammo</code> object, and then finally, drag and drop the whole <code class="literal">Ammo</code> object in the <span class="strong"><strong>Scene</strong></span> back to the <span class="strong"><strong>Project</strong></span> panel in <a id="id250" class="indexterm"></a>the <code class="literal">Prefabs</code> folder in order to create a new <code class="literal">Ammo</code> prefab. See <span class="emphasis"><em>Figure 4.11</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_04_11.jpg" /><div class="caption"><p>Figure 4.11: Creating an Ammo prefab</p></div></div><p>Congratulations! You've now created an <code class="literal">Ammo</code> prefab, which can be spawned from weapon points to attack enemies directly. This is good, but we've still not handled the spawning process itself and we'll address this next.</p></div></div>