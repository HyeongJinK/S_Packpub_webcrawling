<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec59"></a>Moving platforms</h2></div></div><hr /></div><p>Now let's refine the <a id="id349" class="indexterm"></a>adventure further by adding a moving <a id="id350" class="indexterm"></a>element to the existing scene; specifically, a moving platform object. This platform should move up and then down again on a loop, ping-ponging between extremes. The player will be able to jump onto the platform to hitch a ride, and the object will be constructed as a prefab, allowing it to be reused across scenes. See <span class="emphasis"><em>Figure 6.1</em></span> for the result:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_01.jpg" /><div class="caption"><p>Figure 6.1: Create a moving platform</p></div></div><p>To start, select the <a id="id351" class="indexterm"></a>platform texture in the <span class="strong"><strong>Project</strong></span> panel, <a id="id352" class="indexterm"></a>making sure that it's specified as a <span class="strong"><strong>Sprite</strong></span> (2D and UI) texture type in the <span class="strong"><strong>Object Inspector</strong></span>. The <span class="strong"><strong>Sprite Mode</strong></span> should be set to <span class="strong"><strong>Single</strong></span>. Drag and drop the platform texture to the scene and set its <span class="strong"><strong>Scale</strong></span> to (<code class="literal">0.7</code>, <code class="literal">0.5</code>, <code class="literal">1</code>). See <span class="emphasis"><em>Figure 6.2</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_02.jpg" /><div class="caption"><p>Figure 6.2: Building a moving platform</p></div></div><p>Next, the platform should be a solid object, the kind of thing with which the player can collide. Remember, the player should be able to stand on the platform. Consequently, a Collider must be added. In this case, a Box Collider 2D is appropriate. To add this, select the platform object <a id="id353" class="indexterm"></a>in the scene and navigate to <a id="id354" class="indexterm"></a>
<span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span> from the menu. See <span class="emphasis"><em>Figure 6.3</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_03.jpg" /><div class="caption"><p>Figure 6.3: Adding a collider to the platform</p></div></div><p>After the collider has been added to the platform, you may need to adjust its properties from the <span class="strong"><strong>Object Inspector</strong></span>; specifically, its <span class="strong"><strong>Offset</strong></span> and <span class="strong"><strong>Size</strong></span> fields to make the collider match the size of the platform sprite closely. Then, finally, test the platform by entering the play mode and standing the player character on the platform. By doing so, the player should not fall through the platform! See <span class="emphasis"><em>Figure 6.4</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/figure_06_04.jpg" /><div class="caption"><p>Figure 6.4: Testing platform collisions</p></div></div><p>The platform so far is static and motionless, and it should move up and down repeatedly. To fix this, we could create a predefined animation sequence using the <span class="strong"><strong>Animation Editor</strong></span> via the <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span> menu option. However, instead, we'll use a script file. Frequently, when making animations, you'll often need to reach decisions about which option is best: <span class="emphasis"><em>C# animations</em></span> or <span class="emphasis"><em>Baked animations</em></span>. Typically, script should be chosen when an animation should be simple and must apply to many objects and vary for each. The following <a id="id355" class="indexterm"></a>script file <code class="literal">PingPongMotion.cs</code> <a id="id356" class="indexterm"></a>should be created and attached to the platform. See <span class="emphasis"><em>Code Sample 6.1</em></span>, and code comments follow:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
//--------------------------------
public class PingPongMotion : MonoBehaviour 
{
  //--------------------------------
  //This transformation
  private Transform ThisTransform = null;

  //Original position
  private Vector3 OrigPos = Vector3.zero;

  //Axes to move on
  public Vector3 MoveAxes = Vector2.zero;

  //Speed
  public float Distance = 3f;
  //--------------------------------
  // Use this for initialization
  void Awake ()
  {
    //Get transform component
    ThisTransform = GetComponent&lt;Transform&gt;();

    //Copy original position
    OrigPos = ThisTransform.position;
  }
  //--------------------------------
  // Update is called once per frame
  void Update () 
  {
    //Update platform position with ping pong
    ThisTransform.position = OrigPos + MoveAxes * Mathf.PingPong(Time.time, Distance);
  }
  //--------------------------------
}
//--------------------------------</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec24"></a>Code Sample 6.1</h3></div></div></div><p>The following points summarize the code sample:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <a id="id357" class="indexterm"></a>
<code class="literal">PingPongMotion</code> class is responsible for moving a <code class="literal">GameObject</code> back and forth from an original starting point.</p></li><li style="list-style-type: disc"><p>The <code class="literal">Awake</code> function uses the <code class="literal">OrigPos</code> variable to record the starting position of the <code class="literal">GameObject</code>.</p></li><li style="list-style-type: disc"><p>The <code class="literal">Update</code> function relies on the <code class="literal">Mathf.PingPong</code> function to transition a value smoothly between a minimum and maximum. This function fluctuates a value between minimum and maximum repeatedly and continuously over time, allowing you move objects linearly. For more information, see the Unity online documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Mathf.PingPong.html" target="_blank">http://docs.unity3d.com/ScriptReference/Mathf.PingPong.html</a>.
</p></li></ul></div><p>The completed code should be attached to the platform object in the scene and can be reused easily for any other object that should move up and down regularly (or left and right).</p></div></div>