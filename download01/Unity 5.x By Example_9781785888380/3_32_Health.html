<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec36"></a>Health</h2></div></div><hr /></div><p>Both the player <a id="id204" class="indexterm"></a>spaceship and enemies need health. Health is a measure of a character's presence and legitimacy in the scene, typically scored as a value between 0-100. 0 means death and 100 means full health. Now, although health is, in many respects, specific to each instance, (The player has a unique health bar and each enemy has theirs.) there are nevertheless so many things in common, in terms of behavior, between player and enemy health that it makes sense to code health as a separate component and class that can be attached to all objects that need health. Consider <span class="emphasis"><em>Code Sample 3.3</em></span>, which should be attached to the player and all enemies or objects that need health. Comments follow:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
//------------------------------
public class Health : MonoBehaviour
{
  public GameObject DeathParticlesPrefab = null;
  private Transform ThisTransform = null;
  public bool ShouldDestroyOnDeath = true;
  //------------------------------
  void Start()
  {
    ThisTransform = GetComponent&lt;Transform&gt;();
  }
  //------------------------------
  <span class="strong"><strong>public float HealthPoints</strong></span>
  {
    get
    {
      return _HealthPoints;
    }

    set
    {
      _HealthPoints = value;

      <span class="strong"><strong>if(_HealthPoints &lt;= 0)</strong></span>
      {
        <span class="strong"><strong>SendMessage</strong></span>("Die", SendMessageOptions.DontRequireReceiver);

        if(DeathParticlesPrefab != null)
          Instantiate(DeathParticlesPrefab, ThisTransform.position, ThisTransform.rotation);

        if(ShouldDestroyOnDeath)
          Destroy(gameObject);
      }
    }
  }
  //------------------------------
  <span class="strong"><strong>[SerializeField]</strong></span>
  private float _HealthPoints = 100f;
}
//------------------------------</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec13"></a>Code Sample 3.3</h3></div></div></div><p>The following points summarize the code sample:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <a id="id205" class="indexterm"></a>
<code class="literal">Health</code> class maintains object health through a <code class="literal">private</code> variable, <code class="literal">_HealthPoints</code>, which is accessed through a C# property, <code class="literal">HealthPoints</code>. This property features both <code class="literal">get</code> and <code class="literal">set</code> accessors to return and set the <code class="literal">Health</code> variable.</p></li><li style="list-style-type: disc"><p>The <code class="literal">_HealthPoints</code> variable is declared as <code class="literal">SerializedField</code>, allowing its value to be visible in the <span class="strong"><strong>Inspector</strong></span>. This helps us see the value of the player's health during runtime and debug and test the effects of our code.</p></li><li style="list-style-type: disc"><p>The <code class="literal">Health</code> class is an example of event-driven programming. This is because the class could have continually checked the status of object health during an <code class="literal">Update</code> function; checking to see whether the object had died by its health falling below <span class="emphasis"><em>0</em></span>. Instead, the check for death is made during the C# property <code class="literal">set</code> method. This makes sense because <code class="literal">set</code> is the only place where health will ever change. This means that Unity is saved from a lot of work in each frame. That's great performance saving!</p></li><li style="list-style-type: disc"><p>
<code class="literal">Health</code> class uses the <code class="literal">SendMessage</code> function. This function lets you call any other public function on any component attached to the object by specifying the function name as a string. In this case, a function called <code class="literal">Die</code> will be executed on every component attached to the object (if such a function exists). If no function of a matching name exists, then nothing happens for that component. This is a quick and easy way to run customized behavior on an object in a type-agnostic way without using any polymorphism. The disadvantage is that <code class="literal">SendMessage</code> internally uses a process called <code class="literal">Reflection</code>, which is slow and performance-prohibitive. For this reason, <code class="literal">SendMessage</code> should be used infrequently only for death events and similar events, but not frequently, such as every frame. More information on <code class="literal">SendMessage</code> can <a id="id206" class="indexterm"></a>be found at the online Unity documentation at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/GameObject.SendMessage.html" target="_blank">http://docs.unity3d.com/ScriptReference/GameObject.SendMessage.html</a>.</p></li><li style="list-style-type: disc"><p>When health falls below <span class="emphasis"><em>0</em></span>, triggering a death condition, the code will instantiate a death particle system to show an effect on death if a particle system is specified (more on this shortly).</p></li></ul></div><p>When the <a id="id207" class="indexterm"></a>
<code class="literal">Health</code> script is attached to the player spaceship, it appears as a component in the <span class="strong"><strong>Inspector</strong></span>. It contains a field for a <span class="strong"><strong>Death Particles Prefab</strong></span>. This is an optional field (it can be null), specifying a particle system to be spawned when the object dies. This lets you create explosions or blood splatter effects easily when objects die. See <span class="emphasis"><em>Figure 3.26</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_03_26.png.jpg" /><div class="caption"><p>Figure 3.26: Attaching the Health script</p></div></div></div></div>