<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec70"></a>Navigation and navigation meshes</h2></div></div><hr /></div><p>The <a id="id432" class="indexterm"></a>world terrain is now fully created. In reaching this stage, we must now start thinking about the main aims of our project. Specifically, the level should be an AI experiment: we want to create enemy NPC characters that can wander freely around the terrain and will chase and attack the player whenever the player enters their field of view. To achieve this, the level must be properly configured for path-finding, which is considered here.</p><p>On thinking about NPC AI and NPC movement around the level, it's clear that the terrain is bumpy and features many hills, mountains, dips, and inclines. For an NPC character to navigate this terrain successfully, many complexities are involved. For example, an NPC cannot simply travel in only straight lines from point A to point B because doing so would cause the NPC to pass through solid objects and terrain. The NPC needs to maneuver intelligently around, under, and over appropriate parts of the terrain, just as human intelligence would. This is important to create believable characters. The computational processes involved in calculating appropriate paths for NPCs is called <span class="strong"><strong>Path-Finding</strong></span>, and <a id="id433" class="indexterm"></a>the processes to make a character travel those paths is termed <span class="strong"><strong>Navigation</strong></span>. Unity <a id="id434" class="indexterm"></a>comes with path-finding and navigation features built-in, making it easy for NPCs to calculate and travel paths.</p><p>To prepare for this, a Navigation Mesh must be generated. This is a special mesh asset included in the scene, which uses non-rendered geometry to approximate the total walkable surface of a scene. This is used by the path-finding and navigation processes to move a character around. To get started with generating a navigation mesh, select <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Navigation</strong></span> from the application menu. See <span class="emphasis"><em>Figure 7.18</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_18.jpg" /><div class="caption"><p>Figure 7.18: Accessing the Navigation window</p></div></div><p>The <a id="id435" class="indexterm"></a>purpose of the <span class="strong"><strong>Navigation</strong></span> window is to generate a low-fidelity terrain mesh that actually approximates the level floor. For this process to work effectively, all non-movable floor meshes in the scene must be marked as <span class="strong"><strong>Navigation Static</strong></span>. To do this, select the terrain in the <span class="strong"><strong>Hierarchy</strong></span> panel and, from the <span class="strong"><strong>Inspector</strong></span>, click on the <span class="strong"><strong>Static</strong></span> drop-down and enable the <span class="strong"><strong>Navigation Static</strong></span> option. See <span class="emphasis"><em>Figure 7.19</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_19.jpg" /><div class="caption"><p>Figure 7.19: Marking non-movable floor objects as Static</p></div></div><p>Now access the <span class="strong"><strong>Navigation</strong></span> window (which I typically dock into the <span class="strong"><strong>Inspector</strong></span>). From here, click on the <span class="strong"><strong>Bake</strong></span> tab to access the main <span class="strong"><strong>Navigation</strong></span> settings. From this panel, you can control <a id="id436" class="indexterm"></a>a range of settings to influence Navigation Mesh (NavMesh) generation. See <span class="emphasis"><em>Figure 7.20</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_20.jpg" /><div class="caption"><p>Figure 7.20: The Bake contains the main settings for Navigation Mesh generation</p></div></div><p>To get started, let's just generate an initial Navigation Mesh to see how the default settings look. We can easily erase and regenerate the mesh under new settings if needed. To do this, click on the <span class="strong"><strong>Bake</strong></span> button from the <span class="strong"><strong>Inspector</strong></span>. When you do this, a default Navigation Mesh is generated and appears in blue above the terrain from the <span class="strong"><strong>Scene</strong></span> viewport. See <span class="emphasis"><em>Figure 7.21</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_21.jpg" /><div class="caption"><p>Figure 7.21: A default Navigation Mesh</p></div></div><p>The default navigation mesh is problematic. It should represent the entire walkable regions of the level. It is, essentially, the area to which NPCs will be restricted when they move around. You'll see from the navigation mesh in the preceding image that it's fractured and broken in many placesâ€”some areas are totally isolated and disconnected from others. This is often undesirable because it means that any NPC walking within one isolated region cannot access or move to another as there is no connection between the two areas and the NPC can only move on the navigation mesh. To fix this properly, two settings must be adjusted. First, adjust the <span class="strong"><strong>Agent Radius</strong></span> setting. This controls how large an average agent (NPC) is, and it affects how close the Navigation Mesh can expand toward the surrounding mesh floor and its edges. Lower (smaller) settings allow the mesh to encroach <a id="id437" class="indexterm"></a>nearer to the mesh edges, resulting in an expanded navigation mesh. Try reducing <span class="strong"><strong>Agent Radius</strong></span> and then clicking on <span class="strong"><strong>Bake</strong></span> again to observe the result. See <span class="emphasis"><em>Figure 7.22</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_22.jpg" /><div class="caption"><p>Figure 7.22: Refining the mesh via Agent Radius</p></div></div><p>This improves the meshes but we still have broken or fractured areas. This is also because of the <span class="strong"><strong>Max Slope</strong></span> setting, which controls how steep a surface should be (such as the incline of a mountain) before it becomes unwalkable for an NPC. Increase this setting to expand the navigation mesh further, and click on <span class="strong"><strong>Bake</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_23.jpg" /><div class="caption"><p>Figure 7.23: Increasing Max Slope to expand the navigation mesh over the terrain</p></div></div><p>Congratulations. You have now constructed a Navigation Mesh for the level. The NavMesh asset itself is stored in a folder matching the scene name. When selected in the <span class="strong"><strong>Project</strong></span> <a id="id438" class="indexterm"></a>panel, you can preview various read-only properties describing the Navigation Mesh, such as <span class="strong"><strong>Height</strong></span> and <span class="strong"><strong>Walkable Radius</strong></span> settings. See <span class="emphasis"><em>Figure 7.24</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785888380/graphics/B05118_07_24.jpg" /><div class="caption"><p>Figure 7.24: Previewing Navigation Mesh properties from the Project panel</p></div></div></div>