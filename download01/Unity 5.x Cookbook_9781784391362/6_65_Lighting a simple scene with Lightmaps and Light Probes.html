<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec67"></a>Lighting a simple scene with Lightmaps and Light Probes</h2></div></div><hr /></div><p>Lightmaps are a <a id="id628" class="indexterm"></a>great alternative to real-time lighting, as they can provide the desired look to an environment without being processor-intensive. There is one <a id="id629" class="indexterm"></a>downside, thoughâ€”since there is no way of baking Lightmaps onto the dynamic objects, the lighting of the<a id="id630" class="indexterm"></a> important elements of the game (such as player characters themselves) can look artificial, failing to match the intensity of the surrounding area. The solution? <span class="strong"><strong>Light Probes</strong></span>.</p><p>
<span class="strong"><strong>Light Probes</strong></span> work by<a id="id631" class="indexterm"></a> sampling the light intensity over the location that they are placed at. Dynamic objects, once <span class="strong"><strong>Light Probe</strong></span>-enabled, will be lit according to the interpolation of the nearest probes around them.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_48.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec189"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared a basic scene, including a simple game environment and an instance of Unity's Rollerball sample asset, which will be used as the player character. The geometry for the scene was<a id="id632" class="indexterm"></a> created using <span class="strong"><strong>ProBuilder 2.0</strong></span>, an extension developed by ProCore, and was sold at Unity's Asset Store and at ProCore's website (<a class="ulink" href="http://www.protoolsforunity3d.com" target="_blank">http://www.protoolsforunity3d.com</a>). ProBuilder is a fantastic level <a id="id633" class="indexterm"></a>design tool that speeds up the design process considerably for both simple and complex level design.</p><p>The <code class="literal">LightProbes.unitypackage</code> package, containing the scene and all necessary files, can be found inside the <code class="literal">1362_06_06</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec190"></a>How to do it...</h3></div></div></div><p>To reflect the surrounding<a id="id634" class="indexterm"></a> objects using the <span class="strong"><strong>Reflection </strong></span><a id="id635" class="indexterm"></a><span class="strong"><strong>Probes</strong></span>, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import <code class="literal">LightProbes.unitypackage</code> to a new project. Then, open the scene named <span class="strong"><strong>LightProbes</strong></span>. The scene features a basic environment and a playable Rollerball game sequence.</p></li><li><p>First, let's set up<a id="id636" class="indexterm"></a> the light from our scene. From the <span class="strong"><strong>Hierarchy</strong></span> view, select the <span class="strong"><strong>Directional Light</strong></span>. Then, from<a id="id637" class="indexterm"></a> the <span class="strong"><strong>Inspector</strong></span> view, set <span class="strong"><strong>Baking</strong></span> as <span class="strong"><strong>Baked</strong></span>. Also, at the top of the <span class="strong"><strong>Inspector</strong></span>, to the right of the object's name, check the <span class="strong"><strong>Static</strong></span> box, shown as follows:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_28.jpg" /></div></li><li><p>Now, let's set up the <span class="strong"><strong>Global Illumination</strong></span> for the scene. Open the <span class="strong"><strong>Lighting</strong></span> window (via the menu <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Lighting</strong></span>) and select the <span class="strong"><strong>Scene</strong></span> section. Then, from the <span class="strong"><strong>Environment Lighting</strong></span> subsection, set <code class="literal">SkyboxProbes</code> (available from the <span class="strong"><strong>Assets</strong></span>) as <span class="strong"><strong>Skybox</strong></span>, and the scene's <span class="strong"><strong>Directional Light</strong></span> as <span class="strong"><strong>Sun</strong></span>. Finally, change the <span class="strong"><strong>Ambient GI </strong></span>option from <span class="strong"><strong>Realtime</strong></span> to <span class="strong"><strong>Baked</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_29.jpg" /></div></li><li><p>
<span class="strong"><strong>Lightmaps</strong></span> can be <a id="id638" class="indexterm"></a>applied onto static objects only. From the <span class="strong"><strong>Hierarchy</strong></span> view, expand<a id="id639" class="indexterm"></a> the <span class="strong"><strong>Level</strong></span> game object to reveal the list of the children objects. Then, select every<a id="id640" class="indexterm"></a> child and set them as <span class="strong"><strong>Static</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_30.jpg" /></div></li><li><p>Imported 3D <a id="id641" class="indexterm"></a>meshes must feature <span class="strong"><strong>Lightmap UV Coordinates</strong></span>. From the <span class="strong"><strong>Project</strong></span> view, find and select the <code class="literal">lamp</code> mesh. Then, from the <span class="strong"><strong>Inspector</strong></span> view, within the <span class="strong"><strong>Model</strong></span> section of the <span class="strong"><strong>Import Settings</strong></span>, check the <span class="strong"><strong>Generate Lightmap UVs</strong></span> option, and click on the <span class="strong"><strong>Apply</strong></span> button to confirm changes, shown as follows:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_31.jpg" /></div></li><li><p>Scroll down<a id="id642" class="indexterm"></a> the <span class="strong"><strong>Import Settings</strong></span> view and expand the lamp's <span class="strong"><strong>Material</strong></span> component. Then, populate the <span class="strong"><strong>Emission</strong></span><a id="id643" class="indexterm"></a> field with the texture named <code class="literal">lamp_EMI</code>, available<a id="id644" class="indexterm"></a> from the <span class="strong"><strong>Assets</strong></span> folder. Finally, change <span class="strong"><strong>the Global Illumination</strong></span> option<a id="id645" class="indexterm"></a> to <span class="strong"><strong>Baked</strong></span>. This will make the lamp object emit a green light that will be baked into the <span class="strong"><strong>Lightmap</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_32.jpg" /></div></li><li><p>Open the <span class="strong"><strong>Lighting</strong></span> window. By default, the <span class="strong"><strong>Continuous Baking</strong></span> option will be checked. Uncheck it, as shown, so that we can bake the <span class="strong"><strong>Lightmaps</strong></span> on demand.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_33.jpg" /></div></li><li><p>Click on the<a id="id646" class="indexterm"></a> <span class="strong"><strong>Build</strong></span> button and wait for the Lightmaps to be generated.</p></li><li><p>From the<a id="id647" class="indexterm"></a> <span class="strong"><strong>Hierarchy</strong></span> view, select the <span class="strong"><strong>RollerBall</strong></span>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Mesh Renderer</strong></span> component and <a id="id648" class="indexterm"></a>check the<a id="id649" class="indexterm"></a> <span class="strong"><strong>Use Light Probes</strong></span> option, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_34.jpg" /></div></li><li><p>Now, we need to create the <span class="strong"><strong>Light Probes</strong></span> for the scene. From the <span class="strong"><strong>Hierarchy</strong></span> view, click on the <span class="strong"><strong>Create</strong></span> drop-down menu and add a <span class="strong"><strong>Light Probe Group</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Light Probe Group</strong></span>).</p></li><li><p>To facilitate the manipulation of the probes, type <code class="literal">Probe</code> into the search field of the <span class="strong"><strong>Hierarchy</strong></span> view. This will isolate the newly created <span class="strong"><strong>Light Probe Group</strong></span>, making it<a id="id650" class="indexterm"></a> the only editable object on the scene.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_35.jpg" /></div></li><li><p>Change your <a id="id651" class="indexterm"></a>viewport layout to <span class="strong"><strong>4 Split</strong></span> by<a id="id652" class="indexterm"></a> navigating to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Layouts</strong></span> | <span class="strong"><strong>4 Split</strong></span>. Then, set viewports as <span class="strong"><strong>Top</strong></span>, <span class="strong"><strong>Front</strong></span>, <span class="strong"><strong>Right</strong></span>, and <span class="strong"><strong>Persp</strong></span>. Optionally, change <span class="strong"><strong>Top</strong></span>, <span class="strong"><strong>Front</strong></span> and <span class="strong"><strong>Right</strong></span> views to the <span class="strong"><strong>Wireframe</strong></span> mode. Finally, make sure that they are set to orthographic view, as<a id="id653" class="indexterm"></a> shown in the following screenshot. This will make it easier for you to position the <span class="strong"><strong>Light Probes</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_36.jpg" /></div></li><li><p>Position<a id="id654" class="indexterm"></a> the initial <span class="strong"><strong>Light Probes</strong></span> at the corners<a id="id655" class="indexterm"></a> of the top room of<a id="id656" class="indexterm"></a> the level. To move<a id="id657" class="indexterm"></a> the Probes around, simply click and drag them, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_37.jpg" /></div></li><li><p>Select the four <a id="id658" class="indexterm"></a>probes to the left side <a id="id659" class="indexterm"></a>of the tunnel's entrance. Then, duplicate them by clicking on the appropriate button <a id="id660" class="indexterm"></a>on the <span class="strong"><strong>Inspector</strong></span> view or, alternatively, use the <span class="emphasis"><em>Ctrl</em></span>/<span class="emphasis"><em>Cmd</em></span> + <span class="emphasis"><em>D</em></span> keys. Finally, drag the new <a id="id661" class="indexterm"></a>probes slightly to the right, to a point that they are no longer over the shadow that is projected by the wall, shown as follows:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_38.jpg" /></div></li><li><p>Repeat the<a id="id662" class="indexterm"></a> last step, this time duplicating the probes<a id="id663" class="indexterm"></a> next to the tunnel's entrance<a id="id664" class="indexterm"></a> and bringing them inward towards the group. To delete the <a id="id665" class="indexterm"></a>selected probes, either use the respective button on the <span class="strong"><strong>Light Probe Group</strong></span> component, or use the <span class="emphasis"><em>Ctrl</em></span>/<span class="emphasis"><em>Cmd</em></span> + <span class="emphasis"><em>Backspace</em></span> keys.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_39.jpg" /></div></li><li><p>Duplicate and<a id="id666" class="indexterm"></a> reposition the four probes that are nearest to the tunnel, repeating the<a id="id667" class="indexterm"></a> operation five times and conforming each duplicate set to the shadow, projected<a id="id668" class="indexterm"></a> by the tunnel.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_40.jpg" /></div></li><li><p>Use the <span class="strong"><strong>Add </strong></span><a id="id669" class="indexterm"></a><span class="strong"><strong>Probe</strong></span> button to place the three probes over well-lit areas of the scene.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_41.jpg" /></div></li><li><p>Now, add<a id="id670" class="indexterm"></a> <span class="strong"><strong>Light Probes</strong></span> within<a id="id671" class="indexterm"></a> the shadow that is projected<a id="id672" class="indexterm"></a> by the<a id="id673" class="indexterm"></a> L-shaped wall.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_42.jpg" /></div></li><li><p>Since the Rollerball is able to jump, place the higher probes even higher, so that they will <a id="id674" class="indexterm"></a>sample the lighting above the shadowed areas of the scene.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_45.jpg" /></div></li><li><p>Placing too many <span class="strong"><strong>Light Probes</strong></span> on a scene might be memory intensive. Try optimizing the <span class="strong"><strong>Light Probes Group</strong></span> by removing the probes from the regions that the<a id="id675" class="indexterm"></a> player won't have access to. Also, avoid overcrowding the regions of continuous lighting conditions by removing the probes that are too close to others in the same lighting condition.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_46.jpg" /></div></li><li><p>To check<a id="id676" class="indexterm"></a> out which Light Probes<a id="id677" class="indexterm"></a> are influencing the <span class="strong"><strong>Rollerball</strong></span> at any place, move the <span class="strong"><strong>Rollerball</strong></span> GameObject <a id="id678" class="indexterm"></a>around the scene. A polyhedron will indicate which probes are being interpolated <a id="id679" class="indexterm"></a>at that position, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_47.jpg" /></div></li><li><p>From the <a id="id680" class="indexterm"></a>bottom of the <span class="strong"><strong>Lighting</strong></span> window, click on the <span class="strong"><strong>Build</strong></span> button and wait for the Lightmaps<a id="id681" class="indexterm"></a> to be baked.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_43.jpg" /></div></li><li><p>Test the <a id="id682" class="indexterm"></a>scene. The Rollerball will be lit <a id="id683" class="indexterm"></a>according to the Light Probes.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_44.jpg" /></div></li><li><p>Keep adding probes until the level is completely covered.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec191"></a>How it works...</h3></div></div></div><p>
<span class="strong"><strong>Lighmaps</strong></span> are basically texture maps including scene lights/shadows, global illumination, indirect illumination, and objects featuring the <span class="strong"><strong>Emissive</strong></span> materials. They can be generated automatically or on demand by Unity's lighting engine. However, there are some points<a id="id684" class="indexterm"></a> that you should pay attention to, such as:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Set all the<a id="id685" class="indexterm"></a> non-moving objects and lights to be baked as <span class="strong"><strong>Static</strong></span>
</p></li><li style="list-style-type: disc"><p>Set the game lights as <span class="strong"><strong>Baked</strong></span>
</p></li><li style="list-style-type: disc"><p>Set the<a id="id686" class="indexterm"></a> scene's <span class="strong"><strong>Ambient GI</strong></span> as <span class="strong"><strong>Baked</strong></span>
</p></li><li style="list-style-type: disc"><p>Set the <span class="strong"><strong>Global Illumination</strong></span> option of the emissive materials as <span class="strong"><strong>Baked</strong></span>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Generate Light UV</strong></span>s for all 3D meshes (specially the imported ones)</p></li><li style="list-style-type: disc"><p>Either <span class="strong"><strong>Build</strong></span> the Lightmaps manually from the <span class="strong"><strong>Lighting</strong></span> window, or set the <span class="strong"><strong>Continuous Baking</strong></span> option checked</p></li></ul></div><p>
<span class="strong"><strong>Light Probes</strong></span> work by sampling the scene's illumination at the point that they're placed at. A dynamic object that has <span class="strong"><strong>Use Light Probes</strong></span> enabled has its lighting determined by the interpolation between the lighting values of the four Light Probes defining a volume around it (or, in case there are no probes suited to define a volume around the dynamic object, a triangulation between the nearest probes is used).</p><p>It is important to<a id="id687" class="indexterm"></a> notice that even if you are working on a level that is flat, you shouldn't place all your probes on the same level, as <span class="strong"><strong>Light Probe Groups</strong></span> will form a volume in order to the interpolation to be calculated correctly. This and more<a id="id688" class="indexterm"></a> information on the subject can be found in the Unity's documentation at <a class="ulink" href="http://docs.unity3d.com/Manual/LightProbes.html" target="_blank">http://docs.unity3d.com/Manual/LightProbes.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec192"></a>There's more...</h3></div></div></div><p>In case you can spare some processing power, you can exchange the use of Light probes for a <span class="strong"><strong>Mixed</strong></span> light. Just delete the <span class="strong"><strong>Light Probe Group</strong></span> from your scene, select the <span class="strong"><strong>Directional Light</strong></span> and, from the <span class="strong"><strong>Light</strong></span> component, change <span class="strong"><strong>Baking</strong></span> to <span class="strong"><strong>Mixed</strong></span>. Then, set <span class="strong"><strong>Shadow Type</strong></span> as <span class="strong"><strong>Soft Shadows</strong></span> and <span class="strong"><strong>Strength</strong></span> as <code class="literal">0.5</code>, as shown in the following screen. Finally, click on the <span class="strong"><strong>Build</strong></span> button and wait for the Lightmaps to be baked. The real-time light/shadows will be cast into/from the dynamic objects, such as <span class="strong"><strong>Rollerball</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_49.jpg" /></div></div></div>