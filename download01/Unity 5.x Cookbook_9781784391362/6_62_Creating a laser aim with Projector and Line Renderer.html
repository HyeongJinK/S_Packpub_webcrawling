<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec64"></a>Creating a laser aim with Projector and Line Renderer</h2></div></div><hr /></div><p>Although using <a id="id547" class="indexterm"></a>GUI elements, such as a cross-hair, is a valid way to allow players to aim, replacing (or combining) it with a projected laser dot might be a <a id="id548" class="indexterm"></a>more interesting approach. In<a id="id549" class="indexterm"></a> this recipe, we will use the <span class="strong"><strong>Projector</strong></span><a id="id550" class="indexterm"></a> and <span class="strong"><strong>Line</strong></span> components to implement this concept.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec179"></a>Getting ready</h3></div></div></div><p>To help us with this recipe, it's been provided with a Unity package containing a sample scene featuring a character holding a laser pointer, and also a texture map named <code class="literal">LineTexture</code>. All files are inside the <code class="literal">1362_06_03</code> folder. Also, we'll make use of the <span class="strong"><strong>Effects</strong></span> assets package provided by Unity (which you should have installed when installing Unity).</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec180"></a>How to do it...</h3></div></div></div><p>To create a laser dot aim with a Projector, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import <code class="literal">BasicScene.unitypackage</code> to a new project. Then, open the scene named <span class="strong"><strong>BasicScene</strong></span>. This is a basic scene, featuring a player character whose aim is controlled via <a id="id551" class="indexterm"></a>mouse.</p></li><li><p>Import the <span class="strong"><strong>Effects</strong></span> package by navigating to the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Effects</strong></span> menu. If you want to import only the necessary files within the package, deselect <a id="id552" class="indexterm"></a>everything in the <span class="strong"><strong>Importing</strong></span><a id="id553" class="indexterm"></a><span class="strong"><strong> package</strong></span> window by clicking<a id="id554" class="indexterm"></a> on the <span class="strong"><strong>None</strong></span> button, and then check the <span class="strong"><strong>Projectors</strong></span> folder only. Then, click on <span class="strong"><strong>Import</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_10.jpg" /></div></li><li><p>From the <span class="strong"><strong>Inspector</strong></span> view, locate the <code class="literal">ProjectorLight</code> shader (inside the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Standard Assets</strong></span> | <span class="strong"><strong>Effects</strong></span> | <span class="strong"><strong>Projectors</strong></span> | <span class="strong"><strong>Shaders</strong></span> folder). Duplicate the file and name the new copy as <code class="literal">ProjectorLaser</code>.</p></li><li><p>Open <code class="literal">ProjectorLaser</code>. From the first line of the code, change <code class="literal">Shader "Projector/Light"</code> to <code class="literal">Shader "Projector/Laser"</code>. Then, locate the line of code – <code class="literal">Blend DstColor One</code> and change it to <code class="literal">Blend One One</code>. Save and close the file.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note35"></a>Note</h3><p>The reason for editing the shader for the laser was to make it stronger by changing its blend type to <span class="strong"><strong>Additive</strong></span>. Shader programming is a complex subject, which is beyond the scope of this book. However, if you want to learn more about it, check <a id="id555" class="indexterm"></a>out Unity's documentation on the subject, which is available at <a class="ulink" href="http://docs.unity3d.com/Manual/SL-Reference.html" target="_blank">http://docs.unity3d.com/Manual/SL-Reference.html</a>, and also the book called <span class="emphasis"><em>Unity Shaders and Effects Cookbook</em></span>, published by Packt.</p></div></li><li><p>Now that we <a id="id556" class="indexterm"></a>have fixed the shader, we need a material. From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to create a new <span class="strong"><strong>Material</strong></span>. Name it <code class="literal">LaserMaterial</code>. Then, select it from the <span class="strong"><strong>Project</strong></span> view and, from the <span class="strong"><strong>Inspector</strong></span> view, change<a id="id557" class="indexterm"></a> its <span class="strong"><strong>Shader</strong></span> to <span class="strong"><strong>Projector/Laser</strong></span>.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span><a id="id558" class="indexterm"></a> view, locate the <span class="strong"><strong>Falloff</strong></span> texture. Open it in your image editor and, except for the first and last columns column of pixels<a id="id559" class="indexterm"></a> that should be black, paint everything white. Save the file and go back to Unity.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_55.jpg" /></div></li><li><p>Change the <span class="strong"><strong>LaserMaterial</strong></span>'s <span class="strong"><strong>Main Color</strong></span> to red (RGB: <code class="literal">255</code>, <code class="literal">0</code>, <code class="literal">0</code>). Then, from the texture slots, select the <span class="strong"><strong>Light</strong></span> texture as <span class="strong"><strong>Cookie</strong></span> and the <span class="strong"><strong>Falloff</strong></span> texture as <span class="strong"><strong>Falloff</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_11.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, find <a id="id560" class="indexterm"></a>and select the <span class="strong"><strong>pointerPrefab</strong></span> object (<span class="strong"><strong>MsLaser</strong></span> | <span class="strong"><strong>mixamorig:Hips</strong></span> | <span class="strong"><strong>mixamorig:Spine</strong></span> | <span class="strong"><strong>mixamorig:Spine1</strong></span> | <span class="strong"><strong>mixamorig:Spine2</strong></span> | <span class="strong"><strong>mixamorig:RightShoulder</strong></span> | <span class="strong"><strong>mixamorig:RightArm</strong></span> | <span class="strong"><strong>mixamorig:RightForeArm</strong></span> | <span class="strong"><strong>mixamorig:RightHand</strong></span> | <span class="strong"><strong>pointerPrefab</strong></span>). Then, from the <a id="id561" class="indexterm"></a><span class="strong"><strong>Create</strong></span> drop-down menu, select <span class="strong"><strong>Create Empty Child</strong></span>. Rename the new child of <span class="strong"><strong>pointerPrefab</strong></span> as <span class="strong"><strong>LaserProjector</strong></span>.</p></li><li><p>Select the <span class="strong"><strong>LaserProjector</strong></span> object. Then, from the <span class="strong"><strong>Inspector</strong></span> view, click the <span class="strong"><strong>Add Component</strong></span><a id="id562" class="indexterm"></a> button and navigate to <span class="strong"><strong>Effects</strong></span> | <span class="strong"><strong>Projector</strong></span>. Then, from the <span class="strong"><strong>Projector</strong></span> component, set the <span class="strong"><strong>Orthographic</strong></span><a id="id563" class="indexterm"></a> option as true and set <span class="strong"><strong>Orthographic Size</strong></span> as <code class="literal">0.1</code>. Finally, select <span class="strong"><strong>LaserMaterial</strong></span> from the <span class="strong"><strong>Material</strong></span> slot.</p></li><li><p>Test the scene. You will be able to see the laser aim dot, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_12.jpg" /></div></li><li><p>Now, let's create a material for the <span class="strong"><strong>Line Renderer</strong></span> component that we are about to add. From<a id="id564" class="indexterm"></a> the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add a new <span class="strong"><strong>Material</strong></span>. Name<a id="id565" class="indexterm"></a> it as <span class="strong"><strong>Line_Mat</strong></span>.</p></li><li><p>From the <span class="strong"><strong>Inspector</strong></span> view, change<a id="id566" class="indexterm"></a> the shader of the <span class="strong"><strong>Line_Mat</strong></span> to <span class="strong"><strong>Particles/Additive</strong></span>. Then, set its <span class="strong"><strong>Tint Color</strong></span> to red (RGB: <code class="literal">255</code>;<code class="literal">0</code>;<code class="literal">0</code>).</p></li><li><p>Import the<a id="id567" class="indexterm"></a> <code class="literal">LineTexture</code> image file. Then, set it as the <span class="strong"><strong>Particle Texture</strong></span> for the <span class="strong"><strong>Line_Mat</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_13.jpg" /></div></li><li><p>Use the <span class="strong"><strong>Create</strong></span> drop-down menu from <span class="strong"><strong>Project</strong></span> view to add a C# script named <code class="literal">LaserAim</code>. Then, open it in your editor.</p></li><li><p>Replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
public class LaserAim : MonoBehaviour {

  public float lineWidth = 0.2f;
  public Color regularColor = new Color (0.15f, 0, 0, 1);
  public Color firingColor = new Color (0.31f, 0, 0, 1);
  public Material lineMat;
  private Vector3 lineEnd;
  private Projector proj;
  private LineRenderer line;

  void Start () {
    line = gameObject.AddComponent&lt;LineRenderer&gt;();
    line.material = lineMat;
    line.material.SetColor("_TintColor", regularColor);
    line.SetVertexCount(2);
    line.SetWidth(lineWidth, lineWidth);
    proj = GetComponent&lt;Projector&gt; ();
  }

  void Update () {
    RaycastHit hit;
    Vector3 fwd = transform.TransformDirection(Vector3.forward);

    if (Physics.Raycast (transform.position, fwd, out hit)) {
      lineEnd =  hit.point;
      float margin = 0.5f;
      proj.farClipPlane = hit.distance + margin;

    } else {
      lineEnd = transform.position + fwd * 10f;
    }
    line.SetPosition(0, transform.position);
    line.SetPosition(1, lineEnd);

    if(Input.GetButton("Fire1")){
      float lerpSpeed = Mathf.Sin (Time.time * 10f);
      lerpSpeed = Mathf.Abs(lerpSpeed);
      Color lerpColor = Color.Lerp(regularColor, firingColor, lerpSpeed);
      line.material.SetColor("_TintColor", lerpColor);

    }
    if(Input.GetButtonUp("Fire1")){
      line.material.SetColor("_TintColor", regularColor);
    }
  }
}</pre></div></li><li><p>Save your script <a id="id568" class="indexterm"></a>and attach it to the <span class="strong"><strong>LaserProjector </strong></span><a id="id569" class="indexterm"></a>game object.</p></li><li><p>Select the <span class="strong"><strong>LaserProjector</strong></span> GameObject. From the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Laser Aim</strong></span> <a id="id570" class="indexterm"></a>component and fill the <span class="strong"><strong>Line Material</strong></span><a id="id571" class="indexterm"></a> slot with the <code class="literal">Line_Mat</code> material, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_14.jpg" /></div></li><li><p>Play the scene. The laser aim is ready, and looks as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_15.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"></a>Note</h3><p>In this recipe, the width of the laser beam and its aim dot have been exaggerated. Should you need a more realistic thickness for your beam, change the <span class="strong"><strong>Line Width</strong></span> field of the <span class="strong"><strong>Laser Aim</strong></span> component to <code class="literal">0.05</code>, and the <span class="strong"><strong>Orthographic Size</strong></span> of the <span class="strong"><strong>Projector</strong></span> component to <code class="literal">0.025</code>. Also, remember to make the beam more opaque by setting the <span class="strong"><strong>Regular Color</strong></span> of the <span class="strong"><strong>Laser Aim</strong></span><a id="id572" class="indexterm"></a> component brighter.</p></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec181"></a>How it works...</h3></div></div></div><p>The laser aim effect was<a id="id573" class="indexterm"></a> achieved by combining two different effects: a <span class="strong"><strong>Projector</strong></span> and <span class="strong"><strong>Line Renderer</strong></span>.</p><p>A <span class="strong"><strong>Projector</strong></span>, which <a id="id574" class="indexterm"></a>can be used to simulate light, shadows, and more, is a component that projects a material (and its texture) onto other game objects. By attaching a projector to the <span class="strong"><strong>Laser Pointer</strong></span> object, we have ensured that it will face the right direction at all times. To get the right, vibrant look, we have edited the projector material's <span class="strong"><strong>Shader</strong></span>, making it brighter. Also, we have scripted a way to prevent projections from going through objects, by<a id="id575" class="indexterm"></a> setting its <span class="strong"><strong>Far Clip Plane</strong></span> on approximately the same level of the first object that is receiving the projection. The line of code that is responsible for this action is—<code class="literal">proj.farClipPlane = hit.distance + margin;</code>.</p><p>Regarding the <span class="strong"><strong>Line Renderer</strong></span>, we have opted to create it dynamically, via code, instead of manually adding the component to the game object. The code is also responsible for setting up its appearance, updating the line vertices position, and changing its color whenever the fire button is<a id="id576" class="indexterm"></a> pressed, giving it a glowing/pulsing look.</p><p>For more details on how<a id="id577" class="indexterm"></a> the script works, don't forget to<a id="id578" class="indexterm"></a> check out the commented code, available <a id="id579" class="indexterm"></a>within the <code class="literal">1362_06_03</code> | <code class="literal">End</code> folder.</p></div></div>