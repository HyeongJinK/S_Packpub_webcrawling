<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec91"></a>Preventing an Audio Clip from restarting if it is already playing</h2></div></div><hr /></div><p>In a game, there<a id="id960" class="indexterm"></a> may be several different events that cause a sound to start playing. If the sound is already playing, then in almost all cases, we won't wish to restart the sound. This recipe includes a test, so that an <span class="strong"><strong>Audio Source</strong></span> component is only sent a <code class="literal">Play()</code> message if it is currently not playing.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec263"></a>Getting ready</h3></div></div></div><p>Try this with any audio clip that is one second or longer in duration. We have included the <code class="literal">engineSound</code> audio clip inside the <code class="literal">1362_09_03</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec264"></a>How to do it...</h3></div></div></div><p>To prevent an <span class="strong"><strong>Audio Clip</strong></span> from restarting, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create an <span class="strong"><strong>Empty</strong></span> GameObject and rename it to <span class="strong"><strong>AudioObject</strong></span>. Then, add an <span class="strong"><strong>Audio Source</strong></span> component to this object (in the <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span> menu).</p></li><li><p>Import the<a id="id961" class="indexterm"></a> <code class="literal">engineSound</code> audio clip and drag it from the <span class="strong"><strong>Project</strong></span> view to populate the <span class="strong"><strong>Audio Clip</strong></span> parameter of the <span class="strong"><strong>Audio Source</strong></span> component of <span class="strong"><strong>AudioObject</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_10.jpg" /></div></li><li><p>Create a UI button named <span class="strong"><strong>PlaySoundButton</strong></span> on the screen and attach the following script to this button:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;
public class AvoidEarlySoundRestart : MonoBehaviour {
  public AudioSource audioSource;
  public Text message;

  void Update(){
    string statusMessage = "Play sound";
    if(audioSource.isPlaying)
      statusMessage = "(sound playing)";
    message.text = statusMessage;
  }

  // button click handler
  public void PlaySoundIfNotPlaying(){
    if( !audioSource.isPlaying)
      audioSource.Play();
  }
}</pre></div></li><li><p>With <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Audio Source</strong></span> variable, and drag the <span class="strong"><strong>Text</strong></span> child of <span class="strong"><strong>PlaySoundButton </strong></span>for the public <span class="strong"><strong>ButtonText</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_11.jpg" /></div></li><li><p>With <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, create a new on-click event handler, dragging the <span class="strong"><strong>PlaySoundButton</strong></span> into the <span class="strong"><strong>Object</strong></span> slot, and selecting the <span class="strong"><strong>PlaySoundIfNotPlaying()</strong></span> function.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec265"></a>How it works...</h3></div></div></div><p>The <span class="strong"><strong>Audio Source</strong></span> <a id="id962" class="indexterm"></a>components have a public readable property <span class="strong"><strong>isPlaying</strong></span>, which is a Boolean true/false flag, indicating if the sound is currently playing. The text of the button is set to display <code class="literal">Play Sound</code> when the sound is not playing, and (<code class="literal">sound playing</code>) when it is. When the button is clicked, the <code class="literal">PlaySoundIfNotPlaying()</code> method is called. This method uses an <code class="literal">if</code> statement, ensuring that a <code class="literal">Play()</code> message is only sent to the Audio Source component if its <span class="strong"><strong>isPlaying</strong></span> is false.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec266"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Waiting for the audio to finish before auto-destructing an object</em></span> recipe in this chapter.</p></li></ul></div></div></div>