<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec93"></a>Adding volume control with Audio Mixers</h2></div></div><hr /></div><p>Sound volume<a id="id967" class="indexterm"></a> adjustment can be a very important feature, especially<a id="id968" class="indexterm"></a> if your game is a standalone. After all, it can be very frustrating to access the operational system volume control. In this recipe, we will use the new <span class="strong"><strong>Audio Mixer</strong></span> feature to create independent volume controls for Music and Sound FX.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec271"></a>Getting ready</h3></div></div></div><p>For this recipe, we have provided a Unity package named <code class="literal">Volume.unitypackage</code>, containing an initial scene featuring soundtrack music and sound effects. The file is available inside the <code class="literal">1362_09_05</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec272"></a>How to do it...</h3></div></div></div><p>To add volume control sliders to your scene, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import <code class="literal">Volume.unitypackage</code> into your project.</p></li><li><p>Open the <span class="strong"><strong>Volume</strong></span> scene (available in the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Volume</strong></span> folder). Play the scene and walk towards the semitransparent green wall in the tunnel, using the <span class="emphasis"><em>W A S D</em></span> keys (while pressing the <span class="emphasis"><em>Shift</em></span> key to run). You will be able to listen to:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>A looping soundtrack music</p></li><li style="list-style-type: disc"><p>Bells ringing</p></li><li style="list-style-type: disc"><p>A robotic speech whenever the character collides with the wall</p></li></ul></div></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add <span class="strong"><strong>Audio Mixer</strong></span> to the project. Name it <span class="strong"><strong>MainMixer</strong></span>. Double-click on it to open the <span class="strong"><strong>Audio Mixer</strong></span> window.</p></li><li><p>From the <span class="strong"><strong>Groups</strong></span> view, highlight <span class="strong"><strong>Master</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a child to the <span class="strong"><strong>Master</strong></span> group. Name it <span class="strong"><strong>Music</strong></span>. Then, highlight <span class="strong"><strong>Master</strong></span> again and add a new child group named <span class="strong"><strong>FX</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_15.jpg" /></div></li><li><p>From the <span class="strong"><strong>Mixers</strong></span> view, highlight <span class="strong"><strong>MainMixer</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a new <span class="strong"><strong>Mixer</strong></span> to the project. Name it <span class="strong"><strong>MusicMixer</strong></span>. Then, drag it into the <span class="strong"><strong>MainMixer</strong></span> and select the <span class="strong"><strong>Music</strong></span> group as its <span class="strong"><strong>Output</strong></span>. Repeat the operation to add a mixer <a id="id969" class="indexterm"></a>named <span class="strong"><strong>FxMixer</strong></span> to the project by selecting the <span class="strong"><strong>FX</strong></span> group as its output:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_16.jpg" /></div></li><li><p>Now, select <span class="strong"><strong>MusicMixer</strong></span>. Select its<a id="id970" class="indexterm"></a> <span class="strong"><strong>Master</strong></span> group and add a child named <span class="strong"><strong>Soundtrack</strong></span>. Then, select <span class="strong"><strong>FxMixer</strong></span> and add two children to its <span class="strong"><strong>Master</strong></span> group: one named <span class="strong"><strong>Speech</strong></span>, and another named <span class="strong"><strong>Bells</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_17.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> <a id="id971" class="indexterm"></a>view, select the <span class="strong"><strong>DialogueTrigger</strong></span> object. Then, in the <span class="strong"><strong>Inspector</strong></span> view, change its<a id="id972" class="indexterm"></a> <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>FxMixer</strong></span> | <span class="strong"><strong>Speech</strong></span> in the <span class="strong"><strong>Audio Source</strong></span> component:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_18.jpg" /></div></li><li><p>Now, select the <span class="strong"><strong>Soundtrack</strong></span> GameObject. From the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Audio Source</strong></span> component and change its <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>MusicMixer</strong></span> | <span class="strong"><strong>Soundtrack</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_19.jpg" /></div></li><li><p>Finally, from<a id="id973" class="indexterm"></a> the <span class="strong"><strong>Assets</strong></span> folder in the <span class="strong"><strong>Project</strong></span> view, select the <span class="strong"><strong>Signal</strong></span> prefab . From the <span class="strong"><strong>Inspector</strong></span> view, access its <span class="strong"><strong>Audio Source</strong></span> component and change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>FxMixer</strong></span> | <span class="strong"><strong>Bells</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_20.jpg" /></div></li><li><p>From the <span class="strong"><strong>Audio Mixer</strong></span> window, choose <span class="strong"><strong>MainMixer</strong></span> and select its <span class="strong"><strong>Master</strong></span> track. Then, from the <span class="strong"><strong>Inspector</strong></span> view, right-click on <span class="strong"><strong>Volume</strong></span> in the <span class="strong"><strong>Attenuation</strong></span> component. From<a id="id974" class="indexterm"></a> the context menu, select <span class="strong"><strong>Expose 'Volume (of Master) to script</strong></span> as shown in the following screenshot. Repeat the operation for the <span class="strong"><strong>Music and FX</strong></span> tracks:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_21.jpg" /></div></li><li><p>From the top of the <span class="strong"><strong>Audio Mixer</strong></span> with the <span class="strong"><strong>MainMixer</strong></span> selected, access the <span class="strong"><strong>Exposed Parameters</strong></span> drop-down menu. Then, right-click on <span class="strong"><strong>MyExposedParam</strong></span> and rename it to <code class="literal">OverallVolume</code>. Then, rename <span class="strong"><strong>MyExposedParam1</strong></span> as <code class="literal">MusicVolume</code> and <span class="strong"><strong>MyExposedParam2</strong></span> as <code class="literal">FxVolume</code>.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>C# Script</strong></span> and rename it to <code class="literal">VolumeControl</code>.</p></li><li><p>Open the script in <a id="id975" class="indexterm"></a>your editor and<a id="id976" class="indexterm"></a> replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

using UnityEngine.Audio;
using System.Collections;

public class VolumeControl : MonoBehaviour{
  public AudioMixer myMixer;
  private GameObject panel;
  private bool isPaused = false;

  void Start(){
    panel = GameObject.Find("Panel");
    panel.SetActive(false);
  }

  void Update() {
    if (Input.GetKeyUp (KeyCode.Escape)) {
      panel.SetActive(!panel.activeInHierarchy);

      if(isPaused)
        Time.timeScale = 1.0f;
      else
        Time.timeScale = 0.0f;

      isPaused = !isPaused;
    }
  }

  public void ChangeMusicVol(float vol){
    myMixer.SetFloat ("MusicVolume", Mathf.Log10(vol) * 20f);
  }

  public void ChangeFxVol(float vol){
    myMixer.SetFloat ("FxVolume", Mathf.Log10(vol) * 20f);
  }

  public void ChangeOverallVol(float vol){
    myMixer.SetFloat ("OverallVolume", Mathf.Log10(vol) * 20f);
  }
}</pre></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> dropdown menu to add a <span class="strong"><strong>Panel</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>). Note that it will automatically add a <span class="strong"><strong>Canvas</strong></span> to the scene.</p></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> dropdown menu to add a <span class="strong"><strong>Slider</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Slider</strong></span>). Make it a child of the <span class="strong"><strong>Panel</strong></span> object.</p></li><li><p>Rename the slider as <span class="strong"><strong>OverallSlider</strong></span>. Duplicate it and rename the new copy to <span class="strong"><strong>MusicSlider</strong></span>. Then, in the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Rect Transform</strong></span> component, change its <span class="strong"><strong>Pos Y</strong></span> <a id="id977" class="indexterm"></a>parameter to <code class="literal">-40</code>.</p></li><li><p>Duplicate <span class="strong"><strong>MusicSlider</strong></span> <a id="id978" class="indexterm"></a>and rename the new copy to <span class="strong"><strong>FxSlider</strong></span>. Then, change its <span class="strong"><strong>Pos Y</strong></span> parameter to <code class="literal">-70</code>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_22.jpg" /></div></li><li><p>Select the <span class="strong"><strong>Canvas</strong></span> GameObject and add the <span class="strong"><strong>VolumeControl</strong></span> script to it. Then, populate the <span class="strong"><strong>MyMixer</strong></span> field of <span class="strong"><strong>Volume Control</strong></span> with <span class="strong"><strong>MainMixer</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_23.jpg" /></div></li><li><p>Select the <span class="strong"><strong>OverallSlider</strong></span> component. From the <span class="strong"><strong>Inspector</strong></span> view at the <span class="strong"><strong>Slider</strong></span> component, change <span class="strong"><strong>Min Value</strong></span> to <code class="literal">0.000025</code> (or <span class="strong"><strong>2.5e-05</strong></span>). Then, below the <span class="strong"><strong>On Value Changed</strong></span> list, click the <span class="strong"><strong>+</strong></span> sign to add an action. From <span class="strong"><strong>Hierarchy</strong></span> panel, drag <a id="id979" class="indexterm"></a><span class="strong"><strong>Canvas</strong></span> into the <span class="strong"><strong>Object</strong></span> slot and <a id="id980" class="indexterm"></a>using the drop-down menu, choose<span class="strong"><strong> VolumeControl</strong></span> | <span class="strong"><strong>ChangeOverallVol</strong></span> option, as shown in the following screenshot, For testing purposes, change the appropriate selector from  <span class="strong"><strong>Runtime Only</strong></span> to <span class="strong"><strong>Editor and Runtime</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_24.jpg" /></div></li><li><p>Repeat the previous step with <span class="strong"><strong>MusicSlider</strong></span> and <span class="strong"><strong>FxSlider</strong></span>, but this time, choose <span class="strong"><strong>ChangeMusicVol</strong></span> and <span class="strong"><strong>ChangeFxVol</strong></span> options respectively from the drop-down menu.</p></li><li><p>Play the scene. You will be able to access the sliders when pressing <span class="emphasis"><em>Escape</em></span> on your keyboard and adjust volume settings from there.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec273"></a>How it works...</h3></div></div></div><p>The new <span class="strong"><strong>Audio Mixer</strong></span> feature works in a similar fashion to Digital Audio Workstations, such as Logic and Sonar. Through <span class="strong"><strong>Audio Mixers</strong></span>, you can organize and manage audio elements by routing them into specific groups that can have individual audio tracks to be tweaked around, allowing for adjustments in volume level and sound effects.</p><p>By organizing and routing <a id="id981" class="indexterm"></a>our audio clips into two groups (<span class="strong"><strong>Music</strong></span> and <span class="strong"><strong>FX</strong></span>), we established the <span class="strong"><strong>MainMixer</strong></span> as a unified controller for volume. Then, we have used the <span class="strong"><strong>Audio Mixer</strong></span> to expose the volume levels for each track of the <span class="strong"><strong>MainMixer</strong></span>, making them accessible to our script.</p><p>Also, we have set<a id="id982" class="indexterm"></a> up a basic GUI featuring three sliders that, when in use, will pass their float values (between <code class="literal">0.000025</code> and <code class="literal">1</code>) as arguments to three specific functions in our script: <code class="literal">ChangeMusicVol</code>, <code class="literal">ChangeFxVol</code>, and <code class="literal">ChangeOverallVol</code>. These functions, on their turn, use the <code class="literal">SetFloat</code> command to effectively change the volume levels at runtime. However, before passing on the new volume levels, the script converts linear values (between <code class="literal">0.000025</code> and <code class="literal">1</code>) to the decibel levels that are used by the <span class="strong"><strong>Audio Mixer</strong></span>. This conversion is calculated through the <span class="emphasis"><em>log(x) * 20</em></span> mathematical function.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note43"></a>Note</h3><p>For a full explanation on issues regarding the conversion of linear values to decibel levels and vice-versa, check out Aaron Brown's excellent article at <a class="ulink" href="http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/" target="_blank">http://www.playdotsound.com/portfolio-item/decibel-db-to-float-value-calculator-making-sense-of-linear-values-in-audio-tools/</a>.</p></div><p>It's worth mentioning that the <code class="literal">VolumeControl</code> script also includes code to enable and disable the <span class="strong"><strong>GUI</strong></span> and<a id="id983" class="indexterm"></a> the<a id="id984" class="indexterm"></a> <span class="strong"><strong>EventSystem</strong></span>, depending upon if the player hits the Escape key to activate/deactivate the volume control sliders.</p><p>A very important note—do not change the volume of any <span class="strong"><strong>MainMixer'</strong></span>s tracks; leave them at <code class="literal">0</code> dB. The reason is that our <code class="literal">VolumeControl</code> script sets their maximum volume level. For general adjustments, use the secondary Mixers <span class="strong"><strong>MusicMixer</strong></span> and <span class="strong"><strong>FxMixer</strong></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec274"></a>There's more...</h3></div></div></div><p>Here is some extra information<a id="id985" class="indexterm"></a> on Audio Mixers.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec69"></a>Playing with Audio Production</h4></div></div></div><p>There are many <a id="id986" class="indexterm"></a>creative uses for exposed parameters. We can, for instance, add effects<a id="id987" class="indexterm"></a> such as <span class="strong"><strong>Distortion</strong></span>, <span class="strong"><strong>Flange</strong></span>, and <span class="strong"><strong>Chorus</strong></span> to audio<a id="id988" class="indexterm"></a> channels, allowing users to operate virtual sound tables/mixing<a id="id989" class="indexterm"></a> boards.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec275"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Making a dynamic soundtrack with Snapshots</em></span> recipe in this chapter</p></li><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Balancing the in-game audio with Ducking</em></span> in this chapter</p></li></ul></div></div></div>