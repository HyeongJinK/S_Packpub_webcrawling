<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec124"></a>Improving performance through reduced draw calls by designing for draw call batching</h2></div></div><hr /></div><p>
<span class="strong"><strong>Optimization principal 5</strong></span>: Minimize the number of draw calls.</p><p>One way to minimize draw calls is by prioritizing design decisions to qualify objects for Unity's <span class="emphasis"><em>Static</em></span> and <span class="emphasis"><em>Dynamic draw call batching</em></span>.</p><p>The more CPU-efficient batching method is Unity's<a id="id1303" class="indexterm"></a> <span class="strong"><strong>static batching</strong></span>. It allows reduction of draw calls for any sized geometry. If that is not possible, then the next best thing is <a id="id1304" class="indexterm"></a><span class="strong"><strong>dynamic batching</strong></span>, which again allows Unity to process together several moving objects in a single draw call.</p><p>Note that there is a cost—batching uses memory, and static batching uses more memory than dynamic memory. So, you can improve performance with batching, but you'll be increasing the scene's memory "footprint." As always, use memory and performance profiling to evaluate which use of techniques is best for your game and its intended deployment device.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec396"></a>How to do it...</h3></div></div></div><p>In this section, we will learn how to make possible <span class="strong"><strong>static batching</strong></span> and <span class="strong"><strong>dynamic batching</strong></span>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec106"></a>Static batching</h4></div></div></div><p>To make possible <a id="id1305" class="indexterm"></a>Unity <span class="strong"><strong>static batching</strong></span>, you need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Ensure that models share the same material.</p></li><li><p>Mark models as <span class="strong"><strong>Static</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_37.jpg" /></div></li></ol></div><p>Objects that can be safely marked as <span class="strong"><strong>Static</strong></span> include environment objects that won't move or be scaled.</p><p>Many techniques can be used to ensure models share the same material including:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Avoid using textures by directly painting vertices of the model (useful links for this are provided in the <span class="emphasis"><em>There's more…</em></span> section)</p></li><li style="list-style-type: disc"><p>Increasing the number of objects textured with exactly the same texture</p></li><li style="list-style-type: disc"><p>Artificially enabling objects to share the same texture by combining multiple textures into a single one (texture atlassing)</p></li><li style="list-style-type: disc"><p>Maximizing script use of <code class="literal">Renderer.sharedMaterial</code> rather than <code class="literal">Renderer.material</code> (since use of <code class="literal">Render.material</code> involves making a copy of the material and, therefore, disqualifies that GameObejct for batching)</p></li></ul></div><p>In fact, both static and dynamic<a id="id1306" class="indexterm"></a> batching only work with objects that use the same material, so all methods above apply equally for making dynamic batching possible as well.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec107"></a>Dynamic batching</h4></div></div></div><p>To make possible <a id="id1307" class="indexterm"></a>Unity <span class="strong"><strong>dynamic batching</strong></span>, you need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Ensure that models share the same material.</p></li><li><p>Keep the number of <span class="strong"><strong>vertex attributes</strong></span> below 900 for each mesh.</p></li><li><p>Have the group of objects to quality for dynamic batching to use the same transform scale (although non-uniform scaled models can still be batched).</p></li><li><p>If possible, have dynamic lightmapped objects point to the same lightmap location to facilitate dynamic batching.</p></li><li><p>Avoid the use of multi-pass shaders and real-time shadows if possible, since both of these prevent dynamic batching.</p></li></ol></div><p>To calculate the number of<a id="id1308" class="indexterm"></a> <span class="strong"><strong>vertex attributes</strong></span>, you need to multiply the number of vertices by the number of attributes<a id="id1309" class="indexterm"></a> used by the <span class="strong"><strong>Shader</strong></span>. For example, for a <span class="strong"><strong>Shader</strong></span> using three attributes (vertex position, normal, and UV), it would mean that a model must have less than 300 vertices to keep the total number of attributes below 900 to qualify for dynamic batching.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec397"></a>There's more...</h3></div></div></div><p>Some details you don't want to miss:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec108"></a>Reduce the need for textures by vertex painting</h4></div></div></div><p>For more information <a id="id1310" class="indexterm"></a>about this topic, see the<a id="id1311" class="indexterm"></a> following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Blender:</p><p>
<a class="ulink" href="http://wiki.blender.org/index.php/Doc:2.6/Manual/Materials/Special_Effects/Vertex_Paint" target="_blank">http://wiki.blender.org/index.php/Doc:2.6/Manual/Materials/Special_Effects/Vertex_Paint</a>
</p></li><li style="list-style-type: disc"><p>3D Studio<a id="id1312" class="indexterm"></a> Max:</p><p>
<a class="ulink" href="http://3dmax-tutorials.com/Vertex_Paint_Modifier.html" target="_blank">http://3dmax-tutorials.com/Vertex_Paint_Modifier.html</a>
</p></li><li style="list-style-type: disc"><p>Maya: free Vertex Chameleon plugin</p><p>
<a class="ulink" href="http://renderheads.com/portfolio/VertexChameleon/" target="_blank">http://renderheads.com/portfolio/VertexChameleon/</a>
</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec109"></a>Information sources about reducing textures and materials</h4></div></div></div><p>For more information about this topic, see the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Unity manual <a id="id1313" class="indexterm"></a>page for Draw Call Batching:</p><p>
<a class="ulink" href="http://docs.unity3d.com/Manual/DrawCallBatching.html" target="_blank">http://docs.unity3d.com/Manual/DrawCallBatching.html</a>
</p></li><li style="list-style-type: disc"><p>Paladin <a id="id1314" class="indexterm"></a>Studios:</p><p>
<a class="ulink" href="http://www.paladinstudios.com/2012/07/30/4-ways-to-increase-performance-of-your-unity-game/" target="_blank">http://www.paladinstudios.com/2012/07/30/4-ways-to-increase-performance-of-your-unity-game/</a>
</p></li><li style="list-style-type: disc"><p>Nvidia white paper on texture atlassing to increase draw call batching opportunities:</p><p>
<a class="ulink" href="http://http.download.nvidia.com/developer/NVTextureSuite/Atlas_Tools/Texture_Atlas_Whitepaper.pdf" target="_blank">http://http.download.nvidia.com/developer/NVTextureSuite/Atlas_Tools/Texture_Atlas_Whitepaper.pdf</a>
</p></li><li style="list-style-type: disc"><p>Nvidia free texture tools<a id="id1315" class="indexterm"></a> and Photoshop plug-in:</p><p>
<a class="ulink" href="http://www.nvidia.com/object/texture_atlas_tools.html" target="_blank">http://www.nvidia.com/object/texture_atlas_tools.html</a>
</p></li></ul></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec398"></a>See also</h3></div></div></div><p>Refer to the <span class="emphasis"><em>Improving performance with LOD groups</em></span> recipe in this chapter for more information</p></div></div>