<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec125"></a>Conclusion</h2></div></div><hr /></div><p>In this chapter, we have introduced some extra features and a range of approaches to improve game performance and collect performance data for analysis.</p><p>The first three recipes in this chapter provide some ideas for adding some extra features to your game (pausing, slow motion, and securing online games). The rest of the recipes in this chapter provide examples of how to investigate and improve the efficiency and performance of your game.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec399"></a>There's more...</h3></div></div></div><p>Just as there are many components in a game, there are many parts of a game where processing <span class="emphasis"><em>bottlenecks</em></span> may be found and need to be addressed to improve overall game performance. Some additional suggestions and further reference sources are now provided to provide a launching pad for your further exploration of the issues of optimization and performance, since such topics could take up a whole book rather than just one chapter.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec110"></a>Game audio optimization</h4></div></div></div><p>Mobile devices have considerably less memory and processing resources than consoles, desktops, or even laptops, and often raise the biggest challenges when it comes to game audio. For example, the iPhone can only decompress one audio clip at a time, so a game may suffer processing spikes (that is, slow down game frame rate) due to audio decompression issues.</p><p>Paladin Studios<a id="id1316" class="indexterm"></a> recommend the following audio file compression strategies for mobile games:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Short Clips</strong></span>: Native (no compression)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Longer clips</strong></span> (or ones that loop): Compressed in memory</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Music</strong></span>: Stream from disc</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Files which consistently cause CPU spikes</strong></span>: Decompress on load</p></li></ul></div><p>For more information about this topic, see the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Unity manual audio:</p><p>
<a class="ulink" href="http://docs.unity3d.com/Manual/AudioFiles.html" target="_blank">http://docs.unity3d.com/Manual/AudioFiles.html</a>
</p></li><li style="list-style-type: disc"><p>Paladin Studios:</p><p>
<a class="ulink" href="http://www.paladinstudios.com/2012/07/30/4-ways-to-increase-performance-of-your-unity-game/" target="_blank">http://www.paladinstudios.com/2012/07/30/4-ways-to-increase-performance-of-your-unity-game/</a>
</p></li><li style="list-style-type: disc"><p>Apple developers audio page:</p><p>
<a class="ulink" href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/MultimediaPG/UsingAudio/UsingAudio.html" target="_blank">https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/MultimediaPG/UsingAudio/UsingAudio.html</a>
</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec111"></a>Physics engine optimization</h4></div></div></div><p>For some strategies relating<a id="id1317" class="indexterm"></a> to physics, you might consider to improve performance the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>If possible, use<a id="id1318" class="indexterm"></a> <span class="strong"><strong>geometric primitive colliders</strong></span> (2D box/2D circle/3D box/3D sphere/3D cylinder):</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>You can have multiple primitive colliders</p></li></ul></div></li><li style="list-style-type: disc"><p>You can also have primitive colliders on child objects:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>As long as you have a rigid body on the root object in the object hierarchy</p></li></ul></div></li><li style="list-style-type: disc"><p>Avoid <span class="strong"><strong>2D polygon </strong></span>and <span class="strong"><strong>3D mesh</strong></span> colliders:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>These are much more processor intensive</p></li></ul></div></li><li style="list-style-type: disc"><p>Try increasing<a id="id1319" class="indexterm"></a> the delay between each <code class="literal">FixedUpdate()</code> method call to reduce physics:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Although not to the point where user experience or game behavior is below acceptable quality!</p></li></ul></div></li><li style="list-style-type: disc"><p>Wherever possible, start off rigid bodies in sleep mode (so that they don't require physics processing until woken up by code or a collision). See the following Unity script reference pages for making objects go to sleep and wake up:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<a class="ulink" href="http://docs.unity3d.com/ScriptReference/Rigidbody.Sleep.html" target="_blank">http://docs.unity3d.com/ScriptReference/Rigidbody.Sleep.html</a>
</p></li><li style="list-style-type: disc"><p>
<a class="ulink" href="http://docs.unity3d.com/ScriptReference/Rigidbody.WakeUp.html" target="_blank">http://docs.unity3d.com/ScriptReference/Rigidbody.WakeUp.html</a>
</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_36.jpg" /></div></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec112"></a>More tips for improving script efficiency</h4></div></div></div><p>Some code strategies <a id="id1320" class="indexterm"></a>you might consider to improve performance include the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Use <span class="strong"><strong>Structs</strong></span> rather than <span class="strong"><strong>Classes</strong></span> to improve speed up processing.</p></li><li style="list-style-type: disc"><p>Wherever possible, use simple arrays of primitive types rather than <span class="strong"><strong>ArrayLists</strong></span>, <span class="strong"><strong>Dictionaries,</strong></span> or more complex collection classes. A good article about choosing the most appropriate collection in Unity can be found at <a class="ulink" href="http://wiki.unity3d.com/index.php/Choosing_the_right_collection_type" target="_blank">http://wiki.unity3d.com/index.php/Choosing_the_right_collection_type</a>.</p></li><li style="list-style-type: disc"><p>Raycasting is slow, so avoid performing it every frame, for example, use coroutines to only raycast every 3rd or 10th frame.</p></li><li style="list-style-type: disc"><p>Finding objects is slow, so avoid finding objects in <code class="literal">Update()</code> or inner loops, and you <a id="id1321" class="indexterm"></a>can have objects set up a <code class="literal">public static</code> variable to allow quick instance retrieval, rather than using a <code class="literal">Find(â€¦)</code> method. Or you could use the Singleton design pattern.</p></li><li style="list-style-type: disc"><p>Avoid using <code class="literal">OnGUI()</code>, since it is called every frame just like <code class="literal">Update()</code>; this is much easier to avoid now with the new Unity 5 UI system.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec113"></a>Sources of more wisdom about optimization</h4></div></div></div><p>Here are several other sources that you might want to explore to learn more about game optimization topics:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Unity<a id="id1322" class="indexterm"></a> general mobile optimization page:</p><p>
<a class="ulink" href="http://docs.unity3d.com/Manual/MobileOptimisation.html" target="_blank">http://docs.unity3d.com/Manual/MobileOptimisation.html</a>
</p></li><li style="list-style-type: disc"><p>X-team Unity best practices:</p><p>
<a class="ulink" href="http://x-team.com/2014/03/unity-3d-optimisation-and-best-practices-part-1/" target="_blank">http://x-team.com/2014/03/unity-3d-optimisation-and-best-practices-part-1/</a>
</p></li><li style="list-style-type: disc"><p>Code Project:</p><p>
<a class="ulink" href="http://www.codeproject.com/Articles/804021/Unity-and-Csharp-Performance-Optimisation-tips" target="_blank">http://www.codeproject.com/Articles/804021/Unity-and-Csharp-Performance-Optimisation-tips</a>
</p></li><li style="list-style-type: disc"><p>General graphics optimization:</p><p>
<a class="ulink" href="http://docs.unity3d.com/Manual/OptimizingGraphicsPerformance.html" target="_blank">http://docs.unity3d.com/Manual/OptimizingGraphicsPerformance.html</a>
</p></li><li style="list-style-type: disc"><p>Learn more about mobile physics at Unity's iPhone optimization physics page:</p><p>
<a class="ulink" href="http://docs.unity3d.com/Manual/iphone-Optimizing-Physics.html" target="_blank">http://docs.unity3d.com/Manual/iphone-Optimizing-Physics.html</a>
</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec114"></a>Published articles that discuss premature optimization</h4></div></div></div><p>Here are<a id="id1323" class="indexterm"></a> several articles discussing Donald Knuth's famous quotation about premature optimization being "evil":</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Joe Duffy's blog:</p><p>
<a class="ulink" href="http://joeduffyblog.com/2010/09/06/the-premature-optimization-is-evil-myth/" target="_blank">http://joeduffyblog.com/2010/09/06/the-premature-optimization-is-evil-myth/</a>
</p></li><li style="list-style-type: disc"><p>"When is optimization premature?" Stack Overflow:</p><p>
<a class="ulink" href="http://stackoverflow.com/questions/385506/when-is-optimisation-premature" target="_blank">http://stackoverflow.com/questions/385506/when-is-optimisation-premature</a>
</p></li><li style="list-style-type: disc"><p>
<span class="emphasis"><em>The Fallacy of Premature Optimization</em></span>, Randall Hyde (published by ACM), source: Ubiquity <a id="id1324" class="indexterm"></a>Volume 10, Issue 3, 2009:</p><p>
<a class="ulink" href="http://ubiquity.acm.org/article.cfm?id=1513451" target="_blank">http://ubiquity.acm.org/article.cfm?id=1513451</a>
</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec115"></a>Sources of more about Game Managers and the State Pattern</h4></div></div></div><p>Learn more<a id="id1325" class="indexterm"></a> about implementing the State Pattern and Game Managers in <a id="id1326" class="indexterm"></a>Unity from the following sites:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<a class="ulink" href="http://rusticode.com/2013/12/11/creating-game-manager-using-state-machine-and-singleton-pattern-in-unity3d/" target="_blank">http://rusticode.com/2013/12/11/creating-game-manager-using-state-machine-and-singleton-pattern-in-unity3d/</a>
</p></li><li style="list-style-type: disc"><p>
<a class="ulink" href="https://github.com/thefuntastic/Unity3d-Finite-State-Machine" target="_blank">https://github.com/thefuntastic/Unity3d-Finite-State-Machine</a>
</p></li></ul></div></div></div></div>