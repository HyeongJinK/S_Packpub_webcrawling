<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec55"></a>Creating a picture-in-picture effect</h2></div></div><hr /></div><p>Having more than one viewport displayed can be useful in many situations. For example, you may want to show simultaneous events going on in different locations, or you may want to have a<a id="id435" class="indexterm"></a> separate window for hot-seat multiplayer games. Although you can do this manually by adjusting the <span class="strong"><strong>Normalized Viewport Rect</strong></span> parameters on your camera, this recipe includes a series of extra preferences to make it more independent from the user's display configuration.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec144"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared the <code class="literal">BasicScene</code> Unity package, containing a scene named <code class="literal">BasicScene</code>. The package is in the <code class="literal">1362_05_codes</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec145"></a>How to do it...</h3></div></div></div><p>To create a picture-in-picture display, just follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">BasicScene</code> package into your Unity Project.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, open the <span class="strong"><strong>BasicScene</strong></span> level. This is a basic scene featuring an animated character and some extra geometry.</p></li><li><p>Add a new <span class="strong"><strong>Camera</strong></span> to the scene through the <span class="strong"><strong>Create</strong></span> drop-down menu on top of the <span class="strong"><strong>Hierarchy</strong></span> view (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Camera</strong></span>).</p></li><li><p>Select the camera you have created and, from the <span class="strong"><strong>Inspector</strong></span> view, change its <span class="strong"><strong>Depth</strong></span> to <span class="strong"><strong>1</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_01.jpg" /></div></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>C# Script</strong></span> file and rename it <code class="literal">PictureInPicture</code>.</p></li><li><p>Open your <a id="id436" class="indexterm"></a>script and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class PictureInPicture: MonoBehaviour {
  public enum hAlignment{left, center, right};
  public enum vAlignment{top, middle, bottom};
  public hAlignment horAlign = hAlignment.left;
  public vAlignment verAlign = vAlignment.top;
  public enum UnitsIn{pixels, screen_percentage};
  public UnitsIn unit = UnitsIn.pixels;
  public int width = 50;
  public int height= 50;
  public int xOffset = 0;
  public int yOffset = 0;
  public bool  update = true;
  private int hsize, vsize, hloc, vloc;

  void Start (){
    AdjustCamera ();
  }

  void Update (){
    if(update)
    AdjustCamera ();
  }

  void AdjustCamera(){
    int sw = Screen.width;
    int sh = Screen.height;
    float swPercent = sw * 0.01f;
    float shPercent = sh * 0.01f;
    float xOffPercent = xOffset * swPercent;
    float yOffPercent = yOffset * shPercent;
    int xOff;
    int yOff;
    if(unit == UnitsIn.screen_percentage){
      hsize = width * (int)swPercent;
      vsize = height * (int)shPercent;
      xOff = (int)xOffPercent;
      yOff = (int)yOffPercent;
    } else {
      hsize = width;
      vsize = height;
      xOff = xOffset;
      yOff = yOffset;
    }

    switch (horAlign) {
      case hAlignment.left:
      hloc = xOff;
      break;
      case hAlignment.right:
      int justfiedRight = (sw - hsize);
      hloc = (justfiedRight - xOff);
      break;
      case hAlignment.center:
      float justifiedCenter = (sw * 0.5f) - (hsize * 0.5f);
      hloc = (int)(justifiedCenter - xOff);
      break;
    }

    switch (verAlign) {
      case vAlignment.top:
      int justifiedTop = sh - vsize;
      vloc = (justifiedTop - (yOff));
      break;
      case vAlignment.bottom:
      vloc = yOff;
      break;
      case vAlignment.middle:
      float justifiedMiddle = (sh * 0.5f) - (vsize * 0.5f);
      vloc = (int)(justifiedMiddle - yOff);
      break;
    }

    GetComponent&lt;Camera&gt;().pixelRect = new Rect(hloc,vloc,hsize,vsize);
  }
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"></a>Note</h3><p>In case you<a id="id437" class="indexterm"></a> haven't noticed, we are not achieving percentages by dividing numbers by 100, but rather multiplying them by 0.01. The reason behind this is that computer processors are faster at multiplying than dividing.</p></div></li><li><p>Save your script and attach it to the camera you previously created.</p></li><li><p>Uncheck the new camera's <span class="strong"><strong>Audio Listener</strong></span> component and change some of the <span class="strong"><strong>PictureInPicture</strong></span> parameters: change <span class="strong"><strong>Hor Align</strong></span> to <code class="literal">right</code>, <span class="strong"><strong>Ver Align</strong></span> to <code class="literal">top</code>, and <span class="strong"><strong>Unit</strong></span> to <code class="literal">pixels</code>. Leave <span class="strong"><strong>XOffset</strong></span> and <span class="strong"><strong>YOffset</strong></span> as <code class="literal">0</code>, change <span class="strong"><strong>Width</strong></span> to <code class="literal">400</code> and <span class="strong"><strong>Height</strong></span> to <code class="literal">200</code>, as<a id="id438" class="indexterm"></a> shown here:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_02.jpg" /></div></li><li><p>Play your scene. The new camera's viewport should be visible in the top-right corner of the screen, as shown below:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_03.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec146"></a>How it works...</h3></div></div></div><p>In this example, we added a second camera in order to display the scene from a different point of view. The second camera's relative viewport was originally placed on top of the <span class="strong"><strong>Main Camera</strong></span>'s viewport, hence taking up all of the screen space.</p><p>The <code class="literal">PictureInPicture</code> script changes the camera's <span class="strong"><strong>Normalized Viewport Rect</strong></span>, thus resizing and <a id="id439" class="indexterm"></a>positioning the viewport according to the user's preferences.</p><p>First, it reads user preferences for the component (dimensions, alignment, and offset for the PiP viewport) and converts dimensions in screen percentage to pixels.</p><p>Later, from the <code class="literal">if(unit == UnitsIn.screen_percentage){</code> conditional, the script calculates two of the viewport Rect parameters (width and height) according to the user's selection.</p><p>Later on, to <span class="strong"><strong>switch</strong></span> statements to adjust the other two viewport Rect parameters (horizontal and vertical location) according to the total screen dimensions, PiP viewport dimension, vertical/horizontal alignment, and offset.</p><p>Finally, a line of code tells the camera to change the location and dimensions of the camera's <span class="strong"><strong>Viewport Rect</strong></span>:</p><div class="informalexample"><pre class="programlisting">GetComponent&lt;Camera&gt;().pixelRect = new Rect(hloc,vloc,hsize,vsize);</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec147"></a>There's more...</h3></div></div></div><p>The following are <a id="id440" class="indexterm"></a>some aspects of your picture-in-picture that you could change:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec35"></a>Making the picture-in-picture proportional to the screen's size</h4></div></div></div><p>If you<a id="id441" class="indexterm"></a> change the <span class="strong"><strong>Unit</strong></span> option to <code class="literal">screen_percentage</code>, the viewport size will be based on the actual screen's dimensions instead of pixels.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec36"></a>Changing the position of the picture-in-picture</h4></div></div></div><p>The <span class="strong"><strong>Ver Align</strong></span> and<a id="id442" class="indexterm"></a> <span class="strong"><strong>Hor Align</strong></span> options can be used to change the viewport's vertical and horizontal alignment. Use them to place it where you wish.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec37"></a>Preventing the picture-in-picture from updating on every frame</h4></div></div></div><p>Leave the <a id="id443" class="indexterm"></a><span class="strong"><strong>Update</strong></span> option unchecked if you don't plan to change the viewport position in running mode. Also, it's a good idea to leave it checked when testing and uncheck it once the position has been decided and set up.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec148"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Displaying a mini-map</em></span> recipe in this chapter</p></li></ul></div></div></div>