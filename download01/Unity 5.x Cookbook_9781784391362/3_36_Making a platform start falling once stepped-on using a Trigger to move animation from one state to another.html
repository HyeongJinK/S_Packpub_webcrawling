<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec41"></a>Making a platform start falling once stepped-on using a Trigger to move animation from one state to another</h2></div></div><hr /></div><p>In many cases we don't wish an animation to begin until some condition has been met, or some event occurred. In these cases a good way to organize the Animator Controller is to have two animation states (clips) and a Trigger on the Transition between the clips. We use code to detect when <a id="id285" class="indexterm"></a>we wish the animation to start playing, and at that time we send the Trigger message to the Animation Controller, causing the transition to start.</p><p>In this recipe we'll <a id="id286" class="indexterm"></a>create a water platform block in our 2D platform game; such blocks will begin to slowly fall down the screen as soon as they have been stepped on, and so the player must keep on moving otherwise they'll fall down the screen with the blocks too! It looks as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_01.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec105"></a>Getting ready</h3></div></div></div><p>This recipe builds on the previous one, so make a copy of that project, and work on the copy for this recipe.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec106"></a>How to do it...</h3></div></div></div><p>To construct an animation that only plays once a Trigger has been received, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> create an <span class="strong"><strong>Empty</strong></span> GameObject named <span class="strong"><strong>water-block-container</strong></span>, positioned at (<code class="literal">2.5</code>, <code class="literal">-4, 0</code>). This empty GameObject will allow us to make duplicates of animated Water Blocks that will animate relative to their parent GameObject position.</p></li><li><p>Drag an instance of the sprite <span class="strong"><strong>Water Block</strong></span> from the <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Sprites</strong></span> folder into the scene and child it to GameObject <span class="strong"><strong>water-block-container</strong></span>. Ensure the position of your new child GameObject <span class="strong"><strong>Water Block</strong></span> is (<code class="literal">0</code>, <code class="literal">0</code>, <code class="literal">0</code>), so that it appears neatly to right of the wall blocks platform, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_09.jpg" /></div></li><li><p>Add a <span class="strong"><strong>Box Collider 2D</strong></span> component to child GameObject <span class="strong"><strong>Water Block</strong></span>, and set the layer of this GameObject to <span class="strong"><strong>Ground</strong></span>, so that the player's character can stand and jump <a id="id287" class="indexterm"></a>on this water block platform.</p></li><li><p>Ensuring<a id="id288" class="indexterm"></a> child GameObject <span class="strong"><strong>Water Block</strong></span> is selected in the <span class="strong"><strong>Hierarchy</strong></span>, open an <span class="strong"><strong>Animation</strong></span> panel, then create a new clip named <span class="strong"><strong>platform-water-up</strong></span>. saving it in your <code class="literal">Animations</code> folder.</p></li><li><p>Click button <span class="strong"><strong>Add Curve</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> and <span class="strong"><strong>Position</strong></span>.</p></li><li><p>Delete the second keyframe at time <span class="strong"><strong>1:00</strong></span>. You have now completed the creation of the water block up animation clip.</p></li><li><p>Create a second Animation clip, named <span class="strong"><strong>platform-water-down</strong></span>. Again, click button <span class="strong"><strong>Add Curve</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> and <span class="strong"><strong>Position</strong></span>, and delete the second keyframe at time <span class="strong"><strong>1:00</strong></span>.</p></li><li><p>With the first keyframe at time <span class="strong"><strong>0:00</strong></span> selected, set the Y-value of the GameObjects Transform Position to <code class="literal">-5</code>. You have now completed the creation of the water block down animation clip, so you can click the red record button to stop recording.</p></li><li><p>You may have noticed that as well as the up/down <span class="strong"><strong>Animation Clips</strong></span> that you created, another file was created in your <code class="literal">Animations</code> folder, an <span class="strong"><strong>Animator Controller</strong></span> named <span class="strong"><strong>Water Block</strong></span>. Select this file and open the <span class="strong"><strong>Animator</strong></span> panel, to see and edit the State Machine diagram:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_10.jpg" /></div></li><li><p>Currently, although we created 2 animation clips (states), only the <span class="strong"><strong>Up</strong></span> state is ever active. This is because when the scene begins (Entry) the object will immediately go in state <span class="strong"><strong>platform-water-up</strong></span>, but since there are no transition arrows from this state to <span class="strong"><strong>platform-water-down</strong></span>, then at present the <span class="strong"><strong>Water Block</strong></span> GameObject will always be in its <span class="strong"><strong>Up</strong></span> state.</p></li><li><p>Ensure<a id="id289" class="indexterm"></a> state <span class="strong"><strong>platform-water-up</strong></span> is selected (it will have a blue border around it), and create a Transition (arrow) to state <span class="strong"><strong>platform-water-down</strong></span>, by choosing <span class="strong"><strong>Make Transition</strong></span> from the <span class="strong"><strong>mouse-right-click</strong></span> menu.</p></li><li><p>If you run the scene now, the default <span class="strong"><strong>Transition</strong></span> settings are that after 0.9 seconds the <span class="strong"><strong>Water Blocks</strong></span> will transition into their <span class="strong"><strong>Down</strong></span> state. We don't want this â€“ we only want them to animate downwards after the player has walked onto<a id="id290" class="indexterm"></a> them. So create a <span class="strong"><strong>Trigger</strong></span> named <span class="strong"><strong>Fall</strong></span>, by choosing the <span class="strong"><strong>Parameters</strong></span> tab in the <span class="strong"><strong>Animator</strong></span> panel, clicking the plus '<span class="strong"><strong>+</strong></span>' button and selecting <span class="strong"><strong>Trigger</strong></span>, and then selecting <span class="strong"><strong>Fall</strong></span>.</p></li><li><p>Do the following to create our Trigger:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>In the <span class="strong"><strong>Animator</strong></span> panel select the <span class="strong"><strong>Transition</strong></span>
</p></li><li style="list-style-type: disc"><p>In the <span class="strong"><strong>Inspector</strong></span> panel uncheck the <span class="strong"><strong>Has Exit Time</strong></span> option</p></li><li style="list-style-type: disc"><p>In the <span class="strong"><strong>Inspector</strong></span> panel drag the Transition end time to <span class="strong"><strong>2:00</strong></span> seconds (so the Water Block slowly Transitions to its Down state over a period of 2 seconds)</p></li><li style="list-style-type: disc"><p>In the <span class="strong"><strong>Inspector</strong></span> panel click the plus '<span class="strong"><strong>+</strong></span>' button to add a <span class="strong"><strong>Condition</strong></span>, which should automatically suggest the only possible condition parameter, which is our <span class="strong"><strong>Trigger Fall</strong></span>.</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_12.jpg" /></div></li><li><p>We now<a id="id291" class="indexterm"></a> need to add a collider trigger just above the Water Block, and add C# script behavior to send the <span class="strong"><strong>Animator Controller Trigger</strong></span> when the player enters<a id="id292" class="indexterm"></a> the collider. Ensuring child GameObject <span class="strong"><strong>Water Block</strong></span> is selected, add a (second) <span class="strong"><strong>2D Box Collider</strong></span>, with a Y-Offset of <span class="strong"><strong>1</strong></span>, and tick its <span class="strong"><strong>Is Trigger</strong></span> checkbox:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_13.jpg" /></div></li><li><p>Add an instance of C# script class <code class="literal">WaterBlock</code> as a component to your <span class="strong"><strong>Water Block</strong></span> child GameObject:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class WaterBlock : MonoBehaviour {
  private Animator animatorController;

  void Start(){
    animatorController = GetComponent&lt;Animator&gt;();
  }

  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Player")){
      animatorController.SetTrigger("Fall");
    }
  }
}</pre></div></li><li><p>Make 6 more copies of GameObject <span class="strong"><strong>water-block-container</strong></span>, with X positions increasing by 1 each time, that is, <code class="literal">3.5</code>, <code class="literal">4.5</code>, <code class="literal">5.5</code>, and so on.</p></li><li><p>Run the scene, and as the player's character runs across each water block they will start falling down, so he had better keep running!</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec107"></a>How it works...</h3></div></div></div><p>You created a two-state <a id="id293" class="indexterm"></a><span class="strong"><strong>Animator Controller</strong></span> state machine. Each state was an <span class="strong"><strong>Animation Clip</strong></span>. You created a <span class="strong"><strong>Transition</strong></span> from the <span class="strong"><strong>Water Block</strong></span> Up state to its Down state that will take place when the Animator Controller received a Fall Trigger message. You created a <span class="strong"><strong>Box Collider 2D</strong></span> with a <span class="strong"><strong>Trigger</strong></span>, so that <a id="id294" class="indexterm"></a>scripted component WaterBlock could be detected when the player (tagged <span class="strong"><strong>Player</strong></span>) enters its collider, and at that point send the <span class="strong"><strong>Fall</strong></span> Trigger message to make the <span class="strong"><strong>Water Block</strong></span> GameObject start gently Transitioning into its Down state further down the screen.</p><p>Learn more about the <a id="id295" class="indexterm"></a>Animator Controllers on the Unity Manual web pages at <a class="ulink" href="http://docs.unity3d.com/Manual/class-AnimatorController.html" target="_blank">http://docs.unity3d.com/Manual/class-AnimatorController.html</a>.</p></div></div>