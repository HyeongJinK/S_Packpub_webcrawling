<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec39"></a>Animating body parts for character movement events</h2></div></div><hr /></div><p>In this recipe, we'll<a id="id273" class="indexterm"></a> learn to animate the hat of the Unity bean-man character in response to a jump event.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec99"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared the files you need in folder <code class="literal">1362_03_02</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec100"></a>How to do it...</h3></div></div></div><p>To animate body parts for character movement events, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new Unity 2D project.</p></li><li><p>Import the provided package <code class="literal">BeanManAssets</code>, by choosing menu: <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Import Package</strong></span> | <span class="strong"><strong>Custom Package …</strong></span>, and then click the <span class="strong"><strong>Import</strong></span> button to import all these assets into your <span class="strong"><strong>Project</strong></span> panel.</p></li><li><p>Increase the size of the <span class="strong"><strong>Main Camera</strong></span> to <code class="literal">10</code>.</p></li><li><p>Let's setup the 2D gravity setting for this project – we'll use the same setting as from Unity's 2D platform tutorial, a setting of Y= <code class="literal">-30</code>. Set 2D gravity to this value by choosing menu: <span class="strong"><strong>Edit</strong></span> | <span class="strong"><strong>Project Settings</strong></span> | <span class="strong"><strong>Physics 2D</strong></span>, and then at the top change the Y value to <code class="literal">-30</code>.</p></li><li><p>Drag an instance of the BeanMan <span class="strong"><strong>character2D</strong></span> from the <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Prefabs</strong></span> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">3</code>, <code class="literal">0</code>).</p></li><li><p>Drag an instance of the sprite <span class="strong"><strong>platformWallBlocks</strong></span> from the <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Sprites</strong></span> folder into the scene. Position this GameObject at (<code class="literal">0</code>, <code class="literal">-4</code>, <code class="literal">0</code>).</p></li><li><p>Add a <span class="strong"><strong>Box Collider 2D</strong></span> component to GameObject <span class="strong"><strong>platformWallBlocks</strong></span> by choosing menu: <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics 2D</strong></span> | <span class="strong"><strong>Box Collider 2D</strong></span>.</p></li><li><p>We now have a stationary platform that the player can land upon, and walk left and right on. Create a new <span class="strong"><strong>Layer</strong></span> named <span class="strong"><strong>Ground</strong></span>, and assign GameObject<span class="strong"><strong> platformWallBlocks</strong></span> to this new layer, as shown in the following screenshot. Pressing the <span class="emphasis"><em>Space</em></span> key when the character is on the platform will now make him jump.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_05.jpg" /></div></li><li><p>Currently the<a id="id274" class="indexterm"></a> BeanMan character is animated (arms and legs moving) when we make him jump. Let's remove the Animation clips and Animator controller and create our own from scratch. Delete folders Clips and Controllers from <span class="strong"><strong>Project</strong></span> | <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>PotatoMan2DAssets</strong></span> | <span class="strong"><strong>Character2D</strong></span> | <span class="strong"><strong>Animation</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_22.jpg" /></div></li><li><p>Let's create an Animation clip (and its associated Animator controller) for our hero character. In the Hierarchy panel select GameObject <span class="strong"><strong>hero</strong></span>. Ensuring GameObject <span class="strong"><strong>character2D</strong></span> is selected in the <span class="strong"><strong>Hierarchy</strong></span>, open the <span class="strong"><strong>Animation</strong></span> panel, and ensure it is in <span class="strong"><strong>Dope Sheet</strong></span> view (this is the default).</p></li><li><p>Click the empty dropdown menu in the <span class="strong"><strong>Animation</strong></span> panel (next to the greyed out word <code class="literal">Samples</code>), and choose menu item <span class="strong"><strong>[Create New Clip]</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_06.jpg" /></div></li><li><p>Save the new clip in the<span class="strong"><strong> Character2D</strong></span> | <span class="strong"><strong>Animation</strong></span> folder, naming it as <span class="strong"><strong>character-beanman-idle</strong></span>. You've now created an Animation clip for the 'idle' character state (which is not animated).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"></a>Note</h3><p>Your final game may end up with tens, or even hundreds, of animation clips. Make things easy to search by prefixing the names of clips with object type, name, and then description of the animation clip.</p></div></li><li><p>Looking at the <span class="strong"><strong>Character2D</strong></span> | <span class="strong"><strong>Animation</strong></span> folder in the Project panel you should now see<a id="id275" class="indexterm"></a> both the Animation clip you have just created (<span class="strong"><strong>character-beanman-idle</strong></span>) and also a new Animator controller, which has defaulted to the name of your GameObject <span class="strong"><strong>character2D</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_23.jpg" /></div></li><li><p>Ensuring GameObject <span class="strong"><strong>character2D</strong></span> is selected in the <span class="strong"><strong>Hierarchy</strong></span>, open the <span class="strong"><strong>Animator</strong></span> panel and you'll see the State Machine for controlling the animation of our character. Since we only have one Animation clip (<span class="strong"><strong>character-beanman-idle</strong></span>) then upon entry the State Machine immediately enters this state.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_24.jpg" /></div></li><li><p>Run your scene – since the character is always in the 'idle' state, we see no animation yet when we make it jump.</p></li><li><p>Now we'll create a 'jump' Animation clip which animates the hat. Click the empty dropdown menu in the <span class="strong"><strong>Animation</strong></span> panel (next to the greyed out word 'Samples'), and <a id="id276" class="indexterm"></a>create a new clip in your <span class="strong"><strong>Animation</strong></span> folder, naming it <span class="strong"><strong>character-beanman-jump</strong></span>.</p></li><li><p>Click button <span class="strong"><strong>Add Property</strong></span>, and chose <span class="strong"><strong>Transform</strong></span> | <span class="strong"><strong>Position</strong></span> of the <span class="strong"><strong>hat</strong></span> child object, by clicking its '<span class="strong"><strong>+</strong></span>' plus-sign button. We are now recording changes to the (X, Y, Z) position of GameObject <span class="strong"><strong>hat</strong></span> in this animation clip:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_25.jpg" /></div></li><li><p>You should now see 2 'keyframes' at 0.0 and at 1.0. These are indicated by diamonds in the <span class="strong"><strong>Timeline</strong></span> area in the right-hand-section of the <span class="strong"><strong>Animation</strong></span> panel.</p></li><li><p>Click to select the first keyframe (at time 0.0). Now in the <span class="strong"><strong>Scene</strong></span> panel move the hat up and left a little, away from the head. You should see that all three X, Y, Z values have a red background in the <span class="strong"><strong>Inspector</strong></span> – this is to inform you that the values of the <span class="strong"><strong>Transform</strong></span> component are being recorded in the animation clip:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_26.jpg" /></div></li><li><p>Since 1 second is perhaps too long for our jump animation, drag the second keyframe<a id="id277" class="indexterm"></a> diamond to the left to a time of 0.5.</p></li><li><p>We now need to define when the character should Transition from the 'idle' state to the 'jump' state. In the <span class="strong"><strong>Animator</strong></span> panel select state <span class="strong"><strong>character-beanman-idle</strong></span>, and create a transition to the state <span class="strong"><strong>character-beanman-jump</strong></span> by right-mouse-clicking and choosing menu Make Transition, then drag the transition arrow to state <span class="strong"><strong>character-beanman-jump</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_27.jpg" /></div></li><li><p>Now let's add a Trigger parameter named 'Jump', by clicking on the add parameter plus-sign "<span class="strong"><strong>+</strong></span>" button at the top-left of the <span class="strong"><strong>Animator</strong></span> panel, choosing<a id="id278" class="indexterm"></a> <span class="strong"><strong>Trigger</strong></span>, and typing the name <span class="strong"><strong>Jump</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_28.jpg" /></div></li><li><p>We can now define the properties for when our character should <span class="strong"><strong>Transition</strong></span> from idle to jump. Click the Transition arrow to select it, and set the following 4 properties in the <span class="strong"><strong>Inspector</strong></span> panel:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Has Exit Time</strong></span>: uncheck</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Transition Duration</strong></span>: <code class="literal">0.01</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Interruption State</strong></span>: <code class="literal">Current State</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Conditions</strong></span>: Add <code class="literal">Jump</code> (click plus-sign '<code class="literal">+</code>' button at bottom)</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_29.jpg" /></div></li><li><p>Save and run your scene. Once the character has landed on the platform and you press the <span class="emphasis"><em>SPACE</em></span> key to jump, you'll now see the character's hat jump away from his head, and slowly move back. Since we haven't added any transition to ever leave the Jump state, this Animation clip will loop, so the hat keeps on moving even when the jump is completed.</p></li><li><p>In the Animator <a id="id279" class="indexterm"></a>panel select state <span class="strong"><strong>character-beanman-jump</strong></span> and add a new Transition back to state <span class="strong"><strong>character-beanman-idle</strong></span>. Select this Transition arrow and in the Inspector panel sets its properties as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Has Exit Time</strong></span>: (leave as checked)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Exit time</strong></span>: <code class="literal">0.5</code> (this needs to be the same time value as the second keyfame of our Jump animation clip)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Transition Duration</strong></span>: <code class="literal">0.01</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Interruption State</strong></span>: <code class="literal">Current State</code>
</p></li></ul></div></li><li><p>Save and run your scene. Now when you jump the hat should animate once, after which the character immediately returns to its Idle state.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec101"></a>How it works...</h3></div></div></div><p>You have added an Animation controller State Machine to GameObject <span class="strong"><strong>character2D</strong></span>. The two Animation clips you created (idle and jump) appear as States in the Animator panel. You created a Transition from Idle to Jump when the 'Jump' Trigger parameter is received by the State Machine. You created a second Transition, which transitions back to the Idle state after waiting 0.5 seconds (the same duration between the 2 keyframes in our Jump Animation clip).</p><p>Note that the key to everything working for the bean-man character is that when we make the character jump with the <span class="emphasis"><em>SPACE</em></span> key, then code in the <code class="literal">PlayerControl</code> C# scripted component of GameObject<span class="strong"><strong> character2D</strong></span>, as well as making the sprite move upwards on screen, also sends a <code class="literal">SetTrigger(…)</code> message to the Animator controller component, for the <span class="strong"><strong>Trigger</strong></span> named <span class="strong"><strong>Jump</strong></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"></a>Note</h3><p>The difference between a <span class="strong"><strong>Boolean</strong></span> Parameter and a <span class="strong"><strong>Trigger</strong></span> is that a <span class="strong"><strong>Trigger</strong></span> is temporality set to <code class="literal">True</code> and once the <code class="literal">SetTrigger(…)</code> event has been 'consumed' by a state transition it automatically returns to being <code class="literal">False</code>. So Triggers are useful for actions we wish to do once and then revert to a previous state. A <span class="strong"><strong>Boolean</strong></span> Parameter is a variable, which can have its value set to true/or <code class="literal">False</code> at different times during the game, and so different Transitions can be created to fire depending on the value of the variable at any time. Note that <span class="strong"><strong>Boolean</strong></span> parameters have to have their values explicitly set back to <code class="literal">False</code> with a <code class="literal">SetBool(…)</code>.</p></div><p>The following screenshot highlights the line of code that sends the <code class="literal">SetTrigger(…)</code> message:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_03_30.jpg" /></div><p>
<span class="strong"><strong>State Machines</strong></span> for animations of a range of motions (running/walking/jumping/falling/dying and so on.) will have more states and transitions. The Unity-provided<a id="id280" class="indexterm"></a> bean-man character has a more complex <span class="strong"><strong>State Machine</strong></span>, and more complex animations (of hands and feet, and eyes and hat and so on, for each <span class="strong"><strong>Animation</strong></span> clip), which you may find useful to explore.</p><p>Learn more about the <a id="id281" class="indexterm"></a>Animation view on the Unity Manual web pages at <a class="ulink" href="http://docs.unity3d.com/Manual/AnimationEditorGuide.html" target="_blank">http://docs.unity3d.com/Manual/AnimationEditorGuide.html</a>.</p></div></div>