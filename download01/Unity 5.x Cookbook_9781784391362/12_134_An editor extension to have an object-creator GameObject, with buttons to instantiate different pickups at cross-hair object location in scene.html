<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch12lvl1sec130"></a>An editor extension to have an object-creator GameObject, with buttons to instantiate different pickups at cross-hair object location in scene</h2></div></div><hr /></div><p>If a level designer wishes to place each pickup carefully "by hand", we can still make this easier than having to drag copies of prefabs manually from the <span class="strong"><strong>Projects</strong></span> panel. In this recipe, we provide a "cross-hairs" GameObject, with buttons in the Inspector allowing the game<a id="id1361" class="indexterm"></a> designer to create instances of three different kinds of prefab at precise locations by clicking the appropriate button when the center of the cross-hairs is at the desired location.</p><p>A Unity Editor extension<a id="id1362" class="indexterm"></a> is at the heart of this recipe and illustrates how such extensions can allow less technical members of a game development team to take an active role in level creation within the Unity Editor.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_12_47.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl2sec411"></a>Getting ready</h3></div></div></div><p>This recipe assumes you are starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Inventory GUIs</em></span>.</p><p>For this recipe, we have prepared the cross-hairs image you need in a folder named <code class="literal">Sprites</code> in the <code class="literal">1362_12_04</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl2sec412"></a>How to do it...</h3></div></div></div><p>To create an object-creator GameObject, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start with a new copy of mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, rename GameObject <code class="literal">star</code> as <code class="literal">pickup</code>.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, create a new folder named <code class="literal">Prefabs</code>. Inside this new folder, create<a id="id1363" class="indexterm"></a> three new empty prefabs named <code class="literal">star, heart</code>, and<code class="literal"> key</code>.</p></li><li><p>Populate the <code class="literal">star</code> prefab by dragging GameObject <code class="literal">pickup</code> from the <span class="strong"><strong>Hierarchy</strong></span> panel over <code class="literal">star</code> in the <span class="strong"><strong>Project</strong></span> panel. The prefab should now turn blue and have a copy of all of the star GameObject's properties and components.</p></li><li><p>Add a new tag <code class="literal">Heart</code> in the Inspector. Select GameObject <code class="literal">pickup</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel and assign it the tag <code class="literal">Heart</code>. Also, drag from the <span class="strong"><strong>Project</strong></span> panel (folder <code class="literal">Sprites</code>) the <span class="strong"><strong>healthheart</strong></span> image into the Sprite property of GameObject <code class="literal">pickup</code> so that the player sees the heart image on screen for this pickup item.</p></li><li><p>Populate the <code class="literal">heart</code> prefab by dragging GameObject <code class="literal">pickup</code> from the <span class="strong"><strong>Hierarchy</strong></span> panel over <code class="literal">heart</code> in the <code class="literal">Prefabs</code> folder in the <span class="strong"><strong>Project</strong></span> panel. The prefab should <a id="id1364" class="indexterm"></a>now turn blue and have a copy of all of the pickup GameObject's properties and components.</p></li><li><p>Add a new tag <code class="literal">Key</code> in the Inspector. Select GameObject's <code class="literal">pickup</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel and assign it this tag <code class="literal">Key</code>. Also, drag from the <span class="strong"><strong>Project</strong></span> panel (folder <code class="literal">Sprites</code>) image <span class="strong"><strong>icon_key_green_100</strong></span> into the Sprite property of GameObject's <code class="literal">pickup</code> so that the player sees the key image on screen for this pickup item.</p></li><li><p>Populate the <code class="literal">key</code> prefab by dragging GameObject <code class="literal">pickup</code> from the <span class="strong"><strong>Hierarchy</strong></span> panel over <code class="literal">key</code> in the <code class="literal">Prefabs</code> folder in the <span class="strong"><strong>Project</strong></span> panel. The prefab should now turn blue and have a copy of all of the pickup GameObject's properties and components.</p></li><li><p>Delete GameObject's <code class="literal">pickup</code> from the <span class="strong"><strong>Hierarchy</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, create a new folder named <code class="literal">Editor</code>. Inside this new folder, create a new C# script class named <code class="literal">ObjectBuilderEditor</code>, with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEditor;

[CustomEditor(typeof(ObjectBuilderScript))]
public class ObjectBuilderEditor : Editor{
  private Texture iconStar;
  private Texture iconHeart;
  private Texture iconKey;

  private GameObject prefabHeart;
  private GameObject prefabStar;
  private GameObject prefabKey;

  void OnEnable () {
    iconStar = Resources.LoadAssetAtPath("Assets/EditorSprites/icon_star_32.png", typeof(Texture)) as Texture;
    iconHeart = Resources.LoadAssetAtPath("Assets/EditorSprites/icon_heart_32.png", typeof(Texture)) as Texture;
    iconKey = Resources.LoadAssetAtPath("Assets/EditorSprites/icon_key_green_32.png", typeof(Texture)) as Texture;

    prefabStar = Resources.LoadAssetAtPath("Assets/Prefabs/star.prefab", typeof(GameObject)) as GameObject;
    prefabHeart = Resources.LoadAssetAtPath("Assets/Prefabs/heart.prefab", typeof(GameObject)) as GameObject;
    prefabKey = Resources.LoadAssetAtPath("Assets/Prefabs/key.prefab", typeof(GameObject)) as GameObject;
  }

  public override void OnInspectorGUI(){
    ObjectBuilderScript myScript = (ObjectBuilderScript)target;

    GUILayout.Label("");
    GUILayout.BeginHorizontal();
    GUILayout.FlexibleSpace();
    GUILayout.Label("Click button to create instance of prefab");
    GUILayout.FlexibleSpace();
    GUILayout.EndHorizontal();
    GUILayout.Label("");

    GUILayout.BeginHorizontal();
    GUILayout.FlexibleSpace();
    if(GUILayout.Button(iconStar)) myScript.AddObjectToScene(prefabStar);
    GUILayout.FlexibleSpace();
    if(GUILayout.Button(iconHeart)) myScript.AddObjectToScene(prefabHeart);
    GUILayout.FlexibleSpace();
    if(GUILayout.Button(iconKey)) myScript.AddObjectToScene(prefabKey);
    GUILayout.FlexibleSpace();
    GUILayout.EndHorizontal();

  }
}</pre></div></li><li><p>Our Editor script is expecting to find the three icons in a folder named <code class="literal">EditorSprites</code>, so let's do this. First create a new folder named <code class="literal">EditorSprites</code>. Next drag the three 32 x 32 pixel icons from the <code class="literal">Sprites</code> folder into this <a id="id1365" class="indexterm"></a>new <code class="literal">EditorSprites</code> folder. Our Editor script should now be able to load these<a id="id1366" class="indexterm"></a> icons for image-based buttons that it will be drawing in the Inspector, from which the user chooses which pickup prefab object to clone into the scene.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_12_56.jpg" /></div></li><li><p>From the <span class="strong"><strong>Project</strong></span> panel, drag sprite <span class="strong"><strong>cross_hairs.fw</strong></span> into the <span class="strong"><strong>Scene</strong></span>. Rename this gameObject <code class="literal">object-creator-cross-hairs,</code> and in its <span class="strong"><strong>Sprite Renderer</strong></span> component in the <span class="strong"><strong>Inspector,</strong></span> set <span class="strong"><strong>Sorting Layer</strong></span> to <span class="strong"><strong>Foreground</strong></span>.</p></li><li><p>Attach the following C# script to GameObject <code class="literal">object-creator-cross-hairs</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ObjectBuilderScript : MonoBehaviour {
  void Awake(){
    gameObject.SetActive(false);
  }

  public void AddObjectToScene(GameObject prefabToCreateInScene){
    GameObject newGO = (GameObject)Instantiate(prefabToCreateInScene, transform.position, Quaternion.identity);
    newGO.name = prefabToCreateInScene.name;
  }
}</pre></div></li><li><p>Select the <span class="strong"><strong>Rect Tool</strong></span> (shortcut key <span class="emphasis"><em>T</em></span>), and as you drag gameObject <code class="literal">object-creator-cross-hairs</code> and click on the desired icon in the <span class="strong"><strong>Inspector</strong></span>, new pickup GameObjects will be added to the scene's <span class="strong"><strong>Hierarchy</strong></span>.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl2sec413"></a>How it works...</h3></div></div></div><p>The script class <code class="literal">ObjectBuilderScript</code> has just two methods, one of which has just one statement—the <code class="literal">Awake()</code> method simply makes this GameObject become inactive when the game is running (since we don't want the user to see our cross-hairs created tool during gameplay). The<a id="id1367" class="indexterm"></a> <code class="literal">AddObjectToScene(…)</code> method receives a reference to a prefab as a parameter and instantiates a new clone of the prefab in the scene at the location of GameObject <code class="literal">object-creator-cross-hairs</code> at that point in time.</p><p>Script class <code class="literal">ObjectBuilderEditor</code> has a C# attribute <code class="literal">[CustomEditor(typeof(ObjectBuilderScript))]</code> immediately before the class is declared, telling Unity to use this class to control how <code class="literal">ObjectBuilderScript</code> GameObject properties and components are shown to the user in the <span class="strong"><strong>Inspector</strong></span>.</p><p>There are six variables, three<a id="id1368" class="indexterm"></a> textures for the icons to form the buttons in the Inspector, and three GameObject references to the prefabs of which instances will be created. The <code class="literal">OnEnable()</code> method assigns values to these six variables using the built-in method <code class="literal">Resources.LoadAssetAtPath()</code>, retrieving the icons from the <span class="strong"><strong>Project</strong></span> folder <code class="literal">EditorSprites</code> and getting references to the prefabs in the <span class="strong"><strong>Project</strong></span> folder <code class="literal">Prefabs</code>.</p><p>The <code class="literal">OnInspectorGUI()</code> method has a variable <code class="literal">myScript</code>, which is set to be a reference to the instance of scripted component<code class="literal"> ObjectBuilderScript</code> in GameObject <code class="literal">object-creator-cross-hairs</code> (so we can call its method when a prefab has been chosen). The method then displays a<a id="id1369" class="indexterm"></a> mixture of empty text <code class="literal">Labels</code> (to get some vertical spacing) and <code class="literal">FlexibleSpace</code> (to get some horizontal spacing and centering) and displays three buttons to the user, with icons of star, heart, and key. The scripted GUI technique for Unity custom <span class="strong"><strong>Inspector</strong></span> GUIs wraps an <code class="literal">if</code> statement around each button, and on the frame the user clicks the button, the statement block of the <code class="literal">if</code> statement will be executed. When any of the three buttons is clicked, a call is made to <code class="literal">AddObjectToScene(…)</code> of scripted component<code class="literal"> ObjectBuilderScript</code>, passing the prefab corresponding to the button that was clicked.</p></div></div>