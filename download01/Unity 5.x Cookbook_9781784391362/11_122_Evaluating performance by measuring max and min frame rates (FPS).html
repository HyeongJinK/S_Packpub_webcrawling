<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec119"></a>Evaluating performance by measuring max and min frame rates (FPS)</h2></div></div><hr /></div><p>
<span class="strong"><strong>Optimization principal 4</strong></span>: Use performance data to drive design and coding decisions.</p><p>A useful raw <a id="id1253" class="indexterm"></a>measurement of game performance is the<a id="id1254" class="indexterm"></a> maximum and minimum frame rate for a section of a game. In this recipe, we make use of a Creative Commons <span class="strong"><strong>Frames Per Second</strong></span> (<span class="strong"><strong>FPS</strong></span>) calculation<a id="id1255" class="indexterm"></a> script to record the maximum and minimum frame rates for a game performing mathematics calculations for each frame.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_26.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec375"></a>Getting ready</h3></div></div></div><p>For this recipe, we have provided C# script <code class="literal">FPSCounter.cs</code> in the <code class="literal">1362_11_12</code> folder. This file is the one we have modified to include the maximum and minimum values based on the<a id="id1256" class="indexterm"></a> <span class="strong"><strong>Do-It-Yourself</strong></span> (<span class="strong"><strong>DIY</strong></span>) frame rate calculation script from Annop "Nargus" Prapasapong, kindly<a id="id1257" class="indexterm"></a> published under Creative Commons on the Unify wiki at <a class="ulink" href="http://wiki.unity3d.com/index.php?title=FramesPerSecond" target="_blank">http://wiki.unity3d.com/index.php?title=FramesPerSecond</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec376"></a>How to do it...</h3></div></div></div><p>To calculate and record the maximum and minimum FPS, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start a<a id="id1258" class="indexterm"></a> new project, and import the <code class="literal">FPSCounter.cs</code> script.</p></li><li><p>Add the <code class="literal">FPSCounter </code>script class to the <span class="strong"><strong>Main Camera</strong></span>.</p></li><li><p>Add the following C# script class <code class="literal">SomeCalculations</code> to the <span class="strong"><strong>Main Camera</strong></span>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class SomeCalculations : MonoBehaviour {
  public int outerLoopIterations = 20;
  public int innerLoopMaxIterations = 100;

  void Update(){
    for(int i = 0; i &lt; outerLoopIterations; i++){
      int innerLoopIterations = Random.Range(2,innerLoopMaxIterations);
      for(int j = 0; j &lt; innerLoopIterations; j++){
        float n = Random.Range(-1000f, 1000f);
      }
    }
  }
}</pre></div></li><li><p>Run the game for 20 to 30 seconds. On the screen, you should see the current average and the maximum and minimum frame rates displayed.</p></li><li><p>Stop the game running. You should now see in the <span class="strong"><strong>Console</strong></span> a summary message <a id="id1259" class="indexterm"></a>stating the max and min frames per second, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_27.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec377"></a>How it works...</h3></div></div></div><p>The <code class="literal">SomeCalculations</code> script ensures that we make Unity do something for each frame, in that it performs lots of calculations when the <code class="literal">Update()</code> method is called for each frame. There is an outer loop (loop counter <code class="literal">i</code>) of public variable <code class="literal">outerLoopIterations</code> iterations (which we set to <code class="literal">20</code>), and an inner loop (loop counter <code class="literal">j</code>), which is a random number of iterations between 2, and the value of public variable <code class="literal">innerLoopMaxIterations</code> (which we set to <code class="literal">100</code>).</p><p>The work for the <a id="id1260" class="indexterm"></a>calculations of average <span class="strong"><strong>Frames Per Second</strong></span> (<span class="strong"><strong>FPS</strong></span>) is performed by the <code class="literal">FPSCounter </code>script, which runs coroutine method <code class="literal">FPS()</code> at the chosen frequency (which we can change in the <span class="strong"><strong>Inspector</strong></span>). Each time the <code class="literal">FPS()</code>method <a id="id1261" class="indexterm"></a>executes, it recalculates the average frames per second, updates the max and minimum values if appropriate, and, if the <span class="strong"><strong>Display While Running</strong></span> checkbox was ticked, then a <span class="strong"><strong>GUIText</strong></span> object on screen is updated with a message of the average, max, and min FPS.</p><p>Finally, the <code class="literal">OnApplicationQuit()</code> method in script class <code class="literal">FPSCounter</code> is executed when the game is terminated and prints to the console the summary max/min FPS message.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec378"></a>There's more...</h3></div></div></div><p>Some details you don't want to miss:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec97"></a>Turn off runtime display to reduce FPS processing</h4></div></div></div><p>We have<a id="id1262" class="indexterm"></a> added an option so that you can turn off the runtime display, which will reduce the processing required for the FPS calculations. You just have to un-check the <span class="strong"><strong>Display While Running</strong></span> checkbox in the <span class="strong"><strong>Inspector</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_28.jpg" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec379"></a>See also</h3></div></div></div><p>Refer to the following recipes in this chapter for more information:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="emphasis"><em>Identifying performance bottlenecks with the Unity performance Profiler</em></span>
</p></li><li style="list-style-type: disc"><p>
<span class="emphasis"><em>Identifying performance bottlenecks with Do-It-Yourself. performance profiling</em></span>
</p></li></ul></div></div></div>