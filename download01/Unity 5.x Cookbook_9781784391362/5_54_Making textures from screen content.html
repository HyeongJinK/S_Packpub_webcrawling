<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec57"></a>Making textures from screen content</h2></div></div><hr /></div><p>If you want your<a id="id450" class="indexterm"></a> game or player to take in-game snapshots and apply them as textures, this recipe will show you how. This can be very useful if you plan to implement an in-game photo gallery or display a snapshot of a past key moment at the end of a level (racing games and stunt simulations use this feature a lot). For this particular example, we will take a snapshot from within a framed region of the screen and print it on the top-right corner of the display.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec154"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared the <code class="literal">BasicScene</code> Unity package, containing a scene named <code class="literal">BasicScene</code>. The package is in the <code class="literal">1362_05_codes</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec155"></a>How to do it...</h3></div></div></div><p>To create textures from screen content, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">BasicScene</code> package into a new <span class="strong"><strong>Project</strong></span>.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, open the <span class="strong"><strong>BasicScene</strong></span> level. This is a basic scene featuring an animated character and some extra geometry. It also features a <span class="strong"><strong>Canvas</strong></span> for UI elements.</p></li><li><p>Create an <span class="strong"><strong>UI Image</strong></span> GameObject from the <span class="strong"><strong>Create</strong></span> drop-down menu on top of the <span class="strong"><strong>Hierarchy</strong></span> view (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>). Please note that it will be created as a child of the <span class="strong"><strong>Canvas</strong></span> GameObject. Then, rename it <code class="literal">frame</code>.</p></li><li><p>From the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Image (Script)</strong></span> component of the <span class="strong"><strong>frame</strong></span> GameObject and set <code class="literal">InputFieldBackground</code> as its <span class="strong"><strong>Source Image</strong></span>. This is a sprite that comes bundled with Unity, and it's already sliced for resizing purposes.</p></li><li><p>Now, from the <span class="strong"><strong>Inspector</strong></span> view, change <span class="strong"><strong>Rect Transform</strong></span> to the following values: <span class="strong"><strong>Anchors</strong></span> | <span class="strong"><strong>Min</strong></span> | <span class="strong"><strong>X</strong></span>: <code class="literal">0.25</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">0.25</code>; <span class="strong"><strong>Anchors</strong></span> | <span class="strong"><strong>Max</strong></span> | <span class="strong"><strong>X</strong></span>: <code class="literal">0.75</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">0.75</code>; <span class="strong"><strong>Pivot</strong></span> | <span class="strong"><strong>X</strong></span>: <code class="literal">0.5</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">0.5;</code> <span class="strong"><strong>Left</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Top</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Pos Z</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Right</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Bottom</strong></span>: <code class="literal">0</code>.</p></li><li><p>From the <span class="strong"><strong>Image (Script)</strong></span> component, uncheck the <span class="strong"><strong>Fill Center</strong></span> option, as shown below:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_06.jpg" /></div></li><li><p>Create an <a id="id451" class="indexterm"></a><span class="strong"><strong>UI Raw Image</strong></span> GameObject from the <span class="strong"><strong>Create</strong></span> drop-down menu on top of the <span class="strong"><strong>Hierarchy</strong></span> view (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>RawImage</strong></span>). Please note that it will be created as a child of the <span class="strong"><strong>Canvas</strong></span> GameObject. Then, rename it <code class="literal">Photo</code>.</p></li><li><p>From the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Raw Image (Script)</strong></span> component of the <span class="strong"><strong>Photo</strong></span> GameObject and set <code class="literal">None</code> as its <span class="strong"><strong>Texture</strong></span>. Also, from the top of the <span class="strong"><strong>Inspector</strong></span> view, disable the <span class="strong"><strong>Photo</strong></span> GameObject by unchecking the box on the side of its name.</p></li><li><p>Now, from the <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Rect Transform</strong></span> to the following values: <span class="strong"><strong>Width</strong></span>: <code class="literal">1</code>; <span class="strong"><strong>Height</strong></span>: <code class="literal">1</code>; <span class="strong"><strong>Anchors</strong></span> | <span class="strong"><strong>Min</strong></span> | <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">1</code>; <span class="strong"><strong>Anchors</strong></span> | <span class="strong"><strong>Max</strong></span> | <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">1</code>; <span class="strong"><strong>Pivot</strong></span> | <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">1</code>; <span class="strong"><strong>Pos X</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Pos Y</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Pos Z</strong></span>: <code class="literal">0</code> as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_07.jpg" /></div></li><li><p>We need to create a script. In the <span class="strong"><strong>Project</strong></span> view, click on the <span class="strong"><strong>Create</strong></span> drop-down menu<a id="id452" class="indexterm"></a> and choose <span class="strong"><strong>C# Script</strong></span>. Rename it <code class="literal">ScreenTexture</code> and open it in your editor.</p></li><li><p>Open your script and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.UI;
using System.Collections;

public class ScreenTexture : MonoBehaviour {
  public GameObject photoGUI;
  public GameObject frameGUI;
  public float ratio = 0.25f;

  void  Update (){
    if (Input.GetKeyUp (KeyCode.Mouse0))
      StartCoroutine(CaptureScreen());
  }

  IEnumerator  CaptureScreen (){
    photoGUI.SetActive (false);
    int sw = Screen.width;
    int sh = Screen.height;
    RectTransform frameTransform = frameGUI.GetComponent&lt;RectTransform&gt; ();
    Rect framing = frameTransform.rect;
    Vector2 pivot = frameTransform.pivot;
    Vector2 origin = frameTransform.anchorMin;
    origin.x *= sw;
    origin.y *= sh;
    float xOffset = pivot.x * framing.width;
    origin.x += xOffset;
    float yOffset = pivot.y * framing.height;
    origin.y += yOffset;
    framing.x += origin.x;
    framing.y += origin.y;
    int textWidth = (int)framing.width;
    int textHeight = (int)framing.height;
    Texture2D texture = new Texture2D(textWidth,textHeight);
    yield return new WaitForEndOfFrame();
    texture.ReadPixels(framing, 0, 0);
    texture.Apply();
    photoGUI.SetActive (true);
    Vector3 photoScale = new Vector3 (framing.width * ratio, framing.height * ratio, 1);
    photoGUI.GetComponent&lt;RectTransform&gt; ().localScale = photoScale;
    photoGUI.GetComponent&lt;RawImage&gt;().texture = texture;
  }
}</pre></div></li><li><p>Save your script and apply it to the <span class="strong"><strong>Main Camera</strong></span> GameObject within the <span class="strong"><strong>Multipurpose Camera Rig</strong></span> | <span class="strong"><strong>Pivot</strong></span> GameObject.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> <a id="id453" class="indexterm"></a>view, find the <span class="strong"><strong>Screen Texture</strong></span> component and populate the fields <span class="strong"><strong>Photo GUI </strong></span>and <span class="strong"><strong>Frame GUI</strong></span> with the GameObjects <span class="strong"><strong>Photo</strong></span> and <span class="strong"><strong>frame</strong></span> respectively:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_08.jpg" /></div></li><li><p>Play the scene. You will be able to take a snapshot of the screen (and have it displayed in the top-left corner at a quarter of the original size) by clicking the mouse button, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_09.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec156"></a>How it works...</h3></div></div></div><p>First, we created a<a id="id454" class="indexterm"></a> GUI frame from which to take a snapshot and a GUI element onto which to apply the texture. Then, we applied a script to the <span class="strong"><strong>Main Camera</strong></span> to capture the screen content and apply a new texture to it.</p><p>The script creates a new texture and captures the left mouse button being pressed, whereupon it starts a coroutine to calculate a Rect area, copy screen pixels from that area, and apply them to a texture to be displayed by the <span class="strong"><strong>photo</strong></span> GUI element, which is also resized to fit the texture.</p><p>The size of the Rect is calculated from the screen's dimensions and the frame's <span class="strong"><strong>Rect Transform</strong></span> settings, particularly its Pivot, Anchors, Width, and Height. The screen pixels are then captured by the <code class="literal">ReadPixels()</code> command, and applied to the texture, which is then applied to the <span class="strong"><strong>Raw Image</strong></span> photo, which is resized to meet the desired ratio between the photo size and the original pixels.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec157"></a>There's more...</h3></div></div></div><p>Apart from <a id="id455" class="indexterm"></a>displaying the texture as a GUI element, you can use it in other ways.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec40"></a>Applying your texture to a material</h4></div></div></div><p>You can apply your<a id="id456" class="indexterm"></a> texture to an existing object's material by adding a line similar to <code class="literal">GameObject.Find("MyObject").renderer.material.mainTexture = texture;</code> to the end of the <code class="literal">CaptureScreen</code> function.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec41"></a>Using your texture as a screenshot</h4></div></div></div><p>You can encode<a id="id457" class="indexterm"></a> your texture as a PNG image file and save it. Check out Unity's documentation on this feature at <a class="ulink" href="http://docs.unity3d.com/Documentation/ScriptReference/Texture2D.EncodeToPNG.html" target="_blank">http://docs.unity3d.com/Documentation/ScriptReference/Texture2D.EncodeToPNG.html</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec158"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The Saving screenshots from the game recipe in Chapter 10, Working with the External Resource Files and Devices</p></li></ul></div></div></div>