<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec94"></a>Making a dynamic soundtrack with Snapshots</h2></div></div><hr /></div><p>Dynamic soundtracks are the<a id="id990" class="indexterm"></a> ones that change according to what is happening to the player in the game, musically reflecting that place or moment of the character's adventure. In this recipe, we will implement a soundtrack that changes twice; the first time when entering a tunnel, and the second time when coming out of its end. To achieve this, we will use the new <span class="strong"><strong>Snapshot</strong></span> feature of the <span class="strong"><strong>Audio Mixer</strong></span>.</p><p>Snapshots are a way of saving the state of your <span class="strong"><strong>Audio Mixer</strong></span>, keeping your preferences for volume levels, audio effects, and more. We can access these states through script, creating transitions between mixes, and by bringing up the desired sonic ambience for each moment of the player's journey.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec276"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared a basic game level, contained inside the Unity package named <code class="literal">DynamicSoundtrack</code>, and two soundtrack audio clips in <code class="literal">.ogg</code> format: <code class="literal">Theme01_Percussion</code> and <code class="literal">Theme01_Synths</code>. All these files can be found in the <code class="literal">1362_09_06</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec277"></a>How to do it...</h3></div></div></div><p>To make a dynamic soundtrack, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">DynamicSoundtrack</code> package and both <code class="literal">.ogg</code> files to your Unity Project.</p></li><li><p>Open the level named <span class="strong"><strong>Dynamic</strong></span>.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add <span class="strong"><strong>Audio Mixer</strong></span> to the project. Name it <span class="strong"><strong>MusicMixer</strong></span>. Double-click on it to open the <span class="strong"><strong>Audio Mixer</strong></span> window.</p></li><li><p>From the <span class="strong"><strong>Groups</strong></span> view, highlight <span class="strong"><strong>Master</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a child to the <span class="strong"><strong>Master</strong></span><a id="id991" class="indexterm"></a> group. Name it as <span class="strong"><strong>Music</strong></span>. Then, add two child groups to <span class="strong"><strong>Music</strong></span>: <span class="strong"><strong>Percussion </strong></span>and <span class="strong"><strong>Synths</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_25.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, create a new <span class="strong"><strong>Empty</strong></span> GameObject. Name it <span class="strong"><strong>Music</strong></span>. Then, add two <span class="strong"><strong>Empty Child</strong></span> GameObjects to it. Name them as <span class="strong"><strong>Percussion</strong></span> and <span class="strong"><strong>Synth</strong></span>.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, drag the <span class="strong"><strong>Audio Clip</strong></span> named <span class="strong"><strong>Theme01_Percussion </strong></span>into the <span class="strong"><strong>Percussion</strong></span> GameObject in <span class="strong"><strong>Hierarchy</strong></span>. Select <span class="strong"><strong>Percussion</strong></span> and in the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Audio Source</strong></span> component. Change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>Percussion (MusicMixer)</strong></span>, make sure the <span class="strong"><strong>Play On Awake</strong></span> option is checked, check the <span class="strong"><strong>Loop</strong></span> option, and make sure its <span class="strong"><strong>Spatial Blend</strong></span> is set to <span class="strong"><strong>2D</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_26.jpg" /></div></li><li><p>Now, drag the <a id="id992" class="indexterm"></a><span class="strong"><strong>Theme01_Synths</strong></span> audio file into the <span class="strong"><strong>Synths</strong></span> GameObject. From the <span class="strong"><strong>Inspector</strong></span> view, change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>Synths (MusicMixer)</strong></span>, make sure the <span class="strong"><strong>Play On Awake</strong></span> option is checked, check the <span class="strong"><strong>Loop</strong></span> option, and make sure its <span class="strong"><strong>Spatial Blend</strong></span> is set to <span class="strong"><strong>2D</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_27.jpg" /></div></li><li><p>Open the <span class="strong"><strong>Audio Mixer</strong></span> and play the scene. We will now use the mixer to set the soundtrack for the start of the scene. With the scene playing, click on the <span class="strong"><strong>Edit in Play Mode</strong></span><a id="id993" class="indexterm"></a> button, as shown in the screenshot, at the top of the <span class="strong"><strong>Audio Mixer</strong></span>. Then, drop the volume on the <span class="strong"><strong>Synths</strong></span> track down to <span class="strong"><strong>-30 dB</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_28.jpg" /></div></li><li><p>Now, select the <span class="strong"><strong>Percussion</strong></span> track. Right-click on <span class="strong"><strong>Attenuation</strong></span> and add the <span class="strong"><strong>High-pass</strong></span> effect before it:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_29.jpg" /></div></li><li><p>From the<a id="id994" class="indexterm"></a> <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Cutoff frequency</strong></span> of the <span class="strong"><strong>High-pass</strong></span> effect to <span class="strong"><strong>544.00 Hz</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_30.jpg" /></div></li><li><p>Every change, so far, has been assigned to the current <span class="strong"><strong>Snapshot</strong></span>. From the <span class="strong"><strong>Snaphots</strong></span> view, right-click on the current <span class="strong"><strong>Snapshot</strong></span> and rename it to <span class="strong"><strong>Start</strong></span>. Then, right-click on <span class="strong"><strong>Start</strong></span> and select the <span class="strong"><strong>Duplicate</strong></span> option. Rename the new snapshot as <span class="strong"><strong>Tunnel</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_31.jpg" /></div></li><li><p>Select the <span class="strong"><strong>Tunnel</strong></span> snapshot. Then, from the <span class="strong"><strong>Inspector</strong></span> view, change the <span class="strong"><strong>Cutoff frequency</strong></span> of the <span class="strong"><strong>Highpass</strong></span> effect to <span class="strong"><strong>10.00 Hz</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_32.jpg" /></div></li><li><p>Switch<a id="id995" class="indexterm"></a> between the <span class="strong"><strong>Tunnel</strong></span> and <span class="strong"><strong>Start</strong></span> snapshots. You'll be able to hear the difference.</p></li><li><p>Duplicate the <span class="strong"><strong>Tunnel</strong></span> snapshot, rename it as <span class="strong"><strong>OtherSide</strong></span>, and select it.</p></li><li><p>Raise the volume of the <span class="strong"><strong>Synths</strong></span> track up to <span class="strong"><strong>0 dB</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_33.jpg" /></div></li><li><p>Now that we have our three <span class="strong"><strong>Snapshots</strong></span>, it's time to create triggers to make transitions among them. From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add a <span class="strong"><strong>Cube</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Cube</strong></span>).</p></li><li><p>Select the new <a id="id996" class="indexterm"></a><span class="strong"><strong>Cube</strong></span> and rename it <code class="literal">SnapshotTriggerTunnel</code>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Box Collider</strong></span> component and check the <span class="strong"><strong>Is Trigger</strong></span> option, as shown in the following screenshot. Also, uncheck its <span class="strong"><strong>Mesh Renderer</strong></span> component. Finally, adjust its size and position to the scene tunnel's interior:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_34.jpg" /></div></li><li><p>Make two copies of <code class="literal">SnapshotTriggerTunnel</code> and rename them to <code class="literal">SnapshotTriggerStart</code> and <code class="literal">SnapshotTriggerOtherSide</code>. Then, adjust their size and position, so that they occupy the areas before the tunnel's entrance (where the character is) and after its other end, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_35.jpg" /></div></li><li><p>In the <span class="strong"><strong>Project</strong></span> <a id="id997" class="indexterm"></a>view, create a new <span class="strong"><strong>C# Script</strong></span> file and rename it to <code class="literal">SnapshotTrigger</code>.</p></li><li><p>Open the script in your editor and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.Audio;
using System.Collections;

public class SnapshotTrigger : MonoBehaviour{
  public AudioMixerSnapshot snapshot;
  public float crossfade;

  private void OnTriggerEnter(Collider other){
    snapshot.TransitionTo (crossfade);
  }
}</pre></div></li><li><p>Save your script and attach it to <code class="literal">SnapshotTriggerTunnel</code>, <code class="literal">SnapshotTriggerStart</code>, and <code class="literal">SnapshotTriggerOtherSide</code> objects.</p></li><li><p>Select <code class="literal">SnapshotTriggerTunnel</code>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Snapshot Trigger</strong></span> component, setting <span class="strong"><strong>Snapshot</strong></span> as <span class="strong"><strong>Tunnel</strong></span>, and <span class="strong"><strong>Crossfade</strong></span> as <code class="literal">2</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_36.jpg" /></div></li><li><p>Make changes to <code class="literal">SnapshotTriggerStart</code> and <code class="literal">SnapshotTriggerOtherSide</code> by setting their <span class="strong"><strong>Snapshots</strong></span> to <span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>OtherSide</strong></span> respectively.</p></li><li><p>Test the scene. The <a id="id998" class="indexterm"></a>background music will change as the character moves from its starting point, through the tunnel, and into the other side.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec278"></a>How it works...</h3></div></div></div><p>The <span class="strong"><strong>Snapshot</strong></span> feature allows you to save <span class="strong"><strong>Audio Mixer</strong></span> states (including all volume levels, every filter setting, and so on) so that you can change those mixing preferences at runtime, making the audio design more suitable for specific locations or gameplay settings. For this recipe, we have created three <span class="strong"><strong>Snapshots</strong></span> for different moments in the player's journey: before entering the tunnel, inside the tunnel, and outside the tunnel. We have used the <span class="strong"><strong>Highpass</strong></span> filter to make the initial Snapshot less intense. We have also turned the <span class="strong"><strong>Synths</strong></span> track volume up to emphasize the open environment outside the tunnel. Hopefully, changes in the audio mix will collaborate with setting the right mood for the game.</p><p>To activate our snapshots, we have placed <span class="strong"><strong>trigger colliders</strong></span>, featuring our <span class="strong"><strong>Snapshot Trigger</strong></span> component in which we set the desired Snapshot and the time in seconds, that it takes to make the transition (a crossfade) between the previous Snapshot and the next. In fact, the function in<a id="id999" class="indexterm"></a> our script is really this straightforward—the line of <code class="literal">snapshot.TransitionTo (crossfade)</code> code simply starts a transition lasting <code class="literal">crossfade</code> seconds to the desired <code class="literal">Snapshot</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec279"></a>There's more...</h3></div></div></div><p>Here is some information on how to fine-tune and customize this recipe.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec70"></a>Reducing the need for multiple audio clips</h4></div></div></div><p>You might have <a id="id1000" class="indexterm"></a>noticed how different the <code class="literal">Theme01_Percussion</code> audio clip sounds when the <span class="strong"><strong>Cutoff frequency</strong></span> of the <span class="strong"><strong>High-pass</strong></span> filter is set as <code class="literal">10.00 Hz</code>. The reason for this is that the high-pass filter, as its name suggests, cuts off lower frequencies of the audio signal. In this case, it attenuated the bass drum down to inaudible levels while keeping the shakers audible. The opposite effect can be achieved through the <span class="strong"><strong>Lowpass</strong></span> filter. A major benefit is the opportunity of virtually having two separate tracks into the same audio clip.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec71"></a>Dealing with audio file formats and compression rates</h4></div></div></div><p>To avoid loss of<a id="id1001" class="indexterm"></a> audio quality, you should import your<a id="id1002" class="indexterm"></a> sound clips using the appropriate file format, depending upon your target platform. If you are not sure which format to use, please check out Unity's documentation on the subject at <a class="ulink" href="http://docs.unity3d.com/Manual/AudioFiles.html" target="_blank">http://docs.unity3d.com/Manual/AudioFiles.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec72"></a>Applying Snapshots to background noise</h4></div></div></div><p>Although we have applied Snapshots to our music soundtrack, background noise can also benefit immensely. If <a id="id1003" class="indexterm"></a>your character travels across places that are significantly different, transitioning from open spaces to indoor environments, you should consider applying snapshots to your environment audio mix. Be careful, however, to create separate Audio Mixers for Music and Environment—unless you don't mind having musical and ambient sound tied to the same Snapshot.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec73"></a>Getting creative with effects</h4></div></div></div><p>In this recipe, we have<a id="id1004" class="indexterm"></a> mentioned the High-pass and Low-pass filters. However, there are many effects that can make audio clips sound radically different. Experiment! Try applying effects such as Distortion, Flange, and Chorus. In fact, we encourage you to try every effect, playing with their settings. The creative use of these effects can bring out different expressions to a single audio clip.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec280"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Adding volume control with Audio Mixers</em></span> recipe in this chapter</p></li><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Balancing soundtrack volume with Ducking</em></span> recipe<a id="id1005" class="indexterm"></a> in this chapter</p></li></ul></div></div></div>