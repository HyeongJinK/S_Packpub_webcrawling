<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec35"></a>Generalizing multiple icon displays using UI Grid Layout Groups (with scrollbars!)</h2></div></div><hr /></div><p>The recipes in this chapter up to this point have been hand-crafted for each situation. While this is fine, more<a id="id243" class="indexterm"></a> general and automated approaches to inventory UIs can sometimes save time and effort but still achieve visual and usability results of equal quality. In the next recipe, we will begin to explore a more engineered approach to inventory UIs by exploiting the automated sizing and layouts offered by Unity 5's Grid Layout Group component.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_20.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec91"></a>Getting ready</h3></div></div></div><p>This recipe assumes that you are starting with the project <code class="literal">Simple2Dgame_SpaceGirl</code> setup from the first recipe in this chapter. The font you need can be found in the <code class="literal">1362_02_02 </code>folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec92"></a>How to do it...</h3></div></div></div><p>To display grey<a id="id244" class="indexterm"></a> and yellow star icons for multiple object pickups using UI grid layout groups, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Start with a new copy of the mini-game <code class="literal">Simple2Dgame_SpaceGirl</code>.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, create a UI Panel <code class="literal">Panel–background </code>(<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>).</p></li><li><p>Let's now position <code class="literal">Panel–background </code>at the <span class="strong"><strong>top </strong></span>of the <span class="strong"><strong>Game</strong></span> panel, stretching the horizontal width of the canvas. Edit the UI <span class="strong"><strong>Image's Rect Transform</strong></span> component, and while holding down <span class="emphasis"><em>SHIFT</em></span> and <span class="emphasis"><em>ALT</em></span> (to set pivot and position), choose the top-stretch box. </p></li><li><p>The panel will still be taking up the whole game window. So, now in the <span class="strong"><strong>Inspector</strong></span> panel, change the <span class="strong"><strong>Height</strong></span> (in the <span class="strong"><strong>Rect Transform</strong></span> component) of <code class="literal">Panel–background </code>to 100, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_21.jpg" /></div></li><li><p>Add a UI <span class="strong"><strong>Text</strong></span> object (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Text</strong></span>), rename it <code class="literal">Text-inventory</code>, and change its text to <span class="strong"><strong>Inventory</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, child this UI Text object to panel <code class="literal">Panel–background</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, also set the font of <code class="literal">Text-inventory</code> to <span class="strong"><strong>Xolonium-Bold</strong></span> (the <code class="literal">Fonts</code> folder). Center the text horizontally, top align the text vertically, set its <span class="strong"><strong>Height</strong></span> to <code class="literal">50</code>, and set the <span class="strong"><strong>Font Size</strong></span> to <code class="literal">23</code>.</p></li><li><p>Edit the <span class="strong"><strong>Rect Transform</strong></span> of <code class="literal">Text-inventory</code>, and while holding down <span class="emphasis"><em>SHIFT</em></span> and <span class="emphasis"><em>ALT</em></span> (to set pivot and position), choose the top-stretch box. The text should now be positioned at the middle top of the <span class="strong"><strong>UI Panel</strong></span> <code class="literal">Panel–background</code> <a id="id245" class="indexterm"></a>and its width should stretch to match that of the whole panel.</p></li><li><p>Select the <span class="strong"><strong>Canvas</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> panel and add a new UI Panel object (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>). Rename it <code class="literal">Panel-slot-grid</code>.</p></li><li><p>Position <code class="literal">Panel-slot-grid</code> at the <span class="strong"><strong>top </strong></span>of the <span class="strong"><strong>Game</strong></span> panel, stretching the horizontal width of the canvas. Edit the UI <span class="strong"><strong>Image's Rect Transform</strong></span> component, and while holding down <span class="emphasis"><em>SHIFT</em></span> and <span class="emphasis"><em>ALT</em></span> (to set pivot and position), choose the top-stretch box. </p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> panel, change the <span class="strong"><strong>Height</strong></span> (in the <span class="strong"><strong>Rect Transform</strong></span> component) of <code class="literal">Panel-slot-grid</code> to <code class="literal">80</code> and set its <span class="strong"><strong>Top</strong></span> to <code class="literal">20</code> (so it is below UI <span class="strong"><strong>Text</strong></span> GameObject <code class="literal">Text-inventory</code>).</p></li><li><p>With the panel <code class="literal">Panel-slot-grid</code> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, add a grid layout group component (<span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Layout</strong></span> | <span class="strong"><strong>Grid Layout Group</strong></span>). Set <span class="strong"><strong>Cell Size</strong></span> to <code class="literal">70</code> x <code class="literal">70</code> and <span class="strong"><strong>Spacing</strong></span> to <code class="literal">5</code> x <code class="literal">5</code>. Also, set the <span class="strong"><strong>Child Alignment</strong></span> to <span class="strong"><strong>Middle Center</strong></span> (so our icons will have even spacing at the far left and right), as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_22.jpg" /></div></li><li><p>With the panel <code class="literal">Panel-slot-grid</code> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, add a mask (script) component (<span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Mask</strong></span>). Uncheck the option <span class="strong"><strong>Show Mask Graphic</strong></span>. Having this mask component means that any overflow of our grid will NOT be seen by the user—only content within the image area of the panel <code class="literal">Panel-slot-grid</code> will ever be visible.</p></li><li><p>Add to your <a id="id246" class="indexterm"></a><span class="strong"><strong>Canvas</strong></span> a UI <span class="strong"><strong>Image</strong></span> object (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span>). Rename it <code class="literal">Image-slot</code>.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, child UI <span class="strong"><strong>Image</strong></span> object <code class="literal">Image-slot</code> to panel <code class="literal">Panel–slot-grid</code>.</p></li><li><p>Set the <span class="strong"><strong>Source Image</strong></span> of <code class="literal">Image-slot</code> to the Unity provided <span class="strong"><strong>Knob</strong></span> (circle) image, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_23.jpg" /></div></li><li><p>Since <code class="literal">Image-slot</code> is the only UI object inside <code class="literal">Panel-slot-grid,</code> it will be displayed (sized 70 x 70) in center in that panel, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_24.jpg" /></div></li><li><p>Each image slot will have a yellow star child image and a grey star child image. Let's<a id="id247" class="indexterm"></a> create those now.</p></li><li><p>Add to your <span class="strong"><strong>Canvas</strong></span> a UI <span class="strong"><strong>Image</strong></span> object (<span class="strong"><strong>Create | UI | Image</strong></span>). Rename it  <code class="literal">Image-star-yellow</code>.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, child UI <span class="strong"><strong>Image</strong></span> object <code class="literal">Image-star-yellow</code> to image <code class="literal">Image–slot</code>.</p></li><li><p>Set the <span class="strong"><strong>Source Image</strong></span> of <code class="literal">Image-star-yellow</code> to the <code class="literal">icon_star_100</code> image (in folder <code class="literal">Sprites</code>).</p></li><li><p>Now we will set our yellow star icon image to fully fill its parent <code class="literal">Image-slot</code> by stretching horizontally and vertically. Edit the UI <span class="strong"><strong>Image's Rect Transform</strong></span> component, and while holding down <span class="emphasis"><em>SHIFT</em></span> and <span class="emphasis"><em>ALT</em></span> (to set pivot and position), choose the bottom right option to fully <span class="strong"><strong>stretch</strong></span> horizontally and vertically. The UI <span class="strong"><strong>Image</strong></span> <code class="literal">Image-star-yellow</code> should now be visible in the middle of the <code class="literal">Image-slot </code>circular <span class="strong"><strong>Knob</strong></span> image, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_25.jpg" /></div></li><li><p>Duplicate <code class="literal">Image-star-yellow</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel, naming the copy <code class="literal">Image-star-grey</code>. This new GameObject should also be a child of <code class="literal">Image-slot</code>.</p></li><li><p>Change the <span class="strong"><strong>Source Image</strong></span> of <code class="literal">Image-star-grey</code> to the <code class="literal">icon_star_grey_100</code> image (in folder <code class="literal">Sprites</code>). At any time, our inventory slot can now display nothing, a yellow star icon, or a grey star icon, depending on whether <code class="literal">Image-star-yellow</code> and <code class="literal">Image-star-grey</code> are enabled<a id="id248" class="indexterm"></a> or not: we'll control this through the inventory display code later in this recipe.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, ensure that <code class="literal">Image-slot</code> is selected, and add the C# Script <code class="literal">PickupUI</code> with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PickupUI : MonoBehaviour {
  public GameObject starYellow;
  public GameObject starGrey;

  void Awake(){
    DisplayEmpty();
  }

  public void DisplayYellow(){
    starYellow.SetActive(true);
    starGrey.SetActive(false);
  }

  public void DisplayGrey(){
    starYellow.SetActive(false);
    starGrey.SetActive(true);
  }
  
  public void DisplayEmpty(){
    starYellow.SetActive(false);
    starGrey.SetActive(false);
  }
}</pre></div></li><li><p>With the GameObject <code class="literal">Image-slot</code> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag each of its two children <code class="literal">Image-star-yellow</code> and<code class="literal"> Image-star-grey</code> into their corresponding <span class="strong"><strong>Inspector</strong></span> panel <span class="strong"><strong>Pickup UI</strong></span> slots <span class="strong"><strong>Star Yellow</strong></span> and <span class="strong"><strong>Star Grey</strong></span>, as shown in<a id="id249" class="indexterm"></a> the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_27.jpg" /></div></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, make nine duplicates of <code class="literal">Image-slot</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel; they should automatically be named <code class="literal">Image-slot 1 .. 9</code>. See the following screenshot to ensure the Hierarchy of your Canvas is correct—the parenting of <code class="literal">Image-slot</code> as a child of <code class="literal">Image-slot-grid</code>, and the parenting of <code class="literal">Image-star-yellow</code> and<code class="literal"> Image-star-grey</code> as children of each <code class="literal">Image-slot</code> is very important.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_26.jpg" /></div></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, ensure that <code class="literal">player-SpaceGirl</code> is selected, and add the C# script<a id="id250" class="indexterm"></a> <code class="literal">Player</code> with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class Player : MonoBehaviour {
  private PlayerInventoryModel playerInventoryModel;

  void Start(){
    playerInventoryModel = GetComponent&lt;PlayerInventoryModel&gt;();
  }
  
  void OnTriggerEnter2D(Collider2D hit){
    if(hit.CompareTag("Star")){
      playerInventoryModel.AddStar();
      Destroy(hit.gameObject);
    }
  }
}</pre></div></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, ensure that <code class="literal">player-SpaceGirl</code> is selected, and add the C# script <code class="literal">PlayerInventoryModel</code> with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class PlayerInventoryModel : MonoBehaviour {
  private int starTotal = 0;
  private PlayerInventoryDisplay playerInventoryDisplay;
  
  void Start(){
    playerInventoryDisplay = GetComponent&lt;PlayerInventoryDisplay&gt;();
    playerInventoryDisplay.OnChangeStarTotal(starTotal);
  }
  
  public void AddStar(){
    starTotal++;
    playerInventoryDisplay.OnChangeStarTotal(starTotal);
  }
}</pre></div></li><li><p>In the<a id="id251" class="indexterm"></a> <span class="strong"><strong>Hierarchy</strong></span> panel, ensure that <code class="literal">player-SpaceGirl</code> is selected, and add the C# script <code class="literal">PlayerInventoryDisplay</code> with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  const int NUM_INVENTORY_SLOTS = 10;
  public PickupUI[] slots = new PickupUI[NUM_INVENTORY_SLOTS];

  public void OnChangeStarTotal(int starTotal){
    for(int i = 0; i &lt; NUM_INVENTORY_SLOTS; i++){
      PickupUI slot = slots[i];
      if(i &lt; starTotal)
        slot.DisplayYellow();
      else
        slot.DisplayGrey();
    }
  }
}</pre></div></li><li><p>With GameObject <code class="literal">player-SpaceGirl</code> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag the ten <code class="literal">Image-slot </code>GameObjects into their corresponding locations in the <span class="strong"><strong>Player Inventory Display (Script)</strong></span> component array <span class="strong"><strong>Slots</strong></span>, in the <span class="strong"><strong>Inspector</strong></span> panel, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_28.jpg" /></div></li><li><p>Save the scene and play the game. As you pick up stars, you should see more of the grey stars change to yellow in the inventory display.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec93"></a>How it works...</h3></div></div></div><p>We have created a simple panel (<code class="literal">Panel-background</code>) and text at the top of the game canvas—showing<a id="id252" class="indexterm"></a> a greyish background rectangle and text "Inventory". We created a small panel inside this area (<code class="literal">Panel-slot-grid</code>), with a grid layout group component, which automatically sizes and lays out the 10 <code class="literal">Image-slot</code> GameObjects we created with the knob (circle) source image. By adding a mask component to <code class="literal">Panel-slot-grid</code>, we ensure that no content will overflow outside of the rectangle of the source image for this panel.</p><p>Each of the 10 <code class="literal">Image-slot</code> GameObjects that are children of <code class="literal">Panel-slot-grid</code> contains a yellow star image and a grey star image. Also, each <code class="literal">Image-slot</code> GameObjects has a script component <code class="literal">PickupUI</code>. The <code class="literal">PickupUI</code> script offers three public methods, which will show just the yellow star image, just the grey star image, or neither (so, an empty knob circle image will be seen).</p><p>Our player's character GameObject <code class="literal">player-SpaceGirl</code> has a very simple basic <code class="literal">Player</code> script—this just detected collisions with objects tagged <code class="literal">Star</code>, and when this happens, it removes the star GameObject collided with and calls the <code class="literal">AddStar()</code> method to its <code class="literal">playerInventoryModel</code> scripted component. The <code class="literal">PlayerInventoryModel</code> C# script class maintains a running integer total of the number of stars added to the inventory. Each time the <code class="literal">AddStar()</code> method is called, it increments (adds 1) to this total, and then calls the <code class="literal">OnChangeStarTotal(…)</code> method of scripted component <code class="literal">playerInventoryDisplay</code>. Also, when the scene starts, an initial call is made to the <code class="literal">OnChangeStarTotal(…)</code> method so that the UI display for the inventory is set up to show that we are initially carrying no stars.</p><p>The C# script class <code class="literal">PlayerInventoryDisplay</code> has two properties: one is a constant integer defining the number of slots in our inventory, which for this game we set to 10, and the other variable is an array of references to <code class="literal">PickupUI</code> scripted components—each of these is a reference to the scripted component in each of the 10 <code class="literal">Image-slot</code> GameObjects in our <code class="literal">Panel-slot-grid</code>. When the <code class="literal">OnChangeStarTotal(…)</code> method is passed the number of stars we are carrying, it loops through each of the 10 slots. While the current slot is less than our star total, a yellow star is displayed, by the calling of the <code class="literal">DisplayYellow()</code> method of the current slot (<code class="literal">PickupUI</code> scripted component). Once the loop counter is equal to or larger than our star total, then all remaining slots are made to display a grey star via the calling of method <code class="literal">DisplayGrey()</code>.</p><p>This recipe is an<a id="id253" class="indexterm"></a> example of the<a id="id254" class="indexterm"></a> <span class="strong"><strong>low coupling</strong></span> of the MVC design pattern. We have designed our code to not rely or make too many assumptions about other parts of the game so that the chances of a change in some other part of our game breaking our inventory display code are much smaller. The display (view) is separated from the logical representation of what we are carrying (model), and changes to the model are made by public methods called from the player (controller).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note26"></a>Note</h3><p>Note: It might seem that we could make our code simpler by assuming that slots are always displaying grey (no star) and just changing one slot to yellow each time a yellow star is picked up. But this would lead to problems if something happens in the game (for example, hitting a black hole or being shot by an alien) that makes us drop one or more stars. C# script class <code class="literal">PlayerInventoryDisplay</code> makes no assumptions about which slots may or may not have been displayed grey or yellow or empty previously—each time it is called, it ensures that an appropriate number of yellow stars are displayed, and all other slots are displayed with grey stars.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec94"></a>There's more...</h3></div></div></div><p>Some details you don't want to miss:</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec20"></a>Add a horizontal scrollbar to the inventory slot display</h4></div></div></div><p>We can see 10 inventory slots now—but what if there are many more? One solution is to add a scroll bar so<a id="id255" class="indexterm"></a> that the user can scroll left and right, viewing 10 at a time, as shown in the following screenshot. Let's add a horizontal scroll bar to our game. This can be achieved without any C# code changes, all through the Unity 5 UI system.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_35.jpg" /></div><p>To implement a horizontal scrollbar for our inventory display, we need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Increase the height of <code class="literal">Panel-background</code> to 130 pixels.</p></li><li><p>In the <span class="strong"><strong>Inspector </strong></span>panel, set the <span class="strong"><strong>Child Alignment</strong></span> property of component <span class="strong"><strong>Grid Layout Group (Script) </strong></span>of <code class="literal">Panel-slot-grid</code> to Upper Left. Then, move this panel to the right a little so that the 10 inventory icons are centered on screen.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, duplicate Image-slot 9 three more times so that there are now 13 inventory icons in <code class="literal">Panel-slot-grid</code>.</p></li><li><p>In the <span class="strong"><strong>Scene</strong></span> panel, drag the right-hand edge of panel <code class="literal">Panel-slot-grid</code> to make it wide enough so that all 13 inventory icons fit horizontally—of course the last three will be off screen, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_33.jpg" /></div></li><li><p>Add a UI <span class="strong"><strong>Panel</strong></span> to the <span class="strong"><strong>Canvas</strong></span> and name it <code class="literal">Panel-scroll-container</code>, and tint it red by setting the <span class="strong"><strong>Color</strong></span> property of its <span class="strong"><strong>Image (Script)</strong></span> component to red.</p></li><li><p>Size and position <code class="literal">Panel-scroll-container</code> so that it is just behind our <code class="literal">Panel-slot-grid</code>. So, you should now see a red rectangle behind the 10 inventory circle slots.</p></li><li><p>In the <span class="strong"><strong>Hierarchy </strong></span>panel, drag <code class="literal">Panel-slot-grid</code> so that it is now childed to <code class="literal">Panel-scroll-container</code>.</p></li><li><p>Add a UI <span class="strong"><strong>Mask </strong></span>to <code class="literal">Panel-scroll-container</code> so now you should only be able to see the 10 inventory icons that fit within the rectangle of this red-tinted panel.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"></a>Note</h3><p>Note: You <a id="id256" class="indexterm"></a>may wish to temporarily set this mask component as inactive so that you can see and work on the unseen parts of <code class="literal">Panel-slot-grid</code> if required.</p></div></li><li><p>Add a UI <span class="strong"><strong>Scrollbar</strong></span> to the <span class="strong"><strong>Canvas</strong></span> and name it <code class="literal">Scrollbar-horizontal</code>. Move it to be just below the 10 inventory icons, and resize it to be the same width as the red-tinted <code class="literal">Panel-scroll-container</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_32.jpg" /></div></li><li><p>Add a UI <span class="strong"><strong>Scroll Rect</strong></span> component to <code class="literal">Panel-scroll-container</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector </strong></span>panel, drag <code class="literal">Scrolbar-horizontal</code> to the Horizontal Scrollbar property of the <span class="strong"><strong>Scroll Rect</strong></span> component of <code class="literal">Panel-scroll-container</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector </strong></span>panel, drag <code class="literal">Panel-slot-grid</code> to the Content property of the <span class="strong"><strong>Scroll Rect</strong></span> component of <code class="literal">Panel-scroll-container</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_34.jpg" /></div></li><li><p>Now, ensure the <span class="strong"><strong>mask</strong></span> component of <code class="literal">Panel-scroll-container</code> is set as active so that we don't see the overflow of <code class="literal">Panel-slot-grid</code> and uncheck this <span class="strong"><strong>mask</strong></span> components option to <span class="strong"><strong>Show Mask Graphic</strong></span> (so that we don't see the red rectangle any more).</p></li></ol></div><p>You should now have a working scrollable inventory system. Note that the last three new icons will just be empty circles, since the inventory display script does not have references to, or attempt to<a id="id257" class="indexterm"></a> make, any changes to these extra three slots; so the script code would need to be changed to reflect every additional slot we add to <code class="literal">Panel-slot-grid</code>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec21"></a>The automation of PlayerInventoryDisplay getting references to all the slots</h4></div></div></div><p>There was a lot of dragging slots from the <span class="strong"><strong>Hierarchy</strong></span> panel into the array for the scripted component <code class="literal">PlayerInventoryDisplay</code>. This takes a bit of work (and mistakes might be made when dragging items<a id="id258" class="indexterm"></a> in the wrong order or the same item twice). Also, if we change the number of slots, then we may have to do this all over again or try to remember to drag more slots if we increase the number, and so on. A better way of doing things is to make the first task of the script class <code class="literal">PlayerInventoryDisplay</code> when the scene begins to create each of these <code class="literal">Image-slot</code> GameObjects as a child of <code class="literal">Panel-slot-grid</code> and populate the array at the same time.</p><p>To implement the automated population of our scripted array of PickupUI objects for this recipe, we need to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new folder named <code class="literal">Prefabs</code>. In this folder, create a new empty prefab named <code class="literal">starUI</code>.</p></li><li><p>From the <span class="strong"><strong>Hierarchy </strong></span>panel<span class="strong"><strong>,</strong></span> drag the GameObject <code class="literal">Image-slot</code> into your new empty prefab named <code class="literal">starUI</code>. This prefab should now turn blue, showing it is populated.</p></li><li><p>In the <span class="strong"><strong>Hierarchy </strong></span>panel<span class="strong"><strong>,</strong></span> delete GameObject <code class="literal">Image-slot</code> and all its copies<code class="literal"> Image-slot 1 – 9</code>.</p></li><li><p>Replace C# Script <code class="literal">PlayerInventoryDisplay</code> in GameObject <code class="literal">player-SpaceGirl</code> with<a id="id259" class="indexterm"></a> the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class PlayerInventoryDisplay : MonoBehaviour
{
  const int NUM_INVENTORY_SLOTS = 10;
  private PickupUI[] slots = new PickupUI[NUM_INVENTORY_SLOTS];
  public GameObject slotGrid;
  public GameObject starSlotPrefab;

  void Awake(){
    for(int i=0; i &lt; NUM_INVENTORY_SLOTS; i++){
      GameObject starSlotGO = (GameObject)
      Instantiate(starSlotPrefab);
      starSlotGO.transform.SetParent(slotGrid.transform);
      starSlotGO.transform.localScale = new Vector3(1,1,1);
      slots[i] = starSlotGO.GetComponent&lt;PickupUI&gt;();
    }
  }

  public void OnChangeStarTotal(int starTotal){
    for(int i = 0; i &lt; NUM_INVENTORY_SLOTS; i++){
     PickupUI slot = slots[i];
      if(i &lt; starTotal)
        slot.DisplayYellow();
      else
        slot.DisplayGrey();
    }
  }
}</pre></div></li><li><p>With GameObject <code class="literal">player-SpaceGirl</code> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag the GameObject <code class="literal">Panel-slot-grid </code>into <span class="strong"><strong>Player Inventory Display (Script)</strong></span> variable <span class="strong"><strong>Slot grid</strong></span>, in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>With GameObject <code class="literal">player-SpaceGirl</code> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag from the <span class="strong"><strong>Project</strong></span> panel prefab <code class="literal">starUI</code> into <span class="strong"><strong>Player Inventory Display (Script)</strong></span> variable <span class="strong"><strong>Star Slot Prefab</strong></span>, in the <span class="strong"><strong>Inspector</strong></span> panel, as shown in the following<a id="id260" class="indexterm"></a> screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_29.jpg" /></div></li></ol></div><p>The public array has been made private and no longer needs to be populated through manual drag-and-drop. When you run the game, it will play just the same as before, with the population of the array of images in our inventory grid panel now automated. The <code class="literal">Awake()</code> method creates new instances of the prefab (as many as defined by constant <code class="literal">NUM_INVENTORY_SLOTS</code>) and immediately childed them to <code class="literal">Panel-slot-grid</code>. Since we have a grid layout group component, their placement is automatically neat and tidy in our panel.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip04"></a>Tip</h3><p>Note: The scale property of the transform component of GameObjects is reset when a GameObject changes its parent (to maintain relative child size to parent size). So, it is a good idea to always reset the local scale of GameObjects to (1,1,1) immediately after they have been childed to another GameObject. We do this in the <code class="literal">for</code>-loop to <code class="literal">starSlotGO</code> immediately following the <code class="literal">SetParent(…)</code> statement.</p></div><p>Note that we use the <code class="literal">Awake() method </code>for creating the instances of the prefab in <code class="literal">PlayerInventoryDispay</code> so that we know this will be executed before the <code class="literal">Start()</code> method in <code class="literal">PlayerInventoryModel</code>—since no <code class="literal">Start()</code> method is executed until all <code class="literal">Awake()</code> methods for all<a id="id261" class="indexterm"></a> GameObjects in the scene have been completed.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec22"></a>Automatically changing the grid cell size based on the number of slots in inventory</h4></div></div></div><p>Consider a situation where we wish to change the number of slots. Another alternative to using scrollbars is to change the cell size in the <span class="strong"><strong>Grid Layout Group</strong></span> component. We can automate this through code so that the cell size is changed to ensure that <code class="literal">NUM_INVENTORY_SLOTS</code> will fit along the width of our panel at the top of the canvas.</p><p>To implement the <a id="id262" class="indexterm"></a>automated resizing of the <span class="strong"><strong>Grid Layout Group</strong></span> cell size for this recipe, we need to do the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Add the following method <code class="literal">Start()</code> to the C# Script <code class="literal">PlayerInventoryDisplay</code> in GameObject <code class="literal">player-SpaceGirl</code> with the following code:</p><div class="informalexample"><pre class="programlisting">void Start(){
  float panelWidth = slotGrid.GetComponent&lt;RectTransform&gt;().rect.width;
  print ("slotGrid.GetComponent&lt;RectTransform&gt;().rect = " + slotGrid.GetComponent&lt;RectTransform&gt;().rect);
  
  GridLayoutGroup gridLayoutGroup = slotGrid.GetComponent&lt;GridLayoutGroup&gt;();
  float xCellSize = panelWidth / NUM_INVENTORY_SLOTS;
  xCellSize -= gridLayoutGroup.spacing.x;
  gridLayoutGroup.cellSize = new Vector2(xCellSize, xCellSize);
}</pre></div><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_02_30.jpg" /></div></li></ul></div><p>We write our code in the <code class="literal">Start()</code> method, rather than adding to code in the <code class="literal">Awake()</code> method, to ensure that the <span class="strong"><strong>RectTransform</strong></span> of GameObject <code class="literal">Panel-slot-grid </code>has finished sizing (in this recipe, it stretches based on the width of the <span class="strong"><strong>Game</strong></span> panel). While we can't know the sequence in which <span class="strong"><strong>Hierarchy</strong></span> GameObjects are created when a scene begins, we can rely on the Unity behavior that every GameObject sends the <code class="literal">Awake()</code>message, and only after all corresponding <code class="literal">Awake()</code> methods have finished executing all objects, and then sends the <code class="literal">Start()</code> message. So, any code in the <code class="literal">Start()</code> method can <a id="id263" class="indexterm"></a>safely assume that every GameObject has been initialized.</p><p>The above screenshot shows the value of <code class="literal">NUM_INVENTORY_SLOTS</code> having been changed to 15, and the cell size, having been corresponding, changed, so that all 15 now fit horizontally in our panel. Note that the spacing between cells is subtracted from the calculated available with divided by the number of slots (<code class="literal">xCellSize -= gridLayoutGroup.spacing.x</code>) since that spacing is needed between each item displayed as well.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec23"></a>Add some help methods to the Rect Transform script class</h4></div></div></div><p>If we wish to further change, say, the <code class="literal">RectTransform</code> properties using code, we can add extension methods<a id="id264" class="indexterm"></a> by creating a file containing special static methods and using the special "this" keyword. See the following code that adds <code class="literal">SetWidth(…)</code>, <code class="literal">SetHeight(…)</code>, and <code class="literal">SetSize(…)</code> methods to the <code class="literal">RectTransform</code> scripted component:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System;
using System.Collections;

public static class RectTransformExtensions
{
  public static void SetSize(this RectTransform trans, Vector2 newSize) {
    Vector2 oldSize = trans.rect.size;
    Vector2 deltaSize = newSize - oldSize;
    trans.offsetMin = trans.offsetMin - new Vector2(deltaSize.x * trans.pivot.x, deltaSize.y * trans.pivot.y);
    trans.offsetMax = trans.offsetMax + new Vector2(deltaSize.x * (1f - trans.pivot.x), deltaSize.y * (1f - trans.pivot.y));
  }

  public static void SetWidth(this RectTransform trans, float newSize) {
    SetSize(trans, new Vector2(newSize, trans.rect.size.y));
  }

  public static void SetHeight(this RectTransform trans, float newSize) {
    SetSize(trans, new Vector2(trans.rect.size.x, newSize));
  }
}</pre></div><p>Unity C# allows us to add these extensions methods by declaring <code class="literal">static void</code> methods whose first argument is in the form this <code class="literal">&lt;ClassName&gt; &lt;var&gt;</code>. The method can then be called as a built-in method defined in the original class.</p><p>All we would need to do is create a new C# script class file <code class="literal">RectTransformExtensions</code> in the folder <span class="strong"><strong>Scripts</strong></span> in the <span class="strong"><strong>Project</strong></span> panel, containing the above code. In fact, you can find a whole set of <a id="id265" class="indexterm"></a>useful extra <code class="literal">RectTransform</code> methods (on which the above is an extract) created by<a id="id266" class="indexterm"></a> OrbcreationBV, and it is available online at <a class="ulink" href="http://www.orbcreation.com/orbcreation/page.orb?1099" target="_blank">http://www.orbcreation.com/orbcreation/page.orb?1099</a>.</p></div></div></div>