<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec95"></a>Balancing in-game audio with Ducking</h2></div></div><hr /></div><p>As much as the background music can be important in establishing the right atmosphere, there will be times when other audio clips should be emphasized, and the music volume turned down for the <a id="id1006" class="indexterm"></a>duration of that clip. This effect is known as <span class="strong"><strong>Ducking</strong></span>. Maybe you will need it for dramatic effect (simulating hearing loss after an explosion took place), or maybe you want to make sure that the player listens to a specific bit <a id="id1007" class="indexterm"></a>of information. In this recipe, we will learn how to emphasize a piece of dialog by ducking the audio whenever a specific sound message is played. For that effect, we will use the new <span class="strong"><strong>Audio Mixer</strong></span> to send information between tracks.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec281"></a>Getting ready</h3></div></div></div><p>For this recipe, we have provided the <code class="literal">soundtrack.mp3</code> audio clip and a Unity package named <code class="literal">Ducking.unitypackage</code>, containing an initial scene. All these files are available inside the <code class="literal">1362_09_07</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec282"></a>How to do it...</h3></div></div></div><p>To apply Audio<a id="id1008" class="indexterm"></a> Ducking to your soundtrack, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import <code class="literal">Ducking.unitypackage</code> and <code class="literal">soundtrack.mp3</code> into your project.</p></li><li><p>Open the <span class="strong"><strong>Ducking</strong></span> scene (available in the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Ducking</strong></span> folder). Play the scene and walk towards the semitransparent green wall in the tunnel, using the <span class="emphasis"><em>W A S D</em></span> keys (by pressing <span class="emphasis"><em>Shift</em></span> to run). You will hear the <span class="strong"><strong>robotDucking</strong></span> audio clip play as the character collides with the wall.</p></li><li><p>From the <span class="strong"><strong>Create</strong></span> drop-down at the top of the <span class="strong"><strong>Hierarchy</strong></span> view, choose <span class="strong"><strong>Create Empty</strong></span> to add a new GameObject to the scene. Name it <span class="strong"><strong>Soundtrack</strong></span>.</p></li><li><p>Drag the <span class="strong"><strong>soundtrack</strong></span> audio clip you have imported into the <span class="strong"><strong>Soundtrack</strong></span> GameObject. Then, select the <span class="strong"><strong>Soundtrack</strong></span> object and from the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Audio Source</strong></span> component, check the <span class="strong"><strong>Loop</strong></span> option. Make sure the <span class="strong"><strong>Play On Awake</strong></span> option is checked and <span class="strong"><strong>Spatial Blend</strong></span> set to <span class="strong"><strong>2D</strong></span>, as shown in the following in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_37.jpg" /></div></li><li><p>Test the scene again. The soundtrack music should be playing.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add an <span class="strong"><strong>Audio Mixer</strong></span> to the project. Name it <span class="strong"><strong>MainMixer</strong></span>. Double-click on it to open the <span class="strong"><strong>Audio Mixer</strong></span><a id="id1009" class="indexterm"></a> window.</p></li><li><p>From the <span class="strong"><strong>Groups</strong></span> view, highlight <span class="strong"><strong>Master</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a child to the <span class="strong"><strong>Master</strong></span> group. Name it <span class="strong"><strong>Music</strong></span>. Then, highlight <span class="strong"><strong>Master</strong></span> again and add a new child group named <span class="strong"><strong>FX</strong></span>, as shown in the following screenshot. Finally, add a third child to the <span class="strong"><strong>Master</strong></span> group, named <span class="strong"><strong>Input</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_38.jpg" /></div></li><li><p>From the <span class="strong"><strong>Mixers</strong></span> view, highlight <span class="strong"><strong>MainMixer</strong></span> and click the <span class="strong"><strong>+</strong></span> sign to add a new <span class="strong"><strong>Mixer</strong></span> to the project. Name it <span class="strong"><strong>MusicMixer</strong></span>. Then, drag it into the <span class="strong"><strong>MainMixer</strong></span> and select the group <span class="strong"><strong>Music</strong></span> as its <span class="strong"><strong>Output</strong></span>. Repeat the operation to add a mixer <a id="id1010" class="indexterm"></a>named <span class="strong"><strong>FxMixer</strong></span> to the project, selecting the <span class="strong"><strong>FX</strong></span> group as the output:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_39.jpg" /></div></li><li><p>Now, select <span class="strong"><strong>MusicMixer</strong></span>. Select its <span class="strong"><strong>Master</strong></span> group and add a child named <span class="strong"><strong>Soundtrack</strong></span>. Then, select <span class="strong"><strong>FxMixer</strong></span> and add a child named <span class="strong"><strong>Bells</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_40.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, select the <span class="strong"><strong>DialogueTrigger</strong></span> object. Then, in the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Audio Source</strong></span> component, Change its <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>MainMixer</strong></span> | <span class="strong"><strong>Input</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_41.jpg" /></div></li><li><p>Now, select the <span class="strong"><strong>Soundtrack</strong></span> GameObject and in the <span class="strong"><strong>Inspector</strong></span> view, in the <span class="strong"><strong>Audio Source</strong></span> component, change its <span class="strong"><strong>Output</strong></span> track to <span class="strong"><strong>MusicMixer</strong></span> | <span class="strong"><strong>Soundtrack</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_42.jpg" /></div></li><li><p>Finally, from<a id="id1011" class="indexterm"></a> the <span class="strong"><strong>Assets</strong></span> folder in the <span class="strong"><strong>Project</strong></span> view, select the <span class="strong"><strong>Signal</strong></span> prefab. From the <span class="strong"><strong>Inspector</strong></span> view, access its the <span class="strong"><strong>Audio Source</strong></span> component and change its <span class="strong"><strong>Output</strong></span> to <span class="strong"><strong>FxMixer</strong></span> | <span class="strong"><strong>Bells</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_43.jpg" /></div></li><li><p>Open the<a id="id1012" class="indexterm"></a> <span class="strong"><strong>Audio Mixer</strong></span> window. Choose <span class="strong"><strong>MainMixer</strong></span>, select the <span class="strong"><strong>Music</strong></span> track controller, right-click on <span class="strong"><strong>Attenuation</strong></span>, and using the context menu, add the <span class="strong"><strong>Duck Volume</strong></span> effect before <span class="strong"><strong>Attenuation</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_44.jpg" /></div></li><li><p>Now, select the <span class="strong"><strong>Input</strong></span> track, right-click on <span class="strong"><strong>Attenuation</strong></span>, and using the context menu, add <span class="strong"><strong>Send</strong></span> after <span class="strong"><strong>Attenuation</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_45.jpg" /></div></li><li><p>With <span class="strong"><strong>Input</strong></span><a id="id1013" class="indexterm"></a> track still selected, go to the <span class="strong"><strong>Inspector</strong></span> view and change the <span class="strong"><strong>Receive</strong></span> setting in <span class="strong"><strong>Send</strong></span> to <span class="strong"><strong>Music\Duck Volume</strong></span> and its <span class="strong"><strong>Send</strong></span> level to <code class="literal">0.00 db</code>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_46.jpg" /></div></li><li><p>Select the <span class="strong"><strong>Music</strong></span> track. From the <span class="strong"><strong>Inspector</strong></span> view, change the settings on the <span class="strong"><strong>Duck Volume</strong></span> as follows: <span class="strong"><strong>Threshold</strong></span>: -<code class="literal">40.00 db</code>; <span class="strong"><strong>Ratio</strong></span>: <code class="literal">300.00 %</code>; <span class="strong"><strong>Attack Time</strong></span>: <code class="literal">100.00 ms</code>; <span class="strong"><strong>Release Time</strong></span>: <code class="literal">2000.00 ms</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_47.jpg" /></div></li><li><p>Test the scene again. Entering the trigger object will cause the soundtrack volume to drop considerably, recovering the original volume in 2 seconds.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec283"></a>How it works...</h3></div></div></div><p>In this recipe, we have created, in addition to Music and Sound FX, a group named <span class="strong"><strong>Input</strong></span>, to which we<a id="id1014" class="indexterm"></a> have routed the audio clip that triggers the <span class="strong"><strong>Duck Volume</strong></span> effect attached to our music track. The <span class="strong"><strong>Duck Volume</strong></span> effect changes the track's volume whenever it receives an input that is louder than indicated in its <span class="strong"><strong>Threshold</strong></span> setting. In our case, we have sent the <span class="strong"><strong>Input</strong></span> track as input, and adjusted the settings so the volume will be reduced as soon as 0.1 seconds after the input had been received, turning back to its original value of 2 seconds after the input has ceased. The amount of volume reduction was determined by our <span class="strong"><strong>Ratio</strong></span> of <span class="strong"><strong>300.00 %</strong></span>. Playing around with the setting values will give you a better idea on how each parameter affects the final result. Also, make sure to visualize the graphic as the trigger sound is played. You will be able to see how the <span class="strong"><strong>Input</strong></span> sound passes the threshold, triggering the effect.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_48.jpg" /><div class="caption"><p>Duck Volume</p></div></div><p>Also, please note that we have organized our tracks so that the other sound clips (other than speech) will not <a id="id1015" class="indexterm"></a>affect the volume of the music—but every music clip will be affected by audio clips sent to the input track.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec284"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Adding volume control with Audio Mixers</em></span> recipe in this chapter</p></li><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Making a dynamic soundtrack with Snapshots</em></span> recipe in this chapter</p></li></ul></div></div></div>