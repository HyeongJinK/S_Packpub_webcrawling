<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec62"></a>Using lights and cookie textures to simulate a cloudy day</h2></div></div><hr /></div><p>As it can be <a id="id513" class="indexterm"></a>seen in many first-person shooters <a id="id514" class="indexterm"></a>and survival horror games, lights and shadows can add a great deal of realism to a scene, helping immensely<a id="id515" class="indexterm"></a> to create the right atmosphere for the game. In this recipe, we will create a cloudy outdoor environment using cookie textures. Cookie textures work as masks for lights. It functions by adjusting the intensity of the light projection to the cookie texture's alpha channel. This allows for a silhouette effect (just think of the bat-signal) or, as in this particular case, subtle variations that give a filtered quality to the lighting.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec171"></a>Getting ready</h3></div></div></div><p>If you don't have access to an image editor, or prefer to skip the texture map elaboration in order to focus on the<a id="id516" class="indexterm"></a> implementation, please use the image file called <code class="literal">cloudCookie.tga</code>, which is provided inside the <code class="literal">1362_06_01</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec172"></a>How to do it...</h3></div></div></div><p>To simulate a<a id="id517" class="indexterm"></a> cloudy outdoor environment, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In your<a id="id518" class="indexterm"></a> image editor, create a new 512 x 512 pixel image.</p></li><li><p>Using black as the foreground color and white as the background color, apply the Clouds filter (in Photoshop, this is done by navigating to the <span class="strong"><strong>Filter</strong></span> | <span class="strong"><strong>Render</strong></span> | <span class="strong"><strong>Clouds</strong></span> menu).</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_01.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"></a>Note</h3><p>Learning about the Alpha channel is useful, but you could get the same result without it. Skip steps 3 to 7, save your image as <code class="literal">cloudCookie.png</code> and, when changing texture type in step 9, leave Alpha from Greyscale checked.</p></div></li><li><p>Select your entire image and copy it.</p></li><li><p>Open the <span class="strong"><strong>Channels</strong></span> window (in Photoshop, this can be done by navigating to the <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Channels</strong></span> menu).</p></li><li><p>There should be three channels: <span class="strong"><strong>Red</strong></span>, <span class="strong"><strong>Green</strong></span>, and <span class="strong"><strong>Blue</strong></span>. Create a new channel. This will be<a id="id519" class="indexterm"></a> the <span class="strong"><strong>Alpha</strong></span> channel.</p></li><li><p>In the <span class="strong"><strong>Channels</strong></span> <a id="id520" class="indexterm"></a>window, select the <span class="strong"><strong>Alpha 1</strong></span> channel and paste your image into it.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_02.jpg" /></div></li><li><p>Save your image file as <code class="literal">cloudCookie.PSD</code> or <code class="literal">TGA</code>.</p></li><li><p>Import <a id="id521" class="indexterm"></a>your image file to Unity and select it in the <span class="strong"><strong>Project</strong></span> view.</p></li><li><p>From the <span class="strong"><strong>Inspector</strong></span> view, change its <span class="strong"><strong>Texture Type</strong></span> to <span class="strong"><strong>Cookie</strong></span> and its <span class="strong"><strong>Light Type</strong></span> to <span class="strong"><strong>Directional</strong></span>. Then, click on <span class="strong"><strong>Apply</strong></span>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_03.jpg" /></div></li><li><p>We will need a surface to actually see the lighting effect. You can either add a plane to your<a id="id522" class="indexterm"></a> scene (via navigating to the <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Plane</strong></span> menu), or create a <span class="strong"><strong>Terrain</strong></span> (menu option <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Terrain</strong></span>) and edit it, if you so you wish.</p></li><li><p>Let's add a light to our scene. Since we want to simulate sunlight, the best option is to <a id="id523" class="indexterm"></a>create a <span class="strong"><strong>Directional Light</strong></span>. You can do this through the drop-down menu named <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Directional Light</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> view.</p></li><li><p>Using the <span class="strong"><strong>Transform</strong></span> <a id="id524" class="indexterm"></a>component of the <span class="strong"><strong>Inspector</strong></span> view, reset the light's <span class="strong"><strong>Position</strong></span> to <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>Y</strong></span>: <code class="literal">0</code>, <span class="strong"><strong>Z</strong></span>: <code class="literal">0</code> and its <span class="strong"><strong>Rotation</strong></span> to <span class="strong"><strong>X</strong></span>: <code class="literal">90</code>; <span class="strong"><strong>Y</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Z</strong></span>: <code class="literal">0</code>.</p></li><li><p>In the <span class="strong"><strong>Cookie</strong></span> field, select the <span class="strong"><strong>cloudCookie</strong></span> texture that you imported earlier. Change the <span class="strong"><strong>Cookie Size</strong></span> field to <code class="literal">80</code>, or a value that you feel is more appropriate for the scene's dimension. Please leave <span class="strong"><strong>Shadow Type</strong></span> as <span class="strong"><strong>No Shadows</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_04.jpg" /></div></li><li><p>Now, we need a script to translate our light and, consequently, the <span class="strong"><strong>Cookie</strong></span> projection. Using the <span class="strong"><strong>Create</strong></span> drop-down menu in the <span class="strong"><strong>Project</strong></span> view, create a new C# Script<a id="id525" class="indexterm"></a> named <code class="literal">MovingShadows.cs</code>.</p></li><li><p>Open your script and<a id="id526" class="indexterm"></a> replace everything <a id="id527" class="indexterm"></a>with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class MovingShadows : MonoBehaviour{
  public float windSpeedX;
  public float windSpeedZ;
  private float lightCookieSize;
  private Vector3 initPos;

  void Start(){
    initPos = transform.position;
    lightCookieSize = GetComponent&lt;Light&gt;().cookieSize;
  }

  void Update(){
    Vector3 pos = transform.position;
    float xPos= Mathf.Abs (pos.x);
    float zPos= Mathf.Abs (pos.z);
    float xLimit = Mathf.Abs(initPos.x) + lightCookieSize;
    float zLimit = Mathf.Abs(initPos.z) + lightCookieSize;

    if (xPos &gt;= xLimit)
      pos.x = initPos.x;

    if (zPos &gt;= zLimit)
      pos.z = initPos.z;

    transform.position = pos;
    float windX = Time.deltaTime * windSpeedX;
    float windZ = Time.deltaTime * windSpeedZ;
    transform.Translate(windX, 0, windZ, Space.World);
  }
}</pre></div></li><li><p>Save your <a id="id528" class="indexterm"></a>script and apply it to the <span class="strong"><strong>Directional Light</strong></span>.</p></li><li><p>Select the <a id="id529" class="indexterm"></a><span class="strong"><strong>Directional Light</strong></span>. In the <span class="strong"><strong>Inspector</strong></span> view, change the parameters <span class="strong"><strong>Wind Speed X</strong></span> and <a id="id530" class="indexterm"></a><span class="strong"><strong>Wind Speed Z</strong></span> to <code class="literal">20</code> (you can change these values as you wish, as shown).</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_05.jpg" /></div></li><li><p>Play your scene. The shadows will be moving.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec173"></a>How it works...</h3></div></div></div><p>With our script, we are telling the <span class="strong"><strong>Directional Light</strong></span> to move across the <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Z</em></span> axis, causing the <span class="strong"><strong>Light Cookie</strong></span> texture to be displaced as well. Also, we reset the light object to its original position whenever it traveled a distance that was either equal to or greater than the <span class="strong"><strong>Light Cookie Size</strong></span>. The light position must be reset to prevent it from traveling too far, causing problems in real-time render and lighting. The <span class="strong"><strong>Light Cookie Size</strong></span> parameter is used to ensure a smooth transition.</p><p>The reason we are not enabling shadows is because the light angle for the <span class="emphasis"><em>X</em></span> axis must be 90 degrees (or there will be a noticeable gap when the light resets to the original position). If you want dynamic shadows in your scene, please add a second <span class="strong"><strong>Directional Light</strong></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec174"></a>There's more...</h3></div></div></div><p>In this recipe, <a id="id531" class="indexterm"></a>we have applied a cookie texture<a id="id532" class="indexterm"></a> to a <span class="strong"><strong>Directional</strong></span><a id="id533" class="indexterm"></a><span class="strong"><strong> Light</strong></span>. But what if we were using the <span class="strong"><strong>Spot</strong></span> or <span class="strong"><strong>Point Lights</strong></span>?</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec51"></a>Creating Spot Light cookies</h4></div></div></div><p>Unity<a id="id534" class="indexterm"></a> documentation has an excellent tutorial on how to make the <span class="strong"><strong>Spot Light</strong></span> cookies. This is great to simulate shadows coming from <a id="id535" class="indexterm"></a>projectors, windows, and so on. You can<a id="id536" class="indexterm"></a> check it out at <a class="ulink" href="http://docs.unity3d.com/Manual/HOWTO-LightCookie.html" target="_blank">http://docs.unity3d.com/Manual/HOWTO-LightCookie.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec52"></a>Creating Point Light Cookies</h4></div></div></div><p>If you want to use<a id="id537" class="indexterm"></a> a cookie texture with a <span class="strong"><strong>Point Light</strong></span>, you'll need to change the <span class="strong"><strong>Light Type</strong></span> in the <span class="strong"><strong>Texture Importer</strong></span> section <a id="id538" class="indexterm"></a>of the <span class="strong"><strong>Inspector</strong></span>.</p></div></div></div>