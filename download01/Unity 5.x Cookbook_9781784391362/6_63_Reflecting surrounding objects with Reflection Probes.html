<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec65"></a>Reflecting surrounding objects with Reflection Probes</h2></div></div><hr /></div><p>If you want your scene's environment to be reflected by game objects, featuring reflective materials (such as the ones with high Metallic or Specular levels), then you can achieve such effect using <span class="strong"><strong>Reflection Probes</strong></span>. They allow for real-time, baked, or even custom reflections through the use of Cubemaps.</p><p>Real-time reflections<a id="id580" class="indexterm"></a> can be expensive in terms of processing; in which case, you should favor baked reflections, unless it's really necessary to<a id="id581" class="indexterm"></a> display dynamic objects being reflected (mirror-like objects, for instance). Still, there are some ways real-time reflections can be optimized. In this recipe, we will test three different configurations for reflection probes:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Real-time reflections (constantly updated)</p></li><li style="list-style-type: disc"><p>Real-time reflections (updated on-demand) via script</p></li><li style="list-style-type: disc"><p>Baked reflections (from the Editor)</p></li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec182"></a>Getting ready</h3></div></div></div><p>For this recipe, we have prepared a basic scene, featuring three sets of reflective objects: one is constantly moving, one is static, and one moves whenever it is interacted with. The <code class="literal">Probes.unitypackage</code> package that is containing the scene can be found inside the <code class="literal">1362_06_04</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec183"></a>How to do it...</h3></div></div></div><p>To reflect the surrounding objects using the Reflection probes, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import <code class="literal">Probes.unitypackage</code> to a new project. Then, open the scene named <span class="strong"><strong>Probes</strong></span>. This is a basic scene featuring three sets of reflective objects.</p></li><li><p>Play the scene. Observe that one of the systems is dynamic, one is static, and one rotates randomly, whenever a key is pressed.</p></li><li><p>Stop the scene.</p></li><li><p>First, let's create a constantly updated real-time reflection probe. From the <span class="strong"><strong>Create</strong></span> drop-down button of the <span class="strong"><strong>Hierarchy</strong></span> view, add a <span class="strong"><strong>Reflection Probe</strong></span> to the scene (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Light</strong></span> | <span class="strong"><strong>Reflection Probe</strong></span>). Name it as <code class="literal">RealtimeProbe</code> and make it a child of the <span class="strong"><strong>System 1 Realtime</strong></span> | <span class="strong"><strong>MainSphere</strong></span> game object. Then, from the<a id="id582" class="indexterm"></a> <span class="strong"><strong>Inspector</strong></span><a id="id583" class="indexterm"></a> view, the <span class="strong"><strong>Transform</strong></span> component, change its <span class="strong"><strong>Position</strong></span> to <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Y</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Z</strong></span>: <code class="literal">0</code>, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_16.jpg" /></div></li><li><p>Now, go to the <span class="strong"><strong>Reflection Probe</strong></span> component. Set <span class="strong"><strong>Type</strong></span> as <span class="strong"><strong>Realtime</strong></span>; <span class="strong"><strong>Refresh Mode</strong></span> as <span class="strong"><strong>Every Frame</strong></span> and <span class="strong"><strong>Time Slicing</strong></span> as <span class="strong"><strong>No time slicing</strong></span>, shown as follows:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_17.jpg" /></div></li><li><p>Play the scene. The reflections will be now be updated in real time. Stop the scene.</p></li><li><p>Observe that the only object displaying the real-time reflections is <span class="strong"><strong>System 1 Realtime</strong></span> | <span class="strong"><strong>MainSphere</strong></span>. The reason for this is the <span class="strong"><strong>Size</strong></span> of the Reflection Probe. From the <span class="strong"><strong>Reflection Probe</strong></span> component, change its <span class="strong"><strong>Size</strong></span> to <span class="strong"><strong>X</strong></span>: <code class="literal">25</code>; <span class="strong"><strong>Y</strong></span>: <code class="literal">10</code>; <span class="strong"><strong>Z</strong></span>: <code class="literal">25</code>. Note that the small red spheres are now affected as well. However, it is important to notice that all objects display the same reflection. Since our reflection probe's origin is placed at the same location as the <span class="strong"><strong>MainSphere</strong></span>, all reflective objects<a id="id584" class="indexterm"></a> will display reflections from that point of view.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_18.jpg" /></div></li><li><p>If you want to<a id="id585" class="indexterm"></a> eliminate the reflection from the reflective objects within the reflection probe, such as the small red spheres, select the objects and, from the <span class="strong"><strong>Mesh Renderer</strong></span> component, set <span class="strong"><strong>Reflection Probes</strong></span> as <span class="strong"><strong>Off</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_19.jpg" /></div></li><li><p>Add a new <span class="strong"><strong>Reflection Probe</strong></span> to the scene. This time, name it <code class="literal">OnDemandProbe</code> and make it a child of the <span class="strong"><strong>System 2 On Demand</strong></span> | <span class="strong"><strong>MainSphere</strong></span> game object. Then, from the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Transform</strong></span> component, change its <span class="strong"><strong>Position</strong></span> to <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Y</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Z</strong></span>: <code class="literal">0</code>.</p></li><li><p>Now, go to the <a id="id586" class="indexterm"></a><span class="strong"><strong>Reflection Probe</strong></span> component. Set <span class="strong"><strong>Type</strong></span> as <span class="strong"><strong>Realtime</strong></span>, <span class="strong"><strong>Refresh Mode</strong></span> as <a id="id587" class="indexterm"></a><span class="strong"><strong>Via scripting</strong></span>, and <span class="strong"><strong>Time Slicing</strong></span> as <span class="strong"><strong>Individual faces</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_20.jpg" /></div></li><li><p>Using the <span class="strong"><strong>Create</strong></span> drop-down menu in the <span class="strong"><strong>Project</strong></span> view, create a new C# Script named <code class="literal">UpdateProbe</code>.</p></li><li><p>Open your script and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class UpdateProbe : MonoBehaviour {
  private ReflectionProbe probe;

  void Awake () {
    probe = GetComponent&lt;ReflectionProbe&gt; ();
    probe.RenderProbe();
  }

  public void RefreshProbe(){
    probe.RenderProbe();
  }
}</pre></div></li><li><p>Save your script and attach it to the <span class="strong"><strong>OnDemandProbe</strong></span>.</p></li><li><p>Now, find the <a id="id588" class="indexterm"></a>script named <code class="literal">RandomRotation</code>, which is attached to the <span class="strong"><strong>System 2 On Demand</strong></span> | <span class="strong"><strong>Spheres</strong></span> object, and open it in the code editor.</p></li><li><p>Right before the <code class="literal">Update()</code> function, add the following lines:</p><div class="informalexample"><pre class="programlisting">private GameObject probe;
private UpdateProbe up;
void Awake(){
  probe = GameObject.Find("OnDemandProbe");
  up = probe.GetComponent&lt;UpdateProbe&gt;();
}</pre></div></li><li><p>Now, locate the line of code called <code class="literal">transform.eulerAngles = newRotation;</code> and, immediately after it, add the following line:</p><div class="informalexample"><pre class="programlisting">up.RefreshProbe();</pre></div></li><li><p>Save the script and test your scene. Observe how the <span class="strong"><strong>Reflection Probe</strong></span> is updated whenever <a id="id589" class="indexterm"></a>a key is pressed.</p></li><li><p>Stop the scene. Add a third <span class="strong"><strong>Reflection Probe</strong></span> to the scene. Name it as <code class="literal">CustomProbe</code> and make it a child of the <span class="strong"><strong>System 3 On Custom</strong></span> | <span class="strong"><strong>MainSphere</strong></span> game object. Then, from the <span class="strong"><strong>Inspector</strong></span> view, the <span class="strong"><strong>Transform</strong></span> component, change its <span class="strong"><strong>Position</strong></span> to <span class="strong"><strong>X</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Y</strong></span>: <code class="literal">0</code>; <span class="strong"><strong>Z</strong></span>: <code class="literal">0</code>.</p></li><li><p>Go to the <span class="strong"><strong>Reflection Probe</strong></span> component. Set <span class="strong"><strong>Type</strong></span> as <span class="strong"><strong>Custom </strong></span>and click on the <span class="strong"><strong>Bake</strong></span> button, as shown:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_21.jpg" /></div></li><li><p>A <span class="strong"><strong>Save File</strong></span> dialog <a id="id590" class="indexterm"></a>window will show up. Save the file as <code class="literal">CustomProbe-reflectionHDR.exr</code>.</p></li><li><p>Observe that the reflection<a id="id591" class="indexterm"></a> map does not include the reflection of red spheres on it. To change this, you have two options: set the <span class="strong"><strong>System 3 On Custom</strong></span> | <span class="strong"><strong>Spheres</strong></span> GameObject (and all its children) as <span class="strong"><strong>Reflection Probe Static</strong></span> or, from the <span class="strong"><strong>Reflection Probe</strong></span> component of the <span class="strong"><strong>CustomProbe</strong></span> GameObject, check the <span class="strong"><strong>Dynamic Objects</strong></span> option, as shown, and bake the map again (by clicking on the <span class="strong"><strong>Bake</strong></span> button).</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_22.jpg" /></div></li><li><p>If you want your<a id="id592" class="indexterm"></a> reflection <span class="strong"><strong>Cubemap</strong></span> to <a id="id593" class="indexterm"></a>be dynamically baked while you edit your scene, you can set the <span class="strong"><strong>Reflection Probe Type</strong></span> to <span class="strong"><strong>Baked</strong></span>, open the <span class="strong"><strong>Lighting</strong></span> window (the <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Lighting</strong></span> menu), access the <span class="strong"><strong>Scene</strong></span> section, and check the <span class="strong"><strong>Continuous Baking</strong></span> option as shown. Please note that this mode won't include dynamic objects in the reflection, so be sure to set <span class="strong"><strong>System 3 Custom</strong></span> | <span class="strong"><strong>Spheres</strong></span> and <span class="strong"><strong>System 3 Custom</strong></span> | <span class="strong"><strong>MainSphere</strong></span> as <span class="strong"><strong>Reflection Probe Static</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_06_23.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec184"></a>How it works...</h3></div></div></div><p>The <span class="strong"><strong>Reflection Probes</strong></span> <a id="id594" class="indexterm"></a>element act like omnidirectional cameras that render <span class="strong"><strong>Cubemaps</strong></span> and apply them onto the objects within their <a id="id595" class="indexterm"></a>constraints. When creating <span class="strong"><strong>Reflection Probes</strong></span>, it's important to be aware of how the different types work:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Real-time Reflection Probes</strong></span>: Cubemaps are updated at runtime. The real-time Reflection<a id="id596" class="indexterm"></a> Probes have three different <span class="strong"><strong>Refresh Modes</strong></span>: <span class="strong"><strong>On Awake</strong></span> (Cubemap is baked once, right before the scene starts); <span class="strong"><strong>Every frame</strong></span> (Cubemap is constantly updated); <span class="strong"><strong>Via scripting</strong></span> (Cubemap is updated whenever the <span class="strong"><strong>RenderProbe</strong></span> function is used).</p><p>Since Cubemaps feature six sides, the <span class="strong"><strong>Reflection Probes</strong></span> features <span class="strong"><strong>Time Slicing</strong></span>, so each side can be updated independently. There are three different types of Time Slicing: <span class="strong"><strong>All Faces at Once</strong></span> (renders all faces at once and calculates mipmaps over 6 frames. Updates the probe in 9 frames); <span class="strong"><strong>Individual Faces</strong></span> (each face is rendered over a number of frames. It updates the probe in 14 frames. The results can be a bit inaccurate, but it is the least expensive solution in terms of frame-rate impact); <span class="strong"><strong>No Time Slicing</strong></span> (The <span class="strong"><strong>Probe</strong></span> is rendered and mipmaps are calculated in <a id="id597" class="indexterm"></a>one frame. It provides high accuracy, but it also the most expensive in terms of frame-rate).</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Baked:</strong></span> Cubemaps are<a id="id598" class="indexterm"></a> baked during editing the screen. Cubemaps can be either manually or <a id="id599" class="indexterm"></a>automatically updated, depending whether the <span class="strong"><strong>Continuous Baking</strong></span> option is <a id="id600" class="indexterm"></a>checked (it can be found at the <span class="strong"><strong>Scene</strong></span> section of the <span class="strong"><strong>Lighting</strong></span> window).</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Custom:</strong></span> The<a id="id601" class="indexterm"></a> Custom Reflection Probes can be either manually baked from the scene (and even include Dynamic objects), or created from a premade Cubemap.</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec185"></a>There's more...</h3></div></div></div><p>There are a number of additional settings that can be tweaked, such as <span class="strong"><strong>Importance</strong></span>, <span class="strong"><strong>Intensity</strong></span>, <span class="strong"><strong>Box Projection</strong></span>, <span class="strong"><strong>Resolution, HDR</strong></span>, and so on. For a complete view on each of these settings, we<a id="id602" class="indexterm"></a> strongly recommend that you read Unity's documentation on the subject, which is available at <a class="ulink" href="http://docs.unity3d.com/Manual/class-ReflectionProbe.html" target="_blank">http://docs.unity3d.com/Manual/class-ReflectionProbe.html</a>.</p></div></div>