<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec109"></a>Implementing slow motion</h2></div></div><hr /></div><p>Since Remedy Entertainment's <span class="emphasis"><em>Max Payne</em></span>, slow motion, or bullet time, became a popular feature in games. For example, Criterion's <span class="emphasis"><em>Burnout</em></span> series has successfully explored the slow motion effect in the <a id="id1173" class="indexterm"></a>racing genre. In this recipe, we will implement a slow motion effect triggered by the pressing of the mouse's right button.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec338"></a>Getting ready</h3></div></div></div><p>For this recipe, we will use the same package as the previous recipe, <code class="literal">BallGame</code> in the <code class="literal">1362_11_02</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec339"></a>How to do it...</h3></div></div></div><p>To implement slow motion, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">BallGame</code> package into your project and, from the <span class="strong"><strong>Project</strong></span> view, open the level named <code class="literal">BallGame_01</code>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, create a new tag <span class="strong"><strong>Ball</strong></span>, apply this tag to prefab <code class="literal">ball</code> in the <code class="literal">Prefabs</code> folder, and save the scene.</p></li><li><p>Add the<a id="id1174" class="indexterm"></a> following C# script <span class="strong"><strong>BulletTime</strong></span> to <span class="strong"><strong>First Person Controller</strong></span>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.UI;
using System.Collections;

public class BulletTime : MonoBehaviour
{
    public float sloSpeed = 0.1f;
    public float totalTime = 10f;
    public float recoveryRate = 0.5f;
    public Slider EnergyBar;
    private float elapsed = 0f;
    private bool isSlow = false;

    void Update ()
    {

        if (Input.GetButtonDown ("Fire2") &amp;&amp; elapsed &lt; totalTime)
            SetSpeed (sloSpeed);

        if (Input.GetButtonUp ("Fire2"))
            SetSpeed (1f);

        if (isSlow) {
            elapsed += Time.deltaTime / sloSpeed;
            if (elapsed &gt;= totalTime) {
                SetSpeed (1f);
            }

        } else {
            elapsed -= Time.deltaTime * recoveryRate;
            elapsed = Mathf.Clamp (elapsed, 0, totalTime);
        }
        float remainingTime = (totalTime - elapsed) / totalTime;
        EnergyBar.value = remainingTime;
    }

    private void SetSpeed (float speed)
    {
        Time.timeScale = speed;
        Time.fixedDeltaTime = 0.02f * speed;
        isSlow = !(speed &gt;= 1.0f);
    }
}</pre></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, use the <span class="strong"><strong>Create</strong></span> drop-down menu to add a <span class="strong"><strong>Slider</strong></span> to the UI (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Slider</strong></span>). Please note that it will be created as a child of the preexisting <span class="strong"><strong>Canvas</strong></span> object. Rename it <code class="literal">EnergySlider</code>.</p></li><li><p>Select <span class="strong"><strong>EnergySlider</strong></span> and, from the <span class="strong"><strong>Inspector</strong></span> view, <span class="strong"><strong>Rect Transform</strong></span> component, set its<a id="id1175" class="indexterm"></a> position as follows: <span class="strong"><strong>Left: 0</strong></span>; <span class="strong"><strong>Pos Y: 0</strong></span>; <span class="strong"><strong>Pos Z: 0</strong></span>; <span class="strong"><strong>Right: 0</strong></span>; <span class="strong"><strong>Height: 50</strong></span>. Then, expand the <span class="strong"><strong>Anchors</strong></span> settings and change it to: <span class="strong"><strong>Min X: 0</strong></span>; <span class="strong"><strong>Y: 1</strong></span>; <span class="strong"><strong>Max X: 0.5</strong></span>; <span class="strong"><strong>Y: 1</strong></span>; <span class="strong"><strong>Pivot X: 0</strong></span>; <span class="strong"><strong>Y: 1</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_05.jpg" /></div></li><li><p>Also select the <span class="strong"><strong>Handle Slide Area</strong></span> child and disable it from the <span class="strong"><strong>Inspector</strong></span> view, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_06.jpg" /></div></li><li><p>Finally, select the <span class="strong"><strong>First Person Controller</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> view, find the <span class="strong"><strong>Bullet Time</strong></span> component, and drag the <span class="strong"><strong>EnergySlider</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> view into its <span class="strong"><strong>Energy Bar</strong></span> slot, as shown in the next screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_07.jpg" /></div></li><li><p>Play your game. You should be able to activate slow motion by holding down the right mouse button (or whatever alternative you have set for <span class="strong"><strong>Input</strong></span> axis <span class="strong"><strong>Fire2</strong></span>). The slider will act as a progress bar that slowly shrinks, indicating the<a id="id1176" class="indexterm"></a> remaining <span class="emphasis"><em>bullet time</em></span> you have.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec340"></a>How it works...</h3></div></div></div><p>Basically, all we need to do to have the slow motion effect is decrease the <code class="literal">Time.timeScale</code> variable. In our script, we do that by using the <code class="literal">sloSpeed</code> variable. Please note that we also need to adjust the <code class="literal">Time.fixedDeltaTime</code> variable, updating the physics simulation of our game.</p><p>In order to make the experience more challenging, we have also implemented a sort of <span class="emphasis"><em>energy bar</em></span> to indicate how much bullet time the player has left (the initial value is given, in seconds, by the <code class="literal">totalTime</code> variable). Whenever the player is not using bullet time, he has his quota filled according to the <code class="literal">recoveryRate</code> variable.</p><p>Regarding the <span class="emphasis"><em>GUI slider</em></span>, we have used the <span class="strong"><strong>Rect Transform</strong></span> settings to place it on the top-left corner and set its dimensions to half of the screen's width and 50 pixels tall. Also, we have hidden the <span class="emphasis"><em>handle slide area</em></span> to make it more similar to a traditional energy bar. Finally, instead of allowing direct interaction from the player with the slider, we have used the <code class="literal">BulletTime</code> script to change the slider's value.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec341"></a>There's more...</h3></div></div></div><p>Some suggestions for <a id="id1177" class="indexterm"></a>you to improve your slow motion effect even further are as follows.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec88"></a>Customizing the slider</h4></div></div></div><p>Don't forget that<a id="id1178" class="indexterm"></a> you can personalize the slider's appearance by creating your own sprites, or even by changing the slider's <span class="emphasis"><em>fill</em></span> color based on the slider's value. Try adding the following lines of code to the end of the <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">GameObject fill = GameObject.Find("Fill").gameObject;
Color sliderColor = Color.Lerp(Color.red, Color.green, remainingTime);
fill.GetComponent&lt;Image&gt; ().color = sliderColor;</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec89"></a>Adding Motion Blur</h4></div></div></div><p>
<span class="strong"><strong>Motion Blur</strong></span> is an image effect frequently identified with slow motion. Once attached to the camera, it could be enabled or <a id="id1179" class="indexterm"></a>disabled<a id="id1180" class="indexterm"></a> depending on the <code class="literal">speed</code> float value. For more information on the Motion Blur<a id="id1181" class="indexterm"></a> image effect, refer to <a class="ulink" href="http://docs.unity3d.com/Manual/script-MotionBlur.html" target="_blank">http://docs.unity3d.com/Manual/script-MotionBlur.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch11lvl3sec90"></a>Creating sonic ambience</h4></div></div></div><p>
<span class="emphasis"><em>Max Payne</em></span> famously <a id="id1182" class="indexterm"></a>used a strong, heavy heartbeat sound as sonic ambience. You could also try lowering the sound effects volume to convey the character focus when in slow motion. Plus, using audio filters on the camera could be an interesting option.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec342"></a>See also</h3></div></div></div><p>Refer to the recipe <span class="emphasis"><em>Pausing the game</em></span> in this chapter for more information.</p></div></div>