<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec92"></a>Waiting for audio to finish playing before auto-destructing an object</h2></div></div><hr /></div><p>An event may occur (such as an object pickup or the killing of an enemy) that we wish to notify to the player by playing an audio clip, and an associated visual object (such as an explosion particle system, or a temporary object in the location of the event). However, as soon as the clip has finished playing, we will wish for the visual object to be removed from the scene. This<a id="id963" class="indexterm"></a> recipe provides a simple way to link the ending of a playing audio clip with the automatic destruction of its containing object.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec267"></a>Getting ready</h3></div></div></div><p>Try this with any audio clip that is a second or more in duration. We have included the <code class="literal">engineSound</code> audio clip inside the <code class="literal">1362_09_04</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec268"></a>How to do it...</h3></div></div></div><p>To wait for<a id="id964" class="indexterm"></a> audio to finish playing before destroying a GameObject, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create an <span class="strong"><strong>Empty</strong></span> GameObject and rename it to <span class="strong"><strong>AudioObject</strong></span>. Then, add an <span class="strong"><strong>Audio Source</strong></span> component to this object (in the <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Audio</strong></span> | <span class="strong"><strong>Audio Source</strong></span> menu).</p></li><li><p>Import the <code class="literal">engineSound</code> audio clip and drag it from the <span class="strong"><strong>Project</strong></span> view to populate the <span class="strong"><strong>Audio Clip</strong></span> parameter of the <span class="strong"><strong>Audio Source</strong></span> component of <span class="strong"><strong>AudioObject</strong></span>, and deselect the component's <span class="strong"><strong>Play On Awake</strong></span> checkbox:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_12.jpg" /></div></li><li><p>Add the following script class to <span class="strong"><strong>AudioObject</strong></span>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class AudioDestructBehaviour : MonoBehaviour {
  private AudioSource audioSource;

  void Start(){
    audioSource = GetComponent&lt;AudioSource&gt;();
  }

  private void Update(){
    if( !audioSource.isPlaying )
      Destroy(gameObject);
  }
}</pre></div></li><li><p>In <span class="strong"><strong>Inspector</strong></span> view, disable (un-check) the <code class="literal">AudioDestructBehaviour</code> scripted component of <span class="strong"><strong>AudioObject</strong></span> (when needed, it will be re-enabled via C# code):</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_13.jpg" /></div></li><li><p>Create a<a id="id965" class="indexterm"></a> new C# file named <span class="strong"><strong>ButtonActions</strong></span>, containing the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class ButtonActions : MonoBehaviour{
  public AudioSource audioSource;
  public AudioDestructBehaviour audioDestructScriptedObject;

  public void PlaySound(){
    if( !audioSource.isPlaying )
      audioSource.Play();
  }

  public void DestroyAfterSoundStops(){
    audioDestructScriptedObject.enabled = true;
  }
}</pre></div></li><li><p>Create a UI button named <span class="strong"><strong>PlaySoundButton</strong></span> on the screen with a button <code class="literal">Play Sound</code> text, and attach the <span class="strong"><strong>ButtonActions</strong></span> script to this button.</p></li><li><p>With <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span>, create a new on-click event handler, dragging <span class="strong"><strong>PlaySoundButton</strong></span> into the <span class="strong"><strong>Object</strong></span> slot, and selecting the <span class="strong"><strong>PlaySound()</strong></span> function.</p></li><li><p>With the <span class="strong"><strong>PlaySoundButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Audio Source</strong></span> variable <span class="strong"><strong>AudioObject</strong></span>. Also, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Script</strong></span> variable <span class="strong"><strong>AudioDestructScriptedObject</strong></span>, shown as follows:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362_09_14.jpg" /></div></li><li><p>Create a second UI button named <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> on screen, with the button text <code class="literal">Destroy When Sound Finished</code>, and attach the <span class="strong"><strong>ButtonActions</strong></span> script to this button.</p></li><li><p>With <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, create a new on-click event handler, dragging <span class="strong"><strong>PlaySoundButton</strong></span> into the <span class="strong"><strong>GO</strong></span> slot, and then selecting the <span class="strong"><strong>DestroyAfterSoundStops()</strong></span> function.</p></li><li><p>Just as you did with the other button, now the <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span> panel, drag <span class="strong"><strong>AudioObject</strong></span> into the <span class="strong"><strong>Inspector</strong></span> view for the public <span class="strong"><strong>Script</strong></span> variable <span class="strong"><strong>MyAudioDestructObect</strong></span>.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec269"></a>How it works...</h3></div></div></div><p>The GameObject<a id="id966" class="indexterm"></a> named <span class="strong"><strong>AudioObject</strong></span> contains an Audio Source component, which stores and manages the playing of the audio clip. <span class="strong"><strong>AudioObject</strong></span> also contains a scripted component, which is an instance of the <span class="strong"><strong>AudioDestructBehaviour</strong></span> class. This script is initially disabled. When enabled, every frame this object (via its <code class="literal">Update()</code> method) tests whether the audio source is not playing (<code class="literal">!audio.isPlaying</code>). As soon as the audio is found to be not playing, the GameObject is destroyed.</p><p>There are two UI buttons created. Button <span class="strong"><strong>PlaySoundButton </strong></span>calls the <code class="literal">PlaySound()</code> method. This method will start playing the audio clip, if it is not already playing.</p><p>The second button called <span class="strong"><strong>DestoryWhenSoundFinishedButton</strong></span> calls the <code class="literal">DestoryAfterSoundStops()</code> method. This method enables the scripted component <span class="strong"><strong>AudioDestructBehaviour</strong></span> in GameObject <span class="strong"><strong>AudioObject</strong></span>â€”so that that GameObject will be destroyed, once the sound has finished playing.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec270"></a>See also</h3></div></div></div><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="emphasis"><em>Preventing an Audio Clip from restarting if it is already playing</em></span> recipe in this chapter</p></li></ul></div></div></div>