<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec70"></a>Configuring a character's Avatar and idle animation</h2></div></div><hr /></div><p>A feature that makes Mecanim so flexible and powerful is the ability of quickly reassigning animation clips from one character to another. This is made possible through the use of <span class="strong"><strong>Avatars</strong></span>, which are basically a layer between your character's original rig and the Unity's <a id="id696" class="indexterm"></a><span class="strong"><strong>Animator</strong></span> system.</p><p>In this recipe, we <a id="id697" class="indexterm"></a>will learn how to configure an Avatar skeleton on a rigged character.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec194"></a>Getting ready</h3></div></div></div><p>For this recipe, you will need the <code class="literal">MsLaser@T-Pose.fbx</code> and <code class="literal">Swat@rifle_aiming_idle.fbx</code> files, which are contained inside the <code class="literal">1362_07_code/character_and_clips/</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec195"></a>How to do it...</h3></div></div></div><p>To configure an<a id="id698" class="indexterm"></a> Avatar skeleton, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">MsLaser@T-Pose.fbx</code> and <code class="literal">Swat@rifle_aiming_idle.fbx</code> files to your project.</p></li><li><p>Select from the <span class="strong"><strong>Project</strong></span> view, the <code class="literal">MsLaser@T-Pose</code> model.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span> view, under <span class="strong"><strong>MsLaser@T-Pose Import Settings</strong></span>, activate the <span class="strong"><strong>Rig</strong></span> section. Change <span class="strong"><strong>Animation Type</strong></span> to <span class="strong"><strong>Humanoid</strong></span>. Then, leave <span class="strong"><strong>Avatar Definition</strong></span> as <span class="strong"><strong>Create From this Model</strong></span>. Finally, click on the <span class="strong"><strong>Configureâ€¦</strong></span> button.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_01.jpg" /></div></li><li><p>
<span class="strong"><strong>Inspector</strong></span> view will show the newly created Avatar. Observe how Unity correctly mapped the bones of our character into its structure, assigning, for instance, the <span class="strong"><strong>mixamoRig:LeftForeArm</strong></span> bone as the Avatar's <span class="strong"><strong>Lower Arm</strong></span>. We could, of course, reassign bones if needed. For now, just click on the <span class="strong"><strong>Done</strong></span> button to close the view.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_02.jpg" /></div></li><li><p>Now that we have our Avatar ready, let's configure our animation for the <span class="strong"><strong>Idle</strong></span> state. From<a id="id699" class="indexterm"></a> the <span class="strong"><strong>Project</strong></span> view, select the <span class="strong"><strong>Swat@rifle_aiming_idle</strong></span> file.</p></li><li><p>Activate the<a id="id700" class="indexterm"></a> <span class="strong"><strong>Rig</strong></span> section, change <span class="strong"><strong>Animation Type</strong></span> to <span class="strong"><strong>Humanoid</strong></span> and <span class="strong"><strong>Avatar Definition</strong></span> to <span class="strong"><strong>Create From This Model</strong></span>. Confirm by clicking on <span class="strong"><strong>Apply</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_03.jpg" /></div></li><li><p>Activate the <span class="strong"><strong>Animations</strong></span> section (to the right of the <span class="strong"><strong>Rig</strong></span>). Select the <span class="strong"><strong>rifle_aiming_idle</strong></span> clip (from the <span class="strong"><strong>Clips</strong></span> list). The <span class="strong"><strong>Preview area</strong></span> (at the bottom of the Inspector) will display the message as <span class="strong"><strong>No model is available for preview. Please </strong></span><a id="id701" class="indexterm"></a><span class="strong"><strong>drag a model into this Preview area</strong></span>. Drag <span class="strong"><strong>MsLaser@T-Pose</strong></span> to the <span class="strong"><strong>Preview</strong></span><a id="id702" class="indexterm"></a> area to correct this.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_04.jpg" /></div></li><li><p>With <span class="strong"><strong>rifle_aiming_idle</strong></span> selected from the <span class="strong"><strong>Clips</strong></span> list, check the <span class="strong"><strong>Loop Time</strong></span> and <span class="strong"><strong>Loop Pose</strong></span> options. Also, click on the <span class="strong"><strong>Clamp Range</strong></span> button to adjust the timeline to the actual time of the animation clip. Then, under <span class="strong"><strong>Root Transform Rotation</strong></span>, check <span class="strong"><strong>Bake Into Pose</strong></span>, and select <span class="strong"><strong>Baked Upon</strong></span> | <span class="strong"><strong>Original</strong></span>. Under <span class="strong"><strong>Root Transform Position (Y)</strong></span>, check <span class="strong"><strong>Bake Into Pose</strong></span>, and select<span class="strong"><strong> Baked upon (at Start)</strong></span> | <span class="strong"><strong>Original</strong></span>. Under <span class="strong"><strong>Root Transform Position (XZ)</strong></span>, leave <span class="strong"><strong>Bake Into Pose </strong></span>unchecked, and select<span class="strong"><strong> Baked Upon (at Start)</strong></span> | <span class="strong"><strong>Center of Mass</strong></span>. Finally, click on <span class="strong"><strong>Apply</strong></span> to confirm the changes.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_05.jpg" /></div></li><li><p>In order to access animation clips and play them, we need to create a controller. Do<a id="id703" class="indexterm"></a> this by clicking on the <span class="strong"><strong>Create</strong></span> button from the <span class="strong"><strong>Project</strong></span> view, and then selecting the <span class="strong"><strong>Animator Controller</strong></span> option. Name it as <code class="literal">MainCharacter</code>.</p></li><li><p>Double-click on the <span class="strong"><strong>Animator Controller</strong></span> to open the <span class="strong"><strong>Animator</strong></span> view.</p></li><li><p>From the<a id="id704" class="indexterm"></a> <span class="strong"><strong>Animator</strong></span> view, right-click on the grid to open a context menu. Then, select the <span class="strong"><strong>Create State</strong></span> |<span class="strong"><strong> Empty</strong></span> option<span class="strong"><strong>.</strong></span> A new box named <span class="strong"><strong>New State</strong></span> will appear. It will be in orange, indicating that it is the default state.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_06.jpg" /></div></li><li><p>Select <span class="strong"><strong>New State</strong></span> and, in the <span class="strong"><strong>Inspector</strong></span> view, change its name to <code class="literal">Idle</code>. Also, in the <span class="strong"><strong>Motion</strong></span> field, choose <span class="strong"><strong>rifle_aiming_idle</strong></span> by either selecting it from the list or dragging it<a id="id705" class="indexterm"></a> from the <span class="strong"><strong>Project</strong></span> view.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_07.jpg" /></div></li><li><p>Drag the<a id="id706" class="indexterm"></a> <code class="literal">MsLaser@T-Pose</code> model from the <span class="strong"><strong>Project</strong></span> view into the <span class="strong"><strong>Hierarchy</strong></span> view and place it on the scene.</p></li><li><p>Select <span class="strong"><strong>MsLaser@T-Pose</strong></span> from the <span class="strong"><strong>Hierarchy</strong></span> view and observe its <span class="strong"><strong>Animator</strong></span> component in the <span class="strong"><strong>Inspector</strong></span> view. Then, assign the newly created <span class="strong"><strong>MainCharacter controller</strong></span> to its <span class="strong"><strong>Controller</strong></span> field.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_07_08.jpg" /></div></li><li><p>Play your scene to see the character correctly animated.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec196"></a>How it works...</h3></div></div></div><p>Preparing our character for animation took many steps. First, we created its <span class="strong"><strong>Avatar</strong></span>, based on the character model's original bone structure. Then, we set <a id="id707" class="indexterm"></a>up the <span class="strong"><strong>animation clip</strong></span> (which, as the character mesh, is stored in a <code class="literal">.fbx</code> file), using its own Avatar. After this, we adjusted the<a id="id708" class="indexterm"></a> animation clip, clamping its size and making it a loop. We also baked its <span class="strong"><strong>Root Transform Rotation</strong></span> to obey the original file's orientation. Finally, an <a id="id709" class="indexterm"></a><span class="strong"><strong>Animator Controller</strong></span> was created, and the edited animation clip was made into its default <span class="strong"><strong>Animation state</strong></span>.</p><p>The concept of the <a id="id710" class="indexterm"></a>Avatar is what makes Mecanim so flexible. Once you have a <a id="id711" class="indexterm"></a><span class="strong"><strong>Controller</strong></span>, you can apply it to other humanoid characters, as long as they have an Avatar body mask. If you want to try it yourself, import <code class="literal">mascot.fbx</code>, which is also available inside the <code class="literal">charater_and_clips</code> folder, apply steps 3 and 4 into this character, place it on the scene, and apply <span class="strong"><strong>MainCharacter</strong></span> as its <span class="strong"><strong>Controller</strong></span> in the <span class="strong"><strong>Animator</strong></span> component. Then, play the scene to see the mascot playing the <span class="strong"><strong>rifle_aiming_idle</strong></span> animation clip.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec197"></a>There's more...</h3></div></div></div><p>To read more<a id="id712" class="indexterm"></a> information about the Animator Controller, check out Unity's documentation at <a class="ulink" href="http://docs.unity3d.com/Manual/class-AnimatorController.html" target="_blank">http://docs.unity3d.com/Manual/class-AnimatorController.html</a>.</p></div></div>