<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec83"></a>Choosing destinations – respawn to the most recently passed checkpoint</h2></div></div><hr /></div><p>A <span class="strong"><strong>checkpoint</strong></span> usually<a id="id872" class="indexterm"></a> represents a certain distance through the game (or perhaps a <span class="strong"><strong>track</strong></span>) in which<a id="id873" class="indexterm"></a> an agent (user or NPC) has succeeded reaching. Reaching (or passing) checkpoints often results in bonus awards, such as <span class="emphasis"><em>extra time</em></span>, <span class="emphasis"><em>points</em></span>, <span class="emphasis"><em>ammo</em></span>, and so on. Also, if a player has multiple lives, then often a player will be respawned only back as far as the most recently passed checkpoint, rather than right to the beginning of the level.</p><p>This recipe demonstrates a simple approach to the checkpoints, whereby once the player's character has passed a<a id="id874" class="indexterm"></a> checkpoint, if they die they are moved back only to the most recently passed checkpoint.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_08_09.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec239"></a>Getting ready</h3></div></div></div><p>This recipe builds upon the player-controlled 3D cube Unity project that you created at the beginning of this chapter. So, make a copy of this project, open it, and then follow the steps for this recipe.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec240"></a>How to do it...</h3></div></div></div><p>To have the respawn <a id="id875" class="indexterm"></a>position upon losing a life change depending on the checkpoints passed, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Move the <span class="strong"><strong>Cube-player</strong></span> GameObject to the (12, 0.5, 0) position.</p></li><li><p>Select <span class="strong"><strong>Cube-player</strong></span> in the <span class="strong"><strong>Inspector</strong></span> panel and add a <span class="strong"><strong>Character Controller</strong></span> component by clicking on <span class="strong"><strong>Add Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Character Controller</strong></span> (this is to enable the <code class="literal">OnTriggerEnter</code> collision messages to be received).</p></li><li><p>Create a cube named <span class="strong"><strong>Cube-checkpoint-1</strong></span> at (5, 0, 0), scaled to (1, 1, 20).</p></li><li><p>With <span class="strong"><strong>Cube-checkpoint-1</strong></span> selected, check the <span class="strong"><strong>Is Trigger</strong></span> property of its <span class="strong"><strong>Box Collider</strong></span> component in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Create a <span class="strong"><strong>CheckPoint</strong></span> tag, and assign this tag to <span class="strong"><strong>Cube-checkpoint-1</strong></span>.</p></li><li><p>Duplicate <span class="strong"><strong>Cube-checkpoint-1</strong></span> by naming the <span class="strong"><strong>Cube-checkpoint-2</strong></span> clone and positioning it at (-5, 0, 0).</p></li><li><p>Create a sphere named <span class="strong"><strong>Sphere-Death</strong></span> at (7, 0.5, 0). Assign the <span class="strong"><strong>m_red</strong></span> material to this sphere to make it red.</p></li><li><p>With <span class="strong"><strong>Sphere-Death</strong></span> selected, check the <span class="strong"><strong>Is Trigger</strong></span> property of its <span class="strong"><strong>Sphere Collider</strong></span> component in the <span class="strong"><strong>Inspector</strong></span> panel.</p></li><li><p>Create a <span class="strong"><strong>Death</strong></span> tag, and assign this tag to <span class="strong"><strong>Sphere-Death</strong></span>.</p></li><li><p>Duplicate<a id="id876" class="indexterm"></a> <span class="strong"><strong>Sphere-Death</strong></span>, and position this clone at (0, 0.5, 0).</p></li><li><p>Duplicate <span class="strong"><strong>Sphere-Death</strong></span> a second time, and position this second clone at (-10, 0.5, 0).</p></li><li><p>Add an instance of the following C# script class called <code class="literal">CheckPoints</code> to the <span class="strong"><strong>Cube-player</strong></span> GameObject:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class CheckPoints : MonoBehaviour {
  private Vector3 respawnPosition;

  void Start (){
    respawnPosition = transform.position;
  }

  void OnTriggerEnter (Collider hit){
    if(hit.CompareTag("CheckPoint")){
      respawnPosition = transform.position;
    }

    if(hit.CompareTag("Death")){
      transform.position = respawnPosition;
    }
  }
}</pre></div></li><li><p>Run the scene. If the cube runs into a red sphere <span class="emphasis"><em>before</em></span> crossing a checkpoint, it will be respawned back to its starting position. Once the red cube has passed a checkpoint, if a red sphere is hit, then the cube will be moved back to the location of the most recent checkpoint that it passed through.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec241"></a>How it works...</h3></div></div></div><p>The C# script class called <code class="literal">CheckPoints</code> has one variable called <code class="literal">respawnPosition</code>, which is a Vector3 that refers to the position the player's cube is to be moved to (respawned) if it collides with a <span class="strong"><strong>Death</strong></span> tagged object. The default setting for this is the position of the player's cube when the scene begins—so in the <code class="literal">Start()</code>method, we set it to the player's <a id="id877" class="indexterm"></a>position.</p><p>Each time an object tagged called <span class="strong"><strong>CheckPoint</strong></span> is collided with, the value of <code class="literal">respawnPosition</code> is updated to the current position of the player's red cube at this point in time (that is, where it is when it touches the stretched cube tagged called <span class="strong"><strong>CheckPoint</strong></span>). So that the next time the object tagged <span class="strong"><strong>Death</strong></span> is hit, the cube will be respawned back to where it last touched the object tagged called <span class="strong"><strong>CheckPoint</strong></span>.</p></div></div>