<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec113"></a>Reducing the number of objects by destroying objects at death a time</h2></div></div><hr /></div><p>
<span class="strong"><strong>Optimization principal 1</strong></span>: Minimize the number of active and enabled objects in a scene.</p><p>One way to reduce<a id="id1206" class="indexterm"></a> the number of active objects is to destroy objects when they are no longer needed. As soon as an object is no longer needed, we should destroy it; this saves both memory and processing resources since Unity no longer needs to send the object such messages as <code class="literal">Update()</code> and <code class="literal">FixedUpdate()</code>, or consider object collisions or physics and so on.</p><p>However, there may be times when we wish not to destroy an object immediately, but at some known point in the future. Examples might include after a sound has finished playing (see that recipe <span class="emphasis"><em>Waiting for audio to finish before auto-destructing object</em></span> in <a class="link" href="#" linkend="ch09">Chapter 9</a>, <span class="emphasis"><em>Playing and Manipulating Sounds</em></span>), the player only has a certain time to collect a bonus object before it disappears, or perhaps an object displaying a message to the player should disappear after a certain time.</p><p>This recipe demonstrates how objects can be told to <span class="emphasis"><em>start dying</em></span>, and then to automatically destroy them after a given delay has passed.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_14.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec353"></a>How to do it...</h3></div></div></div><p>To destroy<a id="id1207" class="indexterm"></a> objects after a specified time, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new 2D project.</p></li><li><p>Create a UI <span class="strong"><strong>Button</strong></span> named <span class="strong"><strong>Click Me</strong></span>, and make it stretch to fill the entire window.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, set the Button's <span class="strong"><strong>Text child</strong></span> to have left-aligned and large text.</p></li><li><p>Add the following script class <code class="literal">DeathTimeExample.cs</code> to <span class="strong"><strong>Button Click Me</strong></span>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI;

public class DeathTimeExample : MonoBehaviour {
  public void BUTTON_ACTION_StartDying() {
    deathTime = Time.time + deathDelay;
  }

  public float deathDelay = 4f;
  private float deathTime = -1;

  public Text buttonText;

  void Update(){
    if(deathTime &gt; 0){
      UpdateTimeDisplay();
      CheckDeath();
    }
  }

  private void UpdateTimeDisplay(){
    float timeLeft = deathTime - Time.time;
    string timeMessage = "time left: " + timeLeft;
    buttonText.text = timeMessage;
  }

  private void CheckDeath(){
    if(Time.time &gt; deathTime) Destroy( gameObject );
  }
}</pre></div></li><li><p>Drag the <span class="strong"><strong>Text</strong></span> child of <span class="strong"><strong>Button Click Me</strong></span> into the script's public variable <span class="strong"><strong>Button Text</strong></span>, so<a id="id1208" class="indexterm"></a> this script is able to change the button text to show the countdown.</p></li><li><p>With <span class="strong"><strong>Button Click Me</strong></span> selected in the <span class="strong"><strong>Hierarchy</strong></span>, add a new <span class="strong"><strong>On Click()</strong></span> event for this <a id="id1209" class="indexterm"></a>button, dragging the button itself as the target GameObject and selecting public function <code class="literal">BUTTON_ACTION_StartDying(),</code>as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_11_15.jpg" /></div></li><li><p>Now, run the scene; once the button is clicked, the button's text should show the countdown. Once the countdown gets to zero, <span class="strong"><strong>Button Click Me</strong></span> will be destroyed (including all its children, in this case, just the GameObject <span class="strong"><strong>Text</strong></span>).</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec354"></a>How it works...</h3></div></div></div><p>The float variable <code class="literal">deathDelay</code> stores the number of seconds the object waits before destroying itself once the decision has been made for the object to start dying. The float variable <code class="literal">deathTime</code> either has a value of <code class="literal">-1</code> (no death time yet set) or it is a non-negative value, which is the time we wish the object to destroy itself.</p><p>When the button is<a id="id1210" class="indexterm"></a> clicked, the <code class="literal">BUTTON_ACTION_StartDying()</code> method is called. This method sets this <code class="literal">deathTime</code> variable to the current time plus whatever value is set in <code class="literal">deathDelay</code>. This new value for <code class="literal">deathTime</code> will be a positive number, meaning the <code class="literal">IF</code>-statement in the <code class="literal">Update()</code> method will fire from this point onward.</p><p>Every frame method <code class="literal">Update()</code> checks if <code class="literal">deathTime</code> is greater than zero (that is, a death time has been set), and, if so, it then calls, the <code class="literal">UpdateTimeDisplay()</code> and <code class="literal">CheckDeath()</code> methods.</p><p>The <code class="literal">UpdateTimeDisplay()</code> methods<a id="id1211" class="indexterm"></a> creates a string message stating how many seconds are left and updates the <span class="strong"><strong>Button Text</strong></span> to show this message.</p><p>The <code class="literal">CheckDeath()</code> method tests <a id="id1212" class="indexterm"></a>whether the current time has passed the <code class="literal">deathTime</code>. If the death time has passed, then the parent <code class="literal">gameObject</code> is immediately destroyed.</p><p>When you run the scene, you'll see the <span class="strong"><strong>Button</strong></span> removed from the <span class="strong"><strong>Hierarchy</strong></span> once its death time has been reached.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec355"></a>See also</h3></div></div></div><p>Refer to the following recipes in this chapter for more information:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Reducing the number of enabled objects by disabling objects whenever possible</p></li><li style="list-style-type: disc"><p>Reducing the number of active objects by making objects inactive whenever possible</p></li></ul></div></div></div>