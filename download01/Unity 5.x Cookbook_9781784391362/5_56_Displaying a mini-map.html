<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec59"></a>Displaying a mini-map</h2></div></div><hr /></div><p>In many<a id="id463" class="indexterm"></a> games, a broader view of the scene can be invaluable for navigation and information. Mini-maps are great for giving players that extra perspective that they may need when in first- or third-person mode.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec163"></a>Getting ready...</h3></div></div></div><p>For this recipe, we have prepared the <code class="literal">BasicScene</code> Unity Package, containing a scene named <code class="literal">BasicScene</code>. You will also need to import three image files named <code class="literal">Compass.png, compassMarker.png</code>, and <code class="literal">compassMask.png</code>. All files are available in the <code class="literal">1362_05_05</code> folder.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec164"></a>How to do it...</h3></div></div></div><p>To create a mini-map, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Import the <code class="literal">BasicScene</code> package into a new <span class="strong"><strong>Project</strong></span>. Also, import the provided <code class="literal">png</code> files. Open the <span class="strong"><strong>BasicScene</strong></span> level.</p></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, select the <code class="literal">Compass</code>, <code class="literal">compassMarker</code>, and <code class="literal">compassMask</code> texture files. Then, from the <span class="strong"><strong>Inspector</strong></span>, change their <span class="strong"><strong>Texture Type</strong></span> to <span class="strong"><strong>Sprite (2D and UI)</strong></span>, leaving the <span class="strong"><strong>Sprite Mode</strong></span> as <span class="strong"><strong>Single</strong></span> and the <span class="strong"><strong>Pivot</strong></span> at <span class="strong"><strong>Center</strong></span>. Click on <span class="strong"><strong>Apply</strong></span> to confirm the changes, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_12.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, create a new <span class="strong"><strong>UI Panel</strong></span> object (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Panel</strong></span>). It will be created as a child of the UI <span class="strong"><strong>Canvas</strong></span> GameObject. Rename it <code class="literal">MiniMap</code>. <a id="id464" class="indexterm"></a>Then, from the <span class="strong"><strong>Inspector</strong></span> view, set its alignment to <span class="strong"><strong>Top/Right</strong></span>, change both the <span class="strong"><strong>Width</strong></span> and <span class="strong"><strong>Height</strong></span> to <code class="literal">256</code>, and its <span class="strong"><strong>Pos X</strong></span> and <span class="strong"><strong>Pos Y</strong></span> fields to <code class="literal">-128</code>. Also, populate the <span class="strong"><strong>Source Image </strong></span>field, within the <span class="strong"><strong>Image</strong></span> component, with the <span class="strong"><strong>compassMask</strong></span> sprite, adjusting the <span class="strong"><strong>Color</strong></span> field by bringing <span class="strong"><strong>Alpha</strong></span> up to <code class="literal">255</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_13.jpg" /></div></li><li><p>Add a <span class="strong"><strong>Mask </strong></span>component to <span class="strong"><strong>MiniMap </strong></span>(from the main menu, select <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Mask</strong></span>). Then, from the <span class="strong"><strong>Inspector</strong></span> view, find the <span class="strong"><strong>Mask</strong></span> component and uncheck <span class="strong"><strong>Show Mask Graphic</strong></span> (it will become invisible, serving as a mask for the mini-map).</p></li><li><p>Select the<a id="id465" class="indexterm"></a> <span class="strong"><strong>MsLaser</strong></span> GameObject (which is the player's character), and, from the top of the <span class="strong"><strong>Inspector</strong></span> view, access the <span class="strong"><strong>Layer</strong></span> drop-down menu. Select <span class="strong"><strong>Add Layer…</strong></span> and then name a <span class="strong"><strong>User Layer</strong></span> <code class="literal">Player</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_14.jpg" /></div></li><li><p>Select the <span class="strong"><strong>MsLaser</strong></span> character again, and, from the <span class="strong"><strong>Layer</strong></span> drop-down menu, select <span class="strong"><strong>Player</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_15.jpg" /></div></li><li><p>From the <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>Render Texture</strong></span> and name it <code class="literal">Map_Render</code>. Then, from <span class="strong"><strong>Inspector</strong></span>, change its size to <code class="literal">256 x 256</code>.</p></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, create a new camera (<span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Camera</strong></span>) and rename it<a id="id466" class="indexterm"></a> <code class="literal">MapCamera</code>. From the <span class="strong"><strong>Inspector</strong></span> view, change its parameters as follows (shown in the screenshot that will follow):</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Clear Flags</strong></span>: <code class="literal">Depth Only</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Culling Mask</strong></span>: <code class="literal">Mixed…</code> (unselect<span class="strong"><strong> Player</strong></span>)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Projection</strong></span>: <code class="literal">Orthographic</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Depth</strong></span>: <code class="literal">1</code> (or higher)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Target Texture</strong></span>: <code class="literal">Map_Render</code>
</p></li><li style="list-style-type: disc"><p>Also, uncheck the camera's <span class="strong"><strong>Audio Listener</strong></span> component</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_16.jpg" /></div></li><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> view, right-click on <span class="strong"><strong>MiniMap</strong></span> and navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Raw Image</strong></span> to create a child UI element. Name it <code class="literal">MapTexture</code>. Then, from the <span class="strong"><strong>Inspector</strong></span><a id="id467" class="indexterm"></a> view, populate the <span class="strong"><strong>Texture</strong></span> field with the <code class="literal">Map_Render</code> texture and click on the <span class="strong"><strong>Set Native Size</strong></span> button, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_17.jpg" /></div></li><li><p>Now, right-click on <span class="strong"><strong>MiniMap</strong></span> and navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span> to create another child element. Name it <code class="literal">Compass</code>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, populate the <span class="strong"><strong>Source Image</strong></span> field with the <code class="literal">Compass</code> image and click on the <span class="strong"><strong>Set Native Size</strong></span> button.</p></li><li><p>Once again, right-click on <span class="strong"><strong>MiniMap </strong></span>and navigate to <span class="strong"><strong>UI</strong></span> | <span class="strong"><strong>Image</strong></span> to add another child element. Name it <code class="literal">Marker</code>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, populate the <span class="strong"><strong>Source Image</strong></span> field with the <code class="literal">compassMarker</code> image and click on the <span class="strong"><strong>Set Native Size</strong></span> button.</p></li><li><p>From the<a id="id468" class="indexterm"></a> <span class="strong"><strong>Project</strong></span> view, create a new <span class="strong"><strong>C# Script</strong></span> and name it <code class="literal">MiniMap</code>. Open it and replace everything with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEngine.UI;
using System.Collections;

public class MiniMap : MonoBehaviour
{
  public Transform target;
  public GameObject marker;
  public GameObject mapGUI;
  public float height = 10.0f;
  public float distance = 10.0f;
  public bool rotate = true;
  private Vector3 camAngle;
  private Vector3 camPos;
  private Vector3 targetAngle;
  private Vector3 targetPos;
  private Camera cam;

  void Start(){
    cam = GetComponent&lt;Camera&gt; ();
    camAngle = transform.eulerAngles;
    targetAngle = target.transform.eulerAngles;
    camAngle.x = 90;
    camAngle.y = targetAngle.y;
    transform.eulerAngles = camAngle;
  }

  void Update(){
    targetPos = target.transform.position;
    camPos = targetPos;
    camPos.y += height;
    transform.position = camPos;
    cam.orthographicSize = distance;
    Vector3 compassAngle = new Vector3();
    compassAngle.z = target.transform.eulerAngles.y;

    if (rotate) {
      mapGUI.transform.eulerAngles = compassAngle;
      marker.transform.eulerAngles = new Vector3();
    } else {
      marker.transform.eulerAngles = -compassAngle;
    }

  }
}</pre></div></li><li><p>Save the script<a id="id469" class="indexterm"></a> and attach it to <span class="strong"><strong>MapCamera</strong></span>. Then, from the <span class="strong"><strong>Inspector</strong></span> view, change the parameters of the <span class="strong"><strong>Mini Map</strong></span> component as follows (shown in the screenshot that will follow):</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Target</strong></span>: <code class="literal">MsLaser</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Marker</strong></span>: <code class="literal">Marker</code> (the UI element previously created)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Map GUI</strong></span>: <code class="literal">MiniMap</code> (the UI panel previously created)</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Height</strong></span>: <code class="literal">10</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Distance</strong></span>: <code class="literal">10</code>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Rotate</strong></span>: Checked</p></li></ul></div><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_18.jpg" /></div></li><li><p>Play the scene. You should be able to see the mini-map functioning in the top-right corner of the screen:</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_05_19.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec165"></a>How it works...</h3></div></div></div><p>The main element <a id="id470" class="indexterm"></a>of the mini-map is a texture, used as a GUI element, rendered from an orthographic camera that follows the player from a top-down perspective. Some necessary adjustments were made to <span class="strong"><strong>MapCamera</strong></span>:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Changing its <span class="strong"><strong>Projection</strong></span> mode to <span class="strong"><strong>Orthographic</strong></span> (to make it two-dimensional)</p></li><li style="list-style-type: disc"><p>Excluding the <span class="strong"><strong>Player</strong></span> tag from its <span class="strong"><strong>Culling Mask</strong></span> (to make the character's model invisible to the camera)</p></li><li style="list-style-type: disc"><p>Disabling its <span class="strong"><strong>Audio Listener</strong></span> (so it won't conflict with the main camera)</p></li></ul></div><p>The mini-map was embellished with a compass frame and a marker indicating the player's position. All these GUI elements were parented by a <span class="strong"><strong>Panel</strong></span> that also functioned as a <span class="strong"><strong>Mask</strong></span> to the visual elements. Finally, a script was created, serving three purposes: configuring preferences for the <span class="strong"><strong>Camera</strong></span> (such as the area covered), repositioning the <span class="strong"><strong>Camera</strong></span> at runtime according to the player's transform settings, and rotating the appropriate UI elements.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec166"></a>There's more...</h3></div></div></div><p>If you want to experiment more with your mini-map, read on.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec42"></a>Covering a wider or narrower area</h4></div></div></div><p>The range of the mini-map is given by the <span class="strong"><strong>Distance</strong></span> parameter. A higher value will result in coverage of a <a id="id471" class="indexterm"></a>wider area, as the <span class="strong"><strong>MiniMap</strong></span> class uses<a id="id472" class="indexterm"></a> the same value as the viewport size of the orthographic camera.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec43"></a>Changing the map's orientation</h4></div></div></div><p>The mini-map, by<a id="id473" class="indexterm"></a> default, is set to rotate as the player changes direction. Should you want it to be static, uncheck the <span class="strong"><strong>Rotate</strong></span> option to make the <span class="strong"><strong>Marker</strong></span> rotate instead.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec44"></a>Adapting your mini-map to other styles</h4></div></div></div><p>You can easily <a id="id474" class="indexterm"></a>modify this recipe to make a top or isometric view of a racing game circuit map. Just position the camera manually and prevent it from following the character.</p></div></div></div>