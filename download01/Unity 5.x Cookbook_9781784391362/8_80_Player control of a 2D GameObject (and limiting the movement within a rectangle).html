<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec80"></a>Player control of a 2D GameObject (and limiting the movement within a rectangle)</h2></div></div><hr /></div><p>While the rest of the recipes in this chapter are demonstrated in 3D projects, basic character movement in 2D, and also limiting the movement to a bounding rectangle, are core skills for many<a id="id843" class="indexterm"></a> 2D games, and so this first recipe illustrates how to achieve these features for a 2D game.</p><p>Since in <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Inventory GUI</em></span>, we already have a basic 2D game, we'll adapt this game to restrict the movement to a bounding rectangle.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_08_11.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec228"></a>Getting ready</h3></div></div></div><p>This recipe builds on a simple 2D game called <span class="emphasis"><em>Creating the Simple2DGame_SpaceGirl</em></span> mini-game from <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Inventory GUI</em></span>. Start with a copy of this game, or use the provided completed recipe project as the basis for this recipe.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec229"></a>How to do it...</h3></div></div></div><p>To create a 2D <a id="id844" class="indexterm"></a>sprite controlled by the user with the movement that is limited within a rectangle, follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new empty GameObject named <span class="strong"><strong>corner_max</strong></span>, and position it somewhere above and to the right of the GameObject called <span class="strong"><strong>Player-girl1</strong></span>. With this GameObject selected in the <span class="strong"><strong>Hierarchy</strong></span> view, choose the large yellow oblong icon, highlighted in the <span class="strong"><strong>Inspector</strong></span> panel.</p><div class="mediaobject"><img src="/graphics/9781784391362/graphics/1362OT_08_18.jpg" /></div></li><li><p>Duplicate the <span class="strong"><strong>corner_max</strong></span> GameObject by naming the clone as <span class="strong"><strong>corner_min</strong></span>, and position this clone somewhere below and to the left of the <span class="strong"><strong>player-spaceGirl1</strong></span> GameObject. The coordinates of these two GameObjects will determine the maximum and minimum bounds of movement, permitted for the player's character.</p></li><li><p>Modify the C# Script called <code class="literal">PlayerMove</code> to declare some new variables at the beginning of the class:</p><div class="informalexample"><pre class="programlisting">public Transform corner_max;
public Transform corner_min;
private float x_min;
private float y_min;
private float x_max;
private float y_max;</pre></div></li><li><p>Modify the C# Script called <code class="literal">PlayerMove</code> so that the <code class="literal">Awake()</code> method now gets a reference to the SpriteRenderer, and uses this object to help setup the maximum and <a id="id845" class="indexterm"></a>minimum X and Y movement limits:</p><div class="informalexample"><pre class="programlisting">void Awake(){
  rigidBody2D = GetComponent&lt;Rigidbody2D&gt;();
  x_max = corner_max.position.x;
  x_min = corner_min.position.x;
  y_max = corner_max.position.y;
  y_min = corner_min.position.y;
}</pre></div></li><li><p>Modify the C# Script called <code class="literal">PlayerMove</code> to declare a new method called <code class="literal">KeepWithinMinMaxRectangle()</code>:</p><div class="informalexample"><pre class="programlisting">  private void KeepWithinMinMaxRectangle(){
    float x = transform.position.x;
    float y = transform.position.y;
    float z = transform.position.z;
    float clampedX = Mathf.Clamp(x, x_min, x_max);
    float clampedY = Mathf.Clamp(y, y_min, y_max);
    transform.position = new Vector3(clampedX, clampedY, z);
  }</pre></div></li><li><p>Modify the C# Script called <code class="literal">PlayerMove</code> so that, after having done everything else in the <code class="literal">FixedUpdate()</code>method, a call will finally be made to the <code class="literal">KeepWithinMinMaxRectangle()</code> method:</p><div class="informalexample"><pre class="programlisting">  void FixedUpdate(){
    float xMove = Input.GetAxis("Horizontal");
    float yMove = Input.GetAxis("Vertical");

    float xSpeed = xMove * speed;
    float ySpeed = yMove * speed;

    Vector2 newVelocity = new Vector2(xSpeed, ySpeed);

    rigidBody2D.velocity = newVelocity;	

    // restrict player movement
    KeepWithinMinMaxRectangle();
  }</pre></div></li><li><p>With the <span class="strong"><strong>player-SpaceGirl1</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> view, drag the <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min</strong></span> GameObjects over the public variables called <code class="literal">corner_max</code> and <code class="literal">corner_min</code> in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Before running the scene in the <span class="strong"><strong>Scene</strong></span> panel, try repositioning the <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min </strong></span>GameObjects. When you run the scene, the positions of these two GameObjects (max and min, and X and Y) will be used as the limits of movement for the Player's <span class="strong"><strong>player-SpaceGirl1</strong></span> character.</p></li><li><p>While all this <a id="id846" class="indexterm"></a>works fine, let's make the rectangular bounds of the movement visually explicit in the <span class="strong"><strong>Scene</strong></span> panel by having a yellow "gizmo" rectangle drawn. Add the following method to the C# script class called <code class="literal">PlayerMove</code>:</p><div class="informalexample"><pre class="programlisting">void OnDrawGizmos(){
  Vector3 top_right = Vector3.zero;
  Vector3 bottom_right = Vector3.zero;
  Vector3 bottom_left = Vector3.zero;
  Vector3 top_left = Vector3.zero;

  if(corner_max &amp;&amp; corner_min){
    top_right = corner_max.position;
    bottom_left = corner_min.position;

    bottom_right = top_right;
    bottom_right.y = bottom_left.y;

    top_left = top_right;
    top_left.x = bottom_left.x;
  }

  //Set the following gizmo colors to YELLOW
  Gizmos.color = Color.yellow;

  //Draw 4 lines making a rectangle
  Gizmos.DrawLine(top_right, bottom_right);
  Gizmos.DrawLine(bottom_right, bottom_left);
  Gizmos.DrawLine(bottom_left, top_left);
  Gizmos.DrawLine(top_left, top_right);
}</pre></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec230"></a>How it works...</h3></div></div></div><p>You added the empty GameObjects called <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min</strong></span> to the scene. The X- and Y- coordinates of these GameObjects will be used to determine the bounds of movement that we will permit for the character called <span class="strong"><strong>player-SpaceGirl1</strong></span>. Since these are the empty GameObjects, they will not be seen by the player when in the play-mode. However, we can see and move them in the <span class="strong"><strong>Scene</strong></span> panel, and having added the yellow oblong icons, we can see their positions and names very easily.</p><p>Upon <code class="literal">Awake()</code> the <code class="literal">PlayerMoveWithLimits</code> object, inside the <span class="strong"><strong>player-SpaceGirl1</strong></span> GameObject, records the maximum and minimum X- and Y- values of the GameObjects called <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min</strong></span>. Each time the physics system is called via the <code class="literal">FixedUpdate()</code> method, the velocity of the <span class="strong"><strong>player-SpaceGirl1 </strong></span>character is set according to the horizontal and vertical keyboard/joystick inputs. However, the final action of the <code class="literal">FixedUpdate() </code>method is to call the <code class="literal">KeepWithinMinMaxRectangle() </code>method, which uses the <code class="literal">Math.Clamp(â€¦)</code> function to move the character back inside the X- and Y- limits. This happens so that the player's character is not permitted to move outside the area <a id="id847" class="indexterm"></a>defined by the <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min</strong></span> GameObjects.</p><p>The <code class="literal">OnDrawGizmos() m</code>ethod tests<a id="id848" class="indexterm"></a> that the references to the <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min</strong></span> GameObjects are not null, and then sets the positions of the four Vector3 objects, representing the four corners defined by the rectangle with <span class="strong"><strong>corner_max</strong></span> and <span class="strong"><strong>corner_min</strong></span> at the opposite corners. It then sets the Gizmo color to yellow, and draws lines, connecting the four corners in the <span class="strong"><strong>Scene</strong></span> panel.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec231"></a>See also</h3></div></div></div><p>Refer to the next recipe for more information about limiting player controlled character movements.</p></div></div>