<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec61"></a>Incorporating the non-player characters into our game</h2></div></div><hr /></div><p>First, let's simply drag the <code class="literal">Beetle.Prefab</code> from the <code class="literal">Assets</code>/<code class="literal">Prefab</code> folder in the <strong class="userinput"><code>Project</code></strong> panel to our game in <strong class="userinput"><code>Scene</code></strong> view. Place the <span>beetle</span><a id="id288601248" class="indexterm"></a> somewhere in front of the Cucumber Man so that the beetle can be seen as soon as you put the game into game mode.</p><p>A suggested placement is illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/2bfe5ce6-be6c-4db1-9115-22600ab04334.png" /></div><p>When you put the game into game mode, you will notice that the beetle cycles through its animations. If you double-click the <code class="literal">Beetle.controller</code> in the <code class="literal">Assets</code> | <code class="literal">Beetle</code> folder in the <strong class="userinput"><code>Project</code></strong> panel, you will see, as shown in the following screenshot, that we currently have several animations set to play successively and repeatedly:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/0b8397fc-6313-48cb-b741-c03d2f0e0b2d.png" /></div><p>This initial setup is intended to give you a first, quick way of previewing the various animations. In the next section, we will modify the animation controller.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec70"></a>Working with the Animation Controller</h3></div></div></div><p>We will use an <span>Animation</span><a id="id288608605" class="indexterm"></a> Controller to <span>organize</span><a id="id288608614" class="indexterm"></a> our NPCs' animations. The Animation Controller will also be used to manage the transitions between animations.</p><p>Before we start making changes to our Animation Controller, we need to identify what states our beetle has and then determine what transitions each state can have in relation to other states.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note34"></a>Note</h3><p>Animation states can be referred to as the character's state of animation. For example, walking is a state, as are running and jumping.</p></div><p>Here are the states that the beetle can have, each tied to an animation:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><span>Idle on Ground</span></li><li style="list-style-type: disc">Walking on Ground</li><li style="list-style-type: disc">Eating on Ground</li><li style="list-style-type: disc">Attacking on Ground</li><li style="list-style-type: disc"><span>Die</span> on Ground</li><li style="list-style-type: disc">Stand</li><li style="list-style-type: disc">Standing Idle</li><li style="list-style-type: disc">Standing Walk</li><li style="list-style-type: disc">Standing Run</li><li style="list-style-type: disc">Standing Attack</li><li style="list-style-type: disc"><span>Die</span> Standing</li></ul></div><p>With the preceding list of states, we can assign the following transitions:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">From Idle on Ground to:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Walking on Ground</li><li style="list-style-type: disc">Running on Ground</li><li style="list-style-type: disc">Eating on Ground</li><li style="list-style-type: disc">Attacking on Ground</li><li style="list-style-type: disc">Stand</li></ul></div></li><li style="list-style-type: disc">From Stand to:
<div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Standing Idle</li><li style="list-style-type: disc">Standing Walk</li><li style="list-style-type: disc">Standing Run</li><li style="list-style-type: disc">Standing Attack</li></ul></div></li></ul></div><p>Reviewing the transitions from Idle on Ground to Stand demonstrates the type of state-to-state transition decisions you need to make for your game. </p><p>Let's turn our attention back to the <strong class="userinput"><code>Animation Controller</code></strong> window. You will notice that there are two tabs in the left panel of that window:<strong class="userinput"><code>Layers</code></strong>and<strong class="userinput"><code>Parameters</code></strong>. The<strong class="userinput"><code>Layers</code></strong>tab shows a<strong class="userinput"><code>Base Layer</code></strong>. While we can create additional layers, we do not need to do this for our game. The <strong class="userinput"><code>Parameters</code></strong> tab is empty, and that is fine. We will make our changes using the <strong class="userinput"><code>Layout</code></strong> area of the<strong class="userinput"><code>Animation Controller</code></strong>window. That is the area with the grid background.</p><p>Let's start by making the following changes. For all 11 <strong class="userinput"><code>New State</code></strong> buttons, do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Left-click the state button</li><li>Look in the <strong class="userinput"><code>Inspector</code></strong> panel to determine which animation is associated with the state button</li><li>Rename the state name in the <strong class="userinput"><code>Inspector</code></strong> panel to reflect the animation.</li><li>Click the return button</li><li>Double-check the state button to ensure your change was made</li></ol></div><p>When you have completed the preceding five steps for all 11 states, your <strong class="userinput"><code>Animation Controller</code></strong> window should match the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/516d130b-c179-4a10-af8f-29a5b4739f1a.png" /></div><p>If you were to put the game into game mode, you would see that nothing has changed. We only changed the state names so they made more sense to us. So, we have some more work to do with the <strong class="userinput"><code>Animation Controller</code></strong>.</p><p>Currently, the Attacking on Ground state is the default. That is not what we want. It makes more sense to have the <span class="strong"><strong>Idle on Ground</strong></span> state to be our default. To make that change, right-click the <span class="strong"><strong>Idle on Ground</strong></span> state and select <strong class="userinput"><code>Set as Layer Default State</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/4c121b08-e83d-4c6f-8b73-d084520d06bf.png" /></div><p>Next, we need to make a series of changes to the state transitions. There are a lot of states and there will be a lot of transitions. In order to make things easier, we will start by deleting all the default transitions. To accomplish this, left-click each white line with an arrow and press your keyboard's <span class="emphasis"><em>Delete</em></span> key. Do not delete the orange line that goes from <span class="strong"><strong>Entry</strong></span> to <span class="strong"><strong>Idle on Ground</strong></span>.</p><p>After all transitions have been deleted, you can drag your states around so you have more working room. You might temporarily reorganize them in a manner similar to what is shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/dd2e5e9d-f0fb-4556-aae5-f337e08b8c13.png" /></div><p>Our next task is to create all of our state transitions. Follow these steps for each state transition you want to add:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Right-click the originating state.</li><li>Select <strong class="userinput"><code>Create Transition</code></strong>.</li><li>Click on the destination state.</li></ol></div><p>Once you have made all your transitions, you can reorganize your <span>states</span><a id="id288614700" class="indexterm"></a> to declutter the Animation Controller's layout area. A suggested <span>final</span><a id="id288614710" class="indexterm"></a> organization is provided in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/2aeb830b-c487-4f5c-8dd3-5f472282d306.png" /></div><p>As you can see in our final arrangement, we have 11 states and over two dozen transitions. You will also note that the <span class="strong"><strong>Die on Ground</strong></span> and <span class="strong"><strong>Die Standing</strong></span> states do not have any transitions. In order for us to use these animations in our game, they must be placed into an <strong class="userinput"><code>Animation Controller</code></strong>. </p><p>Let's run a quick experiment:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select the <strong class="userinput"><code>Beetle</code></strong> character in the <strong class="userinput"><code>Hierarchy</code></strong> panel. </li><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, click the <strong class="userinput"><code>Add Component</code></strong> button.</li><li>Select <strong class="userinput"><code>Physics | Box Collider</code></strong>.</li><li>Click the <strong class="userinput"><code>Edit Collider</code></strong> button.
</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Modify the size and position of the box collider so that it encases the entire beetle body.</li><li>Click the <strong class="userinput"><code>Edit Collider</code></strong> button again to get out of edit mode.</li></ol></div><p>Your box collider should look similar to what is depicted in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/25bf2064-68fb-478a-9813-7d28613f3859.png" /></div><p>Next, let's create a script that <span>invokes</span><a id="id288614841" class="indexterm"></a> the Die on Ground <span>animation</span><a id="id288614850" class="indexterm"></a> when the Cucumber Man character collides with the beetle. This will simulate the Cucumber Man stepping on the beetle. Follow these steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Select the <strong class="userinput"><code>Beetle</code></strong> character in the <strong class="userinput"><code>Hierarchy</code></strong> panel. </li><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, click the <strong class="userinput"><code>Add Component</code></strong> button.</li><li>Select <strong class="userinput"><code>New Script</code></strong>.</li><li>Name the script <code class="literal">BeetleNPC</code>.</li><li>Click the <strong class="userinput"><code>Create and Add</code></strong> button.</li><li>In the project view, select <strong class="userinput"><code>Favorites | All Scripts | BeetleNPC</code></strong>.</li><li>Double-click the <code class="literal">BeetleNPC</code> script file.</li><li>Edit the script so that it matches the following code block:</li></ol></div><pre class="programlisting">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

publicclassBeetleNPC : MonoBehaviour {

Animatoranimator;

// Use this for initialization
voidStart () {
animator = GetComponent&amp;lt;Animator&gt;();    
    }

// Collision Detection Test
voidOnCollisionEnter(Collisioncol) 
    {
if (col.gameObject.CompareTag("Player"))
        {
animator.Play("Die on Ground");
        }
    }
}</pre><p>This code detects a collision between the Cucumber Man and the beetle. If a collision is detected, the <code class="literal">Die on Ground</code> animation is played.  As you can see in the following screenshot, the Cucumber Man defeated the Cucumber Beetle:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/db2ef1b8-716a-4f22-8a7d-5560c53c63d2.png" /></div><p>This short test demonstrated two <span>important</span><a id="id288614933" class="indexterm"></a> things that will <span>help</span><a id="id288614941" class="indexterm"></a> us further develop this game:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Earlier in this section, you renamed all the states in the <strong class="userinput"><code>Animation Controller</code></strong> window. The names you gave the states are the ones you will reference in code. </li><li style="list-style-type: disc">Since the animation we used did not have any transitions to other states, the Cucumber Beetle will remain in the final position of the animation unless we script it otherwise. So, if we had 100 beetles and defeated them all, all 100 would remain on their backs in the game world.</li></ul></div><p>This was a simple and successful scripting test for our Cucumber Beetle. We will need to write several more scripts to manage the beetles in our game. First, there are some game world modifications we will make. </p></div></div>