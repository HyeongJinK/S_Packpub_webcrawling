<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch11lvl1sec77"></a>Updating the player's health</h2></div></div><hr /></div><p>In this section, we will fully implement our player's health. We will start the Cucumber Man with three lives, each with a full health value of 100. We will update our scripts so that the Cucumber Man loses health when a cucumber beetle attacks him. Our approach will be to deduct one point from the Cucumber Man's health for every second that it is colliding with a Cucumber Beetle. We will also script the HUD's health bar <span>and</span><a id="id288345145" class="indexterm"></a> start with that task in the next section.</p><p>Before we get started, you should open your Unity game project. Alternatively, you can download the<span class="emphasis"><em>Starting-Chapter-11</em></span><span class="emphasis"><em> Unity</em></span> project available from the publisher's companion site.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec97"></a>Scripting the health bar</h3></div></div></div><p>In this section, we will create a new script <span>and</span><a id="id288601255" class="indexterm"></a> attach it to our HUD's health bar. We will edit the script and use it to manage our Cucumber Man's health and the visible status of the HUD's health bar.</p><p>Let's start by reviewing our health bar:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Hierarchy</code></strong> panel, select the <code class="literal">HUD_Canvas</code> | <code class="literal">Health_Slider</code>.
</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, review the <strong class="userinput"><code>Slider (Script)</code></strong> component. As you can see in the following screenshot, there is a <strong class="userinput"><code>Value</code></strong> component with a slider at the bottom of the interface:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788830102/graphics/d5214f01-70b5-4bc1-bf14-2ce0454f3e00.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Click the <strong class="userinput"><code>Game</code></strong> view tab so you can see the HUD without being in game-mode.</li><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, drag the <strong class="userinput"><code>Value</code></strong> slider and observe how the health bar functions.</li></ol></div><p>You can see that the health bar already functions; we merely need to add a script to the slider so that it tracks the player's health and updates the HUD during game play. Here are those steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, click the <strong class="userinput"><code>Add Component</code></strong> button</li><li>Select <strong class="userinput"><code>New Script</code></strong> and name the script <code class="literal">HealthManager</code></li><li>In the <strong class="userinput"><code>Project</code></strong> panel, click <strong class="userinput"><code>Favorites</code></strong> | <strong class="userinput"><code>All Scripts</code></strong></li><li>Drag the <code class="literal">HealthManager</code> script to the <code class="literal">Assets</code> | <code class="literal">Custom Scripts</code> folder</li><li>Double-click the <code class="literal">HealthManager</code> script to open it in an editor
</li></ol></div><p> </p><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Edit the script so that it matches the following code, the first section of the code contains the namespace <code class="literal">import</code> statements and the <code class="literal">HealthManager</code>class declaration:</li></ol></div><pre class="programlisting">using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

publicclassHealthManager:MonoBehaviour{
</pre><p>The next section of code declares our class variables. We will use<code class="literal">currentHealth</code>to hold the value of the Cucumber Man's up-to-date health value. We will use<code class="literal">healthBar</code>as a reference to the slider:</p><pre class="programlisting">public static int currentHealth;
public Slider healthBar;
</pre><p>Our<code class="literal">HealthManager</code>class has three methods; the first is the <code class="literal">Awake()</code> method. The first statement in this method gets a reference to the<code class="literal">Slider</code>component. The second statement sets the <code class="literal">currentHealth</code> to <code class="literal">100</code>. This is our maximum health starting point for the Cucumber Man:</p><pre class="programlisting">void Awake () {
healthBar = GetComponent&amp;lt;Slider&gt; ();
currentHealth = 100;
}

</pre><p>Our second method is the <code class="literal">ReduceHealth()</code> method. This will be used by other scripts to call for a health reduction. As you can see, the first statement simply decrements the <code class="literal">currentHealth</code> value by one. The second statement updates the slider on the screen:</p><pre class="programlisting">void ReduceHealth () {
currentHealth = currentHealth - 1;
healthBar.value = currentHealth;
}
</pre><p>The last method for this class is the <code class="literal">Update()</code> method. We have one statement in that method to update the slider for each frame of the game. This results in the slider accurately depicting the player's health:</p><pre class="programlisting">void Update () {
healthBar.value = currentHealth;
}
 }</pre><p>In the next section, we will modify the appropriate script to call the <code class="literal">ReduceHealth()</code> method when the Cucumber Man is being bitten by a Cucumber Beetle. </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch11lvl2sec98"></a>Decrementing health</h3></div></div></div><p>Our <code class="literal">BeetleNPC</code> script already <span>detects</span><a id="id288614363" class="indexterm"></a> collisions with the Cucumber Man, so we can simply update that script to deduct a point from the Cucumber Man's health when a collision is detected. We will do this by making a call to the <code class="literal">ReduceHealth()</code> method of the <code class="literal">HealthManager</code> script. Here are the steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Project</code></strong> panel, select <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Custom Scripts</code></strong> and double-click the <code class="literal">BeetleNPC</code> script.</li><li>Add the following statement in the class variables section of the script. This creates a variable we can use to reference the <code class="literal">HealthManager</code> class:</li></ol></div><pre class="programlisting">      public HealthManager _healthManager;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Add the following two statements in the <code class="literal">OnCollisionEnter()</code> method after the first <code class="literal">if</code> statement:</li></ol></div><pre class="programlisting">      _healthManager=GameObject.Find
      ("Health_Slider").GetComponent&amp;lt;HealthManager&gt;();
      _healthManager.ReduceHealth();</pre><p>With these two statements, we obtain a reference to the <code class="literal">HealthManager</code> script of <code class="literal">Health_Slider</code>, and then call the <code class="literal">ReduceHealth()</code> method.</p><p>You can now test your game and watch the health bar change as Cucumber Beetles start attacking the Cucumber Man.</p></div></div>