<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec55"></a>Animating our player character</h2></div></div><hr /></div><p>Your Cucumber Man character <span>controller</span><a id="id288345145" class="indexterm"></a> package includes the necessary assets to support the character's six animations. In this section, we will look at the Cucumber Man's animations, which are listed as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">Idle</li><li style="list-style-type: disc">Walk</li><li style="list-style-type: disc">Run</li><li style="list-style-type: disc">Jump</li><li style="list-style-type: disc">Throw</li><li style="list-style-type: disc">Die</li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec67"></a>Reviewing the player controller script</h3></div></div></div><p>There are a couple of areas in Unity in <span>which</span><a id="id288608694" class="indexterm"></a> we can review the Cucumber Man's animations. Let's first look at the<strong class="userinput"><code>Player Controller (Script)</code></strong>component of the<code class="literal">CucumberMan</code><strong class="userinput"><code>Controller</code></strong>object. When you select the<strong class="userinput"><code>CucumberMan</code></strong>controller in the hierarchy pane, you should see the<strong class="userinput"><code>Player Controller (Script)</code></strong>component in the <strong class="userinput"><code>Inspector</code></strong> panel. You might need to click the expand button to the left of the component in order to reveal the component's details. </p><p>As shown in the following screenshot, each of our character's animations has a state associated with it:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/d65283d3-d03e-43b9-ab88-790e479d00ee.png" /></div><p>Now, let's review the <code class="literal">PlayerController.cs</code> script. You can access this file by selecting the <strong class="userinput"><code>All Scripts</code></strong> button in the <strong class="userinput"><code>Project</code></strong> panel, under <strong class="userinput"><code>Favorites</code></strong>. Then, scroll to the <strong class="userinput"><code>PlayerController</code></strong><strong class="userinput"><code> (Script)</code></strong> in the <strong class="userinput"><code>Project</code></strong> panel. The first 14 lines of the script are shown in the following code fragment:</p><pre class="programlisting">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerController : MonoBehaviour {

  public string RunState, WalkState, IdleState, JumpState, DieState, ThrowState;
  bool isWalking, isRunning, isJumping, isIdle, isDie, forward,left,right,back;
  Animator mAnim;
  // Use this for initialization
  void Start () {
    mAnim = GetComponent&lt;Animator&gt;();
    isIdle = true;
   }</pre><p>The first three lines simply identify the namespaces we want to use in our script. These are <code class="literal">System.Collections</code>, <code class="literal">System.Collections.Generic</code>, and <code class="literal">UnityEngine</code>. Next, we have the class declaration for our <code class="literal">PlayerController</code> class. The next three lines of code are our variable definitions. As you can see, there is a public string for each of our six animations: <code class="literal">RunState</code>, <code class="literal">WalkState</code>, <code class="literal">IdleState</code>, <code class="literal">JumpState</code>, <code class="literal">DieState</code>, and <code class="literal">ThrowState</code>. There are also several <code class="literal">boolean</code> (<code class="literal">bool</code>) variables including <code class="literal">isWalking</code>, <code class="literal">isRunning</code>, <code class="literal">isJumping</code>, <code class="literal">isIdle</code>, and <code class="literal">isDie</code>. We also identify <code class="literal">mAnim</code> as our animator. We will see how each of these is used later in the script.</p><p>The <code class="literal">Start()</code> method sets our initial state of <code class="literal">isIdle</code> to true and gets a reference to our <strong class="userinput"><code>Animator</code></strong> with the <code class="literal">mAnim = GetComponent&lt;Animator&gt;();</code> statement.</p><p>The largest method of our <code class="literal">PlayerController.cs</code> script is the <code class="literal">Update()</code> method. The <code class="literal">Update()</code> method is called once per frame. This method is provided in the following code segments, with ellipses (...) to reflect areas where code was removed for brevity. You can refer to the full script in Unity. The first code segment sets the appropriate states to true or false. For example, when the user presses the <span class="emphasis"><em>W</em></span> key and the player is not currently running, the <code class="literal">isWalking</code> variable is set to true and the <code class="literal">mAnim.SetBool</code> is <span>passed two parameters (</span><code class="literal">WalkState</code> and <code class="literal">true</code>). Similar actions are taken for the <span class="emphasis"><em>A</em></span>, <span class="emphasis"><em>S</em></span>, and <span class="emphasis"><em>D</em></span> keys:</p><pre class="programlisting">. . . 
void Update () {
  //Down states
  if( Input.GetKeyDown(KeyCode.W))
  {
    if( !isRunning )
    {
      isWalking = true;
      isIdle = false;
      forward = true;
      mAnim.SetBool(WalkState, true);
      mAnim.SetBool(IdleState, false);
      }
   }
   if( Input.GetKeyDown(KeyCode.A))
   {
      . . . 
   }
   if( Input.GetKeyDown(KeyCode.S))
   {
      . . . 
   }
   if( Input.GetKeyDown(KeyCode.D))
   {
      . . .
   }
. . . </pre><p>The next code snippet from the <code class="literal">Update()</code> method, shown in the following snippet, handles the running animation when the left <span class="emphasis"><em>Shift</em></span> key is pressed. In <span>this</span><a id="id288614842" class="indexterm"></a> instance, the animation is changed from the <code class="literal">WalkState</code> to the <code class="literal">RunState</code>:</p><pre class="programlisting">. . . 
if( Input.GetKeyDown(KeyCode.LeftShift))
{
  if( isWalking )
  {
    isRunning = true;
    mAnim.SetBool(RunState, true);
    mAnim.SetBool(WalkState, false);
  }
}
. . . </pre><p>The next segment of code, provided in the following snippet, shows how detecting the spacebar input results in the <code class="literal">Jump()</code> animation running and the <code class="literal">Throw()</code> animation running when the <span class="emphasis"><em>E</em></span> key is detected:</p><pre class="programlisting">. . . 
if( Input.GetKeyDown(KeyCode.Space))
{
  Jump();
}

if( Input.GetKeyDown(KeyCode.E))
{
  Throw();
}
. . . </pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec68"></a>Reviewing the Animator component</h3></div></div></div><p>There is one final component in the <code class="literal">CucumberMan</code><strong class="userinput"><code>Controller</code></strong> object to review: the <strong class="userinput"><code>Animator</code></strong> component. As you can <span>see</span><a id="id288615100" class="indexterm"></a> in the following screenshot, the <strong class="userinput"><code>Animator</code></strong> component has two key properties: <strong class="userinput"><code>Controller</code></strong> and <strong class="userinput"><code>Avatar</code></strong>:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/275ac508-455e-47c6-8615-849b8d1568f3.png" /></div><p>The controller points to the <code class="literal">CucumberMan.controller</code> file. The file's <code class="literal">.controller</code> file extension will not be displayed in the component interface, but it is a reference to that file. You can navigate to that file in the project pane. It is located under <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Cucumber Man</code></strong>. When you double-click that file, it opens in an <strong class="userinput"><code>Animator</code></strong> window, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/e09b369a-b62c-4c53-82a7-3cce9442d25e.png" /></div><p>Here, you can see each of the states, one for each animation, along with the possible transitions between them. Each state is labeled with a <code class="literal">CM_</code> prefix to indicate the <code class="literal">CucumberMan</code>. These states are listed as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><strong class="userinput"><code>CM_Idle</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>CM_Walk</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>CM_Run</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>CM_Jump</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>CM_Throw</code></strong></li><li style="list-style-type: disc"><strong class="userinput"><code>CM_Die</code></strong></li></ul></div><p>If the layout of the <strong class="userinput"><code>Animator</code></strong><span>window</span><a id="id288615190" class="indexterm"></a> is jumbled or unclear, you can rearrange the objects in the <strong class="userinput"><code>Animator</code></strong> window so they are easy to understand. You accomplish this by clicking on a state, dragging it to where you want it, and releasing the mouse button. The following graphic shows one possible organizational approach to the Cucumber Man's states and transitions. Your approach can differ, if you like:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/04545e65-e4f0-4ca8-85fa-1d34628841c2.png" /></div><p>You can leave these transitions as they have been provided to you, or, if you want to, you can make changes using the <strong class="userinput"><code>Animator</code></strong> window.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec69"></a>Previewing the animations</h3></div></div></div><p>You have the option of previewing individual <span>animations</span><a id="id288615225" class="indexterm"></a> without putting the game into game-mode. In the <strong class="userinput"><code>Project</code></strong> panel, select <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Cucumber Man</code></strong> and you will see the individual animations listed. For example, click the <code class="literal">CucumberMan_Throw</code> animation. This is the <code class="literal">CucumberMan_Throw.fbx</code> file that is part of the package you imported earlier in this chapter. </p><p>With the animation selected, the <strong class="userinput"><code>Inspector</code></strong> panel gives you access to the <strong class="userinput"><code>Model</code></strong>, <strong class="userinput"><code>Rig</code></strong>, and <strong class="userinput"><code>Animations</code></strong> tabs. Although you do not need to make any changes here, it is worth your time to explore the various features. When you select the <strong class="userinput"><code>Animations</code></strong> tab, you have access to a preview of the animation at the bottom the <strong class="userinput"><code>Inspector</code></strong> panel, as illustrated in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/892da9f9-0969-4976-a1ba-68ab811252f5.png" /></div><p>You can click the play button in the top-left corner of the animation preview window to play the animation. The animation will play and loop until you stop the animation. </p><p>You can preview each animation by playing the game as well. This is true for all of the animations, except the die animation; we will have to write a script to evoke that animation. We will do this in <a class="link" href="#" linkend="ch11">Chapter 11</a>, <span class="emphasis"><em>Scripting Victory and Defeat</em></span>.</p></div></div>