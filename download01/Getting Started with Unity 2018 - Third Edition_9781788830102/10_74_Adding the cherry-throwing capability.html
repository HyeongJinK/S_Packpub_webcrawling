<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch10lvl1sec73"></a>Adding the cherry-throwing capability</h2></div></div><hr /></div><p>In <a class="link" href="#" linkend="ch07">Chapter 7</a>, <span class="emphasis"><em>Implementing our Player Character</em></span>, we demonstrated the Cucumber Man's throw animation using the <span class="emphasis"><em>E</em></span> keyboard key. In this section, we will make the necessary changes to instantiate a cherry in the Cucumber Man's right <span>hand</span><a id="id288601244" class="indexterm"></a> when the <span class="emphasis"><em>E</em></span> keyboard key is pressed and then allow it to be launched. We will check to ensure the Cucumber Man has at least one cherry in his inventory so we know whether a cherry should be instantiated or not. Okay, let's get started.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec92"></a>Creating a spot for the cherry</h3></div></div></div><p>The following steps demonstrate how to create a spot for the cherry on the Cucumber Man's right hand.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><span>In the</span><strong class="userinput"><code>Hierarchy</code></strong> panel, expand the <code class="literal">CucumberMan</code> object until you see <code class="literal">Character1_RightHand</code><strong class="userinput"><code>.</code></strong></li><li>Right-click<code class="literal">Character1_RightHand</code>and select<strong class="userinput"><code>Create Empty</code></strong>.</li><li>Rename the new GameObject to<code class="literal">cherrySpot</code>. This will be the spot where we render the cherry.</li></ol></div><p>Your <code class="literal">CucumberMan</code>object's hierarchy<span>should</span><a id="id288603867" class="indexterm"></a>look as follows:</p><div class="mediaobject"><img src="/graphics/9781788830102/graphics/62253289-f143-4be3-a7ac-7ebad56e7b83.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Using the transform tools, move the <code class="literal">cherrySpot</code> GameObject so that it is inside the Cucumber Man's right hand. Your placement should be similar to what is displayed here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788830102/graphics/fc943a57-6393-4ce6-9ded-b5675005320a.png" /></div><p>We will need to add a <code class="literal">Rigidbody</code> to the <code class="literal">Cherry</code> prefab so we can instantiate and throw it during runtime.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Project</code></strong> panel, select <strong class="userinput"><code>Assets</code></strong> | <strong class="userinput"><code>Cherry</code></strong> | <code class="literal">Cherry.Prefab</code></li><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, click the <strong class="userinput"><code>Add Component</code></strong> button</li><li>Select <strong class="userinput"><code>Physics</code></strong> | <strong class="userinput"><code>Rigidbody</code></strong></li><li>Uncheck the <strong class="userinput"><code>Use Gravity</code></strong> option</li><li>Expand the <strong class="userinput"><code>Constraints</code></strong> section of the <strong class="userinput"><code>Rigidbody</code></strong> component</li><li>Check all <strong class="userinput"><code>Freeze Position</code></strong> and <strong class="userinput"><code>Freeze Rotation</code></strong> boxes</li></ol></div><p>Next, we will add the <code class="literal">Cherry</code> prefab to our scene.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Drag the <strong class="userinput"><code>Cherry</code></strong> prefab from the <strong class="userinput"><code>Projec</code></strong>t panel to the <strong class="userinput"><code>Hierarchy</code></strong> panel, making it subordinate to the <strong class="userinput"><code>cherrySpot</code></strong> game object.
</li><li>In <strong class="userinput"><code>Scene</code></strong> view, zoom in and adjust the location of the<strong class="userinput"><code>cherrySpot</code></strong>so the cherry looks as if the Cucumber Man is holding it. A suggested placement is shown here:</li></ol></div><div class="mediaobject"><img src="/graphics/9781788830102/graphics/8bca58f2-f1c6-4a31-8d1f-7ff67dfaf8f8.png" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch10lvl2sec93"></a>Writing a CherryControl script</h3></div></div></div><p>Next, we will add a script to the <span>cherry</span><a id="id288608704" class="indexterm"></a> prefab to support the creation and release of the cherry with respect to the Cucumber Man's hand.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>In the <strong class="userinput"><code>Project</code></strong> panel, select <strong class="userinput"><code>Assets | Cherry |</code></strong><code class="literal">Cherry.Prefab</code></li><li>In the <strong class="userinput"><code>Inspector</code></strong> panel, click the <strong class="userinput"><code>Add Component</code></strong> button</li><li>Select <strong class="userinput"><code>New Script</code></strong> and name the script <strong class="userinput"><code>CherryControl</code></strong></li><li>Click the <strong class="userinput"><code>Create and Add</code></strong> button</li><li>In the <strong class="userinput"><code>Project</code></strong> panel, drag the new script into the <code class="literal">Assets</code><strong class="userinput"><code>|</code></strong><code class="literal">Custom Scripts</code> folder</li><li>Edit the script so that it matches what is provided in the following code block</li></ol></div><p>The first part of the script consists of the namespace import statements and the class declaration:</p><pre class="programlisting"> using System.Collections;
using System.Collections.Generic;
using UnityEngine;

publicclassCherryControl:MonoBehaviour{
</pre><p>The next section contains the class variables. We have one <code class="literal">Rigidbody</code>, two floats, and a <code class="literal">GameObject</code>:</p><pre class="programlisting">publicRigidbodycherry;
publicfloatthrowDistance=2000000000f;
publicfloattime2Die=4.0f;

GameObjectcucumberHand;</pre><p>The <code class="literal">Update()</code> method, shown here, checks to see whether the <span class="emphasis"><em>E</em></span> keyboard key <span>is pressed</span> and whether the Cucumber Man has at least one cherry:</p><pre class="programlisting">voidUpdate(){

intcount=CucumberManManager.currentCherryCount;

if(Input.GetKeyDown(KeyCode.E)){

if(count&gt;=1){

ThrowACherry();
}
}
}
</pre><p>The last section of the code is the <code class="literal">ThrowACherry()</code> method. As you can see, we clone the cherry at the Cucumber Man's hand, turn gravity on, release the constraints, and push it forward using the <code class="literal">AddForce()</code> method. Next, we use the <code class="literal">Destroy()</code> method to destroy the cloned cherry in four seconds. The last statement decrements the Cucumber Man's cherry inventory:</p><pre class="programlisting">publicvoidThrowACherry(){

RigidbodycherryClone=(Rigidbody)Instantiate
               (cherry,transform.position,transform.rotation);
cherryClone.useGravity=true;
cherryClone.constraints=RigidbodyConstraints.None;
cherryClone.AddForce(transform.forward*throwDistance);
Destroy(cherryClone.gameObject,time2Die);

CucumberManManager.currentCherryCount=CucumberManManager.currentCherryCount-1;
}
}</pre></div></div>