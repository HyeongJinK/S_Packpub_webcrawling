<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec47"></a>Integrating the Scriptable Object with the level</h2></div></div><hr /></div><p>In this <a id="id302" class="indexterm"></a>section, we will integrate the <code class="literal">LevelSetting</code> class with our levels and then test how Scriptable Objects allow us to modify values <a id="id303" class="indexterm"></a>in the play mode.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec63"></a>Updating the Level and the LevelInspector class</h3></div></div></div><p>The first change to be made is to update the <code class="literal">Level</code> class. So, instead of using the current variables<a id="id304" class="indexterm"></a> for the gravity, bgm, and background, start <a id="id305" class="indexterm"></a>using a <code class="literal">LevelSetting</code> class as a reference.</p><p>Let's make a small update in <code class="literal">Level.cs</code> file. Add the following lines to it:</p><div class="informalexample"><pre class="programlisting">[SerializeField]
  private LevelSettings _settings;

  public LevelSettings Settings {
    get { return _settings; }
    set { _settings = value; }
  }</pre></div><p>We need to take care of the render of this new property.</p><p>We will update the <code class="literal">DrawLevelDataGUI</code> method in the <code class="literal">LevelInspector</code> class:</p><div class="informalexample"><pre class="programlisting">private void DrawLevelDataGUI () {
      EditorGUILayout.LabelField ("Data", _titleStyle);
      EditorGUILayout.BeginVertical ("box");
      EditorGUILayout.PropertyField (_serializedTotalTime);
      _myTarget.Settings = (LevelSettings) EditorGUILayout.
      ObjectField("Level Settings", _myTarget.Settings,
      typeof(LevelSettings), false);
      if(_myTarget.Settings != null) {
        Editor.CreateEditor(_myTarget.Settings).OnInspectorGUI();
      } else {
        EditorGUILayout.HelpBox("You must attach a LevelSettings
        asset!", MessageType.Warning);
      }
      EditorGUILayout.EndVertical ();
      _myTarget.SetGravity();
    }</pre></div><p>We removed all the lines related to rendering the GUI for the gravity, bgm, and background fields and used the same approach that we used in <a class="link" href="#" linkend="ch05">Chapter 5</a>, <span class="emphasis"><em>Customizing the Scene View</em></span>, to render the inspector of the <code class="literal">LevelSettings</code> Scriptable Object.</p><p>Now, back in the <code class="literal">Level</code> class, we will modify the C# properties of the gravity, bgm, and background variables in order to use the <code class="literal">LevelSettings</code> instance:</p><div class="informalexample"><pre class="programlisting">public float Gravity {
<span class="strong"><strong>      get { return ((_settings != null) ? _settings.gravity : 0); }</strong></span>
<span class="strong"><strong>      set { </strong></span>
<span class="strong"><strong>        if(_settings != null) {</strong></span>
<span class="strong"><strong>          _settings.gravity = value; </strong></span>
<span class="strong"><strong>        }</strong></span>
<span class="strong"><strong>      }</strong></span>
    }

    public AudioClip Bgm {
<span class="strong"><strong>      get { return (_settings != null) ? _settings.bgm : null; }</strong></span>
<span class="strong"><strong>      set { </strong></span>
<span class="strong"><strong>        if(_settings != null) {</strong></span>
<span class="strong"><strong>          _settings.bgm = value; </strong></span>
<span class="strong"><strong>                }</strong></span>
<span class="strong"><strong>            }</strong></span>
    }

    public Sprite Background {
<span class="strong"><strong>      get { return (_settings != null) ? _settings.background : null; }</strong></span>
<span class="strong"><strong>      set { </strong></span>
<span class="strong"><strong>        if(_settings != null) {</strong></span>
<span class="strong"><strong>          _settings.background = value; </strong></span>
<span class="strong"><strong>                }</strong></span>
<span class="strong"><strong>            }</strong></span>
    }</pre></div><p>Finally, comment <a id="id306" class="indexterm"></a>the following lines of code (we don't need these anymore):</p><div class="informalexample"><pre class="programlisting">        // [SerializeField]
        // private float _gravity = -30;
        // [SerializeField]
        // private AudioClip _bgm;
        // [SerializeField]
        // private Sprite _background;</pre></div><p>These<a id="id307" class="indexterm"></a> updates will keep the change we did transparent for the rest of the <span class="emphasis"><em>Run &amp; Jump</em></span> implementation.</p><p>Save and wait for Unity to compile. Then, select a level scene; you will see a new field in the level custom inspector:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_07.jpg" /></div><p>Now, drag <span class="strong"><strong>Moon.asset</strong></span> to the <span class="strong"><strong>Settings</strong></span> field. As soon this is done, you will see the <span class="strong"><strong>Gravity</strong></span> field <a id="id308" class="indexterm"></a>appear in the custom inspector<a id="id309" class="indexterm"></a> with the <span class="strong"><strong>Bgm</strong></span> and <span class="strong"><strong>Background</strong></span> fields:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_08.jpg" /></div><p>Perfect! Now that we have successfully integrated the scriptable object in our level, it is time to start tweaking the gravity!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec64"></a>Tweaking the level settings in the play mode</h3></div></div></div><p>Open the level we <a id="id310" class="indexterm"></a>created at the beginning, <span class="strong"><strong>Test_level</strong></span>, and attach the <span class="strong"><strong>Moon</strong></span> asset to the <span class="strong"><strong>Settings</strong></span> field. Now, click on the <span class="strong"><strong>Play</strong></span> button.</p><p>If you select the <span class="strong"><strong>View</strong></span> tab, you can start playing the game. Press the spacebar to jump and use the arrows to move Timmy around the level:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_01.jpg" /></div><p>This level has seven platforms. Adjust the gravity to make Timmy reach the first four platforms from left to right using a single jump.</p><p>This is a <a id="id311" class="indexterm"></a>simplified scenario of what tweak gameplay variables can be, but you should get the idea and also extend this to other possible situations.</p><p>As soon as you reach the right value, stop the game. You will see that the new gravity value remains.</p><p>Now, based on the level settings you use, your level can be easy, hard, or impossible to beat, and by that I mean you will not be able to finish the level. The good thing is, you have the basic tools to make the necessary tweaks to avoid impossible levels.</p></div></div>