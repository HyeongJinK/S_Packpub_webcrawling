<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec14"></a>Creating gizmos through code</h2></div></div><hr /></div><p>We explored how<a id="id45" class="indexterm"></a> to add simple gizmos through the Unity editor. This section will cover how to properly implement the <code class="literal">OnDrawGizmos</code> and <code class="literal">OnDrawGizmosSelected</code> methods to achieve a similar but more flexible solution.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note05"></a>Note</h3><p>All the scripts in this section are examples, and are not meant to be used in the Level Creator tool.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec15"></a>The OnDrawGizmos and OnDrawGizmosSelected methods</h3></div></div></div><p>To get started, in a new project, create a script called <code class="literal">GizmoExample.cs</code>. We will use this as a <a id="id46" class="indexterm"></a>guinea pig for our first gizmos experiments (don't worry, the script is not going to suffer too much!)</p><p>Write the <a id="id47" class="indexterm"></a>following code in <code class="literal">GizmoExample.cs</code>:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
public class GizmoExample : MonoBehaviour {
        private void OnDrawGizmos() { 
        }
}</pre></div><p>When you implement the <code class="literal">OnDrawGizmos</code> method, you can add gizmos that always drawn in the <span class="strong"><strong>Scene View</strong></span> and also allows the possibility to be selected with a click.</p><p>In this case, the method is empty. However, if you come back to Unity and wait for the compiler to end, you'll find that the class <span class="strong"><strong>GizmoExample</strong></span> is listed in the <span class="strong"><strong>Gizmos</strong></span> dropdown on the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_05.jpg" /></div><p>The <span class="strong"><strong>Gizmos</strong></span> dropdown allows you to change the way gizmos are displayed in the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span>. At the top of the dropdown, you can change the scale size that gizmos are drawn at; next to that, you<a id="id48" class="indexterm"></a> will see a list of the available gizmos. To <a id="id49" class="indexterm"></a>turn gizmos on or off, simply click on the checkbox to hide or show the gizmo itself.</p><p>If you select the column icon associated with <span class="strong"><strong>GizmoExample</strong></span>, you will get the same kind of results we saw when we clicked on the cube icon in the inspector. Here, again, you can choose between using a label, a built-in icon, or a custom icon. For now, just choose a label.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip05"></a>Tip</h3><p>Changing the icon in the <span class="strong"><strong>Gizmos</strong></span> dropdown will also change the icon used to represent the script in the <span class="strong"><strong>Project</strong></span> browser and the inspector.</p></div><p>As soon you add the <code class="literal">GizmoExample.cs</code> script to a new game object in the scene, a gizmo label with the name of the game object will be displayed in the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip06"></a>Tip</h3><p>The <code class="literal">OnDrawGizmos</code> method is not called if the component collapses in the <span class="strong"><strong>inspector</strong></span> window.</p></div><p>We explored a<a id="id50" class="indexterm"></a> simple way to make our script visible to <a id="id51" class="indexterm"></a>Unity, but there are more powerful things to explore. Remove the icon from the <span class="strong"><strong>Gizmos</strong></span> dropdown and update the <code class="literal">GizmoExample.cs</code> script as follows:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class GizmoExample : MonoBehaviour {
  
  private void OnDrawGizmos () { 
    Gizmos.color = Color.white;
    Gizmos.DrawCube (
      transform.position, Vector3.one);
  }

  private void OnDrawGizmosSelected () { 
    Gizmos.color = Color.red;
    Gizmos.DrawWireCube (
      transform.position, Vector3.one);
  }
}</pre></div><p>We added a new method, <code class="literal">OnDrawGizmosSelected</code>. Implement this to draw gizmos only if the object is selected. Here, gizmos aren't pickable.</p><p>Inside the <code class="literal">OnDrawGizmos</code> and <code class="literal">OnDrawGizmosSelected</code> methods, we made use of the Gizmos class to draw gizmos. Now, you should see a solid cube in the position of the game object with the <code class="literal">GizmoExample.cs</code> script attached, and then a solid cube with a color outline when this game object is selected:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_06.jpg" /></div><p>At this point, you may have noticed that the Gizmos class is part of the <code class="literal">UnityEngine</code> namespace instead <a id="id52" class="indexterm"></a>of the <code class="literal">UnityEditor</code> namespace. This <a id="id53" class="indexterm"></a>means you can use it in your <code class="literal">MonoBehaviour</code> class directly if you have the method <code class="literal">OnDrawGizmos</code> or <code class="literal">OnDrawGizmosSelected</code> implemented.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip07"></a>Tip</h3><p>Take into consideration that these methods are called in an Editor context and will not be available in your final video game.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec16"></a>Adding gizmos using the DrawGizmo attribute</h3></div></div></div><p>The <code class="literal">DrawGizmo</code> attribute<a id="id54" class="indexterm"></a> allows you to display gizmos using a separated class from the original <code class="literal">MonoBehaviour</code> class and without using the <code class="literal">OnDrawGizmos</code> or <code class="literal">OnDrawGizmosSelected</code> method explicitly.</p><p>Here, we will need two scripts. The first one, called <code class="literal">TargetExample.cs</code>, is the <code class="literal">MonoBehaviour</code> class we want to add the gizmo; and the second one, called <code class="literal">DrawGizmoExample.cs</code> is a script that implements the gizmo.</p><p>Let's start creating the script <code class="literal">TargetExample.cs</code> in a new project:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class TargetExample : MonoBehaviour {
  
}</pre></div><p>As we can see, no gizmo logic was added here. Because the <code class="literal">DrawGizmo</code> attribute is part of the <code class="literal">UnityEditor</code> namespace, we will create the <code class="literal">DrawGizmoExample.cs</code> script inside an <code class="literal">Editor</code> folder. For this, add the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEditor;

public class DrawGizmoExample {

    // This emulates OnDrawGizmos
    [DrawGizmo(GizmoType.NotInSelectionHierarchy | 
               GizmoType.InSelectionHierarchy | 
               GizmoType.Selected | 
               GizmoType.Active | 
               GizmoType.Pickable)]
    private static void MyCustomOnDrawGizmos(
        TargetExample targetExample, GizmoType gizmoType) {
        Gizmos.color = Color.white;
        Gizmos.DrawCube(
            targetExample.transform.position, Vector3.one);
    }
}</pre></div><p>Save everything <a id="id55" class="indexterm"></a>you've done so far, and in a new scene, add a game object with <code class="literal">TargetExample.cs</code> attached. You will see this:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_07.jpg" /></div><p>The <code class="literal">TargetExample</code> class is rendering a gizmos cube similar to the past example, but now the <code class="literal">DrawGizmoExample.cs</code> , and external editor script, is responsible of that.</p><p>Any method meant to be used for render gizmos, in this case, <code class="literal">MyCustomOnDrawGizmos</code>, must be static and take two parameters: the object for which the gizmo is being drawn, and a <code class="literal">GizmoType</code> parameter, which indicates the context in which the gizmo is being drawn. Inside this method, you can use the Gizmos class again to add all the gizmos you want.</p><p>Then, to make this work, we used the <code class="literal">DrawGizmo</code> attribute on the method <code class="literal">MyCustomOnDrawGizmos</code> and passed as parameters the <code class="literal">GizmoType</code> we want to use. These are flags that specify scenarios in which the gizmos will be rendered and their behavior.</p><p>The <code class="literal">GizmoType</code> method offers five properties you can use:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">InSelectionHierarchy</code>: This draws the gizmo if it is selected or it is a child of the selected</p></li><li style="list-style-type: disc"><p>
<code class="literal">NotInSelectionHierarchy</code>: This draws the gizmo if it is not selected and also no parent is selected</p></li><li style="list-style-type: disc"><p>
<code class="literal">Selected</code>: This draws the gizmo if it is selected</p></li><li style="list-style-type: disc"><p>
<code class="literal">Active</code>: This draws the gizmo if it is active (shown in the inspector)</p></li><li style="list-style-type: disc"><p>
<code class="literal">Pickable</code>: The gizmo to be drawn can be picked from the editor</p></li></ul></div><p>In the case<a id="id56" class="indexterm"></a> of <code class="literal">MyCustomOnDrawGizmos</code>, to emulate the behavior of the <code class="literal">OnDrawGizmos</code> method, we used all the gizmo types available. You can use different combinations to achieve different results, for example, let's try to emulate the behavior of <code class="literal">OnDrawGizmosSelected</code> creating a method called <code class="literal">MyCustomOnDrawGizmosSelected</code> inside the <code class="literal">DrawGizmoExample</code> class:</p><div class="informalexample"><pre class="programlisting">[DrawGizmo(GizmoType.InSelectionHierarchy | 
               GizmoType.Active)]
    private static void MyCustomOnDrawGizmosSelected(
      TargetExample targetExample, GizmoType gizmoType) {
      Gizmos.color = Color.red;
      Gizmos.DrawWireCube(
        targetExample.transform.position, Vector3.one);
    }</pre></div><p>Save the changes and wait for Unity to compile the scripts, and then you will see the functionality of the original <code class="literal">OnDrawGizmosSelected</code> method achieved by the <code class="literal">MyCustomOnDrawGizmosSelected</code> method:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_08.jpg" /></div><p>Here, we presented an alternative to rendering gizmos in Unity, but in most cases, using the <code class="literal">OnDrawGizmos</code> or <code class="literal">OnDrawGizmosSelected</code> method is enough to create visual aids in the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span>.</p><p>In which <a id="id57" class="indexterm"></a>scenarios do you want to use this approach? Well, one instance is if you really want to separate what is related to your video game and what is related to the editor stuff. However, most of the times, this approach would be helpful when you don't have access to the implementation of the specific <code class="literal">MonoBehaviour</code> class, so using the method <code class="literal">OnDrawGizmos</code> or <code class="literal">OnDrawGizmosSelected</code> is not possible.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec17"></a>The Gizmos class</h3></div></div></div><p>The <code class="literal">Gizmos</code> class has<a id="id58" class="indexterm"></a> all the methods to draw gizmos in the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span> and we will explore these methods in this section. If you want to reproduce the examples that we will work on here, just add the code snippets inside a <code class="literal">MonoBehaviour</code> class.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note06"></a>Note</h3><p>This section is an extended version of the official documentation about the Gizmos class. If you <a id="id59" class="indexterm"></a>want to check the original version visit: <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Gizmos.html" target="_blank">http://docs.unity3d.com/ScriptReference/Gizmos.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec01"></a>DrawCube</h4></div></div></div><p>This draws a solid box with center and size.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawCube(Vector3 center, Vector3 size);
public Vector3 center = Vector3.zero;
public Vector3 size = Vector3.one;

private void OnDrawGizmos() {
  Gizmos.DrawCube(center, size);
} Result:  </pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_09.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec02"></a>DrawWireCube</h4></div></div></div><p>This draws a wireframe box with center and size.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawWireCube(Vector3 center, Vector3 size);
public Vector3 center = Vector3.zero;
public Vector3 size = Vector3.one;

private void OnDrawGizmos() {
  Gizmos.DrawWireCube(center, size);
} Result:  </pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_10.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec03"></a>DrawSphere</h4></div></div></div><p>This draw a solid sphere with center and radius.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawSphere(Vector3 center, float radius);
public Vector3 center = Vector3.zero;
public float radius = 1f;

private void OnDrawGizmos() {
  Gizmos.DrawSphere(center, radius);
} Result:  </pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_11.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec04"></a>DrawWireSphere</h4></div></div></div><p>This draws a wireframe sphere with center and radius.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawWireSphere(Vector3 center, float radius);
public Vector3 center = Vector3.zero;
public float radius = 1f;

private void OnDrawGizmos() {
  Gizmos.DrawWireSphere(center, radius);
} Result:  </pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_12.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec05"></a>DrawRay</h4></div></div></div><p>This draws<a id="id60" class="indexterm"></a> a ray , a line starting at some position and going in some direction. This is a good way to visualize ray casting algorithms when you are unsure what the length or direction of a ray is.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signatures public static void DrawRay(Ray r);
// public static void DrawRay(Vector3 from, Vector3 direction);
public Vector3 from = Vector3.zero;
public Vector3 direction = Vector3.up;

private void OnDrawGizmos() {
  Gizmos.DrawRay(from, direction);
} Result:  </pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_13.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec06"></a>DrawLine</h4></div></div></div><p>This draws a line.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawLine(Vector3 from, Vector3 to);
public Vector3 from = new Vector3(1, 0, 0);
public Vector3 to = new Vector3(0, 0, 1);
  
private void OnDrawGizmos() {
  Gizmos.DrawLine(from, to);
} Result:</pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_14.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec07"></a>DrawIcon</h4></div></div></div><p>This draws an<a id="id61" class="indexterm"></a> icon at the world space <code class="literal">Vector3</code>, in <code class="literal">Center</code> at the specified position. The icon should be a regular image file, such as a PNG or JPG image, which is to be placed in the <code class="literal">Assets/Gizmos</code> folder. Whether or not the icon will be scaled and displayed or hidden is determined in the <span class="strong"><strong>Gizmos</strong></span> dropdown. Using this method instead of the approach we saw at the beginning of this chapter gives you more control over the icons. For example, you can simulate toggle icons to visually represent boolean values in your code.</p><p>To make this code work, we previously created a copy of the asset <code class="literal">Game/Art/UI/ UI_LivesAvatar.png</code> inside a folder called <code class="literal">Gizmos</code>. Note that the icon always faces the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span> camera.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawIcon(Vector3 center, string name, bool allowScaling = true);
private void OnDrawGizmos() {
  Gizmos.DrawIcon(
     transform.position, "icon.png");
} Result:</pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_15.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec08"></a>DrawGUITexture</h4></div></div></div><p>This draws the <code class="literal">Texture</code> inside the <code class="literal">ScreenRect</code> method on the <span class="strong"><strong>Scene</strong></span> <span class="strong"><strong>View</strong></span> using the XY plane (where the Z coordinate is zero). The values of the texture rectangle are given in scene<a id="id62" class="indexterm"></a> units.</p><p>The optional border values specify an inset from each edge within the rectangle in scene units; the texture is drawn inside the inset rectangle and the edge pixels are repeated outward.</p><p>In this example, we pass the reference of the texture as a parameter. You will see that the texture is inverted; this is because the origin of the coordinate system is in the top-left corner.</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawGUITexture(Rect screenRect, Texture texture, Material mat = null);
// public static void DrawGUITexture(Rect screenRect, Texture texture, int leftBorder, int rightBorder, int topBorder, int bottomBorder, Material mat = null);
public Rect screenRect = new Rect(0, 0, 100, 100);
public Texture theTexture;
  
private void OnDrawGizmos() {
  if(theTexture != null) {
    Gizmos.DrawGUITexture(screenRect, theTexture);
   }
} Result:</pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_16.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec09"></a>DrawFrustrum</h4></div></div></div><p>The <code class="literal">DrawFrustrum</code> draws a camera frustum using the currently set <code class="literal">Gizmos.matrix</code> for its location <a id="id63" class="indexterm"></a>and rotation (don't worry about the meaning of the <code class="literal">Gizmos.matrix</code> variable, we will talk about that soon).</p><p>Example:</p><div class="informalexample"><pre class="programlisting">// Method signature public static void DrawFrustum(Vector3 center, float fov, float maxRange, float minRange, float aspect);
public Vector3 center = Vector3.zero;
public float fov = 60;
public float maxRange = 1;
public float minRange = 3;
public float aspect = 1.3f;
  
private void OnDrawGizmos() {
  Gizmos.DrawFrustum(
    center, fov, maxRange, minRange, aspect);
}</pre></div><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_02_17.jpg" /></div><p>Now, you have all the necessary knowledge to work with gizmos, so apply what you learned to move forward with the development of the Level Creator tool.</p></div></div></div>