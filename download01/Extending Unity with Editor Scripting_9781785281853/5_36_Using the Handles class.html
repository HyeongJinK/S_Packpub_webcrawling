<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec37"></a>Using the Handles class</h2></div></div><hr /></div><p>In this section, we are going to extend the capabilities to the Edit mode, allowing the user to also reallocate <a id="id237" class="indexterm"></a>the position of the pieces in the grid. To <a id="id238" class="indexterm"></a>achieve this, we will use the class <code class="literal">Handles</code>.</p><p>In Unity, a handle is a 3D control you use to manipulate items in the Scene View. The <code class="literal">Handles</code> class allows you to use several built-in handle GUIs, such as the tools to position, scale, and rotate an object via the Transform component. Let's take a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_05_21.jpg" /></div><p>The <code class="literal">Handles</code> class is also used to add the GUI to the Scene View. We did that at the beginning of the chapter using the methods <code class="literal">BeginGUI</code> and <code class="literal">EndGUI</code>.</p><p>Let's make the <a id="id239" class="indexterm"></a>necessary changes to make this work. Let's add this <a id="id240" class="indexterm"></a>code snippet defining two variables to the <code class="literal">LevelInspector</code> class to save the original position of the piece:</p><div class="informalexample"><pre class="programlisting">private int _originalPosX;
private int _originalPosY;</pre></div><p>Then we will create a new method called <code class="literal">Move</code>:</p><div class="informalexample"><pre class="programlisting">private void Move() {
  Vector3 gridPoint = _myTarget.WorldToGridCoordinates(_itemInspected.transform.position);
  int col = (int) gridPoint.x;
  int row = (int) gridPoint.y;
  
  if(col == _originalPosX &amp;&amp; row == _originalPosY) {
    return;
  }
  
  if(!_myTarget.IsInsideGridBounds(col,row) ||  _myTarget.Pieces[col + row * _myTarget.TotalColumns] != null) {
    _itemInspected.transform.position =  _myTarget.GridToWorldCoordinates( _originalPosX, _originalPosY);
  } else {
    _myTarget.Pieces[ _originalPosX + _originalPosY *  _myTarget.TotalColumns] = null;
    _myTarget.Pieces[col + row * _myTarget.TotalColumns] = _itemInspected.GetComponent&lt;LevelPiece&gt;();
    _myTarget.Pieces[col + row * _myTarget.TotalColumns].transform.position = _myTarget.GridToWorldCoordinates(col,row);
  }
}</pre></div><p>This method will check whether the final position of the piece is different from the original one, and if it is, it will check whether the new position is empty. If the movement is not possible, the piece is returned to the original position.</p><p>It's time to add a handle. We are going to update the method <code class="literal">EventHandler</code>. Inside the switch statement, replace the content of the Edit case with this:</p><div class="informalexample"><pre class="programlisting">case Mode.Edit:
  if(Event.current.type == EventType.MouseDown) {
    Edit(col , row);
<span class="strong"><strong>    _originalPosX = col;</strong></span>
<span class="strong"><strong>    _originalPosY = row;</strong></span>
  }
<span class="strong"><strong>  if(Event.current.type == EventType.MouseUp || </strong></span>
<span class="strong"><strong>     Event.current.type == EventType.Ignore) {</strong></span>
<span class="strong"><strong>    if(_itemInspected != null) {</strong></span>
<span class="strong"><strong>      Move ();</strong></span>
<span class="strong"><strong>    }</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>  </strong></span>
<span class="strong"><strong>  if(_itemInspected != null) {</strong></span>
<span class="strong"><strong>    _itemInspected.transform.position = </strong></span>
<span class="strong"><strong>      Handles.FreeMoveHandle(</strong></span>
<span class="strong"><strong>        _itemInspected.transform.position, </strong></span>
<span class="strong"><strong>        _itemInspected.transform.rotation, </strong></span>
<span class="strong"><strong>        Level.GridSize / 2 , </strong></span>
<span class="strong"><strong>        Level.GridSize / 2 * Vector3.one, </strong></span>
<span class="strong"><strong>        Handles.RectangleCap);</strong></span>
<span class="strong"><strong>  }</strong></span>
  break;</pre></div><p>Now when <a id="id241" class="indexterm"></a>Edit mode is activated, if the user makes a click we <a id="id242" class="indexterm"></a>will proceed as usual but will also save the position of that click (the original position of a piece if there is a piece there).</p><p>If the user releases the mouse button during the movement, the method <code class="literal">Move</code> will perform the logic to reallocate the piece in the level. We added the event <code class="literal">Ignore</code> to capture the situation of the mouse outside the Scene View.</p><p>To perform the movement, all the work is delegated to the handle. We used the method <code class="literal">FreeMoveHandle</code> to do this. This method receives as parameters the position, rotation, size of the handle (in this case, the grid size), a vector with the size to snap, and a method to use for drawing the handle. The result will be a square around the piece and the new position.</p><p>Save the changes and wait for Unity to compile, create a new level, and paint several pieces on it; then, click on <span class="strong"><strong>Edit</strong></span> and start moving these pieces. Let's take a look at the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_05_22.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note29"></a>Note</h3><p>The <code class="literal">Handle</code> class<a id="id243" class="indexterm"></a> is a very useful class for <a id="id244" class="indexterm"></a>manipulating content in the Scene View. To learn more <a id="id245" class="indexterm"></a>about it, visit <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Handles.html" target="_blank">http://docs.unity3d.com/ScriptReference/Handles.html</a>.</p></div></div>