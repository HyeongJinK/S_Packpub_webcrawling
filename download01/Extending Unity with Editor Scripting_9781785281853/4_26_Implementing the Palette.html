<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec28"></a>Implementing the Palette</h2></div></div><hr /></div><p>In this section, we <a id="id159" class="indexterm"></a>will get hands on with the implementation of the Palette. Just to maintain a certain level of abstraction, in some cases, we will talk about Palette items instead level piece prefabs.</p><p>For us, a Palette item is what is displayed in the Palette, and this can be anything; in this case, a level piece prefab.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec36"></a>Creating a category system</h3></div></div></div><p>We need<a id="id160" class="indexterm"></a> some data to make the Palette window functional. The first step is to categorize the available level piece prefabs in the game. In <span class="emphasis"><em>Run &amp; Jump</em></span>, all the level piece prefabs are located in <code class="literal">Prefabs/LevelPieces</code>:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_04_08.jpg" /></div><p>We will create a script with a mission to save information about the level piece prefabs, which includes the category. Inside the <code class="literal">Tools/LevelCreator/Scripts</code> folder, create a script called <code class="literal">PaletteItem.cs</code> with the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

namespace RunAndJump.LevelCreator {
  public class PaletteItem: MonoBehaviour {
    #if UNITY_EDITOR
        public enum Category {
            Misc,
            Collectables,
            Enemies,
            Blocks,
        }

        public Category category = Category.Misc;
        public string itemName = "" ;
        public Object inspectedScript;
    #endif
  }
}</pre></div><p>Save the<a id="id161" class="indexterm"></a> script, and then attach this script to each level piece prefab. By doing this, each prefab will have the following properties:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">category</code>: This is a value from the enum category that defines in which one the level piece prefab will be displayed. The default category is <code class="literal">Misc</code>.</p></li><li style="list-style-type: disc"><p>
<code class="literal">itemName</code>: This is the name associated to the level piece prefab.</p></li><li style="list-style-type: disc"><p>
<code class="literal">inspectedScript</code>: This is a reference to the script that gives the main behavior to the piece. This will be used to access the specific properties of the level piece prefab later.</p></li></ul></div><p>As these properties are only necessary in the Editor context, a preprocessor directive using the symbol <code class="literal">UNITY_EDITOR</code> was added.</p><p>The final step here is to fill the fields of the properties in the inspector. As a reference, use the following table:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /><col align="left" /><col align="left" /></colgroup><thead><tr><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Prefab</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Category</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Name</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Reference</p>
</th></tr></thead><tbody><tr><td style="" align="left" valign="top">
<p>EnemyYellowFace</p>
</td><td style="" align="left" valign="top">
<p>Enemies</p>
</td><td style="" align="left" valign="top">
<p>Angry Blob</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">EnemyYellowFaceController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>HazardSpikes</p>
</td><td style="" align="left" valign="top">
<p>Blocks</p>
</td><td style="" align="left" valign="top">
<p>Spikes</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">HazardSpikesController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>InteractiveCoin</p>
</td><td style="" align="left" valign="top">
<p>Collectables</p>
</td><td style="" align="left" valign="top">
<p>Coin</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">InteractiveCoinController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>InteractiveGoalFlag</p>
</td><td style="" align="left" valign="top">
<p>Misc</p>
</td><td style="" align="left" valign="top">
<p>Goal Flag</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">InteractiveGoalFlag.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>InteractiveSign</p>
</td><td style="" align="left" valign="top">
<p>Misc</p>
</td><td style="" align="left" valign="top">
<p>Sign</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">InteractiveSignController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>InteractiveTreasure</p>
</td><td style="" align="left" valign="top">
<p>Collectables</p>
</td><td style="" align="left" valign="top">
<p>Treasure</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">InteractiveTreasureController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>Player</p>
</td><td style="" align="left" valign="top">
<p>Misc</p>
</td><td style="" align="left" valign="top">
<p>Timmy</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">PlayerController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>SolidDirt</p>
</td><td style="" align="left" valign="top">
<p>Blocks</p>
</td><td style="" align="left" valign="top">
<p>Dirt</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">BlockController.cs</code>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>SolidGrass</p>
</td><td style="" align="left" valign="top">
<p>Blocks</p>
</td><td style="" align="left" valign="top">
<p>Grass</p>
</td><td style="" align="left" valign="top">
<p>
<code class="literal">BlockController.cs</code>
</p>
</td></tr></tbody></table></div><p>At the end, you <a id="id162" class="indexterm"></a>will have something like this for each level piece prefab:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_04_09.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note21"></a>Note</h3><p>Don't forget to attach the main script to the <span class="strong"><strong>Inspected Script</strong></span> property!</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec37"></a>Finding assets using the AssetDatabase class</h3></div></div></div><p>To be<a id="id163" class="indexterm"></a> able to get a reference to all the level pieces in the project, we will create a utility method called <code class="literal">GetAssetsWithScripts</code> inside the <code class="literal">EditorUtils</code> class:</p><div class="informalexample"><pre class="programlisting">public static List&lt;T&gt; GetAssetsWithScript&lt;T&gt; (string path) where T : MonoBehaviour {
      T tmp;
      string assetPath;
      GameObject asset;
      List&lt;T&gt; assetList = new List&lt;T&gt; ();
      string[] guids = AssetDatabase.FindAssets ("t:Prefab", new string[] {path});
      for (int i = 0; i &lt; guids.Length; i++) {
        assetPath = AssetDatabase.GUIDToAssetPath (guids [i]);
        asset = AssetDatabase.LoadAssetAtPath (assetPath, typeof(GameObject)) as GameObject;
        tmp = asset.GetComponent&lt;T&gt; ();
        if (tmp != null) {
          assetList.Add (tmp);
        }
      }
      return assetList;
    }</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>Here, we use generics to maximize code reuse. Because of this, you must add <code class="literal">using System.Collections.Generic</code>; to your <code class="literal">EditorUtils</code> class. To know more about generics, visit <a class="ulink" href="https://msdn.microsoft.com/en-us/library/512aeb7t.aspx" target="_blank">https://msdn.microsoft.com/en-us/library/512aeb7t.aspx</a>.</p></div><p>This method receives a generic type and a path, and will search all the prefabs relative to the path that has a script corresponding to the generic type attached. The result is a list with all the script instances.</p><p>To achieve this, <code class="literal">GetAssetsWithScript</code> uses the <code class="literal">AssetDatabase</code> class, part from the <code class="literal">UnityEditor</code> namespace. This class is used as an interface for accessing assets and performing operations on assets.</p><p>The <code class="literal">FindAssets</code> method searches the asset database using a search filter string and returns a list of GUID. Here, we look for all the assets with the type prefab, and as a second parameter, we focus the search to one specific path (this method accepts an array of paths if you need).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>GUID is an acronym for global unique identifier. This is a number that represents a unique identity for an entity.</p></div><p>With the GUIDs, we use two other methods to get a game object instance of each prefab: <code class="literal">GUIDToAssetPath</code> and <code class="literal">LoadAssetAtPath</code>.</p><p>Finally, we check whether the game object has the script attached. If the answer is yes, this will be <a id="id164" class="indexterm"></a>added to the list and returned by the method.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note24"></a>Note</h3><p>The <code class="literal">AssetDatabase</code> class is very useful class to deal with the asset management<a id="id165" class="indexterm"></a> in our project through <a id="id166" class="indexterm"></a>code. To get more information, visit <a class="ulink" href="http://docs.unity3d.com/ScriptReference/AssetDatabase.html" target="_blank">http://docs.unity3d.com/ScriptReference/AssetDatabase.html</a>.</p></div></div></div>