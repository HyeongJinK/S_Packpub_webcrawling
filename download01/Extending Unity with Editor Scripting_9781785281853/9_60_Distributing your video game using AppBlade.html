<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec57"></a>Distributing your video game using AppBlade</h2></div></div><hr /></div><p>In this section, you will <a id="id373" class="indexterm"></a>learn how to integrate with <span class="strong"><strong>AppBlade</strong></span> to our pipeline to distribute Android builds.</p><p>AppBlade is a <a id="id374" class="indexterm"></a>platform<a id="id375" class="indexterm"></a> for mobile application distribution, simplifying how you share your mobile applications or video games with your team and testers. Using the application available on Google Play and the AppStore, you can install and run your builds directly in your phone.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec77"></a>Creating an AppBlade account</h3></div></div></div><p>The first<a id="id376" class="indexterm"></a> thing to do is to create a new account on the AppBlade website. Open your favorite browser and <a id="id377" class="indexterm"></a>go to <a class="ulink" href="http://appblade.com" target="_blank">http://appblade.com</a>. There are several pricing alternatives, but the one we will use is Indie, which allows us to have 25 devices registered for free before we start paying $1 per additional device:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_FD09_014.jpg" /></div><p>Click on <a id="id378" class="indexterm"></a>the <span class="strong"><strong>Sign up</strong></span> link and follow the steps to create an account. Appblade will ask you to confirm your e-mail before you continue, as soon as you are ready, you will see the main page. Click on the <span class="strong"><strong>New Project</strong></span> button:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_FD09_015.jpg" /></div><p>Here you need to complete information related to your new project, this includes the name and description. In this case, we use the name <code class="literal">Run And Jump</code>.</p><p>When you have finished, click on the <span class="strong"><strong>Create Project</strong></span> button. Your project will appear in the main page of the project you created:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_FD09_016.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec78"></a>Uploading the build</h3></div></div></div><p>Using the <a id="id379" class="indexterm"></a>API of AppBlade, we will upload our builds directly to this platform. But before we do that, we need to generate a <a id="id380" class="indexterm"></a>
<span class="strong"><strong>CI Token</strong></span>. This is a key that allows us to integrate AppBlade with other services.</p><p>In the main page of your project, go to the bottom and click on the link <span class="strong"><strong>Generate your</strong></span> <span class="strong"><strong>first CI token</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_FD09_017.jpg" /></div><p>You will be redirected to a new page with a form asking for two things: a name to identify this new token and an e-mail address to send you an alert if there is an error uploading a build using this token. For this example, we used the name <code class="literal">Run-and-Jump-builds</code>. When you are ready, click on the <span class="strong"><strong>Create Continuous Integration Token</strong></span> button.</p><p>After asking <a id="id381" class="indexterm"></a>for you account password, you will see the following:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_FD09_018.jpg" /></div><p>With this token, we are ready to perform the integration in Unity, so now is the time to code. We will use a Bash script that requires <span class="strong"><strong>cURL</strong></span> to work and a library that lets you make HTTP requests. If you don't have <a id="id382" class="indexterm"></a>cURL installed, visit <a class="ulink" href="http://curl.haxx.se/download.html" target="_blank">http://curl.haxx.se/download.html</a>.</p><p>Create a new script called <code class="literal">mac-appblade.sh</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">#! /usr/bin/env sh

CI_TOKEN="$1"
BUNDLE_PATH="$2"

# Uploading to AppBlade...
curl -# 
-H "Authorization: Bearer $CI_TOKEN" 
-F "version[bundle]=@$BUNDLE_PATH" \
https://appblade.com/api/3/versions</pre></div><p>This script<a id="id383" class="indexterm"></a> receives the CI Token and the path to the build in order to upload. Using cURL we call the API of AppBlade to take care of the rest, pretty simple.</p><p>In the script <code class="literal">Builder.cs</code> we will create the wrapper for this, similar to the Git Hash:</p><div class="informalexample"><pre class="programlisting">private static string appBladeKey = "7d90cf1850ff68bf127baca0780f3381";

private static string PublishOnAppblade (string build) {
  string command = batchPath + "/mac-appblade.sh";
  string arguments = string.Format("{0} {1}", appBladeKey, build);
  string output = ExecuteCommand (command, arguments);
  return output.Trim();
}</pre></div><p>Inside the <code class="literal">PublishOnAppblade()</code> method, we execute the script passing two parameters, the CI Token and the path to the build.</p><p>Let's include this in the <code class="literal">Build</code> method:</p><div class="informalexample"><pre class="programlisting">public static void Build(BuildTarget target, string buildName) {
  BuildSettings.UpdateSettings();
  GenerateBuildInfo ();
  string[] scenes = GetEnabledScenes();
  string buildFullPath;

  buildFullPath = buildFolderPath + "/" + target + "/" + buildName;
  BuildPipeline.BuildPlayer (scenes, buildFullPath, target, BuildOptions.None);

<span class="strong"><strong>  // Distribution</strong></span>
<span class="strong"><strong>  if(target == BuildTarget.Android) {</strong></span>
<span class="strong"><strong>    PublishOnAppblade (buildFullPath);</strong></span>
<span class="strong"><strong>  }</strong></span>
<span class="strong"><strong>}</strong></span>
</pre></div><p>Now, when trying to create a new Android Build, if you go to the AppBlade website at the end of the process you will see your build available to be downloaded. Take into consideration<a id="id384" class="indexterm"></a> that the process will take longer depending on the size of the build and your internet connection:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_FD09_019.jpg" /></div></div></div>