<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec46"></a>Implementing a Scriptable Object</h2></div></div><hr /></div><p>In this <a id="id293" class="indexterm"></a>section, we will create a <code class="literal">ScriptableObject</code> class <a id="id294" class="indexterm"></a>and then reallocate the gravity, bgm, and background variables there.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec61"></a>Creating the data class</h3></div></div></div><p>The <code class="literal">ScriptableObject</code> class is part of the <code class="literal">UnityEngine</code> namespace. You derive from this class if you want to create objects that don't need to be attached to a game object, but more <a id="id295" class="indexterm"></a>often, if you are looking for objects meant to save data.</p><p>Let's create a script called <code class="literal">LevelSettings.cs</code> inside the folder <code class="literal">Scripts/Levels</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System;

namespace RunAndJump {

  [Serializable]
  public class LevelSettings : ScriptableObject {

    public float gravity = -30;
    public AudioClip bgm;
    public Sprite background;
  }
}</pre></div><p>The first step was to make the class extend from the <code class="literal">ScriptableObject</code> class. Then, we added the <a id="id296" class="indexterm"></a>public variables to represent each variable we want to save in this class.</p><p>We added the namespace <code class="literal">System</code> to use the attribute <code class="literal">Serializable</code>. Using this attribute, we tell Unity to serialize all the public properties of the class. This is very important in order to make them persist!</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"></a>Note</h3><p>If you want to know <a id="id297" class="indexterm"></a>more about the scriptable objects, visit: <a class="ulink" href="http://docs.unity3d.com/ScriptReference/ScriptableObject.html" target="_blank">http://docs.unity3d.com/ScriptReference/ScriptableObject.html</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec62"></a>Generating an asset to contain the data class</h3></div></div></div><p>All the instance <a id="id298" class="indexterm"></a>of a scriptable object are saved in Unity as assets; this means you can reference this asset in any script you want, in the same way you use materials, for example.</p><p>To generate these instances, we will create a method in the <code class="literal">EditorUtils</code> class called <code class="literal">CreateAsset</code>:</p><div class="informalexample"><pre class="programlisting">public static T CreateAsset&lt;T&gt;(string path) 
    where T : ScriptableObject {
    T dataClass = (T) ScriptableObject.CreateInstance&lt;T&gt;();
    AssetDatabase.CreateAsset(dataClass, path);
    AssetDatabase.Refresh();
    AssetDatabase.SaveAssets();
    return dataClass;
}</pre></div><p>This method receives a generic type, which must to be a Scriptable Object, and a path. With those values, the method will create an asset in the specified path using the <code class="literal">T</code> class.</p><p>The <code class="literal">CreateAsset</code> method uses the <code class="literal">AssetDatabase</code> class apart from the <code class="literal">UnityEditor</code> namespace. The method <code class="literal">CreateAsset</code> does the main part, then the <code class="literal">Refresh</code> method makes the new asset visible in the project, and finally, the <code class="literal">SaveAssets</code> method saves the new created asset in the project.</p><p>Now, it is time to make this method available in Unity, so let's create a new menu item by adding a new method in the class <code class="literal">MenuItems</code>:</p><div class="informalexample"><pre class="programlisting">[MenuItem ("Tools/Level Creator/New Level Settings")]
        private static void NewLevelSettings () {
            string path = EditorUtility.SaveFilePanelInProject(
                "New Level Settings",
                "LevelSettings",
                "asset",
                "Define the name for the LevelSettings asset");
            if(path != "") {
                EditorUtils.CreateAsset&lt;LevelSettings&gt;(path);
            }
        }</pre></div><p>Before using the method we created in the <code class="literal">EditorUtils</code> class, we call the <code class="literal">SaveFilePanelInProject</code> method from the <code class="literal">EditorUtility</code> class. This will show a window<a id="id299" class="indexterm"></a> asking for the name and location for the asset we want to create.</p><p>Using the path returned by the <code class="literal">SaveFilePanelInProject</code> method, we proceed to create the asset.</p><p>We add an <code class="literal">If</code> statement to check whether the path is different from an empty string; this happens if the user clicks on <span class="strong"><strong>Cancel</strong></span> on the window created by the <code class="literal">SaveFilePanelInProject</code> method.</p><p>Save and wait for Unity to compile. Then, go to the Unity menu and navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Level Creator</strong></span> | <span class="strong"><strong>New Level Settings</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_03.jpg" /></div><p>Now, you will see the <span class="strong"><strong>Save File</strong></span> dialog. Create a new folder called <span class="strong"><strong>LevelSettings</strong></span> in the root of the project. Inside this, create a new asset called <span class="strong"><strong>Normal.asset</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_04.jpg" /></div><p>Repeat<a id="id300" class="indexterm"></a> the process and create an extra asset called <span class="strong"><strong>Moon.asset</strong></span>. Your project browser will look as follows:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_05.jpg" /></div><p>The two assets inside the <span class="strong"><strong>LevelSettings</strong></span> folder represent instances of the <code class="literal">LevelSetting</code> class we created.</p><p>Each asset is like a configuration file that will be referenced by a <code class="literal">MonoBehaviour</code> class. In this case, the gravity, bgm, and background will be used and referenced by the <code class="literal">Level</code> class.</p><p>As this is<a id="id301" class="indexterm"></a> a reference, if we modify the asset, all the levels using the specific one will be affected. This didn't happen at the beginning because these properties were inside the <code class="literal">Level</code> class. At this point, you may think that these assets are a perfect way to create themes for the levels, for example, all the easy levels will have the same gravity, bgm, and backgrounds.</p><p>If you click on the <span class="strong"><strong>Moon</strong></span> asset, this will appear in the inspector window:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_07_06.jpg" /></div><p>Here, you can directly change the values of the asset, and like the usual inspectors for our <code class="literal">MonoBehaviour</code> class, you can use property drawers or decorator drawers, or create a custom inspector for your scriptable object.</p><p>In the rest of the chapter, we will integrate this to the levels in <span class="emphasis"><em>Run &amp; Jump</em></span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"></a>Note</h3><p>If you remember the chapter about custom inspectors and editor windows, we talked about the <code class="literal">OnEnable</code>, <code class="literal">OnDisable</code> and <code class="literal">OnDestroy</code> message methods.</p><p>These methods are part of the ScriptableObject class. The Editor and EditorWindow classes extend from the ScriptableObject class and that is why you have access to them.</p></div></div></div>