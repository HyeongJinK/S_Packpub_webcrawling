<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec11"></a>The Level Creator tool</h2></div></div><hr /></div><p>Imagine a <a id="id30" class="indexterm"></a>scenario where you are responsible for generating several levels for <span class="emphasis"><em>Run &amp; Jump</em></span>. You know this task is time consuming, and copying and pasting prefabs to place them in the right position is not the most efficient way to achieve this.</p><p>Basically, most of the 2D level editors use a <span class="strong"><strong>Canvas/Brush</strong></span> metaphor to design the user interaction. This means the level scene is your canvas and using the mouse cursor as a brush, you paint over it level prefab instances.</p><p>Taking this in to consideration, the first thing we will create is a tool called <span class="strong"><strong>Level Creator</strong></span> to make this process easier using the Canvas/Brush metaphor, and of course, in the process, we will cover several editor scripting topics.</p><p>The features<a id="id31" class="indexterm"></a> of the Level Creator are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Automates the creation of a scene capable of being used as a level. This means that you can generate a scene with a game object, and the level script attached to it, with just a simple click.</p></li><li style="list-style-type: disc"><p>Displays a grid on the <span class="strong"><strong>Scene View</strong></span> option to be used as a reference. All the level piece prefabs will snap to this grid by default.</p></li><li style="list-style-type: disc"><p>Controls and validates how the properties of the level script are changed.</p></li><li style="list-style-type: disc"><p>Improves the visibility of the available level pieces prefabs by creating a Palette window to show a preview. This classifies the prefabs by their category.</p></li><li style="list-style-type: disc"><p>Implements the Canvas/Brush metaphor allowing four modes: view, paint, edit, and erase level pieces prefabs.</p></li><li style="list-style-type: disc"><p>Customizes the look and feel of the tool to improve its own appearance.</p></li></ul></div><p>For now, let's focus on automating the creation of a scene capable to be used as a level.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note03"></a>Note</h3><p>As you notice, <span class="emphasis"><em>Run &amp; Jump</em></span> is fully playable at it is but we are going to make a few improvements in its implementation to achieve a seamless integration with the Level Creator tool. Is because of that, all the current levels aren't be editable by the tool.</p><p>All the design decisions in this book were taken in order to make easy to understand the code related to editor scripting.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec11"></a>Defining the chapter goals</h3></div></div></div><p>In the rest <a id="id32" class="indexterm"></a>of this chapter, we will work on the first scripts of the <span class="strong"><strong>Level Creator</strong></span> tool in order to automate the creation of a scene capable to be used as a level.</p><p>The goals here are:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Create a new Unity scene by code</p></li><li style="list-style-type: disc"><p>Add a <a id="id33" class="indexterm"></a>game object with the level script attached to it to the scene by code</p></li><li style="list-style-type: disc"><p>Create a menu item to trigger the creation of a scene capable to be used as a level in the Unity editor menu</p></li></ul></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec12"></a>Preparing the environment</h3></div></div></div><p>We need to<a id="id34" class="indexterm"></a> create a few folders to keep our development organized. Remember, for this entire book, we are working on the <span class="emphasis"><em>Run &amp; Jump</em></span> project.</p><p>You will find a folder called <span class="strong"><strong>Tools </strong></span>in the root of the project. Right now this folder has one inside with the scripts of the tool we used to add our levels to the game.</p><p>Inside the <span class="strong"><strong>Tools</strong></span> folder, create a new folder called <span class="strong"><strong>LevelCreator</strong></span> and then match the folder structure, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_01_23.jpg" /></div><p>This folder structure is just a suggestion, but you must always consider creating a root folder for your custom tools.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec13"></a>Performing automation</h3></div></div></div><p>As we were saying, we want to create a scene capable to be used as a level, but instead doing this manually in Unity, we are going to achieve the same using code.</p><p>We are going to implement a few methods to do this. Inside the folder <code class="literal">Tools/LevelCreator/Editor</code>, create a new script called <code class="literal">EditorUtils.cs</code> and add the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEditor;
using System.Collections.Generic;

namespace RunAndJump.LevelCreator {
  public static class EditorUtils {
        
    // Creates a new scene
    public static void NewScene () {
      EditorApplication.SaveCurrentSceneIfUserWantsTo ();
      EditorApplication.NewScene ();
    }

    // Remove all the elements of the scene
    public static void CleanScene () {
      GameObject[] allObjects = Object.FindObjectsOfType&lt;GameObject&gt; ();
      foreach (GameObject go in allObjects) {
        GameObject.DestroyImmediate (go);
      }
    }

    // Creates a new scene capable to be used as a level
    public static void NewLevel () {
      NewScene ();
      CleanScene ();
      GameObject levelGO = new GameObject ("Level");
      levelGO.transform.position = Vector3.zero;
      levelGO.AddComponent&lt;Level&gt; ();
    }
  }
}</pre></div><p>The <code class="literal">NewLevel</code> method is the<a id="id35" class="indexterm"></a> one that executes all the work using the help of the following two methods:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<code class="literal">NewScene</code>: This creates a new scene, but before doing that, asks whether we want to save the scene that is currently open. All this is done using <code class="literal">EditorApplication</code>, a static class with several methods to know the state of the editor (playing, paused, compiling, and so on) and create, save, or load scenes and projects.</p></li><li style="list-style-type: disc"><p>
<code class="literal">CleanScene</code>: This removes all the elements of the scene. Remember the camera created by default with each scene in Unity? Well, this method is going to take care of that using the <code class="literal">DestroyImmediate</code> method. This is similar to the common <code class="literal">Destroy</code> method but this works in an Editor context.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note04"></a>Note</h3><p>To learn <a id="id36" class="indexterm"></a>more about the <code class="literal">EditorApplication</code> class, visit <a class="ulink" href="http://docs.unity3d.com/ScriptReference/EditorApplication.html" target="_blank"> http://docs.unity3d.com/ScriptReference/EditorApplication.html</a>.</p></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip04"></a>Tip</h3><p>In order to avoid class name conflicts, it's always a good idea to use namespaces. In this project, all the video game classes are in the <code class="literal">RunAndJump</code> namespace and the Level Creator classes are in the <code class="literal">LevelCreator.RunAndJump</code> namespace.</p></div><p>Similar to the <code class="literal">HelloWorld</code> example we created at the beginning of this chapter, we need to make <a id="id37" class="indexterm"></a>the <code class="literal">NewLevel</code> method accessible through the Unity editor menu using the <code class="literal">MenuItem</code> attribute.</p><p>Inside the folder <code class="literal">Tools/LevelCreator/Editor</code>, create a new script called <code class="literal">MenuItems.cs</code>. We will use this to add all the future menu items that the tool requires; for now, add the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using UnityEditor;

namespace RunAndJump.LevelCreator {
  public static class MenuItems {
        
        [MenuItem ("Tools/Level Creator/New Level Scene")]
        private static void NewLevel () {
            EditorUtils.NewLevel ();
        }
    }        
}</pre></div><p>Now, the <code class="literal">NewLevel</code> method will be available when you navigate to <span class="strong"><strong>Tools</strong></span> | <span class="strong"><strong>Level Creator</strong></span> | <span class="strong"><strong>New Level Scene</strong></span>. Save all the scripts changes and for Unity to compile, then click on <span class="strong"><strong>New Level Scene</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_01_24.jpg" /></div><p>A dialog window will ask you whether you want to save the current changes of the scene (if this one has modifications):</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_01_25.jpg" /></div><p>After this, a <a id="id38" class="indexterm"></a>new scene will be created with the game object containing the level script:</p><div class="mediaobject"><img src="/graphics/9781785281853/graphics/B04640_01_26.jpg" /></div><p>Congratulations! We have the starting point for the Level Creator tool creating a level scene with just one click!</p></div></div>