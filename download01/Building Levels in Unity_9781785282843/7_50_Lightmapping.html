<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec50"></a>Lightmapping</h2></div></div><hr /></div><p>Every year, more and more games are<a id="id425" class="indexterm"></a> being released with real-time rendering solutions that allow for more realistic-looking environments at the price of ever-growing computing power of modern PCs and consoles. However, due to the limiting hardware capabilities of mobile platforms, it is still a long time before we are ready to part ways with cheap and affordable techniques such as lightmapping.</p><p>Lightmapping is a technology for precomputing brightness of surfaces, also known as baking, and storing it in a separate texture—a lightmap. In order to see lighting in the area, we need to be able to calculate it at least 30 times per second (or more, based on fps requirements). This is not very cheap; however, with lightmapping we can calculate lighting once and then apply it as a texture. This technology is suitable for static objects that artists know will never be moved; in a nutshell, this process involves creating a scene, setting up the lighting rig and clicking <span class="strong"><strong>Bake</strong></span> to get great lighting with minimum performance issues during runtime.</p><p>To demonstrate the <a id="id426" class="indexterm"></a>lightmapping process, we will take the previous scene and try to bake it using lightmapping.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec80"></a>Static versus dynamic lights</h3></div></div></div><p>We've just talked <a id="id427" class="indexterm"></a>about a way to guarantee that the GameObjects will not <a id="id428" class="indexterm"></a>move. But what about lights? Hitting the <span class="strong"><strong>Static</strong></span> <a id="id429" class="indexterm"></a>checkbox for lights will not achieve much (unless you simply want to completely avoid the possibility of accidentally moving them). The problem at hand is that light, being a component of an object, has a separate set of controls allowing them to be manipulated even if the holder is set to static. For that purpose, each light has a parameter that allows us to specify the role of individual light and its contribution to the baking process, this parameter is called <span class="strong"><strong>Baking</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_21.jpg" /></div><p>There are three options available for it:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Realtime</strong></span>: This option will exclude this particular light from the baking process. It is totally fine to use real-time lighting, precomputed GI will make sure that modern computers and consoles are able to handle them quite smoothly. However, they might cause an issue if you are developing for the mobile platforms which will require every bit of optimization to be able to run with a stable frame rate. There are ways to fake real-time lighting with much cheaper options, which we will discuss later. The only thing you should consider is that the number of realtime lights should be kept at a minimum if you are going for maximum optimization. Realtime will allow lights to affect static and dynamic objects.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Baked</strong></span>: This <a id="id430" class="indexterm"></a>option will include this light into the <a id="id431" class="indexterm"></a>baking process. However, there <a id="id432" class="indexterm"></a>is a catch: only static objects will receive light from it. This is self-explanatory—if we want dynamic objects to receive lighting, we need to calculate it every time the position of an object changes, which is what <span class="strong"><strong>Realtime</strong></span> lighting does. <span class="strong"><strong>Baked</strong></span> lights are cheap, calculated once we have stored all lighting information on a hard drive and using it from there, no further recalculation is required during runtime. It is mostly used on small situational lights that won't have a significant effect on dynamic objects.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Mixed</strong></span>: This one is a combination of the previous two options. It bakes the lights into the static objects and affects the dynamic objects as they pass by. Think of the street lights: you want the passing cars to be affected; however, you have no need to calculate the lighting for the static environment in realtime. Naturally, we can't have dynamic objects move around the level unlit, no matter how much we'd like to save on computing power. Mixed will allow us to have the benefit of the baked lighting on the static objects as well as affect the dynamic objects at runtime.</p></li></ul></div><p>The first step that we are going to take is changing the <span class="strong"><strong>Baking</strong></span> parameter of our lights from <span class="strong"><strong>Realtime</strong></span> to <span class="strong"><strong>Baked</strong></span> and enabling <span class="strong"><strong>Soft Shadows</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_22.jpg" /></div><p>You shouldn't <a id="id433" class="indexterm"></a>notice<a id="id434" class="indexterm"></a> any significant difference, except for the extra <a id="id435" class="indexterm"></a>shadows appearing.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_23.jpg" /></div><p>The final<a id="id436" class="indexterm"></a> result isn't too different from the real-time <a id="id437" class="indexterm"></a>lighting. Its performance is much better, but lacks<a id="id438" class="indexterm"></a> the support of dynamic objects.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec81"></a>Dynamic shadows versus static shadows</h3></div></div></div><p>One of the things<a id="id439" class="indexterm"></a> that get people confused when <a id="id440" class="indexterm"></a>starting to work with shadows in Unity is <a id="id441" class="indexterm"></a>how they are being cast by static and dynamic objects with different <span class="strong"><strong>Baking</strong></span> settings on the light source. This is one of those things that you simply need to memorize and keep in mind when planning the lighting in the scene. We are going to explore how different <span class="strong"><strong>Baking</strong></span> options affect the shadow casting between different combinations of static and dynamic objects:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_24.jpg" /></div><p>As you can see, real-time lighting handles everything pretty well; all the objects are casting shadows <a id="id442" class="indexterm"></a>onto each other and everything works as <a id="id443" class="indexterm"></a>intended. There is even color bleeding <a id="id444" class="indexterm"></a>happening between two static objects on the right.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_25.jpg" /></div><p>With <span class="strong"><strong>Baked</strong></span> lighting the result isn't that inspiring. Let's break it down.</p><p>Dynamic objects are not lit, and we've talked about that previously. If the object is subject to change at runtime, we can't preemptively bake it into the lightmap; therefore, lights that are set to <span class="strong"><strong>Baked</strong></span> will simply ignore them.</p><p>Shadows are only cast by static objects onto static objects. This correlates to the previous statement that if we aren't sure that the object is going to change we can't safely bake its shadows into the shadow map.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_26.jpg" /></div><p>With <span class="strong"><strong>Mixed</strong></span> <a id="id445" class="indexterm"></a>we get a similar result as with real-time<a id="id446" class="indexterm"></a> lighting, except for one instance: dynamic<a id="id447" class="indexterm"></a> objects are not casting shadows onto static objects, but the reverse does work: static objects are casting shadows onto the dynamic objects just fine, so what's the catch? Each object gets individual treatment from the Mixed light: those that are static are treated as if they are lit by the Baked light and dynamic are lit in realtime. In other words, when we are casting a shadow onto a dynamic object, it is calculated in realtime, while when we are casting shadow onto the static object, it is baked and we can't bake a shadow that is cast by the object that is subject to change. This was never the case with real-time lighting, since we were calculating the shadows at realtime, regardless of what they were cast by or cast onto. And again, this is just one scenario that you need to memorize.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec82"></a>Lighting options</h3></div></div></div><p>The <span class="strong"><strong>Lighting</strong></span> window has <a id="id448" class="indexterm"></a>three tabs: <span class="strong"><strong>Object</strong></span>, <span class="strong"><strong>Scene</strong></span>, and <span class="strong"><strong>Lightmap</strong></span>. For now we will focus on the first one.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_27.jpg" /></div><p>The main content of an<a id="id449" class="indexterm"></a> <span class="strong"><strong>Object</strong></span> tab is information on objects that are currently selected. This allows us to get quick access to a list of controls, to better tweak selected objects for lightmapping and GI.</p><p>You can switch between object types with the help of <span class="strong"><strong>Scene Filter</strong></span> at the top; this is a shortcut to filtering objects in the <span class="strong"><strong>Hierarchy</strong></span> window (this will not filter the selected GameObjects, but everything in the Hierarchy window).</p><p>As was mentioned earlier, all GameObjects need to be set to <span class="strong"><strong>Static</strong></span> in order to be affected by the lightmapping process; this is why the <span class="strong"><strong>Lightmap Static</strong></span> checkbox is the first in the list for <span class="strong"><strong>Mesh Renderers</strong></span>. If you haven't set the object to static in the <span class="strong"><strong>Inspector</strong></span> window, checking the <span class="strong"><strong>Lightmap Static</strong></span> box will do just that.</p><p>The <span class="strong"><strong>Scale in Lightmap</strong></span> parameter <a id="id450" class="indexterm"></a>controls the lightmap resolution. The greater the value, the bigger the resolution given to the object's lightmap, resulting in better lighting effects and shadows. Setting the parameter to <code class="literal">0</code> will result in an object not being affected by lightmapping. Unless you are trying to fix lighting artifacts on the object, or going for the maximum optimization, you shouldn't touch this parameter; there is a better way to adjust the lightmap resolution for all objects in the scene; <span class="strong"><strong>Scale in Lightmap</strong></span> scales in relation to global value.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_07_28.jpg" /></div><p>The rest of the parameters are very situational and quite advanced, they deal with UVs, extend the effect of GI on the GameObject, and give detailed information on the lightmap.</p><p>For lights, we have a baking parameter with 3 options: <span class="strong"><strong>Realtime</strong></span>, <span class="strong"><strong>Baked</strong></span>, or <span class="strong"><strong>Mixed</strong></span>. Naturally, if you want this light for lightmapping, <span class="strong"><strong>Realtime</strong></span> is not an option, so you should pick <span class="strong"><strong>Baked</strong></span> or <span class="strong"><strong>Mixed</strong></span>.</p><p>
<span class="strong"><strong>Color</strong></span> and <span class="strong"><strong>Intensity</strong></span> are referenced from the <span class="strong"><strong>Inspector</strong></span> window and can be adjusted in either place.</p><p>
<span class="strong"><strong>Baked Shadows</strong></span> allows us to <a id="id451" class="indexterm"></a>choose the shadow type that will be baked (<span class="strong"><strong>Hard</strong></span>, <span class="strong"><strong>Soft</strong></span>, <span class="strong"><strong>Off</strong></span>).</p></div></div>