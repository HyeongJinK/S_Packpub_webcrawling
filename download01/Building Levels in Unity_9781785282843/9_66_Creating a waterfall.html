<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec64"></a>Creating a waterfall</h2></div></div><hr /></div><p>In this section, we will challenge <a id="id542" class="indexterm"></a>ourselves to create a particle system for our level, namely a waterfall, nothing crazy, but something that we will be able to create without any code support, relying only on texture work and a built-in particle system.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec96"></a>Setting up assets</h3></div></div></div><p>Let's begin with setting up the<a id="id543" class="indexterm"></a> assets that will be required for a creation of this particle effect and taking a closer look at them:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a <span class="strong"><strong>Particle System</strong></span> in the scene by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Particle System</strong></span>.</p></li><li><p>Go to <span class="strong"><strong>Chapter 9</strong></span> | <span class="strong"><strong>Waterfall</strong></span> to locate a material and a prefab by the name <span class="strong"><strong>Waterfall</strong></span>.</p></li><li><p>Assign a created particle system to the <span class="strong"><strong>Waterfall</strong></span> prefab.</p></li></ol></div><p>That is literally everything<a id="id544" class="indexterm"></a> we need to create in order to start working on the <span class="strong"><strong>Particle System</strong></span>. This is how your <span class="strong"><strong>Waterfall</strong></span> folder should look at this point:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_04.jpg" /></div><p>The<span class="strong"><strong> WaterfallTexture</strong></span> image is going to be used for our first iteration of the waterfall. It's a very simple grayscale image 128 x 128 (using low resolution square textures for particles is highly recommended); in order to be properly utilized, we need to make sure that the alpha channel is generated from the grayscale by checking two checkboxes in the <span class="strong"><strong>WaterfallTexture Import Settings</strong></span>: <span class="strong"><strong>Alpha from Grayscale</strong></span> and <span class="strong"><strong>Alpha is Transparent</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_05.jpg" /></div><p>Needless to say, you can also use an image that contains an alpha without any need to generate it in Unity. This will also allow you to add a color to it that is different to white, but, in this case, we have an opportunity to compensate for that in a different manner.</p><p>Lastly, we need to <a id="id545" class="indexterm"></a>configure the material:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Assign the <span class="strong"><strong>WaterfallTexture</strong></span> to the <span class="strong"><strong>Albedo</strong></span> parameter of the <span class="strong"><strong>Waterfall</strong></span> material.</p></li><li><p>Set the <span class="strong"><strong>Rendering Mode</strong></span> parameter to <span class="strong"><strong>Cutout</strong></span>.</p></li></ol></div><p>
<span class="strong"><strong>WaterfallTexturesheet</strong></span> will come into play later.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec97"></a>Configuring the particle system</h3></div></div></div><p>Going back to our particle <a id="id546" class="indexterm"></a>system, let's take a look at what modules and parameters we will need to configure in order to make it look like a waterfall. I will go through them in the same order I did for creation and talk through the process of utilizing different modules in order to create a proper effect.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec35"></a>Emitting direction</h4></div></div></div><p>We will make sure that our<a id="id547" class="indexterm"></a> particles are emitting in the correct direction. First of all, I don't like the fact that my particles are flying up in the air as they are emitting. If nature taught me anything, it's that water falls down. We will fix this nuisance by setting <span class="strong"><strong>Gravity Modifier</strong></span> to <code class="literal">1.85</code> (hereinafter, numbers we generated after spending some time tweaking and trying to come up with the best result and are not staple).</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_06.jpg" /></div><p>Now, the emitting source. By default, the particle system is emitting particles in a cone-shaped direction. This<a id="id548" class="indexterm"></a> is not something that we want for our waterfall, so we should go into the <span class="strong"><strong>Shape</strong></span> module and change the <span class="strong"><strong>Shape</strong></span> parameter to <span class="strong"><strong>Box</strong></span>. The Box's shape can be altered via transform and the parameters inside the <span class="strong"><strong>Shape</strong></span> module. Personally, I've set the <span class="strong"><strong>Box Y</strong></span> parameter to <code class="literal">10</code> and <span class="strong"><strong>Rotation</strong></span> in the <span class="strong"><strong>Transform</strong></span> component to (<code class="literal">45</code>, <code class="literal">0</code>, <code class="literal">90</code>).</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_07.jpg" /></div><p>Some of you might wonder at this point why we added a <span class="strong"><strong>Gravity Modifier</strong></span> if we could simply rotate the box to change the emitting direction. That is true; however, choosing this way allows us to get this nice arc, as particles are emitted on a certain angle and are forced down by gravity.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec36"></a>Configuring particles</h4></div></div></div><p>It is about time to assign the material to <a id="id549" class="indexterm"></a>particles and to see how that's going to work for us.</p><p>In order to do that, we will go into a <span class="strong"><strong>Renderer</strong></span> module and assign the <span class="strong"><strong>Waterfall</strong></span> material to the <span class="strong"><strong>Material</strong></span> parameter.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_08.jpg" /></div><p>It looks terrible, nothing like the waterfall at all. However, we are getting there; let's address the issues one by one. The first obvious observation is that they are way too small. Therefore, we shall increase their initial size by changing the <span class="strong"><strong>Start Size</strong></span> parameter to <code class="literal">5</code> (up from <code class="literal">1</code>). This is a little better, but they aren't occupying enough space as of yet, and we can still see the gaps at the source. To address this issue, we will simply emit more of them, by going to the <span class="strong"><strong>Emission</strong></span> module and changing the <span class="strong"><strong>Rate</strong></span> parameter to <code class="literal">20</code> (up from <code class="literal">10</code>).</p><p>In this case, we have a large amount of water pouring into a thin air from some sort of a bucket and one interesting thing that water does in real-life situations is it proportionally fills up the entire space from the source to the impact zone (as long as water keeps coming). We can't do quite the same thing in our case, because as you might imagine, stretching textures to variable sizes will produce unpredictable and, more often than not, horrible results. What we are going to do instead is partially stretch the texture until it starts to look similar to a real-life situation.</p><p>With that in mind, we are going to do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Change the <span class="strong"><strong>Render Mode</strong></span> parameter in the <span class="strong"><strong>Renderer</strong></span> module to <span class="strong"><strong>Stretched Billboard</strong></span>.</p></li><li><p>Change the <span class="strong"><strong>Length Scale</strong></span> parameter to <code class="literal">1.5</code> (down from <code class="literal">2</code>).</p></li></ol></div><p>However, we aren't <a id="id550" class="indexterm"></a>going to stop there, and we will go a little bit further by activating the <span class="strong"><strong>Size over Lifetime</strong></span> module and tweaking some values there. This module will allow us to configure the scale of the particle throughout its lifecycle. We will use a curve to control it. In order to see the curve in the preview window, just click on it and perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Choose the second preset for the curve from right at the bottom of the curve editor.</p></li><li><p>Change the <span class="strong"><strong>Size</strong></span> parameter at the top-left corner to <code class="literal">4</code> (up from <code class="literal">1</code>)</p></li><li><p>Add a third key to the curve by right-clicking and choosing <span class="strong"><strong>Add Key</strong></span>
</p></li><li><p>Set keys to the following coordinates, from left to right (<span class="emphasis"><em>x</em></span>,<span class="emphasis"><em>y</em></span>):</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>(<code class="literal">0.0</code>,<code class="literal">0.5</code>)</p></li><li style="list-style-type: disc"><p>(<code class="literal">0.2</code>,<code class="literal">1.6</code>)</p></li><li style="list-style-type: disc"><p>(<code class="literal">1.0</code>,<code class="literal">4.0</code>)</p></li></ul></div></li></ol></div><p>Your curve should look similar to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_09.jpg" /></div><p>There we go! It looks<a id="id551" class="indexterm"></a> much better now.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_10.jpg" /></div><p>We are almost <a id="id552" class="indexterm"></a>there; a few more touches are left.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec37"></a>Polishing</h4></div></div></div><p>Right now, the waterfall is <a id="id553" class="indexterm"></a>way too predictable; it's kind of boring to see the same texture emitted over and over again. To add some variety, we are going to introduce a texture sheet with multiple texture variation. To start off, let's do the following:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Assign the <span class="strong"><strong>WaterfallTexturesheet</strong></span> to the <span class="strong"><strong>Albedo</strong></span> parameter of the <span class="strong"><strong>Waterfall</strong></span> material.</p></li><li><p>While we're on that, let's also change the color of <span class="strong"><strong>Albedo</strong></span> to something bluish.</p></li><li><p>Activate the <span class="strong"><strong>Texture Sheet Animation</strong></span> module inside <span class="strong"><strong>Particle System</strong></span>.</p></li><li><p>Change the <span class="strong"><strong>Tiles Y</strong></span> parameter to <code class="literal">5</code> (up from <code class="literal">1</code>).</p></li><li><p>Set the <span class="strong"><strong>Animation</strong></span> parameter to <span class="strong"><strong>Single Row</strong></span>.</p></li></ol></div><p>Now, we finally have our <span class="strong"><strong>Waterfall</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/04214_09_11.jpg" /></div><p>In order to <a id="id554" class="indexterm"></a>control its length, we can simply change the <span class="strong"><strong>Start Lifetime</strong></span> parameter.</p><p>However, let's step back a little bit and take a look at how the texture sheet animation worked its miracles for us, and how we can utilize it in different situations.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec38"></a>Texture sheet animation</h4></div></div></div><p>The texture sheet <a id="id555" class="indexterm"></a>works very similar to the flares <a id="id556" class="indexterm"></a>textures, and any other animation texture sheet. Inside the module, we are specifying the number of square tiles that our sheet consists of (<span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> of <span class="strong"><strong>Tiles</strong></span> parameter).</p><p>The <span class="strong"><strong>Animation</strong></span> parameter allows us two options to choose from: we are either using images from the <span class="strong"><strong>Whole Sheet</strong></span> or utilizing a <span class="strong"><strong>Single Row</strong></span> of images. The latter enables the <span class="strong"><strong>Random Row</strong></span> parameter that allows us to randomly choose a row for the texture. In our case, it works quite well since we have five waterfall images lined up in a single column representing rows of their own. The size of the texture in question is 128 x 512, and that's why for the <span class="strong"><strong>Tiles</strong></span> parameter we've assigned values of <code class="literal">5</code> to <span class="emphasis"><em>Y</em></span> and <code class="literal">1</code> to <span class="emphasis"><em>X</em></span>. Unity will then come up with a conclusion that the default size of a single image is 128 x 128 pixels and that there are five of them along the <span class="emphasis"><em>y </em></span>axis.</p><p>In the case of a<a id="id557" class="indexterm"></a> <span class="strong"><strong>Waterfall</strong></span>, we aren't actually <a id="id558" class="indexterm"></a>animating anything, but simply taking random images from <span class="strong"><strong>Texture Sheet</strong></span> to create variety. However, if you have a ready texture sheet, you can control animation with the <span class="strong"><strong>Frame over Time</strong></span> parameter via curves or constants.</p><p>The last parameter, <span class="strong"><strong>Cycles</strong></span>, specifies how many times the animation will play over the lifetime of the particle, combined with the <span class="strong"><strong>Start Lifetime</strong></span> and <span class="strong"><strong>Frame over Time</strong></span> parameters; it will allow you to control the animation speed.</p></div></div></div>