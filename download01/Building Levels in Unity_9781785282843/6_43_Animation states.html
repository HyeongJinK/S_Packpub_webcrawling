<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec44"></a>Animation states</h2></div></div><hr /></div><p>Double-click on the created <a id="id307" class="indexterm"></a>
<span class="strong"><strong>CharacterController</strong></span> or navigate to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animator</strong></span> in the top menu—it will take us to the <span class="strong"><strong>Animator</strong></span> window where all the magic is happening.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_03.jpg" /></div><p>The Mecanim animation system is based around the idea of separating character behavior into different states with assigned animation clips to play while in any particular state. The transitions between states are defined by the set of conditions and are controlled by the <span class="strong"><strong>Parameters</strong></span>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec63"></a>States</h3></div></div></div><p>Right click on the empty <a id="id308" class="indexterm"></a>space of the <span class="strong"><strong>Animator</strong></span> window and navigate to <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>Empty</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_04.jpg" /></div><p>This created our first state, to which we can now assign an animation clip by:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Selecting <span class="strong"><strong>Create</strong></span> <span class="strong"><strong>New State</strong></span>
</p></li><li><p>Renaming the state to <span class="strong"><strong>Idle</strong></span> (in the <span class="strong"><strong>Inspector</strong></span>)</p></li><li><p>Assigning the <span class="strong"><strong>Idle_Neutral_1</strong></span> animation clip (<span class="strong"><strong>Raw Mocap</strong></span> | <span class="strong"><strong>Animations</strong></span> | <span class="strong"><strong>Idle</strong></span> | <span class="strong"><strong>Idle_Neutral_1</strong></span>) to the <span class="strong"><strong>Motion</strong></span> parameter in the <span class="strong"><strong>Inspector</strong></span> window</p></li></ol></div><p>Done, if we just hit <span class="strong"><strong>Play</strong></span>, we will see our character playing the <span class="strong"><strong>Idle_Neutral_1</strong></span> animation in the scene window.</p><p>Let's take a step back<a id="id309" class="indexterm"></a> for a second and see why this is happening.</p><p>The first created state is automatically assigned by default and is given an orange color. Try to create a new state by selecting <span class="strong"><strong>Run_Impulse</strong></span> animation clip in the <span class="strong"><strong>Project</strong></span> window and navigating to <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>From Selected Clip</strong></span>. This will create a state; assign it to a selected <span class="strong"><strong>Run_Impulse</strong></span> animation clip and rename it accordingly. Alternatively, we can just drag and drop animation clips from the <span class="strong"><strong>Project</strong></span> to <span class="strong"><strong>Animator</strong></span> window.</p><p>We can choose to make the <span class="strong"><strong>Run_Impulse</strong></span> state as the default by right-clicking on it and selecting <span class="strong"><strong>Set as Layer Default State</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_05.jpg" /></div><p>Now we have two animation states, but how do we make a transition from one to the other? The short answer to that is, we have to create one:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right click on the <span class="strong"><strong>Idle</strong></span> state.</p></li><li><p>Select <span class="strong"><strong>Make Transition</strong></span>.</p></li><li><p>Left-click on the <span class="strong"><strong>Run_Impulse</strong></span> state.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_06.jpg" /></div></li></ol></div><p>Now these states are<a id="id310" class="indexterm"></a> connected with a one way transition that will switch from playing the <span class="strong"><strong>Idle_Neutral_1</strong></span> animation to the <span class="strong"><strong>Run_Impulse</strong></span> animation as soon as the transition conditions are met. By default, it's set to make transition as soon as one animation is about to finish playing, also known as <a id="id311" class="indexterm"></a>
<span class="strong"><strong>Exit Time</strong></span>, then it will use the remaining time to blend it with the next animation clip. Give it a try; a character should now play the usual <span class="strong"><strong>Idle_Neutral_1</strong></span> animation and then blend into the <span class="strong"><strong>Run_Impulse</strong></span> animation.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec64"></a>Parameters</h3></div></div></div><p>The key to controlling<a id="id312" class="indexterm"></a> animation transitions are custom parameters hidden under a <span class="strong"><strong>Parameters</strong></span> tab at the top left corner of the <span class="strong"><strong>Animator</strong></span> window.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_07.jpg" /></div><p>Parameters are used to communicate between the animator and the scripts. Initial parameters can be set in the <span class="strong"><strong>Animator</strong></span> window by pressing a <span class="strong"><strong>+</strong></span> sign and selecting a parameter type to add. Then, programmers can reference this parameter through code and change it. The change in the parameter value will be used to trigger the animation transition by conditions set by the animator. So you see, developers only need to use code to change the value of <a id="id313" class="indexterm"></a>the parameters, the actual management is controlled by the conditions set in the <span class="strong"><strong>Animator</strong></span> window.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec16"></a>Parameter types</h4></div></div></div><p>As of Unity V 5.01, we have<a id="id314" class="indexterm"></a> access to four parameter types, which are as follows:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>New Int</strong></span>: These are whole and negative numbers, no fractions</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>New Float</strong></span>: These are decimal numbers</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>New Bool</strong></span>: These are the Boolean values of true and false</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>New Trigger</strong></span>: This is the same as bool, but with an extra benefit of setting itself to false as soon as the transition is completed (we will use the trigger parameter as an example later)</p></li></ul></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec65"></a>Setting conditions for transitions</h3></div></div></div><p>So how do we use these<a id="id315" class="indexterm"></a> parameters to trigger <a id="id316" class="indexterm"></a>
<a id="id317" class="indexterm"></a> a change in our animation?</p><p>Let's start with the most basic example, switching from standing to walking, or, in our case, from the <span class="strong"><strong>Idle_Neutral_1</strong></span> animation to the <span class="strong"><strong>Run_Impulse</strong></span> animation. Our goal is, whenever our character's horizontal velocity is greater than zero, the character should start running; however, he should go back to standing still as soon as the velocity is set back to zero. Here is how we can achieve this:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new parameter of a type <span class="strong"><strong>Float</strong></span>.</p></li><li><p>Name it <span class="strong"><strong>ZSpeed</strong></span>.</p></li></ol></div><p>This parameter will be referenced by script, so make sure that you got the naming correct.</p><p>We now need to select the transition arrow from <span class="strong"><strong>Idle</strong></span> to <span class="strong"><strong>Run_Impulse</strong></span> as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With the <span class="strong"><strong>ZSpeed</strong></span> parameter created we can now set it under <span class="strong"><strong>Conditions</strong></span> at the bottom of the <span class="strong"><strong>Inspector</strong></span> window by selecting the transition arrow.</p></li><li><p>Set condition<a id="id318" class="indexterm"></a> to <span class="strong"><strong>ZSpeed</strong></span> being <a id="id319" class="indexterm"></a>
<span class="strong"><strong>Greater</strong></span> than <code class="literal">0.1</code>. This will allow us <a id="id320" class="indexterm"></a>to have a smooth transition from one animation to another.</p></li><li><p>Uncheck <span class="strong"><strong>Has Exit Time</strong></span> box</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_08.jpg" /></div></li></ol></div><p>But we aren't done <a id="id321" class="indexterm"></a>yet, this is just a one way<a id="id322" class="indexterm"></a> transition and we have yet to revert it to the <span class="strong"><strong>Idle</strong></span>
<a id="id323" class="indexterm"></a> state:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a transition from the <span class="strong"><strong>Run_Impulse</strong></span> state to <span class="strong"><strong>Idle</strong></span>.</p></li><li><p>Set a condition for this transition for <span class="strong"><strong>ZSpeed</strong></span> to be <span class="strong"><strong>Less</strong></span> than <code class="literal">0.1</code>.</p></li><li><p>Uncheck <span class="strong"><strong>Has Exit Time</strong></span> box</p></li><li><p>Take the script <span class="strong"><strong>MoveForward</strong></span> from the <span class="strong"><strong>Chapter 6</strong></span> folder and assign it as a component of the <span class="strong"><strong>Robot GameObject</strong></span> in the Scene window.</p></li></ol></div><p>Before we proceed, make sure to check the Loop Time box for the <span class="strong"><strong>Run_Impulse</strong></span> animation by selecting the <code class="literal">Run_Impulse</code> file (the parent of the animation clip) and going to the Animation tab.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_09.jpg" /></div><p>That will do. The <span class="strong"><strong>MoveForward</strong></span> script will take care of the input and changing the <span class="strong"><strong>ZSpeed</strong></span> value; the rest of it will be handled by the transitions that we have just set in the <span class="strong"><strong>Animator</strong></span> window. See it for yourself, hit <span class="strong"><strong>Play</strong></span> and use the <span class="emphasis"><em>W</em></span> key to move forward.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec66"></a>Blend trees</h3></div></div></div><p>Having animations transition from one to another is all good and dandy; however, in our day and age, due to increase of motion range, blending multiple animations to create new sets of motions is in great demand. That's what blend trees allow us to achieve.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec17"></a>Overview</h4></div></div></div><p>To better understand <a id="id324" class="indexterm"></a>animation blending, let's compare it to the animation transition that we've seen in the previous example. With animation transition, we move from one animation to another with a short period of linear interpolation in between; animation blending is that short period of interpolation. Blend trees allow us to set multiple animations and define when and how they are going to affect the character by controlling them with parameters.</p><p>The most basic example of the use of the blend trees will be creating a smooth transition from walking to running. If you've ever played a third person game with a gamepad, you might have noticed how smoothly the character goes from walking to running as you slowly tilt the joystick forward—that's the exact feel that we can achieve using blend trees.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec18"></a>Creating a blend tree</h4></div></div></div><p>Think of the <a id="id325" class="indexterm"></a>blend trees as a more advanced version of animation states that we've used recently. Their creation process is very similar as well:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right-click on the empty area of the <span class="strong"><strong>Animator</strong></span> window</p></li><li><p>Navigate to <span class="strong"><strong>Create State</strong></span> | <span class="strong"><strong>From New Blend Tree</strong></span>
</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_10.jpg" /></div></li></ol></div><p>This will create a new block that is deceptively similar to the usual animation state.</p><p>Blend tree transitions work in the exact same way as the animation state transition, so much that we can simply convert our previously created <span class="strong"><strong>Run_Impulse</strong></span> state into a <span class="strong"><strong>Run</strong></span> blend tree by:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right <a id="id326" class="indexterm"></a>clicking on the <span class="strong"><strong>Run_Impulse</strong></span> state.</p></li><li><p>Selecting <span class="strong"><strong>Create New Blend Tree in State</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_11.jpg" /></div></li></ol></div><p>Using the latter method will allow us to preserve all transition conditions we've built before.</p><p>You might gain an impression that using the blend trees should be the default way to go. That is however, not true, you only need to rely on them for animation blending, otherwise, stick to using states, they are much simpler.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec19"></a>Inside the blend tree</h4></div></div></div><p>Double-clicking on the <span class="strong"><strong>Blend Tree</strong></span> will<a id="id327" class="indexterm"></a> take us inside of it, to where all the blending happens.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_12.jpg" /></div><p>As you can see, we already have a slider with a <span class="strong"><strong>ZSpeed</strong></span> parameter control. That is partially because that is the only parameter we have available at the moment. This parameter will be controlling the blend between the animations. Now, with <span class="strong"><strong>Blend Tree</strong></span> selected, let's take a quick<a id="id328" class="indexterm"></a> look at the <span class="strong"><strong>Inspector</strong></span> view:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_13.jpg" /></div><p>The <span class="strong"><strong>Parameter</strong></span> field specifies the parameter that will be controlling the animation blending (<span class="strong"><strong>ZSpeed</strong></span>, in our case).</p><p>
<span class="strong"><strong>Motion</strong></span> contains the list of animation clips and blend trees that we can blend between:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Hit the <span class="strong"><strong>+</strong></span> sign of the <span class="strong"><strong>Motion</strong></span> list and add two motion fields.</p></li><li><p>Assign the <span class="strong"><strong>WalkFWD</strong></span> and <span class="strong"><strong>Run_Impulse</strong></span> animation clips to them (<span class="strong"><strong>WalkFWD</strong></span> at the top and <span class="strong"><strong>Run_Impulse</strong></span> at the bottom).</p></li></ol></div><p>In the <span class="strong"><strong>Animator</strong></span> window, you should now get something like the tree diagram on this figure:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_14.jpg" /></div><p>Notice how the<a id="id329" class="indexterm"></a> <span class="strong"><strong>WalkFWD</strong></span> state is a little bit brighter than the <span class="strong"><strong>Run_Impulse</strong></span> state, with the <span class="strong"><strong>ZSpeed</strong></span> parameter set at <code class="literal">0</code>, and switches as soon as we bring it to a max of <code class="literal">1</code>. That is the sign of blending, with the dominant clip being brighter. Not only that, but even the connecting cord color changes from blue to white based on which animation clip is currently dominant. This is to show how blend trees are going to work; the actual controls to these blends is in the <span class="strong"><strong>Inspector</strong></span> window, that now contains more parameters with previously added clips.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_15.jpg" /></div><p>Right below the blending <span class="strong"><strong>Parameter</strong></span>, you will find a pyramid graph that maps added motions to the <span class="strong"><strong>Parameter</strong></span> value. With two animations, we can clearly see that one of them is fully affecting the character at the <span class="strong"><strong>ZSpeed</strong></span> value of <code class="literal">0</code>, while linearly blending into a different animation by the time the parameter value reaches <code class="literal">1</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note23"></a>Note</h3><p>Left click and hold on any pyramid to see which animation clip it corresponds to.</p></div><p>
<code class="literal">0</code> to <code class="literal">1</code> <a id="id330" class="indexterm"></a>values are given to parameters by default; we can change that by modifying the maximum <span class="strong"><strong>Threshold</strong></span> value of the motions. All the motions listed, share the animation weight scale, meaning that the threshold is a point at which a single animation gets a 100 percent of the weight while others have no effect at all. This means that there is a value of the animation <span class="strong"><strong>Parameter</strong></span> at which only a single animation will be played. To change the <span class="strong"><strong>Threshold</strong></span> field, make sure to uncheck the <span class="strong"><strong>Automate Thresholds</strong></span> box right below it. Let's change the <span class="strong"><strong>Threshold</strong></span> value of the <span class="strong"><strong>Run_Impulse</strong></span> motion to <code class="literal">4</code> to better represent what's happening in the scene.</p><p>The aforementioned <span class="strong"><strong>Automate Thresholds,</strong></span> is actually a very useful parameter to keep in mind. It's main purpose is to evenly distribute all motions in between their min and max Thresholds. For example, if we were to add an additional motion in between walking and running, set it's <span class="strong"><strong>Threshold</strong></span> to <code class="literal">1</code> and check <span class="strong"><strong>Automate Threshold</strong></span>, it will instantly jump to <code class="literal">2</code> (<code class="literal">0</code>, <code class="literal">2</code>, <code class="literal">4</code>).</p><p>But what is actually happening when you add more than two motions? How do they share the graph? The rules are simple, but they aren't very intuitive from the first glance, it goes like this:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Each motion must have a <span class="strong"><strong>Threshold</strong></span> at which it becomes the only motion affecting the model</p></li><li style="list-style-type: disc"><p>At any point in time, animations have to share the 100 percent effect on the model</p></li><li style="list-style-type: disc"><p>Each motion down the <span class="strong"><strong>Motion</strong></span> list, should have a higher <span class="strong"><strong>Threshold</strong></span> value than the one above</p></li></ul></div><p>The first one is very easy to work around; if you don't wish a particular animation to be played without blending, just set its threshold at the point that the animation <span class="strong"><strong>Parameter</strong></span> won't reach.</p><p>The second one uses the same principal as, let's say, vertex weight painting; at any point in time, no animation or group of animations can affect the model more than 100 percent; if there are two animations and one of them is affecting the model at 80 percent, the affect of the other animation can't be anything but 20 percent, or there is no blending.</p><p>The third is more of a <a id="id331" class="indexterm"></a>recommendation, if you try to force a lower threshold, it will overlap with over motions and the results will be unpleasant to look at; this also makes sure that you don't have more than two active motions at a time.</p><p>But what if there is an actual need to blend more than two motions? Is there a way to do that? Certainly there is, but it might become a little bit hard to manage. The way to do that is by adding another <span class="strong"><strong>Blend Tree</strong></span> to the <span class="strong"><strong>Motion</strong></span> list instead of the <span class="strong"><strong>Motion</strong></span> field.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_16.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec20"></a>Other blend tree options</h4></div></div></div><p>There are two <a id="id332" class="indexterm"></a>other parameters in the motion list that are worth mentioning, next to the threshold:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc">
A clock sign <span class="inlinemediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_17.jpg" /></span> is an animation speed parameter and is particularly useful if you are trying to create a reverse motion, such as creating a landing motion from a jumping motion
</li><li style="list-style-type: disc">
Mirror animation <span class="inlinemediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_18.jpg" /></span> is available only for the humanoid rigs and allows you to mirror animation from one side of the body to another using an avatar
</li></ul></div><p>There are also two functions available at the very bottom:</p><p>
<span class="strong"><strong>Compute </strong></span>
<a id="id333" class="indexterm"></a>
<span class="strong"><strong>Thresholds</strong></span> is an interesting one. It allows you to automatically compute the threshold values based on the motion at the root of the animation. This basically means that if you have a walking and running animation that moves the character, you can use the <span class="strong"><strong>Speed</strong></span> parameter from the drop-down menu to control them and set up thresholds based on the speed at which the character moves. That is, however, completely useless if there is no root motion. The parameters available are:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Speed (the magnitude of velocity)</p></li><li><p>Velocity X</p></li><li><p>Velocity Y</p></li><li><p>Velocity Z</p></li><li><p>Angular Speed (Rad)</p></li><li><p>Angular Speed (Deg)</p></li></ol></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec67"></a>Adjust Time Scale</h3></div></div></div><p>If you've added a <span class="strong"><strong>Blend Tree</strong></span> to the <a id="id334" class="indexterm"></a>motion <a id="id335" class="indexterm"></a>list, delete it for this parameter to show up. Choosing <span class="strong"><strong>Homogeneous Speed</strong></span> will allow you to rescale the speed of animations based on the minimum and maximum value set in the motion list. Naturally, some animations can have different speed and length; however, blending has to find a compromise and readjust them so that all motions are played in a single blending. <span class="strong"><strong>Reset Time Scale</strong></span> will return the value of the animation speed to 1.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec68"></a>Layers</h3></div></div></div><p>Unlike animation blending, which is <a id="id336" class="indexterm"></a>a transition from one animation to another, there is a <a id="id337" class="indexterm"></a>demand for combining different animations to create new ones. What if we have an attack animation and a running animation, but we don't have the attack while running animation? Thankfully, we don't have to animate every single case scenario, and can choose to combine them instead by using animation layers.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec21"></a>Creation</h4></div></div></div><p>The <span class="strong"><strong>Layer</strong></span> tab is located<a id="id338" class="indexterm"></a> at the top right corner of the <span class="strong"><strong>Animator</strong></span> window; it allows us to add and remove layers by hitting the <span class="strong"><strong>+</strong></span> sign or navigating to <span class="strong"><strong>Right Click</strong></span> | <span class="strong"><strong>Delete</strong></span> as well as modify them.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_19.jpg" /></div><p>As you can see, there are <a id="id339" class="indexterm"></a>three parameters to control layers:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The <span class="strong"><strong>Weight</strong></span> slider controls the effect of each layer on the model.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Mask</strong></span> is the key component of making the combination of layers and animation combining work. By creating an <span class="strong"><strong>AvatarMask</strong></span> with upper body parts enabled, we can make them follow animation instructions given in this particular layer.</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Blending</strong></span> is a type of combining that we are planning to use; there are two to choose from:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
<span class="strong"><strong>Override</strong></span> will completely ignore any previous layers and overwrite motions with those from this layer for body parts specified in the <span class="strong"><strong>Avatar Mask</strong></span>
</p></li><li style="list-style-type: disc"><p>
<span class="strong"><strong>Additive</strong></span> will add the motion on top of previous layers and their motions</p></li></ul></div></li></ul></div><p>The <span class="strong"><strong>Weight</strong></span> parameter values are important to properly control <span class="strong"><strong>Blending</strong></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec22"></a>Hand waving on move motion</h4></div></div></div><p>To <a id="id340" class="indexterm"></a>combine the hand waving<a id="id341" class="indexterm"></a> and walking animations, we need to create an <span class="strong"><strong>AvatarMask</strong></span> first with only arms and head being affected, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <span class="strong"><strong>AvatarMask</strong></span> via the <span class="strong"><strong>Create</strong></span> drop-down menu of the <span class="strong"><strong>Project</strong></span> window.</p></li><li><p>Call it <span class="strong"><strong>WaveMask</strong></span>.</p></li><li><p>Under the <span class="strong"><strong>Humanoid</strong></span> property of the <span class="strong"><strong>WaveMask</strong></span> in the <span class="strong"><strong>Inspector</strong></span> window, uncheck everything but left hand, arm, and arm IKs.</p></li><li><p>Return to the <span class="strong"><strong>Animator</strong></span> <a id="id342" class="indexterm"></a>window and create a new layer called <span class="strong"><strong>Wave</strong></span> under the <span class="strong"><strong>Layer</strong></span> tab.</p></li><li><p>Set <span class="strong"><strong>Weight</strong></span> <a id="id343" class="indexterm"></a>parameter of the <span class="strong"><strong>Wave</strong></span> layer to 1.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_20.jpg" /></div></li></ol></div><p>Assign the newly created <a id="id344" class="indexterm"></a>
<span class="strong"><strong>WaveMask</strong></span> to the<a id="id345" class="indexterm"></a> <span class="strong"><strong>Mask</strong></span> property of the <span class="strong"><strong>Wave</strong></span> layer.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_21.jpg" /></div><p>We can now enter <a id="id346" class="indexterm"></a>the layer by clicking on it and setting up <a id="id347" class="indexterm"></a>the state for it.</p><p>Let's talk a little bit about how we communicate between layers. There is no transition from one layer to another and every layer has to have its own state system that will work independently from other layers. As such, our newly created <span class="strong"><strong>Wave</strong></span> layer will theoretically be in two possible states, the waving state and the passive state, which is all we require of it. Following this logic, we will need to create two states:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>The first state will be called <span class="strong"><strong>Passive</strong></span> and should contain no animation clip and be set to default</p></li><li style="list-style-type: disc"><p>The second state will be called <span class="strong"><strong>Waving</strong></span> and will contain <span class="strong"><strong>Robot_Armature|Robot_ArmatureAction</strong></span> <span class="strong"><strong>Animation Clip</strong></span> that was imported with our robot</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_22.jpg" /></div></li></ul></div><p>To control the state<a id="id348" class="indexterm"></a> transition, we will add a new parameter <a id="id349" class="indexterm"></a>of a trigger type and call it <span class="strong"><strong>Waved</strong></span>. Waved is controlled by code and will be enabled by a click; which transits us to the <span class="strong"><strong>Waving</strong></span> state and uncheck itself immediately (unlike bool, we don't need to bother disabling trigger via code). We also require two transitions from and to the <span class="strong"><strong>Passive</strong></span> state:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>From <span class="strong"><strong>Passive</strong></span> to <span class="strong"><strong>Waving</strong></span> will be controlled by the <span class="strong"><strong>Waved</strong></span> trigger, for that we need to list it under <span class="strong"><strong>Conditions</strong></span>
</p></li><li style="list-style-type: disc"><p>From <span class="strong"><strong>Waving</strong></span> to <span class="strong"><strong>Passive</strong></span> should be done as soon as the animation has finished playing, for that, we leave the default <span class="strong"><strong>Has</strong></span> <span class="strong"><strong>Exit</strong></span> <span class="strong"><strong>Time</strong></span> under the transition <span class="strong"><strong>Conditions</strong></span>
</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_23.jpg" /></div></li></ul></div><p>That's about it. With <a id="id350" class="indexterm"></a>everything set correctly, we should be <a id="id351" class="indexterm"></a>able to walk/run forward and wave with our hand.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec69"></a>2D blending</h3></div></div></div><p>Let's get back to blending for just a<a id="id352" class="indexterm"></a> second, or two. So far, we've looked into a blending mode controlled by a single parameter to make our walk to run transition possible; however, apart from walking in a straight line, we could also benefit from smoothly turning right and left instead of rapidly switching directions. To control this, we require an input from both the vertical and horizontal axes, there are twice as many parameters. Thankfully, Unity has got us covered here by providing 2D blending with various variations to suit our needs.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec23"></a>Blending variations</h4></div></div></div><p>Looking at the <a id="id353" class="indexterm"></a>blend tree in the <span class="strong"><strong>Inspector</strong></span> window, you probably have noticed that we've omitted speaking about a parameter called <span class="strong"><strong>Blend Type</strong></span>. This is done on purpose, as most blend types work in a similar fashion, as default <span class="strong"><strong>1D</strong></span> blending that we've looked at, with a layer of their own complexity deriving from working with twice as many parameters. So if, by any chance, you didn't fully grasp how <span class="strong"><strong>1D</strong></span> blending works, I would strongly recommend you go back and look at the examples provided with this chapter, along with the official documentation that comes with Unity (by clicking on the bookmark next to the <span class="strong"><strong>BlendTree</strong></span> name in the <span class="strong"><strong>Inspector</strong></span> window), as the topic we are about to <a id="id354" class="indexterm"></a>discuss will heavily rely on the previous material.</p><p>Feel confident? Good, let's move on!</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_24.jpg" /></div><p>The drop down menu of the <span class="strong"><strong>Blend Type</strong></span> parameter contains four options, as follows:</p><p>
<span class="strong"><strong>1D</strong></span>: The blending is controlled by one parameter, the one we've already looked at.</p><p>
<span class="strong"><strong>2D Simple Directional</strong></span>: This is the motion that is controlled by two parameters that represent direction. Taking walking as the example, we can use vertical and horizontal speeds as two directional parameters to control the single motion of walking. With this particular 2D blending type, we are limited to a single motion for single direction; therefore, no transition to running is possible.</p><p>
<span class="strong"><strong>2D Freeform Directional</strong></span>: This is just like the previous one, but with no single motion restriction. <span class="strong"><strong>Walking</strong></span> | <span class="strong"><strong>Jogging</strong></span> | <span class="strong"><strong>Running</strong></span> | <span class="strong"><strong>Sprinting</strong></span>: You name it and it can be incorporated into this blending type.</p><p>
<span class="strong"><strong>2D Freeform Cartesian</strong></span>: This type is better used with controlling parameters that don't represent directions, for something like angles.</p><p>
<span class="strong"><strong>Direct</strong></span>: This allows<a id="id355" class="indexterm"></a> you to directly control the blend parameter. It also allows you to assign a unique parameter to each motion for it to be controlled manually, which is perfect for facial expressions.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec24"></a>It's all about the dots</h4></div></div></div><p>In the <a id="id356" class="indexterm"></a>following example, we will use <span class="strong"><strong>2D Freeform Directional Blend Type</strong></span>. We will require a second parameter, which we will call <span class="strong"><strong>XSpeed</strong></span> of a type <span class="strong"><strong>Float</strong></span> and a 3rd motion in a <span class="strong"><strong>Motion</strong></span> list left empty. Your <span class="strong"><strong>Inspector</strong></span> window should now look similar to the one on the following figure:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_25.jpg" /><div class="caption"><p>Don't worry about getting the exact color grading, it will change based on the selected element</p></div></div><p>At first glance, this looks nothing like the simple graph from 1D blending; however, it is actually quite similar to, if not better than, a representation of motion transition.</p><p>Take a look at the <a id="id357" class="indexterm"></a>
<span class="strong"><strong>Motion</strong></span> list. Instead of the familiar threshold, we find <span class="strong"><strong>Pos X</strong></span> and <span class="strong"><strong>Pos Y</strong></span>, which are in fact, the thresholds of the first and the second controlled parameters (<span class="strong"><strong>ZSpeed</strong></span> is represented by the <span class="emphasis"><em>X</em></span> axis and <span class="strong"><strong>XSpeed</strong></span> by the <span class="emphasis"><em>Y</em></span> axis of the diagram). <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> motion positions are projected on the 2D plane and represented by the blue icons.</p><p>Here is how the mapping works. The origin is located in the center of the diagram with <span class="emphasis"><em>X</em></span> values increasing from left to right, while <span class="emphasis"><em>Y</em></span> values do the same from the bottom to the top.</p><p>By clicking on any blue icon, you will see a motion that it corresponds to, highlighted in the <span class="strong"><strong>Motion</strong></span> list or vice versa; selecting the motion from the list will highlight it on the diagram.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_26.jpg" /></div><p>By selecting <a id="id358" class="indexterm"></a>different motions, you will notice that the color of the diagram changes. The color indicates the weight of the specific motion in certain ranges of <span class="emphasis"><em>X</em></span> and <span class="emphasis"><em>Y</em></span> values, with saturation of the blue color indicating the weight influence. With the <span class="strong"><strong>Run_Impulse</strong></span> <span class="strong"><strong>Motion</strong></span> selected, you can see, on the diagram, that from its threshold position (<code class="literal">2</code>,<code class="literal">0</code>), it has full control over the animation; however, it gains less influence when closer to the origin, at which the <span class="strong"><strong>WalkFWD</strong></span> motion threshold is set.</p><p>The grey icon represents the motion list items that don't have animation clips selected for them (which is the empty clip that we've just created).</p><p>The red icon is our current value of two controlled parameters. You can change the values of <span class="strong"><strong>ZSpeed</strong></span> and <span class="strong"><strong>XSpeed</strong></span> on the <span class="strong"><strong>Blend Tree</strong></span> block and see it changing its position accordingly; or you can simply drag it within the diagram yourself and see the character react to the changes in the <span class="strong"><strong>Preview</strong></span> window. You can change the positions of blue and grey icons that way as well.</p><p>Last, but not<a id="id359" class="indexterm"></a> least, there is a circle around the blue icons which is a visual representation of the weight of the particular motion that it is circled around; the bigger the influence, the bigger the radius of the circle. You can try to drag the red icon from one motion to another and see the radius of circles around blue icons change.</p><p>Hopefully, this overview will make this diagram a little bit easier to read and manage as we are about to take a look at how to use it to create a full walk/run cycle for our character.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec70"></a>Creating locomotion</h3></div></div></div><p>Sounds like a little bit too <a id="id360" class="indexterm"></a>much to take in, well, let's take it in a more digestible form, and take a step–by-step approach to create a working character locomotion:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new animation controller and call it <span class="strong"><strong>Robot_Locomotion</strong></span>.</p></li><li><p>Assign it to the <span class="strong"><strong>Animator</strong></span> controller parameter of the robot.</p></li><li><p>Add the <span class="strong"><strong>Locomotion</strong></span> script to the robot components (located in the <code class="literal">Chapter 6</code> folder) and remove (or deactivate) <span class="strong"><strong>MoveForward</strong></span>.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec25"></a>Setup</h4></div></div></div><p>Here is a list of motions <a id="id361" class="indexterm"></a>that we will aim to create:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Walking (forward and backward)</p></li><li style="list-style-type: disc"><p>Strafing (right and left)</p></li><li style="list-style-type: disc"><p>Turning (while walking and on the spot)</p></li></ul></div><p>This will allow us to make full use of animations that we have and will require minimum code support.</p><p>Regarding parameters, there are three that we will require:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Float <span class="strong"><strong>ZSpeed</strong></span> and <span class="strong"><strong>XSpeed</strong></span> to control movement and rotation</p></li><li style="list-style-type: disc"><p>Bool <span class="strong"><strong>Strafing</strong></span> to know when our character needs to strafe and to avoid conflict with the walking cycle</p></li></ul></div><p>Add these parameters to the previously created <span class="strong"><strong>Robot_Locomotion</strong></span> animation controller, the script will take care of the input and will change parameters accordingly, so we don't have to worry about them.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec26"></a>Walking</h4></div></div></div><p>We will utilize a blend tree to help us create a<a id="id362" class="indexterm"></a> walking cycle.</p><p>Create a new <span class="strong"><strong>Blend Tree</strong></span> and rename it; <span class="strong"><strong>Locomotion</strong></span>.</p><p>To control this <span class="strong"><strong>Blend Tree</strong></span>, we will require two parameters, <span class="strong"><strong>ZSpeed</strong></span> and <span class="strong"><strong>XSpeed</strong></span>. One of the parameters is directional (<span class="strong"><strong>ZSpeed</strong></span>), but the other one is controlling the rotation of the character (<span class="strong"><strong>XSpeed</strong></span>) making <span class="strong"><strong>2D Freeform Cartesian Blend Type</strong></span> a logical choice.</p><p>As for <span class="strong"><strong>Motion</strong></span> fields, there are 5 that we will require with the following animations clips:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Idle_Neutral_1</p></li><li><p>WalkFWD</p></li><li><p>WalkFWD</p></li><li><p>SprintForwardTurnRight_NtrlWide</p></li><li><p>SprintForwardTurnRight_NtrlWide</p></li></ol></div><p>Having two walking animation clips is not a mistake as it might seem, we will use the same clip twice; for forward and backward motions, by changing the animation speed. To utilize the same animation of turning while moving forward, we will have to mirror one of them by checking the mirror checkbox.</p><p>For the parameter values, refer to the following figure:</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_27.jpg" /></div><p>Walking is mapped<a id="id363" class="indexterm"></a> to the <span class="emphasis"><em>W</em></span>, <span class="emphasis"><em>A</em></span>, <span class="emphasis"><em>S</em></span>, and <span class="emphasis"><em>D</em></span> buttons; try testing it right now.</p><p>There are some modifications that need to be applied to the animations in order to avoid some of the issues.</p><p>For <span class="strong"><strong>Idle_Neutral_1</strong></span> and <span class="strong"><strong>WalkFWD</strong></span>, check the following boxes:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>
<span class="strong"><strong>Loop</strong></span> <span class="strong"><strong>Time</strong></span>
</p></li><li><p>
<span class="strong"><strong>Loop</strong></span> <span class="strong"><strong>Pose</strong></span>
</p></li><li><p>
<span class="strong"><strong>Bake Into Pose</strong></span> under <span class="strong"><strong>Root Transform Rotation</strong></span>
</p></li></ol></div><p>The first two are expected; we want our idle animation to loop over and over again. The latter checkbox makes sure that the rotation done by the animation is not affecting the GameObjects<a id="id364" class="indexterm"></a> transform, to avoid the camera shaking while the character is playing this animation.</p><p>For <span class="strong"><strong>WalkForwardTurnRight_NtrlWide</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>
<span class="strong"><strong>Loop Time</strong></span> and <span class="strong"><strong>Loop</strong></span> <span class="strong"><strong>Pose</strong></span> need to be checked</p></li><li><p>
<span class="strong"><strong>Cycle</strong></span> <span class="strong"><strong>Offset</strong></span> needs to be set to <code class="literal">0.5</code> for smooth looping</p></li><li><p>
<span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>End</strong></span> need to be set to <code class="literal">16</code> and <code class="literal">362</code>, respectively</p></li></ol></div><p>Since we are using mocap data there are plenty of motions on animations that we don't need to create proper looping. The <span class="strong"><strong>Start</strong></span> and <span class="strong"><strong>End</strong></span> parameters allow us to isolate that particular region that will give the best results for looping.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec27"></a>Turning</h4></div></div></div><p>To turn animations, we will take a<a id="id365" class="indexterm"></a> fraction of the <span class="strong"><strong>Idle_NeutralTO45IdleTONeutralIdle </strong></span>clip and create a new clip from it called <span class="strong"><strong>Idle_To_Right </strong></span>in the <span class="strong"><strong>Clips</strong></span> list of the animation settings. The new clip will start from <code class="literal">280</code> and end at <code class="literal">315</code> with <span class="strong"><strong>Loop Time</strong></span> and <span class="strong"><strong>Loop Pose</strong></span> checked.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_28.jpg" /></div><p>Two <span class="strong"><strong>Idle_To_Right</strong></span> clips will be added to the <span class="strong"><strong>Locomotion</strong></span> blend tree with the parameters distribution displayed in the following figure. To eliminate small inconsistencies between the <span class="strong"><strong>WalkFWD</strong></span> and <span class="strong"><strong>WalkForwardTurnRight_NtrlWide</strong></span> animations, we are going to speed up the latter to <code class="literal">1.1</code> (up from <code class="literal">1</code>)</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_29.jpg" /></div><p>With this our <a id="id366" class="indexterm"></a>
<span class="strong"><strong>Locomotion</strong></span> blend tree will be complete and we can move to adding strafing.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch06lvl3sec28"></a>Strafing</h4></div></div></div><p>We have two animations<a id="id367" class="indexterm"></a> for strafing right and left; they will be controlled by <span class="strong"><strong>XSpeed</strong></span> and <span class="strong"><strong>Strafing</strong></span> bool, which will be enabled whenever we press the <span class="emphasis"><em>Q</em></span> or <span class="emphasis"><em>E</em></span> buttons on a keyboard. This might also be a perfect opportunity to introduce the <span class="strong"><strong>Sub-State Machine</strong></span>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch06lvl4sec11"></a>A sub-state machine</h5></div></div></div><p>Sub-State is essentially<a id="id368" class="indexterm"></a> a container for other states and a perfect opportunity to group multiple state machines to preserve space and improve readability.</p><p>A sub-state machine is created in the same way as the empty state:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right-click on the empty space of the <span class="strong"><strong>Animator</strong></span> window.</p></li><li><p>Select <span class="strong"><strong>Create Sub-State Machine</strong></span> from the drop-down menu</p></li><li><p>Call the sub-state machine <span class="strong"><strong>Strafe</strong></span>
</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_30.jpg" /></div></li></ol></div><p>With the sub-state machine <a id="id369" class="indexterm"></a>created, you may now enter it with a double-click. The environment inside the sub-state machine works exactly as it does on the inside; we can safely create new states, blend trees, and even more sub-states inside. In fact, let's do just that by creating a couple of states to represent strafing right and left—<span class="strong"><strong>right_strafe_walking</strong></span> and <span class="strong"><strong>left_strafe_walking</strong></span>.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_31.jpg" /></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch06lvl4sec12"></a>Modifying a strafing clip</h5></div></div></div><p>Just like with the<a id="id370" class="indexterm"></a> turning animation, we will require a fraction of the existing animation, and then need to create a new clip from it. For that we will use <span class="strong"><strong>Strafe_90HipsLeftFaceFwd</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new clip called <span class="strong"><strong>Strafe_Right</strong></span>.</p></li><li><p>Set <span class="strong"><strong>Start </strong></span>and <span class="strong"><strong>End </strong></span>to <code class="literal">90</code> and <code class="literal">120</code>.</p></li><li><p>Check <span class="strong"><strong>Loop Time</strong></span> and <span class="strong"><strong>Loop Pose</strong></span>.</p></li><li><p>Check <span class="strong"><strong>Bake Into Pose</strong></span> of the <span class="strong"><strong>Root Transform Rotation</strong></span>.</p></li><li><p>Set <span class="strong"><strong>Offset</strong></span> of the <span class="strong"><strong>Root Transform Rotation</strong></span> to <code class="literal">-20.8</code>.</p></li></ol></div><p>The reason for changing <a id="id371" class="indexterm"></a>the offset is to make this animation more or less loopable. Right now, the animation will move the robot making the start and the end of the animation different; offset will help us to align the start and the end of the clip in a slightly better way.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch06lvl4sec13"></a>Transition from and to sub-state</h5></div></div></div><p>In case you are wondering, the sub-states don't interfere with our ability to translate from one state to another. The <span class="strong"><strong>(Up) Base Layer</strong></span> block that exists in all sub-states will have all transition lines distributed to selected states and vice versa; you may create transitions to any state or blend tree outside of the sub-state by simply creating a transition like we normally did and selecting the one you are trying to connect to, from a drop-down menu.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_32.jpg" /></div><p>With that in mind, let's create transitions from and to both <span class="strong"><strong>Strafe</strong></span> states:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create the <a id="id372" class="indexterm"></a>transition from <span class="strong"><strong>Locomotion</strong></span> <a id="id373" class="indexterm"></a>to <span class="strong"><strong>right_strafe_walking</strong></span>, that should be controlled by the <span class="strong"><strong>Strafing</strong></span> bool being true, and <span class="strong"><strong>ZSpeed</strong></span> being greater than <code class="literal">0.1</code>.</p></li><li><p>Create a transition from <span class="strong"><strong>right_strafe_walking</strong></span> to <span class="strong"><strong>Locomotion</strong></span> that will be controlled by the <span class="strong"><strong>Strafe</strong></span> bool being <span class="strong"><strong>false</strong></span>.</p></li><li><p>Do the same thing for <span class="strong"><strong>left_strafe_walking</strong></span> with the only difference being, that <span class="strong"><strong>ZSpeed</strong></span> should be less than <code class="literal">-0.1</code>.</p></li><li><p>Uncheck <span class="strong"><strong>Has Exit Time</strong></span> on all four transitions</p></li><li><p>Assign the <span class="strong"><strong>Strafe_Right</strong></span> animation clip to both strafing states</p></li><li><p>Make sure that <span class="strong"><strong>Mirror</strong></span> is checked in the <span class="strong"><strong>left_strafe_walking</strong></span> state.</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_33.jpg" /></div></li></ol></div><p>Lastly we are going to add a <a id="id374" class="indexterm"></a>script to the camera, that will make it follow <a id="id375" class="indexterm"></a>our character from behind:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Find <span class="strong"><strong>CameraFollow.js</strong></span> inside the <span class="strong"><strong>Chapter 6</strong></span> folder</p></li><li><p>Add it to the <span class="strong"><strong>MainCamera</strong></span> GameObject in the <span class="strong"><strong>Hierarchy</strong></span> window</p></li><li><p>Drag and drop the <span class="strong"><strong>Robot</strong></span> GameObject from the scene to the <span class="strong"><strong>Char Obj</strong></span> parameter of the script</p><div class="mediaobject"><img src="/graphics/9781785282843/graphics/B04214_06_34.jpg" /></div></li></ol></div><p>Other parameters can be adjusted to your liking.</p><p>That's about it, you now should have an animator controller managing your character while walking, turning, and strafing with minimum scripting support.</p></div></div></div></div>