<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec46"></a>Collision management</h2></div></div><hr /></div><p>While describing the differences<a id="id279" class="indexterm"></a> between Character Controller and Rigidbody, we have mentioned several times that both these components provide collision detection for the game objects they are attached to. Since collision detection is a fundamental task that must be performed by any game (at least, any game we can think of!) and it can be a hard dude to deal with, in the following recipe, we provide a few examples to show you how collisions actually work in Unity.</p><p>If you want to detect whether a collision happens between two game objects, you need both of them to be equipped with a Collider. A Collider is a sort of cage that contains the game object to check whether another game object enters its boundaries. When this happens, a collision message is sent to the system. Unfortunately, two colliders hitting each other won't generate a detection!</p><p>The minimal requirement for a collision detection in Unity is that one has both a Collider and a Rigidbody, and the other has at least the Collider. The Unity manual offers a table to show the minimal requirements for collision detection<a id="id280" class="indexterm"></a> in Unity at <a class="ulink" href="http://docs.unity3d.com/Manual/CollidersOverview.html" target="_blank">http://docs.unity3d.com/Manual/CollidersOverview.html</a>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec113"></a>Getting ready</h3></div></div></div><p>We use an entire new scene for our next recipe: create a new empty scene in your existing Unity project and be ready to follow our instructions!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec114"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Let's begin by creating a new <span class="strong"><strong>Scene</strong></span> in the <a id="id281" class="indexterm"></a>Unity project and adding a <span class="strong"><strong>Plane</strong></span> game object to it.</p></li><li><p>Move <span class="strong"><strong>Plane</strong></span> to the bottom of your game scene and resize it as you see fit so it acts as the floor for your scene.</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_04_20.jpg" /></div></li><li><p>Create a <span class="strong"><strong>Cube</strong></span> and move it to the left and above the plane. You will notice that Unity automatically adds a <span class="strong"><strong>Box Collider</strong></span> to it:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_04_21.jpg" /></div></li><li><p>Add a Rigidbody <a id="id282" class="indexterm"></a>component to the cube; we described how to achieve that in be specific.</p></li><li><p>Play your scene: the cube falls on the plane due to gravity and stops as it comes in contact with the plane because when we added the plane to the scene, Unity automatically added the Collider component to it, too.</p></li><li><p>To detect the collision, we need a script. Create a new C# script in the <span class="strong"><strong>Scripts</strong></span> folder of the <span class="strong"><strong>Project</strong></span> panel and name it <code class="literal">CollisionDetection</code>.</p></li><li><p>Double-click on the script to open it in <span class="strong"><strong>Monodevelop</strong></span>.</p></li><li><p>Reach for the bottom of the script, outside the <code class="literal">Start</code> and <code class="literal">Update</code> functions, and add the following function:</p><div class="informalexample"><pre class="programlisting">void OnCollisionEnter(Collision collision)
{
  Debug.Log("Collision detected!");
}</pre></div></li><li><p>Save the file, go back to Unity, and drag it from the <span class="strong"><strong>Project</strong></span> panel to the <span class="strong"><strong>Cube</strong></span> in the <span class="strong"><strong>Hierarchy</strong></span> panel. The script should appear in the <span class="strong"><strong>Inspector</strong></span> panel as a component of the <span class="strong"><strong>Cube</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_04_22.jpg" /></div></li><li><p>Run the <a id="id283" class="indexterm"></a>application: as the cube touches the plane, the log message confirming that the collision has been detected is displayed.</p></li><li><p>Now add another GameObject to your scene, a sphere, and move it to the right side of the scene, with the same <span class="emphasis"><em>y</em></span> and <span class="emphasis"><em>z</em></span> coordinates as the cube.</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_04_23.jpg" /></div></li><li><p>Go back to<a id="id284" class="indexterm"></a> the <code class="literal">CollisionDetection</code> script in <code class="literal">Monodevelop</code> and add the following line inside the <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">void FixedUpdate () {

  rigidbody.AddForce(8*Vector3.right,ForceMode.Acceleration);

}</pre></div><p>With this line, we are instructing our cube to slowly move right on the <span class="emphasis"><em>x</em></span> axis, towards the sphere we just added.</p></li><li><p>Go back to Unity, uncheck the <span class="strong"><strong>UseGravity</strong></span> flag on the <span class="strong"><strong>Rigidbody</strong></span> component of the <span class="strong"><strong>Cube</strong></span>, and play the scene. The cube moves right and stops as it touches the sphere. The debug message is played as well.</p></li></ol></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip02"></a>Tip</h3><p><span class="strong"><strong>Downloading the example code</strong></span></p><p>You can download the example code files from your account at <a class="ulink" href="http://www.packtpub.com" target="_blank">http://www.packtpub.com</a> for all the Packt Publishing books you have purchased. If you purchased this book elsewhere, you can visit <a class="ulink" href="http://www.packtpub.com/support" target="_blank">http://www.packtpub.com/support</a> and register to have the files e-mailed directly to you.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec115"></a>How it works...</h3></div></div></div><p>What happens is that the cube and the sphere collide, but upon collision, the cube stops, because the sphere has no physical properties, except in its physical existence as an obstacle in the path of the cube.</p><p>If we want the sphere to be influenced by the collision, a <span class="strong"><strong>Rigidbody</strong></span> component must be added to the sphere, too. Do that and you'll see that when the cube hits the sphere, the latter will start moving as a consequence of the force it received from the collision!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec116"></a>There is more...</h3></div></div></div><p>We don't fear repetitions: collision detection<a id="id285" class="indexterm"></a> is a crucial component of games and it can be pretty harsh to deal with. Unity forums are exuberant with knowledge on the matter, so please refer to it whenever you have difficulties with collisions and the <code class="literal">OnCollisionEnter()</code> function<a id="id286" class="indexterm"></a> in general at <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Collider.OnCollisionEnter.html" target="_blank">http://docs.unity3d.com/ScriptReference/Collider.OnCollisionEnter.html</a>.</p><p>Also, remember that no solution is always good, so the best thing to do is to learn how to take advantage of the assets provided by Unity, depending on each specific condition.</p><p>We extensively discussed the differences between Character Controller and Rigidbody, so you can now decide which one better fits your needs. Finding the optimal balance between realism and fun is hard work and requires smart intuition. It is not by chance that this is one of the most important aspects in game design and balancing, which means that a lot of practice and experimentation are key to find that balance!</p></div></div>