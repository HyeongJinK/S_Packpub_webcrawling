<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec38"></a>Animation layers – creating masks</h2></div></div><hr /></div><p>With Mecanim, it is also possible to blend animations for different body parts of a character. Let's see an example. You have a character that runs with a gun in its hand and you have a reload animation that the character performs each time its weapon is empty. When the character reloads, you want his upper body, actually its arms, to perform the reload action, while the lower body of the character, its legs, should keep running.</p><p>To achieve that in Unity, Mecanim features what are known as <a id="id220" class="indexterm"></a>layers. Layers allow you to create masks<a id="id221" class="indexterm"></a> for specific body parts of a character and apply animation clips only on those parts. A running animation that involves legs and arms can be blended with a reload animation that only involves the character's arms, the result being that the character keeps running with its legs, while its arms reload the weapon!</p><p>As layers require masks to work, in the next recipe, we will show you how to make one.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec89"></a>Getting ready</h3></div></div></div><p>As we are not prototyping a 3D shooter here, we are not going to use actual animation clips for this recipe. We only show the required steps to use layers, for the time you will be willing to use them.</p><p>Have your project open in Unity; we left it with the <span class="strong"><strong>Animator</strong></span> control panel containing the animations we scripted so far: <span class="strong"><strong>Idle</strong></span>, <span class="strong"><strong>Run</strong></span>, <span class="strong"><strong>Walk</strong></span>, and <span class="strong"><strong>Jump</strong></span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec90"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>If you take a look at the top-left corner of the <span class="strong"><strong>Animator</strong></span> panel, you should see a box telling you we are working on <span class="strong"><strong>Base Layer</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_50.jpg" /></div></li><li><p>The first thing<a id="id222" class="indexterm"></a> to do is create an <code class="literal">Avatar Mask</code> out of the character avatar we are already using. Let's begin by creating a new folder in the project and name it <code class="literal">Masks</code>. We have done this operation several times; you won't need a reference picture…</p></li><li><p>Now create a new <code class="literal">Avatar Mask</code> in this folder by right-clicking on the project panel and navigating to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Avatar Mask</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_52.jpg" /></div></li><li><p>Name the <a id="id223" class="indexterm"></a>mask <code class="literal">UpperBody</code>.</p></li><li><p>We now need to configure the mask by selecting the body parts that we want to be affected by our theoretical reload animation clip.</p></li><li><p>Select <span class="strong"><strong>UpperBody</strong></span> in the project panel and move it to <span class="strong"><strong>Inspector</strong></span>. You should see two menu buttons: <span class="strong"><strong>Humanoid</strong></span> (this is because we set our avatar to <span class="strong"><strong>Humanoid</strong></span> when we imported this character's animation clips in <a class="link" href="#" linkend="ch01">Chapter 1</a>,<span class="emphasis"><em> Importing 3D Models and Animations</em></span>) and <span class="strong"><strong>Transform</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Humanoid</strong></span> panel, we have a representation of the character body. Right now, all body parts should be green, meaning that there is no selection made by the mask, yet. In this panel, green means that those parts are inside the mask and they will be affected by the layered animation clip, while red parts are out of the mask and the layered animation clip won't affect them. Clear enough?</p></li><li><p>Click on the head, body, legs, and shadow under the feet and the four small <span class="strong"><strong>IK</strong></span> red dots to exclude them from the mask, as shown in the following screenshot. Basically, only the arms and hands must be green.</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_53.jpg" /></div></li><li><p>Now expand the <a id="id224" class="indexterm"></a>
<span class="strong"><strong>Transform</strong></span> menu by clicking on it. You should have an empty field in the <span class="strong"><strong>Use skeletal from</strong></span> parameter (displaying <span class="strong"><strong>None</strong></span> (<span class="strong"><strong>Avatar</strong></span>)!), meaning no reference avatar is available to create the mask, yet.</p></li><li><p>Click on the small button to the right to display the avatars available in your project and select one. At this point, you should have a <span class="strong"><strong>CharAvatar</strong></span> available. Please refer to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_54.jpg" /></div></li><li><p>The mask <a id="id225" class="indexterm"></a>is now saved and ready to be applied to a character.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec91"></a>How it works...</h3></div></div></div><p>The principle to make masks is quite easy: starting from the actual avatar of your character, you can add or remove body parts to be included or excluded from those affected by specific animation clips. Thanks to Mecanim, the operation is quite transparent for the user! Still, many more settings are available that we didn't mention here, and we encourage you to refer to<a id="id226" class="indexterm"></a> the manual, available at <a class="ulink" href="http://docs.unity3d.com/Manual/class-AvatarBodyMask.html" target="_blank">http://docs.unity3d.com/Manual/class-AvatarBodyMask.html</a>.</p></div></div>