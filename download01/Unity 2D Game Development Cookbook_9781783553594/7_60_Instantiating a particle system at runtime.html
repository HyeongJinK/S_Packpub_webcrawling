<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec68"></a>Instantiating a particle system at runtime</h2></div></div><hr /></div><p>In this recipe, we take care of <a id="id441" class="indexterm"></a>instantiating a particle system <a id="id442" class="indexterm"></a>prefab in the place of a collected item that disappears, and also use the particle system to play the sound effect we set for this specific game event.</p><p>To achieve this, we need a new script and need to make some modifications to the <span class="strong"><strong>Runner</strong></span> script, so let's begin.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec176"></a>Getting ready</h3></div></div></div><p>Keep your project ready to add the new assets we need.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec177"></a>How to do it</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new C# script in the <span class="strong"><strong>Scripts</strong></span> folder of your project and name it <span class="strong"><strong>PS_Manager</strong></span>.</p></li><li><p>Edit the <code class="literal">Update()</code> function so that it contains the following lines. They tell the PS to destroy itself once the audio attached to it has finished playing:</p><div class="informalexample"><pre class="programlisting">void Update () {
  if(!audio.isPlaying){
    Destroy(this.gameObject);
  }
}</pre></div></li><li><p>Now open the <span class="strong"><strong>Runner</strong></span> script in <span class="strong"><strong>Monodevelop</strong></span>, if you did not open before.</p></li><li><p>To begin with, we <a id="id443" class="indexterm"></a>need a public <span class="strong"><strong>GameObject</strong></span> <a id="id444" class="indexterm"></a>variable to store the reference to the particle system prefab we are going to create in the scene. Add the following line to the script:</p><div class="informalexample"><pre class="programlisting">public GameObject ps;</pre></div></li><li><p>Add this line to the collectible's <code class="literal">if()</code> statement inside the <code class="literal">OnCollisionEnter()</code> function. It takes care of creating the PS in the place of the collectible, which can then be destroyed:</p><div class="informalexample"><pre class="programlisting">Instantiate(ps, c.transform.position, Quaternion.identity);</pre></div></li><li><p>For extra clarity, we are displaying the complete, updated <code class="literal">OnCollisionEnter()</code> function of the <span class="strong"><strong>Runner</strong></span> script:</p><div class="informalexample"><pre class="programlisting">void OnCollisionEnter(Collision c){
  
  if(c.gameObject.tag == "platform"){
    bIsTouch = true;
    charAnimator.SetBool("bJump",false);
  }
  if(c.gameObject.tag == "collectible"){
      Instantiate(ps, c.transform.position, Quaternion.identity);
      GameObject.Destroy(c.gameObject);
      collected += 1;
    }
  }</pre></div></li><li><p>Save both <span class="strong"><strong>Runner</strong></span> and <span class="strong"><strong>PS_Manager</strong></span> in <span class="strong"><strong>Monodevelop</strong></span>.</p></li><li><p>Drag <span class="strong"><strong>PS_Manager</strong></span> from the <span class="strong"><strong>Project</strong></span> panel onto the PS on the scene.</p></li><li><p>Now create a new prefab in the <span class="strong"><strong>Prefabs</strong></span> folder and name it <span class="strong"><strong>coll_ps_prefab</strong></span>. Then drag the particle system from the scene onto <span class="strong"><strong>coll_ps_prefab</strong></span> in the <span class="strong"><strong>Project</strong></span> panel. With that done, the particle system in the scene can be removed.</p></li><li><p>The last step is to select the <span class="strong"><strong>runner</strong></span> character in <span class="strong"><strong>Scene</strong></span> to access its <span class="strong"><strong>Runner</strong></span> script in the <span class="strong"><strong>Inspector</strong></span> panel, and from there, drag <span class="strong"><strong>coll_ps_prefab</strong></span> into the <span class="strong"><strong>Ps</strong></span> slot we created, with the <code class="literal">ps</code> public variable.</p><p>You can refer to the <a id="id445" class="indexterm"></a>following screenshot that shows the operation we just described:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_07_15.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec178"></a>How it works...</h3></div></div></div><p>Using the particle <a id="id446" class="indexterm"></a>system, we solved our problem of playing an audio clip on a game object that is about to be destroyed. Instead of putting the audio clip in the collectible item, we put it in a particle system prefab that we instantiate in the scene whenever a collectible is gathered by the player.</p><p>At the same time, we provide clear, consistent feedback to the player that they achieve something good when the character hits a collectible.</p></div></div>