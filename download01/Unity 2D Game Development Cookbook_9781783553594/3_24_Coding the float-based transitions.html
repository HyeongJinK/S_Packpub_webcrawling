<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec36"></a>Coding the float-based transitions</h2></div></div><hr /></div><p>With this recipe, we <a id="id210" class="indexterm"></a>show you how to use the actual speed of the character to update the value of a <code class="literal">float</code> variable. Once the values grow beyond the <code class="literal">0.5</code> threshold we defined in the <span class="strong"><strong>Animator</strong></span> window, the <span class="strong"><strong>Run</strong></span> clip is played.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec82"></a>Getting ready</h3></div></div></div><p>Open the script named <span class="strong"><strong>Char_Animator</strong></span> and be ready to edit the new lines we need to add the controls to switch between the walk and run clips.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec83"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First of all, we need to add a <span class="strong"><strong>Transform</strong></span> variable to store a reference to the character in the scene:</p><div class="informalexample"><pre class="programlisting">private Transform charRef;</pre></div></li><li><p>In the <code class="literal">Start()</code> function, we initialize our <span class="strong"><strong>Transform</strong></span> variable:</p><div class="informalexample"><pre class="programlisting">charRef = this.GetComponent&lt;Rigidbody&gt;();</pre></div></li><li><p>The <code class="literal">Rigidbody</code> function in the formula is a built-in component of Unity that allows physics to affect the game object. We will discuss this in a later chapter.</p></li><li><p>Next, we can add this single line in the <code class="literal">Update()</code> function of the script to make the <code class="literal">fSpeed</code> parameter equal to the character's horizontal speed, so that the proper animation clip is played depending on how fast the character is moving:</p><div class="informalexample"><pre class="programlisting">charAnimator.SetFloat("fSpeed", charRef.rigidbody.velocity.z);</pre></div></li><li><p>Next, we add another <code class="literal">if()</code> cycle to check whether the character is playing the <span class="strong"><strong>Idle2</strong></span> animation, and in such a case, we reset the <code class="literal">fWait</code> parameter to <code class="literal">0.0</code>.</p></li><li><p>Please refer to the following screenshot, where the entire script is displayed, so you can be sure you coded it right:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_29.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec84"></a>How it works...</h3></div></div></div><p>As you can see, coding<a id="id211" class="indexterm"></a> the transition based on a <code class="literal">float</code> parameter was pretty easy, thanks to that <code class="literal">Rigidbody</code> component that stores the actual speed of a game object. We will discuss the <span class="strong"><strong>Rigidbody</strong></span> component in detail in <a class="link" href="#" linkend="ch04">Chapter 4</a>, <span class="emphasis"><em>Taking Control</em></span>; what is important here is that we can equal the <code class="literal">float</code> parameter to the actual speed of the character to switch between clips.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec85"></a>There's more....</h3></div></div></div><p>There is <a id="id212" class="indexterm"></a>another relevant method available with <span class="strong"><strong>Animators</strong></span> that is worth a mention, called <code class="literal">GetCurrentAnimatorStateInfo</code>.</p><p>This method takes an <code class="literal">int</code> parameter to specify the animator layer we are addressing to, which in our case is <code class="literal">0</code>, as we are only using one layer of animations for the character.</p><p><code class="literal">GetCurrentAnimatorStateInfo</code> has a method of its own, called <code class="literal">IsName</code>, which allows you to check which animation clip is actually playing through a string parameter with the actual clip name.</p><p>The instruction would read like this:</p><p><code class="literal">charAnimator.GetCurrentAnimatorStateInfo(int).IsName("string");</code></p><p>Checking the actual <a id="id213" class="indexterm"></a>state (animation clip) a game character is performing at any moment can be useful, for example, if you plan to chain clips together and allow the second to be triggered only if the first is already playing. Can you imagine a game situation where you would need this?</p></div></div>