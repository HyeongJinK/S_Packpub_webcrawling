<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec39"></a>Animation layers â€“ adding a second animation layer</h2></div></div><hr /></div><p>With the mask ready and set up, we can move back to the <span class="strong"><strong>Animator</strong></span> panel to add a second animation layer. Be ready to follow our instructions.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec92"></a>Getting ready</h3></div></div></div><p>We follow on from where we left off . The avatar mask<a id="id227" class="indexterm"></a> is ready to be used with the <a id="id228" class="indexterm"></a>second animation layer.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec93"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With the <span class="strong"><strong>Animator</strong></span> editor open in Unity, click on the small <span class="strong"><strong>+</strong></span> on the widget in the top-left corner of the window to add a new <code class="literal">layer</code>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_51.jpg" /></div></li><li><p>Click on the <span class="strong"><strong>Name</strong></span> field and name this layer <code class="literal">UpperBody</code>, the same as the mask.</p></li><li><p>Set the <span class="strong"><strong>Weight</strong></span> parameter to <code class="literal">1</code>. This is sort of a default value; you may need to tweak it according to each of your actual animation clips.</p></li><li><p>Now click on the small button in the <span class="strong"><strong>Mask</strong></span> field to select <span class="strong"><strong>Mask</strong></span> from the panel, among the various options available in the project. Right now, you should see the <span class="strong"><strong>UpperBody</strong></span> mask we created in the previous recipe. Please refer to the following screenshot for these last three steps:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_55.jpg" /></div></li><li><p>The last <a id="id229" class="indexterm"></a>setting we are defining here is the blending mode we want for this <span class="strong"><strong>UpperBody</strong></span> layer to work. If you click on the <span class="strong"><strong>Blending</strong></span> drop-down menu, you can select two options: <span class="strong"><strong>Override</strong></span> and <span class="strong"><strong>Additive</strong></span>. In this case, we want <span class="strong"><strong>Override</strong></span> to be set, because, thinking about the reloading while running case, we actually want the arms to reload instead of running.</p></li><li><p><span class="strong"><strong>Additive</strong></span> is fine, on the other hand, when you want the final animation to be the result of both clips mixed together. This is not what we want now. Please refer to the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_56.jpg" /></div></li><li><p>Let's now<a id="id230" class="indexterm"></a> focus our attention on the actual <span class="strong"><strong>Animator</strong></span> panel. Right now, we don't have any state here, though we need two, at least: a default state, actually empty, and the reload animation clip (which we don't have for real!). Let's begin by adding an <span class="strong"><strong>Empty</strong></span> state, as we did before. You can refer to the following screenshot and remember that this state must be colored orange, as it is the default state for this layer:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_57.jpg" /></div></li><li><p>Now, assuming<a id="id231" class="indexterm"></a> you actually have a reload animation to use, drag it from the project panel into the <span class="strong"><strong>Animator</strong></span> editor, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_03_58.jpg" /></div></li><li><p>With the<a id="id232" class="indexterm"></a> <span class="strong"><strong>Reload</strong></span> clip added to the <span class="strong"><strong>UpperBody</strong></span> animation layer, the next steps would be to create a new parameter, a <code class="literal">trigger</code>, or a <code class="literal">boolean</code> parameter like we used before; make a transition between the default state of <span class="strong"><strong>UpperBody</strong></span> and reload; and finally, add instructions to the <code class="literal">AnimController</code> script to trigger the animation upon reloading the weapon.</p></li><li><p>Assuming you are going to use a <code class="literal">boolean</code> parameter called <code class="literal">bReload</code>, the line of code to be added would be:</p><div class="informalexample"><pre class="programlisting">charAnimator.SetBool ("bReload", true);</pre></div></li><li><p>We won't repeat the steps here to perform these operations, as they follow the same logic we described in the previous recipe. Try to do this on your own this time!</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec94"></a>How it works...</h3></div></div></div><p>Mask blending <a id="id233" class="indexterm"></a>and displacing animation clips on different layers is a technique that both allows you to create more complex animation trees for game characters while keeping the number of actual clips to be crafted at a minimum. In our case, we set a new layer to act only on the arms of the character and applied a reload animation clip to them, while the rest of the character's body keeps running, walking, or whatever.</p><p>As usual, we recommend you check out the manual for the more <a id="id234" class="indexterm"></a>advanced settings, available at <a class="ulink" href="http://docs.unity3d.com/Manual/AnimationLayers.html" target="_blank">http://docs.unity3d.com/Manual/AnimationLayers.html</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec95"></a>There's more...</h3></div></div></div><p>Mecanim<a id="id235" class="indexterm"></a> is one of the most relevant improvements to Unity in recent years. There is really very much you can achieve with it, especially if you plan to use humanoid characters for full 3D games.</p><p>An option we didn't discuss in this chapter is retargeting, which allows you to adapt a complete animation set to different characters with similar skeletal configurations. Retargeting is an efficient and economic way, for example, to offer your players the option to choose between male or female characters to play with. Instead of making a complete new animation set for the additional characters, you just retarget the set you have!</p><p>We suggest you refer to the <a id="id236" class="indexterm"></a>Unity documentation to learn more about the animator component, its features, and its methods. The manual is available at <a class="ulink" href="http://docs.unity3d.com/Manual/AnimationSection.html" target="_blank">http://docs.unity3d.com/Manual/AnimationSection.html</a>.</p><p>We suggest this <a id="id237" class="indexterm"></a>tutorial (<a class="ulink" href="http://www.digitaltutors.com/lesson/27480" target="_blank">http://www.digitaltutors.com/lesson/27480</a>) about character animation.</p><p>It is hosted by Digital Tutors: it is excellent, clear and quickly puts you on the track, though it comes with a price!</p></div></div>