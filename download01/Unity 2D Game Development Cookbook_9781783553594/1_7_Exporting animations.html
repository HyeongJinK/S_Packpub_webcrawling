<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec20"></a>Exporting animations</h2></div></div><hr /></div><p>It is very likely that models are<a id="id53" class="indexterm"></a> enriched with animations to improve the quality of their behavior as game objects. In the following recipe, we will see how to export animations from Maya.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec35"></a>Getting ready</h3></div></div></div><p>When exporting animations, two approaches are possible. One, which we will adopt in this book, is to keep things on separate files. With this approach, we export one FBX file for the model, the materials, and the rigging (as we did before), and one FBX file for each individual animation, such as idle, run, jump, and the like.</p><p>The other approach is to export everything on a single file. In this case, the exported FBX file will consist of the model, materials, rigging, and a timeline containing the frames for the entire animation set of the character. We will discuss this second approach later.</p><p>As usual, we took care of providing the required assets (animated Maya scenes for the model) in case you don't have any.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec36"></a>How to do it...</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>With the root node of <a id="id54" class="indexterm"></a>the animated model selected in the outliner, navigate to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Export Selection</strong></span> as usual.</p></li><li><p>Select <span class="strong"><strong>FBX File Format</strong></span> in the exporting panel and name your file. If you want Unity to automatically read the animation name when it is imported, follow the official naming convention that requires the animation file to be named <code class="literal">modelName@animationName</code> (with @ before the animation name). Assuming that we are about to export the <span class="strong"><strong>idle</strong></span> animation for our character, name the file <code class="literal">modelName@idle</code>.</p></li><li><p>Select the <code class="literal">destination</code> directory for the <code class="literal">Animation</code> file, which should be under <span class="strong"><strong>Animations</strong></span> in your Unity project.</p><div class="mediaobject"><img src="/graphics/9781783553594/graphics/3594OT_01_25.jpg" /></div></li><li><p>In the <span class="strong"><strong>Options...</strong></span> panel, we<a id="id55" class="indexterm"></a> need to make some adjustments to import the animation correctly. Under the <span class="strong"><strong>Animation</strong></span> tab, flag the <span class="strong"><strong>Animation</strong></span> option.</p></li><li><p>In the <span class="strong"><strong>Bake Animation</strong></span> field, check that <span class="strong"><strong>Bake Animation</strong></span> is flagged and that the starting and ending frame for the current animation are selected (this should be done automatically by Maya).</p></li><li><p>In the <span class="strong"><strong>Deformed Models</strong></span> field, check that all the flags are selected. These settings may change, depending on the specific requirements of each individual model and animation set.</p></li><li><p>You don't need to change anything else with regard to the setting we defined to export the static model, so you can click on <span class="strong"><strong>Export Selection</strong></span>.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec37"></a>How it works...</h3></div></div></div><p>As we will see in the following recipe, where we will edit the settings of the imported animation in Unity, what we get is an FBX file containing an animation clip named <code class="literal">idle</code>, which represents the idle animation for our character.</p><p>As we said before, it is possible to trace the animation clips on a single file\timeline and export all character animations in one FBX file; in this case, however, additional operations are required when compared to the one-file-one animation technique.</p><p>With a single file containing all the clips, Unity is not capable, by default, to read the timeline imported from Maya and automatically detecting the individual clips, and you end up with a single, most likely long, timeline named <code class="literal">track01</code> containing all the animations.</p><p>So you have to split the whole timeline by yourself, naming each clip individually and manually setting the start and end frames for each one of them in Unity Inspector.</p><p>If you think about a typical working pipeline with different people taking care of different operations, you may find your animators manually writing a text file of some sort with information regarding animation clip names and their reference frames. The animators then pass on this text file to someone responsible for taking care of importing animations in Unity. This last guy would also be responsible for typing the data found in the text file into Unity Inspector. A way of doing things that can easily lead to human errors, as you can imagine...</p><p>This is the reason why we<a id="id56" class="indexterm"></a> prefer using separate FBX files for each animation clip.</p><p>It is also possible to automate the exporting process so it doesn't become a time-consuming activity, but you may need a programmer for this.</p><p>The idea is to script a piece of code in MEL to handle the job. MEL is the scripting scaffold of Maya: any operation you perform in the Maya editor has an equivalent instruction in MEL. Since performing hardcoding in the MEL scripting language would go beyond the scope of this book, we just provide a few references here for those interested. The list of MEL <a id="id57" class="indexterm"></a>exporting commands is available at <a class="ulink" href="http://download.autodesk.com/us/fbx/20112/Maya/_index.html" target="_blank">http://download.autodesk.com/us/fbx/20112/Maya/_index.html</a>.</p><p>An example <a id="id58" class="indexterm"></a>MEL script, courtesy of James Kyle, is available at <a class="ulink" href="http://www.jameskyle.net/2013/03/maya-to-fbx-batch-export/" target="_blank">http://www.jameskyle.net/2013/03/maya-to-fbx-batch-export/</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec38"></a>There's more...</h3></div></div></div><p>For those of you who are interested in automating the exporting process, there are ways, pretty elegant too, that require advanced programming skills.</p><p>One way is to create a <span class="strong"><strong>Maya Embedded Language</strong></span> (<span class="strong"><strong>MEL</strong></span>) script that reads the scene in Maya and exports what you need, based on the settings you define for the exporting process. MEL<a id="id59" class="indexterm"></a> is the programming language behind Maya; any operation performed in Maya can be converted into a scripting instruction that will achieve exactly the same result. By using MEL, you can thus create a script that automatically exports animation clips into Unity on one or more FBX files, helping you save time (and reduce the risk of errors).</p><p>Another option is to configure Maya to generate an XML file that describes the animation data stored in the timeline of a model (animation names, starting\ending frames, and the like), and then read this XML file<a id="id60" class="indexterm"></a> from Unity to automatically create the required FBX files.</p><p>Both these approaches are very similar to using the post-processor to read custom attributes from Maya, as we discussed earlier.</p><p>If you'd like to go that way, you<a id="id61" class="indexterm"></a> can refer to the following <a id="id62" class="indexterm"></a>links:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><a class="ulink" href="http://download.autodesk.com/global/docs/maya2014/en_us/index.html?url=files/GUID-312387EC-2907-40D6-A0ED-1BE322106BBB.htm,topicNumber=d30e68424" target="_blank">http://download.autodesk.com/global/docs/maya2014/en_us/index.html?url=files/GUID-312387EC-2907-40D6-A0ED-1BE322106BBB.htm,topicNumber=d30e68424</a></p></li><li style="list-style-type: disc"><p><a class="ulink" href="http://forum.unity3d.com/threads/saving-and-loading-dataâ€¨-xmlserializer.85925/" target="_blank">http://forum.unity3d.com/threads/saving-and-loading-data-xmlserializer.85925/</a></p></li></ul></div></div></div>