<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec32"></a>Creating items</h2></div></div><hr /></div><a id="id636" class="indexterm"></a><p>What would a game be if a player could not go and pick up items? An unfortunate game I tell you. It is true they are not needed for all games, but just in case you need to keep track of them and display them, then we can give you a hands-on way to do it.</p><p>This system will allow you to keep track of items in your inventory and display them. We will keep track of images that will dictate which item is displayed and use the name to dictate which item is displayed and the information to be displayed. Also, the use of the items and display of their information will be tackled:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_06.jpg" /></div><a id="id637" class="indexterm"></a><p>Alright, let's take a look at what there is that needs to be done to get this system up and running:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create the <code class="literal">Change_Item</code> script.</p></li><li><p>Create the <code class="literal">UseItem</code> script.</p></li><li><p>Create the <code class="literal">PlayerStats</code> script.</p></li><li><p>Create the <code class="literal">textMesh</code> script.</p></li><li><p>Create the <code class="literal">TextManager</code> script.</p></li><li><p>Revisit the <code class="literal">Health</code> Script.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec49"></a>The Change_Item script</h3></div></div></div><a id="id638" class="indexterm"></a><a id="id639" class="indexterm"></a><p>This script is going to allow the player to press a button and toggle through the item array. Also, there is a function that can be called to add new items to that item array. To make this work, we will need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create variables to manage texture files and values.</p></li><li><p>Write changing items function.</p></li><li><p>Write functions for addition and removal from the array.</p></li><li><p>Handle texture rendering.</p></li><li><p>Create a function for the increment control.<a id="id640" class="indexterm"></a></p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec46"></a>Setting up the code</h4></div></div></div><a id="id641" class="indexterm"></a><a id="id642" class="indexterm"></a><p>So, first off, let's create our variables. The item array will be the first. It can be <code class="literal">private</code>. To show functionality of the script, two items have already been set up in the array. One variable will hold the <code class="literal">painKiller</code> texture<a id="id643" class="indexterm"></a> and the other will have the <code class="literal">healthPack</code> texture<a id="id644" class="indexterm"></a>. As we are dealing with arrays, we need a variable to handle the item to be removed and a variable for an item to be added. As we want to display item image, the item to be removed can be <code class="literal">String</code> and the item to add can be <code class="literal">Texture2D</code>. The last variable to set up at the moment is one to increment through the array:</p><div class="informalexample"><pre class="programlisting">public var itemLog : Array = new Array();
private var increment : int = 0;
public var painKiller: Texture2D;
public var healthPack: Texture2D;
private var itemToRemove: String;
private var itemToAdd: Texture2D;
private var item : String;</pre></div><p>Next, we will need some functions. As we need to add the <code class="literal">painKiller</code> and <code class="literal">healthPack</code> items to the array, we need that done in the <code class="literal">Awake</code> function. Then, based upon the first item in the array, we need to set the <code class="literal">mainTexture</code> of <code class="literal">gameObject</code>:<a id="id645" class="indexterm"></a></p><div class="informalexample"><pre class="programlisting">function Awake(){
        itemLog.Add(painKiller, healthPack );
        renderer.material.mainTexture = itemLog[increment];
    }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec47"></a>Changing items</h4></div></div></div><a id="id646" class="indexterm"></a><a id="id647" class="indexterm"></a><p>The next function that we want to create is <code class="literal">ChangeItem</code>. This function will increment through the array to the next item based upon the player's input and return the current item name. An <code class="literal">if </code>statement is used for this, and using the <code class="literal">GetKeyDown</code> function<a id="id648" class="indexterm"></a>, check for the <span class="emphasis"><em>J</em></span> key to be pressed and that our item array is larger than <code class="literal">0</code>. It is a precaution that makes sure no errors occur if we press the button when there are no items in the array. Inside, we will then call for the <code class="literal">IncrementControl</code> function<a id="id649" class="indexterm"></a> to make sure that the next time we press the <span class="emphasis"><em>I</em></span> key, it is the next item that comes up. This will be followed by the changing of <code class="literal">mainTexture</code> of the object using the current increment index. Lastly, we call the <code class="literal">ItemName</code> function<a id="id650" class="indexterm"></a> to return the current item:</p><div class="informalexample"><pre class="programlisting">function ChangeItem(){
        if (Input.GetKeyDown(KeyCode.J) &amp;&amp; itemLog.length &gt; 0){
            IncrementControl();
            renderer.material.mainTexture = itemLog[increment];
            ItemName();
        }
    }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec48"></a>Addition and removal</h4></div></div></div><a id="id651" class="indexterm"></a><a id="id652" class="indexterm"></a><p>The following two functions deal with addition of items to the array and their removal.</p><p>The first one is called <code class="literal">AddItemToList</code>
<a id="id653" class="indexterm"></a> and receives a <code class="literal">Texture2D</code> parameter. This function needs to be called externally. Inside the function, we want the <code class="literal">itemToAdd</code> variable to become equal to the  <code class="literal">newItem</code> added parameter variable. Now, we add that item to the array by using the <code class="literal">Add</code> function and specifying <code class="literal">itemToAdd</code> as its parameter. After that, we need to set the increment value to the length of the array as the <code class="literal">Add</code> function adds the new item to the end of the array. Next, we need to call the <code class="literal">ItemName</code> and <code class="literal">ItemDisplay</code> functions: <a id="id654" class="indexterm"></a><a id="id655" class="indexterm"></a></p><div class="informalexample"><pre class="programlisting">function AddItemToList(newItem : Texture2D){
    itemToAdd = newItem;
    itemLog.Add(itemToAdd);
    increment = itemLog.length - 1;
    ItemName();
    ItemDisplay();
}</pre></div><p>The second array function is <code class="literal">RemoveItemFromList</code> and it has a parameter variable of <code class="literal">String</code> represented by <code class="literal">removeItem</code>.</p><p>This function will take the incoming name and set it to a variable; and then using a <code class="literal">for</code> loop, we will loop through the array looking for the specific item that is to be removed. Upon finding it, we use the <code class="literal">RemoveAt</code> function.<a id="id656" class="indexterm"></a> It takes an integer index as its parameter so to make sure that we have the correct spot within the array, when searching through it, we use a counter that increments with each pass through the <code class="literal">for</code> loop. After removing the item, we do a check and see if the <code class="literal">increment</code> value is equal to the length of the list. If it is, we leave it as <code class="literal">0</code> and if it is not, we decrement it by <code class="literal">1</code>. After this, we call the <code class="literal">ItemName</code> function<a id="id657" class="indexterm"></a> to make sure that the appropriate information is displayed. As for the last function to call in here, it is <code class="literal">ItemDisplay</code>. The completed <code class="literal">RemoveItemFromList</code> function<a id="id658" class="indexterm"></a> should be as follows:</p><div class="informalexample"><pre class="programlisting">function RemoveItemFromList(removeItem : String){
    var newCounter : int = 0;
    itemToRemove = removeItem;
    for(n in itemLog){
        if(n.name == itemToRemove)	{
            itemLog.RemoveAt(newCounter);
            if(itemLog.length == 0){
                increment = 0;
            }else if(increment &gt; 0){
                increment -= 1;
            }
            ItemName();
        }
        newCounter++;
    }
    ItemDisplay();
}<a id="id659" class="indexterm"></a><a id="id660" class="indexterm"></a>
</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec49"></a>Displaying items</h4></div></div></div><a id="id661" class="indexterm"></a><p>The next function, which is <code class="literal">ItemDisplay</code>, controls the alpha and rendering of the texture. It consists of an <code class="literal">if</code> statement and an <code class="literal">else</code> <code class="literal">if</code>. The <code class="literal">if</code> statement checks if there is anything in the item array; if there is not, it sets the renderer alpha to <code class="literal">0</code>. The <code class="literal">else</code> <code class="literal">if</code> statement checks if the array is larger than <code class="literal">0</code> in length. If so, it sets the <code class="literal">mainTexture</code> of the material to that of the current <code class="literal">itemLog[increment]</code> and sets the alpha for the material back at <code class="literal">255</code>:</p><div class="informalexample"><pre class="programlisting">function ItemDisplay()
{
    if(itemLog.length == 0)
    {
        renderer.material.color.a = 0;
    }
    else if (itemLog.length &gt; 0)
    {
        renderer.material.mainTexture = itemLog[increment];
        renderer.material.color.a = 255;
    }
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec50"></a>Increment controls</h4></div></div></div><a id="id662" class="indexterm"></a><p>Next, let's create the <code class="literal">IncrementControl</code> function<a id="id663" class="indexterm"></a>. This function controls the incrementing of the item array. The easiest way is to have an <code class="literal">if</code> statement to check if <code class="literal">increment</code> is not at the end of the array. This is done by simply taking the array length and subtracting <code class="literal">1</code> from it. This needs to be done because arrays start at <code class="literal">0</code> in content and <code class="literal">1</code> for counting, so we therefore need to make sure that <code class="literal">-</code> <code class="literal">1</code> is there. If <code class="literal">increment</code> is not at the end of the array, add <code class="literal">1</code> to <code class="literal">increment</code>. However, if <code class="literal">increment</code> has reached the end of the array, we use an <code class="literal">else</code> statement to set <code class="literal">increment</code> back down to <code class="literal">0</code>:</p><div class="informalexample"><pre class="programlisting">function IncrementControl(){
        if(increment != itemLog.length - 1){
            increment += 1;
        }
        else{
            increment = 0;
        }
    }</pre></div><p>After the increment control, we need to add in one more function. Create an <code class="literal">Update</code> function and call the <code class="literal">ChangeItem</code> function:</p><div class="informalexample"><pre class="programlisting">function Update (){
ChangeItem();
}</pre></div><a id="id664" class="indexterm"></a><p>For the time being, we are done with this script. We need to build one other script before we can integrate other functionality into this one. The following code snippet shows how the <code class="literal">Change_Item</code> script<a id="id665" class="indexterm"></a> should look at this point:</p><div class="informalexample"><pre class="programlisting">public var itemLog : Array = new Array();
private var increment : int = 0;
private var itemToRemove: String;
private var itemToAdd: Texture2D;
public var painKiller: Texture2D;
public var healthPack: Texture2D;
function Awake(){
        itemLog.Add(painKiller, healthPack );
        renderer.material.mainTexture = itemLog[increment];
    }
    function ChangeItem(){
        if (Input.GetKeyDown(KeyCode.J) &amp;&amp; itemLog.length &gt; 0){
            IncrementControl();
            renderer.material.mainTexture = itemLog[increment];
            ItemName();
        }
    }
function AddItemToList(newItem : Texture2D)
{
    itemToAdd = newItem;
    itemLog.Add(itemToAdd);
    increment = itemLog.length - 1;
    ItemName();
    ItemDisplay();
}

function RemoveItemFromList(removeItem : String)
{
    var newCounter : int = 0;
    itemToRemove = removeItem;
    for(n in itemLog)
    {
        if(n.name == itemToRemove)
        {
            itemLog.RemoveAt(newCounter);
            if(itemLog.length == 0)
            {
                increment = 0;
            }else if(increment &gt; 0)
            {
                increment -= 1;
            }
            ItemName();
        }
        newCounter++;
    }
    ItemDisplay();
}

function ItemDisplay()
{
    if(itemLog.length == 0)
    {
        renderer.material.color.a = 0;
    }
    else if (itemLog.length &gt; 0)
    {
        renderer.material.mainTexture = itemLog[increment];
        renderer.material.color.a = 255;
    }
}

    function IncrementControl(){
        if(increment != itemLog.length - 1){
            increment += 1;
        }
        else{
            increment = 0;
        }
    }
    function Update () {
        ChangeItem();
    }</pre></div><p>One thing that you might have noticed so far, in this chapter, is that many of the scripts rely on others to make sure that their functionalities are working. We will be <a id="id666" class="indexterm"></a>backtracking into the scripts and adding covers, functions, or variables, so please be patient as everything will come together in the end.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec50"></a>Creating the UseItem script</h3></div></div></div><a id="id667" class="indexterm"></a><p>The <code class="literal">UseItem</code> script will have the functionality of making the selected item useable. There is only one variable that we need to set up at the moment. The first one we will create is the <code class="literal">itemName</code> variable<a id="id668" class="indexterm"></a>. It can be <code class="literal">private</code> and have its type as <code class="literal">String</code>:</p><div class="informalexample"><pre class="programlisting">private var itemName : String = null;</pre></div><p>Next, we want to go ahead and create the <code class="literal">SetItemName</code> function<a id="id669" class="indexterm"></a>. It will also have the parameter of item with type of <code class="literal">String</code>. This function is going to do just as its name implies, receive an item name and then set the <code class="literal">itemName</code> variable to that received name:</p><div class="informalexample"><pre class="programlisting">    function SetItemName(item : String)    {
        itemName = item;
    }</pre></div><p>Now that we have the item to be used, we can create our <code class="literal">UseItem</code> function. This function is going to allow us to press a key and at this moment, nothing will happen, but when we return after creating the <code class="literal">PlayerStats</code> script<a id="id670" class="indexterm"></a>, we can have the pressing of the key to have the effect that is wanted.</p><a id="id671" class="indexterm"></a><p>The function has the <code class="literal">if</code> statements that check the item name and if the <span class="emphasis"><em>Q</em></span> key was pressed. If <code class="literal">itemName</code> matches the <code class="literal">if</code> parameter<a id="id672" class="indexterm"></a>, the effect occurs. As we have two items in our item array at the moment, we have two <code class="literal">if</code> statements that it is checking:</p><div class="informalexample"><pre class="programlisting">    function UseItem(){
if (Input.GetKeyDown(KeyCode.Q)){
        switch(itemName):
    case:"painKiller"{
        }
    case:"healthPack"{
        }
}</pre></div><p>There are two more functions to write until we are done with this script. The first is the <code class="literal">Update</code> function<a id="id673" class="indexterm"></a>, which contains only the call for the <code class="literal">UseItem</code> function<a id="id674" class="indexterm"></a> and the second is a return function for item name:</p><div class="informalexample"><pre class="programlisting">function Update () {
    UseItem();
}
function ItemRemove(){return itemName;}</pre></div><p>This script is done for now. There is a lot more that needs to be added into this script for functionality, but first the <code class="literal">PlayerStats</code> script<a id="id675" class="indexterm"></a> needs to be written. That being said, we first need to return back to the <code class="literal">Change_Item</code> script and add some missing functionality:</p><div class="informalexample"><pre class="programlisting">private var itemName : String = null;
function SetItemName(item : String)    {
    itemName = item;
}
function UseItem(){
if (Input.GetKeyDown(KeyCode.Q)){
        switch(itemName):
    case:"painKiller"{
        }
    case:"healthPack"{
        }
}
function Update () {
    UseItem();
}
function ItemRemove(){return itemName;} <a id="id676" class="indexterm"></a>
</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec51"></a>Revisiting the Change_Item script</h3></div></div></div><a id="id677" class="indexterm"></a><a id="id678" class="indexterm"></a><p>Now that we are back in the <code class="literal">Change_Item</code> script, we can add two lines of code to the script. Thankfully, these two lines are exactly the same. What needs to be added is returning the item name to the <code class="literal">SetItemName</code> function of the <code class="literal">UseItem</code> script.</p><p>To do this, we need to create a variable to hold the <code class="literal">GameManager</code> object<a id="id679" class="indexterm"></a>. After that, we need to write the <code class="literal">ItemName</code> function<a id="id680" class="indexterm"></a>. In here, we have an <code class="literal">if</code> statement followed by <code class="literal">else</code>. The <code class="literal">if</code> statement sends the actual name based upon increment value. It is used when there are items in the array. When there are no items in the array, we send the <code class="literal">else</code> line. This line is identical to the preceding one in the <code class="literal">if</code> statement except that for the parameter for the <code class="literal">SetItemName</code> function<a id="id681" class="indexterm"></a>, we use <code class="literal">placeholder</code> to kill it and not display anything:</p><div class="informalexample"><pre class="programlisting">function ItemName()
{
    if(itemLog.length &gt; 0)
    GameManager.GetComponent("UseItem").SetItemName(itemLog[increment].name);
    else
    GameManager.GetComponent("UseItem").SetItemName("placeholder");
}</pre></div><p>The <code class="literal">itemLog</code> line can also be copied into the <code class="literal">Awake</code> function to have the display change automatically:</p><div class="informalexample"><pre class="programlisting">    var GameManager : GameObject;
    function Awake(){
    GameManager.GetComponent("UseItem").SetItemName(itemLog[increment].name);
    }
    function ItemName()
{
    if(itemLog.length &gt; 0)
    GameManager.GetComponent("UseItem").SetItemName(itemLog[increment].name);
    else
    GameManager.GetComponent("UseItem").SetItemName("placeholder");
}<a id="id682" class="indexterm"></a><a id="id683" class="indexterm"></a>
</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec52"></a>The PlayerStats script</h3></div></div></div><a id="id684" class="indexterm"></a><a id="id685" class="indexterm"></a><p>This script handles various statistics of the player. It is a reference script and so it contains many return statements. We will cover what we can do with this script for the time being.</p><p>Some of the variables that the script has are <code class="literal">painCount</code>, the number of <code class="literal">painKiller</code> instances, <code class="literal">healthCount</code>, the number of <code class="literal">healthPack</code> instances, a return value for the <code class="literal">healthPackValue</code> upon the use of <code class="literal">healthPack</code>, and lastly an <code class="literal">item</code> variable to handle incoming item names:</p><div class="informalexample"><pre class="programlisting">public var painCount : int = 2;
public var healthCount : int = 5;
public var healthPackValue : float = 25;
private var item : String = null;</pre></div><p>After we have established our variables, there are a couple of functions that we need to write. These functions are non-return functions. Those will come next.</p><p>First off, we need to create the <code class="literal">DecrementItemCount</code> function<a id="id686" class="indexterm"></a>. This function allows an item being used to be identified and then have its visual count number decrease upon the HUD. The function has the <code class="literal">item</code> variable become equal to the <code class="literal">ItemRemove</code> function from the <code class="literal">UseItem</code> script. These are on the same <code class="literal">gameObject</code> so it is easy using the <code class="literal">gameObject.GetComponent</code> function here. Next, there are two <code class="literal">if</code> statements. The second one is <code class="literal">else</code> <code class="literal">if</code>. They are basically checking the <code class="literal">item</code> variable's value against a predetermined name, in our case, <code class="literal">painKiller</code> and <code class="literal">healthPack</code>. Inside each <code class="literal">if</code> statement, we have their respective variables, <code class="literal">painCount</code> for <code class="literal">painKiller</code> instances and <code class="literal">healthCount</code> for <code class="literal">healthPack</code>. Here, we will subtract <code class="literal">1</code> from their counts. Lastly, we will write a line here, which will reflect our next two steps in putting together the HUD. We will start with the <code class="literal">DecrementItemCount</code> function that should look like the following code snippet:<a id="id687" class="indexterm"></a></p><div class="informalexample"><pre class="programlisting">function DecrementItemCount()
{
    item = gameObject.GetComponent("UseItem").ItemRemove();
    
    if(item == "painKiller")
    {
        painCount -= 1;
    }
    
    else if(item == "healthPack")
    {
        healthCount -= 1;
    }
}</pre></div><p>This line will access the <code class="literal">TextManager</code> script and grab the <code class="literal">itemText</code> list array slot <code class="literal">0</code> from this script (this is a list of <code class="literal">gameObject</code> instance<a id="id688" class="indexterm"></a>s that are representative of the various screen displays of text). From there, we want to access the <code class="literal">textMesh</code> component and the <code class="literal">DisplayInformation</code> function<a id="id689" class="indexterm"></a> from that component. The display information script has two parameters, one is the <code class="literal">item</code> variable identifying the particular item information to display and the other is the <code class="literal">Color</code> that the text should be identified with:</p><div class="informalexample"><pre class="programlisting">gameObject.GetComponent("TextManager").itemText[0].GetComponent("textMesh").DisplayInformation(item, Color.black);</pre></div><p>A single function now remains, which is the <code class="literal">ResetValues</code> function<a id="id690" class="indexterm"></a>. This function is called externally from another script to reset the amount that a useable item has, for instance, health and ammo. Inside of the function, we check the amount remaining in the item and, if it is equal to 0, we then have the item's amount returned to its default value. This can be looked at as a crude form of reload:</p><div class="informalexample"><pre class="programlisting">function ResetValues(ammo:String, itemCount:String)
{
    if(painCount &lt;= 0)
    painCount = 2;
    else if(healthCount &lt;= 0)
    healthCount = 5;
}</pre></div><a id="id691" class="indexterm"></a><a id="id692" class="indexterm"></a><p>Now that this is taken care of, we can write those return functions. The first one will return <code class="literal">painCount</code>, the second one will return <code class="literal">healthCount</code>, and the third one will return <code class="literal">healthPackValue</code>:</p><div class="informalexample"><pre class="programlisting">function ReturnPainCount(){return painCount;}
function ReturnHealthCount(){return healthCount;}
function ReturnHealthPackValue(){return healthPackValue;}</pre></div><p>For now, the <code class="literal">PlayerStats</code> script is done. It will have to be revisited when dealing with weapons and ammo:</p><div class="informalexample"><pre class="programlisting">public var painCount : int = 2;
public var healthCount : int = 5;
public var healthPackValue : float = 25;
private var item : String = null;
function DecrementItemCount()
{
    item = gameObject.GetComponent("UseItem").ItemRemove();
    
    if(item == "painKiller")
    {
        painCount -= 1;
    }
    
    else if(item == "healthPack")
    {
        healthCount -= 1;
    }
gameObject.GetComponent("TextManager").itemText[0].GetComponent("textMesh").DisplayInformation(item, Color.black);
]
function ResetValues(ammo:String, itemCount:String)
{
    if(painCount &lt;= 0)
    painCount = 2;
    else if(healthCount &lt;= 0)
    healthCount = 5;
}
function ReturnPainCount(){return painCount;}
function ReturnHealthCount(){ return healthCount;}
function ReturnHealthPackValue(){ return healthPackValue;}<a id="id693" class="indexterm"></a><a id="id694" class="indexterm"></a>
</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec53"></a>The TextManager script</h3></div></div></div><a id="id695" class="indexterm"></a><a id="id696" class="indexterm"></a><p>The <code class="literal">TextManager</code> script is a reference holder for several GUI elements in the HUD. It will help in the displaying of ammo, items remaining, score, saved game prompt, and objective display.</p><p>A very short script containing a couple of functions, it plays a huge role in keeping everything separate and clean and is very easy to use. It acts as a hub and redistributes information to referenced sources. The script has a <code class="literal">GameObject</code> variable<a id="id697" class="indexterm"></a> list that holds those <code class="literal">gameObject</code> variables stated previously. Each <code class="literal">gameObject</code> in that array has a specific component on it, which allows this script to work.</p><p>So, talking about variables, let's define ours. As stated, we need the <code class="literal">itemText</code> <code class="literal">GameObject</code> variable array:</p><div class="informalexample"><pre class="programlisting">public var itemText : GameObject[];</pre></div><p>As said before, this is a short script. The last thing to do now is write the <code class="literal">ReturnTextManager</code> function, which returns the <code class="literal">itemText</code> variable:</p><div class="informalexample"><pre class="programlisting">function ReturnTextManager(){return itemText;}</pre></div><p>And that is literally it for this script, at least for the time being. We will return here in a little while. The <code class="literal">textMesh</code> script will be displaying all text information.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec54"></a>The textMesh script</h3></div></div></div><a id="id698" class="indexterm"></a><a id="id699" class="indexterm"></a><p>Moving on to our next script to write, which will be our largest so far. The <code class="literal">textMesh</code> script will pretty much display our informative text all over the screen. It will look at the <code class="literal">gameObject</code> that it is attached to and, based upon that, determine the set of data to display.</p><p>Let's move on to variables. First off, we need a variable to determine color. This color will be our default and will be used in case a color is not specified on particular text. Next, we need a variable to hold <code class="literal">gameManager</code>, one for the <code class="literal">PlayerStats</code> script, another for referencing of an item's name, and one more to reference the text component of the Unity <code class="literal">TextMesh</code> component<a id="id700" class="indexterm"></a>. Then, the last to be written are <code class="literal">boolean</code> variables for each <a id="id701" class="indexterm"></a>object in the <code class="literal">itemText</code> variable of the <code class="literal">textManager</code> script. At the moment, there needs to be only one:</p><div class="informalexample"><pre class="programlisting">public var newColor : Color = Color.black;
public var gameManager : GameObject;
private var playerStatScr : PlayerStats;
private var itemName : String;
private var myText : TextMesh;
private var itemDisplay : boolean = false;</pre></div><p>Now, there are just two more functions to write. One for the <code class="literal">Awake</code> function and the other for the display information.</p><p>In the <code class="literal">Awake</code> function, we want the <code class="literal">myText</code> variable to get a reference of the <code class="literal">textMesh</code> component on the <code class="literal">gameObject</code>. We then create an <code class="literal">if</code> statement to grab which <code class="literal">gameObject</code> we are on, based upon the name of the <code class="literal">gameObject</code>. In this case, as it is only the one, we can just create the <code class="literal">if</code> statement for <code class="literal">itemMultiplier</code> and set <code class="literal">itemDisplay</code> to <code class="literal">true</code>. Next, we will need to set the reference of the <code class="literal">PlayerStats</code> script by using <code class="literal">gameManager.GetComponent</code>. Next, we need to make sure that our default color chosen is applied at the very beginning. As the <code class="literal">TextMesh</code> component is directly referencing the material of the <code class="literal">gameObject</code>, we can just change <code class="literal">renderer.material.color</code> to our specified color. The last line to write in here is the calling of <code class="literal">DisplayInformation</code>. It is to make sure that all information that needs to be displayed, is displayed right off the bat. The variables for its parameters are <code class="literal">itemName</code> and <code class="literal">newColor</code>:<a id="id702" class="indexterm"></a></p><div class="informalexample"><pre class="programlisting">function Awake()
{
myText = (GetComponent("TextMesh") as TextMesh);
    if(gameObject.name == "itemMultiplier")
    {
        itemDisplay = true;
    }
playerStatScr = gameManager.GetComponent("PlayerStats");
renderer.material.color = Color.black;
DisplayInformation(itemName, newColor);
}</pre></div><p>Now, let's move on to the <code class="literal">DisplayInformation</code> function<a id="id703" class="indexterm"></a>. This function will be looking at the text name coming in and its color, and depending on that, it determines which information to display, where to display it, and how it should be colored. Its parameters are <code class="literal">String</code> and <code class="literal">Color</code>.</p><p>First off, we have set the <code class="literal">itemName</code> variable equal to the incoming name (<code class="literal">textName</code>) and the <code class="literal">newColor</code> variable equal to the incoming <code class="literal">textColor</code>. Then, we want to start processing our information. We do an <code class="literal">if</code> check to determine which <code class="literal">gameObject</code> this is. If <code class="literal">itemDisplay</code>, for instance, is <code class="literal">true</code>, we can proceed with item display, which we are. Next, we have two <code class="literal">if</code> statements and one <code class="literal">else</code> statement. The <code class="literal">if</code> statements are used to determine which item is selected based upon its name. Then, depending on that, the color is applied from the function parameter and the necessary text is displayed.</p><p>In order to display the necessary text, we must convert our wanted information, an integer, into a string. To do this, we have a <code class="literal">myText</code> reference to the text input and have it equal to the text that we don't want to change, which is represented by the text in quotation marks concatenated with the information that needs to be dynamically changing. Then a bracket wrapper needs to be put around the display information. For our two-item <code class="literal">if</code> statements, the information that we want to display is the current item count, which is being returned by the <code class="literal">PlayerStats</code> script.</p><a id="id704" class="indexterm"></a><a id="id705" class="indexterm"></a><p>The <code class="literal">else</code> statement that follows right after the <code class="literal">if</code> statements has a single line, which defaults the item display text to null:</p><div class="informalexample"><pre class="programlisting">function DisplayInformation(textName : String, textColor : Color)
{
    itemName = textName;
    newColor = textColor;
    //
    if(itemDisplay)
    {
        if(textName == "healthPack")
        {
            renderer.material.color = newColor;
            myText.text = ("X " + playerStatScr.ReturnHealthCount());
        }
        
        else if(textName == "painKiller")
        {
            renderer.material.color = newColor;
            myText.text = ("X " + playerStatScr.ReturnPainCount());
        }
        else
        myText.text = "";
    }
}</pre></div><p>There we go. That is our <code class="literal">textMesh</code> script<a id="id706" class="indexterm"></a>. There is more to add but at least the foundation has been laid.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec55"></a>Revisiting the UseItem script</h3></div></div></div><a id="id707" class="indexterm"></a><a id="id708" class="indexterm"></a><p>Now that we have our foundations laid in some other scripts, we can go back to our <span class="strong"><strong>UseItem</strong></span> script and add some additional functionality.</p><p>First off, we need to create some new variables. One variable of <code class="literal">gameObject</code> type to hold reference to the item switching manager, another for referencing the <code class="literal">PlayerStats</code> script, a <code class="literal">float</code> variable for <code class="literal">healthPackValue</code>, and one more for referencing the <code class="literal">Health</code> script:</p><div class="informalexample"><pre class="programlisting">public var itemManager : GameObject;
private var playerStatScr : PlayerStats;
private var healthPackValue : float;
private var healthScr : Health;</pre></div><p>Next, we need to create an <code class="literal">Awake</code> function. In here, we will be setting up the referencing for the <code class="literal">playerStatScr</code> and <code class="literal">healthScr</code> variables and calling the <code class="literal">SethealthPackValue</code> function.</p><a id="id709" class="indexterm"></a><p>Before we create the <code class="literal">SethealthPackValue</code> function, let's add a line of code at the end of the <code class="literal">SetItemName</code> function. This line is identical to the one found in the <code class="literal">PlayerStats</code> script inside the <code class="literal">DecrementItemCount</code> function except that you will have to change the parameter of <code class="literal">DisplayInformation</code> from <code class="literal">item</code> to <code class="literal">itemName</code>:</p><div class="informalexample"><pre class="programlisting">gameObject.GetComponent("TextManager").itemText[0].GetComponent("textMesh").DisplayInformation(itemName, Color.black);</pre></div><p>Now, we can create the <code class="literal">SethealthPackValue</code> function. In here, there is a single line that has <code class="literal">healthPackValue</code> referencing the <code class="literal">ReturnHealthPackValue</code> function from the <code class="literal">PlayerStats</code> script:</p><div class="informalexample"><pre class="programlisting">function SethealthPackValue()
{
    healthPackValue = playerStatScr.ReturnHealthPackValue();
}</pre></div><p>Inside of the <code class="literal">UseItem</code> function, we need to add some functionality to <code class="literal">healthPack</code>—<code class="literal">if</code> statement as well as some parameters to the <code class="literal">if</code> statement itself. After checking for the input from the player for the <span class="emphasis"><em>Q</em></span> button, we now need to add two more parameters if we want to use the health kits with our health bar.</p><a id="id710" class="indexterm"></a><a id="id711" class="indexterm"></a><p>The first parameter to be added is to check that we have health packs remaining for use and the second is to check that our current health is less than our maximum health. The health pack count is coming from the <code class="literal">ReturnHealthCount</code> function of <code class="literal">PlayerStats</code>, and <code class="literal">ReturnCurrentHealth</code> and <code class="literal">SendHealthMax</code> are from the <code class="literal">Health</code> script:</p><div class="informalexample"><pre class="programlisting">.... &amp;&amp; playerStatScr.ReturnHealthCount() &gt; 0 &amp;&amp; healthScr.ReturnCurrentHealth() &lt; healthScr.SendHealthMax())</pre></div><p>Inside of the <code class="literal">if</code> statement, we need to call the <code class="literal">DecrementItemCount</code> function from <code class="literal">PlayerStats</code> as well as give <code class="literal">healthPackValue</code> to the <code class="literal">GetHealth</code> function from the <code class="literal">Health</code> script as its parameter:</p><div class="informalexample"><pre class="programlisting">playerStatScr.DecrementItemCount();
healthScr.GetHealth(healthPackValue);</pre></div><p>The last line added to the function calls the next function—<code class="literal">RemoveItemFromArray</code>, which we will write next.</p><p>The <code class="literal">RemoveItemFromArray</code> function<a id="id712" class="indexterm"></a> checks if <code class="literal">itemName</code> coinciding with one it knows has no more remaining uses. If the item has no more uses, it sends the name of the currently selected item to the <code class="literal">RemoveItemFromList</code> function with the <code class="literal">ItemRemove</code> function of <code class="literal">UseItem</code> on the <code class="literal">ChangeItem</code> script. After this line, the <code class="literal">ResetValues</code> script <a id="id713" class="indexterm"></a>from <code class="literal">PlayerStats</code> is called:</p><div class="informalexample"><pre class="programlisting">function RemoveItemFromArray()
{
    if(itemName == "healthPack" &amp;&amp; playerStatScr.ReturnHealthCount() &lt;= 0)
    {
        itemManager.GetComponent("Change_Item").RemoveItemFromList(ItemRemove());
        playerStatScr.ResetValues();
    }
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec56"></a>Revisiting the Health script</h3></div></div></div><a id="id714" class="indexterm"></a><a id="id715" class="indexterm"></a><p>We are back in the <span class="strong"><strong>Health</strong></span> script. We should not spend much time here as there is only one function to write.</p><p>In order for us to be able to use a health pack and make it affect the visual representation of the health bar, we need to add it to the existing current health. By using the <code class="literal">GetHealth</code> function, we can receive a value and then add that value to the existing health:</p><div class="informalexample"><pre class="programlisting">function GetHealth(inputHealth : float)
{
    currentHealth += inputHealth;
}</pre></div><p>And so ends our time in the <code class="literal">Health</code> script again.</p></div></div>