<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec33"></a>Creating armor</h2></div></div><hr /></div><a id="id716" class="indexterm"></a><p>Now that we can see health packs working and all the foundations of the code are in, we can go in and finish hooking up the armor scripts and functionality.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_07.jpg" /></div><p>So, before we go ahead and rush towards creating the script, let's take a look at what it is that needs to be done:<a id="id717" class="indexterm"></a></p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create the <code class="literal">Armor</code> script.</p></li><li><p>Revisit the <code class="literal">HealthBar</code> script.</p></li><li><p>Revisit the <code class="literal">Health</code> script.</p></li><li><p>Revisit the <code class="literal">UseItem</code> script.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec57"></a>The Armor script</h3></div></div></div><a id="id718" class="indexterm"></a><p>The <code class="literal">Armor</code> script's functionality and looks are very similar to that of the <code class="literal">Health</code> script, and as a matter of fact, we are going to ask you to copy several functions and variables over and we can then tweak them.</p><p>First off, copy all of the following variables out of the <code class="literal">Health</code> script and paste them into the <code class="literal">Armor</code> script:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="literal">healthMax</code>
<a id="id719" class="indexterm"></a>: Rename to <code class="literal">armorMax</code></p></li><li style="list-style-type: disc"><p><code class="literal">healthMin</code>
<a id="id720" class="indexterm"></a>: Rename to <code class="literal">armorMin</code></p></li><li style="list-style-type: disc"><p><code class="literal">currentHealth</code>
<a id="id721" class="indexterm"></a>: Rename to <code class="literal">currentArmor</code></p></li><li style="list-style-type: disc"><p><code class="literal">healthBar</code>
<a id="id722" class="indexterm"></a>: Don't rename</p></li><li style="list-style-type: disc"><p><code class="literal">healthBarScr</code>
<a id="id723" class="indexterm"></a>: Don't rename</p></li></ul></div><p>Also, add a <code class="literal">boolean</code> variable—<code class="literal">armorActive</code> to track when armor has been activated.</p><p>Next, we are going to copy over the following functions and rename some variable names:</p><p><code class="literal">Awake</code> function<a id="id724" class="indexterm"></a></p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Rename <code class="literal">currentHealth</code> and <code class="literal">healthMax</code> with their appropriate names</p></li></ul></div><p><code class="literal">PlayerHealth</code> function<a id="id725" class="indexterm"></a></p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Rename the <code class="literal">KeyCode</code> from <span class="emphasis"><em>-</em></span> to <span class="emphasis"><em>A</em></span></p></li><li style="list-style-type: disc"><p>Change all instances of <code class="literal">currentHealth</code> to <code class="literal">currentArmor</code></p></li><li style="list-style-type: disc"><p>Rename the <code class="literal">KeyCode</code> from <span class="emphasis"><em>+</em></span> to <span class="emphasis"><em>D</em></span></p></li><li style="list-style-type: disc"><p>Remove the <code class="literal">if</code> statement comparing the <code class="literal">currentHealth</code> amount</p></li><li style="list-style-type: disc"><p>Add <code class="literal">ArmorDrain</code> function after second <code class="literal">if</code> statement</p></li><li style="list-style-type: disc"><p>Wrap the <code class="literal">if</code> statements and the call of the <code class="literal">ArmorDrain</code> function in an <code class="literal">if</code> statement with the parameter of <code class="literal">armorActive</code></p></li><li style="list-style-type: disc"><p>Send current armor to the <code class="literal">armor</code> function in the <code class="literal">HealthBar</code> script, outside of the <code class="literal">armorActive</code> <code class="literal">if</code> statement</p></li><li style="list-style-type: disc"><p>Rename <code class="literal">PlayerHealth</code> to <code class="literal">PlayerArmor</code></p></li></ul></div><p><code class="literal">Update</code> function<a id="id726" class="indexterm"></a></p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Add <code class="literal">GetArmorStatus</code> function call</p></li><li style="list-style-type: disc"><p>Rename <code class="literal">PlayerHealth</code> to <code class="literal">PlayerArmor</code></p></li><li style="list-style-type: disc"><p>Add <code class="literal">ResetArmor</code> function call</p></li></ul></div><p>Return functions<a id="id727" class="indexterm"></a></p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Rename <code class="literal">ReturnCurrentHealth</code> to <code class="literal">ReturnCurrentArmor</code></p></li><li style="list-style-type: disc"><p>Rename <code class="literal">SendHealthMax</code> to <code class="literal">SendArmorMax</code></p></li><li style="list-style-type: disc"><p>Rename <code class="literal">SendHealthMin</code> to <code class="literal">SendArmorMin</code></p></li><li style="list-style-type: disc"><p>Make sure they are returning their values</p></li></ul></div><a id="id728" class="indexterm"></a><p>Finally, as there are no more variables or functions to copy, we can now add some unique properties to this script.</p><p>Create a function called <code class="literal">ArmorDrain</code>
<a id="id729" class="indexterm"></a>. This function is going to drain the player's armor upon the activation of the armor. There is an <code class="literal">if</code> statement in here comparing to see if <code class="literal">currentArmor</code> is not yet equal to the <code class="literal">armorMin</code> value. In this statement, the <code class="literal">currentArmor</code> variable<a id="id730" class="indexterm"></a> should decrement by <code class="literal">Time.deltaTime*2</code> in order to make it drain one armor per second:</p><div class="informalexample"><pre class="programlisting">function ArmorDrain(){
    if(currentArmor &gt; armorMin){ currentArmor -= Time.deltaTime*2;}
}</pre></div><p>If you want to turn this functionality off, comment out the function call in the <code class="literal">PlayerArmor</code> function<a id="id731" class="indexterm"></a>.</p><p>The next function we want to write is the reset for <code class="literal">currentArmor</code> after the armor has been depleted. Call the <code class="literal">ResetArmor</code> function<a id="id732" class="indexterm"></a>. Have an <code class="literal">if</code> statement state that if the armor is not active, it must have its <code class="literal">currentArmor</code> set to that of <code class="literal">armorMax</code> to make sure that when the activation button is next pressed, the armor is ready to go:</p><div class="informalexample"><pre class="programlisting">function ResetArmor(){
    if(!armorActive){
currentArmor = armorMax;}
}</pre></div><p>The last function to write in here is the <code class="literal">GetArmorStatus</code> function<a id="id733" class="indexterm"></a>. In here, have <code class="literal">armorActive</code> equal to <code class="literal">SendArmorStatus</code> from the <code class="literal">HealthBar</code> script:</p><div class="informalexample"><pre class="programlisting">function GetArmorStatus(){
armorActive = healthBarScr.SendArmorStatus();}</pre></div><a id="id734" class="indexterm"></a><p>A few more tweaks here and there, well, nearly everywhere, and the <code class="literal">painKiller</code> item will have the desired effect.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec58"></a>Revisiting the HealthBar script</h3></div></div></div><a id="id735" class="indexterm"></a><a id="id736" class="indexterm"></a><p>It is time to get some visual representation of the armor. Before we can really do anything, we have to create some variables. We need to create an armor variable that will hold the texture to represent it. So, just in case anyone wants to create varying degrees of armor such as the health, we will make this variable have the <code class="literal">Texture2D[]</code> type. Next, we need variables that represent <code class="literal">armorMax</code> and <code class="literal">armorMin</code> followed by one variable for <code class="literal">currentArmor</code> and the other for keeping track of its activation:</p><div class="informalexample"><pre class="programlisting">private var armorActive : boolean = false;
private var armorMax : float = 0;
private var armorMin : float = 0;
private var currentArmor : float = 0;
public var armorValue : Texture2D[];</pre></div><p>Now, we are going to move on to function tweaking. In the <code class="literal">Awake</code> function, just under <code class="literal">healthMin</code> and <code class="literal">healthMax</code>, you might want to copy those two and paste them just underneath, and change the <code class="literal">healthMin</code> to <code class="literal">armorMin</code> and likewise for <code class="literal">healthMax</code>. Change the <code class="literal">GetComponent</code> referencing from <code class="literal">"Health"</code> to <code class="literal">"Armor"</code> and change the <code class="literal">SendHealthMin</code> and <code class="literal">SendHealthMax</code> functions to <code class="literal">SendArmorMin</code> and <code class="literal">SendArmorMax</code>, respectively.</p><div class="informalexample"><pre class="programlisting">armorMin = gameManager.GetComponent("Armor").SendArmorMin();
armorMax = gameManager.GetComponent("Armor").SendArmorMax();</pre></div><p>Next, create a function called <code class="literal">Armor</code>. This function will have a parameter of a <code class="literal">float</code> and it will handle setting the rendering settings of the armor as well as turning the armor off when the armor is depleted.</p><p>Inside of the function, first is an <code class="literal">if</code> statement. This statement will check if the armor level has reached <code class="literal">0</code> and if it has, it will set the <code class="literal">armorActive</code> variable to <code class="literal">false</code> and call the <code class="literal">SendArmorStatus</code> function. After this statement, change <code class="literal">mainTexture</code> to be equal to that of the first index of the <code class="literal">armorValue</code> list array<a id="id737" class="indexterm"></a>. After that, set the color value of the emission to blue. Set the <code class="literal">currentArmor</code> variable<a id="id738" class="indexterm"></a> to the <code class="literal">armor</code> value parameter:</p><div class="informalexample"><pre class="programlisting">function Armor(armor : float){
    if(currentArmor &lt;= 0){
        armorActive = false;
        SendArmorStatus();
    }
    
    renderer.material.mainTexture = armorValue[0];
    renderer.material.SetColor("_Emission", Color.blue);
    
    currentArmor = armor;
}</pre></div><a id="id739" class="indexterm"></a><p>We now need to create the <code class="literal">ActivateArmor</code> function. The function will receive a <code class="literal">boolean</code> value as its parameter. The <code class="literal">armorActive</code> variable is set to the <code class="literal">activate</code> parameter:</p><div class="informalexample"><pre class="programlisting">function ActivateArmor(activate : boolean){
    armorActive = activate;
}</pre></div><p>Next, we need to create a return function for the <code class="literal">armorActive</code> variable. Call it <code class="literal">SendArmorStatus</code>:</p><div class="informalexample"><pre class="programlisting">function SendArmorStatus(){
    return armorActive;
}</pre></div><p>Inside of the <code class="literal">Health</code> function, we will have to put an <code class="literal">if</code> statement wrapped around everything. The parameter for the statement is to check that <code class="literal">armorActive</code> is <code class="literal">false</code>:</p><div class="informalexample"><pre class="programlisting">    if(!armorActive){
    ......Content.......    
    }</pre></div><a id="id740" class="indexterm"></a><a id="id741" class="indexterm"></a><p>There's just one more thing to do and we are done with this script. Inside the <code class="literal">HealthRiseFall</code> function, we need to wrap the health rendering in an <code class="literal">if</code> statement with the parameter of checking if <code class="literal">armorActive</code> is <code class="literal">false</code>. The second <code class="literal">if</code> statement is an <code class="literal">else</code> <code class="literal">if</code> checking if <code class="literal">armorActive</code> is <code class="literal">true</code>. Copy the rendering for health and paste it into this statement:</p><div class="informalexample"><pre class="programlisting">    if(!armorActive){
        .....Health Content.....        
    }
    else if(armorActive){
        renderer.material.SetFloat("_Cutoff", Mathf.InverseLerp(armorMax,armorMin, currentArmor));
    }</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec59"></a>Revisiting the Health script</h3></div></div></div><a id="id742" class="indexterm"></a><a id="id743" class="indexterm"></a><p>We have a single tweak to do in this script. We need to wrap the input controls of the <code class="literal">PlayerHealth</code> function inside of an <code class="literal">if</code> statement. The parameter for the statement is going to check whether the <code class="literal">SendArmorStatus</code> function of the <code class="literal">HealthBar</code> script is not activated:</p><div class="informalexample"><pre class="programlisting">if(!healthBarScr.SendArmorStatus()){
    ....Content....    
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec60"></a>Revisiting the UseItem script</h3></div></div></div><a id="id744" class="indexterm"></a><a id="id745" class="indexterm"></a><p>In order to get the armor functionality to work in the script, we need to create a <code class="literal">armorScr</code> variable that will hold reference to the <code class="literal">Armor</code> script:</p><div class="informalexample"><pre class="programlisting">private var armorScr : Armor;</pre></div><p>In the <code class="literal">Awake</code> function, have the <code class="literal">armor</code> script variable equal the <code class="literal">Armor</code> component off the <code class="literal">gameObject</code>:</p><div class="informalexample"><pre class="programlisting">armorScr = gameObject.GetComponent("Armor");</pre></div><p>Next, inside the <code class="literal">UseItem</code> function<a id="id746" class="indexterm"></a>, we need to add the <code class="literal">painKiller</code> functionality and <code class="literal">if</code> parameters. There is an <code class="literal">if</code> wrapper that will surround the content of the function except for the bottom function—<code class="literal">RemoveItemFromArray</code>. The parameter for the wrapper is checking if the <code class="literal">SendArmorStatus</code> function of the <code class="literal">HealthBar</code> script is <code class="literal">false</code>:</p><div class="informalexample"><pre class="programlisting">if(!healthBar.GetComponent("HealthBar").SendArmorStatus())
    {
        if(itemName == "painKiller" &amp;&amp; Input.GetKeyDown(KeyCode.Q) &amp;&amp; playerStatScr.ReturnPainCount() &gt; 0 )
        {
            playerStatScr.DecrementItemCount();
            return healthBar.GetComponent("HealthBar").ActivateArmor(true);
        }
}<a id="id747" class="indexterm"></a>
</pre></div></div></div>