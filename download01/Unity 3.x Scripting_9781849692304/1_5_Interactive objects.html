<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch01lvl1sec11"></a>Interactive objects</h2></div></div><hr /></div><a id="id52" class="indexterm"></a><p>So, you want to interact with objects in the environment now? Interactive objects are usually the objects, which the player has to interact with in order to continue their progression through a level and/or environment. In deciding which interactive items to include as examples, we have chosen to pick objects that show a variety of player interactions. The following is an overview of the type of interactive <a id="id53" class="indexterm"></a>objects, which will be covered in this chapter:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Buttons/plunger<a id="id54" class="indexterm"></a></p></li><li style="list-style-type: disc"><p>Explosion box<a id="id55" class="indexterm"></a></p></li><li style="list-style-type: disc"><p>Moving boxes<a id="id56" class="indexterm"></a></p></li><li style="list-style-type: disc"><p>Platform<a id="id57" class="indexterm"></a></p></li></ul></div><p>The list of interactive items can be quite extensive but luckily, once you have thought of the logic behind one, scripting another becomes easier. For a better understanding of the preceding interactive objects, we can split them into two categories—<a id="id58" class="indexterm"></a><a id="id59" class="indexterm"></a><a id="id60" class="indexterm"></a>
<span class="strong"><strong>Triggers</strong></span> and <span class="strong"><strong>Triggered</strong></span> <span class="strong"><strong>Objects</strong></span>. TNT plunger, targets, buttons, levers, and volumes fall under the <span class="strong"><strong>Triggers</strong></span> category, whereas TNT box, triggered door, item required/event door, breakable door, and raft fall under <span class="strong"><strong>Triggered</strong></span> <span class="strong"><strong>Objects</strong></span>. For more information on other interactive items such as pickups, treasure chests, and weapons, see <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Action</em></span> <span class="emphasis"><em>Game</em></span> <span class="emphasis"><em>Essentials</em></span>. All assets for this chapter can be found in the <span class="strong"><strong>History</strong></span> | <span class="strong"><strong>Resources</strong></span> | <span class="strong"><strong>Chapter</strong></span> <span class="strong"><strong>1</strong></span> folder.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec06"></a>Triggers</h3></div></div></div><a id="id61" class="indexterm"></a><a id="id62" class="indexterm"></a><p>As stated previously, these objects are used to trigger events in the environment. Through interacting with them, doors can be opened, non-interactive events can be triggered, and enemies can be spawned. These are only a couple of examples of the infinite number of tasks that can be done by interacting with a trigger. Here is a breakdown of the mentioned triggers. Due to the limited number of pages, we will dive right into the description and breakdown of code for each project.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec07"></a>Buttons</h3></div></div></div><a id="id63" class="indexterm"></a><a id="id64" class="indexterm"></a><p>In our case, a button will be described as an object, which the character directly has to interact with in order for it to be triggered. What we will write is a base script, which when used triggers an event. This script, once written, will be used to open a door and explode a box of TNT.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec02"></a>Base button script</h4></div></div></div><a id="id65" class="indexterm"></a><a id="id66" class="indexterm"></a><p>So let's script a button. Go grab the <span class="strong"><strong>Button</strong></span> prefab from the <span class="strong"><strong>Chapter</strong></span> <span class="strong"><strong>1</strong></span> <span class="strong"><strong>prefabs</strong></span> folder and drag it into the <span class="strong"><strong>Hierarchy</strong></span> view. Once that is done, there will be two game objects in the prefab asset. In <span class="strong"><strong>buttonTrigger</strong></span>, there is a default script on the asset called <span class="strong"><strong>Button</strong></span>.</p><p>In the <code class="literal">Start</code> function of this script, we want to get the initial position of the button.</p><p>Declare a variable for initial position, make its type a <code class="literal">Vector3</code> and default it to <code class="literal">Vector3.zero</code>. To get the position, have the variable equal to <code class="literal">transform.localPosition</code> in the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">var initPos : Vector3;
function Start(){
     initPos = transform.localPosition;
}</pre></div><a id="id67" class="indexterm"></a><a id="id68" class="indexterm"></a><p>After the <code class="literal">Start</code> function, we will create the <code class="literal">MoveButton</code> function.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec03"></a>Activating platform status</h4></div></div></div><a id="id69" class="indexterm"></a><a id="id70" class="indexterm"></a><p>This next function will move the button to the move position and set the activated status for the platform.</p><p>Create a <code class="literal">private</code> variable<a id="id71" class="indexterm"></a> for the button pressed, set its type as <code class="literal">Boolean</code> and default it to <code class="literal">false</code>. Inside the <code class="literal">MoveButton</code> function<a id="id72" class="indexterm"></a>, create an <code class="literal">if</code> statement. Have the <code class="literal">if</code> statement check to see if the button pressed variable is equal to <code class="literal">false</code>. Inside the <code class="literal">if</code> statement<a id="id73" class="indexterm"></a>, we want to send the activation information to triggered object.</p><p>To send the information to the appropriate platform in the level, we will have to create a new variable called <code class="literal">Platform</code>, or something along those lines, with the type of <code class="literal">gameObject</code> and defaulted to <code class="literal">null</code>. In the <code class="literal">MoveButton</code> function<a id="id74" class="indexterm"></a>, we need to call the <code class="literal">Activated</code> function in the <code class="literal">platform</code> script (this script will be created later in this chapter). The following is an example of what it could look like:</p><div class="informalexample"><pre class="programlisting">Platform.GetComponent( platform ).Activated();</pre></div><p>Now, we need to move the button to give visual indication to the player that the button has been pressed. To get the move position, create another variable for move position, set its type as a <code class="literal">float</code> and default its value to <code class="literal">0.1 </code>(this value can be adjusted later in the inspector).</p><div class="informalexample"><pre class="programlisting">var movePos : float = 0.1;</pre></div><p>To move the button from its current position to the new position, we will take the local Z position of the button, subtract the move position value and apply it to the current local position of the button (we will use the <span class="strong"><strong>Z</strong></span> axis for the example due to the world having Z as depth and the button being mounted on a wall).</p><p>The last thing to add to this <code class="literal">if</code> statement before we close it is to turn the button pressed variable <code class="literal">true</code>. That's it for this script. We just need to add the collision check function to the built-in <code class="literal">Character</code> <code class="literal">Controller</code> script and we will have functionality.</p><p>Inside of this function, we will do a name check to identify what object the character has collided with. In order to get the name information from the collided object, we have to access the name component, which is a property of <code class="literal">gameObject</code>. We will then compare this to one that we want, which in this case is <code class="literal">Button</code>:</p><div class="informalexample"><pre class="programlisting">function OnControllerColliderHit ( Hit : ControllerColliderHit){
     if ( Hit.gameObject.name == "Button" ){
     }
}</pre></div><a id="id75" class="indexterm"></a><a id="id76" class="indexterm"></a><p>If the name matches what we want, we need to access the <code class="literal">MoveButton</code> function in the <code class="literal">Button</code> script. To do this, use <code class="literal">GetComponent</code> to grab the <code class="literal">Button</code> script and access the desired function. The following statement shows roughly what it should look like:</p><div class="informalexample"><pre class="programlisting">Hit.gameObject.GetComponent("Button").MoveButton();</pre></div><p>Then in the <code class="literal">if</code> statement<a id="id77" class="indexterm"></a> for the detonator plunger, we want to access the <code class="literal">GetPressed</code> function<a id="id78" class="indexterm"></a> in the <code class="literal">Button</code> script.</p><p>You have finished writing the base <code class="literal">Button</code> script. The following is a sample of what that script could look like:</p><div class="informalexample"><pre class="programlisting">var initPos : Vector3;
var movePos : float = 0.1;
var Platform : Transform = null;
var isPressed : Boolean = false;
function Start(){
     initPos = transform.position;
}
function MoveButton(){
    if(!isPressed){
     Platform.GetComponent( platform ).Activated();
     transform.position.z = transform.position.z - movePos;
    isPressed = true;
    }
}</pre></div><p>Remember that this is a base script and much, much more functionality can be scripted into it.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec08"></a>Explosion box</h3></div></div></div><a id="id79" class="indexterm"></a><a id="id80" class="indexterm"></a><p>It's time to make things explode. Let's script a little bit of explosion box. When the player applies pressure to a detonator box, it triggers the explosion box, and the explosion box explodes! There are just six steps to achieve that, as follows:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Prepare objects.<a id="id81" class="indexterm"></a></p></li><li><p>Write <code class="literal">Update</code> function.</p></li><li><p>Write <code class="literal">BOOM</code> function.</p></li><li><p>Download and install <span class="strong"><strong>Detonator</strong></span> package.</p></li><li><p>Write functionality for button pressing.</p></li><li><p>Preparation.</p></li></ol></div><p>In this section, we will handle the entire preparation of available resources.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note03"></a>Note</h3><p>Grab the <span class="strong"><strong>Detonator_Box</strong></span> prefab out of the <code class="literal">Chapter</code> <code class="literal">1</code> <code class="literal">prefabs</code> folder and drag it into the <span class="strong"><strong>Hierarchy</strong></span> view.</p></div><p>If you open the <code class="literal">gameObject</code> of the detonator box, you will see that it is made up of two pieces—<span class="strong"><strong>Detonator_Box</strong></span><a id="id82" class="indexterm"></a> and <span class="strong"><strong>Explosion</strong></span> <span class="strong"><strong>Box</strong></span><a id="id83" class="indexterm"></a>. We want to drag the <span class="strong"><strong>Button</strong></span> script, made in the last example, to the inspector of the <span class="strong"><strong>Detonator_Plunger</strong></span> asset located underneath the <span class="strong"><strong>Detonator_Box</strong></span> group. As the plunger is essentially a button, and the base <code class="literal">Button</code> script is generic, it can be used for many purposes, such as triggering the explosion box to explode. This script will be the master control for the explosion box as well as the detonator box. It will determine the explosion created when the explosion box explodes, what object is <a id="id84" class="indexterm"></a>used as the trigger, and the object triggered. You will notice that the prefab parent of <span class="strong"><strong>Detonator_Box</strong></span> has the <span class="strong"><strong>TNT</strong></span> script in its <span class="strong"><strong>Inspector</strong></span> menu.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec04"></a>The Update function</h4></div></div></div><a id="id85" class="indexterm"></a><a id="id86" class="indexterm"></a><p>The next function that we will write is the <code class="literal">Update</code> function. In this function, we will do a check for getting the trigger object's pressed status.</p><p>First, we have to create a couple of variables—the first one for a trigger and the second one for the explosion box. We want the trigger variable to be of <code class="literal">Transform</code> type and defaulted to <code class="literal">null</code> and the <code class="literal">tnt</code> variable to be of a <code class="literal">Transform</code> type as well and defaulted to <code class="literal">null</code>. Create an <code class="literal">Update</code> function. We will have an <code class="literal">if</code> statement to make sure that the <code class="literal">tnt</code> variable has an object associated with it.</p><p>To do the trigger check, we will have to write an <code class="literal">if</code> statement that gets the <code class="literal">Button</code> script component from the trigger object. To do this, we will have to declare a new variable, make it <code class="literal">public</code> and call it something along the lines of <code class="literal">trigObj</code>. We should declare its type as <code class="literal">gameObject</code>, and default it to <code class="literal">null</code>.</p><p>The value we need for this statement is the return function located in the <code class="literal">Button</code> script. To access this, we get the script component of the trigger object using <code class="literal">GetComponent</code>. <a id="id87" class="indexterm"></a>We then declare the script by the name that we wish to access and then the name of the function which has the value to check. The following is an example.</p><div class="informalexample"><pre class="programlisting">function Update(){
if( tnt != null ){
    If(trigObj.getComponent("Button").ReturnButtonStatus()){
         BOOM();
     }
    }
}</pre></div><p>As you can see, we have added the <code class="literal">BOOM</code> function in the name of the next function, which we will be writing.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec05"></a>The BOOM function</h4></div></div></div><a id="id88" class="indexterm"></a><a id="id89" class="indexterm"></a><p>The <code class="literal">BOOM</code> function will create an explosion at the location of the explosion box and destroy the explosion box game object from the <span class="strong"><strong>Hierarchy</strong></span> view. Before we do anything, let's declare two more variables. The first variable is <code class="literal">explosion</code> and the second one is <code class="literal">collidedObj</code>. Make sure that explosion is <code class="literal">public</code>, its type declaration is <code class="literal">Transform</code>, and it is defaulted to <code class="literal">null</code>. The <code class="literal">collidedObj</code> variable<a id="id90" class="indexterm"></a><a id="id91" class="indexterm"></a> should be <code class="literal">private</code>, and the type declaration should be as a <code class="literal">Collider</code> array.</p><p>In the <code class="literal">BOOM</code> function, we want to create a collision sphere that will detect all colliders within a given area from a given point. To accomplish this, we will use the <code class="literal">Physics.OverlapSphere</code> function<a id="id92" class="indexterm"></a><a id="id93" class="indexterm"></a>. Have the <code class="literal">collidedObj</code> variable equal to the <code class="literal">Physics</code> function with the parameters of the <code class="literal">tnt</code> variables—<code class="literal">position</code> for position and the size of the collision sphere set to <code class="literal">1</code>. The following is an example of how it should look:</p><div class="informalexample"><pre class="programlisting">collidedObj = Physics.OverlapSphere(tnt.transform.position, 1);</pre></div><p>After this, we need to go through the <code class="literal">collidedObj</code> array and for each object in that array, create an explosion at its position and then destroy the object. To do this use a <code class="literal">for</code> loop to loop through the array. Call Unity's built-in creation function—<code class="literal">Instantiate</code> inside of the loop.</p><p>The <code class="literal">Instantiate</code> parameters are the explosion variables, <code class="literal">Obj</code> in the <code class="literal">collidedObj</code> array position and then a rotation. The rotation of the current <code class="literal">gameObject</code> will perform <code class="literal">transform.rotation</code>. The following is a sample:</p><div class="informalexample"><pre class="programlisting">for (var obj in collidedObj)    {
    Instantiate(explosion, obj.transform.position, transform.rotation);
}</pre></div><a id="id94" class="indexterm"></a><p>Lastly, we will destroy the <code class="literal">gameObject</code> in the array. To do that, after the instantiation code, type the following line:</p><div class="informalexample"><pre class="programlisting">destroy(obj.gameObject);</pre></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch01lvl2sec09"></a>Downloading the Detonator package</h3></div></div></div><a id="id95" class="indexterm"></a><p>Now, return to the <span class="strong"><strong>Inspector</strong></span> of <span class="strong"><strong>Detonator_Box</strong></span>. Under the <span class="strong"><strong>TNT</strong></span> sc<a id="id96" class="indexterm"></a>ript, you will see the variables that were <code class="literal">public</code>. These variables are, for example, trigger, explosion, and TNT.</p><p>In the trigger variable, drag your detonator trigger into it. For the explosion variable, we are going to do something different. For the explosion, we will utilize the <span class="strong"><strong>Detonator</strong></span> package that can be downloaded off of Unity's website. You can find it in the <span class="strong"><strong>Support</strong></span> | <span class="strong"><strong>Resources</strong></span> section at <a class="ulink" href="http://unity3d.com/support/resources/" target="_blank">http://unity3d.com/support/resources/</a>.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_01_09.jpg" /></div><p>You will find it in the <span class="strong"><strong>Resources</strong></span> section<a id="id97" class="indexterm"></a>, at the very bottom on <a id="id98" class="indexterm"></a>
<a class="ulink" href="http://unity3d.com/support/resources/" target="_blank">http://unity3d.com/support/resources/</a>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_01_10.jpg" /></div><p>This package is downloaded and imported into Unity the same way as the assets for the <a id="id99" class="indexterm"></a>book. It will also appear in the <code class="literal">Resources</code> folder. Below it, you will see <span class="strong"><strong>Prefab</strong></span> <span class="strong"><strong>Examples</strong></span>. In here, you will find a variety of pre-made explosion prefabs. For our purposes, just go ahead and drag the <span class="strong"><strong>Detonator-Tiny</strong></span> into your explosion variable, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_01_11.jpg" /></div><p>The TNT variable<a id="id100" class="indexterm"></a><a id="id101" class="indexterm"></a>—<code class="literal">obj</code> is the Explosion_Box object in the Detonator_Box prefab in the Hierarchy.</p><p>Remember, you can move the detonator box and the Explosion_Box box anywhere you want. Just make sure that they stay within the parental hierarchy in the <span class="strong"><strong>Hierarchy</strong></span> view<a id="id102" class="indexterm"></a>.</p><p>The following is an example of a complete <code class="literal">TNT</code> script:</p><div class="informalexample"><pre class="programlisting">var trigObj: Transform = null;
var explosion : Transform = null;
var tnt : Transform = null;
private var collidedObj : Collider[];
function Boom(){
    collidedObj = Physics.OverlapSphere(tnt.transform.position, 1);
 for (var obj in collidedObj){
        Instantiate(explosion, obj.transform.position,   
         transform.rotation );
Destroy(obj.gameObject);
}
}
function Update(){
    if( tnt != null ){
    if(trigObj.getComponent(Button).ReturnButtonStatus();){
            Boom();
    }
    }
}<a id="id103" class="indexterm"></a>
</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch01lvl3sec06"></a>Pressing the button</h4></div></div></div><p>Now we need to add an <code class="literal">if</code> statement to the<span class="strong"><strong> ThirdPersonController</strong></span> script inside of the <code class="literal">OnControllerColliderHit</code> function.<a id="id104" class="indexterm"></a></p><a id="id105" class="indexterm"></a><p>We need to check if the character is interacting with a detonator plunger. Duplicate the <span class="strong"><strong>Button</strong></span>, check the <code class="literal">if</code> statement, and paste it below that <code class="literal">if</code> statement<a id="id106" class="indexterm"></a>. This time, in place of the name <code class="literal">Button</code>, put <code class="literal">Detonator_Plunger</code> instead. The following statement shows an example of what it should look like:</p><div class="informalexample"><pre class="programlisting">if(objCollided.gameObject.name == "Detonator_Plunger"){
     }</pre></div><p>Inside this <code class="literal">if</code> statement, access the <code class="literal">GetPressed</code> function<a id="id107" class="indexterm"></a> inside of the <span class="strong"><strong>Button</strong></span> script. Again, copy the <code class="literal">GetComponent</code> statement in the preceding <code class="literal">if</code> statement. Change the <code class="literal">MoveButton</code> function<a id="id108" class="indexterm"></a> to <code class="literal">GetPressed</code>.</p><p>Now, we must get back to the <span class="strong"><strong>Button</strong></span> script. We need to write the <code class="literal">GetPressed</code> function at the end of this script. In this function, check if the button/plunger has been pressed. If not, move the button. Move the button down so that it is on the <span class="strong"><strong>Y</strong></span> axis, and by the <code class="literal">movePos</code> value multiplied by the time variable—<code class="literal">Time.deltaTime</code>:</p><div class="informalexample"><pre class="programlisting">transform.localPosition.y -=  movePos * Time.deltaTime;</pre></div><p>Next, add another <code class="literal">if</code> statement inside of the previous one. This <code class="literal">if</code> statement is going to check if the current position is greater than the initial position subtracted by the <code class="literal">movePos</code> variable's value. Inside this <code class="literal">if</code>, we can have <code class="literal">isPressed</code> equal to <code class="literal">true</code>.</p><p>Lastly for this script, we will create a simple return function. This return function—<code class="literal">ReturnButtonStatus</code>
<a id="id109" class="indexterm"></a>—is going to return the <code class="literal">isPressed</code> variable's value:</p><div class="informalexample"><pre class="programlisting">function ReturnButtonStatus(): boolean{
    return isPressed;
}</pre></div><p>Congratulations, you can now have fun blowing stuff up. Remember that these are very basic scripts and much more functionality can be added to them to make them a much <a id="id110" class="indexterm"></a>more complex mechanism. Add the following code snippet at the end of the <code class="literal">Button</code> script:</p><div class="informalexample"><pre class="programlisting">function GetPressed(){
    if( !isPressed ){    
        transform.localPosition.y -=  movePos * Time.deltaTime;
        if(transform.localPosition.y &gt; (initPos.y - movePos)){
            isPressed = true;
        }
    }
}
function ReturnButtonStatus(): boolean{
    return isPressed;
}</pre></div></div></div></div>