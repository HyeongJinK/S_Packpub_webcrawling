<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec22"></a>Adding ammo and health pickups</h2></div></div><hr /></div><a id="id386" class="indexterm"></a><p>Apart from actual weapon pickup, we need to add ammo and health pickup for our character to replenish them. We don't want to create separate code for each type of pickup. That technically takes more copy-pasting skills than scripting, so we decided to show how to create a universal script to handle any type of pickups based on the string type specified for each individual instance. Go to the <span class="strong"><strong>custom</strong></span> <span class="strong"><strong>meshes</strong></span> folder and drag <span class="strong"><strong>Random_Pickup</strong></span> prefab to the scene. Perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a script called <code class="literal">PickUps</code> and attach it to the prefab.</p></li><li><p>First, we need to specify which type of pickup this specific instance will represent; this will be done in the <code class="literal">Awake</code> function<a id="id387" class="indexterm"></a> by checking the <code class="literal">Type</code> variable of a <code class="literal">MeshType</code> type. <code class="literal">MeshType</code> is enumeration; we will use it to switch pickup type in editor.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_03_09.jpg" /></div></li><li><p>Next, we will detect if an object is colliding with a player or not, with the <code class="literal">OnTriggerEnter</code> function<a id="id388" class="indexterm"></a>.</p></li><li><p>We need to make sure that the player will collide with pickup only once. Declare a new variableâ€”<code class="literal">bCanCollide</code> of a <code class="literal">boolean</code> type.</p></li><li><p>If the collided object has the <code class="literal">Player</code> tag, then it must have a <code class="literal">CH_PlayerStats</code> script attached to it, which we will be referencing. Disable colliding with this object by setting <code class="literal">bCanCollide</code> to <code class="literal">false</code>.</p></li><li><p>Declare the <code class="literal">Speed</code> variable of <code class="literal">float</code> type that will be used to rotate pickup.</p></li><li><p>Now, based on the type of pickup, we want to do different things. If our pickup is <code class="literal">Type.health</code>, we will increase our character's health by 20 and increase rotating speed by 200 to make it spin very fast showing that this object had been picked up. On the other hand, if we have <code class="literal">Type.ammo</code>, we will add 10 ammo to our character and destroy pickup instantly.</p></li><li><p>We don't want our pickup to be there forever. Once it's picked up, it must disappear. Declare the <code class="literal">destroyTime</code> variable<a id="id389" class="indexterm"></a> that will take countdown before destroying the object.</p></li><li><p>In the end, we will add another visual feature, which will make our pickup rotate and fly up when it's picked up.</p></li></ol></div><p>The completed <code class="literal">PickUps</code> script should be as follows:</p><div class="informalexample"><pre class="programlisting">public var Speed : float = 20.0;
public var destroyTime : float = 2.0;
private var Stats : CH_PlayerStats;
private var bCanCollide : boolean = true;
public var myMesh1 : Mesh;
public var myMesh2 : Mesh;
public enum MeshType{
    health,
    ammo
};
public var Type : MeshType;
function Awake(){
    if (Type == Type.health)
    this.gameObject.GetComponent(MeshFilter).mesh = myMesh1;
    if(Type == Type.ammo)
    this.gameObject.GetComponent(MeshFilter).mesh = myMesh2;
}
function OnTriggerEnter(other:Collider){
if (other.gameObject.tag !="Player" || bCanCollide != true)
return;
bCanCollide = false;
Stats = other.gameObject.GetComponent(CH_PlayerStats);
switch (Type){
    case Type.health:
        Stats.AddHealth(20,1);
        Speed += 200;
        break;
    case Type.ammo:
        destroyTime = 0.0;
        Stats.AddAmmo(1,10,1);
    }
Destroy(this.gameObject, destroyTime);
}
function Update(){
    transform.Rotate(Vector3.up * Time.deltaTime * Speed);
    if(!bCanCollide)
    transform.Translate(Vector3.up * Time.deltaTime * Speed/100);
}</pre></div><p><code class="literal">Speed</code>
<a id="id390" class="indexterm"></a> and <code class="literal">destroyTime</code>
<a id="id391" class="indexterm"></a> are controlling rotation speed and the time it will take to destroy the object after it has been picked up. <code class="literal">Stats</code> is a reference to the character's <code class="literal">CH_PlayerStats</code> script. <code class="literal">bCanCollide</code> will control if we can or cannot collide with the pickup. <code class="literal">myMesh1</code> and <code class="literal">myMesh2</code> are mesh references to different mesh types that will be used to represent this pickup.</p><p>Our pickups are ready, and our character is happy! The following screenshot shows the ammo and health packages:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_03_10.jpg" /></div></div>