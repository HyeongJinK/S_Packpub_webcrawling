<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec48"></a>Returning to the aiSimplePath script</h2></div></div><hr /></div><a id="id1142" class="indexterm"></a><p>Now that we have our behavior script, we can add the additional functionality to the <code class="literal">aiSimplePath</code> script.</p><p>The additional functionality is a couple of functions that will deal with receiving path information and additional functionality for the enemy path script so as to find which bot is injured and needs to be healed, to locate the ammo, and to pursue the player.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec93"></a>Pursue functionality</h3></div></div></div><p>We will have to add some variables before we add in the new functions and code. The variables that we will have to add are the pursue variables. These variables are used to make the enemy pursue different objectives.</p><p>Those variables are <code class="literal">pursuePlayer</code> (it is of the <code class="literal">boolean</code> type<a id="id1143" class="indexterm"></a> and used to determine if the enemy should pursue the player), <code class="literal">healBotLoc</code> (it is of the <code class="literal">GameObject</code> type and is used to locate the injured bot that needs to be healed by the passive bot), <code class="literal">healBot</code> (it is of the <code class="literal">boolean</code> type and used to determine whether the bot to be healed should be healed), <code class="literal">locateAmmo</code> (it is of the <code class="literal">boolean</code> type and used to determine whether the enemy should grab the ammo), and lastly, <code class="literal">ammoToFind</code> (it is of the <code class="literal">GameObject</code> type and used to determine the location of the ammo). The last variable to define is the script reference variableâ€”<code class="literal">enemyStatScr</code>. It can be <code class="literal">private</code> and make sure that its type is <code class="literal">enemyStats</code>.</p><div class="informalexample"><pre class="programlisting">public var player : GameObject;
private var pursuePlayer : boolean;
private var healBotLoc : GameObject;
private var healBot : boolean;
private var locateAmmo : boolean;
private var ammoToFind : GameObject;
private var enemyStatScr : enemyStats;</pre></div><p>The <code class="literal">GetBehaviourInfo</code> function<a id="id1144" class="indexterm"></a> will get the behavior information from the <code class="literal">aiSimpleBehaviour</code> script and set the <code class="literal">pursuePlayer</code> variable to the <code class="literal">engagePlayer</code> variable<a id="id1145" class="indexterm"></a>'s value.</p><p>The <code class="literal">SetEnemyType</code> function<a id="id1146" class="indexterm"></a> will get the enemy's <code class="literal">type</code> as <code class="literal">string</code> and set the <code class="literal">enemyType</code> variable<a id="id1147" class="indexterm"></a> to the <code class="literal">String</code> value.</p><p>The <code class="literal">BotToHeal</code> function<a id="id1148" class="indexterm"></a> will grab the bot that the medic (passive bot) needs to heal, and it will also set the <code class="literal">healBot</code> variable<a id="id1149" class="indexterm"></a>.</p><p>The <code class="literal">AmmoToLocate</code> function<a id="id1150" class="indexterm"></a> will grab the ammo that the enemy should pursue and set the <code class="literal">locateAmmo</code> variable<a id="id1151" class="indexterm"></a>.</p><div class="informalexample"><pre class="programlisting">function GetBehaviourInfo(engagePlayer: boolean){pursuePlayer = engagePlayer;}
function SetEnemyType(type: String){enemyType = type;}
function BotToHeal(Bot : GameObject, heal : boolean){healBotLoc = Bot; healBot = heal;}
function AmmoToLocate(Ammo : GameObject, find : boolean){ammoToFind = Ammo; locateAmmo = find;}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec94"></a>Revisiting the EnemyPath function</h3></div></div></div><a id="id1152" class="indexterm"></a><p>The functionality that is being added to this function is the functionality of the enemy to pursue and repair a damaged bot, the ability to locate and pursue ammo, and the ability to locate and pursue an enemy. Right after the declarations of the three <code class="literal">Vector3</code> variables, we want to add in an <code class="literal">if</code> statement that will hold the <code class="literal">if</code> statements for pursuing the player, pursuing the ammo, and locating the injured bots. We need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>If we are pursuing the player, we will set <code class="literal">Target</code> to the player's position, <code class="literal">moveDirection</code> will become the facing angle of the player, and we will make <code class="literal">velocity</code> equal to <code class="literal">rigidbody.velocity</code>. We will check the magnitude of <code class="literal">moveDirection</code> to see how close we are to our target, and if we are within our specified range, we will set <code class="literal">velocity</code> to <code class="literal">Vector3 zero</code>. If we are not within the specified range, we will normalize our direction, multiply it by our <code class="literal">speed</code> variable, and assign that to our <code class="literal">velocity</code> variable.</p></li><li><p>If we are a passive bot and if we are looking to heal a bot, we will continue pursuing the player till the <code class="literal">Target</code> variable becomes equal to the location of the bot to be healed and the range becomes less. If our target is within the range, we will call the <code class="literal">RepairBot</code> function from the <code class="literal">enemyStats</code> script.</p></li><li><p>If we are pursuing ammo, we will again follow the same procedure, except that the <code class="literal">Target</code> variable becomes equal to the location of the ammo to find and the range becomes less. We won't call any functions if within the range. We will just set <code class="literal">velocity</code> to <code class="literal">Vector3 zero</code>.</p></li></ol></div><a id="id1153" class="indexterm"></a><p>The code should look like the following code snippet:</p><div class="informalexample"><pre class="programlisting">if(pursuePlayer){
    Target = player.transform.position;
    moveDirection = Target - transform.position;
    if(moveDirection.magnitude &lt; 3){
        velocity = Vector3.zero;
    }
    else{
        velocity = moveDirection.normalized * speed;
    }
}
        if(enemyType == "Passive" &amp;&amp; healBot)    {
            Target = healBotLoc.transform.position;
            moveDirection = Target - transform.position;
            if(moveDirection.magnitude &lt; 2) {
                velocity = Vector3.zero;
    healBotLoc.GetComponent("enemyStats").RepairBot();
            }
            else{
                velocity = moveDirection.normalized * speed;
            }
        }
        else if(locateAmmo)    {
            Target = ammoToFind.transform.position;
            moveDirection = Target - transform.position;
            if(moveDirection.magnitude &lt; 0.5)    {
                velocity = Vector3.zero;
            }
            else{
                velocity = moveDirection.normalized * speed;
            }
        }</pre></div><p>After placing those three statements in the function, we need to add an <code class="literal">else</code> <code class="literal">if</code> statement around the original waypoint path navigation. That <code class="literal">else</code> <code class="literal">if</code> statement is to check if the enemy is indeed pursuing the player.</p><p>With that done, the <code class="literal">aiSimplePath</code> script<a id="id1154" class="indexterm"></a> is completed. We have added the full functionality to it. Now all that is left is to press <span class="strong"><strong>Play</strong></span>, and the behavior that has been <a id="id1155" class="indexterm"></a>applied and the path attributes should take effect.</p></div></div>