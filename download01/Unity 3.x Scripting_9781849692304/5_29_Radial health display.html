<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec31"></a>Radial health display</h2></div></div><hr /></div><a id="id595" class="indexterm"></a><p>To make the creation of the health interesting and hopefully show a great way to display the health, we are going to create a radial bar. A brief description of this is that the player's health will start at 100, or max, and as it drops, it will move around in a circle appearing to be draining, as shown in the following diagram. We first stumbled across this in a Unity forum and have found it very useful for various situations, one of which has been the display of health.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_01.jpg" /></div><p>Alright, let's take a look at what we are going to need to get this to work the way we want it to. We need the following for that:</p><p><span class="strong"><strong>Alpha</strong></span> <span class="strong"><strong>gradient</strong></span><a id="id596" class="indexterm"></a><a id="id597" class="indexterm"></a>: This is a texture that has an alpha radial gradient transparency with a color layer. Luckily, this is already created for you, as it is the Unity material as well. It is found in the <code class="literal">materials</code> folder for this chapter.</p><p><span class="strong"><strong>Game</strong></span> <span class="strong"><strong>manager</strong></span>: <a id="id598" class="indexterm"></a><a id="id599" class="indexterm"></a>This is a manager game object that can hold our scripts. If you already have a manager set up, create the <code class="literal">Health</code> script.</p><p><span class="strong"><strong>Health</strong></span> <span class="strong"><strong>script</strong></span>: <a id="id600" class="indexterm"></a><a id="id601" class="indexterm"></a>This is a script to handle the health separate from the display of health. We will write this script in the next section.</p><p><span class="strong"><strong>Health</strong></span> <span class="strong"><strong>display</strong></span> <span class="strong"><strong>script</strong></span>: <a id="id602" class="indexterm"></a><a id="id603" class="indexterm"></a>This is a script to handle the display of health.</p><p>Once these scripts are written, we will revisit the <code class="literal">Health</code> script to add some functions.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec45"></a>The Health script</h3></div></div></div><a id="id604" class="indexterm"></a><p>Before we go ahead and begin displaying the health, we must first get the health working. This script will cover setting up the minimum health, maximum health, increase and decrease of health. To begin, let's start with initializing some variables.</p><p>We will need a variable for <code class="literal">currentHealth</code>; this can be <code class="literal">private</code>. We will also need two additional variables, <code class="literal">healthMax</code> and another for <code class="literal">healthMin</code>. These two can be <code class="literal">public</code> so that they can be modified in <span class="strong"><strong>Inspector</strong></span>:</p><div class="informalexample"><pre class="programlisting">public var healthMax : float = 100;
public var healthMin : float = 0;
private var currentHealth : float = 0;</pre></div><p>Next, we will want to establish a function to handle the rise and fall of our player's health. Create a function and call it <code class="literal">PlayerHealth</code>. Inside <code class="literal">PlayerHealth</code>
<a id="id605" class="indexterm"></a>, we want to get the influence on our <code class="literal">currentHealth</code> variable<a id="id606" class="indexterm"></a>. In this case, we are using the – button to lower health and the <span class="emphasis"><em>+</em></span> button to increase it. There will be two <code class="literal">if</code> statements in the function. One <code class="literal">if</code> statement will be for the increase in health and another for the decrease.</p><p>The first step is getting the pressing and holding input from the <span class="emphasis"><em>-</em></span> button with the <code class="literal">GetKey</code> and <code class="literal">KeyCode</code> function<a id="id607" class="indexterm"></a>s. We also need to make sure to check here that <code class="literal">currentHealth</code> is greater than the <code class="literal">healthMin</code> value.</p><a id="id608" class="indexterm"></a><p>The second step is getting the pressing and holding input from the <span class="emphasis"><em>+</em></span> button with the <code class="literal">GetKey</code>
<a id="id609" class="indexterm"></a> and <code class="literal">KeyCode</code> function<a id="id610" class="indexterm"></a>s. We also need to make sure to check here that <code class="literal">currentHealth</code> is less than <code class="literal">healthMax</code>:</p><div class="informalexample"><pre class="programlisting">if(Input.GetKey(KeyCode.KeypadMinus) &amp;&amp; currentHealth &gt; healthMin){currentHealth -= 0.5;}
if(Input.GetKey(KeyCode.KeypadPlus) &amp;&amp; currentHealth &lt; healthMax){currentHealth += 0.5;}</pre></div><p>Lastly, we need to constantly check for the input coming from the player. We therefore call the <code class="literal">PlayerHealth</code> function<a id="id611" class="indexterm"></a> inside of the <code class="literal">Update</code> function:</p><div class="informalexample"><pre class="programlisting">function Update(){PlayerHealth();}</pre></div><p>We are done, at least with the <code class="literal">Health</code> script for the time being. We will have to revisit it soon.</p><div class="informalexample"><pre class="programlisting">public var healthMax : float = 100;
public var healthMin : float = 0;
private var currentHealth : float = 0;
PlayerHealth(){
if(Input.GetKey(KeyCode.KeypadMinus) &amp;&amp; currentHealth &gt; healthMin){currentHealth -= 0.5;}
if(Input.GetKey(KeyCode.KeypadPlus) &amp;&amp; currentHealth &lt; healthMax){currentHealth += 0.5;}
}
function Update(){PlayerHealth();}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec46"></a>Health display script</h3></div></div></div><a id="id612" class="indexterm"></a><p>Next up, we create a script, which will display a visual indicator of our character's (or bot's) health. This script will be called <code class="literal">HealthBar</code>. Let's begin creating the variables that will help us display the health bar.</p><p>The first one which we need to create will be to hold our radial health textures to be displayed. This variable should be a <code class="literal">Texture2D</code> list and should be <code class="literal">public</code>.</p><p>We will also need a variable to hold reference to the game manager, as our <code class="literal">HealthBar</code> script will not be on the <code class="literal">gameManager</code> object. The variable will be of <code class="literal">GameObject</code> type and should be <code class="literal">public</code>.</p><p>Next, we need to set up some more reference variables for our health values. These variables are <code class="literal">currentHealth</code>
<a id="id613" class="indexterm"></a>, <code class="literal">healthMax</code>
<a id="id614" class="indexterm"></a>, and <code class="literal">healthMin</code>
<a id="id615" class="indexterm"></a> and can be copied from the <code class="literal">Health</code> script. They can also be changed to <code class="literal">private</code> for this script:</p><div class="informalexample"><pre class="programlisting">public var healthValue : Texture2D[];
public var gameManager : GameObject;
private var healthMax : float = 0;
private var healthMin : float = 0;
private var currentHealth : float = 0;</pre></div><p>Now that we have our variables set up, we can set their references in the <code class="literal">Awake</code> function. Starting with our 2D texture list, we will want to set the default texture to be displayed. To do this, we need to access the renderer of <code class="literal">gameObject</code> and change its <code class="literal">mainTexture</code> material to the one in slot <code class="literal">0</code> that we have specified in our texture list:</p><div class="informalexample"><pre class="programlisting">renderer.material.mainTexture = healthValue[0];</pre></div><p>Next, we need to set the <code class="literal">healthMax</code> and <code class="literal">healthMin</code> variable<a id="id616" class="indexterm"></a>s. These are from the <code class="literal">Health</code> script in the game manager so we need to access that component and read them from the return functions in the <code class="literal">Health</code> script. To do that, we use our <code class="literal">gameManager</code> variable that is referencing the game manager and the <code class="literal">GetComponent</code> function to specify which script we want access to. Then we need to call the returned functions for the specified variables as follows:</p><div class="informalexample"><pre class="programlisting">healthMin = gameManager.GetComponent("Health").SendHealthMin();
healthMax = gameManager.GetComponent("Health").SendHealthMax();</pre></div><a id="id617" class="indexterm"></a><p>After that is set up, we want to create a function that will change the texture color based upon the health value. Call the <code class="literal">Health(health</code> <code class="literal">:</code> <code class="literal">float)</code> function. This function will have to receive information, so make sure that it has a <code class="literal">float</code> parameter.</p><p>In the <code class="literal">Health(health</code> <code class="literal">:</code> <code class="literal">float)</code> function<a id="id618" class="indexterm"></a>, there will be an <code class="literal">if</code> statement and two <code class="literal">else</code> <code class="literal">if</code> statements. All are based upon the health value that is coming into the function. The first statement is to check if health is greater than or equal to <code class="literal">healthMax/3</code>. If it is, have <code class="literal">mainTexture</code> equal to that of our default texture—<code class="literal">healthValue[0]</code>. And in addition, we will set the emissive property of the Shader:</p><div class="informalexample"><pre class="programlisting">if (health &gt;= healthMax/3 ){
    renderer.material.mainTexture = healthValue[0];
    renderer.material.SetColor("_Emission", Color.green);
    }
else if (health &lt; healthMax/3 &amp;&amp; health &gt;= healthMax/1.5){
        renderer.material.mainTexture = healthValue[1];
        renderer.material.SetColor("_Emission", Color.yellow);
    }
else if (health &lt; healthMax/1.5){
        renderer.material.mainTexture = healthValue[2];
        renderer.material.SetColor("_Emission", Color.red);
    }</pre></div><p>This property allows the texture to emit the color specified, hence the reason it is being used here. Setting the color of the property is very similar to setting the texture. Instead of <code class="literal">mainTexture</code>, we use <code class="literal">SetColor</code>. <code class="literal">SetColor</code>
<a id="id619" class="indexterm"></a> is a built-in function with parameters. Those parameters for the color are the properties of the Shader to be affected—<code class="literal">_Emission</code>—followed by the color to be used. In this case, we will set the color to green to coincide with the texture that we are using. This process is repeated for the two <code class="literal">else</code> <code class="literal">if</code> statements.</p><p>For the first <code class="literal">else</code> <code class="literal">if</code> statement<a id="id620" class="indexterm"></a>, the <code class="literal">if</code> parameter will compare whether health is less than <code class="literal">healthMax/3</code>. It will also compare whether health is greater than or equal to <code class="literal">healthMax/1.5</code>. The texture should change to the second slot and the color of <code class="literal">SetColor</code> should be changed to yellow.</p><p>The next <code class="literal">else</code> <code class="literal">if</code> statement will have the <code class="literal">if</code> parameter to compare whether health is less than <code class="literal">healthMax/1.5</code>. The texture again shall change, this time to the third slot and the color property will become red.</p><p>The last line that we need to write for this function is to make the <code class="literal">currentHealth</code> variable equal to the health parameter of the function:</p><div class="informalexample"><pre class="programlisting">currentHealth = health;</pre></div><a id="id621" class="indexterm"></a><p>There are two small functions left to write and then back to the <code class="literal">Health</code> script. The next function will handle the visual increase and decrease in health. The function is called <code class="literal">HealthRiseFall</code>
<a id="id622" class="indexterm"></a>.</p><p>There is one line in here and it again plays with Shader attributes. This one in particular will be playing with the transparent cutoff Shader. This Shader allows one to create an alpha gradient that will dictate how the Shader handles transparency. Then, one can go in and manipulate the cutoff control to have parts of the texture appear or disappear. The Shader takes the values put in and puts minimum and maximum transparency to that. It then uses the parameter to set its transparency to slide between those two values. This is why we will be able to use it for a radial health bar. We will set its maximum transparency to <code class="literal">healthMax</code> and minimum transparency to <code class="literal">healthMin</code>. We then take the current health variable and slide the cutoff between these two values.</p><p>For our purposes, we want to use the <code class="literal">SetFloat</code> function<a id="id623" class="indexterm"></a>. The parameters for this function are the Shader attribute to be affected—<code class="literal">_Cutoff</code>—and the value that it should be set at. For the value, we use another Unity built-in function called <code class="literal">Mathf.InverseLerp</code>
<a id="id624" class="indexterm"></a>.</p><p>This function allows us to specify the values we want to transition between and the value to transition between them. Inside this function, then, is where we have our <code class="literal">healthMax</code> as our start and <code class="literal">healthMin</code> as our end with the value determining the transition being current health:</p><div class="informalexample"><pre class="programlisting">renderer.material.SetFloat("_Cutoff", Mathf.InverseLerp(healthMax,healthMin, currentHealth));</pre></div><p>The last part of this script is to create the <code class="literal">Update</code> function. In here, all we need to do is call the <code class="literal">HealthRiseFall</code> function<a id="id625" class="indexterm"></a>:</p><div class="informalexample"><pre class="programlisting">public var healthValue : Texture2D[];
public var gameManager : GameObject;
private var healthMax : float = 0;
private var healthMin : float = 0;
private var currentHealth : float = 0;
function Awake(){
    renderer.material.mainTexture = healthValue[0];
    healthMin = gameManager.GetComponent("Health").SendHealthMin();
    healthMax = gameManager.GetComponent("Health").SendHealthMax();
}
function Health(health : float){
    if (health &gt;= healthMax/3 ){
        renderer.material.mainTexture = healthValue[0];
        renderer.material.SetColor("_Emission", Color.green);
    }
    else if (health &lt; healthMax/3 &amp;&amp; health &gt;= healthMax/1.5){
        renderer.material.mainTexture = healthValue[1];
        renderer.material.SetColor("_Emission", Color.yellow);
    }
    else if (health &lt; healthMax/1.5 ){
        renderer.material.mainTexture = healthValue[2];
        renderer.material.SetColor("_Emission", Color.red);
    }
    currentHealth = health;
}
function HealthRiseFall(){    
    renderer.material.SetFloat("_Cutoff", Mathf.InverseLerp(healthMax,healthMin, currentHealth));
}
function Update () {
    HealthRiseFall();
}</pre></div><a id="id626" class="indexterm"></a><p>Well, that is it for the <code class="literal">HealthBar</code> script for now. However, we need to revisit the <code class="literal">Health</code> script and add some functions and variables.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec47"></a>Revisiting the Health script</h3></div></div></div><a id="id627" class="indexterm"></a><p>As we now have values from the <code class="literal">Health</code> script that the <code class="literal">HealthBar</code> script is trying to access, we need to create two variables and two functions. Those variables will be for the health bar and the accessing of the <code class="literal">HealthBar</code> script on the health bar. The health bar variable should be <code class="literal">GameObject</code> and <code class="literal">public</code>, and the <code class="literal">HealthBar</code> script variable should be of the <code class="literal">HealthBar</code> type (the name of the script to be accessed) and <code class="literal">private</code>:</p><div class="informalexample"><pre class="programlisting">public var healthBar : GameObject;
private var healthBarScr : HealthBar;</pre></div><p>Added to the <code class="literal">Awake</code> function is the referencing of the <code class="literal">HealthBar</code> script from the health bar <code class="literal">GameObject</code> variable:</p><div class="informalexample"><pre class="programlisting">healthBarScr = healthBar.GetComponent(HealthBar);</pre></div><p>Now that the variables are taken care of, we can write the remaining functions. These <a id="id628" class="indexterm"></a>functions will return our <code class="literal">healthMin</code> and <code class="literal">healthMax</code> variables. The <code class="literal">HealthBar</code> script is referencing certain names of functions so let's go ahead and name them the same:</p><div class="informalexample"><pre class="programlisting">function SendHealthMax(){return healthMax;}
function SendHealthMin(){return healthMin;}</pre></div><p>Lastly, in the <code class="literal">PlayerHealth</code> function<a id="id629" class="indexterm"></a>, after all the <code class="literal">if</code> statements, we need to send the current health to the <code class="literal">Health</code> function of the <code class="literal">HealthBar</code> script:</p><div class="informalexample"><pre class="programlisting">healthBarScr.Health(currentHealth);</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec48"></a>Hooking up objects to Inspector</h3></div></div></div><a id="id630" class="indexterm"></a><a id="id631" class="indexterm"></a><p>One more step to go and you will soon see a radial health bar go up and down on your command.</p><p>In the <span class="strong"><strong>Project</strong></span> menu, go to the <span class="strong"><strong>Assets</strong></span> folder for this chapter. Under <span class="strong"><strong>Prefabs</strong></span>, you will see a prefab called <span class="strong"><strong>Health_Bar</strong></span>. Drag this to your <span class="strong"><strong>Hierarchy</strong></span>. Inside of the prefab, you will see that there is a <span class="strong"><strong>gameObject</strong></span> for the background called <span class="strong"><strong>Health_BG</strong></span> and another called <span class="strong"><strong>Health</strong></span>. Apply red background ring material to <span class="strong"><strong>Health_BG</strong></span>, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_02.jpg" /></div><a id="id632" class="indexterm"></a><a id="id633" class="indexterm"></a><p>Drag the <span class="strong"><strong>HealthBar</strong></span> script onto the <span class="strong"><strong>Health</strong></span> <code class="literal">gameObject</code>. You should see your 2D texture list and its value set to <span class="strong"><strong>0</strong></span>; change this to <span class="strong"><strong>3</strong></span>. Assign <span class="strong"><strong>greenHealth</strong></span> to the first slot, <span class="strong"><strong>yellowHealth</strong></span> to the second, and <span class="strong"><strong>redHealth</strong></span> to the third. Next, grab your <span class="strong"><strong>GameManager</strong></span> and drag it into the <span class="strong"><strong>Game</strong></span> <span class="strong"><strong>Manager</strong></span> slot in the <span class="strong"><strong>HealthBar</strong></span> script, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_03.jpg" /></div><p>Go to your game manager and drag the <span class="strong"><strong>Health</strong></span> script onto it. If not already done, set <span class="strong"><strong>Health</strong></span> <span class="strong"><strong>Max</strong></span> to <span class="strong"><strong>100</strong></span> and <span class="strong"><strong>Health</strong></span> <span class="strong"><strong>Min</strong></span> to <span class="strong"><strong>0</strong></span>. Drag the <span class="strong"><strong>Health</strong></span> <code class="literal">gameObject</code> into the <span class="strong"><strong>Health</strong></span> <a id="id634" class="indexterm"></a><a id="id635" class="indexterm"></a>
<span class="strong"><strong>Bar</strong></span> variable, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_04.jpg" /></div><p>Congrats! You should have noticed by now that there is a green ring in your preview window. Upon pressing <span class="strong"><strong>Play</strong></span>, and holding down the <span class="emphasis"><em>+</em></span> or <span class="emphasis"><em>- </em></span>key, you should see the green ring move around the circle. Based on amount of health, its color will change to yellow if two-third of health is left or to red if one-third is left:</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_05.jpg" /></div></div></div>