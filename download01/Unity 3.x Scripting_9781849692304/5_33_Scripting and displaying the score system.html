<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec35"></a>Scripting and displaying the score system</h2></div></div><hr /></div><a id="id773" class="indexterm"></a><p>Now that health, items, and weapons are being displayed and working, why don't we add some scoring into the mix. We create a script that allows a player to save his score at the press of a button and save it to a text field so that he may come back at a future date and his same file will still exist. The high score will be displayed on screen and when the current score reaches and surpasses the high score, the high score will automatically start updating. Lastly, when the player saves the score, a prompt will pop up letting him know that he has saved his game.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304EXP_05_08.jpg" /></div><p>The following steps will take us to our goal:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create the <code class="literal">Score</code> script.</p></li><li><p>Create the <code class="literal">SaveScore</code> script.</p></li><li><p>Create the <code class="literal">timer</code> script.</p></li><li><p>Revisit the <code class="literal">textMesh</code> script.</p></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec65"></a>The Score script</h3></div></div></div><a id="id774" class="indexterm"></a><a id="id775" class="indexterm"></a><p>The <code class="literal">Score</code> script is rather small and will be our foundation for keeping track of our score. There are two variables that we need to create. One will keep track of our score and the other will be used as a reference to the <code class="literal">textManager</code> script<a id="id776" class="indexterm"></a>:</p><div class="informalexample"><pre class="programlisting">private var currentScore : int = 0;
private var textManager : TextManager;</pre></div><p>In the <code class="literal">Awake</code> function, we need  to have the <code class="literal">textManager</code> reference the <code class="literal">TextManager</code> script.</p><p>The next function allows us to increment the score and send information to the score's associated <code class="literal">itemText</code> when a player presses the <span class="emphasis"><em>P </em></span>key. The <code class="literal">itemText</code> index needed is number <code class="literal">3</code> and the <code class="literal">String</code> parameter<a id="id777" class="indexterm"></a> of the <code class="literal">DisplayInformation</code> function is <code class="literal">"score"</code>:</p><div class="informalexample"><pre class="programlisting">function AddScore()
{    
    if(Input.GetKeyDown(KeyCode.P))
    {
        currentScore += 5;
    gameObject.GetComponent("TextManager").itemText[3].GetComponent("textMesh").DisplayInformation("score", Color.yellow);
    }
}</pre></div><p>The <code class="literal">Update</code> and <code class="literal">ReturnScore</code> function<a id="id778" class="indexterm"></a>s are the last functions remaining. In the <code class="literal">Update</code> function, call the <code class="literal">AddScore</code> function<a id="id779" class="indexterm"></a> and in the <code class="literal">ReturnScore</code> function<a id="id780" class="indexterm"></a>, return <code class="literal">currentScore</code>:</p><div class="informalexample"><pre class="programlisting">function Update(){	AddScore();}
function ReturnScore(){	return currentScore;}</pre></div><p>This save system that we are creating is really cool. It has many possible uses but, for the time being, this use will suffice for teaching how to go about utilizing text documents, and reading and writing to and from them, respectively. As can be thought, this method can have the functionality of save systems like inventory, score, or random seeds for the building of randomly generated worlds.</p><a id="id781" class="indexterm"></a><p>For this script, we first have to import system input and output. This is represented by writing <code class="literal">import</code> <code class="literal">System.IO</code>:</p><div class="informalexample"><pre class="programlisting">import System.IO;</pre></div><p>Next, we bring that in, so we need to bring in variables. We are going to have a display for when we write to the file so we need a variable for that. Make it <code class="literal">GameObject</code> and call it <code class="literal">saveDisplay</code>. The next variable is <code class="literal">sw</code>, which is of <code class="literal">StreamWriter</code> type followed by <code class="literal">sr</code>, which is of <code class="literal">StreamReader</code> type. We will then need variables for the score. One each for <code class="literal">savedHighScore</code>, <code class="literal">currentScore</code>, <code class="literal">displayScore</code>, and <code class="literal">highScore</code>. Lastly, we need <a id="id782" class="indexterm"></a>reference variables for the <code class="literal">Score</code> script and <code class="literal">textManager</code>:</p><div class="informalexample"><pre class="programlisting">public var saveDisplay : GameObject;
private var sw : StreamWriter;
private var sr : StreamReader;
private var savedHighScore : int;
private var currentScore : int;
private var displayScore : int;
private var highScore : int;
private var scoreScr : Score;
 private var textManager : TextManager;</pre></div><p>In the <code class="literal">Awake</code> function, we will first turn the renderer off on the save display by disabling it. Then, we will want to set the score reference variable to the <code class="literal">Score</code> script. The same can be done for <code class="literal">textManager</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec51"></a>Reading from the text file</h4></div></div></div><a id="id783" class="indexterm"></a><p>The next part here is where we begin reading from the text file, because these files need to exist before they can be accessed. We will write the code and then make the files so that you can make sure that things are working appropriately.</p><p>To read from the file, we use the <code class="literal">StreamReader</code> function<a id="id784" class="indexterm"></a>. The <code class="literal">StreamReader</code> function takes the application path to the file and opens its contents. The actual name of the file is also needed. Next, we need to create a new variable called <code class="literal">fileContents</code> and have it equal to the <code class="literal">sr.ReadToEnd()</code> function<a id="id785" class="indexterm"></a>. What this does is set all the information in the file into a single text but at the same time, remember where a new line was created.</p><p>Next, we no longer need the file to be open so we can just close the file by calling the <code class="literal">Close</code> function on the <code class="literal">sr</code> variable. We will then create another variable that will hold the lines of the file. To do this, we will call the <code class="literal">Split</code> function on the <code class="literal">fileContents</code> variable. We specify the type of split that we would like to perform and as we have information on different lines, we use <code class="literal">\n</code> (new line), and also where to start by stating a list index. Then, after knowing that the information has been split into individual lines and our score information is now separate and can be read, we have the <code class="literal">savedHighScore</code> variable equal to the line that the information is on by converting the <code class="literal">string</code> information or into an integer with <code class="literal">parseInt()</code>. We then proceed on and have the <code class="literal">highScore</code> variable to be equal to <code class="literal">savedHighScore</code>. Lastly, we need to send our high score information to be displayed. As the <code class="literal">itemText</code> list variable has the <code class="literal">highscore</code> variable in the fifth place, we use that index for <code class="literal">itemText</code>. So, in this case that would be <code class="literal">4</code>. The information for the <code class="literal">DisplayInformation</code> is <code class="literal">"highScore"</code> and the <code class="literal">Color</code> is <code class="literal">red</code>:</p><div class="informalexample"><pre class="programlisting">function Awake(){
    saveDisplay.renderer.enabled = false;
    scoreScr = gameObject.GetComponent(Score);
    textManager = gameObject.GetComponent("TextManager");
    sr = new StreamReader(Application.dataPath  + "/Save_ScoreFiles/Saved_High_Score.txt");
    var fileContents = sr.ReadToEnd();   
    sr.Close();    
    var lines = fileContents.Split("\n"[0]);  
    savedHighScore = parseInt(lines[1]);
    highScore = savedHighScore;
    gameObject.GetComponent("TextManager").itemText[4].GetComponent("textMesh").DisplayInformation("highScore", Color.red);
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec52"></a>Writing to the text file</h4></div></div></div><a id="id786" class="indexterm"></a><p>This next function deals with writing information to the text files and goes by the name <code class="literal">HighScore</code>. It will handle taking the existing score and comparing it with what is stored as the high score. If the new score is larger than the high score, <code class="literal">highscore</code> update<a id="id787" class="indexterm"></a>s as <code class="literal">currentScore</code> update<a id="id788" class="indexterm"></a>s.</p><p>First, we set out <code class="literal">currentScore</code> to what is being displayed, as there can sometimes be a lag in information transfer. Next, we compare the high score and the current score. If the current score is equal or higher, we continue in the statement. The <code class="literal">highscore</code> becomes equal to the current score so that it may start updating in real time. <code class="literal">savedHighScore</code> becomes equal to <code class="literal">highScore</code>, and the <code class="literal">StreamWriting</code> process starts. <code class="literal">sw</code> will be equal to the same datapath that was established in the <code class="literal">Awake</code> function. Then using the <code class="literal">StreamWriter</code> variable <code class="literal">sw</code>, use the <code class="literal">WriteLine</code> function<a id="id789" class="indexterm"></a> to state what needs to be written. In this case, on the first line, we have put what is to represent and the following line that will be represented.  Repeat the process of writing the line again. However, the problem that arises here is that we want to write an integer to the file. To do this, we need to convert the integer information to a string. This is accomplished by concatenating a string value, double quotes, with the value to be converted, <code class="literal">savedHighScore</code>. After that, close the file.<a id="id790" class="indexterm"></a></p><div class="informalexample"><pre class="programlisting">function HighScore(){
    currentScore = displayScore;
    if (currentScore &gt;= highScore)
    {
        highScore = currentScore;
        savedHighScore = highScore;
        sw = new StreamWriter(Application.dataPath + "/Save_ScoreFiles/Saved_High_Score.txt");
        sw.WriteLine("Score: ");
        sw.WriteLine(savedHighScore + "");
        sw.Close();    
    }
}</pre></div><p>Next, it is time to set up displaying the current score as it reaches the high score and awaiting the player's response to save the high score.</p><p>We want <code class="literal">displayScore</code> to become equal to the score being returned by the <code class="literal">ReturnScore</code> function. Next, we compare that score with the high score and if it is higher, the high score equals that of the current score. This time, we change the color of the high score to show that a change has occurred:</p><div class="informalexample"><pre class="programlisting">displayScore = scoreScr.ReturnScore();
if(displayScore &gt; highScore){
        highScore = displayScore;
    gameObject.GetComponent("TextManager").itemText[4].GetComponent("textMesh").DisplayInformation("highScore", Color.green);
    }</pre></div><p>An <code class="literal">if</code> statement follows the preceding code snippet, which checks for the players pressing of the <span class="emphasis"><em>B</em></span> key. If it is done, we toggle the <code class="literal">saveDisplay</code> renderer to <code class="literal">true</code>, start the display timer, and save the current high score.</p><a id="id791" class="indexterm"></a><p>The last function to write is <code class="literal">ReturnHighScore</code> and it returns <code class="literal">highScore</code>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec66"></a>The timer script</h3></div></div></div><a id="id792" class="indexterm"></a><p>The <code class="literal">timer</code> script<a id="id793" class="indexterm"></a> does exactly what its name implies, it times, and in this case, it acts like a countdown timer. The script requires three variables. One for the begin time, one for the cutoff time, and one to keep track of the current time:</p><div class="informalexample"><pre class="programlisting">public var startTime : float = 1;
public var minTime : float = 0;
private var currentTime: float = 0;</pre></div><p>Next, we will want to create the <code class="literal">Awake</code> function. In here, initialize <code class="literal">currentTime</code> as <code class="literal">startTime</code>:</p><div class="informalexample"><pre class="programlisting">function Awake(){
    currentTime = startTime;
}</pre></div><p>After the <code class="literal">Awake</code> function, we will create the <code class="literal">DisableRenderer</code> function<a id="id794" class="indexterm"></a>. We do a check and see if <code class="literal">currentTime</code> is greater than <code class="literal">minTime</code>. If it is, then we decrease <code class="literal">currentTime</code> by <code class="literal">Time.deltaTime</code> and if it is not, then we turn the renderer off and reset the timer:</p><div class="informalexample"><pre class="programlisting">function DisableRenderer(){
    if(currentTime &gt; minTime){
        currentTime -= Time.deltaTime;
    }
    else{
        renderer.enabled = false;
        currentTime = startTime;
    }
}</pre></div><p>Lastly, we create the <code class="literal">FixedUpdate</code> function. This works nicely for time and gives accurate feedback:</p><div class="informalexample"><pre class="programlisting">function FixedUpdate(){
    DisableRenderer();
}</pre></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec67"></a>Revisiting the textMesh script</h3></div></div></div><a id="id795" class="indexterm"></a><p>Alas, we are back in the <code class="literal">textMesh</code> script. We need to create four new variables. Two will be for the <code class="literal">boolean</code> check to see which <code class="literal">gameObject</code> they are on, and the other two are for accessing the <code class="literal">Score</code> script as well as the <code class="literal">SaveScore</code> script<a id="id796" class="indexterm"></a>:</p><div class="informalexample"><pre class="programlisting">private var saveScoreScr : SaveScore;
private var scoreScr : Score;
private var scoreDisplay: boolean = false;
private var highScoreDisplay : boolean = false;</pre></div><p>In the <code class="literal">Awake</code> function, check <code class="literal">highScoreDisplay</code> if they are of <code class="literal">gameObject</code> type. Do the same for <code class="literal">scoreDisplay</code>. Just below the <code class="literal">PlayerStats</code> referencing, set up the referencing for the <code class="literal">SaveScore</code> script and the <code class="literal">Score</code> script:</p><div class="informalexample"><pre class="programlisting">else if(gameObject.name == "scoreDisplay"){
        scoreDisplay = true;
    }
    else if(gameObject.name == "highScoreDisplay"){
        highScoreDisplay = true;
    }
    scoreScr = gameManager.GetComponent("Score");
    saveScoreScr = gameManager.GetComponent("SaveScore");</pre></div><p>In the <code class="literal">DisplayInformation</code> function<a id="id797" class="indexterm"></a>, create two <code class="literal">else</code> <code class="literal">if</code> statements at the end of the function, make one of them check if <code class="literal">scoreDisplay</code> is activated and make the other check if <code class="literal">highScoreDisplay</code> is activated.</p><a id="id798" class="indexterm"></a><p>Inside each, make them check if incoming <code class="literal">textName</code> is the one that they need to compare. Then, inside of that <code class="literal">if</code> statement, put the renderer color to the <code class="literal">newColor</code>. Lastly, set the text for score to <code class="literal">ReturnScore</code> from the <code class="literal">Score</code> script and <code class="literal">ReturnHighScore</code> from the <code class="literal">SaveScore</code> script<a id="id799" class="indexterm"></a>:</p><div class="informalexample"><pre class="programlisting">else if(scoreDisplay){
    if(textName == "score"){
            renderer.material.color = newColor;
            myText.text = ("SCORE: " + scoreScr.ReturnScore());
        }
    }
    else if(highScoreDisplay){
        if(textName == "highScore"){
            renderer.material.color = newColor;
            myText.text = ("HIGH SCORE: " + saveScoreScr.ReturnHighScore());
        }
    }</pre></div></div></div>