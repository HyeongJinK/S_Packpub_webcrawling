<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec49"></a>The bulletCollision, ammoCollision, and AmmoInfo scripts</h2></div></div><hr /></div><p>This section will allow the projectiles that we are firing to be able to identify what it is that they are hitting at and to apply damage to the object if it has the right tag. The <code class="literal">ammoCollision</code> script will handle the amount of ammo that will be given upon contact and the type of ammo. The <code class="literal">AmmoInfo</code> script will handle the respawn time and the enabling and disabling of the ammo.</p><p>In this section we will look into the following:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>Creating the <code class="literal">bulletCollision</code> script</p></li><li style="list-style-type: disc"><p>Hooking up the <code class="literal">bulletCollision</code> script on bullet's <span class="strong"><strong>Inspector</strong></span></p></li><li style="list-style-type: disc"><p>Creating the <code class="literal">ammoCollision</code> script</p></li><li style="list-style-type: disc"><p>Hooking up the <code class="literal">ammoCollision</code> script on bullet's <span class="strong"><strong>Inspector</strong></span></p></li><li style="list-style-type: disc"><p>Creating the <code class="literal">AmmoInfo</code> script</p></li><li style="list-style-type: disc"><p>Hooking up the <code class="literal">AmmoInfo</code> script on bullet's <span class="strong"><strong>Inspector</strong></span></p></li></ul></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec95"></a>Creating the bulletCollision script</h3></div></div></div><a id="id1156" class="indexterm"></a><p>The <code class="literal">bulletCollision</code> script handles how the bullet will react upon contact with an object. Depending upon the collided object's tag, a specified effect will happen. It will also set up a life timer on the bullet, and the bullet will explode when it has run out of time to live.</p><p>We will create the variables such as <code class="literal">explosion</code> for the explosion that will occur upon the bullet's contact with something, <code class="literal">bulletDamage</code> to determine the amount of damage that the projectile will do to the collided object when the tag matches, <code class="literal">bulletLifeTime</code> to determine how long until the bullet explodes, and <code class="literal">currentTimer</code> that will be the tracker for the timing of the bullet. Each variable is <code class="literal">public</code> except <code class="literal">currentTimer</code>, which is <code class="literal">private</code>. The <code class="literal">explosion</code> variable<a id="id1157" class="indexterm"></a> is of the <code class="literal">GameObject</code> type, <code class="literal">bulletDamage</code> is of the integer type, the <code class="literal">bulletLifeTime</code> variable<a id="id1158" class="indexterm"></a> is float, and so is <code class="literal">currentTimer</code>.</p><div class="informalexample"><pre class="programlisting">public var explosion : GameObject;
public var bulletDamage : int;
public var bulletLifeTime : float = 2;
private var currentTimer : float = 0;</pre></div><p>The <code class="literal">OnCollisionEnter</code> function<a id="id1159" class="indexterm"></a> will handle the bullet's collision with objects. If it has collided with a wall and the player, it instantiates an explosion at the coordinates of its collision and destroys itself. If it is an enemy, it also causes damage to the enemy.</p><div class="informalexample"><pre class="programlisting">function OnCollisionEnter(collidedObj : Collision){
    if( collidedObj.gameObject.layer == "Wall" ||  collidedObj.gameObject.tag == "Player"){
        Instantiate(explosion, transform.position, transform.rotation);
        Destroy(gameObject);
    }
    else if(collidedObj.gameObject.tag == "Enemy"){
    collidedObj.gameObject.GetComponent("enemyStats").DecrementHealth(bulletDamage);
        Instantiate(explosion, transform.position, transform.rotation);
        Destroy(gameObject);
    }
}</pre></div><a id="id1160" class="indexterm"></a><p>The <code class="literal">incrementTime</code> function<a id="id1161" class="indexterm"></a> handles the life of the bullet. If it has not collided with anything by the time the timer has run out, it creates an explosion and destroys itself. This is similar to how flax cannons work.</p><div class="informalexample"><pre class="programlisting">function incrementTime(){
    if(currentTimer &lt; bulletLifeTime){
        currentTimer += Time.deltaTime * 2;
    }
    else    {
        Instantiate(explosion, transform.position, transform.rotation);
        Destroy(gameObject);
    }
}         
Update function calls the incrementTime function.
function Update(){
    incrementTime();
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec70"></a>Hooking up the bulletCollision script on bullet's Inspector</h4></div></div></div><a id="id1162" class="indexterm"></a><a id="id1163" class="indexterm"></a><p>Now that the script is written, we want to create a prefab that is called <span class="strong"><strong>bullet</strong></span> and drag a cube or a sphere or any object that you would like to be our projectile. Drag the <span class="strong"><strong>bulletCollision</strong></span> script onto the object as well and set the damage of the bullet and lifetime of the bullet. Once that is done, make sure that it is in the prefab and drag it to the <span class="strong"><strong>projectile</strong></span> slot in every enemy's <code class="literal">Shoot</code> script.</p><p>Now when you press <span class="strong"><strong>Play</strong></span> and the player comes into the range of an enemy, the player will be pursued if:</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><a id="id1164" class="indexterm"></a><a id="id1165" class="indexterm"></a><p>The enemy is aggressive and the player is in range of the enemy</p></li><li style="list-style-type: disc"><p>The player attacks a defensive enemy and is in range of the enemy</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304_07_08.jpg" /></div></li></ul></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec96"></a>Creating the ammoCollision script</h3></div></div></div><a id="id1166" class="indexterm"></a><a id="id1167" class="indexterm"></a><p>The <code class="literal">ammoCollision</code> script, as mentioned, will destroy the ammo when hit, grab the ammo's information, and return it to the <code class="literal">enemyStats</code> script and the <code class="literal">ReceiveAmmo</code> function.</p><p>Declaring variables for this function is easy. All we have to define is a script reference variable for the <code class="literal">enemyStats</code> script. The variable will be <code class="literal">private</code> and its type will be the name of our <code class="literal">enemyStats</code> script:</p><div class="informalexample"><pre class="programlisting">private var enemyStatScr : enemyStats;</pre></div><p>The <code class="literal">Awake</code> function will set the <code class="literal">enemyStatScr</code> variable to the <code class="literal">enemyStats</code> script as follows:</p><div class="informalexample"><pre class="programlisting">function Awake(){
    enemyStatScr = GetComponent("enemyStats");
}</pre></div><p>The <code class="literal">OnCollisionEnter</code> function<a id="id1168" class="indexterm"></a> will determine the amount of ammo that the enemy receives upon contact with ammo. If the enemy collides with ammo, we will turn the ammo's renderer off by setting <code class="literal">objCollided.gameObject.renderer.enabled</code> to <code class="literal">false</code> and make it noncollidable by setting <code class="literal">objCollided.gameObject.collider.isTrigger</code> to <code class="literal">true</code>.</p><p>Three variables are declaredâ€”one variable to hold the script reference to the <code class="literal">AmmoInfo</code> script, a second one to get the type of ammo collided, and the third one to hold how much ammo should be given. The <code class="literal">ammoAmount</code> variable<a id="id1169" class="indexterm"></a> is an integer and the <code class="literal">ammoType</code> variable is <code class="literal">string</code>.</p><p>If <code class="literal">ammoType</code> is <code class="literal">projectile</code>, we will call the <code class="literal">GetProjectileAmmoAmount</code> function from the <code class="literal">AmmoInfo</code> script and if it is <code class="literal">special</code>, we will call the <code class="literal">GetSpecialAmmoAmount</code> function instead.</p><a id="id1170" class="indexterm"></a><a id="id1171" class="indexterm"></a><p>Lastly, we will set the <code class="literal">ReceiveAmmo</code> function of the <code class="literal">enemyStats</code> script to the <code class="literal">ammoAmount</code> variable.</p><div class="informalexample"><pre class="programlisting">function OnCollisionEnter(objCollided : Collision){
    if(objCollided.gameObject.tag == "Ammo"){
        objCollided.gameObject.renderer.enabled = false;
        objCollided.gameObject.collider.isTrigger = true;
        var ammoInfoScr : AmmoInfo = objCollided.gameObject.GetComponent("AmmoInfo");
        var ammoType : string = ammoInfoScr.GetAmmoType();
        var ammoAmount : int;
        if(ammoType == "projectile"){
            ammoAmount = ammoInfoScr.GetProjectileAmmoAmount();
        }
        else if(ammoType == "special")    {
            ammoAmount = ammoInfoScr.GetSpecialAmmoAmount();
        }    
        enemyStatScr.ReceiveAmmo(ammoAmount);
    }
}</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec71"></a>Hooking up the ammoCollision script on enemy's Inspector</h4></div></div></div><a id="id1172" class="indexterm"></a><a id="id1173" class="indexterm"></a><p>Not much to do to hook this script up. Drag it onto <span class="strong"><strong>Inspector</strong></span> of each enemy and you're done.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304_07_09.jpg" /></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec97"></a>Creating the AmmoInfo script</h3></div></div></div><a id="id1174" class="indexterm"></a><p>The <code class="literal">AmmoInfo</code> script allows for ammo to have value when it is picked up by an enemy. The script will have the amount worth for the ammo and respawn the ammo after it has been disabled.</p><p>There are a couple of variables needed to be defined for this script.</p><p>We need an <code class="literal">enum</code> variable that handles <code class="literal">kindOfAmmo</code>. It has the <code class="literal">enum</code> name of weapon type and we will call it <code class="literal">ammoType</code>.</p><p>The next two are the ammo worth variables. The first one is <code class="literal">projectileAmmoAmount</code> and the second one is <code class="literal">specialAmmoAmount</code>. Both of them are <code class="literal">public</code> and are of the integer type.</p><p>The next set of variables contains the time variables. They are the <code class="literal">respawnTime</code>, <code class="literal">currentTimer</code>, and <code class="literal">startTime</code> variables. <code class="literal">respawnTime</code> is <code class="literal">public</code> and the other two are <code class="literal">private</code>. <code class="literal">respawnTime</code> and <code class="literal">currentTimer</code> are of the <code class="literal">float</code> type, and <code class="literal">startTime</code> is <code class="literal">boolean</code>.</p><a id="id1175" class="indexterm"></a><p>The last variable is the <code class="literal">kindOfAmmo</code> <code class="literal">enum</code>. This one, at this moment, holds reference to <code class="literal">projectile</code> type ammo and <code class="literal">special</code> type ammo.</p><div class="informalexample"><pre class="programlisting">public var ammoType : kindOfAmmo;
public var projectileAmmoAmount : int = 50;
public var specialAmmoAmount : int = 25;
public var respawnTime : float = 5;
public var currentTimer : float = 0;
private var startTime : boolean = false;
enum kindOfAmmo{
    projectile,
    special
}</pre></div><p>The <code class="literal">GetAmmoType</code> function<a id="id1176" class="indexterm"></a> will return <code class="literal">ammoType</code> based upon the selection from the enumeration (<code class="literal">projectile</code> or <code class="literal">special</code>).</p><p>The <code class="literal">GetProjectileAmmoAmount</code> function<a id="id1177" class="indexterm"></a> returns <code class="literal">projectileAmmoAmount</code>.</p><p>The <code class="literal">GetSpecialAmmoAmount</code> function<a id="id1178" class="indexterm"></a> returns <code class="literal">specialAmmoAmount</code>.</p><p>The <code class="literal">incrementTime</code> function<a id="id1179" class="indexterm"></a> will start the respawn time of the ammo after the ammo has been disabled. The timer will count up to the respawn time by adding <code class="literal">Time.deltaTime</code> to itself. When the timer reaches the respawn time, we will set the <code class="literal">startTime</code> variable to <code class="literal">false</code>, turn the ammo's renderer back on by setting <code class="literal">gameObject.renderer.enabled</code> to <code class="literal">true</code>, make the ammo collidable by setting <code class="literal">gameObject.collider.isTrigger</code> to <code class="literal">false</code>, and reset the timer to <code class="literal">0</code>.</p><p>The <code class="literal">Update</code> function will check if the renderer of the <code class="literal">gameObject</code> is enabled, and if it is not, it will set <code class="literal">startTime</code> (respawn time) to <code class="literal">true</code> and call the <code class="literal">incrementTime</code> function.</p><div class="informalexample"><pre class="programlisting">function GetAmmoType() : String {
    if(ammoType.projectile)
    return "projectile";
    if(ammoType.special)
    return "special";
}
function GetProjectileAmmoAmount(){return projectileAmmoAmount;}
function GetSpecialAmmoAmount(){return specialAmmoAmount;}
function incrementTime(){
    if(startTime)    {    
        if(currentTimer &lt; respawnTime){
            currentTimer += Time.deltaTime * 2;
        }
        else	{
            startTime = false;
            gameObject.renderer.enabled = true;
            gameObject.collider.isTrigger = false;
            currentTimer = 0;
        }
    }
}
function Update(){
    if(gameObject.renderer.enabled == false){
        startTime = true;
        incrementTime();    
    }
}<a id="id1180" class="indexterm"></a>
</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch07lvl3sec72"></a>Hooking up the AmmoInfo script on ammo's Inspector</h4></div></div></div><a id="id1181" class="indexterm"></a><a id="id1182" class="indexterm"></a><p>Once the <code class="literal">AmmoInfo</code> script is written, we will create a new prefab called <span class="strong"><strong>ammo</strong></span>. Create a single cylinder and apply a basic material to it so that it can be differentiated from the background color of the level.</p><p>After that, apply the script to the <code class="literal">gameObject</code> and set the values of the script. For testing purposes, the <code class="literal">enum</code> defaults to <code class="literal">projectile</code> or whichever one you have at the first place. Set <span class="strong"><strong>Projectile</strong></span> <span class="strong"><strong>Ammo</strong></span> <span class="strong"><strong>Amount</strong></span> to <span class="strong"><strong>100</strong></span>, <span class="strong"><strong>Special</strong></span> <span class="strong"><strong>Ammo</strong></span> <span class="strong"><strong>Amount</strong></span> to <span class="strong"><strong>50</strong></span>, <span class="strong"><strong>Respawn</strong></span> <span class="strong"><strong>Time</strong></span> to <span class="strong"><strong>15</strong></span> (this represents seconds). Tag the <span class="strong"><strong>gameObject</strong></span> <span class="strong"><strong>Ammo</strong></span> and drag the <span class="strong"><strong>gameObject</strong></span> onto the prefab. Place your ammo around the level and you are done.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304_07_10.jpg" /></div><p>Now place the player in a position where an enemy will interact with him. So, when you go and press <span class="strong"><strong>Play</strong></span>, the enemies will follow their paths, but if they come across the player, and if their behavior type is aggressive, they can shoot the player but only for a specific time. With each bullet fired, their health goes down and now they have to search out ammo. If the ammo has been out of range of the player when the enemies pick it up, they <a id="id1183" class="indexterm"></a><a id="id1184" class="indexterm"></a>disengage from the player and resume their waypoint path, at least, until their paths cross again.</p><div class="mediaobject"><img src="/graphics/9781849692304/graphics/2304_07_11.jpg" /></div></div></div></div>