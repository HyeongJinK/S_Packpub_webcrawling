<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec38"></a>Examples</h2></div></div><hr /></div><p>We will continue to work on the <span>UI</span><a id="id325376082" class="indexterm"></a> we have been building for the last two chapters. To help organize the project, duplicate the <code class="literal">Chapter3</code>scene that you created in the last chapter; it will automatically be named as <code class="literal">Chapter4</code>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec42"></a>Showing and hiding pop-up menus with keypress</h3></div></div></div><p>So far, we have made two panels that <span>we</span><a id="id325606630" class="indexterm"></a> plan on making pop-ups: <code class="literal">Pause Panel</code> from <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Canvases, Panels, and Basic Layout</em></span> and <code class="literal">Inventory Panel</code> from <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Automatic Layouts</em></span>. Right now they are both visible in the scene (even though <code class="literal">Pause Panel</code> is hidden behind the <code class="literal">Inventory Panel</code>). We want them to <span>pop</span><a id="id325606827" class="indexterm"></a> up when we press specific <span class="emphasis"><em>p</em></span> and <span class="emphasis"><em>i</em></span> on the keyboard. For demonstration purposes, we'll access the keyboard keys differently for each panel.</p><p>Remember that both of these panels have Canvas Group components on them. These components will allow us to easily access the panels' alpha, intractable, and blocks raycasts properties.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec29"></a>Using KeyCode with the Inventory Panel</h4></div></div></div><p>Let's begin with the <code class="literal">Inventory Panel</code>. We want the panel to <span>pop</span><a id="id325611026" class="indexterm"></a> up and close when the <span class="emphasis"><em>i</em></span> key is pressed on the keyboard. To make the <code class="literal">Inventory Panel</code> appear and disappear with the <span class="emphasis"><em>i</em></span> key, complete the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a new C# script in the <code class="literal">Assets/Scripts</code> folder by right-clicking within the <strong class="userinput"><code>Project</code></strong> view of the folder and selecting <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>C# Script</code></strong> from the pop-up panel.</li><li>Name the script <code class="literal">ShowHidePanels</code>, and then double-click on it to open.</li><li>We will now go to the <code class="literal">public CanvasGroup</code> variable called <code class="literal">inventoryPanel</code> to represent the panel. We will use a <code class="literal">CanvasGroup</code> variable type to reference the panel, since we want to access the properties of the <strong class="userinput"><code>Canvas Group</code></strong> component. Update your <code class="literal">ShowHidePanels</code> script to include the following highlighted line of code:</li></ol></div><pre class="programlisting">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class ShowHidePanels : MonoBehaviour {
<span class="strong"><strong>public CanvasGroup inventoryPanel;</strong></span>

     // Use this for initialization
     void Start () {

     }

     // Update is called once per frame
     void Update () {

     }
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note36"></a>Note</h3><p>The <code class="literal">CanvasGroup</code> variable type, even though it is used with UI elements, is not in the <code class="literal">UnityEngine.UI</code> namespace, but the <code class="literal">UnityEngine</code> namespace, so we do not need to include <code class="literal">UnityEngine.UI</code> in our namespace script to work with it.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Let's create another variable that will keep track of whether or not the Inventory Panel is visible. Add the following code to the next line of the script:</li></ol></div><pre class="programlisting">public bool inventoryUp=false;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>We want <code class="literal">Inventory Panel</code> to be hidden when the scene starts playing. When the panel is hidden, it should also not accept interactions or block raycasts. So, update the <code class="literal">Start()</code> function to include the following code:</li></ol></div><pre class="programlisting">void Start () {
<span class="strong"><strong>inventoryPanel.alpha=0;</strong></span>
<span class="strong"><strong>     inventoryPanel.interactable=false;</strong></span>
<span class="strong"><strong>     inventoryPanel.blocksRaycasts=false;</strong></span>
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Now, we need to write code that triggers whenever the <span class="emphasis"><em>i</em></span> key on the keyboard is pressed down. We will use the <code class="literal">Input.GetKeyDown()</code> function so that we get the function called the moment it is pressed down. We will also use <code class="literal">KeyCode.I</code> to reference the <span class="emphasis"><em>i</em></span> key on the keyboard. Add the following code to your <code class="literal">Update</code> function to check whether the <span class="emphasis"><em>i</em></span> key is pressed down:</li></ol></div><pre class="programlisting">void Update () {
<span class="strong"><strong>//inventory panel</strong></span>
<span class="strong"><strong>     if(Input.GetKeyDown(KeyCode.I)){</strong></span>

<span class="strong"><strong>     }  </strong></span>
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>We want this key to disable and <span>enable</span><a id="id325630441" class="indexterm"></a> the panel, so we will place an <code class="literal">if</code>-<code class="literal">else</code> statement within the code created in the last step that checks whether or not the inventory panel needs to be enabled or disabled. It will accomplish this by checking the current status of the <code class="literal">inventoryUp</code>variable. Remember that we initialized <code class="literal">inventoryUp</code> as <code class="literal">false</code>, so if the inventory is not up, that is, <code class="literal">inventoryUp</code> is equal to <code class="literal">false</code>, it will show the Panel and set <code class="literal">inventoryUp</code> to <code class="literal">true</code>. If the inventory is up, that is, <code class="literal">inventoryUp</code> is equal to true, it will hide the Panel and set <code class="literal">inventoryUp</code> to <code class="literal">false</code>. Add the following code to your <code class="literal">Update()</code> function:</li></ol></div><pre class="programlisting">void Update () {
     //inventory panel
     if(Input.GetKeyDown(KeyCode.I)){
<span class="strong"><strong>//not visible</strong></span>
<span class="strong"><strong>          if(inventoryUp==false){</strong></span>
<span class="strong"><strong>               inventoryUp=true;</strong></span>
<span class="strong"><strong>               inventoryPanel.alpha=1;</strong></span>
<span class="strong"><strong>               inventoryPanel.interactable=true;</strong></span>
<span class="strong"><strong>               inventoryPanel.blocksRaycasts=true;</strong></span>

<span class="strong"><strong>          //already visible</strong></span>
<span class="strong"><strong>          }else{</strong></span>
<span class="strong"><strong>               inventoryUp=false;</strong></span>
<span class="strong"><strong>               inventoryPanel.alpha=0;</strong></span>
<span class="strong"><strong>               inventoryPanel.interactable=false;</strong></span>
<span class="strong"><strong>               inventoryPanel.blocksRaycasts=false;</strong></span>
<span class="strong"><strong>          }</strong></span>
     }
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Now, for this code to work, we need to attach it to a <code class="literal">GameObject</code> within our scene. It really doesn't matter what <code class="literal">GameObject</code> we attach it to, since we used a public variable to access our <code class="literal">inventoryPanel</code>. However, since we are planning on using this script to affect both panels, I want to add it to <code class="literal">Main Camera</code>. Drag and drop the <code class="literal">ShowHidePanels</code> script into the <strong class="userinput"><code>Inspector</code></strong> of <code class="literal">Main Camera</code>. You should now see the following as a component on your <code class="literal">Main Camera</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/fb28a71d-dbd7-402c-92e3-4e3e63f03bd5.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Now, we need to assign the <code class="literal">Inventory Panel</code> GameObject to the slot labelled <code class="literal">Inventory Panel</code>. Drag and drop the <strong class="userinput"><code>Inventory Panel</code></strong> from the Hierarchy into this slot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/864c966a-dc1a-4a31-84b1-21458d826348.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Play the game to ensure that the code is working correctly. You should see the inventory panel start out invisible and then turn on and off as you press the <strong class="userinput"><code><span class="emphasis"><em>i</em></span></code></strong> key on the keyboard.</li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec30"></a>Using Input Manager with the pause panel</h4></div></div></div><p>Now, let's do the same thing for the <code class="literal">Pause Panel</code>. We'll do <span>this</span><a id="id325630748" class="indexterm"></a> slightly differently than the <code class="literal">Inventory Panel</code>, using the Input Manager instead of a <code class="literal">KeyCode</code>. We also need to actually pause the game.</p><p>To display the pause panel using the <span class="emphasis"><em>p</em></span> key and pause the game, complete the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>First, we need to set up the Input Manager to include a <code class="literal">Pause</code> axis. Open the Input Manager with <strong class="userinput"><code>Edit</code></strong> | <strong class="userinput"><code>Project Settings</code></strong> | <strong class="userinput"><code>Input</code></strong> and expand the axes by selecting the arrow next to the word <strong class="userinput"><code>Axes</code></strong>.</li><li>By default, your project has <code class="literal">18</code> axes. You can <span>replace</span><a id="id325630798" class="indexterm"></a> one of these with the new Pause axis if you aren't planning on using them, but we might as well just go ahead and make a new one. Definitely, don't delete the <code class="literal">Submit</code> and <code class="literal">Cancel</code> axes, as we have them being referenced in our <strong class="userinput"><code>Standalone Input Manger</code></strong>.
To add a new axis, change the size to <code class="literal">19</code>. This will duplicate the last axis in the list, <code class="literal">Cancel</code>, as shown in the following screenshot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/41f04315-75a3-430f-912e-a9ef2be62855.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>Change the second <code class="literal">Cancel</code> axis to a <code class="literal">Pause</code> axis by changing the <strong class="userinput"><code>Name</code></strong> to <code class="literal">Pause</code>, the <strong class="userinput"><code>Positive Button</code></strong> to <code class="literal">p</code>, and deleting <code class="literal">joystick button 1</code> in <strong class="userinput"><code>Alt Positive Button</code></strong>, as shown:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/bc149ac6-7c01-4c3e-8157-1d0780e2e389.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Now that we have our <code class="literal">Pause</code> axis set up, we <span>can</span><a id="id325630887" class="indexterm"></a> start writing our code. Let's define some variables to use with the <code class="literal">Pause Panel</code> similar to the way we defined variables for <code class="literal">Inventory Panel</code>. Add the following variable definitions at the top of your class under your previous variable definitions:</li></ol></div><pre class="programlisting">public CanvasGroup pausePanel;
public bool pauseUp=false;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Add the following to the <code class="literal">Start()</code> function and make the <code class="literal">Pause Panel</code> invisible at start:</li></ol></div><pre class="programlisting">pausePanel.alpha=0;
pausePanel.interactable=false;
pausePanel.blocksRaycasts=false;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="6" type="1"><li>Since we added the <code class="literal">Pause</code> axis to our Input Manager, we can use <code class="literal">Input.GetButtonDown()</code> instead of <code class="literal">Input.GetKeyDown()</code>, like we did with <code class="literal">Inventory Panel</code>. We want to use <code class="literal">GetButtonDown()</code> rather than <code class="literal">GetAxis()</code>, because we want a function that will return true once, not continuously. If it returned continuously (using <code class="literal">GetAxis()</code>), the panel would flicker in and out while the <span class="emphasis"><em>p</em></span> key <span>was</span><a id="id325635978" class="indexterm"></a> being pressed. Add the following code at the end of your <code class="literal">Update()</code> function. Note that it's very similar to the code we used for <code class="literal">Inventory Panel</code>:</li></ol></div><pre class="programlisting">//pause panel
if(Input.GetButtonDown("Pause")){
     //not visible
     if(pauseUp==false){
          pauseUp=true;
          pausePanel.alpha=1;
          pausePanel.interactable=true;
          pausePanel.blocksRaycasts=true;
     //already visible
     }else{
          pauseUp=false;
          pausePanel.alpha=0;
          pausePanel.interactable=false;
          pausePanel.blocksRaycasts=false;
     }
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="7" type="1"><li>Now that we've added two new public variables to our script, they should both be showing up in the <strong class="userinput"><code>Inspector</code></strong> of our <code class="literal">Main Camera</code> now. Drag and drop the <code class="literal">Pause Panel</code> from the Hierarchy to the <strong class="userinput"><code>Pause Panel</code></strong> slot.</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/104521c1-996b-4f3b-bca6-981e8a6fc74a.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Now, play the game and watch the <code class="literal">Pause Panel</code> become visible <span>and</span><a id="id325636038" class="indexterm"></a> invisible when you press the <span class="emphasis"><em>p</em></span> key on the keyboard.</li></ol></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec43"></a>Pausing the game</h3></div></div></div><p>The game doesn't actually pause right now. If we had animations or events running in the scene, they would continue to run even with the pause panel up. There is a really quick way to pause a game and that is by manipulating the time <span>scale</span><a id="id325636056" class="indexterm"></a> of the game. If the time scale is set to <code class="literal">1</code>, time will run as it normally does. If the time scale is set to <code class="literal">0</code>, the time within the game will pause.</p><p>Also, our current setup doesn't quite work, as a pause menu would be expected. <code class="literal">Inventory Panel</code> and <code class="literal">Pause Panel</code> can be displayed at the same time. If <code class="literal">Inventory Panel</code> is up, the <code class="literal">Pause Panel</code> is covered up by it, since it is rendering behind it. Also, the <code class="literal">Inventory Panel</code> can be activated when the game is "paused".</p><p>We'll need to pause the time scale of our game, change the order that our panels render, and disable functionality when the game is paused to have a <code class="literal">Pause Panel</code> that functions properly. To create a properly functioning <code class="literal">Pause Panel</code>, complete the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Add the following to the <code class="literal">Update()</code> function to the <code class="literal">ShowHidePanels</code> script to pause the time in the game:</li></ol></div><pre class="programlisting">//not visible
if(pauseUp==false){
     pauseUp=true;
     pausePanel.alpha=1;
     pausePanel.interactable=true;
     pausePanel.blocksRaycasts=true;
<span class="strong"><strong>Time.timeScale=0;</strong></span>

//already visible
}else{
    pauseUp=false;
    pausePanel.alpha=0;
    pausePanel.interactable=false;
    pausePanel.blocksRaycasts=false;
<span class="strong"><strong>Time.timeScale=1;</strong></span>
}</pre><div class="orderedlist"><ol class="orderedlist arabic" start="2" type="1"><li>Now, let's deal with the fact that <code class="literal">Pause Panel</code> is behind the <code class="literal">Inventory Panel</code>. This is an easy fix. Simply change their order in the Hierarchy by dragging <code class="literal">Pause Panel</code> below the <code class="literal">Inventory Panel</code>. The items that are listed lower in the Hierarchy appear on top of the ones listed above it within the scene. Now, <code class="literal">Pause Panel</code> will be above the <code class="literal">Inventory Panel</code> in the scene:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/0d6d5004-d2d3-4e51-b445-d6f536f88680.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>The only thing left to do is to disable the ability of <code class="literal">Inventory Panel</code> to appear and disappear if the <code class="literal">Pause Panel</code> is up. Adjust the <code class="literal">if</code> statement that checks for <span class="emphasis"><em>i</em></span> key being pressed to also check whether <code class="literal">pauseUp</code> is <code class="literal">false</code>, like so:</li></ol></div><pre class="programlisting">if(Input.GetKeyDown(KeyCode.I) <span class="strong"><strong>&amp;&amp; pauseUp==false</strong></span>){</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Play the game now and see when if the game is paused, <code class="literal">Inventory Panel</code> cannot be activated and deactivated. If the <code class="literal">Inventory Panel</code> is activated when the <code class="literal">Pause Panel</code> is already up, it cannot be deactivated until after the game is <span>unpaused</span>.</li></ol></div><p>It's important to remember that when you have a <code class="literal">Pause Panel</code>, other events need to be turned off. Setting the timescale to <code class="literal">0</code> does not <span>stop</span><a id="id325636267" class="indexterm"></a> the ability for other events to occur; it only really stops animations and any clocks you may have displayed that use the time scale. So, we will need to ensure that any other event we program is turned off when the game is <span>paused</span>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec44"></a>Dragging and dropping inventory items</h3></div></div></div><p>We have an <code class="literal">Inventory Panel</code> that can be displayed <span>and</span><a id="id325636291" class="indexterm"></a> hidden <span>and</span><a id="id325636299" class="indexterm"></a> an HUD inventory. I want to be able to drag objects from my larger <code class="literal">Inventory Panel</code> to my smaller HUD inventory called <code class="literal">Bottom Right Panel</code> that we created in the previous chapter.</p><p>To make things a little easier for ourselves, let's disable the <code class="literal">ShowHidePanels</code> script that we added to the <code class="literal">Main Camera</code> earlier in this chapter. You can do this by deselecting the checkbox next to the script's component on the <code class="literal">Main Camera</code>:</p><div class="mediaobject"><img src="/graphics/9781787125520/graphics/1a61d28b-6063-4edd-9bee-c7c83bc5ed21.png" /></div><p>Let's also disable <code class="literal">Pause Panel</code> so that it will not be in our way. Do this by deselecting the checkbox next to the name of the <code class="literal">Pause Panel</code> in its Inspector.</p><p>Now our panel will stay visible, making it easier for us to debug the code we're about to write.</p><p>There are quite a few different ways to make a drag and drop mechanic. To ensure that this chapter provides an example of <span>how</span><a id="id325636350" class="indexterm"></a> to use the <strong class="userinput"><code>Event Trigger</code></strong> component, we will write a drag and drop mechanic utilizing it. To create a drag and <span>drop</span><a id="id325636362" class="indexterm"></a> mechanic for the <code class="literal">Inventory Panel</code> and <code class="literal">Bottom Right Panel</code>, complete the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li>Create a new C# script in the <code class="literal">Assets/Scripts</code> folder called <code class="literal">DragAndDrop</code> and open it.</li><li>We will be referencing UI elements in this script, so add the <code class="literal">UnityEngine.UI</code> namespace to the top of the script with this:</li></ol></div><pre class="programlisting">using UnityEngine.UI;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="3" type="1"><li>We only need to add two variables to this script: one will represent the <code class="literal">GameObject</code> being dragged, and the other represents the <code class="literal">Canvas</code> that the items will be dragged on. Add the following public variables to the top of the class:</li></ol></div><pre class="programlisting">public GameObject dragItem;
public Canvas dragCanvas;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="4" type="1"><li>Before we write any more code, let's go back to the Editor with a bit more prep work. Drag the <code class="literal">DragAndDrop</code> script to the <strong class="userinput"><code>Inspector</code></strong> of the <code class="literal">Main Camera</code> to attach it as a component:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/afc74b9c-2a4a-4163-ab22-3add7d198d42.png" /></div><p>I've chosen to create a script that attaches it to the <code class="literal">Main Camera</code> rather than the individual inventory items, to reduce the need to duplicate this script.</p><div class="orderedlist"><ol class="orderedlist arabic" start="5" type="1"><li>Now, create a new UI Canvas by selecting <strong class="userinput"><code>Create</code></strong> | <strong class="userinput"><code>UI</code></strong> | <strong class="userinput"><code>Canvas</code></strong> from the Hierarchy menu. Name the new Canvas <code class="literal">Drag Canvas</code>.</li><li>Select <code class="literal">HUD Canvas</code> and copy its <strong class="userinput"><code>Canvas Scalar</code></strong> component by selecting the settings cog in its top-right corner and selecting <strong class="userinput"><code>Copy</code></strong><strong class="userinput"><code>Component</code></strong>.</li><li>Reselect <code class="literal">Drag Canvas</code>, and paste the copied <strong class="userinput"><code>Canvas Scaler</code></strong> properties to its <strong class="userinput"><code>Canvas Scalar</code></strong> component by selecting the settings cog in its top-right corner and selecting <strong class="userinput"><code>Paste Component</code></strong><strong class="userinput"><code>Values</code></strong>.

Once that is done, it should have the following values:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/64093231-8359-4830-bb14-c8a19f5a1a2e.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="8" type="1"><li>Set the <strong class="userinput"><code>Sort Order</code></strong> property on the <code class="literal">Drag Canvas</code> Canvas component to <code class="literal">1</code>. This will cause anything that is on the <code class="literal">Drag Canvas</code> to render in front of all other Canvases, since the other Canvases have a <strong class="userinput"><code>Sort Order</code></strong> of <code class="literal">0</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/a133dfa0-71eb-424a-a31c-6d1903918ef7.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="9" type="1"><li>Drag and drop the <code class="literal">Drag Canvas</code> from the Hierarchy into the <strong class="userinput"><code>Drag Canvas</code></strong> slot on the <code class="literal">DragAndDrop</code> script component on the <code class="literal">Main Camera</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/7612d5dc-c62a-42c5-9986-22696bdd515f.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="10" type="1"><li>Reopen the <code class="literal">DragAndDrop</code> script. Create a new function called <code class="literal">StartDrag()</code>, as follows:</li></ol></div><pre class="programlisting"> public void StartDrag(GameObject selectedObject){
     dragItem=Instantiate(selectedObject, Input.mousePosition, selectedObject.transform.rotation) as <span>GameObject;</span>
     dragItem.transform.SetParent(dragCanvas.transform);
     dragItem.GetComponent&lt;Image&gt;().SetNativeSize();
     dragItem.transform.localScale=1.1f*dragItem.transform.localScale;
}</pre><p>This function will be called when a drag begins. It accepts a <code class="literal">GameObject</code> as a parameter and then creates a new instance of it at the position of the mouse. It then moves it so that it is a child of <code class="literal">dragCanvas</code>. Lastly, it sets the size of the Image on the Image component to native size. This resets the scale on the image to its original pixel size. (Refer to <a class="link" href="#" linkend="ch06">Chapter 6</a>, <span class="emphasis"><em>Text, Images, and TextMesh Pro-Text</em></span> for more on <strong class="userinput"><code>Set Native Size</code></strong>). The last line makes the image 10 percent bigger than its native size.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note37"></a>Note</h3><p>After we hook up our <code class="literal">BeginDrag</code> and <code class="literal">Drag</code> events, if you comment out the line of code that sets the size to native, you'll see that the Image does not actually render in the scene, because its scale is "wacky" from the original <code class="literal">GameObject</code> being within a <strong class="userinput"><code>Layout Group</code></strong>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" start="11" type="1"><li>Now create a new function called <code class="literal">Drag()</code>, as follows:</li></ol></div><pre class="programlisting">public void Drag(){
     dragItem.transform.position=Input.mousePosition;
}</pre><p>This function will be called when an object is being dragged. While the object is dragged, it will keep position with the mouse.</p><div class="orderedlist"><ol class="orderedlist arabic" start="12" type="1"><li>Return to the Editor. We will just hook the events to the first object in the <code class="literal">Inventory Panel</code> for now. Select the first <code class="literal">Food</code> image in the <code class="literal">Inventory Panel</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/00fc078b-198e-4147-8a55-11bcf87e9e07.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="13" type="1"><li>Add a new <strong class="userinput"><code>Event Trigger</code></strong> component to the <code class="literal">Food</code> Image by selecting <strong class="userinput"><code>Add Component</code></strong> | <strong class="userinput"><code>Event</code></strong> | <strong class="userinput"><code>Event Trigger</code></strong> within its <strong class="userinput"><code>Inspector</code></strong>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/a430c539-63a1-400e-a4a6-349299e49ad8.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="14" type="1"><li>Now, add a <code class="literal">BeginDrag</code> event type and a <code class="literal">Drag</code> event type to the <strong class="userinput"><code>Event Trigger</code></strong> list by selecting <strong class="userinput"><code>Add New Event Type</code></strong> | <strong class="userinput"><code>BeginDrag</code></strong> and <strong class="userinput"><code>Add New Event Type</code></strong> | <strong class="userinput"><code>Drag</code></strong>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/520fb5fd-d29c-44a2-9b58-5f22ab8d995c.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="15" type="1"><li>Now we will hook add an action to the <code class="literal">BeginDrag</code> list by selecting the plus sign at the bottom-right corner of the <strong class="userinput"><code>Begin Drag</code></strong> area:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/6b9a2c01-7e36-4223-b0d4-15f820fb310b.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="16" type="1"><li>Drag the <code class="literal">Main Camera</code> into the object slot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/29ae63cd-81bc-4ff4-b932-74a0116feba5.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="17" type="1"><li>The function drop-down list is now intractable. Expand the function drop-down list to see the list of functions, components, and such attached to the <strong class="userinput"><code>Main Camera</code></strong>. Find the <strong class="userinput"><code>DragAndDrop</code></strong> script and then the <strong class="userinput"><code>StartDrag(GameObject)</code></strong> function:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/7013dff4-f488-4b45-87b2-8ac70a11e3ba.png" /></div><p>Once you have done so, you should see the following:</p><div class="mediaobject"><img src="/graphics/9781787125520/graphics/ac23d184-6eed-4c14-bbf0-fc960b9259df.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="18" type="1"><li>Now, we need to assign the <code class="literal">GameObject</code> parameter. Drag and drop the <code class="literal">Food</code> Image that this <strong class="userinput"><code>Event Trigger</code></strong> component is attached to into the parameter slot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/385b9836-1203-4e58-baad-c427cc8d7649.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="19" type="1"><li>Now, set up the <code class="literal">Drag</code> event list similarly so that it looks like this:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/b1cee13d-acb2-4d14-bfad-22c00ae58fd4.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="20" type="1"><li>If you play the game, you should now be able to drag the orange in the first slot out of its slot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/fa5ed554-387d-4661-a35c-101bdddc6541.png" /></div><p>You'll see, in the Hierarchy, that there is a new <code class="literal">GameObject</code> called <code class="literal">Food(Clone)</code> that is a child of the <code class="literal">Drag Canvas</code>. This is the orange that gets created when you begin dragging:</p><div class="mediaobject"><img src="/graphics/9781787125520/graphics/bdae08c7-e580-4aa0-836e-9dfb86d1f0c8.png" /></div><p>At this point, you can actually make as many of these clones as you want. In a moment, however, we will make it so that there is only one clone in the <code class="literal">Drag Canvas</code> at a time.</p><div class="orderedlist"><ol class="orderedlist arabic" start="21" type="1"><li>Go back to the <code class="literal">DragAndDrop</code> script and create a new function called <code class="literal">StopDrag()</code>, as follows:</li></ol></div><pre class="programlisting">public void StopDrag(){
     Destroy(dragItem);
}</pre><p>This code will destroy the <code class="literal">Food(Clone)</code><code class="literal">GameObject</code> once it is no longer being dragged.</p><div class="orderedlist"><ol class="orderedlist arabic" start="22" type="1"><li>Go back to the Editor and reselect the <code class="literal">Food</code> Image in <code class="literal">Inventory Panel</code>. Give its <strong class="userinput"><code>Event Trigger</code></strong> component an <code class="literal">EndDrag</code> event type by selecting <strong class="userinput"><code>Add New Event Type | EndDrag</code></strong>. It will automatically assign the <code class="literal">Drag()</code> function from the <code class="literal">DragAndDrop</code> script to this event, since that was the last selected function:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/10fb3f67-1845-4f35-88d8-f94a7a2cde38.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="23" type="1"><li>Replace the <code class="literal">Drag()</code> function in the function dropdown with the <code class="literal">StopDrag()</code> function:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/84d452b3-7899-40b6-aedf-737195206cd3.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="24" type="1"><li>Play the game, and you will see that the orange can now be dragged out of its slot and when you release the mouse, it is destroyed.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="25" type="1"><li>Go back to the <code class="literal">DragAndDrop</code> script and create a new function called <code class="literal">Drop()</code>, as shown:</li></ol></div><pre class="programlisting">public void Drop(Image dropSlot){
     GameObject droppedItem=dragCanvas.transform.GetChild(0).gameObject;
     dropSlot.sprite=droppedItem.GetComponent&lt;Image&gt;().sprite;
}</pre><p>This function accepts an <code class="literal">Image</code> as a parameter. This <code class="literal">Image</code> will be the Image component of the slot that will receive a drop. The first line of the function finds the first child of the <code class="literal">dragCanvas</code> (at position <code class="literal">0</code>) and then assigns its image to the sprite of the <code class="literal">dropSlot</code>. Since we have set up the <code class="literal">StopDrag()</code> functions to destroy the objects being dragged once they stop dragging, we don't have to worry about there being more than one child of the <code class="literal">Drag Canvas</code>, making this the easiest way to find the object being dragged.</p><div class="orderedlist"><ol class="orderedlist arabic" start="26" type="1"><li>Go back to the Editor and select the second <code class="literal">Food</code> Image in the <code class="literal">Bottom Right Panel</code>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/a11002b7-dc57-4b00-995d-e727f2b7a9c5.png" /></div><p>We're using the second <code class="literal">Food</code> Image, rather than the first, because the first already has an image of an orange in it, and it will be hard to tell that our script worked in that slot.</p><div class="orderedlist"><ol class="orderedlist arabic" start="27" type="1"><li>Add a new <strong class="userinput"><code>Event Trigger</code></strong> component to the <code class="literal">Food</code> Image by selecting <strong class="userinput"><code>Add Component</code></strong> | <strong class="userinput"><code>Event</code></strong> | <strong class="userinput"><code>Event Trigger</code></strong> within its Inspector.</li><li>Add a <code class="literal">Drop</code> event type to the <strong class="userinput"><code>Event Trigger</code></strong> component by selecting <strong class="userinput"><code>Add New Event Type</code></strong> | <strong class="userinput"><code>Drop</code></strong>:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/c8442982-cd01-4fbe-b77b-49fd9055de6b.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="29" type="1"><li>Add a new action to the list with the plus sign:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/f8d187b3-37a9-4f5a-a910-7921f6f493b4.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="30" type="1"><li>Drag <code class="literal">Main Camera</code> to the object slot and select the <code class="literal">Drop()</code> function from the <code class="literal">DragAndDrop</code> script:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/3b6ecc8c-46ff-4dcc-b489-be0b2a4f68c5.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="31" type="1"><li>Now, drag the <code class="literal">Food</code> Image that this <strong class="userinput"><code>Event Trigger</code></strong> component is attached to in to the parameter slot:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/c9e9f2bc-04e1-48fb-88d2-464bf3f819cc.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="32" type="1"><li>Play the game and when you drag the orange into the slot over the banana, the <code class="literal">Drop()</code> function doesn't appear to trigger. This is because the orange being dragged is blocking the raycasting from reaching the banana, so the banana never thinks anything is dropped on it. This is an easy fix. Add the following line of code to the end of the <code class="literal">StartDrag()</code> function in the <code class="literal">DragAndDrop</code> script so that the raycast won't be blocked by the orange anymore:</li></ol></div><pre class="programlisting">dragItem.GetComponent&lt;Image&gt;().raycastTarget=false;</pre><div class="orderedlist"><ol class="orderedlist arabic" start="33" type="1"><li>Play the game, and you should now be able to drag the orange from the first slot of the <code class="literal">Inventory Panel</code> to the second slot of <code class="literal">Bottom Right Panel</code>.</li><li>The functionality of drag and drop is now complete; we just need to add the functionality to the other slots. Let's add the drag events to the other <code class="literal">Inventory Panel</code> items first.</li><li>Copy the <strong class="userinput"><code>Event Trigger</code></strong> component of the <code class="literal">Food</code> Item in the <code class="literal">Inventory Panel</code> that we hook the events up to:</li></ol></div><div class="mediaobject"><img src="/graphics/9781787125520/graphics/67db469c-1bd5-4dfa-bf09-553d0791d743.png" /></div><div class="orderedlist"><ol class="orderedlist arabic" start="36" type="1"><li>Select all the other <code class="literal">Food</code> Images in the <code class="literal">Inventory Panel</code> by clicking on them while holding <span class="emphasis"><em>Ctrl</em></span>.</li><li>Now, with all eight <code class="literal">Food</code> Images still selected, click on the settings cog on the Image component and select <strong class="userinput"><code>Paste Component as New</code></strong>. Each of the <code class="literal">Food</code> Images should now have the <strong class="userinput"><code>Event Trigger</code></strong> component with all the appropriate events.</li><li>We're not done with these other inventory items yet. We need to select each one and drag it into the parameter of the <code class="literal">BeginDrag</code> event type. Otherwise, each of these other eight food items will drag out oranges instead of the appropriate food item.</li><li>Before continuing, play the game and ensure that each inventory item in <code class="literal">Inventory Panel</code> drags out the appropriate image.</li><li>Now we will copy the drop events from the second <code class="literal">Food</code> Image in the <code class="literal">Bottom Right Panel</code> to all the other <code class="literal">Food</code> Images within the Panel. Copy the <strong class="userinput"><code>Event Trigger</code></strong> component from the second <code class="literal">Food</code> Image in the <code class="literal">Bottom Right Panel</code>.</li></ol></div><div class="orderedlist"><ol class="orderedlist arabic" start="41" type="1"><li>Select the other four <code class="literal">Food</code> Images in the <code class="literal">Bottom Right Panel</code> while holding down <span class="emphasis"><em>Ctrl</em></span>.</li><li>With each of the <code class="literal">Food</code> Images shown in the preceding screenshot still selected, paste the component as new in the inspector.</li><li>Now, select each of the new <code class="literal">Food</code> Image and assign each to the parameter slot within their <strong class="userinput"><code>Event Trigger</code></strong> component.</li><li>Play the game and ensure that the correct image slot is changed when a food item is dropped to it.</li><li>Now that the drag and drop code is done, re-enable the <code class="literal">ShowHidePanels</code> script on the <code class="literal">Main Camera</code> and <code class="literal">Pause Panel</code>.</li></ol></div><p>That's it for the drag and drop code. Currently, the <code class="literal">Pause Panel</code> blocks the raycast on the items within the <code class="literal">Inventory Panel</code>, so you don't have to <span>worry</span><a id="id325336330" class="indexterm"></a> about disabling these events when the game is paused. However, if you end up changing the layout, you will want to do so by checking whether the <code class="literal">pauseUp</code>variable is <code class="literal">false</code> before <span>performing</span><a id="id325336345" class="indexterm"></a> the tasks. You can do that by wrapping the code within each of the functions of the <code class="literal">DragAndDrop</code> script with the following <code class="literal">if</code> statement:</p><pre class="programlisting">if(GetComponent&lt;ShowHidePanels&gt;().pauseUp==false){}</pre><p>The provided example project has this change implemented in the each of the functions for reference.</p><p>If you want to allow the objects to go back and forth (drag from both panels and drop in both panels), all you have to do is copy the appropriate component to the opposite panels!</p><p>There're so many more examples I would love to cover in this chapter, but I can't make this chapter take up the entire page count of the book! You'll see more examples of using the <strong class="userinput"><code>Event System</code></strong> in the upcoming chapters, so don't worry, this isn't the last code example you will see.</p></div></div>