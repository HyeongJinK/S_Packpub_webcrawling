<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch09lvl1sec40"></a>Starting the scene</h2></div></div><hr /></div><p>The scene that we will be working with in this chapter is located in the <code class="literal">PACKT_Scenes</code> file in the project:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Scenes</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">Chapter9_Start</code> Unity scene file.</p></li><li><p>Double-click on the file to open the scene in the editor:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_09_001.jpg" /><div class="caption">Initial scene setup</div></div><p>
</p></li></ol></div><p>In this scene, our astronaut fights the alien that wiped out the research team on the planet. The action takes place in the spacecraft's loading dock.</p><p>The scene uses standard shader materials.</p><p>In the next step, we will build the scene to test it on a device.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch09lvl2sec45"></a>Building the scene for a device</h3></div></div></div><p>We will go through the steps to create a build for Android and iOS devices.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec22"></a>Building for Android</h4></div></div></div><p>There are just a few steps to create the Android APK:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Make sure that <span class="strong"><strong>Android SDK</strong></span> and <span class="strong"><strong>Java SDK</strong></span> are installed and updated to the latest versions.</p></li><li><p>Open the <span class="strong"><strong>Build Settings</strong></span> window by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build Settings</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Add Open Scenes</strong></span> button at the top half of the window.</p></li><li><p>
<code class="literal">Chapter9_Start</code> should now appear in the list.</p></li><li><p>In the <span class="strong"><strong>Platform</strong></span> list, click on <span class="strong"><strong>Android</strong></span>.</p><p>It should be highlighted as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_09_002.jpg" /><div class="caption">Build Settings for Android device</div></div><p>
</p></li><li><p>Click on the <span class="strong"><strong>Switch Platform</strong></span> button.</p></li><li><p>The device should be connected with a USB cable and have <span class="strong"><strong>USB Debugging</strong></span> switched on in the <span class="strong"><strong>Advanced Settings</strong></span> or <span class="strong"><strong>Developer Settings</strong></span> on the device.</p></li><li><p>Click on the <span class="strong"><strong>Build</strong></span> button to output the game build.</p><p>After running for a short period, a dialog will appear asking you to specify the Android SDK root folder location.</p></li><li><p>Navigate to the Android SDK root folder and click on the <span class="strong"><strong>OK</strong></span> button to continue the build.</p><p>The build will finish and the designated build folder will pop up on your desktop.</p></li><li><p>Create a name for the APK file and click on <span class="strong"><strong>Save</strong></span>.</p><p>The build will be written to the connected device. It will automatically run on the device and look similar to the following illustration:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_09_003.jpg" /><div class="caption">Android build screenshot</div></div><p>
</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec23"></a>Building for iOS</h4></div></div></div><p>We have a few steps to follow to build for iOS:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Firstly, you need to set up your Apple developer account.</p><p>This process is documented on Apple's developer portal.</p></li><li><p>Ensure that you have the most recent <span class="strong"><strong>XCode</strong></span> version installed on your machine.</p></li><li><p>Connect your build device to your machine with a USB cable.</p></li><li><p>In Unity, open the <span class="strong"><strong>Build Settings</strong></span> window to target the correct platform by navigating to <span class="strong"><strong>File</strong></span> | <span class="strong"><strong>Build Settings</strong></span>.</p></li><li><p>Choose <span class="strong"><strong>iOS</strong></span> from the <span class="strong"><strong>Platform</strong></span> list.</p><p>The window should appear as follows:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_09_004.jpg" /><div class="caption">iOS Build Settings dialog</div></div><p>
</p></li><li><p>Click on the <span class="strong"><strong>Player Settings...</strong></span> button.</p><p>The <span class="strong"><strong>Player Settings...</strong></span> will appear in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Set the <span class="strong"><strong>Bundle Identifier</strong></span> to the correct ID.</p><p>It should begin with <code class="literal">com</code>, followed by your developer ID, and should terminate in the product name specified in your developer account.</p></li><li><p>Back in the <span class="strong"><strong>Build Settings</strong></span> window, click on the <span class="strong"><strong>Build and Run</strong></span> button to initiate the build.</p><p>If the build compiles correctly, you should have a new application available on your test device. It will automatically run and look similar to the following illustration:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_09_005.jpg" /><div class="caption">iOS build screenshot</div></div><p>
</p></li></ol></div><p>We can usually see if the game is struggling on the device when we test it. When this happens, we can get descriptive information in <span class="strong"><strong>Profiler</strong></span> about what is making the game lag.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch09lvl3sec24"></a>Viewing the frame rate in the Profiler</h4></div></div></div><p>To view the Profiler information in the editor, we need to perform the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Make sure that the device and the build computer are connected to the same Wi-Fi network.</p></li><li><p>Check the <span class="strong"><strong>Development Build</strong></span> checkbox in the <span class="strong"><strong>Build Settings</strong></span> window.</p></li><li><p>Check the <span class="strong"><strong>Autoconnect Profiler</strong></span> checkbox when this becomes active.</p></li><li><p>Click the <span class="strong"><strong>Build and Run</strong></span> button.</p></li></ol></div><p>When the build is complete, it should run on the connected device. The <span class="strong"><strong>Profiler</strong></span> window will appear over the main Unity interface, displaying a graph of the game's performance per frame in milliseconds.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip37"></a>Tip</h3><p>If the <span class="strong"><strong>Profiler</strong></span> does not automatically display the connected device, you can select the device from the list using the <span class="strong"><strong>Active Profiler</strong></span> tab in the <span class="strong"><strong>Profiler</strong></span> window:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_09_006.jpg" /><div class="caption">Initial Profiler graph for a connected Android device</div></div><p>
</p></div><p>There is a separate graph for the <span class="strong"><strong>CPU</strong></span> and other processes.</p><p>These are further color-coded in different categories, such as <span class="strong"><strong>Rendering</strong></span>, <span class="strong"><strong>Scripts</strong></span>, and <span class="strong"><strong>Physics</strong></span>, which affect the performance.</p><p>We can see that majority of the processing is taken up by the rendering, displayed here in green.</p><p>Typically, we want to keep the frame rate above 30 frames per second to keep the game playing smooth on the device.</p><p>If you move the character around the space, you will see noticeable spikes in the frame rate.</p><p>In the next section, we will attempt to improve the frame rate by replacing some of the more complex shaders with a reduced mobile shader.</p></div></div></div>