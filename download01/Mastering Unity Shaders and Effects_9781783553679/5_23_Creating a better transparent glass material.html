<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec24"></a>Creating a better transparent glass material</h2></div></div><hr /></div><p>In <a class="link" href="#" linkend="ch02">Chapter 2</a>, <span class="emphasis"><em>Creating Custom Shaders</em></span>, we set the default shader code for the helmet shader to transparent, rather than opaque, and created an additional pass to separate the front and back surfaces and create more realistic specularity from inside the helmet rather than just the outside.</p><p>Let's focus on the astronaut in the scene to take a closer look at the helmet surface:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, locate the astronaut game object.</p></li><li><p>Click on the small arrow next to its name to expand its <span class="strong"><strong>Hierarchy</strong></span>.</p></li><li><p>Double-click on the <code class="literal">helmet</code> game object to focus on it in the <span class="strong"><strong>Scene</strong></span> view:</p></li></ol></div><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_05_009.jpg" /><div class="caption">Initial astronaut helmet glass</div></div><p>
</p><p>Now that we have worked with some different transparent shader types, let's take this shader to the next level:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Shaders</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">Glass</code> shader and double-click on it to open it in MonoDevelop.</p><p>At the top of the shader is the <code class="literal">Tags</code> line of <code class="literal">subShader</code>:</p><pre class="programlisting">        Tags { "RenderType"="Opaque"} &#13;
</pre><p>This line defines how Unity will treat the shader. The default value is <code class="literal">Opaque</code>, but we can also use <code class="literal">Transparent</code>, though this is used for shader replacement and some camera-depth functions, rather than actually affecting the material's appearance in the game.</p></li><li><p>Before the <code class="literal">Tags</code> closing curly bracket, add the following code:</p><pre class="programlisting">        "Queue" = "Transparent" &#13;
</pre></li></ol></div><p>The <span class="strong"><strong>Render Queue</strong></span> defines when the pixels associated with a shader will be rendered. By default, Unity will render all the pixels at the same time, but with transparent objects, this means that opaque objects behind them will cull them.</p><p>We typically want to render transparent pixels after opaque pixels so that they appear to be transparent, and that is what Unity does in this case.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note31"></a>Note</h3><p>
<span class="strong"><strong>Background</strong></span>: Pixels using shaders marked with this queue tag are rendered before all others. This is used for skyboxes and other environmental features.</p><p><span class="strong"><strong>Geometry</strong></span>: This is the default queue tag and is mainly used for solid objects.</p><p><span class="strong"><strong>AlphaTest</strong></span>: Objects with <span class="strong"><strong>Cutout</strong></span> transparency use this tag.</p><p><span class="strong"><strong>Transparent</strong></span>: This is used for true transparent surfaces and some particle effects.</p><p><span class="strong"><strong>Overlay</strong></span>: This queue tag is used for some camera and lighting effects.</p></div><p>In addition to these built in <span class="strong"><strong>Render Queue</strong></span> tags, we can also fine tune shaders by giving them additional numbers, such as <code class="literal">Geometry+1</code>.</p><p>Next, we will start by adding some tiny surface scratches on the helmet glass with a normal map. This will make the helmet reflection less perfect:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>At the end of the <span class="strong"><strong>Properties</strong></span> block, add the following line of code:</p><pre class="programlisting">        _BumpMap ("Normalmap", 2D) = "bump" {} &#13;
</pre><p>This will handle the normal map input.</p><p>We also need to set up the shader variable to use the map in Cg.</p></li><li><p>Locate the <code class="literal">sampler2D _MainTex</code> line.</p></li><li><p>Add the following line of code just under it:</p><pre class="programlisting">        sampler2D _BumpMap; &#13;
</pre></li><li><p>Scroll down to the <code class="literal">surf</code> function, still in the same pass, and add the following line:</p><pre class="programlisting">        o.Normal = UnpackNormal (tex2D(_BumpMap, IN.uv_MainTex)); &#13;
</pre><p>We can omit this code from the back face pass. It would look odd for identical scratches to be on the inner surface of the glass.</p></li><li><p>Save the shader.</p></li><li><p>Minimize MonoDevelop and return to the main Unity interface.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Textures</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">astronaut_helmet_normal</code> texture asset.</p></li><li><p>Drag this to the <span class="strong"><strong>Normal Map</strong></span> slot in the <code class="literal">Helmet</code> material that is now visible in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_05_010.jpg" /><div class="caption">Normal mapped helmet effect</div></div><p>
</p></li></ol></div><p>The helmet's normal map gives the appearance of a more realistic surface and reduces the uniformity of the reflection.</p><p>In the next section, we will create a more dramatic weather effect for the planet surface scene.</p></div>