<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec13"></a>Improving the planet's atmosphere</h2></div></div><hr /></div><p>In the first chapter, we added materials to the spacecraft repair scene using Unity's Standard Shaders. We also created a <span class="strong"><strong>Standard Specular</strong></span> material for the planet Ridley VI to show its dramatic stormy environment.</p><p>At this point, we will write a custom shader to give it more of an atmospheric effect.</p><p>Rather than reflecting light in the same way as other solid objects, the layers of gas that surround many planets create a haze around them.</p><p>We will create something like this with a custom shader.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec17"></a>Creating the custom planet shader</h3></div></div></div><p>We will start by creating another shader in the Unity project:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Shaders</code> folder.</p><p>The folder's contents will become visible in the <span class="strong"><strong>Assets</strong></span> panel.</p><p>The folder currently contains the finalized code that you may use for reference.</p></li><li><p>Create a new shader by right-clicking on an empty area of the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Shader</strong></span> | <span class="strong"><strong>Standard Surface Shader</strong></span>.</p></li><li><p>Rename the shader <code class="literal">Planet</code>.</p></li></ol></div><p>As we demonstrated previously, the name of the shader asset is different from its name that will appear in the shader list, we will define this next in the code.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec18"></a>Applying the planet shader</h3></div></div></div><p>We will continue by changing the shader's name and setting it up in a material in the scene so that we can view the changes that we make:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Double-click on the shader to open it in MonoDevelop.</p></li><li><p>Replace the first line of code with the following:</p><pre class="programlisting">        Shader "PACKT/Planet_falloff" { &#13;
</pre><p>This will make it easy to locate our shader when we select it in the material.</p></li><li><p>Save the code using the <span class="emphasis"><em>
<span class="strong"><strong>Ctrl</strong></span>
</em></span> + <span class="emphasis"><em>
<span class="strong"><strong>S</strong></span>
</em></span> shortcut (or <span class="emphasis"><em>
<span class="strong"><strong>command</strong></span>
</em></span> + <span class="emphasis"><em>
<span class="strong"><strong>S</strong></span>
</em></span> if you are working on a Mac).</p></li><li><p>Minimize MonoDevelop and return to the main Unity interface.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, select the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li></ol></div><p>Next, we will create a new material. This will allow us to switch between the original planet material and the new custom material to compare their appearances:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Right-click on an empty area of the <span class="strong"><strong>Assets</strong></span> panel and choose <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Material</strong></span>.</p></li><li><p>Rename the new material <code class="literal">Planet_falloff</code>.</p></li><li><p>Click on the new material to select it.</p><p>When <code class="literal">Planet_falloff</code> properties appear in the <span class="strong"><strong>Inspector</strong></span>, click on the drop-down list next to <span class="strong"><strong>Shader</strong></span>.</p></li><li><p>Select <span class="strong"><strong>PACKT</strong></span> | <span class="strong"><strong>Planet_falloff</strong></span> to choose the shader that we just created.</p><p>The new material has a color, single texture slot for the main texture, and sliders that define <span class="strong"><strong>Smoothness</strong></span> and <span class="strong"><strong>Metallic</strong></span> values.</p></li><li><p>Drag the <code class="literal">Planet_falloff</code> material to the <code class="literal">ridleyVI</code> game object in the <span class="strong"><strong>Scene</strong></span> view to apply it.</p></li></ol></div><p>You should see the planet change to the default gray color in the scene:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_013.jpg" /><div class="caption">The planet material replaced in the scene</div></div><p>
</p><p>Now that we are using the new shader in the scene, we need to make some real changes to it.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec19"></a>Editing the planet shader</h3></div></div></div><p>We will start by stripping out the elements that we do not need:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Maximize MonoDevelop.</p></li><li><p>In the <code class="literal">Properties</code> block of the shader, delete the <code class="literal">_Glossiness</code> and <code class="literal">_Metallic</code> property lines.</p></li><li><p>Scroll down until you see the variable definitions for these properties:</p><pre class="programlisting">        half _Glossiness; &#13;
        half _Metallic; &#13;
</pre></li><li><p>Delete these lines.</p></li><li><p>Scroll down until you see the <code class="literal">surf</code> function that defines the shader output.</p></li><li><p>Delete the lines that define the <code class="literal">Glossiness</code> and <code class="literal">Metallic</code> output values.</p></li></ol></div><p>Our shader does not need metallic or smoothness qualities. We will add new properties in the next section.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec6"></a>Adding new properties to the planet shader</h4></div></div></div><p>The new properties that we add will allow us to define the depth, color, and opacity of the planet's atmosphere.</p><p>Add the following lines to the shader's <code class="literal">Properties</code> block:</p><pre class="programlisting">_Thickness ("Thickness", Range(-1,1)) = 0.5 &#13;
_AtmosColor (" Atmosphere Color", Color) = (1,1,1,1) &#13;
</pre><p>In the shader, <code class="literal">_Thickness</code> will define the depth of the atmosphere. The <code class="literal">_AtmosColor</code> property will be used to differentiate the atmosphere from the actual planet surface.</p><p>Like the helmet shader, the planet shader will use an additional pass to render the back faces.</p><p>In this case, we will render the back faces outside the original sphere to simulate the atmospheric effect.
</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec7"></a>Adding the atmosphere shader pass</h4></div></div></div><p>We will add the new pass to the shader under the original shader code:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Scroll to end of the shader's Cg snippet:</p><pre class="programlisting">        ENDCG &#13;
</pre></li><li><p>Directly after this, add the following code:</p><pre class="programlisting">        Cull Front &#13;
        CGPROGRAM &#13;
        #pragma surface surf Standard fullforwardshadows alpha vertex:vert &#13;
        struct Input { &#13;
            float2 uv_MainTex; &#13;
        }; &#13;
        float _Thickness; &#13;
        void vert (inout appdata_full v) { &#13;
            v.vertex.xyz += v.normal * _Thickness; &#13;
        } &#13;
        fixed4 _AtmosColor; &#13;
         &#13;
        void surf (Input IN, inout SurfaceOutputStandard o) { &#13;
            o.Albedo = _AtmosColor.rgb; &#13;
            o.Alpha = _AtmosColor.a;  &#13;
        } &#13;
        ENDCG &#13;
</pre><p>Here we define the second pass. We will use a vertex function to extrude the geometry like we did with the helmet.</p><p>This time, the shader does not use specular or smoothness qualities, but we will define a secondary color that is used to define the atmosphere.</p><p>We will also use the alpha channel of this color to set the opacity of the atmosphere.</p></li><li><p>Save the script.</p></li><li><p>Minimize MonoDevelop.</p></li><li><p>Back in the main Unity interface, select the <code class="literal">ridleyVI</code> game object in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li></ol></div><p>Next, we need to set the new material inputs in the <span class="strong"><strong>Inspector</strong></span>.
</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec1"></a>Setting the planet material inputs</h5></div></div></div><p>The new shader defines a bitmap albedo texture as well as a number of numerical values in the planet material:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Textures</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, locate the <code class="literal">planet001</code> texture.</p></li><li><p>Drag this onto the <span class="strong"><strong>Albedo RGB</strong></span> map slot in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Further down in the <span class="strong"><strong>Inspector</strong></span>, set the <span class="strong"><strong>Thickness</strong></span> value to <code class="literal">0.06</code> to define the extent of the atmosphere.</p></li><li><p>Click on the <span class="strong"><strong>Atmosphere Color</strong></span> swatch and define a slightly bluish color.</p></li><li><p>Set the alpha channel to <code class="literal">128</code>, or 50% of its range, on the slider.</p></li><li><p>Exit the color selection window by clicking on the <span class="strong"><strong>X</strong></span> in the right-hand top corner:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_014.jpg" /></div><p>
</p></li></ol></div><p>Viewing the planet in the <span class="strong"><strong>Scene</strong></span> view at this point will allow you to see the atmosphere effect that we added with the shader:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_015.jpg" /><div class="caption">The completed planet shader effect</div></div><p>
</p><p>The planet now has an atmospheric quality that can be further adjusted in the <span class="strong"><strong>Inspector</strong></span>. We have control over the color, thickness, and opacity.</p></div></div></div></div>