<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec20"></a>Animating the control panel illumination</h2></div></div><hr /></div><p>The control panel shader was set up with an emissive material to simulate the glowing controls. In this step, we will animate the effect to simulate the conditional changes as the ship enters the atmosphere.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Click on the <code class="literal">interface01</code> material to view its properties in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_005.jpg" /></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note27"></a>Note</h3><p>The material uses the default Standard Shader set up with emissive properties.</p><p>We can change the texture used by the material using a little code, we just need to know the name of the property that uses the texture in the shader.</p><p>The property names enclosed in quotation marks are exposed in the <span class="strong"><strong>Inspector</strong></span> when the shader is used in a material. This is distinct from the property name used in the shader that we will need to know to change the texture that it uses.</p><p>When you are working with a shader that you have not written yourself, you can find the property name by selecting the shader.</p></div></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">interface_quad</code> game object.</p><p>Its components will become visible in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Then scroll down to the object's <span class="strong"><strong>Material</strong></span> component.</p></li><li><p>Click on the gear icon on the right-hand top corner of the component block.</p></li><li><p>Choose <span class="strong"><strong>Edit Shader</strong></span> from the dropdown list.</p><p>The shader source will be selected and the property names will become visible in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_006.jpg" /></div><p>
</p><p>We can see that the shader property that handles the emissive map is named <code class="literal">_MainTex</code>, which is the standard name used for the albedo texture.</p><p>This is the property that we need to access in the script to animate the effect.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Scripts</code> folder.</p></li><li><p>When its contents appear in the <span class="strong"><strong>Assets</strong></span> panel, create a new C# script by right-clicking and choosing <span class="strong"><strong>Create</strong></span>. Then, select <span class="strong"><strong>C# Script</strong></span>.</p></li><li><p>Rename the script <code class="literal">controlTwinkle</code>.</p></li><li><p>Double-click on the <code class="literal">controlTwinkle</code> asset to open it in MonoDevelop.</p></li><li><p>Directly after the script's opening brackets, add the following code:</p><pre class="programlisting">        public bool switched;&#13;
        public float frequency = 0.2f;&#13;
        public Texture2D origAlbedo;&#13;
        public Texture2D newAlbedo;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note28"></a>Note</h3><p>Here, we are defining the variables that will be used in the control script.</p><p>The <code class="literal">switched</code> variable is a <span class="strong"><strong>Boolean</strong></span>: a simple on/off switch that we can use to switch between the two textures used in the material.</p><p>The <code class="literal">frequency</code> value is a <span class="strong"><strong>float</strong></span>, or decimal number that will define how long the state lasts for. These first two variables do not strictly need to be public, but it is sometimes useful to see the Boolean go on and off and to tweak values at runtime in order to fine tune the script rather than hard coding everything.</p><p>The next two variables store the references to the textures that we will switch between during the runtime. These need to be public variables so that we can drag the textures into the scripts' slots to define them.</p></div></li><li><p>Next, we will replace the default definition of the <code class="literal">Start</code> function with the following code:</p><pre class="programlisting">        void Start ()  &#13;
        { &#13;
            InvokeRepeating ("Switch", frequency, frequency); &#13;
        } &#13;
</pre><p>Here, we will use the <code class="literal">InvokeRepeating</code> method, which runs a separate function periodically based on a duration value and an interval value. We are setting these to be the same using our frequency variable that we just defined.</p></li><li><p>At the end of the script, but before the closing bracket, add the following code:</p><pre class="programlisting">        void Switch () &#13;
        { &#13;
            switched = !switched; &#13;
        } &#13;
</pre><p>Here, we will define the <code class="literal">Switch</code> function that is run by the <code class="literal">InvokeRepeating</code> line in <code class="literal">Start</code>.</p><p>The content of the function is extremely simple. It reverses the state of the <code class="literal">switched</code> Boolean. If <code class="literal">switched</code> is true, it is set to false and vice versa.</p><p>Now that we got the switch working, we need to define what happens when the Boolean is true and when it is false.</p></li><li><p>Replace the default <code class="literal">Update</code> function with the following code:</p><pre class="programlisting">        void Update ()  &#13;
        { &#13;
            if(switched) &#13;
            {&#13;
                GetComponent&lt;Renderer&gt;().material.SetTexture(&#13;
                  "_MainTex", newAlbedo);&#13;
            } &#13;
            else &#13;
            {&#13;
                GetComponent&lt;Renderer&gt;().material.SetTexture(&#13;
                  "_MainTex", origAlbedo);&#13;
            } &#13;
        } &#13;
</pre><p>Here, we will define the consequences of the two states of the <code class="literal">switched</code> Boolean.</p><p>In the first case, we will access the object's <span class="strong"><strong>Renderer</strong></span> using the <code class="literal">GetComponent</code> method. Within this, we will set the texture of <code class="literal">_EmissionMap</code> to <code class="literal">newEmit</code>, which are the first of the two textures defined in the script.</p><p>When <code class="literal">switched</code> is false, we set the texture to <code class="literal">origAlbedo</code> to use the second texture.</p></li><li><p>Save the script.</p></li><li><p>Minimize MonoDevelop and return to the main Unity interface.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, reselect the <code class="literal">interface_quad</code> object.</p></li><li><p>Drag the <code class="literal">controlTwinkle</code> script into the <span class="strong"><strong>Inspector</strong></span> to add it to the object as a component.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, select the <code class="literal">PACKT_Textures</code> folder.</p></li><li><p>Locate <code class="literal">interface01</code> and drag it into the<code class="literal"> Orig Albedo</code> texture slot in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Locate <code class="literal">interface02</code> and drag it into the <code class="literal">New Albedo</code> texture slot.</p></li><li><p>At the center of the top of the Unity interface, press the play button to see the effect:</p></li></ol></div><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_007.jpg" /></div><p>
</p><p>During the play mode, the emissive texture in the <code class="literal">controlPanel</code> material quickly alternates between the two defined textures.</p><p>Next, we will animate the text readout display by accessing the shader's UV values.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec25"></a>Animating UV coordinates</h3></div></div></div><p>In this scene, the illuminated display has been split up so that it can be animated. We want the text readout to scroll down in a constant loop. We can do this by accessing the shader's UV coordinates and animating them:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">textDisplay</code> object.</p></li><li><p>When its properties appear in the <span class="strong"><strong>Inspector</strong></span>, check the checkbox next to its name at the top of the panel to activate it.</p><p>The game object uses a Standard Shader material with emissive values already set up.</p><p>As we are animating the UV values here, we can use Unity's native animation tools rather than using a script.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Scripts</code> folder.</p><p>The folder's contents will appear in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In an empty area of the panel, create a new C# script by right-clicking.</p></li><li><p>Click on <span class="strong"><strong>Create</strong></span> and then choose <span class="strong"><strong>C# Script</strong></span> from the drop-down list.</p></li><li><p>Rename the script <code class="literal">textAnim</code>.</p></li><li><p>Double-click on the new script in the <span class="strong"><strong>Assets</strong></span> panel to open it in MonoDevelop.</p><p>We can keep this code simple; all we need to do is access the shader's vertical UV coordinate and increase it with time.</p></li><li><p>When the script opens in MonoDevelop, delete the default <code class="literal">Start</code> and <code class="literal">Update</code> functions.</p></li><li><p>Add the following lines inside the script's curly brackets:</p><pre class="programlisting">        Vector2 uvOffset = Vector2.zero; &#13;
        public Vector2 uvAnimSpeed = new Vector2( 0.0f, 0.1f ); &#13;
</pre><p>Both the lines of code define new <code class="literal">Vector2</code> variables. We set the first to <code class="literal">zero</code>.</p><p>By typing <code class="literal">public</code> in front of the second variable, we expose it in the Inspector so that it can be adjusted. We set the second value of <code class="literal">uvAnimSpeed</code> to <code class="literal">0.1</code> to start.</p></li><li><p>Under the variables, add the following code:</p><pre class="programlisting">        void LateUpdate ()  &#13;
        { &#13;
            uvOffset += (uvAnimSpeed * Time.deltaTime);&#13;
            GetComponent&lt;Renderer&gt;().material.SetTextureOffset(&#13;
              "_MainTex", uvOffset );&#13;
        } &#13;
</pre><p>The only function we use in our script is <code class="literal">LateUpdate</code>, which runs every frame. Within the function, we will increase the values of our <code class="literal">uvOffset</code> variable using <code class="literal">uvAnimSpeed</code> multiplied by time in seconds.</p><p>We then use the <code class="literal">GetComponent</code> method to access the <code class="literal">Renderer</code> attached to the same object as the script. We set the texture offset of <code class="literal">_MainTex</code> using the <code class="literal">uvOffset</code>
<code class="literal">Vector2</code> variable as the value.</p></li><li><p>Save the script.</p></li><li><p>Add the <code class="literal">textAnim</code> script to the game object by dragging it from the <span class="strong"><strong>Assets </strong></span>panel onto <code class="literal">textDisplay</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>Press the play button at the center of the top of the main Unity interface to see the <code class="literal">textdisplay</code> scroll:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_008.jpg" /></div><p>
</p></li></ol></div><p>In the next step, we will animate the planet projection display.</p></div></div>