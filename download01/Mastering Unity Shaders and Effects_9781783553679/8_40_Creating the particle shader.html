<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch08lvl1sec38"></a>Creating the particle shader</h2></div></div><hr /></div><p>In Unity particle systems use a unique kind of shader. We will create this next:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Shaders</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In an empty area of the <span class="strong"><strong>Assets</strong></span> panel, create a new shader. Right-click and choose <span class="strong"><strong>Shader</strong></span> | <span class="strong"><strong>Unlit Shader</strong></span>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip36"></a>Tip</h3><p>Unlit shaders do not respond to scene lighting. This makes them a great choice for particle effects that tend to use billboard textures rather than being actual geometry.</p></div></li><li><p>Rename the new shader <code class="literal">flameJet</code>.</p></li><li><p>Double-click on the shader to open it in <span class="strong"><strong>MonoDevelop</strong></span>.</p></li><li><p>In MonoDevelop, change the first line of the shader to match the following:</p><pre class="programlisting">        Shader "PACKT/Unlit/flameJet" &#13;
</pre><p>Putting this shader in an <code class="literal">Unlit</code> subfolder will make it easy to select when it is used again in the project.</p></li></ol></div><p>Let's apply the shader to the particle system and see how it looks straight out of the box:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Minimize MonoDevelop and return to the main Unity interface.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder.</p></li><li><p>When its contents appear in the <span class="strong"><strong>Assets</strong></span> panel, click on the <code class="literal">Flames</code> material.</p><p>The material's properties will appear in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Shader</strong></span> button and navigate to <span class="strong"><strong>PACKT</strong></span> | <span class="strong"><strong>Unlit</strong></span> | <span class="strong"><strong>flameJet</strong></span>.</p><p>The particle system's appearance will change in the <span class="strong"><strong>Scene</strong></span> view.</p></li><li><p>Press the play button in the top center of the Unity interface:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_006.jpg" /><div class="caption">The default unlit shader in the scene</div></div><p>
</p></li></ol></div><p>By default, the unlit shader does not support transparency. It renders the entire quad with the black part of the texture that should be transparent.</p><p>Our next objective is to add transparency to the shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Return to MonoDevelop.</p></li><li><p>Within the <code class="literal">subShader</code>, replace the <code class="literal">Tag</code> line with the following code:</p><pre class="programlisting">        Tags { "RenderType"="Transparent" "Queue" = "Transparent"} &#13;
</pre><p>As we have done earlier, we will set <code class="literal">RenderType</code> to <code class="literal">Transparent</code> in order to allow the shader to remove transparent pixels. We will use the <code class="literal">Transparent</code> queue to make sure that Unity renders the pixels handled by this shader on top of opaque objects.</p></li><li><p>Delete the <code class="literal">LOD</code> line.</p><p>Our particles will be rendered within a confined space, so we don't need to let Unity make a decision about whether to render them.</p></li><li><p>Add the following code:</p><pre class="programlisting">        Blend SrcAlpha One &#13;
        ColorMask RGB &#13;
</pre><p>The <code class="literal">Blend</code> line will blend the particles using the alpha channel in the texture. The <code class="literal">ColorMask</code> line is used to avoid sending the RGB data to the depth buffer, only the alpha channel is necessary.</p></li><li><p>Save the shader.</p></li><li><p>Return to the main Unity interface.</p></li><li><p>Press the play button.</p><p>The particle system will start up. The edges of the particles will now be transparent, as shown in the following image:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_007.jpg" /><div class="caption">Particles with transparent edges</div></div><p>
</p><p>Our flame particle is currently rendering as a white shape, but the edges of each quad appear to cull the particles behind. This is something we need to fix in the shader.</p></li><li><p>Add the following line of code:</p><pre class="programlisting">        ZWrite Off &#13;
</pre><p>By default, geometry in the scene is rendered in a specific order. Objects rendered with a shader marked as transparent are rendered after opaque and cutout geometry, but they are also rendered in depth order in the scene.</p><p>We can override this ordering by switching <code class="literal">ZWrite</code> off, rendering triangles together, and fixing the transparency issue.</p></li><li><p>Save the shader and check the particle simulation to see the improved effect.</p></li></ol></div><p>In the next section, we will define a color.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec42"></a>Adding a color to the particle shader</h3></div></div></div><p>Now that we have the transparency working, we need to add some code to the shader to define a color:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Return to MonoDevelop.</p></li><li><p>In the <code class="literal">Properties</code> block, add the following code:</p><pre class="programlisting">        _Color ("Color", Color) = (1,1,1,1) &#13;
</pre></li><li><p>Within the <code class="literal">appdata</code> struct, add the following line:</p><pre class="programlisting">        fixed4 color : COLOR; &#13;
</pre><p>Here, we will define a low-precision float with four positions to support the standard RGBA channels.</p><p>We need to add an identical variable in the <code class="literal">v2f</code> struct.</p></li><li><p>Locate the <code class="literal">v2f</code> struct and add the same line of code:</p><pre class="programlisting">        fixed4 color : COLOR; &#13;
</pre><p>We will add an equivalent variable to the general Cg code to handle the <code class="literal">_Color</code> input. We will put it with the <code class="literal">_MainTex</code> variable that is included by default.</p></li><li><p>Locate the <code class="literal">_MainTex</code> definition. In the next line, add the following line:</p><pre class="programlisting">        fixed4 _Color; &#13;
</pre></li><li><p>Within the vertex to fragment the <code class="literal">v2f vert</code> structure, add the following line:</p><pre class="programlisting">        o.color = v.color; &#13;
</pre><p>This will define the output color as those associated with the vertices now.</p></li><li><p>Finally, scroll down to the <code class="literal">fixed4 frag</code> definition at the bottom of the shader.</p></li><li><p>Replace the <code class="literal">fixed4 col</code> line with the following line:</p><pre class="programlisting">        fixed4 col = 2.0f * i.color * _Color * tex2D(_MainTex, i.uv); &#13;
</pre><p>Here, we will add the defined <code class="literal">_Color</code> variable to the output color calculation by multiplying it with the <code class="literal">_MainTex</code> color.</p></li><li><p>Save the shader.</p></li><li><p>Return to the main Unity interface.</p></li><li><p>Notice that the <code class="literal">_Color</code> swatch has already been defined as the orange that we previously set. Unity remembers variables in shaders if they use standard naming conventions.</p></li><li><p>Press the play button to see the newly tinted shader:</p></li></ol></div><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_008.jpg" /><div class="caption">Particle shader with color tint</div></div><p>
</p><p>Now that we have added transparency and color to the flame shader, let's add some additional particle effects to the scene.</p><p>We will start by creating some steam leaking from the broken pipes in the corridor.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec43"></a>Adding the steam particle effect</h3></div></div></div><p>We want to add a steam particle effect in the corridor to add some ambience to the scene.</p><p>This time, we will use an animated sprite effect rather than a static particle texture.</p><p>We will start by adding the new particle system:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the main Unity interface, create a particle system by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Particle System</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, rename the particle system <code class="literal">Particle_steam</code>.</p></li><li><p>Use the <span class="strong"><strong>Move</strong></span> and <span class="strong"><strong>Rotate</strong></span> tools to position the system near the end of the broken pipe:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_009.jpg" /><div class="caption">Steam particle added to the scene</div></div><p>
</p></li></ol></div><p>We need to scale down and slow down the particles to make them look more like a steam effect.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec16"></a>Adjusting the steam particle's parameters</h4></div></div></div><p>We will make some adjustments to make the default particle seem more like steam coming out of the pipe:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Inspector</strong></span>, set the particle system's <span class="strong"><strong>Start Speed</strong></span> and <span class="strong"><strong>Start Size</strong></span> to <code class="literal">0.25</code>.</p></li><li><p>Click the <span class="strong"><strong>Emission</strong></span> tab and reduce <span class="strong"><strong>Rate</strong></span> to <code class="literal">5</code>.</p><p>This will slow down the rate at which the particles are emitted.</p></li><li><p>In the<span class="strong"><strong> Shape</strong></span> group, reduce <span class="strong"><strong>Angle</strong></span> to 10 and set <span class="strong"><strong>Radius </strong></span>of the cone to <code class="literal">0.01</code>.</p><p>This will cause the particles to be emitted from a smaller area.</p></li><li><p>Click on the <span class="strong"><strong>Color over Lifetime</strong></span> tab and check the box to enable this function.</p></li><li><p>Click on the rectangular gradient bar to bring up the <span class="strong"><strong>Gradient Editor</strong></span> in a floating window:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_010.jpg" /><div class="caption">The default gradient bar</div></div><p>
</p><p>The default gradient just has a completely opaque white marker at either end. We want to adjust this to let the gradient fade out to soften its transition.</p></li><li><p>Click on the bottom-left marker and define a mid-gray color using the color picker that appears.</p></li><li><p>Enter the value <code class="literal">128</code> into all three of the RGB fields.</p></li><li><p>Define the bottom-right marker using the same color.</p></li><li><p>Along the top of the gradient bar, click to create another marker.</p><p>Markers along the top edge define opacity.</p></li><li><p>Use the fields to set <span class="strong"><strong>Location</strong></span> of the new marker to <code class="literal">75.0</code>, and make sure that <span class="strong"><strong>Alpha</strong></span> is set to <code class="literal">255</code>.</p></li><li><p>Click on the top-right marker and reduce the <span class="strong"><strong>Alpha</strong></span> value to <code class="literal">0.0</code>.</p><p>This will ensure that the particle completely fades out at the end of its lifetime:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_011.jpg" /><div class="caption">The adjusted color by lifetime gradient</div></div><p>
</p><p>Next, we will adjust the particle size.</p></li><li><p>Click on the <span class="strong"><strong>Size over Lifetime</strong></span> tab and check the box to enable this function.</p></li><li><p>Click on the curve bar to open the <span class="strong"><strong>Curve Editor</strong></span>.</p></li><li><p>Define a curve that starts at just below <code class="literal">1.0</code>.</p></li><li><p>Click on the white field near the top of the curve and enter the value <code class="literal">2.0</code> to define the maximum size of the particle:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_012.jpg" /><div class="caption">The adjusted Size over Lifetime curve</div></div><p>
</p></li></ol></div><p>At this point, we will enable the texture sheet animation and complete the particle effect.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec17"></a>Completing the steam particle effect</h4></div></div></div><p>Unlike the flamethrower effect, the steam particle is quite slow. We will get it to look more interesting using the particle system's built-in <span class="strong"><strong>Texture Sheet Animation</strong></span> function:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Click on the <span class="strong"><strong>Texture Sheet Animation</strong></span> tab and click on the checkbox to enable this function:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_013.jpg" /><div class="caption">Texture Sheet Animation default values</div></div><p>
</p><p>The fields in the <span class="strong"><strong>Tiles</strong></span> group allow us to specify the amount of frames in the atlassed texture sheet.</p><p>Our steam particle texture only has three horizontal frames.</p></li><li><p>Enter the value<code class="literal"> 3</code> in the <span class="strong"><strong>X</strong></span> field.</p></li><li><p>Leave the <span class="strong"><strong>Y</strong></span> field at its default value of <code class="literal">1</code>.</p></li></ol></div><p>The <span class="strong"><strong>Frame over Time</strong></span> curve gives us additional control over the timing of the frame transitions.</p><p>We will leave this at its default value.</p><p>The last parameter, <span class="strong"><strong>Cycles</strong></span>, allows us to define how many times the animation sequence occurs over the particle's lifetime.</p><p>We will also leave this parameter at its default setting.</p><p>Our next step is to set up the material and add the texture sheet.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec18"></a>Setting up the steam particle material</h4></div></div></div><p>We need to create a unique material for the steam, as it uses its texture very differently:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, right-click on an empty area and create a new material by choosing <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Material</strong></span>.</p></li><li><p>Rename the new material <code class="literal">SteamParticle</code>.</p><p>We will start with one of Unity's built-in shaders for this material.</p></li><li><p>Click on the <span class="strong"><strong>Shader</strong></span> button at the top of the <span class="strong"><strong>Inspector</strong></span> and choose <span class="strong"><strong>Particles</strong></span> | <span class="strong"><strong>Additive</strong></span> from the drop-down list.</p></li><li><p>Click on the <span class="strong"><strong>Tint Color</strong></span> swatch and define a dull dark green color.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Textures</code> folder to view its contents in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Particles</strong></span> subfolder and drag <code class="literal">steamParticle</code> onto the <span class="strong"><strong>Main Texture</strong></span> slot in the <span class="strong"><strong>Inspector</strong></span>.</p></li></ol></div><p>The content of the texture is white and the background is transparent, so the texture will look white in the preview slot:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_014.jpg" /><div class="caption">The completed SteamParticle material parameters</div></div><p>
</p><p>Let's add this material to our particle system and make the final adjustments:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, click on the <code class="literal">Particle_steam</code> game object to access its components in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, scroll to the bottom of the <span class="strong"><strong>Particle System</strong></span> component and click on the <span class="strong"><strong>Renderer</strong></span> tab.</p></li><li><p>Drag the <code class="literal">SteamParticle</code> material into the <span class="strong"><strong>Material</strong></span> field in the <span class="strong"><strong>Renderer</strong></span> group to replace the <code class="literal">default-particle</code> material.</p></li></ol></div><p>Now that we have added the material, let's see what the particles look like in our scene:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_015.jpg" /><div class="caption">The adjusted steam particles</div></div><p>
</p><p>While the particle system is selected, the particle system will simulate in the <span class="strong"><strong>Scene</strong></span> and <span class="strong"><strong>Game</strong></span> views.</p><p>The particle texture cycles between the three frames, but the effect is a little too uniform.</p><p>We will return to adjust one more value in the particle system:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Inspector</strong></span>, click on the <span class="strong"><strong>Rotation over Lifetime</strong></span> tab within the <span class="strong"><strong>Particle System</strong></span> component.</p></li><li><p>Check the box to enable this function.</p></li><li><p>Click on the small arrow next to the <span class="strong"><strong>Angular Velocity</strong></span> value and choose <span class="strong"><strong>Random Between Two Constants </strong></span>from the drop-down selection list.</p><p>We want each of the particles to rotate independently to create a more organic looking effect.</p></li><li><p>Leave the <span class="strong"><strong>Separate Axes</strong></span> checkbox unchecked.</p><p>We are still using billboard particles here that need to face the camera for the effect to be convincing.</p></li><li><p>Leave the <span class="strong"><strong>Angular Velocity</strong></span> values at 0 and <code class="literal">45</code>.</p><p>These default values should be adequate.</p></li></ol></div><p>Take a look at the steam particles in the <span class="strong"><strong>Scene</strong></span> view once more:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_016.jpg" /><div class="caption">The completed steam particle system</div></div><p>
</p><p>Each particle now rotates randomly, creating a more realistic steam effect.</p><p>In the next section, we will create a different type of effect to enhance the alien creature.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch08lvl2sec44"></a>Creating the slime-drip effect</h3></div></div></div><p>In our game, something that makes the alien particularly fiendish is the slime dripping from it. This is a corrosive substance that damages the ship and may injure the astronaut.</p><p>As the dripping effect is slow, we want to use a mesh rather than a billboard particle. We will set this without a particle system to have greater control of the physics.</p><p>We will start by setting up the <code class="literal">drop</code> game object:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Models</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">drop</code> model.</p></li><li><p>Drag this to the <span class="strong"><strong>Hierarchy</strong></span> panel to add it to the scene.</p></li><li><p>Use the <span class="strong"><strong>Move</strong></span> tool to position the <code class="literal">drop</code> game object close to the alien.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, zero out the <span class="strong"><strong>Rotation X</strong></span> value in the <span class="strong"><strong>Transform</strong></span> component so that the drop is oriented correctly.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_017.jpg" /><div class="caption">The drop model added to the scene</div></div><p>
</p><p>At the moment, the drop uses Unity's default material. A suitable material has already been set up for this.</p></li><li><p>In the <span class="strong"><strong>Project </strong></span>panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">droplet</code> material and drag it to the drop in the <span class="strong"><strong>Hierarchy</strong></span> or <span class="strong"><strong>Scene</strong></span> view.</p></li></ol></div><p>The drop model will update in the <span class="strong"><strong>Scene</strong></span> and <span class="strong"><strong>Game</strong></span> views.</p><p>The droplet material uses a <span class="strong"><strong>Standard Specular</strong></span> shader with a little transparency and high specular and smoothness levels to make it appear wet.</p><p>Next, we want the drips to affect the appearance of the flooring when they come in contact with it.</p><p>We can set this up next with a decal overlay technique.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec19"></a>Creating the floor damage effect</h4></div></div></div><p>In this step, we will create an effect to simulate the damage to the environment when the alien's corrosive slime drips from it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the scene, create a new <code class="literal">quad</code> game object.</p><p>We will prototype the effect with this geometry.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel or the <span class="strong"><strong>Inspector</strong></span>, rename the quad <code class="literal">burnQuad</code>.</p></li><li><p>Rotate the quad so that it is parallel to the floor by setting the <span class="strong"><strong>Rotation X</strong></span> value to <code class="literal">90</code> in the <span class="strong"><strong>Transform</strong></span> component in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Create a new material in the <code class="literal">PACKT_Materials</code> folder.</p></li><li><p>Name it <code class="literal">Corrosive</code>.</p></li><li><p>Drag the material to the quad to apply it.</p><p>There is a transparent texture included in the project files that we will use to show the damage.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Textures</code> folder.</p></li><li><p>Locate the <code class="literal">burn</code> texture asset.</p></li><li><p>Drag this to the <span class="strong"><strong>Albedo</strong></span> slot in the <span class="strong"><strong>Inspector</strong></span>.</p><p>The texture is transparent. We want to be able to show this as an overlay effect.</p><p>Next, we will change the material's <span class="strong"><strong>Rendering Mode</strong></span> to implement transparency.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, set the <code class="literal">Corrosive</code> material's <span class="strong"><strong>Rendering Mode</strong></span> to <span class="strong"><strong>Cutout</strong></span>.</p></li></ol></div><p>In the <span class="strong"><strong>Scene</strong></span> view, the edges of the quad will become transparent:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_018.jpg" /><div class="caption">The quad added to the scene</div></div><p>
</p><p>With the <span class="strong"><strong>CutoutRendering Mode</strong></span>, we can control the level of the alpha clipping with the <span class="strong"><strong>Alpha cutoff</strong></span> slider in the <span class="strong"><strong>Inspector</strong></span>.</p><p>With the <span class="strong"><strong>Alpha cutoff</strong></span> value set to 0, the texture appears completely opaque. When we drag it all the way to <code class="literal">1</code>, the texture becomes completely transparent.</p><p>When the droplet hits the floor's surface, we want the burn overlay to grow and remain at the lowest value that does not show the edges of the quad.</p><p>We can handle this at runtime with a short C# script.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec20"></a>Writing the control script</h4></div></div></div><p>Our control script will access the <span class="strong"><strong>Alpha </strong></span>cutoff slider in the Standard Shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Scripts</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, create a new <span class="strong"><strong>C# Script</strong></span> asset.</p></li><li><p>Rename the script <code class="literal">burnEffect</code> and double-click on it to open it in MonoDevelop.</p><p>In MonoDevelop, we will start by defining some variables.</p></li><li><p>Add the following code directly inside the script's opening bracket:</p><pre class="programlisting">        public float cutoffValue = 0.95f; &#13;
        public float cutoffMin = 0.5f; &#13;
        public Transform burnPrefab; &#13;
        public bool burning; &#13;
        public float burnRate = 0.005f; &#13;
        public Transform newBurnQuad; &#13;
</pre></li></ol></div><p>The first float variable, <code class="literal">cutoffValue</code>, will be directly tied to the <span class="strong"><strong>Alpha cutoff</strong></span> slider. We give it a value of <code class="literal">0.95</code> so that the effect starts a little quicker. There should be something visible as soon as the droplet hits the ground.</p><p>The next float, <code class="literal">cutoffMin</code>, is the lowest value that we want to use in the shader, under this, the transparent parts of the texture will become visible.</p><p>The next variable, <code class="literal">burnPrefab</code>, is used to store the quad. We will need to save this as a prefab in order to instantiate it at runtime.</p><p>We add a Boolean variable named <code class="literal">burning</code> to keep track of whether the effect is active or not. If we do not specify otherwise, the Boolean is inactive or <code class="literal">false</code> by default.</p><p>Next, we will add another float, <code class="literal">burnRate</code>, which will allow us to decelerate the effect, so that the corrosive appears to gradually lose its energy. We will set this to a very low value here, because it will be multiplied by time.</p><p>Finally, we will include a variable to store the instantiated object, <code class="literal">newBurnQuad</code>. This will allow us to access it again after it has been instanced.</p><p>We want something to happen when the droplet collides with the floor, so we will use Unity's built-in <code class="literal">OnCollisionEnter</code> function:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add the following code beneath the <code class="literal">Update</code> function:</p><pre class="programlisting">        void OnCollisionEnter (Collision collision) &#13;
        { &#13;
        } &#13;
</pre><p>This function is called whenever the game object that it is attached to collides with another collision object, such as the one attached to the floor in the scene.</p><p>The function will give us some data about the collision, such as the point on the mesh that was collided with.</p></li><li><p>Add the following line inside the <code class="literal">OnCollisionEnter</code> function's brackets:</p><pre class="programlisting">        ContactPoint contact = collision.contacts[0]; &#13;
</pre><p>The function can store more than one contact point, but for this effect, we only care about the first one.</p><p>We will store this contact point as a <code class="literal">Vector3</code> value, giving it a position in World Space.</p></li><li><p>Add the following line:</p><pre class="programlisting">        Vector3 pos = contact.point; &#13;
</pre><p>To prevent further physics interactions with this game object, we can set it to ignore any more collisions.</p></li><li><p>Add the following line of code:</p><pre class="programlisting">        GetComponent&lt;Rigidbody&gt;().detectCollisions = false; &#13;
</pre><p>We also want the droplet to disappear when it hits the ground. For this, we will deactivate the <span class="strong"><strong>Mesh Renderer</strong></span>.</p></li><li><p>Add the following line:</p><pre class="programlisting">        GetComponent&lt;MeshRenderer&gt;().enabled = false; &#13;
</pre><p>We could also use the <code class="literal">Destroy</code> method that would get rid of the droplet entirely, but this would also prevent anything further happening in this control script.</p></li><li><p>Next, add the following code:</p><pre class="programlisting">        newBurnQuad = Instantiate (burnPrefab, pos, Quaternion.Euler(90f, &#13;
          0f, 0f))as Transform;&#13;
</pre></li></ol></div><p>This is where we will add the quad to the game scene.</p><p>We will instantiate the prefab that we defined as a variable. We set its position to the contact point that we defined earlier.</p><p>As we are using a quad, which is rotated to face along the z axis, we need to define a new Quaternion rotation to make it parallel to the ground.</p><p>Lastly, we set our Boolean:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Add the following line of code:</p><pre class="programlisting">        burning = true; &#13;
</pre><p>This is used as a flag to start the <span class="strong"><strong>Alpha cutoff</strong></span> value adjustment in the <code class="literal">Update</code> function.</p></li><li><p>After the opening bracket of <code class="literal">Update</code>, add the following line:</p><pre class="programlisting">        if (burning) &#13;
        { &#13;
        } &#13;
</pre><p>We will use an <code class="literal">if</code> statement to check the status of our burning Boolean.</p></li><li><p>Within the <code class="literal">if</code> statement's brackets, add the following code:</p><pre class="programlisting">        Renderer burnRenderer = newBurnQuad.GetComponent &lt;MeshRenderer&gt; (); &#13;
        burnRenderer.material.SetFloat ("_Cutoff", cutoffValue); &#13;
</pre><p>Here, we will create a local variable to access the quad's mesh renderer. This is how we will access its material. We will set the value of the <code class="literal">_Cutoff</code> float to equal <code class="literal">cutoffValue</code>.</p><p>As we have added this code to the <code class="literal">Update</code> function, it will run every frame, as long as the <code class="literal">burning</code> Boolean reads as <code class="literal">true</code>.</p><p>We will add a few more <code class="literal">if</code> statements to do our calculations.</p></li><li><p>Add the following line next within the <code class="literal">if</code> statement:</p><pre class="programlisting">        if (burnRate &lt; 1f) &#13;
        { &#13;
            burnRate += 0.001f * Time.deltaTime; &#13;
        } &#13;
</pre><p>We add the conditional <code class="literal">burnRate &lt; 1f</code> to make sure that the value is not already sufficiently high. We will then multiply it by a small value and <code class="literal">Time.deltaTime</code>. This is the time in seconds.</p></li><li><p>Add the next <code class="literal">if</code> statement:</p><pre class="programlisting">        if(cutoffValue &gt;= cutoffMin) &#13;
        { &#13;
            cutoffValue -= burnRate; &#13;
        } &#13;
        else &#13;
        { &#13;
            cutoffValue = cutoffMin; &#13;
            burning = false; &#13;
        } &#13;
</pre><p>Here, we will check to make sure that <code class="literal">cutoffValue</code> is higher than its lowest acceptable value. If this is the case, we will reduce it by the <code class="literal">burnRate</code> value.</p><p>We will add an <code class="literal">else</code> statement to take care of the other possibility, setting <code class="literal">cutoffValue</code> to <code class="literal">cutoffMin</code> and setting <code class="literal">burning</code> to <code class="literal">false</code>.</p></li><li><p>Save the script.</p></li><li><p>Return to the main Unity interface.</p></li></ol></div><p>In the next section, we will make some changes to the <code class="literal">drop</code> game object.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch08lvl3sec21"></a>Modifying the drop prefab</h4></div></div></div><p>We now need to add the script to the <code class="literal">drop</code> game object:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Prefabs</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Drag the <code class="literal">drop</code> game object from the <span class="strong"><strong>Hierarchy</strong></span> panel into the <span class="strong"><strong>Assets</strong></span> panel to make it into a prefab.</p></li><li><p>Click on the <code class="literal">PACKT_Scripts</code> folder again and drag the <code class="literal">burnEffect</code> script onto the <code class="literal">drop</code> to add it as a component.</p><p>We also need to add <span class="strong"><strong>Rigidbody</strong></span> and <span class="strong"><strong>Collider</strong></span> components for the physics to work.</p></li><li><p>Use the menu bar to add a Rigidbody component by navigating to <span class="strong"><strong>Component</strong></span> | <span class="strong"><strong>Physics</strong></span> | <span class="strong"><strong>Rigidbody</strong></span>.</p></li><li><p>Next, add the <span class="strong"><strong>Box Collider</strong></span> component from the same drop-down list.</p><p>We need to save the <code class="literal">burnQuad</code> game object as a prefab so that it can be added to the script component.</p></li><li><p>Drag the <code class="literal">burnQuad</code> object from the <span class="strong"><strong>Hierarchy</strong></span> panel into the <code class="literal">PACKT_Prefabs</code> folder in the <span class="strong"><strong>Assets</strong></span> panel.</p><p>Next, we need to specify this as the prefab to be instantiated in the script.</p><p>We have to do this at the prefab level for this change to be stored.</p></li><li><p>Select the <code class="literal">drop</code> prefab in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Drag the <code class="literal">burnQuad</code> prefab from the <span class="strong"><strong>Assets</strong></span> panel into the <code class="literal">burnPrefab</code> slot in the <code class="literal">droplet</code> game object's <code class="literal">burnEffect</code> script component in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_019.jpg" /><div class="caption">The drop prefab's Burn Effect Script component</div></div><p>
</p></li><li><p>Scroll to the top of the <span class="strong"><strong>Inspector</strong></span> and save the changes to the prefab by clicking on the <span class="strong"><strong>Apply</strong></span> button.</p><p>The <code class="literal">alien</code> game object in the scene already has a script set up to instantiate drops, we just need to add the new prefab to the script component.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, click on the <code class="literal">alien</code> game object.</p></li><li><p>Drag the drop prefab from the <span class="strong"><strong>Assets</strong></span> panel onto the <span class="strong"><strong>Drop Prefab</strong></span> slot in the <code class="literal">Alien Drops (Script)</code> component that is visible in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Delete the <code class="literal">drop</code> and <code class="literal">burnQuad</code> game objects from the scene.</p><p>This will make it easier to see our new effects as they are produced.</p></li><li><p>Preview the scene by pressing the play button in the top center of the Unity interface:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_08_020.jpg" /><div class="caption">The completed slime-drip effect</div></div><p>
</p></li></ol></div><p>The drops are emitted randomly from two defined points in the <code class="literal">alien</code> game object hierarchy.</p><p>When the drops hit the floor's collider, they instantiate the <code class="literal">burnQuad</code> prefab, at which point, we see the animated cutoff effect.</p></div></div></div>