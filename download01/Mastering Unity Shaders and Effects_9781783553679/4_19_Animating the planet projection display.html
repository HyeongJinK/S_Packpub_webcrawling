<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch04lvl1sec21"></a>Animating the planet projection display</h2></div></div><hr /></div><p>In <a class="link" href="#" linkend="ch03">Chapter 3</a>, <span class="emphasis"><em>Working with Lighting and Light-Emitting Surfaces</em></span>, we set up the representation of the planet scan using a custom wireframe shader. In this section, we will animate the effect using the <span class="strong"><strong>Animation</strong></span> panel and by modifying the shader.</p><p>We will start by animating the rotation of the planet sphere:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">planetScan</code> game object.</p></li><li><p>Open the <span class="strong"><strong>Animation</strong></span> panel by clicking on <span class="strong"><strong>Window</strong></span> and then selecting<span class="strong"><strong> Animation</strong></span>.</p></li><li><p>When the panel appears, click on the <span class="strong"><strong>Create</strong></span> button to set up the components and create the animation file.</p></li><li><p>Name the animation <code class="literal">planetTurn</code> and designate the <code class="literal">PACKT_Animation</code> folder as its location.</p></li><li><p>In the <span class="strong"><strong>Animation</strong></span> panel, click on the <span class="strong"><strong>Add Property</strong></span> button.</p></li><li><p>Click on <span class="strong"><strong>Transform</strong></span> and choose <span class="strong"><strong>Rotation</strong></span> as the property.</p></li><li><p>Expand the animated property by clicking on the small hierarchy arrow next to the <code class="literal">planetScan</code> rotation on the left-hand side of the <span class="strong"><strong>Animation</strong></span> panel.</p><p>We only want the planet sphere to rotate on the y axis in a continual loop.</p></li><li><p>Click on the end keyframe in the <span class="strong"><strong>Rotation.Y</strong></span> track.</p></li><li><p>In the value field, type the number <code class="literal">360</code>.</p><p>This will ensure that the sphere rotates all the way around.</p><p>If you press the play button in the <span class="strong"><strong>Animation</strong></span> panel at this point, you will see the sphere spin in the <span class="strong"><strong>Scene</strong></span> view. With our default timing, it spins a little too fast.</p></li><li><p>In the <span class="strong"><strong>Animation</strong></span> panel, scroll back on the mouse wheel to zoom out.</p></li><li><p>When a larger area of animation timeline is visible, drag the end keyframe to position <code class="literal">20:00</code> on the timeline.</p></li><li><p>You may have to reset the rotation value to <code class="literal">360</code>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_009.jpg" /></div><p>
</p></li><li><p>Dock or close the <span class="strong"><strong>Animation</strong></span> window.</p></li><li><p>Press the play button in the center of the top of the main Unity interface.</p></li></ol></div><p>The <code class="literal">planetScan</code> sphere will rotate in a smooth loop.</p><p>The rotating sphere represents the planet, but we also need something to represent the spacecraft's destination and trajectory.</p><p>In the next step, we will create an animated graphic for the destination on the planet's surface.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl2sec26"></a>Creating an animated hotspot on the planet</h3></div></div></div><p>Now that the planet's display is animating, we will add a graphic to represent the ship's landing spot. We will do this using a sequence of bitmap images pasted onto a quad.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec10"></a>Creating the hotspot geometry</h4></div></div></div><p>The geometry that we need for the destination hotspot is very simple, so we will create it within Unity:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new quad game object in the scene using the <span class="strong"><strong>GameObject</strong></span> tab in the menu bar by navigating to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>3D Object</strong></span> | <span class="strong"><strong>Quad</strong></span>.</p></li><li><p>When it appears in the <span class="strong"><strong>Hierarchy</strong></span> panel, click on the quad and rename it <code class="literal">destination</code>.</p></li><li><p>Parent the new object to the sphere object by dragging it on top of <code class="literal">planetScan</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, zero out the <code class="literal">destination</code> object's <span class="strong"><strong>TransformPosition</strong></span> values to align it to the planet's center.</p><p>Currently, the quad will be faced away from the view. We need to rotate it so that it can be seen.</p></li><li><p>In the <span class="strong"><strong>TransformRotationX</strong></span> field in the <span class="strong"><strong>Inspector</strong></span>, enter the value <code class="literal">-90</code> to rotate the quad.</p><p>Now that the quad is visible, we need to scale it down so that it is appropriate for the size of the planet.</p><p>In the <span class="strong"><strong>TransformScale</strong></span> fields in the <span class="strong"><strong>Inspector</strong></span>, enter the value <code class="literal">9.6</code> in each of the three fields to scale down the quad.</p><p>Remember that as a child object, the scale visible here is relative to the parent object.</p></li><li><p>Use the move tool in the <span class="strong"><strong>Scene</strong></span> view to reposition the quad so that it is close to the surface of the planet and a little below the equator.</p><p>Try to avoid intersecting the planet object.</p><p>You can use the values in the following illustration if you want to match the example values exactly:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_010.jpg" /></div><p>
</p></li></ol></div><p>At this point, the <code class="literal">destination</code> quad should appear behind the <code class="literal">planetScan</code> sphere in the scene:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_011.jpg" /></div><p>
</p><p>Our next objective is to create the hotspot material.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec11"></a>Creating the hotspot material</h4></div></div></div><p>We will assign a new material to the hotspot and give it similar values to the interface that we set up in the last chapter:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In an empty area, create a new material by right-clicking and choosing <span class="strong"><strong>Create</strong></span> and then selecting <span class="strong"><strong>Material</strong></span> from the drop-down list.</p></li><li><p>Rename the new material <code class="literal">hotSpot</code>.</p></li><li><p>Assign it to the <code class="literal">destination</code> quad by dragging it onto the name of the game object in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p><p>The hotspot texture is located in the texture's folder and needs to be assigned to our new material.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Textures</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the hotspot texture asset and drag it into the <code class="literal">hotSpot </code>material's <span class="strong"><strong>Albedo</strong></span> slot near the top of the<span class="strong"><strong> Inspector</strong></span>.</p><p>The texture will appear on the quad.</p></li><li><p>Drag the same texture into the <span class="strong"><strong>Emission</strong></span> field further down in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_012.jpg" /></div><p>
</p><p>We want this graphic to emit light like the other interface elements.</p><p>There are four different sizes of the ring graphic and currently all four are displayed on the quad. We need to adjust the UV coordinates so that only one circle is displayed at a time.</p></li><li><p>Enter the value <code class="literal">0.5</code> in both the <span class="strong"><strong>Tiling</strong></span> fields, under the <span class="strong"><strong>Emission</strong></span> input settings in the <span class="strong"><strong>Inspector</strong></span>.</p><p>The texture on the quad will change to only display a single circle. This will be the second smallest one, in the lower left of the texture.</p><p>UV coordinates are measured from the lower left-hand corner of the texture space.</p></li><li><p>In the <span class="strong"><strong>OffsetY</strong></span> field, enter the value <code class="literal">0.5</code>.</p><p>This will display the largest circle, which is situated in the upper-left quadrant of the texture:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_013.jpg" /></div><p>
</p><p>Visualizing the largest circle will make it easier to preview the object in the scene in order to make sure that it fits with the other graphic elements.</p></li><li><p>Switch to the <span class="strong"><strong>Game View</strong></span> by clicking on the <span class="strong"><strong>Game</strong></span> tab in the center of the top of the main Unity interface.</p><p>The <code class="literal">destination</code> graphic should be clearly visible through the <code class="literal">planetScan</code> wireframe object:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_014.jpg" /></div><p>
</p><p>At the moment, the destination hotspot is opaque, and the dark areas of the quad become visible as the planet rotates. We need to change the material's <span class="strong"><strong>Rendering Mode</strong></span> to make it invisible.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, set the <code class="literal">hotSpot</code> material's <span class="strong"><strong>Rendering Mode</strong></span> to <span class="strong"><strong>Cutout</strong></span>.</p></li></ol></div><p>Now that the <code class="literal">hotSpot</code> material is set up, we can animate the effect with a little code.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec12"></a>Writing the hotspot animation script</h4></div></div></div><p>For the destination hotspot graphic, we could animate using Unity's <span class="strong"><strong>Animation</strong></span> window, but it is easier to tie this in with the other animated effects if we just write a short script to do this:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Scripts</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>In the <span class="strong"><strong>Assets</strong></span> panel, create a new C# script asset in an empty part of the folder. Right-click and choose <span class="strong"><strong>Create</strong></span> and then select<span class="strong"><strong> C# Script</strong></span>.</p></li><li><p>When it is created, rename the asset <code class="literal">destHS</code>.</p></li><li><p>Double-click on <code class="literal">destHS</code> to open it in MonoDevelop.</p><p>We want the script to access the material and offset and scale the UVs.</p></li><li><p>We will start by creating an array for the UV offsets. Add the following code just after the script's opening bracket:</p><pre class="programlisting">        public Vector2 [] UVOffsets; &#13;
</pre></li><li><p>We will add an integer variable to keep track of the position in the array. Add the following line:</p><pre class="programlisting">        public int currArrayPos; &#13;
</pre></li><li><p>Next, we will add a float variable that will define the duration of each stage of the animation. Add the following code:</p><pre class="programlisting">        public float interval = 0.1f; &#13;
</pre><p>The script will be accessing the destination game object's renderer in order to alter the material at runtime, so we need to include a variable to keep track of this.</p></li><li><p>Add the following code:</p><pre class="programlisting">        public Renderer rend; &#13;
</pre><p>We will set this variable immediately.</p></li><li><p>In the <code class="literal">Start</code> function, add the following code:</p><pre class="programlisting">        rend = GetComponent&lt;Renderer&gt;(); &#13;
</pre><p>Next, we need to call a custom function that will change the values of our array.</p></li><li><p>Add the following line:</p><pre class="programlisting">        InvokeRepeating("NextStage", 1, interval); &#13;
</pre><p>The <code class="literal">InvokeRepeating</code> method calls a named function repetitively at set times. Here, we use our <code class="literal">interval</code> variable to define the value.</p></li><li><p>Add the new function at the end of the script. Make sure to include it before the script's closing bracket:</p><pre class="programlisting">        void NextStage() &#13;
        { &#13;
            currArrayPos++; &#13;
            if(currArrayPos &gt; UVOffsets.Length-1) &#13;
            { &#13;
                currArrayPos = 0; &#13;
            } &#13;
            rend.material.SetTextureOffset("_MainTex", &#13;
              UVOffsets[currArrayPos]);&#13;
        } &#13;
</pre><p>In the <code class="literal">NextStage</code> function, we will increase the <code class="literal">currArrayPos</code> integer. In the next line, we will check to see if the value has exceeded the number of positions in the array. When this is the case, we set it back to 0, looping it.</p><p>After this has taken place, we will access the game object's renderer and set the texture offset using the current position in the array.</p></li><li><p>Save the script.</p></li><li><p>Minimize MonoDevelop.</p></li><li><p>Back in the main Unity interface, drag the <code class="literal">destHS</code> script asset onto the <code class="literal">destination</code> game object to add it as a component.</p></li></ol></div><p>In the next step, we will set up the hotspot script variables and preview our animation.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch04lvl3sec13"></a>Setting up the hotspot variables and finalizing the effect</h4></div></div></div><p>Now that we have written the animation script and added it to the game object, we need to add values to the <code class="literal">Vector3</code> arrays in the <span class="strong"><strong>Inspector</strong></span>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, select the <code class="literal">destination</code> object; its components should become visible in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, scroll down to locate the <span class="strong"><strong>Dest HS (Script)</strong></span> component block.</p></li><li><p>Click on the small arrow next to the <span class="strong"><strong>UV Offsets</strong></span> variable to view its subcomponents.</p></li><li><p>Set the <span class="strong"><strong>Size</strong></span> property to <code class="literal">4</code>.</p><p>This will create four sets of fields in the array.</p></li><li><p>Add the following values to the fields:</p><pre class="programlisting">        Element 0: 0.5, 0 &#13;
        Element 1: 0, 0 &#13;
        Element 2: 0.5, 0.5 &#13;
        Element 3: 0, 0.5 &#13;
</pre></li><li><p>Preview this effect by clicking on the play button at the center of the top of the main Unity interface.</p><p>You should see the destination hotspot change size:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_04_015.jpg" /></div><p>
</p><p>We can make this element even more of a focal point in the scene by making it flash off between stages. We can do this by utilizing some of the dead space that is already existing in our texture.</p></li><li><p>Return to the script in MonoDevelop.</p></li><li><p>Add the following code under the other variables that we added:</p><pre class="programlisting">        public bool UVTileSwitch; &#13;
        public float currTile; &#13;
</pre><p>Here, we add a Boolean variable named <code class="literal">UVTileSwitch</code>.</p><p>The UV tiling will only switch between two states, so it is unnecessary to use an array like we did for the UV offset.</p><p>We add the <code class="literal">currTile</code> float variable for the actual tiling offset. This is set to a default value of 0, where the variable is defined at the top of the script, but it will be changed to define an area of the texture map that is black.</p></li><li><p>Add the following code to the <code class="literal">Update</code> function:</p><pre class="programlisting">        if(UVTileSwitch) &#13;
        { &#13;
            currTile = 0.5f; &#13;
        } &#13;
        else &#13;
        { &#13;
            currTile = 0.25f; &#13;
        } &#13;
</pre><p>Here, we tie the <code class="literal">currTile</code> float to the <code class="literal">UVTileSwitch</code> Boolean. Whenever <code class="literal">UVTileSwitch</code> returns <code class="literal">true</code>, we set the <code class="literal">currTile</code> value to <code class="literal">0.5</code>; whenever this is not the case, we set it to <code class="literal">0.25</code>.</p></li><li><p>Save the script.</p></li><li><p>Press the play button again to preview the effect.</p><p>The hotspot graphic should now flash off between its different size frames.</p></li></ol></div><p>We have completed the changes to the Unity scene to make the spacecraft bridge more dynamic and interesting.</p></div></div></div>