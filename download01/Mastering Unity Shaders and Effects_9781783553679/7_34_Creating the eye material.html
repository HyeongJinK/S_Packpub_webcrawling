<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch07lvl1sec33"></a>Creating the eye material</h2></div></div><hr /></div><p>The white part of the eye, the sclera, absorbs light and is reflective, so we need to treat it differently from the rest of the body:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, locate the <code class="literal">astronaut_eye_L</code> model.</p></li><li><p>Double-click on its name in the list to zoom in on the model in the <span class="strong"><strong>Scene</strong></span> view:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_07_007.jpg" /><div class="caption">The eye set up with a Standard Shader and initial textures</div></div><p>
</p><p>The surface looks quite dull with the default material settings.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, scroll down to the <span class="strong"><strong>Material</strong></span> properties and set the shader type to <code class="literal">Standard Specular</code>.</p></li><li><p>Set the <span class="strong"><strong>Specular</strong></span> color to a dark, slightly warm gray. The hex code <code class="literal">383434FF</code> will work pretty good.</p></li><li><p>Set the <span class="strong"><strong>Smoothness </strong></span>value to <code class="literal">0.85</code>.</p><p>The eye should appear more shiny.</p><p>As the eyeball is a separate shape that does not deform, we can partially solve these problems with geometry by adding an additional shell to render the reflection.</p><p>In this case, we will use a transparent shiny material to render the sclera.</p></li><li><p>In the <span class="strong"><strong>Hierarchy</strong></span> panel, click on the small arrow next to the <code class="literal">astronaut_eyeL</code> game model to expand its hierarchy.</p><p>The <code class="literal">scleraL</code> object is a child of <code class="literal">astronaut_eyeL</code> and is currently deactivated.</p></li><li><p>Click to select <code class="literal">scleraL</code> in the <span class="strong"><strong>Hierarchy</strong></span> panel and activate it by clicking on the checkbox next to its name in the <span class="strong"><strong>Inspector</strong></span>.</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_07_008.jpg" /><div class="caption">The activated sclera game object</div></div><p>
</p><p>The sclera's material has already been set up and needs to be assigned.</p></li><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Locate the <code class="literal">astronaut_sclera</code> material and drag it to the <code class="literal">scleraL</code> game object in the <span class="strong"><strong>Hierarchy</strong></span> panel.</p></li></ol></div><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_07_009.jpg" /><div class="caption">The sclera with its material applied</div></div><p>
</p><p>The material gives the eye a shinier appearance. The geometry that covers the iris is slightly curved outward, creating a more realistic reflection.</p><p>The size of the pupil is fixed in the texture. We may want the pupil to change its size to adapt to lighter or darker conditions within our game.</p><p>Let's create a custom shader to get this working.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch07lvl2sec38"></a>Creating the custom eye shader</h3></div></div></div><p>Creating a custom shader for the eye will allow us to modify the scale of the pupil at runtime:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Shaders</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Right-click on an empty space within the <span class="strong"><strong>Assets</strong></span> panel and create a new shader by selecting <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Shader</strong></span> | <span class="strong"><strong>Standard Surface Shader</strong></span> from the drop-down list.</p></li><li><p>Rename the new shader <code class="literal">eye</code>.</p></li><li><p>Double-click on it to open it in MonoDevelop.</p></li><li><p>In MonoDevelop, rename the shader as follows:</p><pre class="programlisting">        Shader "PACKT/eye" &#13;
</pre><p>Next, we will change the properties.</p></li><li><p>In the <code class="literal">Properties</code> block, delete the <code class="literal">_Metallic</code> line and add the following:</p><pre class="programlisting">        _Specular ("Specular", Range(0,1)) = 0.0 &#13;
        _BumpMap ("Normal Map", 2D) = "bump" {} &#13;
        _PupilScale("Pupil Size", Range(0, 100)) = 1.0//adjust ranges &#13;
        _UVRange("UV Range", Range(50, 100)) = 50 &#13;
</pre><p>Here, we will add properties for specular and normal map inputs. We will add range properties to allow us to control the scale of the pupil and range of UVs that are being affected.</p></li><li><p>In the shader compile directive, add the <code class="literal">Specular</code> keyword to <code class="literal">Standard</code> to allow the shader to use the specular workflow. The adjusted directive should read as follows:</p><pre class="programlisting">        #pragma surface surf StandardSpecular fullforwardshadows &#13;
</pre></li><li><p>Locate the <code class="literal">sampler2d _MainTex</code> line and add the following lines of code just beneath it:</p><pre class="programlisting">        sampler2D _BumpMap; &#13;
        float _PupilScale; &#13;
        float _UVRange; &#13;
</pre><p>We will add <code class="literal">sampler2d</code> so that the shader will interpret the normal texture map, and the <code class="literal">_PupilScale</code> and <code class="literal">_UVRange</code> floats so that we can use the sliders in our calculations.</p></li><li><p>Within the <code class="literal">surf</code> function, delete the <code class="literal">o.Metallic</code> line and replace it with the following:</p><pre class="programlisting">        o.Specular = _SpecColor.rgb; &#13;
</pre><p>Rather than using a texture map here, we will use the values provided by the defined color in our properties.</p><p>Now that we have adjusted the specular components, let's get the pupil scaling working correctly.</p></li><li><p>At the top of the <code class="literal">surf</code> function, add the following lines:</p><pre class="programlisting">        float2 pos = IN.uv_MainTex.xy-0.5; &#13;
        float dist = 1-length(pos); &#13;
        dist = pow(dist, _UVRange); &#13;
        float2 disp = pos * clamp(dist * _PupilScale, 0.0, 1); &#13;
        pos -= disp; &#13;
</pre></li></ol></div><p>Here, we will create a new <code class="literal">float2</code> variable, <code class="literal">pos</code>, to handle the adjusted UV position.</p><p>The next <code class="literal">float</code> variable, <code class="literal">dist</code>, is defined as <code class="literal">1- length(pos)</code>.</p><p>We then modify dist using the <code class="literal">pow </code>function to bring <code class="literal">dist</code> up to the power of the <code class="literal">_UVRange</code> variable.</p><p>In the next line, we will add a new <code class="literal">float2</code> variable named<code class="literal"> disp</code> and make it equal to <code class="literal">pos</code>, multiplied using the clamp function, which we define as <code class="literal">dist</code> multiplied by the <code class="literal">_PupilScale </code>variable, using the ranges <code class="literal">0.0 </code>and <code class="literal">1</code>.</p><p>Lastly, we will make <code class="literal">pos</code> negatively affected by <code class="literal">disp</code>:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Locate the <code class="literal">fixed4 c</code> line and replace it with the following:</p><pre class="programlisting">        fixed4 c = tex2D (_MainTex, pos + 0.5); &#13;
</pre><p>Here we will use our modified pos UV variable in the two-dimensional texture definition. We will add <code class="literal">0.5</code> to both values to center the coordinates.</p><p>As we are also using a bump map in this shader, we need to modify the UV interpretation the same way.</p></li><li><p>Add the following line under the <code class="literal">o.Specular</code> line:</p><pre class="programlisting">        o.Normal = UnpackNormal ( tex2D (_BumpMap, pos + 0.5)); &#13;
</pre></li><li><p>Save the shader.</p></li><li><p>Return to the main Unity interface.</p></li><li><p>Locate the <code class="literal">astronaut_eye_norm</code> texture in the <code class="literal">PACKT_Textures</code> folder and drag it to the <span class="strong"><strong>Normal Map</strong></span> texture slot in the <span class="strong"><strong>Inspector</strong></span>:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_07_010.jpg" /><div class="caption">The final eye material</div></div><p>
</p></li></ol></div><p>With the new shader, we can modify the size of the pupil by dragging the <code class="literal">Pupil Size</code> value. The current value of the <span class="strong"><strong>UV Range</strong></span> constricts the effect and is clamped between <code class="literal">50</code> and <code class="literal">100</code>.</p><p>In the next section, we will create a custom hair material.</p></div></div>