<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec12"></a>Creating better transparency for the astronaut's helmet</h2></div></div><hr /></div><p>When we set up the initial material for the character's helmet in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Getting to Grips with Standard Shaders</em></span>, we used the transparency feature of the <span class="strong"><strong>Standard Shader</strong></span> to render the helmet geometry partially transparent. The triangles that make up the helmet model are only facing outward, so there is no specularity on the inner surface where we would expect to see it.</p><p>This problem can be solved using a custom shader. We will build on the code structure we worked with in the previous section, making a more complex shader that is lit realistically by the scene lights.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec15"></a>Creating a custom transparent shader</h3></div></div></div><p>We will start by creating a shader in the Unity project as we did in the previous section:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Shaders</code> folder.</p><p>The folder's contents will become visible in the <span class="strong"><strong>Assets</strong></span> panel.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip20"></a>Tip</h3><p>The <code class="literal">Final_Shaders</code> subfolder contains the finalized shaders that you may use for reference.</p></div></li><li><p>Create a new shader by right-clicking on an empty area of the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Navigate to <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Shader</strong></span> | <span class="strong"><strong>Standard Surface Shader</strong></span>.</p></li><li><p>Rename the shader<code class="literal"> Glass</code>.</p></li></ol></div><p>As earlier, the name of the shader asset is different from its name that will appear in the shader list, we will define this in the code.</p><p>Next, let's use the shader in the astronaut's helmet material so that we can see how its appearance changes as we write the shader:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>In the <span class="strong"><strong>Project</strong></span> panel, click on the <code class="literal">PACKT_Materials</code> folder to view its contents in the <span class="strong"><strong>Assets</strong></span> panel.</p></li><li><p>Click on the <code class="literal">Helmet</code> material.</p><p>We assigned this material to the astronaut's helmet in <a class="link" href="#" linkend="ch01">Chapter 1</a>, <span class="emphasis"><em>Getting to Grips with Standard Shaders</em></span>.</p><p>Any changes made to the material will be visible in the objects that they are applied to.</p></li><li><p>At the top of the <span class="strong"><strong>Inspector</strong></span>, click on the <span class="strong"><strong>Shader</strong></span> list and choose <span class="strong"><strong>Custom</strong></span> | <span class="strong"><strong>Glass</strong></span> from the drop-down list that appears:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_008.jpg" /></div><p>
</p></li></ol></div><p>In the <span class="strong"><strong>Scene</strong></span> view, the astronaut's helmet should turn opaque as the new shader's default code does not currently define the transparency.</p><p>We will fix this in the next section.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec16"></a>Editing the new glass shader</h3></div></div></div><p>When it was created, the new shader was written to include the name of the shader asset, this was automatically prefixed with the word <code class="literal">Custom</code> to separate it from the existing shaders.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Double-click on the shader to open it in MonoDevelop.</p><p>This time, we will go through the default code and explain the different parts as we update it.</p></li><li><p>Replace the first line of code with the following:</p><pre class="programlisting">        Shader "PACKT/Glass" { &#13;
</pre><p>The curly bracket at the end of the line encloses the rest of the shader.</p></li><li><p>Save the code using the <span class="emphasis"><em>Ctrl + S</em></span> shortcut (or <span class="emphasis"><em>command + S</em></span> if you are working on a Mac).</p><p>By default, we already have a shader that will respond to lighting, but the default shader code defines a surface that is opaque, rather than transparent. We need to edit the shader to allow the helmet to be transparent.</p></li><li><p>In <code class="literal">subShader</code>, locate the <code class="literal">Tags</code> line and replace the word <code class="literal">Opaque </code>with <code class="literal">Transparent</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="tip21"></a>Tip</h3><p>The <code class="literal">subShader</code> block defines different shader characteristics and will allow it to identify an alpha channel or other property that can be used to define the transparency for instance.</p></div><p>A little further down is the <span class="strong"><strong>Cg </strong></span>snippet, differentiated in MonoDevelop by its magenta color.</p></li><li><p>Within this, locate the shader compilation directive:</p><pre class="programlisting">        #pragma surface surf Standard fullforwardshadows &#13;
</pre></li><li><p>Add the word <code class="literal">alpha</code> at the end of the directive.</p><p>The addition of the <code class="literal">alpha</code> keyword to the end of the directive allows the shader to compile the transparent component.</p></li><li><p>Save the shader.</p></li><li><p>Minimize MonoDevelop.</p><p>In the main Unity scene, you may notice that the astronaut's helmet has now become transparent:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_009.jpg" /><div class="caption">The astronaut's helmet with the custom transparent shader</div></div><p>
</p><p>The amount of transparency is defined by the alpha channel in the <code class="literal">Color</code> property that can be adjusted by clicking on the swatch in the <span class="strong"><strong>Inspector</strong></span>.</p></li><li><p>Click on the <span class="strong"><strong>Color</strong></span> swatch.</p></li><li><p>In the color picker that appears, set the alpha channel to a value of <code class="literal">128</code>.</p></li><li><p>Close the window by clicking on the <span class="strong"><strong>X</strong></span> in the corner.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, set the <span class="strong"><strong>Smoothness</strong></span> value to <code class="literal">0.9</code>.</p><p>This will make the astronaut's helmet reflective.</p></li><li><p>Set the <span class="strong"><strong>Metallic</strong></span> value to <code class="literal">0.188</code>.</p><p>This will define a surface that is transparent and relatively shiny:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_010.jpg" /><div class="caption">The adjusted transparent helmet material</div></div><p>
</p></li></ol></div><p>If you look closely at the astronaut's helmet in the <span class="strong"><strong>Scene</strong></span> view, you will notice that only the outside surface of the helmet appears to be shiny.</p><p>We can make some changes to our shader in order to make the inner surface visible, resulting in a more realistic appearance.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch02lvl3sec5"></a>Creating the inner surface of the helmet</h4></div></div></div><p>For performance reasons, Unity's shaders only render the front faces of a mesh by default. Back faces are automatically culled in Unity.</p><p>We can change this with a single line of code:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Back in MonoDevelop, locate the <code class="literal">Glass</code> shader's <code class="literal">subShader</code> block.</p></li><li><p>Add the following line just after the <code class="literal">LOD</code> line:</p><pre class="programlisting">        Cull Off &#13;
</pre></li><li><p>Save the script and return to the main Unity interface.</p></li></ol></div><p>The inside of the Astronaut's helmet is now being rendered, but both sides are being rendered in the same place, resulting in some artifacts:</p><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_011.jpg" /><div class="caption">The glass shader with Cull Off</div></div><p>
</p><p>We can improve the appearance of this by rendering the front faces and back faces of the helmet separately in the shader.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="ch02lvl4sec0"></a>Separating front and back faces</h5></div></div></div><p>The appearance of thickness can be faked in our shader, making the astronaut's helmet seem more realistic in the scene.</p><p>We need to make some more changes to our glass material:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Maximize the MonoDevelop window.</p></li><li><p>Near the top of the shader code, add the following line after the other properties:</p><pre class="programlisting">        _Thickness ("Thickness", Range(-1,1)) = 0.5 &#13;
</pre><p>We will use this property to define how far the inner surface of the helmet is extruded.</p></li><li><p>Locate the <code class="literal">Cull Off</code> line that we recently added and replace it with the following:</p><pre class="programlisting">        Cull Back &#13;
</pre></li><li><p>Scroll down to the <code class="literal">ENDCG</code> line.</p><p>This marks the end of the Cg snippet and will usually appear in magenta text.</p></li><li><p>After this, add the following code:</p><pre class="programlisting">        Cull Front &#13;
        CGPROGRAM &#13;
        #pragma surface surf Standard fullforwardshadows alpha vertex:vert &#13;
        struct Input { &#13;
            float2 uv_MainTex; &#13;
        }; &#13;
        float _Thickness; &#13;
        void vert (inout appdata_full v) { &#13;
            v.vertex.xyz += v.normal * _Thickness; &#13;
        } &#13;
        sampler2D _MainTex; &#13;
        half _Glossiness; &#13;
        half _Metallic; &#13;
        fixed4 _Color; &#13;
&#13;
        void surf (Input IN, inout SurfaceOutputStandard o) { &#13;
            fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color; &#13;
            o.Albedo = c.rgb; &#13;
            o.Metallic = _Metallic; &#13;
            o.Smoothness = _Glossiness; &#13;
            o.Alpha = c.a;  &#13;
        } &#13;
        ENDCG &#13;
</pre></li></ol></div><p>This is essentially an additional shader that we are using with the first and that will define the appearance of the back faces.</p><p>In the next line, we will cull the front faces so that there is no overlap between the two shader sections.</p><p>It is also possible to blend the shaders together by overlaying them. We will take a look at more complex shader functions later in the book.</p><p>Once again, we use a Cg snippet to add the property directive that defines the shader type. This directive is identical to the original shader directive with the addition of <code class="literal">vertex: vert</code> that allows us to access the vertices that the shader is applied to.</p><p>In the next line, we will declare the <code class="literal">_Thickness</code> float using the property name that we already defined on the top of the shader.</p><p>In the calculation that follows this, we will modify the position of the vertices, moving them out by the value specified in <code class="literal">_Thickness</code>.</p><p>The rest of the shader section is identical to the original section that we already defined. The result should be a glass surface with thickness that can be modified within the <span class="strong"><strong>Inspector</strong></span>.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Save the script.</p></li><li><p>Minimize MonoDevelop.</p></li><li><p>In the <span class="strong"><strong>Inspector</strong></span>, set the material's <span class="strong"><strong>Thickness</strong></span> value to <code class="literal">-0.2</code>.</p></li></ol></div><p>
</p><div class="mediaobject"><img src="/graphics/9781783553679/graphics/image_02_012.jpg" /><div class="caption">The helmet material with the inner surface applied</div></div><p>
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note22"></a>Note</h3><p>This technique works for thin pieces of glass, such as helmets, visors, and glasses, but it does not simulate refraction the way that would be necessary to define thicker glass and other denser transparent materials.</p></div><p>In the next section, we will use a variation of this technique to simulate the planet's atmosphere.</p></div></div></div></div>