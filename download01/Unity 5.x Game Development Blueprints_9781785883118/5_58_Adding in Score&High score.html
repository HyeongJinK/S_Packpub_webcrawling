<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec60"></a>Adding in Score/High score</h2></div></div><hr /></div><p>Now that the game <a id="id290" class="indexterm"></a>has the start and ending, let's make it so that we can gain a score whenever we hit a duck:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>From the <span class="strong"><strong>Hierarchy</strong></span> tab, duplicate the <code class="literal">Time Text</code> object and rename it to <code class="literal">Score Text</code>. Go to the <span class="strong"><strong>Rect Transform's Anchor Presets</strong></span> menu, hold down <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span>, and click on the top-left option. Then, change <span class="strong"><strong>Pos X</strong></span> to <span class="strong"><strong>10 </strong></span>and <span class="strong"><strong>Pos Y</strong></span> to <span class="strong"><strong>-10</strong></span> to push it a bit off from the edge of the screen.</p></li><li><p>Then, in the <span class="strong"><strong>Text</strong></span> component, change the <span class="strong"><strong>Horizontal</strong></span> alignment to the left and change the <span class="strong"><strong>Text</strong></span> to <span class="strong"><strong>Score 0</strong></span>.</p></li><li><p>Finally, change the <code class="literal">Outline</code> component's <span class="strong"><strong>Effect Distance</strong></span> to <code class="literal">1.5</code>, <code class="literal">-1.5</code>:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_21.jpg" /></div></li><li><p>Next, we will <a id="id291" class="indexterm"></a>want to duplicate the <span class="strong"><strong>Score Text object</strong></span> and rename it <span class="strong"><strong>High Score Text</strong></span>. From there, open up the <span class="strong"><strong>Anchor Presets</strong></span> menu, hold down <span class="emphasis"><em>Alt</em></span> + <span class="emphasis"><em>Shift</em></span>, and click on the top-right option. Afterwards, change <span class="strong"><strong>Pos X</strong></span> to <span class="strong"><strong>-10</strong></span> and <span class="strong"><strong>Pos Y</strong></span> to <span class="strong"><strong>-10</strong></span>.</p></li><li><p>Afterwards, in the <span class="strong"><strong>Text</strong></span> component, change the <span class="strong"><strong>Text</strong></span> to <span class="strong"><strong>High Score 0</strong></span>. Then, change the <span class="strong"><strong>Alignment</strong></span> to the right side:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_22.jpg" /></div><p>Now that we<a id="id292" class="indexterm"></a> have the objects created, let's add in the functionality for scoring using what we already know and <code class="literal">PlayerPrefs</code> for the high score.</p><p>
<span class="strong"><strong>PlayerPrefs</strong></span> allow us to <a id="id293" class="indexterm"></a>store small amounts of data on the end user's machine. Using <code class="literal">PlayerPrefs</code> is a great way to save data for user levels, the coordinates of where enemies are, or a high score so when the user comes back to the game, it will show the highest score achieved over the course of all games played.</p></li><li><p>Open up the <code class="literal">GameController</code> script and from there, add in the following variables:</p><div class="informalexample"><pre class="programlisting">    private int score;
    public Text scoreText;
    public Text highScoreText;</pre></div></li><li><p>Now in the <code class="literal">Start</code> function, add in the following bolded code:</p><div class="informalexample"><pre class="programlisting">    // Use this for initialization
    void Start ()
    {
        iTween.ValueTo(gameObject, iTween.Hash(
                        "from", timeLeft,
                        "to", 0,
                        "time", timeLeft,
                        "onupdatetarget", gameObject,
                        "onupdate", "tweenUpdate",
                        "oncomplete", "GameComplete"
                        ));
        StartCoroutine("SpawnTargets");

<span class="strong"><strong>        highScoreText.text = "High Score: " + PlayerPrefs.GetInt("highScore").ToString();</strong></span>
<span class="strong"><strong>        score = 0;</strong></span>
    }</pre></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec30"></a>PlayerPrefs</h3></div></div></div><p>As I mentioned <a id="id294" class="indexterm"></a>previously, the <code class="literal">PlayerPrefs</code> class allows us to save small parts of data on our player's computers for retrieval later. The <code class="literal">PlayerPrefs</code> can store<a id="id295" class="indexterm"></a> the following types: <code class="literal">float</code>, <code class="literal">int</code>, and <code class="literal">string</code>. There are two key functions for each of the types <code class="literal">Get</code> and <code class="literal">Set</code> with the type added afterwards (<code class="literal">GetFloat, SetString</code>, and so on).</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec01"></a>Set</h4></div></div></div><p>The <code class="literal">Set</code> functions take<a id="id296" class="indexterm"></a> in two parametersâ€”the first being a string and the second being of the type you're trying to set. This will save the value in the second parameter to the registry on our computer with the string as a reference for us to get the data back with the <code class="literal">Get</code> function.</p><p>If there was a value previously saved with that variable name, it will be overwritten with the new value.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note42"></a>Note</h3><p>To be sure that your variables do not get overwritten by other projects, it's important to make sure that you set the <span class="strong"><strong>Product Name</strong></span> and <span class="strong"><strong>Company Name</strong></span> in the <span class="strong"><strong>Project Settings</strong></span>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="ch05lvl3sec02"></a>Get</h4></div></div></div><p>The <code class="literal">Get</code> functions will retrieve the value that it currently has set, if there is one. If it cannot find a<a id="id297" class="indexterm"></a> value (that variable doesn't exist yet), it will return <code class="literal">0</code>, or whatever you put in as the second parameter. So as an example, I could do something like this:</p><div class="informalexample"><pre class="programlisting">void Start() 
{
        print(PlayerPrefs.GetString("Player Name", "Bob"));
}</pre></div><p>Then, if there already is a value assigned for <span class="strong"><strong>Player Name</strong></span>, it will print out that, but otherwise, it will give you the value of Bob. This is great if you want to have a default value other than <code class="literal">0</code> or an empty string <code class="literal">""</code>.</p><p>Depending on what operating system you're currently using for this project or are porting to the location of where the values are saved to are different. For these locations, or for more information on<a id="id298" class="indexterm"></a> the <code class="literal">PlayerPrefs</code> class, check out <a class="ulink" href="http://docs.unity3d.com/ScriptReference/PlayerPrefs.html" target="_blank">http://docs.unity3d.com/ScriptReference/PlayerPrefs.html</a>.</p><p>Next, we need to create the functionality for hitting something, so add in the following function:</p><div class="informalexample"><pre class="programlisting">public void IncreaseScore()
{
    score++;
    scoreText.text = "Score: " + score.ToString();

    if (score &gt; PlayerPrefs.GetInt("highScore"))
    {
        PlayerPrefs.SetInt("highScore", score);
        highScoreText.text = "High Score: " + score.ToString();
    }
}</pre></div><p>Finally, we need to call the function, so go into the <code class="literal">TargetBehaviour</code> script and add in the following bolded line:</p><div class="informalexample"><pre class="programlisting">    /// &lt;summary&gt;
    /// Called whenever the player clicks on the object.
    /// Only works if you have a collider
    /// &lt;/summary&gt;
    void OnMouseDown()
    {
        // Is it valid to hit it
        if (!beenHit &amp;&amp; activated)
        {
<span class="strong"><strong>            GameController._instance.IncreaseScore();</strong></span>
            beenHit = true;
            animator.Play("Flip");

            StopAllCoroutines();

            StartCoroutine(HideTarget());
        }
    }</pre></div><p>Save both of your scripts <a id="id299" class="indexterm"></a>and go back into the Unity editor. Select the <span class="strong"><strong>Game Controller object</strong></span> and assign the <span class="strong"><strong>Score Text</strong></span> and <span class="strong"><strong>High Score Text</strong></span> variables to their respective game objects:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_23.jpg" /></div><p>Save your project and run the game!</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_24.jpg" /></div><p>As you can see, when<a id="id300" class="indexterm"></a> you play the game and exceed the high score, it will save that value and update the high score text. In addition, when you restart the game, your high score is saved! Excellent!</p></div></div></div>