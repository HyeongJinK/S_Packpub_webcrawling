<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch03lvl1sec35"></a>Purchasing upgrades</h2></div></div><hr /></div><p>Now that we have the<a id="id193" class="indexterm"></a> shop menu up and working, let's add in the functionality to<a id="id194" class="indexterm"></a> purchase things:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Go to the <span class="strong"><strong>Hierarchy</strong></span> tab and then toggle the <code class="literal">ShopMenu</code> back on and delete all of the other buttons except for one which will be our reference for others.</p><p>We will want each button to have three textsâ€”the name of the object, the number we have, and the cost to build another.</p></li><li><p>First, change this object's name to <code class="literal">Desc </code>and change the <span class="strong"><strong>Text</strong></span> component's <span class="strong"><strong>Alignment</strong></span> to the left horizontally, then duplicate it (<code class="literal">Ctrl+D</code>) name the duplicate <code class="literal">Cost</code> and center it. Finally, duplicate once more and change the name to <code class="literal">Qty</code> and put it on the right. Fill in the values if you'd like, but we'll be replacing the contents via code shortly:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_03_27.jpg" /></div></li><li><p>Select the <span class="strong"><strong>Button</strong></span> <a id="id195" class="indexterm"></a>object and create a new C# Script named <span class="strong"><strong>StoreItem</strong></span> and open the script up in your IDE. Once opened, use the following code:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;
using UnityEngine.UI; // Text

public enum ItemType
{
    ClickPower, PerSecondIncrease
};

public class StoreItem : MonoBehaviour
{
    [Tooltip("How much will this upgrade cost.")]
    public int cost;

    public ItemType itemType;

    [Tooltip("If purchased, how much will it increase this")]
    public float increaseAmount;

    private int qty;

    public Text costText;
    public Text qtyText;

    private GameController controller;
    private Button button;

    // Use this for initialization
    void Start ()
    {
        qty = 0;
        qtyText.text = qty.ToString();
        costText.text = "$" + cost.ToString();

        button = transform.GetComponent&lt;Button&gt;();

       // Execute the ButtonClicked function when we click 
       // the button
        button.onClick.AddListener(this.ButtonClicked);

       // Get a reference to our GameController via code
       controller = GameObject.FindObjectOfType&lt;GameController&gt;();
    }

    private void Update()
    {
        button.interactable = (controller.Cash &gt;= cost);
    }

    public void ButtonClicked()
    {
        controller.Cash -= cost;
        switch (itemType)
        {
            case ItemType.ClickPower:
                controller.cashPerClick += increaseAmount;
                break;
            case ItemType.PerSecondIncrease:
                controller.CashPerSecond += increaseAmount;
                break;
        }

        qty++;
        qtyText.text = qty.ToString();
    }
}</pre></div></li></ol></div><p>As before, let's dive<a id="id196" class="indexterm"></a> into the new parts and then jump into an overall explanation as to what the code is doing.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec18"></a>Working with enumerations</h3></div></div></div><p>At the top of this below the using statements, we make use of the enum keyword. Sometimes in code, we want to have a property that is used for a certain purpose, but it can be one and only one <a id="id197" class="indexterm"></a>of a number of things.</p><p>For instance, if I'm having pizza for lunch, it can be in the oven cooking, on my plate, or in my mouth, but it can only be in one of those at a time.</p><p>We could use boolean values for each of these possibilities, switch one to <code class="literal">true</code> and the rest to <code class="literal">false</code>, but it's a hassle. We can also use an integer to store a number and then do different things based on a number, but then someone can put in any random number and you'd have to account for that. Instead, we create a new data type that can only have certain values for it. So in this case, <code class="literal">ItemType</code> can either be <code class="literal">ClickPower</code> or <code class="literal">PerSecondIncrease</code> but nothing else. Later on, you'll note that there will now be a variable of type <code class="literal">ItemType</code> in the class itself which we then use in the code to do something based on that value. This also makes it easier to create new types of item in the future as it'll require minimal changes to the code.</p><p>For more information on enums, check out <a class="ulink" href="https://msdn.microsoft.com/en-us/library/sbbt4032.aspx" target="_blank">https://msdn.microsoft.com/en-us/library/sbbt4032.aspx</a>.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec19"></a>Switch statements</h3></div></div></div><p>This may be the first time that has seen a switch statement before. A switch statement can be thought of as a nice<a id="id198" class="indexterm"></a> way to compare a single variable against a number of different values. In this case, the switch statement mentioned previously could be rewritten as:</p><div class="informalexample"><pre class="programlisting">if (itemType == ItemType.ClickPower)
{
    controller.cashPerClick += increaseAmount;
}
else (itemType == ItemType.PerSecondIncrease)
{
    controller.CashPerSecond += increaseAmount;
}</pre></div><p>This may not seem like a big deal with this simple example, but when we get to <a class="link" href="#" linkend="ch06">Chapter 6</a>, we will be using<a id="id199" class="indexterm"></a> a switch statement again and it'll be more apparent why switch statements are such a nice thing to use.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note32"></a>Note</h3><p>For those of you with a programming background, in C# you are required to put a break at the end of each case so fall-throughs are not possible by default.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec20"></a>Explaining the StoreItem class</h3></div></div></div><p>As before, we've created a number of variables for us to work with, including references to text objects, which we then set whenever a value changes. Our items have a cost that the player has to pay to<a id="id200" class="indexterm"></a> purchase them, and we can own more than one of them so we store how many have been purchased in the past.</p><p>The button's interactable property tells the UI system if the player can click on the button or not. In our case, we don't want the player to be able to buy anything unless they have enough money to purchase it, so in our <code class="literal">Update</code> function, we set the value to <code class="literal">true</code> if the player has enough money and <code class="literal">false</code> if not.</p><p>Finally, if the player clicks on the button and it is valid, then <code class="literal">ButtonClicked</code> will get called, which will alter a certain value based on the value of our item's type.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note33"></a>Note</h3><p>Note the use of the <code class="literal">AddListener</code> function, which allows us to add a function to be called whenever a <code class="literal">UnityEvent</code> is executed. For more information on that, check out <a class="ulink" href="http://docs.unity3d.com/ScriptReference/Events.UnityEvent.AddListener.html" target="_blank">http://docs.unity3d.com/ScriptReference/Events.UnityEvent.AddListener.html</a>.</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch03lvl2sec21"></a>Filling in Item descriptions</h3></div></div></div><p>Now that we have<a id="id201" class="indexterm"></a> the functionality built in for the buttons, let's see how we can use them within the editor!</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Save your script. Now back in the editor, attach the script to our <span class="strong"><strong>Button</strong></span> object. In our newly added component, attach the <span class="strong"><strong>Cost</strong></span> and <span class="strong"><strong>Qty</strong></span> texts to the respective objects. Next, change the <span class="strong"><strong>Cost</strong></span> to <code class="literal">5</code>, set the <span class="strong"><strong>Item Type</strong></span> to <code class="literal">Per Second Increase</code>, and change the <span class="strong"><strong>Increase Amount</strong></span> to <code class="literal">0.1</code>. Finally, select the <span class="strong"><strong>Desc</strong></span> object and change the text to <code class="literal">Hire Code Monkey</code>.</p></li><li><p>Next, duplicate the<a id="id202" class="indexterm"></a> button and then change the <span class="strong"><strong>Desc</strong></span> text to <code class="literal">Develop Game</code> and then from the<code class="literal"> Button</code> object, go to the <span class="strong"><strong>Store Item </strong></span>component, change the <span class="strong"><strong>Cost</strong></span> to <code class="literal">50</code>, the <span class="strong"><strong>Item Type</strong></span> to <code class="literal">Click Power</code>, and the <span class="strong"><strong>Increase Amount</strong></span> to <code class="literal">1</code>:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_03_28.jpg" /></div></li><li><p>Finally, disable the <code class="literal">ShopMenu </code>object, save your scene, and start the game!</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_03_29.jpg" /></div></li></ol></div><p>Now we have buttons<a id="id203" class="indexterm"></a> that work for each of the types of thing that we can increase!</p></div></div>