<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch05lvl1sec56"></a>Adding a target</h2></div></div><hr /></div><p>In our shooting <a id="id256" class="indexterm"></a>gallery, we will need to have something to shoot. In this case, we will need to create a target, which the player can shoot:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create an empty game object by going to the <span class="strong"><strong>Hierarchy</strong></span> tab and selecting <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Empty Game</strong></span> object. Rename that object <span class="strong"><strong>Target</strong></span> and change its <span class="strong"><strong>Position</strong></span> to <code class="literal">0</code>,<code class="literal"> 0</code>,<code class="literal">-4</code> so it'll be on top of other objects.</p></li><li><p>Add the wooden stick and the <code class="literal">duck_outline_brown</code> sprites to the <span class="strong"><strong>Target</strong></span> object, giving the duck a <span class="strong"><strong>Position</strong></span> of <code class="literal">0</code>,<code class="literal"> 1</code>.<code class="literal">1</code>,<code class="literal">0</code> to place it on top of the stick.</p></li><li><p>We want the player to be able to touch the duck so next we will need to add a Polygon Collider 2D component to the <code class="literal">duck_outline_brown</code> object:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_02.jpg" /></div></li></ol></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec26"></a>Animating the duck using Unity's animation system</h3></div></div></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Now, let's make it <a id="id257" class="indexterm"></a>so that our duck will animate when we click on it, but before we do it, we first need to add a base animation for it to use. To do this, open up the <span class="strong"><strong>Animation</strong></span> tab by going to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Animation</strong></span>. This will open the <span class="strong"><strong>Animation</strong></span> tab by itself.</p></li><li><p>Next, from the <span class="strong"><strong>Hierarchy</strong></span> tab, select the <span class="strong"><strong>Target</strong></span> object and then from the <span class="strong"><strong>Animation</strong></span> window, click on the <span class="strong"><strong>Create</strong></span> button on the right-hand side:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_03.jpg" /></div></li><li><p>It will ask you where you want to save your animation. In this case, go to the <code class="literal">Animations</code> folder we created earlier and then give it a name of <code class="literal">Idle</code> before saying <span class="strong"><strong>OK</strong></span>.</p></li><li><p>This <a id="id258" class="indexterm"></a>animation we don't want to change due to the fact that we want it to not move, so let's click on the <code class="literal">Idle</code> drop-down and create a new clip, which will create a new animation and we will name <code class="literal">Flip</code>.</p></li><li><p>Once created, move the timeline to the 10th frame (0:10). From there, change the <span class="strong"><strong>Target</strong></span> object's <code class="literal">Y</code> <span class="strong"><strong>Rotation</strong></span> to <code class="literal">90</code>. Select the <code class="literal">duck_outline_brown</code> object and change its sprite to the <code class="literal">duck_outline_back</code> image. Then, create another <code class="literal">keyframe</code> at the 20th frame with a <code class="literal">Y</code> <span class="strong"><strong>Rotation</strong></span> of <code class="literal">180</code>.</p></li><li><p>This animation currently will loop itself, which will look incorrect on our end, so let's fix that. Go to the <span class="strong"><strong>Project</strong></span> tab, open the <code class="literal">Animations</code> folder, and select the <code class="literal">Flip</code> animation. From the <span class="strong"><strong>Inspector</strong></span> tab, uncheck the <span class="strong"><strong>Loop Time</strong></span> property. This will cause the animation to play once and then stop at the end, which is exactly what we want.</p></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec27"></a>Playing Unity animations via code</h3></div></div></div><p>Now that we <a id="id259" class="indexterm"></a>have the animation working, let's make it so that we play the animation via code:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Go to the <span class="strong"><strong>Project</strong></span> tab, open up the <span class="strong"><strong>Scripts</strong></span> folder, and from there, create a new script named <code class="literal">TargetBehaviour</code>. Inside it, use the following script:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;
using System.Collections;

public class TargetBehaviour : MonoBehaviour {

    private bool beenHit = false;
    private Animator animator;
    private GameObject parent;

    void Start()
    {
        parent = transform.parent.gameObject;
        animator = parent.GetComponent&lt;Animator&gt;();
    }

    /// &lt;summary&gt;
    /// Called whenever the player clicks on the object.
    /// only works if you have a collider on the object
    /// &lt;/summary&gt;
    void OnMouseDown()
    {
        // Is it valid to hit it
        if (!beenHit)
        {
            beenHit = true;
            animator.Play("Flip");
        }
    }
}</pre></div><p>This code will play the <code class="literal">Flip</code> animation on our target once we click on it. Note that the animator variable uses the object's parent. We need to do this because our collider is attached to the duck itself, not the <span class="strong"><strong>Target</strong></span> object.</p></li><li><p>Save the script and then go to the <code class="literal">duck_outline_brown</code> image and then attach the <code class="literal">Target Behavior</code> to it.</p></li><li><p>Save the scene and play the game. Now you can click on the sprite:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_04.jpg" /></div></li></ol></div><p>We have the<a id="id260" class="indexterm"></a> animation playing correctly! This is a great start.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec28"></a>Animation using iTween</h3></div></div></div><p>Being able to use <a id="id261" class="indexterm"></a>Unity's built-in animation system is great and can be quite useful if you want to modify many different properties at once. However, if you're only modifying a single property or you want to animate something purely via code, you can also make use of a tweening library where given a start and an end the library will take care of all the work in the middle to get it there within a time and speed you specify.</p><p>One of my favorite tweening libraries is <code class="literal">PixelPlacement's iTween</code>, which is open source and useable for free in commercial and noncommercial projects.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Open up the <span class="strong"><strong>Asset Store</strong></span> tab by going to <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Asset Store</strong></span>. Type in iTween from the search bar at the top and then press <span class="emphasis"><em>Enter</em></span>:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_05.jpg" /></div></li><li><p>If the<a id="id262" class="indexterm"></a> <span class="strong"><strong>Asset Store</strong></span> tab is too small for you, as it is here, feel free to drag it out of the middle section and resize until it looks nice for you.</p></li><li><p>From there, you'll be brought to a list of items with the first one being <span class="strong"><strong>iTween</strong></span>. Select it and you should be brought to iTween's product page. Click on the <span class="strong"><strong>Download</strong></span> button:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_06.jpg" /></div></li><li><p>From there, you'll be asked to log in to your Unity account that you created when you<a id="id263" class="indexterm"></a> installed Unity. If you don't have one, feel free to click on <span class="strong"><strong>Create Account</strong></span> and do so. Once logged in, click on <span class="strong"><strong>Download</strong></span> once again, and if it doesn't happen automatically, click on the <span class="strong"><strong>Import</strong></span> button.</p></li><li><p>You should see an <span class="strong"><strong>Import Unity Package</strong></span> window pop up. From there, you can check or uncheck whatever files you wish to keep. I will just be using <span class="strong"><strong>iTween.cs</strong></span>, but the others may be useful to you and you should wish to use them on your own. Once you're finished selecting, click on the <span class="strong"><strong>Import</strong></span> button:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_07.jpg" /></div></li><li><p>We don't <a id="id264" class="indexterm"></a>need the <span class="strong"><strong>Asset Store</strong></span> anymore, so go ahead and close it out. You'll note that now we have the files we have selected inside our <span class="strong"><strong>Project</strong></span> tab:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_08.jpg" /></div></li><li><p>Now that we have <span class="strong"><strong>iTween</strong></span> included in our project, we can now use it inside of our <a id="id265" class="indexterm"></a>code. Open up our <code class="literal">Target Behavior</code> script in your IDE of choice and add the following variable:</p><div class="informalexample"><pre class="programlisting">private bool activated;</pre></div></li><li><p>Next, add in the following function:</p><div class="informalexample"><pre class="programlisting">public void ShowTarget()
{
    if (!activated)
    {
        activated = true;
        beenHit = false;
        animator.Play("Idle");

        iTween.MoveBy(parent, iTween.Hash("y", 1.4,
                                          "easeType", "easeInOutExpo",
                                          "time", 0.5
                                           ));
    }

}</pre></div></li></ol></div><p>From here, we'll see our first function that we are calling from <span class="strong"><strong>iTween</strong></span> the <code class="literal">MoveBy</code> function. This takes in two parameters—the first being the object we wish to move and the second being a Hash or hashtable. A <span class="strong"><strong>hashtable</strong></span> is a<a id="id266" class="indexterm"></a> data structure that creates an associative array such that certain keys will be mapped to certain values. In <span class="strong"><strong>iTween</strong></span>, their implementation<a id="id267" class="indexterm"></a> takes in sets of two with the first being a property and then second being the value we want it to be.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note38"></a>Note</h3><p>For more information <a id="id268" class="indexterm"></a>on hashtables, check out <a class="ulink" href="http://en.wikipedia.org/wiki/Hash_table" target="_blank">http://en.wikipedia.org/wiki/Hash_table</a>.</p><p>For more<a id="id269" class="indexterm"></a> information on getting started with iTween, check out <a class="ulink" href="http://itween.pixelplacement.com/gettingstarted.php" target="_blank">http://itween.pixelplacement.com/gettingstarted.php</a>.</p></div><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Now that we have this function, for testing purposes let's add to the end of the Start function the following line: <code class="literal">ShowTarget();</code>
</p></li><li><p>Save your project and play the game!.</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_09.jpg" /></div></li></ol></div><p>Once the game starts, you'll note that the duck flies up in the y axis by the amount we specified via the hash!</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Now, let's make it so that the duck will move back down once we click on it. Add the following variable to the class:</p><div class="informalexample"><pre class="programlisting">private Vector3 originalPos;</pre></div></li><li><p>Afterwards, add the following line inside the <code class="literal">Start</code> function so that we initialize it:</p><div class="informalexample"><pre class="programlisting">originalPos = parent.transform.position;</pre></div></li><li><p>Then, add<a id="id270" class="indexterm"></a> in this new function:</p><div class="informalexample"><pre class="programlisting">public IEnumerator HideTarget()
{
    yield return new WaitForSeconds(.5f);

    // Move down to the original spot
    iTween.MoveBy(parent.gameObject, iTween.Hash(
    "y", (originalPos.y – parent.transform.position.y),"easeType", "easeOutQuad", "loopType", "none", "time", 0.5, "oncomplete", "OnHidden", "oncompletetarget", gameObject));
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note39"></a>Note</h3><p>Note that in this case, we added the <code class="literal">oncomplete</code> and <code class="literal">oncompletetarget</code> parameters to our hash map. <code class="literal">oncomplete</code> will call a function (in this case, <code class="literal">OnHidden</code>, which we will create after this) after the amount of time has elapsed and "<code class="literal">oncompletetarget</code>" will be what object iTween will look for the function with a name of whatever was provided in the <code class="literal">oncomplete</code> portion. This is only needed if the object you're animating is not the object that <code class="literal">iTween</code> is called on.</p></div></li><li><p>Add in the <code class="literal">OnHidden</code> function:</p><div class="informalexample"><pre class="programlisting">/// &lt;summary&gt;
/// After the tween finishes, we now make sure we can be shown
/// again. 
/// &lt;/summary&gt;
void OnHidden()
{
    //Just to make sure the object's position resets
    parent.transform.position = originalPos;
    activated = false;
}</pre></div></li><li><p>And finally, we need to update the <code class="literal">OnMouseDown</code> button so that we will only flip when the animation is valid by adding in the following bolded code:</p><div class="informalexample"><pre class="programlisting">void OnMouseDown()
{
    // Is it valid to hit it
    if (!beenHit &amp;&amp; activated)
    {
        beenHit = true;
        animator.Play("Flip");
        StartCoroutine(HideTarget());
    }
}</pre></div></li><li><p>Save your<a id="id271" class="indexterm"></a> level and project and start up the game!</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_10.jpg" /></div></li><li><p>Our sprite pops up <a id="id272" class="indexterm"></a>at the beginning and once we click on it:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_11.jpg" /></div></li></ol></div><p>It flips and<a id="id273" class="indexterm"></a> falls down, perfect!</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch05lvl2sec29"></a>Creating moving targets</h3></div></div></div><p>Now we have <a id="id274" class="indexterm"></a>our duck, and it can come up and down, it also needs to move rather than just stay in place:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, let's make it so we can do something once the duck has risen all the way up. To do this, update the <code class="literal">ShowTarget</code> function to the following:</p><div class="informalexample"><pre class="programlisting">public void ShowTarget()
{
    if (!activated)
    {
        activated = true;
        beenHit = false;
        animator.Play("Idle");

        iTween.MoveBy(parent, iTween.Hash("y", 1.4, "easeType", "easeInOutExpo", "time", 0.5, "oncomplete", "OnShown", "oncompletetarget", gameObject));
    }

}</pre></div></li><li><p>Now, let's add the <code class="literal">OnShown</code> function so that after the object has popped up, it can start moving:</p><div class="informalexample"><pre class="programlisting">    void OnShown()
    {
        StartCoroutine("MoveTarget");
    }</pre></div></li><li><p>Now, before<a id="id275" class="indexterm"></a> we write the <code class="literal">MoveTarget</code> function, let's add in the variables needed to have our player move correctly:</p><div class="informalexample"><pre class="programlisting">    public float moveSpeed = 1f;    // How fast to move in
    // x axis
    public float frequency = 5f;    // Speed of sine 
    // movement
    public float magnitude = 0.1f;  // Size of sine 
    // movement</pre></div></li><li><p>Now, let's create a coroutine to cause the target to move up and down over time while going towards the edge of the screen:</p><div class="informalexample"><pre class="programlisting">IEnumerator MoveTarget()
{
    var relativeEndPos = parent.transform.position;

    // Are we facing right or left?
    if (transform.eulerAngles == Vector3.zero)
    {
        // if we're going right positive
        relativeEndPos.x = 6;
    }
    else
    {
        // otherwise negative
        relativeEndPos.x = -6;
    }    

    var movementTime = Vector3.Distance(parent.transform.position, relativeEndPos) * moveSpeed;

    var pos = parent.transform.position;
    var time = 0f;

    while (time &lt; movementTime)
    {
        time += Time.deltaTime;

        pos += parent.transform.right * Time.deltaTime * moveSpeed;
        parent.transform.position = pos + (parent.transform.up * 
        Mathf.Sin(Time.time * frequency) * magnitude);

        yield return new WaitForSeconds(0);
    }

    StartCoroutine(HideTarget());
}</pre></div></li></ol></div><p>Math is a game developer's best friend, and here we are using sin (pronounced sine) by using the <code class="literal">Mathf.Sin</code> function.</p><p>Taking the sin of an angle number gives you the ratio of the length of the opposite side of the angle to the length<a id="id276" class="indexterm"></a> of the hypotenuse of a right-angled triangle.</p><p>If this didn't make any sense to you, don't worry. The neat feature of sin is that as the number gets larger, it will continuously give us a value between 0 and 1 that will go up and down forever, giving us a smooth repetitive oscillation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note40"></a>Note</h3><p>For more information <a id="id277" class="indexterm"></a>on sine waves, visit <a class="ulink" href="http://en.wikipedia.org/wiki/Sine_wave" target="_blank">http://en.wikipedia.org/wiki/Sine_wave</a>.</p></div><p>This mathematical principle could be used in a lot of effects, such as having save points/portals bob up and down, or any kind of object you would want to have slight movement or some special FX:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Next, we need to update the <code class="literal">OnMouseDown</code> function so that the horizontal movement won't happen anymore if we click on the duck:</p><div class="informalexample"><pre class="programlisting">/// &lt;summary&gt;
/// Called whenever the player clicks on the object. Only works if
/// you have a collider
/// &lt;/summary&gt;
void OnMouseDown()
{
    // Is it valid to hit it
    if (!beenHit &amp;&amp; activated)
    {
        beenHit = true;
        animator.Play("Flip");

        StopAllCoroutines();

        StartCoroutine(HideTarget());
    }
}</pre></div></li><li><p>Save your <a id="id278" class="indexterm"></a>project and start the game!</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_05_12.jpg" /></div></li></ol></div><p>Now our target will move towards our edge with a slight bobbing motion and will automatically hide itself afterwards if it is not clicked! Perfect!</p></div></div>