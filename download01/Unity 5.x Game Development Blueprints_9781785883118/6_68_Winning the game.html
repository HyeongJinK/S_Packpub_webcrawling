<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec69"></a>Winning the game</h2></div></div><hr /></div><p>Now that we have<a id="id368" class="indexterm"></a> the goals showing up, we now need some way in order to complete the project. With this in mind, let's create our final place, a goal, or the player to reach to go to the next level.</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Create a new <span class="strong"><strong>Particle System</strong></span> by going into <span class="strong"><strong>GameObject | Particle System</strong></span>. Change the name of the object to <code class="literal">Goal</code>.</p></li><li><p>Under the <span class="strong"><strong>Shape</strong></span> section, change the <span class="strong"><strong>Shape </strong></span>variable to <code class="literal">Box</code> and change <span class="strong"><strong>Box X</strong></span> to <code class="literal">1</code> and <span class="strong"><strong>Box Y </strong></span>and<span class="strong"><strong> Box Z</strong></span> to <code class="literal">0</code>.</p></li><li><p>Click on the arrow on the right-hand side of <span class="strong"><strong>Start Lifetime </strong></span>and change the values to be <span class="strong"><strong>Random Between Two Constants</strong></span>. Change those values to <code class="literal">0</code> and <code class="literal">1</code>. Do the same with <span class="strong"><strong>Start Speed</strong></span> between <code class="literal">2</code> and <code class="literal">4</code>. Make <span class="strong"><strong>Start Size</strong></span> use random values between <code class="literal">0</code> and <code class="literal">0.5</code>. Change the <span class="strong"><strong>Start Color</strong></span> to a <span class="strong"><strong>Random Between Two Colors</strong></span> using a green and purple color. Finally, uncheck the <span class="strong"><strong>Play On Awake</strong></span> variable. Finally, we want the particles to fly up so change Rotation X to -90 or 270:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_06_26.jpg" /></div><p>With this, you<a id="id369" class="indexterm"></a> should have a nice stream of particles coming in for your new goal object!</p></li><li><p>Add in a <span class="strong"><strong>Box Collider</strong></span> by selecting <span class="strong"><strong>Component | Physics | Box Collider</strong></span>. Toggle the <span class="strong"><strong>Is Trigger</strong></span> option to be <code class="literal">true</code>, set the <span class="strong"><strong>Center</strong></span> to be (<code class="literal">0,0,0</code>) and the <span class="strong"><strong>Size</strong></span> to be (<code class="literal">1,1,1</code>):</p></li><li><p>Now that we have the goal's object completed, let's now have it spawn within our <code class="literal">BuildLevel</code> function in our <span class="strong"><strong>Game Controller</strong></span>. So, same as before, we drag and drop the object to our <span class="strong"><strong>Prefabs</strong></span> folder and delete the original object. Then, we need to add two new variables for us to use:</p><div class="informalexample"><pre class="programlisting">public Transform goal;
private ParticleSystem goalPS;</pre></div></li><li><p>After we add the <a id="id370" class="indexterm"></a>new variables, add in the following in bold to <code class="literal">BuildLevel</code>:</p><div class="informalexample"><pre class="programlisting">    void BuildLevel() 
    {
        // Get the DynamicObjects object so we can make it
        // our newly created objects' parent
        GameObject dynamicParent = GameObject.Find("DynamicObjects");


        //Go through each element inside our level variable
        for (int yPos = 0; yPos &lt; level.Length; yPos++) 
        {
            for (int xPos = 0; xPos &lt; (level[yPos]).Length; xPos++) 
            {
                Transform toCreate = null;
                switch(level[yPos][xPos])
                {
                    case 0:
                    //Do nothing because we don't want anything there.
                    break;
                    case 1:
                    toCreate = wall;
                    break;
                    case 2:
                    toCreate = player;
                    break;
                    case 3:
                    toCreate = orb;
                    break;
                    case 4:
                    toCreate = goal;
                    break;
                    default:
                    print("Invalid number: " + (level[yPos][xPos]).ToString());
                    break;
                }

                if(toCreate != null)
                {
                    Transform newObject = Instantiate(toCreate, new Vector3(xPos,(level.Length - yPos), 
            0),toCreate.rotation) as Transform;

<span class="strong"><strong>                    if(toCreate == goal)</strong></span>
<span class="strong"><strong>                    {</strong></span>
<span class="strong"><strong>                    goalPS = newObject.gameObject.GetComponent&lt;ParticleSystem&gt;();</strong></span>
<span class="strong"><strong>                    }</strong></span>
/*
Set the object's parent to the
DynamicObjects variable so it doesn't clutter our Hierarchy
*/
                    newObject.parent = dynamicParent.transform;

                }
                

            }
        }
    }</pre></div></li><li><p>We also need to<a id="id371" class="indexterm"></a> add in a 4 somewhere inside of our level array:</p><div class="informalexample"><pre class="programlisting">private int[][] level = new int[][]
{
    new int[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 0, 0, 0, 4, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 3, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 3, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 3, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 0, 2, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1}, 
    new int[]{1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1} 
};</pre></div></li><li><p>Next in the Unity Inspector, go in and assign the <span class="strong"><strong>Goal</strong></span> object with your prefab of the<a id="id372" class="indexterm"></a> same name.</p></li><li><p>With this done, we now need to go in and add in the ability to win. Go into the <code class="literal">CollectedOrb</code> function and start our <span class="strong"><strong>Particle System</strong></span> when we get all of the orbs:</p><div class="informalexample"><pre class="programlisting">    public void CollectedOrb()
    {
        orbsCollected++;
        scoreText.text = "Orbs: " + orbsCollected + "/" + orbsTotal;

        if(orbsCollected &gt;= orbsTotal)
        {
            goalPS.Play();
        }
    }</pre></div></li><li><p>After that we need to create the script for our goal. Create a new script in our <span class="strong"><strong>Scripts</strong></span> folder that we will name <code class="literal">GoalBehaviour</code>. Open it up in <code class="literal">MonoDevelop</code> and fill it in with the following:</p><div class="informalexample"><pre class="programlisting">using UnityEngine;

public class GoalBehaviour : MonoBehaviour 
{
    ParticleSystem ps;
    void Start()
    {
        ps = GetComponent&lt;ParticleSystem&gt;();
    }

    void OnTriggerEnter(Collider other) 
    {
        if(ps.isPlaying)
        {
            print("You Win!");
        }
    }
}</pre></div></li><li><p>Save the file<a id="id373" class="indexterm"></a> and attach it do the <span class="strong"><strong>Goal</strong></span> prefab. With this all done, save the scene and hit the <span class="strong"><strong>Play</strong></span> button:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_06_27.jpg" /></div></li></ol></div><p>And with this, whenever <a id="id374" class="indexterm"></a>we collect all of the coins that we've placed in our level, the goal will appear. Finally, when we touch it, the game will tell us that we have won!</p></div>