<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch06lvl1sec68"></a>Keeping score</h2></div></div><hr /></div><p>We now want to make it<a id="id360" class="indexterm"></a> so that when we collect all of the orbs in the level the goal will appear and then you will win the game when you touch it:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>Go back into <code class="literal">MonoDevelop</code> and select the <code class="literal">GameController</code> class. Then, add the following variables:</p><div class="informalexample"><pre class="programlisting">public static GameController _instance;
private int orbsCollected;
private int orbsTotal;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note49"></a>Note</h3><p>Although it may make more sense English-wise to use totalOrbs and collectedOrbs programming-wise, putting the common word first means that when you start typing orbs, it will show both options for you when working with code completion in your own projects.</p></div></li><li><p>As normal, we will need to set these variables as well in the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">        GameObject[] orbs;
        orbs = GameObject.FindGameObjectsWithTag("Orb");
        
        orbsCollected = 0;
        orbsTotal = orbs.Length;</pre></div><p>Make sure that you place this after the <code class="literal">BuildLevel</code> function or there will be no orbs for you to count!</p></li><li><p>We will also <a id="id361" class="indexterm"></a>want to initialize the <code class="literal">_instance</code> variable, but instead of using <code class="literal">Start</code>, we will be using <code class="literal">Awake</code>:</p><div class="informalexample"><pre class="programlisting">    void Awake()
    {
        _instance = this;
    }</pre></div></li></ol></div><p>
<code class="literal">Awake</code> gets called before <code class="literal">Start</code>, which is<a id="id362" class="indexterm"></a> important because we have to initialize the <code class="literal">_instance</code> variable before you use it, this is known as a <span class="strong"><strong>Lazy Singleton</strong></span>.</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch06lvl2sec39"></a>Singletons</h3></div></div></div><p>As you work in Unity, you <a id="id363" class="indexterm"></a>may find that you have certain managers such as our <span class="strong"><strong>Game Controller</strong></span> that we will only have one of. Rather than having to have other objects store them as variables or find them at runtime, we can use a design pattern <a id="id364" class="indexterm"></a>called the <span class="strong"><strong>singleton pattern</strong></span>. The gist of it is that there is one and only one object of this class that can be created. The version that I am using is the quickest way to get singleton-like behavior going.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note50"></a>Note</h3><p>Never use the <code class="literal">GameController._instance</code> variable inside of another <code class="literal">Awake </code>function as you are not guaranteed the order in which they'll be called. However, if you use it in <code class="literal">Start</code> or any of the other functions we've talked about, you'll be okay.</p></div><p>As we collect orbs, we want to increase the value of our <code class="literal">orbsCollected</code> variable. Rather than just giving other things access to the variable, let's wrap this around a function so we can do other things, such as update the GUI later creating a function:</p><div class="informalexample"><pre class="programlisting">public void CollectedOrb()
{
    orbsCollected++;
}</pre></div><p>In our <code class="literal">OrbBehaviour</code> script, we call the function:</p><div class="informalexample"><pre class="programlisting">    void OnTriggerEnter(Collider other) 
    {
        GameController._instance.CollectedOrb();
        Destroy(this.gameObject);
    }</pre></div><p>When you access the <code class="literal">_instance</code> variable, you get access to the public functions and variables that exist in the class.</p><p>Now that we have<a id="id365" class="indexterm"></a> this data stored, let's display it on the screen so players can see. Go to <span class="strong"><strong>GameObject | UI | Text</strong></span>. Place it on the top left of the screen (a position of 0, 1, 0 with an Anchor of upper left and alignment of left) using the <span class="strong"><strong>Anchor Presets</strong></span> menu we used in previous chapters. Next, give the object a name of <span class="strong"><strong>Score Text</strong></span> and give it the <span class="strong"><strong>Pos X</strong></span> of <span class="strong"><strong>10</strong></span> and <span class="strong"><strong>Pos Y</strong></span> of <span class="strong"><strong>-10</strong></span>:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_06_24.jpg" /></div><p>Now that we have the text object created, let's reference it inside code. To start off, we will need to add in the correct <code class="literal">using</code> line at the top of the <span class="strong"><strong>Game Controller</strong></span> script:</p><div class="informalexample"><pre class="programlisting">using UnityEngine.UI; // Text</pre></div><p>Then, we will<a id="id366" class="indexterm"></a> need to add one last variable to our <span class="strong"><strong>Game Controller</strong></span>:</p><div class="informalexample"><pre class="programlisting">public Text scoreText;</pre></div><p>We need to initialize it in the <code class="literal">Start</code> function:</p><div class="informalexample"><pre class="programlisting">    void Start() 
    {
        BuildLevel();

        GameObject[] orbs;
        orbs = GameObject.FindGameObjectsWithTag("Orb");

        orbsCollected = 0;
        orbsTotal = orbs.Length;

        scoreText.text = "Orbs: " + orbsCollected + "/" + orbsTotal;
    }</pre></div><p>And now because we have a text displaying the orbs, we can now update our text accordingly:</p><div class="informalexample"><pre class="programlisting">    public void CollectedOrb()
    {
        orbsCollected++;
        scoreText.text = "Orbs: " + orbsCollected + "/" + orbsTotal;
    }</pre></div><p>With this, save the script and then go back into the Unity editor. Once you reach here, set our newly created variable with the <code class="literal">Text</code> object we created and then click on the <span class="strong"><strong>Play</strong></span> button:</p><div class="mediaobject"><img src="/graphics/9781785883118/graphics/B05212_06_25.jpg" /></div><p>At this point, you <a id="id367" class="indexterm"></a>can move around the level, and when you collect the orbs, they will now update the GUI letting us know how many coins you've collected and how many there are total in the level. We're making great progress and we almost have a full game, we just need one last thing, a way to win!</p></div></div>