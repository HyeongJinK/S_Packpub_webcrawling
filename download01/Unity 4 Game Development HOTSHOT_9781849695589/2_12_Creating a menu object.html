<div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ch02lvl1sec22"></a>Creating a menu object</h2></div></div><hr /></div><p>Continuing from the first step, we will now create our menu game object in the scene that can open and <a id="id267" class="indexterm"></a>close the menu window. Pressing the <span class="emphasis"><em>M</em></span> key will <a id="id268" class="indexterm"></a>open the menu window, and clicking on the <span class="strong"><strong>x</strong></span> button in the window will close the menu window. We will also create three tab buttons for the player to be able to see through the different pages, <span class="strong"><strong>STATUS</strong></span>, <span class="strong"><strong>INVENTORY</strong></span>, and <span class="strong"><strong>EQUIPMENT</strong></span>, as we can see in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695589/graphics/5589OT_02_20.jpg" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec42"></a>Engage thrusters</h3></div></div></div><p>We will <a id="id269" class="indexterm"></a>begin by <a id="id270" class="indexterm"></a>creating the menu using the following steps:</p><div class="orderedlist"><ol class="orderedlist arabic" type="1"><li><p>First, we want to create an empty game object in our scene and name it <code class="literal">menu</code>; go to <span class="strong"><strong>GameObject</strong></span> | <span class="strong"><strong>Create Empty</strong></span> and name it <code class="literal">MenuObject</code> and set its <span class="strong"><strong>Tag</strong></span> and <span class="strong"><strong>Layer</strong></span> to <span class="strong"><strong>UI</strong></span>. We will use this object for our menu.</p></li><li><p>Next, we will create the menu script that will control our entire menu; go to <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>Javascript</strong></span> (for Unity JavaScript users) or <span class="strong"><strong>Assets</strong></span> | <span class="strong"><strong>Create</strong></span> | <span class="strong"><strong>C#</strong></span> (for C# users), name it <code class="literal">Menu</code>, double-click on it to launch <span class="strong"><strong>MonoDevelop</strong></span>, and we will get our hands dirty with the code.</p></li><li><p>Open the <code class="literal">Menu</code> script file and type the following variables:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Unity JavaScript user</strong></span>

#pragma strict
public enum TAB {STATUS,INVENTORY,EQUIPMENT};
var customSkin : GUISkin;
var heroTexture : Texture;
var statBox1Texture : Texture;
var statBox2Texture : Texture;
var skillBoxTexture : Texture;
private final var TOOLBARS : String[] = 
[ TAB.STATUS.ToString(), TAB.INVENTORY.ToString(), TAB.EQUIPMENT.ToString() ];
private final var HERO_RECT : Rect = new Rect (19, 35, 225, 441);
private final var CLOSE_BTN_RECT : Rect = new Rect (598, 8, 26, 22);
private final var TAB_BTN_RECT : Rect = new Rect (35, 15, 480, 40);
private var _currentTool : TAB = TAB.STATUS;
private var _windowRect : Rect = new Rect (10, 10, 640, 480);
private var _isMenuOpen : boolean = false;</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note15"></a>Note</h3><p>
<code class="literal">final</code>: We use the word <code class="literal">final</code> here because we want the value to be assigned <a id="id271" class="indexterm"></a>only <a id="id272" class="indexterm"></a>once. We can say that this is the constant <a id="id273" class="indexterm"></a>value and it is used to prevent the error from reassigning the value.</p></div><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// C# user:</strong></span>

using UnityEngine;
using System.Collections;
public class Menu : MonoBehaviour {
  public enum TAB {STATUS,INVENTORY,EQUIPMENT};  
  public GUISkin customSkin;
public Texture heroTexture;
  public Texture statBox1Texture;
  public Texture statBox2Texture;
  public Texture skillBoxTexture;  
  readonly string[] TOOLBARS = 
{TAB.STATUS.ToString(), TAB.INVENTORY.ToString(),TAB.EQUIPMENT.ToString()};
  readonly Rect HERO_RECT = new Rect (19, 35, 225, 441);
  readonly Rect CLOSE_BTN_RECT = new Rect (598, 8, 26, 22);
  readonly Rect TAB_BTN_RECT = new Rect (35, 15, 480, 40);
TAB _currentTool = TAB.STATUS;
  Rect _windowRect = new Rect (10, 10, 640, 480);
bool _isMenuOpen = false;
…
}</pre></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note16"></a>Note</h3><p>
<code class="literal">readonly</code>: We use <code class="literal">readonly</code> instead of <code class="literal">const</code> here because <code class="literal">string[]</code> and <code class="literal">Rect</code> aren't the constant expressions in C# and are not known at the compile<a id="id274" class="indexterm"></a> time. So, it <a id="id275" class="indexterm"></a>will produce a compile error if we use <code class="literal">const</code>. Also, <code class="literal">readonly</code> is basically similar to the word <code class="literal">final</code> in Java, which <a id="id276" class="indexterm"></a>can be initialized only once.</p></div><p>Here, we just created the necessary variables for our menu window, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695589/graphics/5589OT_02_21.jpg" /></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note17"></a>Note</h3><p>The result of <span class="strong"><strong>statBox1Texture</strong></span>, <span class="strong"><strong>statBox2Texture</strong></span>, and <span class="strong"><strong>skillBoxTexture</strong></span> will be shown in the <span class="emphasis"><em>Creating the STATUS tab</em></span> section.</p></div></li><li><p>Next, we will set <code class="literal">_isMenuOpen</code> to <code class="literal">false</code> in the <code class="literal">Start()</code> function, because we don't want our menu to show until the player presses the <span class="emphasis"><em>M</em></span> key, so type the code as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Unity JavaScript user:</strong></span>

function Start () : void {
  _isMenuOpen = false;
}


<span class="strong"><strong>// C# user:</strong></span>

void Start () {
  _isMenuOpen = false;
}</pre></div></li><li><p>Then, we go to the <code class="literal">OnGUI</code> function, and we will use the <code class="literal">Event</code> class to check<a id="id277" class="indexterm"></a> if the user is pressing the correct key.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note18"></a>Note</h3><p>The <code class="literal">OnGUI</code> function acts in a similar way to the <code class="literal">Update</code> function, but <code class="literal">OnGUI</code> gets called <a id="id278" class="indexterm"></a>more<a id="id279" class="indexterm"></a> than once, for rendering and handling the <code class="literal">GUI</code> events, meaning<a id="id280" class="indexterm"></a> that <code class="literal">OnGUI</code> implementation might be called several times per frame (one call per event).</p></div><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Unity JavaScript user:</strong></span>

function OnGUI () : void {
  GUI.skin = customSkin;
  var e : Event = Event.current;  
  if ((e.isKey) &amp;&amp; (e.keyCode == KeyCode.M) &amp;&amp; (!_isMenuOpen)) {
    _isMenuOpen = true;
    Time.timeScale = 0.0f;
  }
}


<span class="strong"><strong>// C# user:</strong></span>

void OnGUI () {
  GUI.skin = customSkin; //Assigning custom MenuSkin  
  Event e = Event.current;  
  if ((e.isKey) &amp;&amp; (e.keyCode == KeyCode.M) &amp;&amp; (!_isMenuOpen)) {
    _isMenuOpen = true;
    Time.timeScale = 0.0f;
  }
}</pre></div></li><li><p>Next, we will create a draggable window menu, which will contain all the buttons and background textures; add this code after the <code class="literal">OnGUI</code> function as follows:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Unity JavaScript user:</strong></span>

private function DoMyWindow (windowID : int) : void {
  _currentTool = GUI.Toolbar (TAB_BTN_RECT, parseInt(_currentTool), TOOLBARS, GUI.skin.GetStyle("Tab Button"));
  GUI.DrawTexture(HERO_RECT, heroTexture);
  if (GUI.Button (CLOSE_BTN_RECT, "", GUI.skin.GetStyle("Exit Button"))) {
    _isMenuOpen = false;
    Time.timeScale = 1.0f;
  }
  GUI.DragWindow();
}


<span class="strong"><strong>// C# user:</strong></span>

void DoMyWindow (int windowID ) {
  _currentTool = (TAB) GUI.Toolbar (TAB_BTN_RECT, (int)_currentTool, TOOLBARS, GUI.skin.GetStyle("Tab Button"));
  GUI.DrawTexture(HERO_RECT, heroTexture);
  if (GUI.Button (CLOSE_BTN_RECT, "", GUI.skin.GetStyle("Exit Button"))) {
    _isMenuOpen = false;
    Time.timeScale = 1.0f;
  }  
  GUI.DragWindow();
}</pre></div></li><li><p>Then, we go back to the <code class="literal">OnGUI</code> function. We will add the code to create a <a id="id281" class="indexterm"></a>draggable <a id="id282" class="indexterm"></a>window by using <code class="literal">GUI.Window</code> and passing the <code class="literal">DoMyWindow()</code> function that we just created. We also make sure that the window is always on the screen by checking the <code class="literal">x</code> and <code class="literal">y</code> positions of <code class="literal">_windowRect</code>, so add the following highlighted code to the <code class="literal">OnGUI</code> function.</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>// Unity JavaScript user:</strong></span>

function OnGUI () : void {
  …
  if ((e.isKey) &amp;&amp; (e.keyCode == KeyCode.M) &amp;&amp; (!_isMenuOpen)) {
     …
  }
<span class="strong"><strong>  if (_isMenuOpen) {  //Open menu if 'true'</strong></span>
<span class="strong"><strong>    _windowRect = GUI.Window (0, _windowRect, DoMyWindow, "");      </strong></span>
<span class="strong"><strong>    _windowRect.x = Mathf.Clamp(_windowRect.x, 0.0f, Screen.width - _windowRect.width);</strong></span>
<span class="strong"><strong>    _windowRect.y = Mathf.Clamp(_windowRect.y, 0.0f, Screen.height - _windowRect.height);     </strong></span>
<span class="strong"><strong>  }</strong></span>
}


<span class="strong"><strong>// C# user:</strong></span>

void OnGUI () {
  …  
  if ((e.isKey) &amp;&amp; (e.keyCode == KeyCode.M) &amp;&amp; (!_isMenuOpen)) {
     …
  }
<span class="strong"><strong>  if (_isMenuOpen) {  //Open menu if 'true'</strong></span>
<span class="strong"><strong>    _windowRect = GUI.Window (0, _windowRect, DoMyWindow, "");</strong></span>
<span class="strong"><strong>    _windowRect.x = Mathf.Clamp(_windowRect.x, 0.0f, </strong></span>
<span class="strong"><strong>      Screen.width - _windowRect.width);</strong></span>
<span class="strong"><strong>    _windowRect.y = Mathf.Clamp(_windowRect.y, 0.0f, Screen.height - _windowRect.height);     </strong></span>
<span class="strong"><strong>  }</strong></span>
}</pre></div><p>As we want everything inside our menu window, we used the <code class="literal">DoMyWindow()</code> function to take <code class="literal">GUI.Window</code> as one parameter. Inside the <code class="literal">DoMyWindow()</code> function, we create all the buttons and textures. Then, we<a id="id283" class="indexterm"></a> make <a id="id284" class="indexterm"></a>our window draggable by adding <code class="literal">GUI.DragWindow()</code>. With that, we are done with coding for this step.</p></li><li><p>Next, go back to Unity, click on the <code class="literal">Menu</code> script file and drag-and-drop it to <code class="literal">MenuObject</code> in the<span class="strong"><strong> Hierarchy</strong></span> view. Next, click on <code class="literal">MenuObject</code> in the <span class="strong"><strong>Hierarchy</strong></span> view, open the <span class="strong"><strong>Inspector</strong></span> view under the <code class="literal">menu</code> (script), and set the parameters as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; "><colgroup><col align="left" /><col align="left" /></colgroup><thead><tr><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Parameters</p>
</th><th style="border-bottom: 0.5pt solid ; " align="left" valign="bottom">
<p>Settings</p>
</th></tr></thead><tbody><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Custom Skin</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>Drag-and-drop <span class="strong"><strong>MenuSkin</strong></span>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Hero Texture</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>Drag-and-drop <span class="strong"><strong>player</strong></span>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Stat Box 1Texture</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>Drag-and-drop <span class="strong"><strong>stat1</strong></span>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Stat Box 2Texture</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>Drag-and-drop <span class="strong"><strong>stat2</strong></span>
</p>
</td></tr><tr><td style="" align="left" valign="top">
<p>
<span class="strong"><strong>Skill Box Texture:</strong></span>
</p>
</td><td style="" align="left" valign="top">
<p>Drag-and-drop <span class="strong"><strong>skillBox</strong></span>
</p>
</td></tr></tbody></table></div></li><li><p>Then, we can click on the <span class="strong"><strong>Play</strong></span> button to see the result. In the game scene, we can press the <span class="emphasis"><em>M</em></span> key to bring up our window and click on the <span class="strong"><strong>x</strong></span> button at<a id="id285" class="indexterm"></a> the top-right corner of the screen to close it, as shown in the following screenshot:</p><div class="mediaobject"><img src="/graphics/9781849695589/graphics/5589OT_02_22.jpg" /></div></li></ol></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec43"></a>Objective complete – mini debriefing</h3></div></div></div><p>We just <a id="id286" class="indexterm"></a>created a menu window, which can be opened by pressing the <span class="emphasis"><em>M</em></span> key and closed by clicking on the <span class="strong"><strong>x</strong></span> button at the top-right corner of the menu window. We also have our character texture nicely placed inside our menu window. Next, we made this window draggable and made sure it is always on the screen by using the following code:</p><div class="informalexample"><pre class="programlisting">_windowRect.x = Mathf.Clamp(_windowRect.x, 0.0f, Screen.width - _windowRect.width);
_windowRect.y = Mathf.Clamp(_windowRect.y, 0.0f, Screen.height - _windowRect.height);</pre></div><p>Basically, we set the minimum limit of our window in the <code class="literal">x</code> position to <code class="literal">0</code> and the maximum to the screen width subtracted by the window width; we also set the minimum limit of <code class="literal">y</code> position to <code class="literal">0</code> and the maximum to the screen height subtracted by the window height.</p><p>We will see this result when we click on <span class="strong"><strong>Play the game</strong></span> and try to drag this window off the screen. Lastly, we created a tab that can be clicked to change to a different page.</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ch02lvl2sec44"></a>Classified intel</h3></div></div></div><p>In this step, we used the <code class="literal">GUI</code> class to create our window, box, and buttons, but we can also use a <code class="literal">GUILayout</code> class<a id="id287" class="indexterm"></a> to create the same thing as we did with the <code class="literal">GUI</code> class. The only difference between these two classes is that <code class="literal">GUI</code> will need to take a <code class="literal">Rect</code> object<a id="id288" class="indexterm"></a> to specify the size and position of the UI. On the other hand, <code class="literal">GUILayout</code> doesn't need to take the <code class="literal">Rect</code> object. It will automatically adjust the size according to the source it has. Let's say, we want<a id="id289" class="indexterm"></a> to create a box that contains a text or image, <code class="literal">GUILayout</code> will automatically adjust the height and width to nicely fit your text or image. For<a id="id290" class="indexterm"></a> the position, <code class="literal">GUILayout</code> will automatically set the first position to the top-left corner of the screen, which is (<span class="strong"><strong>0</strong></span>, <span class="strong"><strong>0</strong></span>), and it will continue to the right-hand side or down depending on the <code class="literal">GUILayout</code> object that we already have on the screen. However, the downside is that we will not be able to create a fixed position or size for the <code class="literal">GUILayout</code> class. Also, because the <code class="literal">GUILayout</code> class will automatically calculate the position and size for us, this means that it will be more expensive to use than the <code class="literal">GUI</code> class. However, the <code class="literal">GUILayout</code> class is very convenient and the UI editor in Unity is based on this class, we can use it to create the custom editor script combined with the <code class="literal">EditorGUILayout</code> (we will learn about the custom editor in a later project). Both of these classes are very powerful. We can use them in different situations.</p><p>You can see more <a id="id291" class="indexterm"></a>details of the <code class="literal">GUI</code> class at the following URL:</p><p>
<a class="ulink" href="http://unity3d.com/support/documentation/ScriptReference/GUI.html" target="_blank">http://unity3d.com/support/documentation/ScriptReference/GUI.html</a></p><p>You can see the <a id="id292" class="indexterm"></a>details of the <code class="literal">GUILayout</code> class at the following URL:</p><p>
<a class="ulink" href="http://unity3d.com/support/documentation/ScriptReference/GUILayout.html" target="_blank">http://unity3d.com/support/documentation/ScriptReference/GUILayout.html</a></p><p>The <code class="literal">GUI.DragWindow()</code> function<a id="id293" class="indexterm"></a> allows us to create a draggable window by specifying the drag area on our window. You can visit the following URL to see the details:</p><p>
<a class="ulink" href="http://unity3d.com/support/documentation/ScriptReference/GUI.DragWindow.html" target="_blank">http://unity3d.com/support/documentation/ScriptReference/GUI.DragWindow.html</a></p><p>This function<a id="id294" class="indexterm"></a> takes one <code class="literal">Rect</code> parameter, which is the area that allows the user to drag the window around. However, we didn't assign the <code class="literal">Rect</code> parameters to our <code class="literal">GUI.DragWindow()</code> function, which means that we can drag the whole window in an area.</p></div></div>